/*! For license information please see 997.439a4838.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[997],{6881:(e,t,a)=>{a.d(t,{A:()=>s});var l=a(65043),n=a(51762),o=a(66381);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},i.apply(this,arguments)}const r=(e,t)=>l.createElement(o.A,i({},e,{ref:t,icon:n.A}));const s=l.forwardRef(r)},9764:(e,t,a)=>{a.d(t,{A:()=>s});var l=a(65043);const n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M483.2 790.3L861.4 412c1.7-1.7 2.5-4 2.3-6.3l-25.5-301.4c-.7-7.8-6.8-13.9-14.6-14.6L522.2 64.3c-2.3-.2-4.7.6-6.3 2.3L137.7 444.8a8.03 8.03 0 000 11.3l334.2 334.2c3.1 3.2 8.2 3.2 11.3 0zm62.6-651.7l224.6 19 19 224.6L477.5 694 233.9 450.5l311.9-311.9zm60.16 186.23a48 48 0 1067.88-67.89 48 48 0 10-67.88 67.89zM889.7 539.8l-39.6-39.5a8.03 8.03 0 00-11.3 0l-362 361.3-237.6-237a8.03 8.03 0 00-11.3 0l-39.6 39.5a8.03 8.03 0 000 11.3l243.2 242.8 39.6 39.5c3.1 3.1 8.2 3.1 11.3 0l407.3-406.6c3.1-3.1 3.1-8.2 0-11.3z"}}]},name:"tags",theme:"outlined"};var o=a(66381);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},i.apply(this,arguments)}const r=(e,t)=>l.createElement(o.A,i({},e,{ref:t,icon:n}));const s=l.forwardRef(r)},78997:(e,t,a)=>{a.r(t),a.d(t,{default:()=>le});var l=a(89379),n=a(65043),o=a(62305),i=a(16569),r=a(73146),s=a(76399),d=a(96651),c=a(6051),u=a(95206),h=a(60446),m=a.n(h),v=a(27089),p=a(9764),y=a(53722),b=a(85192);const x={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M866.9 169.9L527.1 54.1C523 52.7 517.5 52 512 52s-11 .7-15.1 2.1L157.1 169.9c-8.3 2.8-15.1 12.4-15.1 21.2v482.4c0 8.8 5.7 20.4 12.6 25.9L499.3 968c3.5 2.7 8 4.1 12.6 4.1s9.2-1.4 12.6-4.1l344.7-268.6c6.9-5.4 12.6-17 12.6-25.9V191.1c.2-8.8-6.6-18.3-14.9-21.2zM810 654.3L512 886.5 214 654.3V226.7l298-101.6 298 101.6v427.6zm-405.8-201c-3-4.1-7.8-6.6-13-6.6H336c-6.5 0-10.3 7.4-6.5 12.7l126.4 174a16.1 16.1 0 0026 0l212.6-292.7c3.8-5.3 0-12.7-6.5-12.7h-55.2c-5.1 0-10 2.5-13 6.6L468.9 542.4l-64.7-89.1z"}}]},name:"safety-certificate",theme:"outlined"};var g=a(66381);function A(){return A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},A.apply(this,arguments)}const j=(e,t)=>n.createElement(g.A,A({},e,{ref:t,icon:x}));const _=n.forwardRef(j);var f=a(73092),k=a(76401),S=a(6881),w=a(45229),C=a(9933),I=a(46237),O=a(39470),L=a(80132);const P={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"};function q(){return q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},q.apply(this,arguments)}const M=(e,t)=>n.createElement(g.A,q({},e,{ref:t,icon:P}));const R=n.forwardRef(M);const B={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"};function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},F.apply(this,arguments)}const V=(e,t)=>n.createElement(g.A,F({},e,{ref:t,icon:B}));const D=n.forwardRef(V);var Y=a(70579);const E=e=>{let{onAllocate:t,onRevert:a,onStockout:l,onStorageAllocate:n}=e;return[{title:"Invoice ID",dataIndex:"invoice_id",key:"invoice_id",render:e=>(0,Y.jsx)(s.A,{icon:(0,Y.jsx)(v.A,{}),color:"blue",children:e})},{title:"Product",dataIndex:"ProductItem",key:"product",render:e=>(0,Y.jsx)(d.A,{title:null===e||void 0===e?void 0:e.name,children:(0,Y.jsxs)("span",{children:[(0,Y.jsx)(p.A,{style:{marginRight:4}}),null===e||void 0===e?void 0:e.name]})})},{title:"Vendor",dataIndex:"VendorDetails",key:"vendor",render:e=>(0,Y.jsx)(d.A,{title:null===e||void 0===e?void 0:e.company_name,children:(0,Y.jsxs)("span",{children:[(0,Y.jsx)(y.A,{style:{marginRight:4}}),(null===e||void 0===e?void 0:e.company_name)||"-"]})})},{title:"Warehouse",dataIndex:"WarehouseItem",key:"warehouse",render:e=>(0,Y.jsx)(d.A,{title:null===e||void 0===e?void 0:e.warehouse_name,children:(0,Y.jsxs)("span",{children:[(0,Y.jsx)(b.A,{style:{marginRight:4}}),(null===e||void 0===e?void 0:e.warehouse_name)||"-"]})})},{title:"Batch Number",dataIndex:"batch_no",key:"batch_no",render:e=>(0,Y.jsx)(s.A,{icon:(0,Y.jsx)(_,{}),color:"purple",children:e||"-"})},{title:"Buy Price",dataIndex:"buy_price",key:"buy_price",render:e=>(0,Y.jsxs)("span",{children:[(0,Y.jsx)(f.A,{style:{marginRight:4}}),"\u20b9",e]})},{title:"Selling Price",dataIndex:"sell_price",key:"sell_price",render:e=>(0,Y.jsxs)("span",{children:[(0,Y.jsx)(k.A,{style:{marginRight:4}}),"\u20b9",e||"-"]})},{title:"Buy Date",dataIndex:"buyed_date",key:"buyed_date",render:e=>(0,Y.jsxs)("span",{children:[(0,Y.jsx)(S.A,{style:{marginRight:4}}),m()(e).format("DD/MM/YYYY")]})},{title:"MFG Date",dataIndex:"mfg_date",key:"mfg_date",render:e=>(0,Y.jsxs)("span",{children:[(0,Y.jsx)(w.A,{style:{marginRight:4}}),e?m()(e).format("DD/MM/YYYY"):"-"]})},{title:"Expiry Date",dataIndex:"expiry_date",key:"expiry_date",render:e=>{const t=m()(e),a=m()(),l=t.isBefore(a),n=t.diff(a,"days")<=30&&t.diff(a,"days")>0;let o="green";return l?o="red":n&&(o="orange"),(0,Y.jsxs)(s.A,{color:o,children:[(0,Y.jsx)(S.A,{style:{marginRight:4}}),e?m()(e).format("DD/MM/YYYY"):"-"]})}},{title:"Payment Status",dataIndex:"payment_status",key:"payment_status",render:e=>(0,Y.jsx)(s.A,{color:"paid"===e?"green":"partial"===e?"orange":"red",children:e})},{title:"Total Cost",dataIndex:"total_cost",key:"total_cost",render:e=>(0,Y.jsxs)("span",{style:{fontWeight:"bold"},children:["\u20b9",e]})},{title:"Buy Quantity",dataIndex:"quantity",key:"quantity",render:e=>(0,Y.jsxs)(s.A,{color:"green",children:[(0,Y.jsx)(C.A,{})," ",e]})},{title:"Available Qty",dataIndex:"available_quantity",key:"available_quantity",render:e=>(0,Y.jsx)(s.A,{color:e>0?"green":"red",children:e})},{title:"Available Qty to Rack",dataIndex:"rack_available_to_allocate",key:"rack_available_to_allocate",render:e=>(0,Y.jsx)(s.A,{color:e>0?"green":"red",children:e})},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>{const a=t.available_quantity||0,l=t.expiry_date?m()(t.expiry_date):null,n=m()();let o="Active",i="green",r=(0,Y.jsx)(I.A,{});return 0===a?(o="Out of Stock",i="red",r=(0,Y.jsx)(O.A,{})):l&&l.isBefore(n)?(o="Expired",i="red",r=(0,Y.jsx)(O.A,{})):l&&l.diff(n,"days")<=30&&(o="Near Expiry",i="orange",r=(0,Y.jsx)(O.A,{})),(0,Y.jsx)(s.A,{color:i,icon:r,children:o})}},{title:"Stock Handle",key:"stock_handle",width:280,render:(e,o)=>{const i=0===(o.available_quantity||0),r=0===(o.rack_available_to_allocate||0);return(0,Y.jsxs)(c.A,{size:"small",children:[(0,Y.jsx)(d.A,{title:"Allocate Stock",children:(0,Y.jsx)(u.Ay,{type:"primary",size:"small",icon:(0,Y.jsx)(C.A,{}),onClick:()=>t(o),disabled:i,style:{fontSize:"10px",height:"24px",padding:"0 6px"},children:"Allocate"})}),(0,Y.jsx)(d.A,{title:r?"Rack storage quantity not available":"Storage Allocate",children:(0,Y.jsx)(u.Ay,{type:"primary",size:"small",icon:(0,Y.jsx)(L.A,{}),onClick:()=>n(o),disabled:i||r,style:{fontSize:"10px",height:"24px",padding:"0 6px",backgroundColor:"#52c41a",borderColor:"#52c41a"},children:"Storage"})}),(0,Y.jsx)(d.A,{title:"Revert Changes",children:(0,Y.jsx)(u.Ay,{type:"default",size:"small",icon:(0,Y.jsx)(R,{}),onClick:()=>a(o),style:{fontSize:"10px",height:"24px",padding:"0 6px"},children:"Revert"})}),(0,Y.jsx)(d.A,{title:"Mark as Stockout",children:(0,Y.jsx)(u.Ay,{type:"default",size:"small",icon:(0,Y.jsx)(D,{}),onClick:()=>l(o),style:{fontSize:"10px",height:"24px",padding:"0 6px"},children:"Stockout"})})]})}}]};var N=a(26553),z=a(36621),Q=a(7866),T=a(93504);const{Option:G}=N.A,W=(e,t,a,l,n,o)=>{var i;return[{label:"Invoice / Reference ID",name:"invoice_id",rules:[{required:!0,message:"Enter invoice or reference ID!"}],component:(0,Y.jsx)(z.A,{placeholder:"e.g., INV-1001"})},{label:"Product",name:"product",rules:[{required:!0,message:"Please select a product!"}],component:(0,Y.jsx)(N.A,{placeholder:"Select product",showSearch:!0,allowClear:!0,loading:l,optionFilterProp:"children",filterOption:(e,t)=>"string"===typeof(null===t||void 0===t?void 0:t.children)&&t.children.toLowerCase().includes(e.toLowerCase()),children:null===e||void 0===e?void 0:e.map((e=>{var t;return(0,Y.jsx)(N.A.Option,{value:null===e||void 0===e?void 0:e._id,children:"".concat(e.name," ").concat(null===e||void 0===e||null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)},null===e||void 0===e?void 0:e._id)}))})},{label:"Quantity",name:"quantity",rules:[{required:!0,message:"Enter quantity!"}],component:(0,Y.jsx)(Q.A,{min:1,placeholder:"e.g., 10",style:{width:"100%"}})},{label:"Buying Price (per unit)",name:"buy_price",rules:[{required:!0,message:"Enter buying price!"}],component:(0,Y.jsx)(Q.A,{min:0,step:.01,placeholder:"\u20b90.00",style:{width:"100%"}})},{label:"MRP (per unit)",name:"mrp",rules:[{required:!0,message:"Enter buying price!"}],component:(0,Y.jsx)(Q.A,{min:0,step:.01,placeholder:"\u20b90.00",style:{width:"100%"}})},{label:"Selling Price",name:"sell_price",rules:[],component:(0,Y.jsx)(Q.A,{min:0,step:.01,placeholder:"\u20b90.00",style:{width:"100%"}})},{label:"Batch Number",name:"batch_no",rules:[],component:(0,Y.jsx)(z.A,{placeholder:"Optional batch number"})},{label:"Manufacturing Date",name:"mfg_date",rules:[],component:(0,Y.jsx)(T.A,{format:"YYYY-MM-DD",style:{width:"100%"}})},{label:"Expiry Date",name:"expiry_date",rules:[{required:!0,message:"Enter expiry date!"},e=>{let{getFieldValue:t}=e;return{validator(e,a){const l=t("mfg_date");return l&&a&&a.isBefore(l)?Promise.reject(new Error("Expiry must be after MFG date")):Promise.resolve()}}}],component:(0,Y.jsx)(T.A,{format:"YYYY-MM-DD",style:{width:"100%"}})},{label:"Vendor",name:"vendor",rules:[{required:!0,message:"Select vendor!"}],component:(0,Y.jsx)(N.A,{placeholder:"Select Vendor",showSearch:!0,allowClear:!0,loading:n,optionFilterProp:"children",filterOption:(e,t)=>"string"===typeof(null===t||void 0===t?void 0:t.children)&&t.children.toLowerCase().includes(e.toLowerCase()),children:null===t||void 0===t?void 0:t.map((e=>(0,Y.jsx)(N.A.Option,{value:null===e||void 0===e?void 0:e._id,children:"".concat(e.vendor_name," ").concat(null===e||void 0===e?void 0:e.company_name)},null===e||void 0===e?void 0:e._id)))})},{label:"Buyed Date",name:"buyed_date",initialValue:m()(),rules:[{required:!0,message:"Select the buyed date"}],component:(0,Y.jsx)(T.A,{format:"YYYY-MM-DD",style:{width:"100%"}})},{label:"Payment Status",name:"payment_status",rules:[{required:!0,message:"Select payment status!"}],component:(0,Y.jsxs)(N.A,{placeholder:"Select payment status",children:[(0,Y.jsx)(G,{value:"paid",children:"Paid"}),(0,Y.jsx)(G,{value:"pending",children:"Pending"}),(0,Y.jsx)(G,{value:"partial",children:"Partial"})]})},{label:"Warehouse / Location",name:"warehouse_location",rules:[],component:(0,Y.jsx)(N.A,{placeholder:"Select warehouse",showSearch:!0,allowClear:!0,loading:o,optionFilterProp:"children",filterOption:(e,t)=>"string"===typeof(null===t||void 0===t?void 0:t.children)&&t.children.toLowerCase().includes(e.toLowerCase()),children:null===a||void 0===a||null===(i=a.result)||void 0===i?void 0:i.map((e=>(0,Y.jsx)(N.A.Option,{value:null===e||void 0===e?void 0:e._id,children:"".concat(e.warehouse_name," ").concat(null===e||void 0===e?void 0:e.warehouse_code)},null===e||void 0===e?void 0:e._id)))})},{label:"Note",name:"note",rules:[],component:(0,Y.jsx)(z.A.TextArea,{rows:2,placeholder:"Optional remarks"})},{label:"Total Cost",name:"total_cost",rules:[],component:(0,Y.jsx)(Q.A,{placeholder:"Auto-calculated",disabled:!0,style:{width:"100%"}})}]};var H=a(22671);const{Option:U}=N.A,J=e=>{let{open:t,onClose:a,onSubmit:l,record:i,branchList:r,branchLoading:s,createLoading:d=!1}=e;const[c]=o.A.useForm(),h=((e,t)=>[{name:"branch_id",label:"Branch",rules:[{required:!0,message:"Please select a branch"}],component:(0,Y.jsx)(N.A,{placeholder:"Select branch",loading:t,showSearch:!0,optionFilterProp:"children",children:null===e||void 0===e?void 0:e.map((e=>(0,Y.jsx)(U,{value:e._id,children:e.branch_name},e._id)))})},{name:"added_quantity",label:"Quantity",rules:[{required:!0,message:"Please enter quantity"}],component:(0,Y.jsx)(Q.A,{min:1,style:{width:"100%"}})},{label:"Note",name:"note",rules:[],component:(0,Y.jsx)(z.A.TextArea,{rows:3,placeholder:"Optional notes"})}])(r,s);return(0,n.useEffect)((()=>{t&&c.resetFields()}),[t,c,i]),(0,Y.jsx)(H.A,{title:"Allocate Stock",open:t,onClose:a,width:400,children:(0,Y.jsxs)(o.A,{form:c,layout:"vertical",onFinish:l,initialValues:{},children:[h.map((e=>(0,Y.jsx)(o.A.Item,{name:e.name,label:e.label,rules:e.rules,children:e.component},e.name))),(0,Y.jsx)(o.A.Item,{children:(0,Y.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,disabled:d,loading:d,children:"Allocate"})})]})})},{Option:K}=N.A;var X=a(98350);const Z=e=>{var t;let{open:a,onClose:l,onSubmit:i,record:r,branchList:s,branchLoading:d,loading:c}=e;const[h]=o.A.useForm(),[m,v]=(0,n.useState)(void 0),p=o.A.useWatch("branch_id",h);(0,n.useEffect)((()=>{p&&v(p)}),[p]);const y=(0,n.useMemo)((()=>({branch_id:m,stock_audit_id:null===r||void 0===r?void 0:r._id})),[m,r]),{data:b}=X.lh.useGetBranchStockQuery(y,{skip:!a||!m||!(null!==r&&void 0!==r&&null!==(t=r.ProductItem)&&void 0!==t&&t._id),refetchOnMountOrArgChange:!0}),x=(0,n.useMemo)((()=>{var e;const t=(null===b||void 0===b?void 0:b.result)||[];if(!Array.isArray(t))return 0;const a=null===r||void 0===r||null===(e=r.ProductItem)||void 0===e?void 0:e._id,l=null===r||void 0===r?void 0:r.batch_no,n=m;return t.filter((e=>{var t,o;const i=!n||(null===e||void 0===e?void 0:e.branch_id)===n||(null===e||void 0===e||null===(t=e.Branch)||void 0===t?void 0:t._id)===n,r=!a||(null===e||void 0===e?void 0:e.product)===a||(null===e||void 0===e||null===(o=e.ProductItem)||void 0===o?void 0:o._id)===a,s=!l||(null===e||void 0===e?void 0:e.batch_no)===l;return i&&r&&s})).reduce(((e,t)=>e+(Number(null===t||void 0===t?void 0:t.available_quantity)||0)),0)}),[b,r,m]),g=((e,t,a,l)=>{var n,o,i;return[{name:"branch_id",label:"Branch",rules:[{required:!0,message:"Please select a branch"}],component:(0,Y.jsx)(N.A,{placeholder:"Select branch",loading:t,showSearch:!0,optionFilterProp:"children",onChange:l.onBranchChange,children:null===e||void 0===e?void 0:e.map((e=>(0,Y.jsx)(K,{value:e._id,children:e.branch_name},e._id)))})},{name:"available_stock",label:"Available Stock",rules:[{required:!1,message:"Please enter available stock"}],component:(0,Y.jsx)(Q.A,{min:1,style:{width:"100%"},disabled:!0,value:null!==(n=null!==(o=l.availableQuantity)&&void 0!==o?o:null===a||void 0===a?void 0:a.available_quantity)&&void 0!==n?n:0})},{name:"quantity",label:"Quantity",rules:[{required:!0,message:"Please enter quantity"}],component:(0,Y.jsx)(Q.A,{min:1,max:null!==(i=l.maxQuantity)&&void 0!==i?i:l.availableQuantity,style:{width:"100%"}})}]})(s,d,r,{onBranchChange:e=>{v(e)},availableQuantity:x,maxQuantity:x});return(0,n.useEffect)((()=>{a&&(h.resetFields(),v(void 0))}),[a,h,r]),(0,Y.jsx)(H.A,{title:"Revert Stock",open:a,onClose:l,width:400,children:(0,Y.jsxs)(o.A,{form:h,layout:"vertical",onFinish:i,initialValues:{},children:[g.map((e=>"available_stock"===e.name?(0,Y.jsx)(o.A.Item,{label:e.label,children:e.component},e.name):(0,Y.jsx)(o.A.Item,{name:e.name,label:e.label,rules:e.rules,children:e.component},e.name))),(0,Y.jsx)(o.A.Item,{children:(0,Y.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,loading:c,disabled:c,children:"Revert"})})]})})},{Option:$}=N.A,ee=e=>{let{open:t,onClose:a,onSubmit:l,record:i,loading:r=!1}=e;const[s]=o.A.useForm(),d=(e=>{var t,a,l;return[{name:"stock_audit_id",label:"Stock In Batch",rules:[{required:!0,message:"Please select the stock batch"}],initialValue:null===e||void 0===e?void 0:e._id,component:(0,Y.jsx)(N.A,{disabled:!0,children:(0,Y.jsxs)($,{value:null===e||void 0===e?void 0:e._id,children:[null===e||void 0===e||null===(t=e.ProductItem)||void 0===t?void 0:t.name," - ",null===e||void 0===e||null===(a=e.ProductItem)||void 0===a||null===(l=a.VariantItem)||void 0===l?void 0:l.variant_name," - ",null===e||void 0===e?void 0:e.batch_no]})})},{name:"quantity",label:"Quantity",rules:[{required:!0,message:"Enter quantity to remove"}],component:(0,Y.jsx)(Q.A,{min:1,placeholder:"e.g., 5",style:{width:"100%"}})},{name:"out_reason",label:"Reason",rules:[{required:!0,message:"Please enter the reason"}],component:(0,Y.jsxs)(N.A,{placeholder:"Reason for stock out",children:[(0,Y.jsx)(N.A.Option,{value:"expired",children:"Expired"}),(0,Y.jsx)(N.A.Option,{value:"damaged",children:"Damaged"}),(0,Y.jsx)(N.A.Option,{value:"internal_use",children:"Internal Use"}),(0,Y.jsx)(N.A.Option,{value:"bulk_sale",children:"Bulk Sale"}),(0,Y.jsx)(N.A.Option,{value:"return_to_vendor",children:"Return to Vendor"})]})},{name:"out_date",label:"Out Date",rules:[{required:!0,message:"Please select the date"}],component:(0,Y.jsx)(T.A,{placeholder:"Select Date",style:{width:"100%"}})},{name:"note",label:"Note",rules:[],component:(0,Y.jsx)(z.A.TextArea,{rows:3,placeholder:"Optional note"})}]})(i);return(0,n.useEffect)((()=>{t&&s.resetFields()}),[t,s]),(0,Y.jsx)(H.A,{title:"Stock Out",open:t,onClose:a,width:400,children:(0,Y.jsxs)(o.A,{form:s,layout:"vertical",onFinish:l,children:[d.map((e=>(0,Y.jsx)(o.A.Item,{name:e.name,label:e.label,rules:e.rules,initialValue:e.initialValue,children:e.component},e.name))),(0,Y.jsx)(o.A.Item,{children:(0,Y.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,loading:r,disabled:r,children:"Stockout"})})]})})};var te=a(16874),ae=a(83003);const le=()=>{const e=(0,ae.wA)(),[t]=o.A.useForm(),[a,s]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),[u,h]=(0,n.useState)(!1),[m,v]=(0,n.useState)(null),[p,y]=(0,n.useState)(!1),[b,x]=(0,n.useState)(null),[g,A]=(0,n.useState)(!1),[j,_]=(0,n.useState)(null),{data:f,isLoading:k}=X.lh.useGetProductQuery({}),{data:S,isLoading:w}=X.lh.useGetVendorQuery({}),{data:C,isLoading:I}=X.lh.useGetWarehouseQuery({}),{data:O,isLoading:L}=X.lh.useGetBranchesQuery({}),{data:P,isLoading:q}=X.lh.useGetRackQuery({}),M=(0,n.useMemo)((()=>(null===f||void 0===f?void 0:f.result)||[]),[f]),R=(0,n.useMemo)((()=>(null===S||void 0===S?void 0:S.result)||[]),[S]),B=(0,n.useMemo)((()=>(null===C||void 0===C?void 0:C.result)||[]),[C]),F=(0,n.useMemo)((()=>(null===O||void 0===O?void 0:O.result)||[]),[O]),V=(0,n.useMemo)((()=>(null===P||void 0===P?void 0:P.result)||[]),[P]),[D,{isLoading:N}]=X.lh.useCreateBranchStockMutation(),[z,{isLoading:Q}]=X.lh.useCreateStockOutMutation(),[T,{isLoading:G}]=X.lh.useCreateStockStorageMutation(),[H,{isLoading:U}]=X.lh.useRevertStockFromBranchMutation(),K=t.getFieldValue("quantity"),$=t.getFieldValue("buy_price");(0,n.useEffect)((()=>{K&&$&&t.setFieldsValue({total_cost:K*$})}),[K,$,t]);const le=(0,n.useCallback)((e=>{c(e),s(!0)}),[]),ne=(0,n.useCallback)((async t=>{try{var a;await D((0,l.A)((0,l.A)({},t),{},{stock_audit_id:d._id,product:null===(a=d.ProductItem)||void 0===a?void 0:a._id,batch_no:d.batch_no,mfg_date:d.mfg_date,mrp:d.mrp,expiry_date:d.expiry_date,invoice_id:d.invoice_id,sell_price:d.sell_price})).unwrap(),i.Ay.success("Stock allocated successfully"),e(X.lh.util.invalidateTags(["StockAudit"])),s(!1),c(null)}catch(n){i.Ay.error("Failed to allocate stock")}}),[d,D]),oe=(0,n.useCallback)((e=>{v(e),h(!0)}),[]),ie=(0,n.useCallback)((async t=>{try{await H((0,l.A)((0,l.A)({},t),{},{stock_audit_id:m._id})).unwrap(),i.Ay.success("Stock reverted successfully"),e(X.lh.util.invalidateTags(["StockAudit"])),h(!1),v(null)}catch(a){i.Ay.error("Failed to revert stock")}}),[m,H]),re=(0,n.useCallback)((e=>{x(e),y(!0)}),[]),se=(0,n.useCallback)((async t=>{try{await z((0,l.A)((0,l.A)({},t),{},{stock_audit_id:b._id})).unwrap(),i.Ay.success("Stock out created successfully"),e(X.lh.util.invalidateTags(["StockAudit"])),y(!1),x(null)}catch(a){i.Ay.error("Failed to create stock out")}}),[b,z]),de=(0,n.useCallback)((e=>{_(e),A(!0)}),[]),ce=(0,n.useCallback)((async t=>{try{const a=await T((0,l.A)((0,l.A)({},t),{},{stock_audit_id:null===j||void 0===j?void 0:j._id})).unwrap();if(a&&"object"===typeof a&&"statusCode"in a&&200!==a.statusCode)throw{data:a};i.Ay.success("Storage allocated successfully"),e(X.lh.util.invalidateTags(["StockAudit"])),A(!1),_(null)}catch(n){var a;const e=(null===n||void 0===n||null===(a=n.data)||void 0===a?void 0:a.message)||(null===n||void 0===n?void 0:n.error)||"Failed to allocate storage";i.Ay.error(e)}}),[j,T]),ue=(0,n.useMemo)((()=>({title:"Stock Audit",columns:E({onAllocate:le,onRevert:oe,onStockout:re,onStorageAllocate:de}),formItems:W(M,R,B,k,w,I),entityName:"StockAudit",formColumns:3,drawerWidth:1200})),[le,oe,re,de,M,R,B,k,w,I]);return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(r.r,{config:ue,onValuesChange:(e,t,a)=>{const l=Number((null===t||void 0===t?void 0:t.quantity)||0),n=Number((null===t||void 0===t?void 0:t.buy_price)||0),o={};Number.isNaN(l)||(o.available_quantity=l),Number.isNaN(l)&&Number.isNaN(n)||(o.total_cost=(l||0)*(n||0)),a&&Object.keys(o).length>0&&a.setFieldsValue(o)}}),(0,Y.jsx)(J,{open:a,onClose:()=>s(!1),onSubmit:ne,record:d,branchList:F,branchLoading:L,createLoading:N}),(0,Y.jsx)(Z,{open:u,onClose:()=>h(!1),onSubmit:ie,record:m,branchList:F,branchLoading:L,loading:U}),(0,Y.jsx)(ee,{open:p,onClose:()=>y(!1),onSubmit:se,record:b,loading:Q}),(0,Y.jsx)(te.A,{open:g,onClose:()=>A(!1),onSubmit:ce,record:j,rackList:V,rackLoading:q,createLoading:G})]})}}}]);
//# sourceMappingURL=997.439a4838.chunk.js.map