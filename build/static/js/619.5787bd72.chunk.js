/*! For license information please see 619.5787bd72.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[619],{19619:(e,r,n)=>{n.r(r),n.d(r,{default:()=>w});var s=n(89379),c=n(65043),a=n(83833),t=n(26553),i=n(16569),l=n(6051),d=n(76399),o=n(32513),h=n(89073),u=n(96651),g=n(95206),x=n(91686),_=n(39249),A=n(46237),p=n(89967),j=n(90617),y=n(88143),f=n(93259),m=n(70579);const{Title:v,Text:k}=a.A,{Option:b}=t.A,w=()=>{const[e,r]=(0,c.useState)([]),[n,a]=(0,c.useState)(""),[w,C]=(0,c.useState)({}),[z,S]=(0,c.useState)(!1),[E,I]=(0,c.useState)(!1);(0,c.useEffect)((()=>{R()}),[]),(0,c.useEffect)((()=>{n&&O(n)}),[n]);const R=async()=>{S(!0);try{const e=await(0,f.A)({method:"GET",endpoint:"/roles"});if(200===e.statusCode){const n=e.result||[];r(n)}else i.Ay.error("Failed to fetch roles: ".concat(e.message||"Unknown error"))}catch(e){console.error("Error fetching roles:",e),i.Ay.error("Error fetching roles")}finally{S(!1)}},O=async e=>{S(!0);try{const n=await(0,f.A)({method:"GET",endpoint:"/permissions/role/".concat(e)});if(200===n.statusCode){var r;const e=(null===(r=n.result)||void 0===r?void 0:r.resources)||[];if(0===e.length)return i.Ay.warning("No permissions found for this role. Please seed permissions first."),void C({});const s={};e.forEach((e=>{s[e.resource]={resource:e.resource,can_create:e.can_create,can_read:e.can_read,can_update:e.can_update,can_delete:e.can_delete,allowed_menu_keys:e.allowed_menu_keys||[]}})),C(s)}else i.Ay.error("Failed to fetch permissions: ".concat(n.message||"Unknown error"))}catch(n){console.error("Error fetching permissions:",n),i.Ay.error("Error fetching permissions")}finally{S(!1)}},P=(e,r,n)=>{C((c=>(0,s.A)((0,s.A)({},c),{},{[e]:(0,s.A)((0,s.A)({},c[e]),{},{[r]:n})})))},V=(e,r)=>{const n=(0,s.A)({},w);Object.keys(n).forEach((c=>{n[c]=(0,s.A)((0,s.A)({},n[c]),{},{[e]:r})})),C(n)},B=[{title:"Resource",dataIndex:"resource",key:"resource",width:250,fixed:"left",render:e=>(0,m.jsxs)(l.A,{children:[(0,m.jsx)(k,{strong:!0,children:N(e)}),(0,m.jsx)(d.A,{color:"blue",children:e})]})},{title:(0,m.jsxs)(l.A,{direction:"vertical",size:0,align:"center",children:[(0,m.jsx)(k,{children:"Create"}),(0,m.jsx)(o.A,{onChange:e=>V("can_create",e.target.checked),disabled:!n,children:(0,m.jsx)(k,{type:"secondary",style:{fontSize:11},children:"All"})})]}),dataIndex:"can_create",key:"can_create",align:"center",width:100,render:(e,r)=>(0,m.jsx)(o.A,{checked:e,onChange:e=>P(r.resource,"can_create",e.target.checked),disabled:!n})},{title:(0,m.jsxs)(l.A,{direction:"vertical",size:0,align:"center",children:[(0,m.jsx)(k,{children:"Read"}),(0,m.jsx)(o.A,{onChange:e=>V("can_read",e.target.checked),disabled:!n,children:(0,m.jsx)(k,{type:"secondary",style:{fontSize:11},children:"All"})})]}),dataIndex:"can_read",key:"can_read",align:"center",width:100,render:(e,r)=>(0,m.jsx)(o.A,{checked:e,onChange:e=>P(r.resource,"can_read",e.target.checked),disabled:!n})},{title:(0,m.jsxs)(l.A,{direction:"vertical",size:0,align:"center",children:[(0,m.jsx)(k,{children:"Update"}),(0,m.jsx)(o.A,{onChange:e=>V("can_update",e.target.checked),disabled:!n,children:(0,m.jsx)(k,{type:"secondary",style:{fontSize:11},children:"All"})})]}),dataIndex:"can_update",key:"can_update",align:"center",width:100,render:(e,r)=>(0,m.jsx)(o.A,{checked:e,onChange:e=>P(r.resource,"can_update",e.target.checked),disabled:!n})},{title:(0,m.jsxs)(l.A,{direction:"vertical",size:0,align:"center",children:[(0,m.jsx)(k,{children:"Delete"}),(0,m.jsx)(o.A,{onChange:e=>V("can_delete",e.target.checked),disabled:!n,children:(0,m.jsx)(k,{type:"secondary",style:{fontSize:11},children:"All"})})]}),dataIndex:"can_delete",key:"can_delete",align:"center",width:100,render:(e,r)=>(0,m.jsx)(o.A,{checked:e,onChange:e=>P(r.resource,"can_delete",e.target.checked),disabled:!n})},{title:"Summary",key:"summary",align:"center",width:120,render:(e,r)=>{const n=w[r.resource],s=[null===n||void 0===n?void 0:n.can_create,null===n||void 0===n?void 0:n.can_read,null===n||void 0===n?void 0:n.can_update,null===n||void 0===n?void 0:n.can_delete].filter(Boolean).length;return(0,m.jsx)(l.A,{children:4===s?(0,m.jsx)(d.A,{color:"success",icon:(0,m.jsx)(A.A,{}),children:"Full Access"}):0===s?(0,m.jsx)(d.A,{color:"error",icon:(0,m.jsx)(p.A,{}),children:"No Access"}):(0,m.jsxs)(d.A,{color:"processing",children:[s,"/4"]})})}}],N=e=>e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "),T=Object.entries(w).map((e=>{let[r,n]=e;return{key:r,resource:r,can_create:n.can_create,can_read:n.can_read,can_update:n.can_update,can_delete:n.can_delete}})),L=e.find((e=>e._id===n));return(0,m.jsx)("div",{className:"permission-management",children:(0,m.jsx)(h.A,{title:(0,m.jsx)(l.A,{children:(0,m.jsx)(v,{level:4,style:{margin:0},children:"Permission Management"})}),extra:(0,m.jsxs)(l.A,{children:[(0,m.jsx)(u.A,{title:"Refresh",children:(0,m.jsx)(g.Ay,{icon:(0,m.jsx)(j.A,{}),onClick:()=>{R(),n&&O(n)},children:"Refresh"})}),(0,m.jsx)(g.Ay,{type:"primary",icon:(0,m.jsx)(y.A,{}),onClick:async()=>{if(n){I(!0);try{const e=Object.entries(w).map((e=>{let[r,n]=e;return{resource:r,can_create:n.can_create||!1,can_read:n.can_read||!1,can_update:n.can_update||!1,can_delete:n.can_delete||!1}})),r=await(0,f.A)({method:"POST",endpoint:"/permissions/bulk",data:{role_id:n,permissions:e}});200===r.statusCode?(i.Ay.success("Permissions updated successfully"),O(n)):i.Ay.error(r.message||"Failed to update permissions")}catch(s){var e,r;console.error("Error saving permissions:",s),i.Ay.error((null===s||void 0===s||null===(e=s.response)||void 0===e||null===(r=e.data)||void 0===r?void 0:r.exception)||"Error saving permissions")}finally{I(!1)}}else i.Ay.warning("Please select a role first")},loading:E,disabled:!n,children:"Save Changes"})]}),children:(0,m.jsxs)(l.A,{direction:"vertical",size:"large",style:{width:"100%"},children:[(0,m.jsxs)("div",{children:[(0,m.jsx)(k,{strong:!0,style:{marginRight:8},children:"Select Role:"}),(0,m.jsx)(t.A,{style:{width:300},placeholder:"Choose a role to manage permissions",value:n||void 0,onChange:a,loading:z,children:e.map((e=>(0,m.jsx)(b,{value:e._id,children:(0,m.jsxs)(l.A,{children:[(0,m.jsx)(k,{children:e.name}),(0,m.jsx)(d.A,{color:"blue",children:e.roles_type})]})},e._id)))}),L&&(0,m.jsx)(k,{type:"secondary",style:{marginLeft:12},children:L.description})]}),(0,m.jsx)(x.A,{spinning:z,children:(0,m.jsx)(_.A,{columns:B,dataSource:T,pagination:!1,scroll:{x:800,y:500},bordered:!0,size:"small",locale:{emptyText:n?"No permissions found for this role":"Please select a role to view permissions"}})}),n&&T.length>0&&(0,m.jsx)(h.A,{size:"small",style:{background:"#f5f5f5"},children:(0,m.jsxs)(l.A,{size:"large",children:[(0,m.jsxs)(k,{children:[(0,m.jsx)(k,{strong:!0,children:"Total Resources:"})," ",T.length]}),(0,m.jsxs)(k,{children:[(0,m.jsx)(k,{strong:!0,children:"Full Access:"})," ",T.filter((e=>e.can_create&&e.can_read&&e.can_update&&e.can_delete)).length]}),(0,m.jsxs)(k,{children:[(0,m.jsx)(k,{strong:!0,children:"No Access:"})," ",T.filter((e=>!e.can_create&&!e.can_read&&!e.can_update&&!e.can_delete)).length]}),(0,m.jsxs)(k,{children:[(0,m.jsx)(k,{strong:!0,children:"Partial Access:"})," ",T.filter((e=>[e.can_create,e.can_read,e.can_update,e.can_delete].filter(Boolean).length>0&&!(e.can_create&&e.can_read&&e.can_update&&e.can_delete))).length]})]})})]})})})}},88143:(e,r,n)=>{n.d(r,{A:()=>l});var s=n(65043);const c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};var a=n(66381);function t(){return t=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},t.apply(this,arguments)}const i=(e,r)=>s.createElement(a.A,t({},e,{ref:r,icon:c}));const l=s.forwardRef(i)}}]);
//# sourceMappingURL=619.5787bd72.chunk.js.map