{"version":3,"file":"static/js/8485.a2b60a3d.chunk.js","mappings":"yaAQA,MAAM,OAAEA,GAAWC,EAAAA,EAmcnB,EAxa8DC,IAKvD,IALwD,QAC7DC,EACAC,SAAUC,EAAgB,SAC1BC,EAAQ,SACRC,GACDL,EACC,MAAOM,EAAYC,IAAiBC,EAAAA,EAAAA,UAAS,KACtCC,EAAiBC,IAAsBF,EAAAA,EAAAA,UAAS,KAChDG,EAAMC,IAAWJ,EAAAA,EAAAA,UAAS,IAC1BK,EAAaC,IAAkBN,EAAAA,EAAAA,UAAoB,KACnDO,EAASC,IAAcR,EAAAA,EAAAA,WAAS,IAChCS,EAAgBC,IAAqBV,EAAAA,EAAAA,UAA2B,OAChEW,EAAkBC,IAAuBZ,EAAAA,EAAAA,UAAiB,IAC1Da,EAAgBC,IAAqBd,EAAAA,EAAAA,WAAS,GAC/Ce,GAAiBC,EAAAA,EAAAA,QAAiB,MAClCC,GAAmBD,EAAAA,EAAAA,QAA8B,MACjDE,GAAmBF,EAAAA,EAAAA,SAAO,GAG1BG,GAAqBxB,GAAgD,IAA5BA,EAAiByB,QAGxDC,KAAMC,EAAcC,UAAWC,GAAYC,EAAAA,GAASC,mBAAmB,CAC7EC,aAAc1B,EACd2B,WAAYzB,EACZ0B,UAAW,IACV,CACDC,MAAOrC,IAAY0B,EACnBY,2BAA2B,KAI7BC,EAAAA,EAAAA,YAAU,KAER,GAAKvC,GAAY0B,GAEbG,EAAc,CAAC,IAADW,EAAAC,EAChB,MAAMC,GAAwB,OAAZb,QAAY,IAAZA,OAAY,EAAZA,EAAsBc,SAAU,GAC5CC,GAA6C,QAAhCJ,EAACX,EAAqBgB,kBAAU,IAAAL,OAAA,EAAhCA,EAAkCI,cAA8C,QAApCH,EAAKZ,EAAqBgB,kBAAU,IAAAJ,OAAA,EAAhCA,EAAkCK,QAAS,EAEjG,IAATpC,GACFG,EAAe6B,GACf3B,EAAW2B,EAASf,OAASiB,GAAcF,EAASf,OAAS,IAE7Dd,GAAekC,IACb,MAAMC,EAAc,IAAIC,IAAIF,EAAKG,KAAKC,GAAcA,EAAKC,OACnDC,EAAiBX,EAASY,QAAQH,IAAeH,EAAYO,IAAIJ,EAAKC,OACtEI,EAAU,IAAIT,KAASM,GAE7B,OADAtC,EAAWyC,EAAQ7B,OAASiB,GAAcS,EAAe1B,OAAS,GAC3D6B,KAIX/B,EAAiBgC,SAAU,CAC7B,IACC,CAAC5B,EAAcnB,EAAMgB,EAAmB1B,IAG3C,MAAM0D,EAAiBxD,GAAoBU,EAGrC+C,GAA4C,OAAdD,QAAc,IAAdA,OAAc,EAAdA,EAAgBJ,QAAQM,IAAgB,IAADC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EACzE,IAAK9D,EAAY,OAAO,EACxB,MAAM+D,EAAc/D,EAAWgE,cAC/B,QACS,QAANR,EAAAD,EAAEU,YAAI,IAAAT,OAAA,EAANA,EAAQQ,gBAAiB,IAAIE,SAASH,MACjC,QAALN,EAAAF,EAAEY,WAAG,IAAAV,OAAA,EAALA,EAAOO,gBAAiB,IAAIE,SAASH,KACzB,QADqCL,EAClDH,EAAEa,mBAAW,IAAAV,GAAc,QAAdC,EAAbD,EAAeW,oBAAY,IAAAV,OAAd,EAAbA,EAA6BK,cAAcE,SAASH,MACvC,QADmDH,EAChEL,EAAEa,mBAAW,IAAAR,GAAc,QAAdC,EAAbD,EAAeU,oBAAY,IAAAT,OAAd,EAAbA,EAA6BG,cAAcE,SAASH,OACpC,QAAfD,EAAAP,EAAEgB,qBAAa,IAAAT,OAAA,EAAfA,EAAiBU,aAAc,IAAIN,SAASH,MAE9CU,MAAK,CAACC,EAAYC,KAAgB,IAADC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAElC,MAAM5B,EAAc/D,EAAWgE,cAGzB4B,IAAqB,QAANhB,EAAAF,EAAET,YAAI,IAAAW,OAAA,EAANA,EAAQZ,gBAAiB,MAAQD,IACrB,QAAbc,EAAAH,EAAEN,mBAAW,IAAAS,GAAc,QAAdC,EAAbD,EAAeR,oBAAY,IAAAS,OAAd,EAAbA,EAA6Bd,iBAAkBD,KACzC,QAALgB,EAAAL,EAAEP,WAAG,IAAAY,OAAA,EAALA,EAAOf,gBAAiB,MAAQD,EAC/C8B,IAAqB,QAANb,EAAAL,EAAEV,YAAI,IAAAe,OAAA,EAANA,EAAQhB,gBAAiB,MAAQD,IACrB,QAAbkB,EAAAN,EAAEP,mBAAW,IAAAa,GAAc,QAAdC,EAAbD,EAAeZ,oBAAY,IAAAa,OAAd,EAAbA,EAA6BlB,iBAAkBD,KACzC,QAALoB,EAAAR,EAAER,WAAG,IAAAgB,OAAA,EAALA,EAAOnB,gBAAiB,MAAQD,EAErD,GAAI6B,IAAgBC,EAAa,OAAQ,EACzC,IAAKD,GAAeC,EAAa,OAAO,EAGxC,MAAMC,IAAqB,QAANV,EAAAV,EAAET,YAAI,IAAAmB,OAAA,EAANA,EAAQpB,gBAAiB,IAAI+B,WAAWhC,KAC5B,QADwCsB,EACrDX,EAAEN,mBAAW,IAAAiB,GAAc,QAAdC,EAAbD,EAAehB,oBAAY,IAAAiB,OAAd,EAAbA,EAA6BtB,cAAc+B,WAAWhC,OAChD,QAALwB,EAAAb,EAAEP,WAAG,IAAAoB,OAAA,EAALA,EAAOvB,gBAAiB,IAAI+B,WAAWhC,GACtDiC,IAAqB,QAANR,EAAAb,EAAEV,YAAI,IAAAuB,OAAA,EAANA,EAAQxB,gBAAiB,IAAI+B,WAAWhC,KAC5B,QADwC0B,EACrDd,EAAEP,mBAAW,IAAAqB,GAAc,QAAdC,EAAbD,EAAepB,oBAAY,IAAAqB,OAAd,EAAbA,EAA6B1B,cAAc+B,WAAWhC,OAChD,QAAL4B,EAAAhB,EAAER,WAAG,IAAAwB,OAAA,EAALA,EAAO3B,gBAAiB,IAAI+B,WAAWhC,GAE5D,OAAI+B,IAAgBE,GAAqB,GACpCF,GAAeE,EAAoB,EAEjC,OACH,IAGN9D,EAAAA,EAAAA,YAAU,KACR,GAAKb,GAAsB1B,GAGvBK,IAAeG,EAcnB,OAZIgB,EAAiBiC,SACnB6C,aAAa9E,EAAiBiC,SAGhCjC,EAAiBiC,QAAU8C,YAAW,KACpC9F,EAAmBJ,GACnBM,EAAQ,GACRE,EAAe,IACfE,GAAW,GACXU,EAAiBgC,SAAU,IAC1B,KAEI,KACDjC,EAAiBiC,SACnB6C,aAAa9E,EAAiBiC,YAGjC,CAACpD,EAAYG,EAAiBkB,EAAmB1B,KAEpDuC,EAAAA,EAAAA,YAAU,KACRpB,EAAoB,GAChBwC,EAAiBhC,OAAS,EAC5BV,EAAkB0C,EAAiB,GAAGP,KAEtCnC,EAAkB,QAEnB,CAACZ,EAAYsD,EAAiBhC,UAGjCY,EAAAA,EAAAA,YAAU,KACJvC,GACFuG,YAAW,KAAO,IAADC,EACO,QAAtBA,EAAAlF,EAAemC,eAAO,IAAA+C,GAAtBA,EAAwBC,UACvB,KAGC/E,IACFf,EAAQ,GACRI,GAAW,GACXU,EAAiBgC,SAAU,KAG7BnD,EAAc,IACVoB,IACFjB,EAAmB,IACnBE,EAAQ,GACRE,EAAe,IACfE,GAAW,GACXU,EAAiBgC,SAAU,MAI9B,CAACzD,IAEJ,MAAM0G,EAAiC,CACrC,CACEC,MAAO,oBACPC,UAAW,OACXC,IAAK,OACLC,MAAO,IACPC,OAAQA,CAACzC,EAAM0C,KAAM,IAAAC,EAAAC,EAAA,OACnBC,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEC,WAAY,IAAKC,MAAO,WAAYJ,SAAE9C,KACjC,QAAlB2C,EAAAD,EAAOvC,mBAAW,IAAAwC,OAAA,EAAlBA,EAAoBvC,gBACnByC,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEG,SAAU,OAAQD,MAAO,UAAWE,UAAW,OAAQN,SAAA,CAAC,YAC1DJ,EAAOvC,YAAYC,cACV,QAAlBwC,EAAAF,EAAOvC,mBAAW,IAAAyC,OAAA,EAAlBA,EAAoBvC,gBACnBwC,EAAAA,EAAAA,MAAA,QAAMG,MAAO,CAAEK,WAAY,MAAOH,MAAO,UAAWC,SAAU,QAASL,SAAA,CAAC,IACpEJ,EAAOvC,YAAYE,aAAa,eAQhD,CAAEgC,MAAO,UAAWC,UAAW,cAAeC,IAAK,UAAWC,MAAO,IACnEC,OAASa,GAAmB,OAAPA,QAAO,IAAPA,GAAAA,EAASlD,cAC5B2C,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAEE,MAAO,UAAWD,WAAY,KAAMH,SAAEQ,EAAQlD,gBAE7D2C,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAEE,MAAO,UAAWK,UAAW,UAAWT,SAAC,gBAE5D,CAAET,MAAO,MAAOC,UAAW,MAAOC,IAAK,MAAOC,MAAO,KACrD,CAAEH,MAAO,QAASC,UAAW,gBAAiBC,IAAK,gBAAiBC,MAAO,IACzEC,OAASe,IACPX,EAAAA,EAAAA,MAAA,QAAMG,MAAO,CACXE,MAAO,UACPD,WAAY,IACZE,SAAU,QACVL,SAAA,CAAC,UACM,OAALU,QAAK,IAALA,OAAK,EAALA,EAAOC,QAAQ,KAAM,YAKzBC,EAAmBC,IACvB9H,EAAS8H,IAmEX,OACEd,EAAAA,EAAAA,MAACe,EAAAA,EAAK,CACJvB,MAAM,kDACNwB,KAAMnI,EACNI,SAAUA,EACV0G,MAAO,IACPsB,OAAQ,KACRC,gBAAc,EAAAjB,SAAA,EAEdD,EAAAA,EAAAA,MAAA,OAAKmB,QAbgBC,KAAO,IAADC,EACP,QAAtBA,EAAAlH,EAAemC,eAAO,IAAA+E,GAAtBA,EAAwB/B,SAYSW,SAAA,EAC7BD,EAAAA,EAAAA,MAACsB,EAAAA,EAAMC,QAAO,CAACpB,MAAO,CAAEqB,aAAc,GAAI7B,MAAO,QAASM,SAAA,EACxDC,EAAAA,EAAAA,KAACxH,EAAM,CACL+I,IAAKtH,EACLuH,YAAY,wGACZC,SAAUC,GAAKzI,EAAcyI,EAAEC,OAAOC,OACtC3B,MAAO,CAAE4B,KAAM,GACfC,WAAS,EACTC,UAvDmBL,IAGC,IAADM,EAF3B,GAAK1F,EAAiBhC,OAEtB,GAAc,cAAVoH,EAAElC,IACJkC,EAAEO,iBACFnI,GAAoB4B,IAClB,MAAMwG,EAAOC,KAAKC,IAAI1G,EAAO,EAAGY,EAAiBhC,OAAS,GAE1D,OADAV,EAAkB0C,EAAiB4F,GAAMnG,KAClCmG,KAGa,QAAtBF,EAAA/H,EAAemC,eAAO,IAAA4F,GAAtBA,EAAwB5C,aACnB,GAAc,YAAVsC,EAAElC,IAAmB,CAAC,IAAD6C,EAC9BX,EAAEO,iBACFnI,GAAoB4B,IAClB,MAAM4G,EAAYH,KAAKI,IAAI7G,EAAO,EAAG,GAErC,OADA9B,EAAkB0C,EAAiBgG,GAAWvG,KACvCuG,KAGa,QAAtBD,EAAApI,EAAemC,eAAO,IAAAiG,GAAtBA,EAAwBjD,OAC1B,MAAO,GAAc,UAAVsC,EAAElC,IAAiB,CAC5BkC,EAAEO,iBACF,MAAMO,EAAkBlG,EAAiBzC,GACrC2I,GACF7B,EAAgB6B,EAEpB,KAAqB,WAAVd,EAAElC,MACXkC,EAAEO,iBACFlJ,MA2BM0J,OAAQA,KAENvD,YAAW,KACK,IAADwD,EAAT/J,IACoB,QAAtB+J,EAAAzI,EAAemC,eAAO,IAAAsG,GAAtBA,EAAwBtD,WAEzB,KAELwC,MAAO5I,KAETgH,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLC,KAAK,UACLC,MAAM7C,EAAAA,EAAAA,KAAC8C,EAAAA,EAAY,IACnB7B,QAASA,IAAMjH,GAAkB,GACjCiG,MAAO,CAAE8C,SAAU,KAAMhD,SAC1B,YAIF1F,GACCyF,EAAAA,EAAAA,MAAA,OACEkD,SAAWtB,IACT,MAAMC,EAASD,EAAEuB,cACXC,EAAYvB,EAAOuB,UACnBC,EAAexB,EAAOwB,cAEFD,EADLvB,EAAOyB,cAC0BD,EAE/B,IAAO1J,IAAYiB,IAAYN,EAAiBgC,UACrEhC,EAAiBgC,SAAU,EAC3B9C,GAAQoC,GAAQA,EAAO,MAG3BuE,MAAO,CAAEoD,UAAW,IAAKC,UAAW,QAASvD,SAAA,EAE7CC,EAAAA,EAAAA,KAACuD,EAAAA,EAAK,CACJC,WAAYlH,EACZ+C,QAASA,EACT3E,QAASA,GAAuC,IAA5B4B,EAAiBhC,OACrCmJ,OAAO,MACPC,KAAK,QACLlI,YAAY,EACZmI,MAAOA,CAAChE,EAAQiE,KAAG,CACjB3C,QAASA,KACPN,EAAgBhB,GAChBT,YAAW,KAAO,IAAD2E,EACO,QAAtBA,EAAA5J,EAAemC,eAAO,IAAAyH,GAAtBA,EAAwBzE,UACvB,KAEL0E,cAAeA,IAAMnD,EAAgBhB,GACrCoE,UACEH,IAAQ/J,EACJ,uCACA,gBACNoG,MAAO,CACL+D,gBAAiBJ,IAAQ/J,EAAmB,eAAYoK,EACxDC,OAAQN,IAAQ/J,EAAmB,yBAAsBoK,KAG7DE,aAAc,CACZvB,KAAM,QACNwB,gBAAiBzK,EAAiB,CAACA,GAAkB,GACrD8H,SAAU4C,IACRzK,EAAkByK,EAAK,IACvB,MAAMT,EAAMtH,EAAiBgI,WAAU/H,GAAKA,EAAER,MAAQsI,EAAK,MAC9C,IAATT,GAAY9J,EAAoB8J,KAGxCW,OAAQ,CAAEC,OAAGP,KAEdxK,GAAW6C,EAAiBhC,OAAS,IACpC0F,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEwE,UAAW,SAAUC,QAAS,MAAOvE,MAAO,OAAQwE,UAAW,qBAAsB5E,SAChGrF,EAAU,kBAAoB,iCAKrCsF,EAAAA,EAAAA,KAACuD,EAAAA,EAAK,CACJC,WAAYlH,EACZ+C,QAASA,EACT3E,SAAS,EACT+I,OAAO,MACPC,KAAK,QACLlI,YAAY,EACZmI,MAAOA,CAAChE,EAAQiE,KAAG,CACjB3C,QAASA,KACPN,EAAgBhB,GAChBT,YAAW,KAAO,IAAD0F,EACO,QAAtBA,EAAA3K,EAAemC,eAAO,IAAAwI,GAAtBA,EAAwBxF,UACvB,KAEL0E,cAAeA,IAAMnD,EAAgBhB,GACrCoE,UACEH,IAAQ/J,EACJ,uCACA,gBACNoG,MAAO,CACL+D,gBAAiBJ,IAAQ/J,EAAmB,eAAYoK,EACxDC,OAAQN,IAAQ/J,EAAmB,yBAAsBoK,KAG7DE,aAAc,CACZvB,KAAM,QACNwB,gBAAiBzK,EAAiB,CAACA,GAAkB,GACrD8H,SAAU4C,IACRzK,EAAkByK,EAAK,IACvB,MAAMT,EAAMtH,EAAiBgI,WAAU/H,GAAKA,EAAER,MAAQsI,EAAK,MAC9C,IAATT,GAAY9J,EAAoB8J,KAGxCW,OAAQ,CAAEC,EAAG,QAGjB1E,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEI,UAAW,GAAID,SAAU,OAAQD,MAAO,QAASJ,SAAA,EAC7DC,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,wBAA4B,kEACpCC,EAAAA,EAAAA,KAAA,UACAA,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,YAAgB,8CACxBC,EAAAA,EAAAA,KAAA,UACAA,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,qBAAyB,mDACjCC,EAAAA,EAAAA,KAAA,UACAA,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,SAAa,oEAKzBC,EAAAA,EAAAA,KAAC6E,EAAAA,EAAc,CACblM,QAASoB,EACT+K,QAASA,IAAM9K,GAAkB,GACjC+K,OAjNqBC,IACzB/L,EAAc+L,GACdhL,GAAkB,GAGlB,MAAMiL,EAA6B,OAAd5I,QAAc,IAAdA,OAAc,EAAdA,EAAgB6I,MAAM3I,IAAgB,IAAD4I,EAAAC,EAAAC,EAAAC,EACxD,MAAMvI,EAAciI,EAAQhI,cAC5B,QACQ,QAALmI,EAAA5I,EAAEY,WAAG,IAAAgI,OAAA,EAALA,EAAOnI,gBAAiB,IAAIE,SAASH,MAC/B,QAANqI,EAAA7I,EAAEU,YAAI,IAAAmI,OAAA,EAANA,EAAQpI,gBAAiB,IAAIE,SAASH,KAC1B,QADsCsI,EACnD9I,EAAEa,mBAAW,IAAAiI,GAAc,QAAdC,EAAbD,EAAe/H,oBAAY,IAAAgI,OAAd,EAAbA,EAA6BtI,cAAcE,SAASH,OAIpDkI,GAEF/F,YAAW,KACTpG,EAASmM,KACR,KACHM,EAAAA,GAAQC,QAAQ,kBAADC,OAAmBR,EAAahI,QAE/CsI,EAAAA,GAAQG,QAAQ,kCAADD,OAAmCT,KA6LhD1F,MAAM,uBACNqG,YAAY,mD,sECvbpB,MAAQnN,OAAO,GAAIC,EAAAA,EAojBnB,EAjiB0DC,IAKnD,IALoD,QACzDC,EAAO,SACPG,EAAQ,SACRC,EAAQ,UACR6M,GACDlN,EAEC,MAAMmN,GAAWC,EAAAA,EAAAA,kBACXC,EAAYC,EAAAA,EAAyBC,QAAQ,SAC7CC,IACK,OAATH,QAAS,IAATA,OAAS,EAATA,EAAWI,YACH,OAARN,QAAQ,IAARA,OAAQ,EAARA,EAAUO,aACF,OAARP,QAAQ,IAARA,OAAQ,EAARA,EAAUQ,YACF,OAARR,QAAQ,IAARA,OAAQ,EAARA,EAAUS,YACV,IACAtJ,cACIuJ,EAAkC,qBAAbL,EACrBM,EAA4B,eAAbN,EAGfO,IAAgBb,KAAejN,GAG7B4B,KAAMmM,EAAejM,UAAWkM,GACtChM,EAAAA,GAASiM,sBACP,CAAEC,WAAYjB,GACd,CACE5K,MAAOyL,IAAgBF,EACvBtL,2BAA2B,EAC3B6L,gBAAgB,EAChBC,oBAAoB,KAKlBxM,KAAMyM,EAAkBvM,UAAWwM,GACzCtM,EAAAA,GAASuM,uBACP,CAAEL,WAAYjB,GACd,CACE5K,MAAOyL,IAAgBD,EACvBvL,2BAA2B,EAC3B6L,gBAAgB,EAChBC,oBAAoB,IAIpBI,GACHZ,EACiB,OAAbG,QAAa,IAAbA,OAAa,EAAbA,EAAuBpL,OACxBkL,EACiB,OAAhBQ,QAAgB,IAAhBA,OAAgB,EAAhBA,EAA0B1L,OAC3B,KAAO,GAEPZ,EAAUiM,GAAcM,GAEvBjO,EAAYC,IAAiBC,EAAAA,EAAAA,UAAS,KACtCS,EAAgBC,IAAqBV,EAAAA,EAAAA,UAA2B,OAChEW,EAAkBC,IAAuBZ,EAAAA,EAAAA,UAAiB,IAC1DkO,EAAcC,IAAmBnO,EAAAA,EAAAA,UAAiB,IACnDoO,GAAepN,EAAAA,EAAAA,QAAuB,MACtCD,GAAiBC,EAAAA,EAAAA,QAAiB,MAGlCqN,EAAkBC,MACZA,EAAMC,cAAeC,IAAMF,EAAMC,aAAaE,SAASD,QAI7DE,EAAqBJ,GAClBA,EAAMK,oBAAsB,EAI/BC,EAAyBN,IAC7B,MAAMO,EAAaL,IAAMF,EAAMC,aAAaO,OAAO,cAC7CC,EAAQ,qDAAAxC,OAAwDsC,EAAU,uCAChFV,EAAgBY,GAChB1C,EAAAA,GAAQ2C,MAAMD,GAGd/I,YAAW,KACTmI,EAAgB,MACf,MAICc,EAAuBX,IAC3B,MAAMS,EAAQ,2HACdZ,EAAgBY,GAChB1C,EAAAA,GAAQ2C,MAAMD,GAGd/I,YAAW,KACTmI,EAAgB,MACf,MAkBCe,GAdHC,MAAMC,QAAQnB,GAAUA,EAAS,IAAIlL,QAAQsM,IAAc,IAADC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EACzD,MAAMhM,EAAc/D,EAAWgE,cAC/B,OACY,QAAVwL,EAAAD,EAAES,gBAAQ,IAAAR,OAAA,EAAVA,EAAYxL,cAAcE,SAASH,MACtB,QADkC0L,EAC/CF,EAAEU,mBAAW,IAAAR,GAAM,QAANC,EAAbD,EAAexL,YAAI,IAAAyL,OAAN,EAAbA,EAAqB1L,cAAcE,SAASH,MAC/B,QAD2C4L,EACxDJ,EAAEU,mBAAW,IAAAN,GAAa,QAAbC,EAAbD,EAAevL,mBAAW,IAAAwL,GAAc,QAAdC,EAA1BD,EAA4BvL,oBAAY,IAAAwL,OAA3B,EAAbA,EACI7L,cACDE,SAASH,MACQ,QADI+L,EACxBP,EAAEV,0BAAkB,IAAAiB,OAAA,EAApBA,EAAsBtL,WAAWN,SAASH,MAC9B,QAD0CgM,EACtDR,EAAEW,kBAAU,IAAAH,OAAA,EAAZA,EAAcvL,WAAWN,SAASH,QAOxC7B,EAAAA,EAAAA,YAAU,KAGR,GAFApB,EAAoB,GACpBuN,EAAgB,IACZe,EAAU9N,OAAS,EAAG,CAExB,IAAI6O,EAAkB,EACtB,KACEA,EAAkBf,EAAU9N,SAC1B8N,EAAUe,GAAiB1B,aAC3BC,IAAMU,EAAUe,GAAiB1B,aAAaE,SAASD,QACvDU,EAAUe,GAAiBtB,oBAAsB,IAEnDsB,IAEEA,EAAkBf,EAAU9N,QAC9BV,EAAkBwO,EAAUe,GAAiBpN,KAC7CjC,EAAoBqP,IAEpBvP,EAAkB,KAEtB,MACEA,EAAkB,QAEnB,CAACZ,EAAYL,EAASwO,KAEzBjM,EAAAA,EAAAA,YAAU,KACJvC,IACF0O,EAAgB,IAChBnI,YAAW,KAAO,IAADC,EACO,QAAtBA,EAAAlF,EAAemC,eAAO,IAAA+C,GAAtBA,EAAwBC,UACvB,MAEJ,CAACzG,KAEJuC,EAAAA,EAAAA,YAAU,KACR,GAAIoM,EAAalL,QAAS,CAAC,IAADgN,EACxB,MAAMC,EAAM/B,EAAalL,QAAQkN,cAAc,gCAAD7D,OACe,QADf2D,EACZhB,EAAUvO,UAAiB,IAAAuP,OAAA,EAA3BA,EAA6BrN,IAAG,OAE/D,OAAHsN,QAAG,IAAHA,GAAAA,EAAKE,eAAe,CAAEC,MAAO,WAC/B,IACC,CAAC3P,EAAkBuO,IAMtB,MAAM/I,EAA+B,CACnC,CACEC,MAAO,UACPC,UAAW,cACXC,IAAK,UACLE,OAASuJ,IAAgC,OAAXA,QAAW,IAAXA,OAAW,EAAXA,EAAahM,OAAQ,OAErD,CACEqC,MAAO,UACPC,UAAW,cACXC,IAAK,UACLE,OAASuJ,IAAgB,IAAAQ,EAAA,OACZ,OAAXR,QAAW,IAAXA,GAAwB,QAAbQ,EAAXR,EAAa7L,mBAAW,IAAAqM,OAAb,EAAXA,EAA0BpM,eAAgB,QAE9C,CAAEiC,MAAO,WAAYC,UAAW,WAAYC,IAAK,YACjD,CACEF,MAAO,YACPC,UAAW,qBACXC,IAAK,qBACLE,OAAQA,CAACmI,EAA4BlI,KACnC,MAAM+J,EAAe7B,GAAsB,EAC3C,OACE/H,EAAAA,EAAAA,MAAA,QACEG,MAAO,CACLE,MAAOuJ,EAAe,UAAY,UAClCxJ,WAAYwJ,EAAe,OAAS,UACpC3J,SAAA,CAED8H,EACA6B,IACC1J,EAAAA,EAAAA,KAAC2J,EAAAA,EAAyB,CACxB1J,MAAO,CAAEK,WAAY,EAAGH,MAAO,kBAO3C,CAAEb,MAAO,QAASC,UAAW,aAAcC,IAAK,cAChD,CACEF,MAAO,cACPC,UAAW,cACXC,IAAK,cACLE,OAAQA,CAAC+H,EAAqB9H,KAC5B,IAAK8H,EACH,OAAOzH,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAEE,MAAO,QAASJ,SAAC,cAEzC,MAAMgI,EAAaL,IAAMD,GACnBmC,EAAQlC,MACRmC,EAAY9B,EAAWJ,SAASiC,GAChCE,EAAkB/B,EAAWgC,KAAKH,EAAO,QAE/C,IAAIzJ,EAAQ,QACR0C,GAAO7C,EAAAA,EAAAA,KAACgK,EAAAA,EAAmB,IAC3BC,EAAS,QAYb,OAVIJ,GACF1J,EAAQ,MACR0C,GAAO7C,EAAAA,EAAAA,KAAC2J,EAAAA,EAAyB,IACjCM,EAAS,WACAH,GAAmB,KAC5B3J,EAAQ,SACR0C,GAAO7C,EAAAA,EAAAA,KAAC2J,EAAAA,EAAyB,IACjCM,EAAM,cAAAxE,OAAiBqE,EAAe,WAItC9J,EAAAA,EAAAA,KAACkK,EAAAA,EAAO,CAAC5K,MAAO2K,EAAOlK,UACrBC,EAAAA,EAAAA,KAACmK,EAAAA,EAAG,CAAChK,MAAOA,EAAO0C,KAAMA,EAAK9C,SAC3BgI,EAAWC,OAAO,qBAQzBrH,EAAmB6G,IAAkB,IAAD4C,EAEpC7C,EAAeC,GACjBM,EAAsBN,GAKpBI,EAAkBJ,GACpBW,KAKFd,EAAgB,IAEhBvO,EAAS,CACPuR,GAAI7C,EAAMzL,IACVA,IAAKyL,EAAMzL,IACXiN,SAAUxB,EAAMwB,SAChB/L,MAAuB,QAAjBmN,EAAA5C,EAAMyB,mBAAW,IAAAmB,OAAA,EAAjBA,EAAmBnN,OAAQuK,EAAMvK,MAAQ,GAC/CqN,KAAM9C,EAAM8C,KACZzC,mBAAoBL,EAAMK,mBAC1B0C,yBAA0B/C,EAAM+C,yBAChCrB,WAAY1B,EAAM0B,WAClBD,YAAazB,EAAMyB,gBAgIvB,OACEjJ,EAAAA,EAAAA,KAACa,EAAAA,EAAK,CACJvB,MAAM,sCACNwB,KAAMnI,EACNI,SAAUA,EACV0G,MAAO,IACPsB,OAAQ,KACRC,gBAAc,EAAAjB,UAEdD,EAAAA,EAAAA,MAAA,OAAKmB,QAbgBC,KAAO,IAAD0D,EACP,QAAtBA,EAAA3K,EAAemC,eAAO,IAAAwI,GAAtBA,EAAwBxF,SAYSW,SAAA,EAC7BC,EAAAA,EAAAA,KAACxH,EAAM,CACL+I,IAAKtH,EACLuH,YAAY,uEACZC,SAAUC,GAAKzI,EAAcyI,EAAEC,OAAOC,OACtC3B,MAAO,CAAEqB,aAAc,IACvBQ,WAAS,EACTC,UA5IqBL,IAGC,IAADM,EAF3B,GAAKoG,EAAU9N,OAEf,GAAc,cAAVoH,EAAElC,IACJkC,EAAEO,iBACFnI,GAAoB4B,IAClB,IAAIwG,EAAOxG,EAAO,EAElB,KACEwG,EAAOkG,EAAU9N,SACf8N,EAAUlG,GAAMuF,aAChBC,IAAMU,EAAUlG,GAAMuF,aAAaE,SAASD,QAC5CU,EAAUlG,GAAM2F,oBAAsB,IAExC3F,IAEF,MAAMsI,EAAYrI,KAAKC,IAAIF,EAAMkG,EAAU9N,OAAS,GAEpD,OADAV,EAAkBwO,EAAUoC,GAAWzO,KAChCyO,KAGa,QAAtBxI,EAAA/H,EAAemC,eAAO,IAAA4F,GAAtBA,EAAwB5C,aACnB,GAAc,YAAVsC,EAAElC,IAAmB,CAAC,IAAD6C,EAC9BX,EAAEO,iBACFnI,GAAoB4B,IAClB,IAAI4G,EAAY5G,EAAO,EAEvB,KACE4G,GAAa,IACX8F,EAAU9F,GAAWmF,aACrBC,IAAMU,EAAU9F,GAAWmF,aAAaE,SAASD,QACjDU,EAAU9F,GAAWuF,oBAAsB,IAE7CvF,IAEF,MAAMmI,EAAYtI,KAAKI,IAAID,EAAW,GAEtC,OADA1I,EAAkBwO,EAAUqC,GAAW1O,KAChC0O,KAGa,QAAtBpI,EAAApI,EAAemC,eAAO,IAAAiG,GAAtBA,EAAwBjD,OAC1B,MAAO,GAAc,UAAVsC,EAAElC,IAAiB,CAC5BkC,EAAEO,iBACF,MAAMyI,EAAgBtC,EAAUvO,GAC5B6Q,IACF/J,EAAgB+J,GAGbnD,EAAemD,IACf9C,EAAkB8C,IAEnB3R,IAGN,GAuFM0J,OAAQA,KAENvD,YAAW,KACK,IAADyL,EAAThS,IACoB,QAAtBgS,EAAA1Q,EAAemC,eAAO,IAAAuO,GAAtBA,EAAwBvL,WAEzB,OAKNgI,IACCtH,EAAAA,EAAAA,MAAA,OACEG,MAAO,CACLqB,aAAc,GACdoD,QAAS,YACTV,gBAAiB,UACjBE,OAAQ,oBACR0G,aAAc,MACdzK,MAAO,UACPC,SAAU,OACVyK,QAAS,OACTC,WAAY,SACZC,IAAK,OACLhL,SAAA,EAEFC,EAAAA,EAAAA,KAAC2J,EAAAA,EAAyB,CAAC1J,MAAO,CAAEE,MAAO,aAC1CiH,MAILtH,EAAAA,EAAAA,MAAA,OACEiC,UApHoBL,IAGE,IAADP,EAF3B,GAAKiH,EAAU9N,OAEf,GAAc,cAAVoH,EAAElC,IACJkC,EAAEO,iBACFnI,GAAoBkR,IAClB,IAAI9I,EAAO8I,EAAI,EAEf,KACE9I,EAAOkG,EAAU9N,SACf8N,EAAUlG,GAAMuF,aAChBC,IAAMU,EAAUlG,GAAMuF,aAAaE,SAASD,QAC5CU,EAAUlG,GAAM2F,oBAAsB,IAExC3F,IAEF,MAAMsI,EAAYrI,KAAKC,IAAIF,EAAMkG,EAAU9N,OAAS,GAEpD,OADAV,EAAkBwO,EAAUoC,GAAWzO,KAChCyO,KAGa,QAAtBrJ,EAAAlH,EAAemC,eAAO,IAAA+E,GAAtBA,EAAwB/B,aACnB,GAAc,YAAVsC,EAAElC,IACXkC,EAAEO,iBACFnI,GAAoBkR,IAClB,IAAItP,EAAOsP,EAAI,EAEf,KACEtP,GAAQ,IACN0M,EAAU1M,GAAM+L,aAChBC,IAAMU,EAAU1M,GAAM+L,aAAaE,SAASD,QAC5CU,EAAU1M,GAAMmM,oBAAsB,IAExCnM,IAEF,MAAM+O,EAAYtI,KAAKI,IAAI7G,EAAM,GAEjC,OADA9B,EAAkBwO,EAAUqC,GAAW1O,KAChC0O,UAGJ,GAAc,UAAV/I,EAAElC,IAAiB,CAC5BkC,EAAEO,iBACF,MAAMyI,EAAgBtC,EAAUvO,GAC5B6Q,IACF/J,EAAgB+J,GAGbnD,EAAemD,IACf9C,EAAkB8C,IAEnB3R,IAGN,MAAO,GAAc,WAAV2I,EAAElC,IAAkB,CAAC,IAADkD,EAC7BhB,EAAEO,iBACoB,QAAtBS,EAAAzI,EAAemC,eAAO,IAAAsG,GAAtBA,EAAwBtD,OAC1B,MAAO,GAAc,QAAVsC,EAAElC,KAAiBkC,EAAEuJ,SAAU,CAAC,IAADpH,EACxCnC,EAAEO,iBACoB,QAAtB4B,EAAA5J,EAAemC,eAAO,IAAAyH,GAAtBA,EAAwBzE,OAC1B,GA0DM8L,SAAU,EACV3J,IAAK+F,EACLrH,MAAO,CAAEkL,QAAS,QAASpL,SAAA,EAE3BC,EAAAA,EAAAA,KAACuD,EAAAA,EAAK,CACJC,WAAY4E,EACZ/I,QAASA,EACT3E,QAASA,EACT+I,OAAO,MACPC,KAAK,QACLlI,YAAY,EACZ8D,MAAOA,KACLQ,EAAAA,EAAAA,MAAA,OACEG,MAAO,CACL4K,QAAS,OACTO,eAAgB,gBAChBN,WAAY,SACZpG,QAAS,SACT3E,SAAA,EAEFC,EAAAA,EAAAA,KAAA,QAAAD,SAAM,iBACND,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEG,SAAU,OAAQD,MAAO,QAASJ,SAAA,EAC9CC,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAEE,MAAO,WAAYJ,SAAC,wBACnCC,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAEoL,OAAQ,QAASlL,MAAO,WAAYJ,SAAC,8BAGpDC,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAEE,MAAO,WAAYJ,SAAC,uDAMzC4D,MAAOA,CAAChE,EAAQiE,KACd,MAAMiG,EAAYtC,EAAe5H,GAC3B+J,EAAe9B,EAAkBjI,GACvC,MAAO,CACLsB,QAASA,KACF4I,GAAcH,EAMRG,EACT/B,EAAsBnI,GACb+J,GACTvB,KARAxH,EAAgBhB,GAEhBT,YAAW,KAAO,IAADoM,EACO,QAAtBA,EAAArR,EAAemC,eAAO,IAAAkP,GAAtBA,EAAwBlM,UACvB,MAOP0E,cAAeA,KACR+F,GAAcH,EAERG,EACT/B,EAAsBnI,GACb+J,GACTvB,IAJAxH,EAAgBhB,IAOpBoE,UACEH,IAAQ/J,EACJ,uCACA,gBACN,eAAgB8F,EAAO5D,IACvBkE,MAAO,CACLsL,QAAS1B,GAAaH,EAAe,GAAM,EAC3C8B,OAAQ3B,GAAaH,EAAe,cAAgB,UACpD1F,gBACE6F,GAAaH,EAAe,eAAYzF,KAIhDE,aAAc,CACZvB,KAAM,QACNwB,gBAAiBzK,EAAiB,CAACA,GAAkB,GACrD8H,SAAW4C,IACTzK,EAAkByK,EAAK,IACvB,MAAMT,EAAMwE,EAAU9D,WAAUiE,GAAKA,EAAExM,MAAQsI,EAAK,MACvC,IAATT,GAAY9J,EAAoB8J,IAEtC6H,iBAAmB9L,IAAa,CAC9B+L,SAAUnE,EAAe5H,IAAWiI,EAAkBjI,SAI5DG,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEI,UAAW,GAAID,SAAU,OAAQD,MAAO,QAASJ,SAAA,EAC7DC,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,wBAA4B,gEAEpCC,EAAAA,EAAAA,KAAA,UACAA,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,SAAa,4DAErBC,EAAAA,EAAAA,KAAA,UACAA,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,UAAc,wKAGtBC,EAAAA,EAAAA,KAAA,UACAA,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,oBAAwB,qHCpiBtC,KAAE4L,GAASC,EAAAA,EAqgBjB,EAne4DlT,IAgBrD,IAhBsD,QAC3D2G,EAAO,WACPmE,EAAU,OACVqI,EAAM,MACNC,EAAK,SACLC,EAAQ,SACRC,GAAW,EAAI,YACfC,GAAc,EAAI,OAClBxI,EAAS,MAAK,QACd/I,GAAU,EAAK,QACfwR,GAAU,EAAK,kBACfC,GAAoB,EAAI,KACxBzI,EAAO,SAAQ,UACfK,EAAS,gBACTqI,EAAe,oBACfC,GACD3T,EACC,MAAO6B,EAAM+R,IAAWpT,EAAAA,EAAAA,UAAgB,KACjCqT,EAAcC,IAAmBtT,EAAAA,EAAAA,UAAgB,KACjDuT,EAAaC,IAAkBxT,EAAAA,EAAAA,UAG5B,MACJyT,GAAezS,EAAAA,EAAAA,SAAO,IAE5BgB,EAAAA,EAAAA,YAAU,KACRoR,EAAQ9I,GAER,MAAMoJ,EAAuBvN,EAAQiF,WACnCuI,GAAyB,eAAlBA,EAAItN,YAKXoN,EAAavQ,SACS,IAAtBoH,EAAWlJ,QACXsS,GAAwB,GAExBF,EAAe,CAAErD,IAAK,EAAGwD,IAAKD,IAC9BD,EAAavQ,SAAU,GAEvBoQ,EAAgBhJ,EAAWlJ,OAAO,EAAE,CAACwS,OAAOtJ,EAAWlJ,OAAO,IAAI,MAEnE,CAACkJ,EAAYnE,KAGhBnE,EAAAA,EAAAA,YAAU,KACJmR,GACFK,EAAeL,KAEhB,CAACA,IAEJ,MAAMU,EAAeA,KACd,OAALjB,QAAK,IAALA,GAAAA,IAEA,MAAMkB,EAAmB3N,EAAQiF,WAAUuI,IAAwB,IAAjBA,EAAII,WAClDD,GAAoB,GACtBN,EAAe,CAAErD,IAAK9O,EAAKD,OAAQuS,IAAKG,KAoBtCE,EAAWA,CAAC7D,EAAawD,EAAajL,KAC1C,MAAMuL,EAAS9N,EAAQwN,GAGvB,GAAIM,EAAOC,YAAcxL,GAAmB,KAAVA,GAEhC,OADA2D,EAAAA,GAAQ2C,MAAM,GAADzC,OAAI0H,EAAO7N,MAAK,kBACtB,EAIT,GAAI6N,EAAOE,WAAY,CACrB,MAAMnF,EAAQiF,EAAOE,WAAWzL,GAChC,GAAIsG,EAEF,OADA3C,EAAAA,GAAQ2C,MAAMA,IACP,CAEX,CAEA,MAAMoF,EAAU,IAAI/S,GAIpB,OAHA+S,EAAQjE,GAAKhK,EAAQwN,GAAKtN,WAAaqC,EACvC0K,EAAQgB,GACRzB,EAAOyB,IACA,IAGTpS,EAAAA,EAAAA,YAAU,KACR,MAAMqS,EAAiB7L,IACjBA,EAAE8L,SAAqB,MAAV9L,EAAElC,MACjBkC,EAAEO,iBACF4J,EAAOtR,IAELmH,EAAEuJ,UAAoC,MAAxBvJ,EAAElC,IAAIxC,eAAyBgP,IAC/CtK,EAAEO,iBACF8K,MAGJ,GAAIZ,EAEF,OADAsB,SAASC,iBAAiB,UAAWH,GAC9B,IAAME,SAASE,oBAAoB,UAAWJ,KAEtD,CAAChT,EAAMyR,EAAUH,EAAQM,EAAmBY,IAE/C,MAAM5I,EAAgD,CACpD1C,SAAUA,CAAC2C,EAA8BmI,KACvCC,EAAgB,IAAIpI,MAKxB,SAASwJ,EAAmBC,EAAkBC,EAAmBzO,GAC/D,IAAIwN,EAAMgB,EAAWC,EACrB,KAAOjB,GAAO,GAAKA,EAAMxN,EAAQ/E,QAAQ,CACvC,IAA8B,IAA1B+E,EAAQwN,GAAKI,SAAoB,OAAOJ,EAC5CA,GAAOiB,CACT,CACA,OAAQ,CACV,CAEA,MAAMC,EAAeC,IAQd,IAADC,EAAAC,EAAAC,EAAAC,EAAA,IARgB,IACpB/E,EAAG,IACHwD,EAAG,MACHjL,GAKDoM,EACC,MAAOK,EAAWC,IAAgBpV,EAAAA,EAAAA,UAAS0I,GACrC2M,GAAWrU,EAAAA,EAAAA,QAAY,MACvBiT,EAAS9N,EAAQwN,IAChB2B,EAAuBC,IAA4BvV,EAAAA,EAAAA,WAAS,IAC5DwV,EAAqBC,IAA0BzV,EAAAA,EAAAA,WAAS,IAE/DgC,EAAAA,EAAAA,YAAU,KACRoT,EAAa1M,GAEb1C,YAAW,KAAO,IAAD0P,EACC,QAAhBA,EAAAL,EAASnS,eAAO,IAAAwS,GAAhBA,EAAkBxP,UACjB,MACF,CAACwC,IAEJ,MAAMiN,EAAgBC,IACpBR,EAAaQ,GACb5B,EAAS7D,EAAKwD,EAAKiC,IAGfvB,EAAiB7L,IACrB,GAAoB,YAAhByL,EAAOvK,MAAgC,UAAVlB,EAAElC,IAGjC,OAFAkC,EAAEqN,uBACFN,GAAyB,GAG3B,GAAoB,UAAhBtB,EAAOvK,MAA8B,UAAVlB,EAAElC,IAG/B,OAFAkC,EAAEqN,uBACFJ,GAAuB,GAGzB,GAAc,QAAVjN,EAAElC,IAAe,CAGnB,GAFAkC,EAAEO,iBAEEkL,EAAOC,YAAciB,GAA2B,KAAdA,GAEpC,YADA9I,EAAAA,GAAQ2C,MAAM,GAADzC,OAAI0H,EAAO7N,MAAK,iBAG/B,MAAM0P,EAAUtN,EAAEuJ,SAAW4B,EAAM,EAAIA,EAAM,EACvCoC,EAAU5F,GAAO2F,GAAW3P,EAAQ/E,OAAS,EAAI,GACjD4U,GAAYF,EAAU3P,EAAQ/E,QAAU+E,EAAQ/E,OAClD2U,EAAU1U,EAAKD,OACjBoS,EAAe,CAAErD,IAAK4F,EAASpC,IAAKqC,IAC3BlD,IACTe,IACAL,EAAe,CAAErD,IAAK9O,EAAKD,OAAQuS,IAAKqC,IAE5C,KAAqB,WAAVxN,EAAElC,KACXkN,EAAe,OAIbyC,EAAuBvO,IACvBwL,GACFA,EAAgBxL,EAASyI,GAE3BoF,GAAyB,GACzB/B,EAAe,OAGX0C,EAAqB5H,IAEzB,MAAM8F,EAAU,IAAI/S,GACpB+S,EAAQjE,GAAKgG,SAAW7H,EAAM6C,IAAM7C,EAAMzL,KAAO,GACjDuR,EAAQjE,GAAKL,SAAWxB,EAAMwB,UAAY,GAC1CsD,EAAQgB,GACRzB,EAAOyB,GACPqB,GAAuB,GACvBjC,EAAe,OAGjB,OAAQS,EAAOvK,MACb,IAAK,UAEH,MAAM0M,EAAuB,QAATrB,EAAA1T,EAAK8O,UAAI,IAAA4E,GAATA,EAAWsB,aAC3B,GAAA9J,OAAGlL,EAAK8O,GAAKkG,cAAY9J,OAAY,QAATyI,EAAA3T,EAAK8O,UAAI,IAAA6E,GAATA,EAAW7Q,aAAY,IAAAoI,OAAOlL,EAAK8O,GAAKhM,cAAiB,IAAKmS,OAC1FnB,EACJ,OACEvO,EAAAA,EAAAA,MAAA2P,EAAAA,SAAA,CAAA1P,SAAA,EACEC,EAAAA,EAAAA,KAAA,OAAKiB,QAASS,GAAKA,EAAEqN,kBAAkBhP,UACrCC,EAAAA,EAAAA,KAACvH,EAAAA,EAAK,CACJ8I,IAAKgN,EACL3M,MAAO0N,EACPvN,UAAWwL,EACX/L,YAAY,gCACZkO,UAAQ,EACRzP,MAAO,CAAEuL,OAAQ,eAGpBgD,IACCxO,EAAAA,EAAAA,KAAC2P,EAAqB,CACpBhX,QAAS6V,EACT1V,SAAUqW,EACVpW,SAAUA,IAAM0V,GAAyB,QAKnD,IAAK,QACH,OACE3O,EAAAA,EAAAA,MAAA2P,EAAAA,SAAA,CAAA1P,SAAA,EACEC,EAAAA,EAAAA,KAAA,OAAKiB,QAASS,GAAKA,EAAEqN,kBAAkBhP,UACrCC,EAAAA,EAAAA,KAACvH,EAAAA,EAAK,CACJ8I,IAAKgN,EACL3M,OAAgB,QAATuM,EAAA5T,EAAK8O,UAAI,IAAA8E,OAAA,EAATA,EAAWnF,WAAYqF,EAC9BtM,UAAWwL,EACX/L,YAAY,8BACZkO,UAAQ,MAGXhB,IACC1O,EAAAA,EAAAA,KAAC4P,EAAmB,CAClBjX,QAAS+V,EACT5V,SAAUsW,EACVrW,SAAUA,IAAM4V,GAAuB,GACvC/I,WAAoB,QAATwI,EAAA7T,EAAK8O,UAAI,IAAA+E,OAAA,EAATA,EAAWvH,aAAc,QAK9C,IAAK,SACH,OACE7G,EAAAA,EAAAA,KAAA,OAAKiB,QAASS,GAAKA,EAAEqN,kBAAkBhP,UACrCC,EAAAA,EAAAA,KAAC6P,EAAAA,EAAW,CACVtO,IAAKgN,EACL3M,MAAOyM,EACP5M,SAAUoN,EACVpM,OAAQA,IAAMiK,EAAe,MAC7BoD,UAAU,EACV/N,UAAWL,IAET,GAAc,QAAVA,EAAElC,KAA2B,UAAVkC,EAAElC,IAAiB,CAGxC,GAFAkC,EAAEO,iBAEEkL,EAAOC,YAAciB,GAA2B,KAAdA,GAEpC,YADA9I,EAAAA,GAAQ2C,MAAM,GAADzC,OAAI0H,EAAO7N,MAAK,iBAG/B,MAAMwO,EAAYpM,EAAEuJ,UAAY,EAAI,EAC9B+D,EAAUpB,EAAmBf,EAAKiB,EAAWzO,GACnD,IAAiB,IAAb2P,EACFtC,EAAe,CAAErD,MAAKwD,IAAKmC,QACtB,CAEL,MAAMC,EAAUnB,EAAY,EAAIzE,EAAM,EAAIA,EAAM,EAChD,GAAI4F,GAAW,GAAKA,EAAU1U,EAAKD,OAAQ,CACzC,MAAM0S,EAAmBY,GAAoB,EAAG,EAAGvO,IACzB,IAAtB2N,GACFN,EAAe,CAAErD,IAAK4F,EAASpC,IAAKG,GAExC,MAAO,GAAIc,EAAY,GAAK9B,EAAU,CAEpCe,IACA,MAAMC,EAAmBY,GAAoB,EAAG,EAAGvO,IACzB,IAAtB2N,GACFN,EAAe,CAAErD,IAAK9O,EAAKD,OAAQuS,IAAKG,GAE5C,MAEEN,EAAe,KAEnB,CACF,KAAqB,WAAVhL,EAAElC,KACXkN,EAAe,OAGnBzM,MAAO,CAAER,MAAO,YAIxB,IAAK,SACH,OACEO,EAAAA,EAAAA,KAAA,OAAKiB,QAASS,GAAKA,EAAEqN,kBAAkBhP,UACrCC,EAAAA,EAAAA,KAAC+P,EAAAA,EAAM,CACLxO,IAAKgN,EACL3M,MAAOyM,EACP2B,QAAS7C,EAAO6C,QAChBvO,SAAUqN,IAER,GADgB5B,EAAS7D,EAAKwD,EAAKiC,GACtB,CAEX,MAAME,EAAUnC,EAAM,EAChBoC,EAAU5F,GAAO2F,GAAW3P,EAAQ/E,OAAS,EAAI,GACjD4U,GAAYF,EAAU3P,EAAQ/E,QAAU+E,EAAQ/E,OAElD2U,EAAU1U,EAAKD,OACjBoS,EAAe,CAAErD,IAAK4F,EAASpC,IAAKqC,IAC3BlD,IACTe,IACAL,EAAe,CAAErD,IAAK9O,EAAKD,OAAQuS,IAAKqC,IAE5C,MAEEhQ,YAAW,KAAO,IAAD+Q,EACC,QAAhBA,EAAA1B,EAASnS,eAAO,IAAA6T,GAAhBA,EAAkB7Q,UACjB,KAGPa,MAAO,CAAER,MAAO,QAChBsC,UAAWL,IACK,UAAVA,EAAElC,KAA6B,QAAVkC,EAAElC,KACzBkC,EAAEO,sBAOd,IAAK,OACH,OACEjC,EAAAA,EAAAA,KAAA,OAAKiB,QAASS,GAAKA,EAAEqN,kBAAkBhP,UACrCC,EAAAA,EAAAA,KAACkQ,EAAAA,EAAU,CACT3O,IAAKgN,EACL3M,MAAOyM,EAAY3G,IAAM2G,GAAa,KACtC5M,SAAU0O,IACRtB,EAAasB,EAAOA,EAAKnI,OAAO,cAAgB,MAChD0E,EAAe,OAEjBjK,OAAQA,IAAMiK,EAAe,MAC7B3K,UAAWwL,EACXtN,MAAO,CAAER,MAAO,YAIxB,QACE,OACEO,EAAAA,EAAAA,KAAA,OAAKiB,QAASS,GAAKA,EAAEqN,kBAAkBhP,UACrCC,EAAAA,EAAAA,KAACvH,EAAAA,EAAK,CACJ8I,IAAKgN,EACL3M,MAAOyM,EACP5M,SAAUC,GAAKmN,EAAanN,EAAEC,OAAOC,OACrCa,OAAQA,IAAMiK,EAAe,MAC7B3K,UAAWwL,QAOjB6C,EAAgB/Q,EAAQxD,KAAI,CAACgR,EAAKqC,KAAQmB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC3CxD,GAAG,IACNyD,OAAQA,CAACC,EAAcC,KAAiB,CACtCvP,QAASA,KACiB,kBAAbuP,GACT9D,EAAe,CAAErD,IAAKmH,EAAU3D,IAAKqC,KAGzCuB,cAAgB/O,IACdA,EAAEO,iBACsB,kBAAbuO,GACT9D,EAAe,CAAErD,IAAKmH,EAAU3D,IAAKqC,OAI3CxP,OAAQA,CAACoP,EAAUnP,EAAa6Q,KAC9B,GACE/D,GACAA,EAAYpD,MAAQmH,GACpB/D,EAAYI,MAAQqC,EAEpB,OACElP,EAAAA,EAAAA,KAAC+N,EAAY,CAEX1E,IAAKmH,EACL3D,IAAKqC,EACLtN,MAAOjC,EAAOkN,EAAItN,YAAW,GAAAkG,OAHrB+K,EAAQ,KAAA/K,OAAIyJ,IAQ1B,GAA0B,oBAAfrC,EAAInN,OACb,OAAOmN,EAAInN,OAAOoP,EAAKnP,EAAQ6Q,GAGjC,GAAsB,aAAlB3D,EAAItN,UACN,OAAOI,EAAOqJ,UAAYrJ,EAAOkN,EAAItN,WAGvC,GAAsB,eAAlBsN,EAAItN,UACN,OAAOI,EAAO4P,cAAgB5P,EAAOkN,EAAItN,WAE3C,GAAiB,WAAbsN,EAAIjK,MAAqBiK,EAAImD,QAAS,CACxC,MAAMU,EAAS7D,EAAImD,QAAQ9K,MACzByL,GAAOA,EAAI/O,QAAUjC,EAAOkN,EAAItN,aAElC,OAAOmR,EAASA,EAAOE,MAAQjR,EAAOkN,EAAItN,UAC5C,CACA,OAAOI,EAAOkN,EAAItN,gBAItB,OACEO,EAAAA,EAAAA,MAAA,OACEiE,UAAS,uBAAA0B,OAAyByG,EAAU,UAAY,GAAE,KAAAzG,OACxD1B,GAAa,IACZhE,SAAA,EAEHD,EAAAA,EAAAA,MAAA,OAAKiE,UAAU,gBAAehE,SAAA,EAC5BD,EAAAA,EAAAA,MAACsB,EAAAA,EAAK,CAAArB,SAAA,CACHiM,IACChM,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLC,KAAK,UACLC,MAAM7C,EAAAA,EAAAA,KAAC6Q,EAAAA,EAAY,IACnB5P,QAAS8L,EAAahN,SACvB,sBAIFkM,IACCjM,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CAACmO,QAAM,EAACjO,MAAM7C,EAAAA,EAAAA,KAAC+Q,EAAAA,EAAc,IAAK9P,QAvY3B+P,KACF,IAAhBzW,EAAKD,OAITuG,EAAAA,EAAMoQ,QAAQ,CACZ3R,MAAO,2DACP4R,KAAMA,KACJ,MAAM5D,EAAU/S,EAAK4W,MAAM,GAAI,GAC/B7E,EAAQgB,GACRzB,EAAOyB,GACC,OAARvB,QAAQ,IAARA,GAAAA,EAAWQ,MATbhH,EAAAA,GAAQG,QAAQ,sBAqYwD3F,SAAC,gBAIrEC,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLC,KAAK,UACLC,MAAM7C,EAAAA,EAAAA,KAACoR,EAAAA,EAAY,IACnBnQ,QAASA,IAAM4K,EAAOtR,GAAMwF,SAC7B,sBAIHC,EAAAA,EAAAA,KAAC2L,EAAI,CAAC/I,KAAK,YAAYmB,UAAU,aAAYhE,SAAC,8CAIhDC,EAAAA,EAAAA,KAACuD,EAAAA,EAAK,CACJ8N,UAAQ,EACR7N,WAAYjJ,EACZ8E,QAAS+Q,EACT3M,OAAQA,EACR/I,QAASA,EACTc,YAAY,EACZkI,KAAMA,EACNa,OAAQ,CAAEC,EAAG,KACbL,cAAYkM,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAMlM,GAAY,IAACvB,KAAK,WAAWwB,gBAAgBmI,U,0BC1gBhE,MAAM+E,EAAsBA,CACjCC,EACAC,KAEA,MAAMC,GAAmBC,EAAAA,EAAAA,UAAQ,IAC1BH,EAAMjX,OCNR,SAA4B5B,GAY/B,IAZgC,MAClC6Y,EAAK,YACLI,EAAW,cACXC,EAAa,SACbC,EAAQ,aACRC,GAODpZ,EAEC,MAAMqZ,EAAeR,EAAM1V,KAAKC,IAAU,IAADkW,EAAAC,EACvC,MAAMrR,EAAqB,OAAX+Q,QAAW,IAAXA,OAAW,EAAXA,EAAazM,MAAM3I,GAAWA,EAAER,MAAQD,EAAK+K,aAE7D,IAAIqL,EAAgBpW,EAAKqW,iBAAyB,OAAPvR,QAAO,IAAPA,GAAqB,QAAdoR,EAAPpR,EAASwR,oBAAY,IAAAJ,OAAd,EAAPA,EAAuBG,iBAAkB,GAG/ED,GAAmC,IAAlBA,IAEpBA,EAAgB,IAKlB,MAAMG,EACJC,OAAOxW,EAAKyW,KAAO,GAAKD,OAAOxW,EAAK2E,OAAS,GAC7C6R,OAAOxW,EAAK0W,WAAa,IACtBF,OAAOxW,EAAK2E,OAAS,KAAa,OAAPG,QAAO,IAAPA,GAAoB,QAAbqR,EAAPrR,EAASxD,mBAAW,IAAA6U,OAAb,EAAPA,EAAsBQ,YAAa,IAAM,GAGzE,IAAIC,EAASL,EAIb,OAHKT,GAAiBM,EAAgB,IACpCQ,EAASL,EAAcA,EAAaH,EAAgB,MAEtD7B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKvU,GAAI,IACPqW,eAAgBD,EAChBG,aACAK,cAKEC,EAAYZ,EAAaa,QAC7B,CAACC,EAAK/W,IAAS+W,EAAMP,OAAOxW,EAAK4W,SACjC,GAIII,EAAiBf,EAAaa,QAClC,CAACC,EAAK/W,IAAS+W,EAAMP,OAAOxW,EAAKuW,aACjC,GAIF,IAAIU,EAAgB,EAChBlB,EAAW,IAEXkB,EADmB,eAAjBjB,EACcgB,GAAkBjB,EAAW,KAE7BA,GAOpB,IAAImB,EAAY,EACZC,EAAiB,EACjBC,EAAe,EA4CnB,OA1CAnB,EAAaoB,SAAQrX,IACnB,IAAIsX,EAAiBtX,EAAKuW,WACtBR,EAAW,IAEXuB,EADmB,eAAjBtB,EACehW,EAAKuW,WAAcvW,EAAKuW,YAAcR,EAAW,KAEjD/V,EAAKuW,WAAeR,EAASiB,EAAgBhX,EAAKuW,YAIvE,IAAIgB,EAAY,EACXzB,EAcC9V,EAAKqW,eAAiB,GACxBkB,EAAYD,GAAkBtX,EAAKqW,gBAAkB,IAAMrW,EAAKqW,iBAChEc,GAAkBG,EAAiBC,EACnCL,GAAaK,EACbH,GAAgBE,IAGhBH,GAAkBG,EAClBF,GAAgBE,GApBdtX,EAAKqW,eAAiB,GACxBkB,EAAYD,GAAkBtX,EAAKqW,eAAiB,KACpDc,GAAkBG,EAClBJ,GAAaK,EACbH,GAAgBE,EAAiBC,IAGjCJ,GAAkBG,EAClBF,GAAgBE,MAqBf,CACLT,YACAM,iBACAD,YACAM,KAPWN,EAAY,EAQvBO,KAPWP,EAAY,EAQvBE,eACAH,gBAEJ,CD5GWS,CAAoB,CACzBjC,QACAI,YAAa,GACbC,cAAeJ,EAAaI,cAC5BC,SAAUL,EAAaK,SACvBC,aAAcN,EAAaM,eAfpB,CACLa,UAAW,EACXM,eAAgB,EAChBD,UAAW,EACXM,KAAM,EACNC,KAAM,EACNL,aAAc,EACdH,cAAe,IAUlB,CAACxB,EAAOC,IAEX,OAAOC,G,8BEHF,MAAMgC,EAAqB/a,IAAoD,IAAnD,SAAEgb,EAAQ,UAAEC,GAAiCjb,EAE9E,MAAMkb,ECzBoBF,KAAoB,IAADG,EAC7C,MAAMC,GAAOhO,EAAAA,EAAAA,kBACPiO,EAAe,OAAJD,QAAI,IAAJA,OAAI,EAAJA,EAAME,UACjBC,GAAqB,OAAJH,QAAI,IAAJA,OAAI,EAAJA,EAAMI,mBAAuB,OAAJJ,QAAI,IAAJA,GAAuB,QAAnBD,EAAJC,EAAMK,yBAAiB,IAAAN,OAAnB,EAAJA,EAAyB9X,KAGnEqY,GAAcC,EAAAA,EAAAA,IAAkB,eAChCC,GAAmBD,EAAAA,EAAAA,IAAkB,kBAKzC9Z,KAAMga,EACN9Z,UAAW+Z,EACXC,QAASC,GACP/Z,EAAAA,GAASC,mBAAmB,CAAC,EAAG,CAAEI,MAAM,KAG1CT,KAAMoa,EACNla,UAAWma,EACXH,QAASI,GACPla,EAAAA,GAASma,oBAAoB,CAAC,EAAG,CAAE9Z,MAAM,KAG3CT,KAAMwa,EACNta,UAAWua,EACXP,QAASQ,GACPta,EAAAA,GAASua,kBAAkB,CAAC,EAAG,CAAEla,MAAM,KAGzCT,KAAM4a,EACN1a,UAAW2a,EACXX,QAASY,GACP1a,EAAAA,GAAS2a,wBAAwB,CAAC,EAAG,CAAEta,MAAM,IAG3Cua,GAAyBxB,KAAcL,GAE3CnZ,KAAMib,EACN/a,UAAWgb,EACXhB,QAASiB,GACP/a,EAAAA,GAASiM,sBAAsB,CAAC,EAAG,CAAE5L,MAAOua,KAG9Chb,KAAMob,EACNlb,UAAWmb,EACXnB,QAASoB,GACPlb,EAAAA,GAASuM,uBAAuB,CAAC,EAAG,CAAElM,MAAO+Y,KAEzCxZ,KAAMub,EAAerB,QAASsB,GACpCzB,EAAiB0B,aAGXzb,KAAM0b,GAAsBtb,EAAAA,GAASub,yBAC3C,CAAEhC,gBAAiBD,GACnB,CAAEjZ,MAAOiZ,KAIH1Z,KAAM4b,GAAiBxb,EAAAA,GAASyb,oBACtC,CAAElC,gBAAiBD,EAAgBnZ,WAAY,EAAGC,UAAW,GAC7D,CAAEC,MAAOiZ,EAAgBhZ,2BAA2B,IAIhDob,GAAoB3E,EAAAA,EAAAA,UACxB,IAAOrJ,MAAMC,QAAwB,OAAfiM,QAAe,IAAfA,OAAe,EAAfA,EAAyBjZ,QAAWiZ,EAAwBjZ,OAAS,IAC3F,CAACiZ,IAGG+B,GAAqB5E,EAAAA,EAAAA,UACzB,IAAOrJ,MAAMC,QAAyB,OAAhBqM,QAAgB,IAAhBA,OAAgB,EAAhBA,EAA0BrZ,QAAWqZ,EAAyBrZ,OAAS,IAC7F,CAACqZ,IAGG4B,GAAmB7E,EAAAA,EAAAA,UACvB,IAAOrJ,MAAMC,QAAuB,OAAdyM,QAAc,IAAdA,OAAc,EAAdA,EAAwBzZ,QAAWyZ,EAAuBzZ,OAAS,IACzF,CAACyZ,IAGGyB,GAAiB9E,EAAAA,EAAAA,UACrB,IAAOrJ,MAAMC,QAAqB,OAAZ6M,QAAY,IAAZA,OAAY,EAAZA,EAAsB7Z,QAAW6Z,EAAqB7Z,OAAS,IACrF,CAAC6Z,IAGGsB,GAAuB/E,EAAAA,EAAAA,UAC3B,IAAOrJ,MAAMC,QAA2B,OAAlBkN,QAAkB,IAAlBA,OAAkB,EAAlBA,EAA4Bla,QAAWka,EAA2Bla,OAAS,IACjG,CAACka,IAGGkB,GAAwBhF,EAAAA,EAAAA,UAC5B,IAAOrJ,MAAMC,QAA4B,OAAnBqN,QAAmB,IAAnBA,OAAmB,EAAnBA,EAA6Bra,QAAWqa,EAA4Bra,OAAS,IACnG,CAACqa,IAGGgB,GAAsBjF,EAAAA,EAAAA,UAAQ,KAClC,MAAMpW,EAA2B,OAAjB2a,QAAiB,IAAjBA,OAAiB,EAAjBA,EAA2B3a,OAC3C,OAAI+M,MAAMC,QAAQhN,GAAgBA,EAAO,GAClCA,IAAc,OAAJwY,QAAI,IAAJA,OAAI,EAAJA,EAAMK,oBAAqB,CAAC,IAC5C,CAAC8B,EAAmBnC,IAEjB8C,GAAgBlF,EAAAA,EAAAA,UAAQ,KAAU,OAAJoC,QAAI,IAAJA,OAAI,EAAJA,EAAM+C,cAAe,CAAC,GAAG,CAAC/C,IAExDgD,GAAWpF,EAAAA,EAAAA,UAAQ,KACvB,MAAMqF,GAA8B,OAAZZ,QAAY,IAAZA,OAAY,EAAZA,EAAsB7a,SAAU6a,GAAgB,CAAC,EACzE,OAAO9N,MAAMC,QAAQyO,GAAkBA,EAAe,GAAKA,IAC1D,CAACZ,KAGIa,OAAQC,EAAmBxc,UAAWyc,GAC5C9C,EAAY+C,aACNC,OAAQC,EAAmB5c,UAAW6c,GAC5ClD,EAAYmD,aACNP,OAAQQ,EAAqB/c,UAAWgd,GAC9CnD,EAAiB6C,YAenB,MAAO,CAELrD,OACAC,WACAE,iBACA0C,sBACAC,gBACAE,WAGAT,oBACAC,qBACAC,mBACAC,iBACAC,uBACAC,wBAGAlC,iBACAI,kBACAI,gBACAI,cACAK,eACAG,qBACAsB,oBACAI,oBACAG,4BAGAR,oBACAI,oBACAG,sBAGA9C,kBACAG,mBACAI,iBACAI,eACAK,oBACAG,qBACAE,mBACA2B,eArDqBA,KACrBhD,IACAG,IACAI,IACAI,IACItB,EACF8B,IACSN,GACTG,KAgDFI,kBDpJe6B,CAAYjE,IACvB,sBAAEkE,EAAqB,yBAAEC,EAAwB,SAAEf,IAAagB,EAAAA,EAAAA,KAGhEC,EErBmBC,MACzB,MAAOC,EAAcC,IAAmBhf,EAAAA,EAAAA,UAAuB,CAC7Dif,WAAY,GACZhI,KAAMzI,MAAQM,OAAO,cACrBoQ,YAAa,GACbC,cAAe,GACfC,UAAW,GACXC,eAAgB,GAChBC,aAAc,OACdjH,MAAO,MAGFC,EAAciH,IAAmBvf,EAAAA,EAAAA,UAAuB,CAC7Dwf,QAAQ,EACRC,iBAAiB,EACjBC,UAAU,EACVhH,eAAe,EACfC,SAAU,EACVC,aAAc,aACd+G,WAAY,KAGPC,EAAcC,IAAmB7f,EAAAA,EAAAA,UAA6B,QAG/D8f,GAAeC,EAAAA,EAAAA,cAAaC,IAChChB,GAAgBxc,IAAI2U,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAU3U,GAASwd,OACtC,IAGGC,GAAcF,EAAAA,EAAAA,cAAa1H,IAC/B2G,GAAgBxc,IAAI2U,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAU3U,GAAI,IAAE6V,cACnC,IAGG6H,GAAUH,EAAAA,EAAAA,cAAY,KAC1B,MAAMI,EAAoB,CACxBxS,WAAY,GACZ0I,aAAc,GACdlS,aAAc,GACdgS,SAAU,GACVrG,SAAU,GACVuJ,IAAK,EACLC,UAAW,EACX/R,MAAO,EACP6Y,IAAK,EACL5G,OAAQ,EACRP,eAAgB,GAElB+F,GAAgBxc,IAAI2U,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAU3U,GAAI,IAAE6V,MAAO,IAAI7V,EAAK6V,MAAO8H,SAC1D,IAGGE,GAAcN,EAAAA,EAAAA,cAAaO,IAC/BtB,GAAgBxc,IAAI2U,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACf3U,GAAI,IACP6V,MAAO7V,EAAK6V,MAAMtV,QAAO,CAACwd,EAAGC,KAAWF,EAAQtc,SAASwc,WAE1D,IAGGC,GAAiBV,EAAAA,EAAAA,cAAaC,IAClCT,GAAgB/c,IAAI2U,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAU3U,GAASwd,OACtC,IAGGU,GAAYX,EAAAA,EAAAA,cAAY,KAC5Bf,EAAgB,CACdC,WAAY,GACZhI,KAAMzI,MAAQM,OAAO,cACrBoQ,YAAa,GACbC,cAAe,GACfC,UAAW,GACXC,eAAgB,GAChBC,aAAc,OACdjH,MAAO,CACL,CACE1K,WAAY,GACZ0I,aAAc,GACdlS,aAAc,GACdgS,SAAU,GACVrG,SAAU,GACVuJ,IAAK,EACLC,UAAW,EACX/R,MAAO,EACP6Y,IAAK,EACL5G,OAAQ,EACRP,eAAgB,MAKtBsG,EAAgB,CACdC,QAAQ,EACRC,iBAAiB,EACjBC,UAAU,EACVhH,eAAe,EACfC,SAAU,EACVC,aAAc,aACd+G,WAAY,IAGdE,EAAgB,UACf,IAGGc,GAAeZ,EAAAA,EAAAA,cAAY,CAACvF,EAAeoG,KAAiC,IAADC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAE/E,MAAMC,EAAe7G,EAAS8G,gBACxBC,EAAU/G,EAAS0E,YACnBsC,GACQ,OAAZH,QAAY,IAAZA,OAAY,EAAZA,EAAcI,aAAyB,OAAZJ,QAAY,IAAZA,OAAY,EAAZA,EAActd,OAAQ,GAEnDib,EAAgB,CACdC,WAAYzE,EAASyE,WACrBhI,KAAMzI,IAAMgM,EAASvD,MAAMnI,OAAO,cAClCoQ,YAAaqC,EACbpC,cAAeqC,EACfpC,UAAW5E,EAAS4E,WAAa,GACjCC,gBAAwC,QAAxBwB,EAAArG,EAASkH,uBAAe,IAAAb,OAAA,EAAxBA,EAA0B9c,OAAQ,GAClDub,aAAc9E,EAAS8E,aACvBjH,OACgB,QAAdyI,EAAAtG,EAASmH,aAAK,IAAAb,OAAA,EAAdA,EAAgBne,KAAKC,IAAS,IAAAgf,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,MAAM,CAClC1f,IAAKD,EAAKC,IACV8K,WAAY/K,EAAK+K,WACjB0I,cAA+B,QAAjBuL,EAAAhf,EAAK4f,oBAAY,IAAAZ,OAAA,EAAjBA,EAAmB7d,OAAQnB,EAAKyT,cAAgB,GAC9DlS,cAA+B,QAAjB0d,EAAAjf,EAAK4f,oBAAY,IAAAX,GAAa,QAAbC,EAAjBD,EAAmB3d,mBAAW,IAAA4d,OAAb,EAAjBA,EAAgC3d,eAAgB,GAC9DgS,SAAUvT,EAAKuT,UAAYvT,EAAK6f,gBAChC3S,SAAUlN,EAAKkN,UAAY,GAC3BuJ,IAAKzW,EAAKyW,KAAO,EACjBC,UAAW1W,EAAK0W,WAAa,EAC7B/R,MAAO3E,EAAK2E,MACZ6Y,IAAKxd,EAAKwd,KAAOxd,EAAK2E,MACtBiS,OAAQ5W,EAAK4W,OACbP,eAAgBrW,EAAKqW,iBAAmC,QAArB8I,EAAInf,EAAK4f,oBAAY,IAAAT,GAAc,QAAdC,EAAjBD,EAAmB7I,oBAAY,IAAA8I,OAAd,EAAjBA,EAAiC/I,kBAAmC,QAArBgJ,EAAIrf,EAAK4f,oBAAY,IAAAP,OAAA,EAAjBA,EAAmBhJ,iBAAkB,EAC/HyJ,SAAU9f,EAAK8f,WAA6B,QAArBR,EAAItf,EAAK4f,oBAAY,IAAAN,OAAA,EAAjBA,EAAmBQ,YAA6B,QAArBP,EAAIvf,EAAK4f,oBAAY,IAAAL,GAAa,QAAbC,EAAjBD,EAAmBje,mBAAW,IAAAke,OAAb,EAAjBA,EAAgCM,WAAY,GACtGC,QAAS/f,EAAK+f,UAA4B,QAArBN,EAAIzf,EAAK4f,oBAAY,IAAAH,OAAA,EAAjBA,EAAmBM,UAAW,GACvDhK,SAAU/V,EAAK+V,UAAY,EAC3BlM,YAAa7J,EAAK6J,aAAe,GACjCmW,eAAgC,QAAjBN,EAAA1f,EAAK4f,oBAAY,IAAAF,GAAc,QAAdC,EAAjBD,EAAmBpJ,oBAAY,IAAAqJ,OAAd,EAAjBA,EAAiCK,gBAAiB,SAC5D,KAGXrD,EAAgB,CACdC,OAAwB,QAAlBuB,EAAEvG,EAASqI,eAAO,IAAA9B,GAAAA,EACxBtB,gBAA2C,QAA5BuB,EAAExG,EAASsI,yBAAiB,IAAA9B,GAAAA,EAC3CtB,SAAiC,WAAvBlF,EAASuI,UACnBrK,cAAuC,QAA1BuI,EAAEzG,EAASwI,uBAAe,IAAA/B,GAAAA,EACvCtI,SAA2B,QAAnBuI,EAAE1G,EAAS7B,gBAAQ,IAAAuI,EAAAA,EAAI,EAC/BtI,aAAoC,QAAxBuI,EAAE3G,EAASyI,qBAAa,IAAA9B,EAAAA,EAAI,aACxCxB,WAAgC,QAAtByB,EAAE5G,EAAS0I,mBAAW,IAAA9B,EAAAA,EAAI,IAGtCvB,EAAgBrF,EAAS2I,eAAiB,QAGtCvC,GACF5a,YAAW,IAAM4a,KAAkB,KAEpC,IAEH,MAAO,CACL7B,eACAzG,eACAsH,eACAZ,kBACAO,kBACAM,kBACAC,eACAG,cACAC,UACAG,cACAI,iBACAC,YACAC,iBFzJW7B,GAGPsE,EGnCqBC,MAC3B,MAAOC,EAAoBC,IAAyBvjB,EAAAA,EAAAA,UAAwB,OACrEwjB,EAAsBC,IAA2BzjB,EAAAA,EAAAA,WAAS,IAC1D0jB,EAAkBC,IAAuB3jB,EAAAA,EAAAA,WAAS,IAClD4jB,EAAyBC,IAA8B7jB,EAAAA,EAAAA,WAAS,IAChE8jB,EAAuBC,IAA4B/jB,EAAAA,EAAAA,WAAS,IAC5DgkB,EAA4BC,IAAiCjkB,EAAAA,EAAAA,WAAS,IACtEkkB,EAA8BC,IAAmCnkB,EAAAA,EAAAA,WAAS,IAC1EokB,EAA0BC,IAA+BrkB,EAAAA,EAAAA,UAAwB,OACjFskB,EAAmBC,IAAwBvkB,EAAAA,EAAAA,UAAiB,KAC5DwkB,EAAwBC,IAA6BzkB,EAAAA,EAAAA,UAAiB,IACtEmT,EAAqBuR,IAA0B1kB,EAAAA,EAAAA,UAG5C,MAGJ2kB,GAAiB5E,EAAAA,EAAAA,cAAazI,IAClCiM,EAAsBjM,KACrB,IAGGsN,GAAkB7E,EAAAA,EAAAA,cAAY,KAClCwD,EAAsB,QACrB,IAGGsB,GAAoB9E,EAAAA,EAAAA,cAAY,KACpC0D,GAAwB,KACvB,IAGGqB,GAAqB/E,EAAAA,EAAAA,cAAY,KACrC0D,GAAwB,KACvB,IAGGsB,GAAgBhF,EAAAA,EAAAA,cAAY,KAChC4D,GAAoB,KACnB,IAGGqB,GAAiBjF,EAAAA,EAAAA,cAAY,KACjC4D,GAAoB,KACnB,IAGGsB,GAA4BlF,EAAAA,EAAAA,cAAazI,IAC7C+M,EAA4B/M,GAC5B6M,GAAgC,GAChCM,EAA0BnN,KACzB,IAGG4N,GAA6BnF,EAAAA,EAAAA,cAAY,KAC7CoE,GAAgC,GAChCE,EAA4B,QAC3B,IAGGc,GAAqBpF,EAAAA,EAAAA,cAAY,KACrCgE,GAAyB,KACxB,IAGGqB,GAAsBrF,EAAAA,EAAAA,cAAY,KACtCgE,GAAyB,KACxB,IAGGsB,GAAuBtF,EAAAA,EAAAA,cAAY,KACvC8D,GAA2B,KAC1B,IAGGyB,GAAwBvF,EAAAA,EAAAA,cAAY,KACxC8D,GAA2B,KAC1B,IAGG0B,GAA0BxF,EAAAA,EAAAA,cAAarT,IAC3C6X,EAAqB7X,GACrBuX,GAA8B,KAC7B,IAGGuB,GAA2BzF,EAAAA,EAAAA,cAAY,KAC3CkE,GAA8B,GAC9BM,EAAqB,MACpB,IAGGkB,GAAiB1F,EAAAA,EAAAA,cAAY,KACjCwD,EAAsB,MACtBE,GAAwB,GACxBE,GAAoB,GACpBE,GAA2B,GAC3BE,GAAyB,GACzBE,GAA8B,GAC9BE,GAAgC,GAChCE,EAA4B,MAC5BE,EAAqB,IACrBG,EAAuB,QACtB,IAEH,MAAO,CAELpB,qBACAE,uBACAE,mBACAE,0BACAE,wBACAE,6BACAE,+BACAE,2BACAE,oBACAE,yBACArR,sBAGAoQ,wBACAE,0BACAE,sBACAE,6BACAE,2BACAE,gCACAE,kCACAE,8BACAE,uBACAE,4BACAC,yBAGAC,iBACAC,kBACAC,oBACAC,qBACAC,gBACAC,iBACAC,4BACAC,6BACAC,qBACAC,sBACAC,uBACAC,wBACAC,0BACAC,2BACAC,mBHhHapC,GAGThL,EI9BoB7Y,KAMF,IANG,eAC3BkmB,EAAc,SACd7K,EAAQ,sBACR2C,EAAqB,qBACrBD,EAAoB,aACpBjF,GACkB9Y,EAElB,MAAMmmB,GAAuB5F,EAAAA,EAAAA,cAC1B1H,GACQA,EAAM1V,KAAIC,IAEf,IAAKA,EAAK+K,WAAY,OAAO/K,EAG7B,IAAKA,EAAKuT,SACR,OAAAgB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKvU,GAAI,IAEPyT,aAAczT,EAAKyT,cAAgB,GACnClS,aAAcvB,EAAKuB,cAAgB,GACnC8U,eAAgBrW,EAAKqW,gBAAkB,EACvC2J,cAAehgB,EAAKggB,eAAiB,KAKzC,MAAMgD,EAAkBhjB,EAAaijB,UAI/BC,GADgBjL,EAAW2C,EAAwBD,GACrBvR,MAAMqD,GAAWA,EAAExM,MAAQD,EAAKuT,WAG9D7H,EAAQsX,GAAkBE,EAEhC,GAAIxX,EAAO,CAAC,IAAD4C,EAAA6U,EACT,MAAMC,EAAY1X,EAAM0B,YAAc,EAGhCiW,GAAgB,OAAL3X,QAAK,IAALA,GAAkB,QAAb4C,EAAL5C,EAAOyB,mBAAW,IAAAmB,GAAa,QAAb6U,EAAlB7U,EAAoBhN,mBAAW,IAAA6hB,OAA1B,EAALA,EAAiCxM,aAAkB,OAALjL,QAAK,IAALA,OAAK,EAALA,EAAOiL,WAIhE2M,EAAYF,GAHEC,EAAWE,SAASF,GAAY,GAK9C9M,GAAcvW,EAAKyW,KAAO,GAAK2M,GAAapjB,EAAK0W,WAAa,GAAK4M,EAInElN,EAAgBpW,EAAKqW,gBAAkB,EAE7C,IAAIO,EAASL,EACRb,EAAaI,gBAChBc,EAASL,EAAcA,EAAaH,EAAiB,KAIvD,MAAMoN,EAAU9X,EAAMwB,UAAYlN,EAAKkN,UAAY,GAEnD,OAAAqH,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACKvU,GAAI,IACP2E,MAAO3E,EAAK2E,OAASye,EACrB5F,IAAK9R,EAAM8R,KAAO4F,EAClBxM,OAAQA,EACRP,eAAgBD,EAEhB3C,aAAczT,EAAKyT,cAAgB,GACnClS,aAAcvB,EAAKuB,cAAgB,GACnCye,cAAehgB,EAAKggB,eAAiB,GACrC9S,SAAUsW,EACVP,WAAS1O,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACJ7I,GAAK,IACRwB,SAAUsW,KAGhB,CAEA,OAAOxjB,MAGX,CAACiY,EAAU2C,EAAuBD,EAAsBjF,IAIpD+N,GAA0BtG,EAAAA,EAAAA,cAC7B1H,GACQA,EAAM1V,KAAIC,IAEf,MAAM0jB,EAAiB1jB,EAAaijB,UAC9BO,EAAUxjB,EAAKkN,WAAyB,OAAbwW,QAAa,IAAbA,OAAa,EAAbA,EAAexW,WAAY,GAEtDyW,EAAqB,CACzB5Y,WAAY/K,EAAK+K,YAAc,GAC/B0I,aAAczT,EAAKyT,cAAgB,GACnClS,aAAcvB,EAAKuB,cAAgB,GACnCgS,SAAUvT,EAAKuT,UAAY,GAC3BrG,SAAUsW,EACV/M,IAAKzW,EAAKyW,KAAO,EACjBC,UAAW1W,EAAK0W,WAAa,EAC7B/R,MAAO3E,EAAK2E,OAAS,EACrB6Y,IAAKxd,EAAKwd,KAAO,EACjB5G,OAAQ5W,EAAK4W,QAAU,EACvBP,eAAgBrW,EAAKqW,gBAAkB,EACvC2J,cAAehgB,EAAKggB,eAAiB,GACrCiD,UAAWS,GAIb,GAAI1jB,EAAKuT,WAAavT,EAAKyW,KAAOzW,EAAK0W,WAAY,CACjD,MACMhL,GADgBuM,EAAW2C,EAAwBD,GAC7BvR,MAAMqD,GAAWA,EAAExM,MAAQD,EAAKuT,WAE5D,GAAI7H,EAAO,CAAC,IAADkY,EAAAC,EAET,MAAMR,EAAgB,OAAL3X,QAAK,IAALA,GAAkB,QAAbkY,EAALlY,EAAOyB,mBAAW,IAAAyW,GAAa,QAAbC,EAAlBD,EAAoBtiB,mBAAW,IAAAuiB,OAA1B,EAALA,EAAiClN,UAC5CmN,EAAcT,EAAWE,SAASF,GAAY,EAG9CU,EAAmBrY,EAAMK,oBAAsB,EAC/CiY,EAAoBtY,EAAM+C,0BAA4B,EAGxDzO,EAAKyW,KAAOzW,EAAKyW,IAAMsN,IACzBta,EAAAA,GAAQ2C,MAAM,kBAADzC,OACO3J,EAAKyW,IAAG,+BAAA9M,OAA8Boa,EAAgB,MAE1EJ,EAASlN,IAAMsN,GAIjB,MAAME,EAAiBF,GAAoB/jB,EAAKyW,KAAO,GAEjDyN,EAD6BD,EAAiBH,EACHE,EAG7ChkB,EAAK0W,WAAa1W,EAAK0W,UAAYwN,IACrCza,EAAAA,GAAQ2C,MAAM,mBAADzC,OACQ3J,EAAK0W,UAAS,qCAAA/M,OAAoCua,EAAW,OAAAva,OAAMsa,EAAc,0BAAAta,OAAsBma,EAAW,OAAAna,OAAMqa,EAAiB,YAE9JL,EAASjN,UAAYwN,EAEzB,CACF,CAEA,OAAOP,MAGX,CAAC1L,EAAU2C,EAAuBD,IAgBpC,MAAO,CACLwJ,mBAdwBhH,EAAAA,EAAAA,cACvB1H,IAEC,MAAM2O,EAAiBX,EAAwBhO,GAK/C,OAFyBsN,EAAqBqB,KAIhD,CAACX,EAAyBV,IAK1BA,uBACAU,4BJzIYY,CAAa,CACzBvB,eAAgB,GAChB7K,SAAUH,EAASG,SACnB2C,sBAAuB9C,EAAS8C,sBAChCD,qBAAsB7C,EAAS6C,qBAC/BjF,aAAcuG,EAAKvG,eAIfC,EAAmBH,EACvByG,EAAKE,aAAa1G,MAClBwG,EAAKvG,cAID4O,EKnCuBC,KAC7B,MAAMC,GAAWC,EAAAA,EAAAA,OACVC,EAAeC,IAAoBvnB,EAAAA,EAAAA,UAAc,OACjDwnB,EAAgBC,IAAqBznB,EAAAA,EAAAA,UAAc,OACnD0nB,EAAgBC,IAAqB3nB,EAAAA,EAAAA,UAAc,MAGpDqmB,GAA0BtG,EAAAA,EAAAA,cAAa1H,GAClB,IAGxB,IAwOH,MAAO,CACLiP,gBACAE,iBACAE,iBACAE,iBAzOsB7H,EAAAA,EAAAA,cAAY8H,UAClC,IAAKV,EAAOpI,aAAaE,WAEvB,OADA5S,EAAAA,GAAQ2C,MAAM,mCACP,EAGT,IAAKmY,EAAOpI,aAAa1G,OAA8C,IAArC8O,EAAOpI,aAAa1G,MAAMjX,OAE1D,OADAiL,EAAAA,GAAQ2C,MAAM,0DACP,EAIT,GAA0B,IADPmY,EAAOpI,aAAa1G,MAAMtV,QAAQH,GAAcA,EAAK+K,aACzDvM,OAEb,OADAiL,EAAAA,GAAQ2C,MAAM,0DACP,EAGT,MAAM8Y,GAAO3Q,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,CACX8H,WAAYkI,EAAOpI,aAAaE,WAChChI,KAAMkQ,EAAOpI,aAAa9H,MAAQzI,MAAQM,OAAO,cACjDoQ,YAAaiI,EAAOpI,aAAaG,aAAe,KAChDE,UAAW+H,EAAOpI,aAAaK,WAAa,KAC5CE,aAAc6H,EAAOpI,aAAaO,cAAgB,OAClDjH,MAAO8O,EAAOpI,aAAa1G,MAAM1V,KAAKC,IAASuU,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,CAC7CxJ,WAAY/K,EAAK+K,YAAc,KAC/BwI,SAAUvT,EAAKuT,UAAY,MACvBgR,EAAOtM,UAAYjY,EAAKuT,UAAY,CAAEsM,gBAAiB7f,EAAKuT,WAAY,CAAF,GAC1EkD,IAAKzW,EAAKyW,KAAO,EACjBC,UAAW1W,EAAK0W,WAAa,EAC7B/R,MAAO3E,EAAK2E,OAAS,EACrB6Y,IAAKxd,EAAKwd,KAAO,EACjB5G,OAAQ5W,EAAK4W,QAAU,EACvBP,eAAgBrW,EAAKqW,gBAAkB,EACvCpW,IAAKD,EAAKC,SAETskB,EAAO5O,kBAAgB,IAC1BI,SAAUwO,EAAO7O,aAAaK,SAC9BsK,cAAekE,EAAO7O,aAAaM,aACnCiK,QAASsE,EAAO7O,aAAakH,OAC7BsD,kBAAmBqE,EAAO7O,aAAamH,gBACvCsD,UAAWoE,EAAO7O,aAAaoH,SAAW,SAAW,YACrDsD,gBAAiBmE,EAAO7O,aAAaI,cACrCwK,YAAaiE,EAAO7O,aAAamH,gBAC7B0H,EAAO7O,aAAaqH,WACpBwH,EAAO7O,aAAakH,OAClB2H,EAAO5O,iBAAiByB,aACxB,EACNjJ,OAAQ,QACRoS,cAAegE,EAAOvH,eAGxB,IAAK,IAADmI,EACF,IAAIC,EACJ,GAAIb,EAAO3M,SAAU,CACnB,MAAMpY,QAAe+kB,EAAOhJ,kBAAkBgJ,EAAO3M,SAAS3X,IAAKilB,GACnE,IAAI1lB,EAAOf,KAIT,MAAMe,EAAO4M,MAHbgZ,EAAW5lB,EAAOf,KAClBsmB,EAAkBK,EAItB,KAAO,CACL,MAAM5lB,QAAe+kB,EAAOpJ,kBAAkB+J,GAC9C,IAAI1lB,EAAOf,KAIT,MAAMe,EAAO4M,MAHbgZ,EAAW5lB,EAAOf,KAClBomB,EAAkBO,EAItB,CAEA,GAA6B,OAAjB,QAARD,EAAAC,SAAQ,IAAAD,OAAA,EAARA,EAAUE,YAAoB,CAAC,IAADC,EAChC7b,EAAAA,GAAQC,QAAQ,6BAChB,MAAM6b,GAAShR,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACV2Q,GAAO,IACV3I,cAAegI,EAAOpI,aAAaI,cACnCnF,aAAcmN,EAAO5O,iBAAiByB,eAIxC,OAFAuN,EAAiBY,GACG,QAApBD,EAAAf,EAAOiB,qBAAa,IAAAF,GAApBA,EAAAG,KAAAlB,EAAuBgB,IAChB,CACT,CACA,OAAO,CACT,CAAE,MAAOnZ,GAAa,IAADsZ,EAAAC,EAEnB,GAA+B,wBAAtB,OAALvZ,QAAK,IAALA,GAAW,QAANsZ,EAALtZ,EAAO3N,YAAI,IAAAinB,OAAN,EAALA,EAAaE,YAAkE,OAAvB,OAALxZ,QAAK,IAALA,GAAW,QAANuZ,EAALvZ,EAAO3N,YAAI,IAAAknB,OAAN,EAALA,EAAaN,YAAoB,CAAC,IAADQ,EAAAC,EACtF,MAAMC,EAAY,OAAL3Z,QAAK,IAALA,GAAW,QAANyZ,EAALzZ,EAAO3N,YAAI,IAAAonB,OAAN,EAALA,EAAaE,KACpBza,GAAoB,OAALc,QAAK,IAALA,GAAW,QAAN0Z,EAAL1Z,EAAO3N,YAAI,IAAAqnB,OAAN,EAALA,EAAarc,UAAW,oDAE7C,GAAIsc,EAAM,CAAC,IAADC,EACR,MAAMC,EAAe,GAAAtc,OAAM2B,EAAY,uBAAA3B,OAAsBoc,EAAKG,cAAa,OAAAvc,OAAMoc,EAAKI,UAAS,KAAAxc,OAAIoc,EAAKK,cAAa,YAAAzc,OAAyB,QAAzBqc,EAAWD,EAAKM,iBAAS,IAAAL,OAAA,EAAdA,EAAgBM,cAAa,aAAA3c,OAAYoc,EAAKQ,iBAAgB,KAClM9c,EAAAA,GAAQ2C,MAAM6Z,EAAiB,EACjC,MACExc,EAAAA,GAAQ2C,MAAMd,EAAc,EAEhC,MACE7B,EAAAA,GAAQ2C,MAAM,2CAEhB,OAAO,CACT,IACC,CAACmY,EAAQC,IAsIVgC,oBAnIyBrJ,EAAAA,EAAAA,cAAY8H,UACrC,IACGV,EAAOpI,aAAaE,aACpBkI,EAAOpI,aAAaG,cACpBiI,EAAOpI,aAAa1G,MAAMjX,OAG3B,OADAiL,EAAAA,GAAQ2C,MAAM,oCACP,EAQT,GALwBmY,EAAOpI,aAAa1G,MAAMgR,MAC/CzmB,IACEA,EAAK+K,aAAe/K,EAAKuT,WAAcvT,EAAKyW,MAAQzW,EAAK0W,YAAe1W,EAAK2E,QAKhF,OADA8E,EAAAA,GAAQ2C,MAAM,qCACP,EAGT,MAAMsa,EAAwBjD,EAAwBc,EAAOpI,aAAa1G,OAC1E,GAAIiR,EAAsBloB,OAAS,EAEjC,OADAiL,EAAAA,GAAQ2C,MAAM,6BAADzC,OAA8B+c,EAAsBC,KAAK,SAC/D,EAGT,MAAMzB,GAAO3Q,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,CACX8H,WAAYkI,EAAOpI,aAAaE,WAChChI,KAAMkQ,EAAOpI,aAAa9H,KAC1BiI,YAAaiI,EAAOpI,aAAaG,YACjCE,UAAW+H,EAAOpI,aAAaK,UAC/BE,aAAc6H,EAAOpI,aAAaO,aAClCjH,MAAO8O,EAAOpI,aAAa1G,MAAM1V,KAAKC,IAASuU,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,CAC7CxJ,WAAY/K,EAAK+K,WACjBwI,SAAUvT,EAAKuT,UACXgR,EAAOtM,UAAY,CAAE4H,gBAAiB7f,EAAKuT,WAAY,CAAF,GACzDkD,IAAKzW,EAAKyW,IACVC,UAAW1W,EAAK0W,UAChB/R,MAAO3E,EAAK2E,MACZ6Y,IAAKxd,EAAKwd,IACV5G,OAAQ5W,EAAK4W,OACbP,eAAgBrW,EAAKqW,eACrByJ,SAAU9f,EAAK8f,UAAY,GAC3BC,QAAS/f,EAAK+f,SAAW,GACzBhK,SAAU/V,EAAK+V,UAAY,EAC3BlM,YAAa7J,EAAK6J,aAAe,GACjC4J,aAAczT,EAAKyT,cAAgB,GACnClS,aAAcvB,EAAKuB,cAAgB,GACnCtB,IAAKD,EAAKC,SAETskB,EAAO5O,kBAAgB,IAC1BI,SAAUwO,EAAO7O,aAAaK,SAC9BsK,cAAekE,EAAO7O,aAAaM,aACnCiK,QAASsE,EAAO7O,aAAakH,OAC7BsD,kBAAmBqE,EAAO7O,aAAamH,gBACvCsD,UAAWoE,EAAO7O,aAAaoH,SAAW,SAAW,YACrDsD,gBAAiBmE,EAAO7O,aAAaI,cACrCwK,YAAaiE,EAAO7O,aAAamH,gBAC7B0H,EAAO7O,aAAaqH,WACpBwH,EAAO7O,aAAakH,OAClB2H,EAAO5O,iBAAiByB,aACxB,EACNjJ,OAAQ,YACRoS,cAAegE,EAAOvH,eAGxB,IAAK,IAAD4J,EACF,IAAIxB,EACJ,GAAIb,EAAO3M,SAAU,CACnB,MAAMpY,QAAe+kB,EAAOhJ,kBAAkBgJ,EAAO3M,SAAS3X,IAAKilB,GACnE,IAAI1lB,EAAOf,KAIT,MAAMe,EAAO4M,MAHbgZ,EAAW5lB,EAAOf,KAClBsmB,EAAkBK,EAItB,KAAO,CACL,MAAM5lB,QAAe+kB,EAAOpJ,kBAAkB+J,GAC9C,IAAI1lB,EAAOf,KAIT,MAAMe,EAAO4M,MAHbgZ,EAAW5lB,EAAOf,KAClBomB,EAAkBO,EAItB,CAEA,GAA6B,OAAjB,QAARwB,EAAAxB,SAAQ,IAAAwB,OAAA,EAARA,EAAUvB,YAAoB,CAAC,IAADwB,EAChC,MAAMtB,GAAShR,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACV2Q,GAAO,IACV3I,cAAegI,EAAOpI,aAAaI,cACnCnF,aAAcmN,EAAO5O,iBAAiByB,eAcxC,OAZAuN,EAAiBY,GAGjBf,EAAS3lB,EAAAA,GAASioB,KAAKC,eAAe,CAAC,aAAc,iBAEjC,QAApBF,EAAAtC,EAAOiB,qBAAa,IAAAqB,GAApBA,EAAApB,KAAAlB,EAAuBgB,GAGlBhB,EAAO3M,UACV2M,EAAO7I,oBAAoB,CAAC,IAGvB,CACT,CACA,OAAO,CACT,CAAE,MAAOtP,GAAa,IAAD4a,EAAAC,EAEnB,GAA+B,wBAAtB,OAAL7a,QAAK,IAALA,GAAW,QAAN4a,EAAL5a,EAAO3N,YAAI,IAAAuoB,OAAN,EAALA,EAAapB,YAAkE,OAAvB,OAALxZ,QAAK,IAALA,GAAW,QAAN6a,EAAL7a,EAAO3N,YAAI,IAAAwoB,OAAN,EAALA,EAAa5B,YAAoB,CAAC,IAAD6B,EAAAC,EACtF,MAAMpB,EAAY,OAAL3Z,QAAK,IAALA,GAAW,QAAN8a,EAAL9a,EAAO3N,YAAI,IAAAyoB,OAAN,EAALA,EAAanB,KACpBza,GAAoB,OAALc,QAAK,IAALA,GAAW,QAAN+a,EAAL/a,EAAO3N,YAAI,IAAA0oB,OAAN,EAALA,EAAa1d,UAAW,oDAE7C,GAAIsc,EAAM,CAAC,IAADqB,EACR,MAAMnB,EAAe,GAAAtc,OAAM2B,EAAY,uBAAA3B,OAAsBoc,EAAKG,cAAa,OAAAvc,OAAMoc,EAAKI,UAAS,KAAAxc,OAAIoc,EAAKK,cAAa,YAAAzc,OAAyB,QAAzByd,EAAWrB,EAAKM,iBAAS,IAAAe,OAAA,EAAdA,EAAgBd,cAAa,aAAA3c,OAAYoc,EAAKQ,iBAAgB,KAClM9c,EAAAA,GAAQ2C,MAAM6Z,EAAiB,EACjC,MACExc,EAAAA,GAAQ2C,MAAMd,EAAc,EAEhC,MACE7B,EAAAA,GAAQ2C,MAAM,8CAEhB,OAAO,CACT,IACC,CAACmY,EAAQd,EAAyBe,IAQnCG,mBACAE,oBACAE,sBLxNcsC,CAAe,CAC7BlL,aAAcF,EAAKE,aACnBzG,aAAcuG,EAAKvG,aACnBC,mBACAqH,aAAcf,EAAKe,aACnB/E,SAAUH,EAASG,SACnBkD,kBAAmBrD,EAASqD,kBAC5BI,kBAAmBzD,EAASyD,kBAC5BG,oBAAqB5D,EAAS4D,oBAC9B9D,WACAC,YACA2N,cAAgBD,IACd/E,EAAOiC,0BAKL0B,GAAoBhH,EAAAA,EAAAA,cACvB5d,IACC,MAAM+nB,EAAkB7R,EAAM0O,kBAAkB5kB,GAChD0c,EAAKoB,YAAYiK,KAEnB,CAAC7R,EAAOwG,IAIJsL,GAAuBpK,EAAAA,EAAAA,cAC3B,CAACzI,EAAkB8S,EAA4B1hB,KAC7C,MAAMvG,EAAW,IAAI0c,EAAKE,aAAa1G,OACjCzV,EAAOT,EAASmV,GAGtBnV,EAASmV,IAASH,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQvU,GAAI,IAAE,CAACwnB,GAAQ1hB,IAGzCqe,EAAkB5kB,KAEpB,CAAC0c,EAAKE,aAAa1G,MAAO0O,IAItB9Q,GAAsB8J,EAAAA,EAAAA,cAC1B,CAACrY,EAAc2iB,KAAqB,IAADtR,EAAAD,EAAAwR,EACjC,MAAMnoB,EAAW,IAAI0c,EAAKE,aAAa1G,OAGvC,IAAIf,EAEFA,EADwB,kBAAf+S,EACEA,EAGAloB,EAASiJ,WAAUxI,GAASA,EAAa0D,MAAQ+jB,EAAW/jB,OAGvD,IAAdgR,GAMJnV,EAASmV,GAAU3J,WAAajG,EAAQyJ,IAAMzJ,EAAQ7E,KAAO,GAC7DV,EAASmV,GAAUjB,aAAe3O,EAAQ3D,MAAQ,GAClD5B,EAASmV,GAAUnT,cAAkC,QAAnB4U,EAAArR,EAAQxD,mBAAW,IAAA6U,OAAA,EAAnBA,EAAqB5U,eAAgB,GACvEhC,EAASmV,GAAU/P,MAAQG,EAAQrD,eAAiB,EACpDlC,EAASmV,GAAU2B,gBAAqC,QAApBH,EAAApR,EAAQwR,oBAAY,IAAAJ,OAAA,EAApBA,EAAsBG,iBAAkB,EAC5E9W,EAASmV,GAAUsL,eAAoC,QAApB0H,EAAA5iB,EAAQwR,oBAAY,IAAAoR,OAAA,EAApBA,EAAsB1H,gBAAiB,GAE1EmE,EAAkB5kB,GAClBihB,EAAOuB,eAAerN,IAbpBiT,QAAQvb,MAAM,4DAelB,CAAC6P,EAAKE,aAAa1G,MAAO0O,EAAmB3D,IAIzClN,GAAoB6J,EAAAA,EAAAA,cACvBzR,IAAgB,IAAD4C,EAAA6U,EACd,GAAkC,OAA9B3C,EAAOE,mBAA6B,OAExC,MAAMnhB,EAAW,IAAI0c,EAAKE,aAAa1G,OACjCf,EAAW8L,EAAOE,mBAClBkH,GAAWrT,EAAAA,EAAAA,GAAA,GAAQhV,EAASmV,IAElCkT,EAAYrU,SAAW7H,EAAM6C,IAAM7C,EAAMzL,KAAO,GAChD2nB,EAAY1a,SAAWxB,EAAMwB,UAAY,GAEzC,MAAM2a,EAAmBnc,EAAMyB,YACR,IAAD2a,EAAAC,EAAAC,EAAlBH,IACFD,EAAY7c,WAAa6c,EAAY7c,YAAc8c,EAAiB5nB,KAAO,GAC3E2nB,EAAYnU,aAAeoU,EAAiB1mB,MAAQymB,EAAYnU,cAAgB,GAChFmU,EAAYrmB,aACVqmB,EAAYrmB,eAA4C,QAAhCumB,EAAID,EAAiBvmB,mBAAW,IAAAwmB,OAAA,EAA5BA,EAA8BvmB,eAAgB,GAC5EqmB,EAAYvR,eAC4B,kBAA/BuR,EAAYvR,qBAA8DlO,IAA/Byf,EAAYvR,eAC1DuR,EAAYvR,gBACiB,QAA7B0R,EAAAF,EAAiBvR,oBAAY,IAAAyR,OAAA,EAA7BA,EAA+B1R,iBAAkB,EACvDuR,EAAY5H,cACV4H,EAAY5H,gBAA8C,QAAjCgI,EAAIH,EAAiBvR,oBAAY,IAAA0R,OAAA,EAA7BA,EAA+BhI,gBAAiB,IAIhF4H,EAAoB3E,UAAY,CAC/BhjB,IAAKyL,EAAM6C,IAAM7C,EAAMzL,IACvB8L,mBAAoBL,EAAMK,oBAAsB,EAChD0C,yBAA0B/C,EAAM+C,0BAA4B,EAC5DvB,SAAUxB,EAAMwB,UAAY,GAC5ByJ,WAA4B,QAAjBrI,EAAA5C,EAAMyB,mBAAW,IAAAmB,GAAa,QAAb6U,EAAjB7U,EAAmBhN,mBAAW,IAAA6hB,OAAb,EAAjBA,EAAgCxM,YAAa,EACxDvJ,WAAY1B,EAAM0B,YAAc,EAChCoQ,IAAK9R,EAAM8R,KAAO9R,EAAM0B,YAAc,EACtCD,YAAazB,EAAMyB,aAGrB5N,EAASmV,GAAYkT,EAErBzD,EAAkB5kB,GAClBihB,EAAOwB,kBAIPxB,EAAOsB,uBAAuB,CAAEvU,IAAKiT,EAAOE,mBAAoB3P,IAD5C,MAGtB,CAACyP,EAAQvE,EAAKE,aAAa1G,MAAO0O,IAI9B8D,GAAc9K,EAAAA,EAAAA,cAAY8H,UAC9B,IAAKhJ,EAAKE,aAAa1G,OAA4C,IAAnCwG,EAAKE,aAAa1G,MAAMjX,OAEtD,YADAiL,EAAAA,GAAQG,QAAQ,oCAKlB,MACMse,EADYpQ,EAAS0C,mBACKpR,MAAM3I,GAAWA,EAAER,MAAQgc,EAAKE,aAAaG,cAEvE6L,EAAiB,CACrB9L,WAAYJ,EAAKE,aAAaE,WAC9BhI,KAAM4H,EAAKE,aAAa9H,KACxB+T,cAA2B,OAAbF,QAAa,IAAbA,OAAa,EAAbA,EAAerJ,aAA0B,OAAbqJ,QAAa,IAAbA,OAAa,EAAbA,EAAe/mB,OAAQ,GACjEknB,iBAA8B,OAAbH,QAAa,IAAbA,OAAa,EAAbA,EAAeI,WAAwB,OAAbJ,QAAa,IAAbA,OAAa,EAAbA,EAAeK,WAAY,GACtEC,cAA2B,OAAbN,QAAa,IAAbA,OAAa,EAAbA,EAAeO,OAAQ,GACrCC,eAA4B,OAAbR,QAAa,IAAbA,OAAa,EAAbA,EAAeS,QAAS,GACvCC,iBAA8B,OAAbV,QAAa,IAAbA,OAAa,EAAbA,EAAeW,UAAW,GAC3CC,eAA4B,OAAbZ,QAAa,IAAbA,OAAa,EAAbA,EAAea,SAAsB,OAAbb,QAAa,IAAbA,OAAa,EAAbA,EAAec,SAAU,GAChEC,eAA4B,OAAbf,QAAa,IAAbA,OAAa,EAAbA,EAAegB,QAAS,GACvCC,gBAA6B,OAAbjB,QAAa,IAAbA,OAAa,EAAbA,EAAekB,SAAU,GACzCC,cAA2B,OAAbnB,QAAa,IAAbA,OAAa,EAAbA,EAAeoB,SAAU,GACvC7T,MAAOwG,EAAKE,aAAa1G,MACzB9V,MAAOgW,EAAiByB,aACxBA,aAAczB,EAAiByB,aAC/BD,eAAgBxB,EAAiBwB,eACjCN,UAAWlB,EAAiBkB,UAC5BK,UAAWvB,EAAiBuB,UAC5BM,KAAM7B,EAAiB6B,KACvBC,KAAM9B,EAAiB8B,KACvBR,cAAetB,EAAiBsB,cAChClB,SAAUkG,EAAKvG,aAAaK,SAC5BsK,cAAepE,EAAKvG,aAAaM,aACjCoK,gBAAiBnE,EAAKvG,aAAaI,cACnC4G,aAAcT,EAAKE,aAAaO,aAEhCuD,QAAShE,EAAKvG,aAAakH,OAC3BsD,kBAAmBjE,EAAKvG,aAAamH,gBACrCyD,YAAarE,EAAKvG,aAAamH,gBAC3BZ,EAAKvG,aAAaqH,WAClBd,EAAKvG,aAAakH,OAChBjH,EAAiByB,aACjB,EACNiB,kBAAmBP,EAAS+C,oBAC5BE,YAAajD,EAASgD,eAIxB,IAAIyO,EAAgB,GACpB,GAAY,OAARvO,QAAQ,IAARA,GAAAA,EAAUwO,mBAA6B,OAARxO,QAAQ,IAARA,GAAAA,EAAUyO,OAC3C,IACE,MAAM,kBAAEC,EAAiB,sBAAEC,SAAgC,sCACrDC,EAAYD,EAAsBxB,EAAgBnN,GACpD4O,IACFL,QAAsBG,EAAkBE,EAAW,CAAEjmB,OAAe,OAARqX,QAAQ,IAARA,OAAQ,EAARA,EAAU6O,UAAW,MAErF,CAAE,MAAOzd,GACPub,QAAQvb,MAAM,sCAAuCA,EACvD,CAIF,MAAM0d,GAAgBvV,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACjByG,GAAQ,IACXuO,kBAIIQ,EAA0C,SAAtB9N,EAAKe,aAC3BlB,EACAC,EAGEiO,EAAUC,EAAAA,cAAoBF,EAAmB,CACrDjS,SAAUqQ,EACVnN,SAAU8O,IAENI,EAAeC,EAAAA,eAA8BH,IAG7C,WAAEI,SAAqB,yDACvBC,EAAQ,GAAA1gB,OAAMsS,EAAKe,aAAY,KAAArT,OAAIwe,EAAe9L,WAAU,KAAA1S,OAAIiC,MAAQM,OAAO,mBAE/Eke,EAAWF,EAAcG,EAAUpO,EAAKe,gBAC7C,CAACf,EAAMtG,EAAkBmC,EAAUgE,EAAuBC,EAA0Bf,IAGjFsP,GAAiBnN,EAAAA,EAAAA,cAAY8H,UACjC,IAAKhJ,EAAKE,aAAa1G,OAA4C,IAAnCwG,EAAKE,aAAa1G,MAAMjX,OAEtD,YADAiL,EAAAA,GAAQG,QAAQ,uCAKlB,MACMse,EADYpQ,EAAS0C,mBACKpR,MAAM3I,GAAWA,EAAER,MAAQgc,EAAKE,aAAaG,cAEvE6L,EAAiB,CACrB9L,WAAYJ,EAAKE,aAAaE,WAC9BhI,KAAM4H,EAAKE,aAAa9H,KACxB+T,cAA2B,OAAbF,QAAa,IAAbA,OAAa,EAAbA,EAAerJ,aAA0B,OAAbqJ,QAAa,IAAbA,OAAa,EAAbA,EAAe/mB,OAAQ,GACjEknB,iBAA8B,OAAbH,QAAa,IAAbA,OAAa,EAAbA,EAAeI,WAAwB,OAAbJ,QAAa,IAAbA,OAAa,EAAbA,EAAeK,WAAY,GACtEC,cAA2B,OAAbN,QAAa,IAAbA,OAAa,EAAbA,EAAeO,OAAQ,GACrCC,eAA4B,OAAbR,QAAa,IAAbA,OAAa,EAAbA,EAAeS,QAAS,GACvCC,iBAA8B,OAAbV,QAAa,IAAbA,OAAa,EAAbA,EAAeW,UAAW,GAC3CC,eAA4B,OAAbZ,QAAa,IAAbA,OAAa,EAAbA,EAAea,SAAsB,OAAbb,QAAa,IAAbA,OAAa,EAAbA,EAAec,SAAU,GAChEC,eAA4B,OAAbf,QAAa,IAAbA,OAAa,EAAbA,EAAegB,QAAS,GACvCC,gBAA6B,OAAbjB,QAAa,IAAbA,OAAa,EAAbA,EAAekB,SAAU,GACzCC,cAA2B,OAAbnB,QAAa,IAAbA,OAAa,EAAbA,EAAeoB,SAAU,GACvC7T,MAAOwG,EAAKE,aAAa1G,MACzB9V,MAAOgW,EAAiByB,aACxBA,aAAczB,EAAiByB,aAC/BD,eAAgBxB,EAAiBwB,eACjCN,UAAWlB,EAAiBkB,UAC5BK,UAAWvB,EAAiBuB,UAC5BM,KAAM7B,EAAiB6B,KACvBC,KAAM9B,EAAiB8B,KACvBR,cAAetB,EAAiBsB,cAChClB,SAAUkG,EAAKvG,aAAaK,SAC5BsK,cAAepE,EAAKvG,aAAaM,aACjCoK,gBAAiBnE,EAAKvG,aAAaI,cACnC4G,aAAcT,EAAKE,aAAaO,aAEhCuD,QAAShE,EAAKvG,aAAakH,OAC3BsD,kBAAmBjE,EAAKvG,aAAamH,gBACrCyD,YAAarE,EAAKvG,aAAamH,gBAC3BZ,EAAKvG,aAAaqH,WAClBd,EAAKvG,aAAakH,OAChBjH,EAAiByB,aACjB,EACNiB,kBAAmBP,EAAS+C,oBAC5BE,YAAajD,EAASgD,eAIxB,IAAIyO,EAAgB,GACpB,GAAY,OAARvO,QAAQ,IAARA,GAAAA,EAAUwO,mBAA6B,OAARxO,QAAQ,IAARA,GAAAA,EAAUyO,OAC3C,IACE,MAAM,kBAAEC,EAAiB,sBAAEC,SAAgC,sCACrDC,EAAYD,EAAsBxB,EAAgBnN,GACpD4O,IACFL,QAAsBG,EAAkBE,EAAW,CAAEjmB,OAAe,OAARqX,QAAQ,IAARA,OAAQ,EAARA,EAAU6O,UAAW,MAErF,CAAE,MAAOzd,GACPub,QAAQvb,MAAM,yCAA0CA,EAC1D,CAIF,MAAM0d,GAAgBvV,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACjByG,GAAQ,IACXuO,kBAIIQ,EAA0C,SAAtB9N,EAAKe,aAC3BlB,EACAC,EAGEiO,EAAUC,EAAAA,cAAoBF,EAAmB,CACrDjS,SAAUqQ,EACVnN,SAAU8O,IAENI,EAAeC,EAAAA,eAA8BH,IAG7C,cAAEO,SAAwB,yDAC1BF,EAAQ,GAAA1gB,OAAMsS,EAAKe,aAAY,KAAArT,OAAIwe,EAAe9L,WAAU,KAAA1S,OAAIiC,MAAQM,OAAO,mBAE/Eqe,EAAcL,EAAcG,EAAUpO,EAAKe,gBAChD,CAACf,EAAMtG,EAAkBmC,EAAUgE,EAAuBC,EAA0Bf,IAGjFwP,GM7UiCjG,EN6UI,CACzCkG,YAAaxO,EAAKqB,QAClBoN,cAAepG,EAAQU,gBACvB2F,iBAAkBrG,EAAQkC,mBAC1BoE,UAAWA,KACT3O,EAAK6B,YACLrU,EAAAA,GAAQC,QAAQ,oCAElBmhB,qBAAsBA,KAEpBrK,EAAO6B,0BAA0B7B,EAAOoB,yBAE1CkJ,aAActK,EAAO+B,mBACrBwI,mBAAoBA,KAElB,MAAMrW,EAAWuH,EAAKE,aAAa1G,MAAMjN,WACtCxI,GAAcA,EAAK+K,aAAe/K,EAAKuT,YAExB,IAAdmB,EACF8L,EAAOuB,eAAerN,GAEtBjL,EAAAA,GAAQG,QAAQ,kCAGpBohB,UAAW/C,EACXgD,cAAezK,EAAOyB,kBACtBiJ,QAAS1K,EAAO2B,cAChBgJ,QAAS7G,EAAQU,gBACjBoG,QAASnP,EAAKqB,QACd+N,QAASpD,EACTqD,QAASA,KACPrP,EAAK6B,YACLrU,EAAAA,GAAQC,QAAQ,uBAAwB,MM5W5CtK,EAAAA,EAAAA,YAAU,KACR,MAAMqS,EAAiB7L,IAErB,GAAc,OAAVA,EAAElC,IAGJ,OAFAkC,EAAEO,sBACFoe,EAAOkG,cAIT,GAAc,OAAV7kB,EAAElC,IAGJ,OAFAkC,EAAEO,sBACFoe,EAAOmG,gBAIT,GAAc,OAAV9kB,EAAElC,IAGJ,OAFAkC,EAAEO,sBACFoe,EAAOoG,mBAIT,GAAc,OAAV/kB,EAAElC,IAGJ,OAFAkC,EAAEO,sBACFoe,EAAOqG,YAIT,GAAc,OAAVhlB,EAAElC,IAGJ,OAFAkC,EAAEO,sBACFoe,EAAOsG,uBAIT,GAAc,OAAVjlB,EAAElC,IAGJ,OAFAkC,EAAEO,sBACFoe,EAAOuG,eAIT,GAAc,OAAVllB,EAAElC,IAGJ,OAFAkC,EAAEO,sBACFoe,EAAOwG,qBAIT,GAAc,OAAVnlB,EAAElC,IAGJ,OAFAkC,EAAEO,sBACFoe,EAAOyG,YAIT,GAAc,QAAVplB,EAAElC,IAGJ,OAFAkC,EAAEO,sBACFoe,EAAO0G,gBAKT,GAAIrlB,EAAE8L,QACJ,OAAQ9L,EAAElC,KACR,IAAK,IACHkC,EAAEO,iBACFoe,EAAO4G,UACP,MACF,IAAK,IACHvlB,EAAEO,iBACFoe,EAAO6G,UACP,MACF,IAAK,IACHxlB,EAAEO,iBACFoe,EAAO8G,UACP,MACF,IAAK,IACHzlB,EAAEO,iBACFoe,EAAO+G,UACP,MACF,IAAK,IACH1lB,EAAEO,iBACFoe,EAAO2G,UAMb,GAAItlB,EAAE8L,SAAW,UAAU6Z,KAAK3lB,EAAElC,KAAM,CACtCkC,EAAEO,iBACF,MAAMqlB,EAAgB7Z,SAAS6Z,cAC/B,GAAiB,OAAbA,QAAa,IAAbA,GAAAA,EAAeC,QAAQ,6BAA8B,CACvD,MAAMC,EAAQF,EAAche,cAAc,SACtCke,IACFA,EAAM5lB,MAAQF,EAAElC,IAChBgoB,EAAMC,cAAc,IAAIC,MAAM,SAAU,CAAEC,SAAS,KAEvD,CACF,GAIF,OADAla,SAASC,iBAAiB,UAAWH,GAC9B,IAAME,SAASE,oBAAoB,UAAWJ,KACpD,CAAC8S,IAGG,CACLiG,UAAW,CACT,CAAE9mB,IAAK,KAAMmG,YAAa,YAC1B,CAAEnG,IAAK,KAAMmG,YAAa,cAC1B,CAAEnG,IAAK,KAAMmG,YAAa,iBAC1B,CAAEnG,IAAK,KAAMmG,YAAa,cAC1B,CAAEnG,IAAK,KAAMmG,YAAa,kBAC1B,CAAEnG,IAAK,KAAMmG,YAAa,aAC1B,CAAEnG,IAAK,KAAMmG,YAAa,gBAC1B,CAAEnG,IAAK,KAAMmG,YAAa,SAC1B,CAAEnG,IAAK,MAAOmG,YAAa,mBAC3B,CAAEnG,IAAK,SAAUmG,YAAa,eAC9B,CAAEnG,IAAK,SAAUmG,YAAa,QAC9B,CAAEnG,IAAK,SAAUmG,YAAa,YAC9B,CAAEnG,IAAK,SAAUmG,YAAa,SAC9B,CAAEnG,IAAK,MAAOmG,YAAa,YAC3B,CAAEnG,IAAK,QAASmG,YAAa,QAC7B,CAAEnG,IAAK,MAAOmG,YAAa,aAxHQ0a,MNmcvC,OAjFAnlB,EAAAA,EAAAA,YAAU,KAKHwY,GAAaE,EAAS6D,2BAA8BM,EAAKE,aAAaE,YACzEvE,EAASmC,mBAIPrC,GACFqE,EAAK8B,aAAanG,GAAU,KAE1B,GAAIqE,EAAKE,aAAa1G,MAAMjX,OAAS,EAAG,CACtC,MAAM8oB,EAAkB7R,EAAMsN,qBAAqB9G,EAAKE,aAAa1G,OACrEwG,EAAKoB,YAAYiK,EACnB,OAIH,CAAS,OAAR1P,QAAQ,IAARA,OAAQ,EAARA,EAAU3X,OAGdb,EAAAA,EAAAA,YAAU,KAAO,IAAD0sB,EAAAC,EACY,QAAtBD,EAAAhU,EAASkC,qBAAa,IAAA8R,GAAQ,QAARC,EAAtBD,EAAwBtsB,cAAM,IAAAusB,GAA9BA,EAAgC1P,aAAezE,GACjDqE,EAAKiB,aAAa,CAAEb,WAAYvE,EAASkC,cAAcxa,OAAO6c,eAE/D,CAACvE,EAASkC,cAAepC,KAG5BxY,EAAAA,EAAAA,YAAU,KACHwY,GAA+C,IAAnCqE,EAAKE,aAAa1G,MAAMjX,QACvCyd,EAAKqB,YAEN,CAAC1F,EAAUqE,EAAKE,aAAa1G,MAAMjX,UAGtCY,EAAAA,EAAAA,YAAU,KAAO,IAAD4sB,EACd,IAAKpU,GAAYE,EAAS4C,eAAelc,QAAuB,QAAjBwtB,EAAIlU,EAASE,YAAI,IAAAgU,GAAbA,EAAe/rB,MAAQgc,EAAKE,aAAaK,UAAW,CACrG,MAAMyP,EAAcnU,EAAS4C,eAAetR,MAAM8iB,IAAM,IAAAC,EAAA,OAAKD,EAAEjsB,OAAqB,QAAlBksB,EAAKrU,EAASE,YAAI,IAAAmU,OAAA,EAAbA,EAAelsB,QAClFgsB,GAAenU,EAASE,MAC1BiE,EAAKiB,aAAa,CAChBV,UAAW1E,EAASE,KAAK/X,IACzBwc,eAAgBwP,EAAY9qB,MAAQ2W,EAASE,KAAK7W,MAAQ,IAGhE,IACC,CAAC2W,EAAS4C,eAAgB5C,EAASE,KAAMJ,EAAUqE,EAAKE,aAAaK,aAGxEpd,EAAAA,EAAAA,YAAU,KAAO,IAADgtB,GACTxU,GAA6B,QAArBwU,EAAItU,EAASkD,gBAAQ,IAAAoR,GAAjBA,EAAmBC,uBAClCpQ,EAAKgB,gBAAgBnF,EAASkD,SAASqR,yBAExC,CAACvU,EAASkD,SAAUpD,KAGvBxY,EAAAA,EAAAA,YAAU,KACR,GAAIwY,GAAYqE,EAAKE,aAAa1G,MAAMjX,OAAS,IAC5CsZ,EAAS8C,sBAAsBpc,OAAS,GAAKsZ,EAAS6C,qBAAqBnc,OAAS,GAAI,CAO3F,GAJuByd,EAAKE,aAAa1G,MAAMgR,MAC5CzmB,GAAcA,EAAKuT,WAAavT,EAAKijB,YAGpB,CAElB,MAAMqE,EAAkB7R,EAAMsN,qBAAqB9G,EAAKE,aAAa1G,OACrEwG,EAAKoB,YAAYiK,EACnB,CACF,IAEC,CACO,OAAR1P,QAAQ,IAARA,OAAQ,EAARA,EAAU3X,IACVgc,EAAKE,aAAa1G,MAAMjX,OACxBsZ,EAAS8C,sBAAsBpc,OAC/BsZ,EAAS6C,qBAAqBnc,SAIzB,CAELsZ,WAGAmE,OACAE,aAAcF,EAAKE,aACnBzG,aAAcuG,EAAKvG,aACnBsH,aAAcf,EAAKe,aAGnBrH,mBAGA6K,SAGA8D,UAGAH,oBACAoD,uBACAlU,sBACAC,oBACA2U,cACAqC,iBAGAE,YAIA1H,eAAgB,GAEhBwJ,iBAAiB1W,EAAAA,EAAAA,UAAQ,KACvB,MAAM1B,EAAU4D,EAAS0C,mBAAmBza,KAAKwsB,IAAa,CAC5DzX,MAAM,GAADnL,OAAK4iB,EAAS1N,UAAS,OAAAlV,OAAM4iB,EAASvD,QAC3CljB,MAAOymB,EAAStsB,QAGlB,GAAIgc,EAAKE,aAAaG,aAAeL,EAAKE,aAAaI,cAAe,CACrDrI,EAAQuS,MAAM5R,GAA2BA,EAAI/O,QAAUmW,EAAKE,aAAaG,eAEtFpI,EAAQsY,KAAK,CACX1mB,MAAOmW,EAAKE,aAAaG,YACzBxH,MAAOmH,EAAKE,aAAaI,eAG/B,CAEA,OAAOrI,IACN,CACD4D,EAAS0C,mBACTyB,EAAKE,aAAaG,YAClBL,EAAKE,aAAaI,gBAGpBkQ,aAAa7W,EAAAA,EAAAA,UAAQ,KACnB,MAAM1B,EAAU4D,EAAS4C,eAAe3a,KAAKiY,IAAS,IAAA0U,EAAA,MAAM,CAC1D5X,MAAM,GAADnL,OAAKqO,EAAK7W,KAAI,MAAAwI,QAAmB,QAAd+iB,EAAA1U,EAAK2U,iBAAS,IAAAD,OAAA,EAAdA,EAAgBvrB,OAAQ,UAAS,KACzD2E,MAAOkS,EAAK/X,QAGd,GAAIgc,EAAKE,aAAaK,WAAaP,EAAKE,aAAaM,eAAgB,CACpDvI,EAAQuS,MAAM5R,GAA2BA,EAAI/O,QAAUmW,EAAKE,aAAaK,aAEtFtI,EAAQsY,KAAK,CACX1mB,MAAOmW,EAAKE,aAAaK,UACzB1H,MAAOmH,EAAKE,aAAaM,gBAG/B,CAEA,OAAOvI,IACN,CACD4D,EAAS4C,eACTuB,EAAKE,aAAaK,UAClBP,EAAKE,aAAaM,mB,eO3hBxB,MA6EA,EA7E8D7f,IAGvD,IAHwD,MAC7DkJ,EAAK,SACLH,GACD/I,EACC,OACEoH,EAAAA,EAAAA,MAAA,OACEG,MAAO,CACL4K,QAAS,OACTC,WAAY,SACZC,IAAK,EACL2d,WAAY,OACZhkB,QAAS,WACTkG,aAAc,GACd+d,UAAW,8BACX5oB,SAAA,EAGFD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,GAAIhL,SAAA,EAC5DC,EAAAA,EAAAA,KAAC4oB,EAAAA,EAAgB,CAAC3oB,MAAO,CAAEG,SAAU,GAAID,MAAO,cAChDH,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAEC,WAAY,IAAKE,SAAU,GAAID,MAAO,QAASJ,SAAC,mBAMjED,EAAAA,EAAAA,MAAA,OACEmB,QAASA,IAAMQ,EAAmB,SAAVG,EAAmB,UAAY,QACvD3B,MAAO,CACL4oB,SAAU,WACVppB,MAAO,IACPqpB,OAAQ,GACRle,aAAc,GACd8d,WACY,SAAV9mB,EACI,oDACA,oDACN4J,OAAQ,UACRud,WAAY,gBACZJ,UAAW,6BACX9d,QAAS,OACTC,WAAY,SACZM,eAA0B,SAAVxJ,EAAmB,aAAe,WAClD8C,QAAS,SACT3E,SAAA,EAGFC,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACLR,MAAO,GACPqpB,OAAQ,GACRle,aAAc,MACd8d,WAAY,OACZC,UAAW,4BACXI,WAAY,oBAKhB/oB,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACL4oB,SAAU,WACVG,KAAgB,SAAVpnB,EAAmB,GAAK,OAC9BqnB,MAAiB,YAAVrnB,EAAsB,GAAK,OAClCzB,MAAO,OACPD,WAAY,OACZE,SAAU,GACV8oB,cAAe,GACfC,WAAY,QACZppB,SAES,SAAV6B,EAAmB,OAAS,mBClFvC,EAAgC,oCAAhC,EAA4I,wCAA5I,EAA4O,wCAA5O,EAAwS,wCAAxS,EAAoW,wCAApW,EAAga,wCAAha,GAA0d,sCAA1d,GAAgkB,oCAAhkB,GAAonB,oCAApnB,GAAwqB,oCAAxqB,GAAgwB,oCAAhwB,GAAozB,oCAApzB,GAAw2B,oCAAx2B,GAA25B,mCAA35B,GAAw/B,gCAAx/B,GAA0kC,gCAA1kC,GAA2qC,mCAA3qC,GAA0wC,sCAA1wC,GAA+2C,mCAA/2C,GAAo6C,sCAAp6C,GAAmgD,iCAAngD,GAAqjD,qCAArjD,GAAknD,4CAAlnD,GAA6qD,mCAA7qD,GAAkuD,sCAAluD,GAAqxD,iCAArxD,GAAo0D,kCAAp0D,GAAk3D,gCAAl3D,GAAu6D,yCAAv6D,GAA+9D,mCAA/9D,GAAihE,mCAAjhE,GAAymE,mCAAzmE,GAAosE,oCAApsE,GAA0vE,sCAA1vE,GAAizE,qCAAjzE,GAA05E,kCAA15E,GAA68E,qCAA78E,GAAmgF,qCAAngF,GAAwjF,oCAAxjF,GAA2mF,mCAA3mF,GAA2pF,iCAA3pF,GAA2sF,mCAA3sF,GAA6vF,mCAA7vF,GAAi2F,mCAAj2F,GAAq5F,qCAAr5F,GAA68F,uCAA78F,GAAugG,uCAAvgG,GAA8jG,oCAA9jG,GAAunG,yCAAvnG,GAAorG,wCAAprG,GAAkvG,0CAAlvG,GAAkzG,0CAAlzG,GAAg3G,wCAAh3G,GAA06G,sCAA16G,GAAu+G,2CAAv+G,GAA0iH,4CAA1iH,GAAmnH,iDAAnnH,GAAs9H,gCAAt9H,GAA+gI,6CAA/gI,GAA+kI,uCAA/kI,GAAyoI,uCAAzoI,GAAmsI,uCAAnsI,GAA6vI,uCAA7vI,GAAq2I,iCAAr2I,GAAu5I,qCAAv5I,GAA8/I,kCAA9/I,GAAijJ,qCAAjjJ,GAAomJ,kCAApmJ,GAAilK,qCAAjlK,GAAgsK,gCAAhsK,GAAgvK,oCAAhvK,GAA2yK,4CCMryK,MAAEwnB,GAAOzd,KAAK,IAAIC,EAAAA,EAoIxB,GAnH8ClT,IAQvC,IARwC,SAC7Cgb,EAAQ,aACRoF,EAAY,aACZtH,EAAY,UACZ6X,EAAS,YACTC,EAAW,qBACXC,EAAoB,iBACpBC,GACD9wB,EACC,OACEoH,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAuB1pB,SAAA,EAErCC,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAEhB3pB,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAqB1pB,SAAA,EAEnCD,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAoB1pB,SAAA,EAClCC,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,GAAiB1pB,UAC/BC,EAAAA,EAAAA,KAAC4oB,EAAAA,EAAgB,CAAC3oB,MAAO,CAAEG,SAAU,OAAQD,MAAO,cAEtDL,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACEC,EAAAA,EAAAA,KAACopB,GAAK,CAACM,MAAO,EAAG3lB,UAAW0lB,GAAiB1pB,SAC1C2T,EAAW,sBAAmB,8BAEjC5T,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAA,CAAC,+BACjB2H,MAAQM,OAAO,+BAMxClI,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAuB1pB,SAAA,EAErCC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAE0pB,YAAa,QAAS5pB,UAClCC,EAAAA,EAAAA,KAAC4pB,EAAkB,CAAChoB,MAAOkX,EAAcrX,SAAU8nB,OAIrDzpB,EAAAA,EAAAA,MAAA,OAAKiE,UAAS,GAAA0B,OAAKgkB,GAAmB,KAAAhkB,OAAIgkB,IAAyB1pB,SAAA,EACjEC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,4BACtCC,EAAAA,EAAAA,KAAC6pB,EAAAA,EAAM,CACLC,gBAAgB,SAChBC,kBAAkB,YAClBC,QAASxY,EAAaoH,SACtBnX,SAAUuoB,GAAWR,EAAiB,CAAE5Q,SAAUoR,IAClDjmB,UAAW0lB,GACX/lB,KAAK,cAKT5D,EAAAA,EAAAA,MAAA,OAAKiE,UAAS,GAAA0B,OAAKgkB,GAAmB,KAAAhkB,OAAIgkB,IAAoB1pB,SAAA,EAC5DC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,sBACtCC,EAAAA,EAAAA,KAAC6pB,EAAAA,EAAM,CACLC,gBAAgB,OAChBC,kBAAkB,OAClBC,QAASxY,EAAaI,cACtBnQ,SAAUuoB,GAAWR,EAAiB,CAAE5X,cAAeoY,IACvDjmB,UAAW0lB,GACX/lB,KAAK,cAKT5D,EAAAA,EAAAA,MAAA,OAAKiE,UAAS,GAAA0B,OAAKgkB,GAAmB,KAAAhkB,OAAIgkB,IAAwB1pB,SAAA,EAChEC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,0BACtCC,EAAAA,EAAAA,KAAC6pB,EAAAA,EAAM,CACLC,gBAAgB,OAChBC,kBAAkB,SAClBC,QAASxY,EAAakH,OACtBjX,SAAUuoB,GACRR,EAAiB,CACf9Q,OAAQsR,EACRrR,iBAAiBqR,GAAkBxY,EAAamH,kBAGpD5U,UAAW0lB,GACX/lB,KAAK,cAKP8N,EAAakH,SACb5Y,EAAAA,EAAAA,MAAA,OAAKiE,UAAS,GAAA0B,OAAKgkB,GAAmB,KAAAhkB,OAAIgkB,IAA+B1pB,SAAA,EACvEC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,0BACtCC,EAAAA,EAAAA,KAAC6pB,EAAAA,EAAM,CACLC,gBAAgB,MAChBC,kBAAkB,KAClBC,QAASxY,EAAamH,gBACtBlX,SAAUuoB,GAAWR,EAAiB,CAAE7Q,gBAAiBqR,IACzDjmB,UAAW0lB,GACX/lB,KAAK,cAMX5D,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAuB1pB,SAAA,EACrCC,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,GAAkB1pB,UAChCD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAAiB1pB,SAAA,CAAC,uBAAWspB,QAEhDrpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,GAAmB1pB,UACjCD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAAiB1pB,SAAA,CAAC,sBAAKupB,EAAY5oB,QAAQ,sBC5HlEiL,KAAK,IAAIC,EAAAA,EAoNjB,GA/L8ClT,IASvC,IATwC,aAC7Cuf,EAAY,wBACZgS,EAAuB,YACvB1B,EAAW,aACXzP,EAAY,eACZoR,EAAc,oBACdC,EAAmB,gBACnBC,EAAe,QACf1vB,GACDhC,EACC,MAAM2xB,GAAsC3Y,EAAAA,EAAAA,UAC1C,IAAM,CACJ,CACElS,IAAK,aACLF,MAAO,yBACPC,UAAW,aACXqD,KAAM,OACNwK,UAAU,EACV3N,MAAO,KAET,CACED,IAAK,OACLF,MAAO,oBACPC,UAAW,OACXqD,KAAM,OACNwK,UAAU,EACV3N,MAAO,KAET,CACED,IAAK,cACLF,MAAO,wBACPC,UAAW,cACXqD,KAAM,OACNqK,UAAU,EACVG,UAAU,EACV3N,MAAO,IACPC,OAASkC,IACP,MAAM0oB,EAAeL,EAAwB/kB,MAC1CyL,GAAaA,EAAI/O,QAAUA,IAGxB2oB,GACQ,OAAZD,QAAY,IAAZA,OAAY,EAAZA,EAAc1Z,QAASqH,EAAaI,eAFd,kBAKxB,OACErY,EAAAA,EAAAA,KAACkK,EAAAA,EAAO,CAAC5K,MAHS,4DAGUS,UAC1BD,EAAAA,EAAAA,MAAA,OACEG,MAAO,CACL4K,QAAS,OACTC,WAAY,SACZM,eAAgB,gBAChBI,OAAQ,UACR9G,QAAS,UACTkG,aAAc,MACd1G,OAAQ,oBACRF,gBAAiB,UACjB+kB,WAAY,iBAEd9nB,QAASkpB,EACTK,aAAc9oB,IACZA,EAAEuB,cAAchD,MAAM+D,gBAAkB,UACxCtC,EAAEuB,cAAchD,MAAMwqB,YAAc,WAEtCC,aAAchpB,IACZA,EAAEuB,cAAchD,MAAM+D,gBAAkB,UACxCtC,EAAEuB,cAAchD,MAAMwqB,YAAc,WACpC1qB,SAAA,EAEFC,EAAAA,EAAAA,KAAA,QAAAD,SAAOwqB,KACPvqB,EAAAA,EAAAA,KAAA,QACEC,MAAO,CACLG,SAAU,OACVD,MAAO,UACP6D,gBAAiB,UACjBU,QAAS,UACTkG,aAAc,MACd1G,OAAQ,qBACRnE,SACH,eAQX,CACEP,IAAK,YACLF,MAAO,2CACPC,UAAW,YACXqD,KAAM,OACNqK,UAAU,EACVG,UAAU,EACV3N,MAAO,IACPC,OAASkC,IACP,MAAM+oB,EAAepC,EAAYrjB,MAAMyL,GAAaA,EAAI/O,QAAUA,IAC5D2oB,GAA2B,OAAZI,QAAY,IAAZA,OAAY,EAAZA,EAAc/Z,QAASqH,EAAaM,gBAAkB,cAC3E,OACEvY,EAAAA,EAAAA,KAACkK,EAAAA,EAAO,CAAC5K,MAAM,2DAA0DS,UACvED,EAAAA,EAAAA,MAAA,OACEG,MAAO,CACL4K,QAAS,OACTC,WAAY,SACZM,eAAgB,gBAChBI,OAAQ,UACR9G,QAAS,UACTkG,aAAc,MACd1G,OAAQ,oBACRF,gBAAiB,UACjB+kB,WAAY,iBAEd9nB,QAASmpB,EACTI,aAAc9oB,IACZA,EAAEuB,cAAchD,MAAM+D,gBAAkB,UACxCtC,EAAEuB,cAAchD,MAAMwqB,YAAc,WAEtCC,aAAchpB,IACZA,EAAEuB,cAAchD,MAAM+D,gBAAkB,UACxCtC,EAAEuB,cAAchD,MAAMwqB,YAAc,WACpC1qB,SAAA,EAEFC,EAAAA,EAAAA,KAAA,QAAAD,SAAOwqB,KACPvqB,EAAAA,EAAAA,KAAA,QACEC,MAAO,CACLG,SAAU,OACVD,MAAO,UACP6D,gBAAiB,UACjBU,QAAS,UACTkG,aAAc,MACd1G,OAAQ,qBACRnE,SACH,kBAQX,CACEP,IAAK,eACLF,MAAO,uBACPC,UAAW,eACXqD,KAAM,SACNoN,QAAS,CACP,CAAEY,MAAO,oBAAWhP,MAAO,QAC3B,CAAEgP,MAAO,mBAAUhP,MAAO,OAC1B,CAAEgP,MAAO,oBAAWhP,MAAO,SAE7BwL,UAAU,EACV3N,MAAO,OAGX,CAACwqB,EAAyB1B,EAAazP,EAAcqR,EAAqBC,IAGtEQ,GAAalZ,EAAAA,EAAAA,UACjB,IAAM,CACJ,CACEyG,WAAYF,EAAaE,WACzBhI,KAAM8H,EAAa9H,KACnBiI,YAAaH,EAAaG,YAC1BE,UAAWL,EAAaK,UACxBE,aAAcP,EAAaO,gBAG/B,CACEP,EAAaE,WACbF,EAAa9H,KACb8H,EAAaG,YACbH,EAAaK,UACbL,EAAaO,eAIjB,OACExY,EAAAA,EAAAA,KAAC6qB,EAAiB,CAChBxrB,QAASgrB,EACT7mB,WAAYonB,EACZ/e,OAAQqe,EACRle,UAAU,EACVC,aAAa,EACbvR,QAASA,EACTqJ,UAAU,sBACVL,KAAK,QACLD,OAAO,iBCjNLkI,KAAK,IAAIC,EAAAA,EA+KjB,GAvJgDlT,IAMzC,IAN0C,iBAC/C+Y,EAAgB,aAChBD,EAAY,iBACZsZ,EAAgB,qBAChBC,EAAoB,mBACpBC,GACDtyB,EACC,OACEoH,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAmB1pB,SAAA,EAEjCC,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAGhBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,GAAqB1pB,UACnCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,iCAIxCD,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAoB1pB,SAAA,EAClCD,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAkB1pB,SAAA,EAChCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,gBACtCD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAA,CAAC,SAClC0R,EAAiBkB,UAAUjS,QAAQ,UAIzCZ,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAkB1pB,SAAA,EAChCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,qBACtCD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAA,CAAC,SAClC0R,EAAiBwB,eAAevS,QAAQ,UAI9CZ,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAkB1pB,SAAA,EAChCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,gBACtCD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAA,CAAC,SAClC0R,EAAiBuB,UAAUtS,QAAQ,UAIzCZ,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAkB1pB,SAAA,EAChCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,WACtCD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAA,CAAC,SAClC0R,EAAiB6B,KAAK5S,QAAQ,UAIpCZ,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAkB1pB,SAAA,EAChCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,WACtCD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAA,CAAC,SAClC0R,EAAiB8B,KAAK7S,QAAQ,SAInC8Q,EAAaK,SAAW,IACvB/R,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAkB1pB,SAAA,EAChCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAoB1pB,SAAC,eACtCD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAAqB1pB,SAAA,CAAC,UAEN,eAA9ByR,EAAaM,eAENL,EAAiBkB,UAAYlB,EAAiBuB,YACZ,kBAA1BxB,EAAaK,SAAwBL,EAAaK,SAAW,GACvE,KACAnR,QAAQ,IACwB,kBAA1B8Q,EAAaK,SACjBL,EAAaK,SACb,GACFnR,QAAQ,UAKpBZ,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAsB1pB,SAAA,EACpCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAwB1pB,SAAC,mBAC1CD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAAwB1pB,SAAA,CAAC,SACtC0R,EAAiByB,aAAaxS,QAAQ,SAI3C8Q,EAAamH,kBACZ7Y,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAA0B1pB,SAAA,EACxCD,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAyB1pB,SAAA,EACvCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAA2B1pB,SAAC,kBAC7CD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAA2B1pB,SAAA,CAAC,UAEN,kBAA5ByR,EAAaqH,WAClBrH,EAAaqH,WACb,GACFnY,QAAQ,UAGdZ,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAyB1pB,SAAA,EACvCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAA2B1pB,SAAC,cAC7CD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC5H,UAAW0lB,GAA2B1pB,SAAA,CAAC,UAGzC0R,EAAiByB,cACmB,kBAA5B1B,EAAaqH,WAA0BrH,EAAaqH,WAAa,IACzEnY,QAAQ,gBAQpBZ,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAyB1pB,SAAA,EAEvCD,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAuB1pB,SAAA,EACrCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAA4B1pB,SAAC,2BAC9CD,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAA6B1pB,SAAA,EAC3CC,EAAAA,EAAAA,KAAC6P,EAAAA,EAAW,CACVzN,IAAK,EACLR,MAAO4P,EAAaK,SACpBpQ,SAAUG,GAASkpB,EAAiBlpB,GAAS,GAC7C3B,MAAO,CAAER,MAAO,IAChBiE,KAAK,WAEP1D,EAAAA,EAAAA,KAAC6pB,EAAAA,EAAM,CACLC,gBAAgB,IAChBC,kBAAkB,SAClBC,QAAuC,eAA9BxY,EAAaM,aACtBrQ,SAAUspB,EACVrnB,KAAK,gBAMV8N,EAAamH,kBACZ7Y,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAA6B1pB,SAAA,EAC3CC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAkC1pB,SAAC,8BACpDC,EAAAA,EAAAA,KAAC6P,EAAAA,EAAW,CACVzN,IAAK,EACLG,IAAKkP,EAAiByB,aACtBtR,MAAO4P,EAAaqH,WACpBpX,SAAUG,GAASopB,EAAmBppB,GAAS,GAC/C3B,MAAO,CAAER,MAAO,IAChBiE,KAAK,QACLunB,UAAWrpB,GAAS,SAAA6D,OAAI7D,GAAQspB,QAAQ,wBAAyB,KACjEC,OAAQvpB,GAAS0Q,OAAO1Q,EAAOspB,QAAQ,kBAAc,iB,oLCpI3D9B,MAAK,GAAEzd,KAAK,IAAIC,EAAAA,GAClB,OAAEwf,IAAWrb,EAAAA,EAyBbsb,GAAyE3yB,IAIxE,IAJyE,QAC9EC,EAAO,SACPG,EAAQ,SACRC,GACDL,EACC,MAAOM,EAAYC,IAAiBC,EAAAA,EAAAA,UAAS,KACtCoyB,EAAqBC,IAA0BryB,EAAAA,EAAAA,UAAS,KACxDG,EAAMC,IAAWJ,EAAAA,EAAAA,UAAS,IAC1BsyB,EAAcC,IAAmBvyB,EAAAA,EAAAA,UAAqB,KACtDO,EAASC,IAAcR,EAAAA,EAAAA,WAAS,IAChCwyB,EAAaC,IAAkBzyB,EAAAA,EAAAA,WAAS,IACxC0yB,EAAkBC,IAAuB3yB,EAAAA,EAAAA,UAC9C,OAEK4yB,EAAkBC,IAAuB7yB,EAAAA,EAAAA,WAAkB,IAC3D8yB,EAAgBC,IAAqB/yB,EAAAA,EAAAA,WAAS,IAC9CgzB,EAAiBC,IAAsBjzB,EAAAA,EAAAA,UAA0B,CACtEyhB,UAAW,GACXqK,MAAO,GACPF,OAAQ,GACRV,QAAS,GACTgI,cAAe,aAGVrU,GAAQsU,GAAAA,EAAKC,UACdryB,GAAiBC,EAAAA,EAAAA,QAAY,MAC7BqyB,GAAWryB,EAAAA,EAAAA,QAAuB,MAClCC,GAAmBD,EAAAA,EAAAA,QAA8B,MACjDsyB,GAAgBtyB,EAAAA,EAAAA,QAAuB,MACvCuyB,GAAoBvyB,EAAAA,EAAAA,QAAY,MAChCE,GAAmBF,EAAAA,EAAAA,SAAO,IAGxBK,KAAMmyB,EAAcjyB,UAAWma,EAAiBH,QAASkY,GAC/DhyB,EAAAA,GAASma,oBACP,CACEja,aAAcywB,EACdxwB,WAAYzB,EACZ0B,UAAW,IAEb,CACEC,MAAOrC,EACPsC,2BAA2B,IAKjC2xB,GADoBvY,EAAAA,EAAAA,IAAkB,YAC0B8C,aAAxDH,OAAQ6V,GAAiCD,EAAdE,GAAYC,EAAAA,GAAAA,GAAAH,EAAAI,IACzCC,EAAgBH,EAAaryB,WAGnCS,EAAAA,EAAAA,YAAU,KACR,GAAKvC,GAED+zB,EAAc,CAAC,IAADvxB,EAAAC,EAChB,MAAMC,GAAwB,OAAZqxB,QAAY,IAAZA,OAAY,EAAZA,EAAsBpxB,SAAU,GAC5CC,GAA6C,QAAhCJ,EAACuxB,EAAqBlxB,kBAAU,IAAAL,OAAA,EAAhCA,EAAkCI,cAA8C,QAApCH,EAAKsxB,EAAqBlxB,kBAAU,IAAAJ,OAAA,EAAhCA,EAAkCK,QAAS,EAEjG,IAATpC,GAEFoyB,EAAgBpwB,GAChB3B,EAAW2B,EAASf,OAASiB,GAAcF,EAASf,OAAS,GACzDe,EAASf,OAAS,IACpB2xB,GAAkB,GAClBN,GAAe,MAIjBF,GAAgB/vB,IACd,MAAMC,EAAc,IAAIC,IAAIF,EAAKG,KAAKC,GAAcA,EAAKC,OACnDC,EAAiBX,EAASY,QAAQH,IAAeH,EAAYO,IAAIJ,EAAKC,OACtEI,EAAU,IAAIT,KAASM,GAE7B,OADAtC,EAAWyC,EAAQ7B,OAASiB,GAAcS,EAAe1B,OAAS,GAC3D6B,KAELd,EAASf,OAAS,IACpB2xB,GAAkB,GAClBN,GAAe,KAInBvxB,EAAiBgC,SAAU,CAC7B,IACC,CAACswB,EAAcrzB,EAAMV,IAExB,MAAMu0B,EAAoB1B,EAGpB2B,GAAuBzb,EAAAA,EAAAA,UAAQ,IAEjC1Y,EAAWwW,SAAWoF,GAAgD,IAA7BsY,EAAkB5yB,QAE5D,CAACtB,EAAY4b,EAAiBsY,EAAkB5yB,SAG7C8yB,IAAuBnU,EAAAA,EAAAA,cAAarW,IACC,CACvCyqB,IAAK,OACLC,UAAW,OACXC,QAAS,SAEK3qB,IAAS,UACxB,IAGG4qB,IAAqBvU,EAAAA,EAAAA,cACxBnL,IACC,GAAiC,IAA7Bof,EAAkB5yB,OAAc,OAEpC,IAAImzB,EACJ,OAAQ3f,GACN,IAAK,KACH2f,GACwB,IAAtB3B,EACIoB,EAAkB5yB,OAAS,EAC3B6H,KAAKI,IAAIupB,EAAmB,EAAG,GACrC,MACF,IAAK,OACH2B,GACwB,IAAtB3B,EACI,EACA3pB,KAAKC,IAAI0pB,EAAmB,EAAGoB,EAAkB5yB,OAAS,GAChE,MACF,IAAK,OACHmzB,EAAW,EACX,MACF,IAAK,MACHA,EAAWP,EAAkB5yB,OAAS,EACtC,MACF,QACE,OAGJyxB,EAAoB0B,GACpB5B,EAAoBqB,EAAkBO,IAGtCvuB,YAAW,KACT,MAAMwuB,EAAajgB,SAASnE,cAAc,kBAAD7D,OACrBynB,EAAkBO,GAAU1xB,IAAG,OAEnD,GAAI2xB,EAAY,CACd,MAAMC,EACU,SAAd7f,EACI,QACc,QAAdA,EACE,MACA,UACR4f,EAAWnkB,eAAe,CACxBqkB,SAAU,SACVpkB,MAAOmkB,GAEX,IACC,OAEL,CAACT,EAAmBpB,IAIhB+B,IAAe5U,EAAAA,EAAAA,cAClBrX,IACC3I,EAAc2I,GAEVzH,EAAiBiC,SACnB6C,aAAa9E,EAAiBiC,SAGhCjC,EAAiBiC,QAAU8C,YAAW,KACpCqsB,EAAuB3pB,EAAM4N,QAE7BlW,EAAQ,GACRI,GAAW,GACXU,EAAiBgC,SAAU,IAC1B,OAEL,IAII0xB,IAAuB7U,EAAAA,EAAAA,cAC1BoP,IACCwD,EAAoBxD,GACpBvvB,EAASuvB,GACTnpB,YAAW,IAAMnG,KAAY,OAE/B,CAACD,EAAUC,IAIPg1B,IAAgB9U,EAAAA,EAAAA,cAAY,KAChCkT,EAAmB,CACjBxR,UAAW,GACXqK,MAAO,GACPF,OAAQ,GACRV,QAAS,GACTgI,cAAe,YAEjBrU,EAAKiW,gBACJ,CAACjW,IAGEkW,IAA+BhV,EAAAA,EAAAA,cAAY8H,UAC/C,IAEE,IAAKmL,EAAgBvR,UAAUnL,OAE7B,YADAjK,EAAAA,GAAQ2C,MAAM,yBAGhB,IAAKgkB,EAAgBpH,OAAOtV,OAE1B,YADAjK,EAAAA,GAAQ2C,MAAM,6BAKhB,MAAM5M,QAAeuxB,EAAeX,GACpC,IAAK5wB,EAAO4M,OAAS5M,EAAOf,KAAM,CAAC,IAAD2zB,EAAAC,EAEhC,MAAMC,GAAyB,QAAXF,EAAA5yB,EAAOf,YAAI,IAAA2zB,OAAA,EAAXA,EAAa3zB,QAAmB,QAAf4zB,EAAI7yB,EAAOf,YAAI,IAAA4zB,OAAA,EAAXA,EAAa7yB,SAAUA,EAAOf,KACnE6zB,IAEFL,KACApC,GAAe,GACfM,GAAkB,GAGlBU,IAGAztB,YAAW,KACT4uB,GAAqBM,KACpB,KAEP,CACF,CAAE,MAAOlmB,GACP3C,EAAAA,GAAQ2C,MAAM,6BAEd6lB,IACF,IACC,CAAC7B,EAAiBW,EAAgBiB,GAAsBC,GAAepB,IAGpE0B,IAAwBpV,EAAAA,EAAAA,cAC5B,CAACqK,EAA8B1hB,KAC7BuqB,GAAmBzwB,IAAI2U,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAClB3U,GAAI,IACP,CAAC4nB,GAAQ1hB,QAGb,IAMI2L,IAAgB0L,EAAAA,EAAAA,cACnBvX,IACC,GAAc,WAAVA,EAAElC,IACJzG,SACK,GAAI,CAAC,YAAa,UAAW,OAAQ,OAAOmE,SAASwE,EAAElC,KAAM,CAClEkC,EAAEO,iBACFP,EAAEqN,kBASFye,GAPqE,CACnEc,UAAW,OACXC,QAAS,KACTC,KAAM,OACNC,IAAK,OAGyB/sB,EAAElC,KACpC,IAEF,CAACguB,GAAoBz0B,IAIjB21B,IAAsBzV,EAAAA,EAAAA,cACzBvX,IACC,IAAK/I,EAAS,OAGd,MAAMgJ,EAASD,EAAEC,OACjB,GACqB,UAAnBA,EAAOgtB,SACY,aAAnBhtB,EAAOgtB,UACPhtB,EAAOitB,UAAUC,SAAS,yBAC1BltB,EAAO4lB,QAAQ,wBAJjB,CASA,GAAI7lB,EAAE8L,SAAqB,MAAV9L,EAAElC,IAOjB,OANAkC,EAAEO,iBACFP,EAAEqN,uBACE9U,EAAemC,UACjBnC,EAAemC,QAAQgD,QACvBnF,EAAemC,QAAQ0yB,WAM3B,GAAIptB,EAAE8L,SAAqB,MAAV9L,EAAElC,IAiBjB,OAhBAkC,EAAEO,iBACFP,EAAEqN,uBACEoe,IACFlB,GAAkB,GAClB/sB,YAAW,KACT,GAAIstB,EAAcpwB,QAAS,CACzB,MAAM2yB,EAAavC,EAAcpwB,QAAQkN,cACvC,SAEEylB,IACFA,EAAW3vB,QACX2vB,EAAWD,SAEf,IACC,OAMP,GAAI,CAAC,YAAa,UAAW,OAAQ,OAAO5xB,SAASwE,EAAElC,KAAM,CAC3DkC,EAAEO,iBACFP,EAAEqN,kBASFye,GAPqE,CACnEc,UAAW,OACXC,QAAS,KACTC,KAAM,OACNC,IAAK,OAGyB/sB,EAAElC,KACpC,CA9CA,IAgDF,CAAC7G,EAAS60B,GAAoBL,IAI1B9tB,IAAUqS,EAAAA,EAAAA,UACd,IAAM,CACJ,CACEpS,MAAO,GACPE,IAAK,SACLC,MAAO,GACPC,OAAQA,CAACsvB,EAAcrvB,KACrBK,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACLuL,OAAQ,UACRX,QAAS,OACTO,eAAgB,SAChBN,WAAY,UAEd7J,QAASA,KACP4qB,EAAoBlsB,GACpB,MAAM+Z,EAAQwT,EAAkB5oB,WAC7B2qB,GAAgBA,EAAElzB,MAAQ4D,EAAO5D,MAEpCgwB,EAAoBrS,IAEpB3Z,UAEFC,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACLR,MAAO,OACPqpB,OAAQ,OACRle,aAAc,MACd1G,QACkB,OAAhB0nB,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB7vB,OAAQ4D,EAAO5D,IAC7B,oBACA,oBACNiI,iBACkB,OAAhB4nB,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB7vB,OAAQ4D,EAAO5D,IAAM,UAAY,QACrD8O,QAAS,OACTC,WAAY,SACZM,eAAgB,SAChB2d,WAAY,iBACZhpB,UAEe,OAAhB6rB,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB7vB,OAAQ4D,EAAO5D,MAChCiE,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACLR,MAAO,MACPqpB,OAAQ,MACRle,aAAc,MACd5G,gBAAiB,gBAQ/B,CACE1E,MAAO,gBACPC,UAAW,YACXC,IAAK,YACLE,OAAQA,CAACsvB,EAAcrvB,KACrBG,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,GAAIhL,SAAA,EAC5DC,EAAAA,EAAAA,KAAC2L,GAAI,CAACujB,QAAM,EAAAnvB,SAAEivB,KACdhvB,EAAAA,EAAAA,KAACmK,EAAAA,EAAG,CAAChK,MAAOitB,GAAqBztB,EAAOysB,eAAersB,SACpDJ,EAAOysB,cAAchK,oBAK9B,CACE9iB,MAAO,SACPC,UAAW,SACXC,IAAK,SACLE,OAASsvB,IACPlvB,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,GAAIhL,SAAA,EAC5DC,EAAAA,EAAAA,KAACmvB,GAAAA,EAAa,CAAClvB,MAAO,CAAEE,MAAO,WAC/BH,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEivB,QAIb,CACE1vB,MAAO,QACPC,UAAW,QACXC,IAAK,QACLE,OAASsvB,IACPlvB,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,GAAIhL,SAAA,EAC5DC,EAAAA,EAAAA,KAACovB,GAAAA,EAAY,CAACnvB,MAAO,CAAEE,MAAO,WAC9BH,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEivB,GAAQ,UAIrB,CACE1vB,MAAO,UACPC,UAAW,UACXC,IAAK,UACLE,OAASsvB,IACPlvB,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,aAAcC,IAAK,GAAIhL,SAAA,EAChEC,EAAAA,EAAAA,KAACqvB,GAAAA,EAAY,CAACpvB,MAAO,CAAEE,MAAO,OAAQE,UAAW,UACjDL,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,QAASL,SAChDivB,GAAQ,YAMnB,CAACpD,EAAkBsB,EAAmBE,KAIlCkC,IAAcrW,EAAAA,EAAAA,cAClB,CAACtZ,EAAkB+Z,KAAc,CAC/BzY,QAASA,KACP4qB,EAAoBlsB,GACpBosB,EAAyB,OAALrS,QAAK,IAALA,EAAAA,EAAS,IAG/BzZ,MAAO,CACLuL,OAAQ,UACRxH,iBACkB,OAAhB4nB,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB7vB,OAAQ4D,EAAO5D,IAAM,UAAY,QACrDmI,QACkB,OAAhB0nB,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB7vB,OAAQ4D,EAAO5D,IAC7B,oBACA,oBACN6O,aAAc,MACdme,WAAY,iBAEdyB,aAAe9oB,KACO,OAAhBkqB,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB7vB,OAAQ4D,EAAO5D,MACnC2F,EAAEuB,cAAchD,MAAM+D,gBAAkB,YAG5C0mB,aAAehpB,KACO,OAAhBkqB,QAAgB,IAAhBA,OAAgB,EAAhBA,EAAkB7vB,OAAQ4D,EAAO5D,MACnC2F,EAAEuB,cAAchD,MAAM+D,gBAAkB,aAI9C,CAAC4nB,KAIH1wB,EAAAA,EAAAA,YAAU,KACJvC,GACFkzB,EAAoB,MACpBE,GAAqB,GACrBE,GAAkB,GAElB3yB,EAAQ,GACRI,GAAW,GACXU,EAAiBgC,SAAU,IAE3BnD,EAAc,IACdsyB,EAAuB,IACvBM,EAAoB,MACpBE,GAAqB,GACrBE,GAAkB,GAClBN,GAAe,GACfoC,KAEAz0B,EAAQ,GACRmyB,EAAgB,IAChB/xB,GAAW,GACXU,EAAiBgC,SAAU,EACvBjC,EAAiBiC,UACnB6C,aAAa9E,EAAiBiC,SAC9BjC,EAAiBiC,QAAU,OAIxB,KACDjC,EAAiBiC,SACnB6C,aAAa9E,EAAiBiC,YAGjC,CAACzD,EAASo1B,MAGb7yB,EAAAA,EAAAA,YAAU,MACJiyB,GAAyBnB,GAAmBN,GAC9CO,GAAkB,KAEnB,CAACkB,EAAsBnB,EAAgBN,KAG1CxwB,EAAAA,EAAAA,YAAU,KACR,GAAIvC,GAAWsB,EAAemC,UAAYsvB,IAAgBM,EAAgB,CACxE,MAAMuD,EAAcA,KACdt1B,EAAemC,UACjBnC,EAAemC,QAAQgD,QACvBnF,EAAemC,QAAQ0yB,WAI3BS,IACA,MAAMC,EAAQtwB,WAAWqwB,EAAa,KAEtC,MAAO,IAAMtwB,aAAauwB,EAC5B,IACC,CAAC72B,EAAS+yB,EAAaM,KAG1B9wB,EAAAA,EAAAA,YAAU,KACR,IAAKwwB,GAAeM,IAAmBrzB,EAAS,CAC9C,MAAM62B,EAAQtwB,YAAW,KACnButB,EAAkBrwB,UACpBqwB,EAAkBrwB,QAAQgD,QAC1BqtB,EAAkBrwB,QAAQ0yB,YAE3B,KACH,MAAO,IAAM7vB,aAAauwB,EAC5B,IACC,CAAC9D,EAAaM,EAAgBrzB,KAKjCuC,EAAAA,EAAAA,YAAU,KACR,GAAIvC,EAEF,OADA8U,SAASC,iBAAiB,UAAWghB,IAAqB,GACnD,IACLjhB,SAASE,oBAAoB,UAAW+gB,IAAqB,KAEhE,CAAC/1B,EAAS+1B,MAGbe,EAAAA,GAAAA,GAAqB,CACnBC,OAAQ,SACRpwB,MAAO,WACPqwB,eAAgB7C,EAChBrY,QAASkY,KAIXzxB,EAAAA,EAAAA,YAAU,KACJ+xB,EAEF1nB,EAAAA,GAAQ7K,QAAQ,CACdk1B,QAAS,uBACTpwB,IAAK,oBACLqwB,SAAU,IAIZtqB,EAAAA,GAAQuqB,QAAQ,uBAEjB,CAAC7C,IAOJ,MAAM8C,IAAoB9W,EAAAA,EAAAA,cAAY,KACpC4S,EAAoB,MACpBE,GAAqB,KACpB,IACH,OACEjsB,EAAAA,EAAAA,MAACe,EAAAA,EAAK,CACJvB,MAAM,kBACNwB,KAAMnI,EACNI,SAAUA,EACVgI,OAAQ,KACRtB,MAAO,IACPQ,MAAO,CAAE+vB,IAAK,IACdC,gBAAiBnvB,IACXA,GAAQ7G,EAAemC,UAAYsvB,IAAgBM,GACrD9sB,YAAW,KAAO,IAADC,EAAA6C,EACO,QAAtB7C,EAAAlF,EAAemC,eAAO,IAAA+C,GAAtBA,EAAwBC,QACF,QAAtB4C,EAAA/H,EAAemC,eAAO,IAAA4F,GAAtBA,EAAwB8sB,WACvB,MAEL/uB,SAAA,EAEFC,EAAAA,EAAAA,KAAA,OACEuB,IAAKgrB,EACLtsB,MAAO,CAAEqB,aAAc,IACvBS,UAAWwL,GACXrC,SAAU,EAAEnL,UAEZD,EAAAA,EAAAA,MAACsB,EAAAA,EAAMC,QAAO,CAACpB,MAAO,CAAER,MAAO,QAASM,SAAA,EACtCC,EAAAA,EAAAA,KAACvH,EAAAA,EAAK,CACJ8I,IAAKtH,EACLuH,YAAY,gGACZI,MAAO5I,EACPyI,SAAUC,GAAKmsB,GAAansB,EAAEC,OAAOC,OACrCsuB,QAAQlwB,EAAAA,EAAAA,KAACmwB,GAAAA,EAAc,IACvBlwB,MAAO,CAAE4B,KAAM,GACfE,UAAWL,IAEK,UAAVA,EAAElC,KAAmBosB,GACvBkC,GAAqBlC,IAGzBwE,QAASL,GACTjuB,WAAY4pB,IAAgBM,EAC5BvpB,OACGipB,GAAgBM,OAgBb/nB,EAfA,KAEMtL,GAAWsB,EAAemC,SAC5B8C,YAAW,KAEPvG,GACAsB,EAAemC,UACdsvB,IACAM,GAED/xB,EAAemC,QAAQgD,UAExB,KAKbixB,OACEr3B,GAAc4b,GACZ5U,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEG,SAAU,OAAQD,MAAO,QAASJ,SAAC,iBAG/C,QAGRC,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLC,KAAM8oB,EAAc,UAAY,UAChC7oB,MAAM7C,EAAAA,EAAAA,KAACswB,GAAAA,EAAe,IACtBrvB,QAASA,KACP,MAAMsvB,GAAY7E,EAClBC,EAAe4E,GACVA,GAEHxC,MAIJ9tB,MAAO,CAAE8C,SAAU,KAAMhD,SAExB2rB,EAAc,SAAW,kBAM9BM,GAAkBN,KAClB5rB,EAAAA,EAAAA,MAAA,OACEyB,IAAKirB,EACLvsB,MAAO,CACLqB,aAAc,GACdoD,QAAS,GACTR,OAAQ,oBACR0G,aAAc,GACd5G,gBACE,oDACF0kB,WAAY,oDACZC,UACE,4EACFE,SAAU,WACV2H,SAAU,UAEZtlB,UAAW,EAAEnL,SAAA,EAGbC,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACL4oB,SAAU,WACVmH,KAAM,GACN/G,OAAQ,GACRxpB,MAAO,IACPqpB,OAAQ,IACRle,aAAc,MACd8d,WAAY,oDACZnd,QAAS,GACTklB,OAAQ,MAGZzwB,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACL4oB,SAAU,WACV6H,QAAS,GACT1H,MAAO,GACPvpB,MAAO,GACPqpB,OAAQ,GACRle,aAAc,MACd8d,WAAY,oDACZnd,QAAS,GACTklB,OAAQ,MAIZ3wB,EAAAA,EAAAA,MAAC6wB,GAAAA,EAAG,CACFC,QAAQ,gBACRC,MAAM,SACN5wB,MAAO,CAAEqB,aAAc,GAAIunB,SAAU,WAAY4H,OAAQ,GAAI1wB,SAAA,EAE7DD,EAAAA,EAAAA,MAACgxB,GAAAA,EAAG,CAAA/wB,SAAA,EACFD,EAAAA,EAAAA,MAACspB,GAAK,CACJM,MAAO,EACPzpB,MAAO,CACLoL,OAAQ,EACRqd,WACE,oDACFqI,qBAAsB,OACtBC,oBAAqB,cACrBC,eAAgB,OAChB/wB,WAAY,IACZE,SAAU,QACVL,SAAA,EAEFC,EAAAA,EAAAA,KAAC6Q,EAAAA,EAAY,CAAC5Q,MAAO,CAAE0pB,YAAa,EAAGxpB,MAAO,aAAe,0BAG/DH,EAAAA,EAAAA,KAAC2L,GAAI,CACH1L,MAAO,CACLG,SAAU,OACVD,MAAO,UACPD,WAAY,IACZ2K,QAAS,QACTxK,UAAW,GACXN,SACH,kEAIHC,EAAAA,EAAAA,KAAC8wB,GAAAA,EAAG,CAAA/wB,UACFD,EAAAA,EAAAA,MAACsB,EAAAA,EAAK,CAACsC,KAAK,SAAQ3D,SAAA,EAClBC,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLe,KAAK,SACLb,MAAM7C,EAAAA,EAAAA,KAACkxB,GAAAA,EAAa,IACpBjwB,QAASA,KACPgrB,GAAkB,GAClBN,GAAe,GACfgB,IACAoB,MAEF9tB,MAAO,CACLiE,OAAQ,oBACR0G,aAAc,EACd1K,WAAY,IACZC,MAAO,UACPuoB,WAAY,QACZC,UAAW,gCACXG,OAAQ,GACRpkB,QAAS,UACT3E,SACH,YAGDC,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLC,KAAK,UACLc,KAAK,SACLb,MAAM7C,EAAAA,EAAAA,KAACoR,EAAAA,EAAY,IACnBnQ,QAASgtB,GACTvzB,QAASuyB,EACThtB,MAAO,CACLyoB,WACE,oDACFxkB,OAAQ,OACR0G,aAAc,EACd1K,WAAY,IACZ4oB,OAAQ,GACRpkB,QAAS,SACTikB,UAAW,qCACXI,WAAY,iBACZhpB,SACH,6BAOPD,EAAAA,EAAAA,MAACusB,GAAAA,EAAI,CACHtU,KAAMA,EACNoZ,OAAO,WACPztB,KAAK,SACLzD,MAAO,CAAE4oB,SAAU,WAAY4H,OAAQ,GAAI1wB,SAAA,EAE3CD,EAAAA,EAAAA,MAAA,OACEG,MAAO,CACL4K,QAAS,OACTumB,oBAAqB,UACrBrmB,IAAK,GACLzJ,aAAc,IACdvB,SAAA,EAEFC,EAAAA,EAAAA,KAACqsB,GAAAA,EAAKgF,KAAI,CACRp0B,KAAK,YACL2T,OACE9Q,EAAAA,EAAAA,MAAA,QACEG,MAAO,CACLC,WAAY,IACZC,MAAO,UACPC,SAAU,OACVyK,QAAS,OACTC,WAAY,SACZC,IAAK,GACLhL,SAAA,EAEFC,EAAAA,EAAAA,KAACsxB,GAAAA,EAAY,CAACrxB,MAAO,CAAEE,MAAO,aAAe,eAIjDoxB,MAAO,CAAC,CAAEnkB,UAAU,EAAM7H,QAAS,2BAA4BxF,UAE/DC,EAAAA,EAAAA,KAACvH,EAAAA,EAAK,CACJ8I,IAAKkrB,EACLxvB,KAAK,YACLuE,YAAY,kBACZ0uB,QAAQlwB,EAAAA,EAAAA,KAACsxB,GAAAA,EAAY,CAACrxB,MAAO,CAAEE,MAAO,aACtC2B,UAAW4pB,GAAeM,EAC1BpqB,MAAOsqB,EAAgBvR,UACvBlZ,SAAUC,GACR2sB,GAAsB,YAAa3sB,EAAEC,OAAOC,OAE9CG,UAAWL,IACK,UAAVA,EAAElC,MACJkC,EAAEO,iBACFgsB,OAGJhuB,MAAO,CACL2K,aAAc,GACd1G,OAAQ,oBACRQ,QAAS,YACTtE,SAAU,OACV2oB,WAAY,gBACZJ,UAAW,gCACXD,WAAY,cAKlB1oB,EAAAA,EAAAA,KAACqsB,GAAAA,EAAKgF,KAAI,CACRp0B,KAAK,SACL2T,OACE9Q,EAAAA,EAAAA,MAAA,QACEG,MAAO,CACLC,WAAY,IACZC,MAAO,UACPC,SAAU,OACVyK,QAAS,OACTC,WAAY,SACZC,IAAK,GACLhL,SAAA,EAEFC,EAAAA,EAAAA,KAACmvB,GAAAA,EAAa,CAAClvB,MAAO,CAAEE,MAAO,aAAe,mBAIlDoxB,MAAO,CACL,CAAEnkB,UAAU,EAAM7H,QAAS,8BAC3B,CACEisB,QAAS,cACTjsB,QAAS,6BAEXxF,UAEFC,EAAAA,EAAAA,KAACvH,EAAAA,EAAK,CACJwE,KAAK,SACLuE,YAAY,sBACZ0uB,QAAQlwB,EAAAA,EAAAA,KAACmvB,GAAAA,EAAa,CAAClvB,MAAO,CAAEE,MAAO,aACvCyB,MAAOsqB,EAAgBpH,OACvBrjB,SAAUC,GACR2sB,GAAsB,SAAU3sB,EAAEC,OAAOC,OAE3CG,UAAWL,IACK,UAAVA,EAAElC,MACJkC,EAAEO,iBACFgsB,OAGJhuB,MAAO,CACL2K,aAAc,GACd1G,OAAQ,oBACRQ,QAAS,YACTtE,SAAU,OACV2oB,WAAY,gBACZJ,UAAW,gCACXD,WAAY,cAKlB1oB,EAAAA,EAAAA,KAACqsB,GAAAA,EAAKgF,KAAI,CACRp0B,KAAK,QACL2T,OACE9Q,EAAAA,EAAAA,MAAA,QACEG,MAAO,CACLC,WAAY,IACZC,MAAO,UACPC,SAAU,OACVyK,QAAS,OACTC,WAAY,SACZC,IAAK,GACLhL,SAAA,EAEFC,EAAAA,EAAAA,KAACovB,GAAAA,EAAY,CAACnvB,MAAO,CAAEE,MAAO,aAAe,WAIjDoxB,MAAO,CAAC,CAAE3uB,KAAM,QAAS2C,QAAS,6BAA8BxF,UAEhEC,EAAAA,EAAAA,KAACvH,EAAAA,EAAK,CACJwE,KAAK,QACLuE,YAAY,cACZ0uB,QAAQlwB,EAAAA,EAAAA,KAACovB,GAAAA,EAAY,CAACnvB,MAAO,CAAEE,MAAO,aACtCyB,MAAOsqB,EAAgBlH,MACvBvjB,SAAUC,GAAK2sB,GAAsB,QAAS3sB,EAAEC,OAAOC,OACvDG,UAAWL,IACK,UAAVA,EAAElC,MACJkC,EAAEO,iBACFgsB,OAGJhuB,MAAO,CACL2K,aAAc,GACd1G,OAAQ,oBACRQ,QAAS,YACTtE,SAAU,OACV2oB,WAAY,gBACZJ,UAAW,gCACXD,WAAY,iBAgEpB1oB,EAAAA,EAAAA,KAACqsB,GAAAA,EAAKgF,KAAI,CACRp0B,KAAK,UACL2T,OACE9Q,EAAAA,EAAAA,MAAA,QACEG,MAAO,CACLC,WAAY,IACZC,MAAO,UACPC,SAAU,OACVyK,QAAS,OACTC,WAAY,SACZC,IAAK,GACLhL,SAAA,EAEFC,EAAAA,EAAAA,KAACqvB,GAAAA,EAAY,CAACpvB,MAAO,CAAEE,MAAO,aAAe,aAGhDJ,UAEDC,EAAAA,EAAAA,KAACvH,EAAAA,EAAMg5B,SAAQ,CACbx0B,KAAK,UACLuE,YAAY,gBACZkwB,KAAM,EACN9vB,MAAOsqB,EAAgB9H,QACvB3iB,SAAUC,GAAK2sB,GAAsB,UAAW3sB,EAAEC,OAAOC,OACzDG,UAAWL,IACK,UAAVA,EAAElC,MACJkC,EAAEO,iBAEFgsB,OAGJhuB,MAAO,CACL2K,aAAc,GACd1G,OAAQ,oBACRQ,QAAS,YACTtE,SAAU,OACV2oB,WAAY,gBACZJ,UAAW,gCACXD,WAAY,QACZiJ,OAAQ,mBAQpB3xB,EAAAA,EAAAA,KAAC4xB,GAAAA,EAAO,CAAC3xB,MAAO,CAAEoL,OAAQ,aAE1BrL,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEoD,UAAW,IAAKmtB,SAAU,QAASzwB,SAC9C6U,GACC5U,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEwE,UAAW,SAAUC,QAAS,IAAK3E,UAC/CC,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAC,2BAEuB,IAA7BmtB,EAAkB5yB,QACpBwF,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEwE,UAAW,SAAUC,QAAS,IAAK3E,SAAA,EAC/CC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAW7C,SACnB/G,EACG,2CACA,4BAELA,IACCgH,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEI,UAAW,IAAKN,UAC5BC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAW7C,SAAC,0DAO7BD,EAAAA,EAAAA,MAAA,OACEkD,SAAWtB,IACT,MAAMC,EAASD,EAAEuB,cACXC,EAAYvB,EAAOuB,UACnBC,EAAexB,EAAOwB,cAEFD,EADLvB,EAAOyB,cAC0BD,EAE/B,IAAO1J,IAAYmb,IAAoBxa,EAAiBgC,UAC7EhC,EAAiBgC,SAAU,EAC3B9C,GAAQoC,GAAQA,EAAO,MAG3BuE,MAAO,CAAEoD,UAAW,IAAKC,UAAW,QAASvD,SAAA,EAE7CC,EAAAA,EAAAA,KAACuD,EAAAA,EAAK,CACJlE,QAASA,GACTmE,WAAY0pB,EACZzpB,OAAO,MACPjI,YAAY,EACZkI,KAAK,QACLa,OAAQ,CAAEC,OAAGP,GACbN,MAAO2rB,KAER71B,GAAWyzB,EAAkB5yB,OAAS,IACrC0F,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEwE,UAAW,SAAUC,QAAS,MAAOvE,MAAO,OAAQwE,UAAW,qBAAsB5E,SAChG6U,EAAkB,kBAAoB,uCAYvD,GAD+BmR,EAAAA,KAAWsF,KCppClCjC,MAAK,GAAEzd,KAAK,IAAIC,EAAAA,EA8lBxB,GArkB8DlT,IAIvD,IAJwD,QAC7DC,EAAO,SACPG,EAAQ,SACRC,GACDL,EACC,MAAOM,EAAYC,IAAiBC,EAAAA,EAAAA,UAAS,KACtCC,EAAiBC,IAAsBF,EAAAA,EAAAA,UAAS,KAChDG,EAAMC,IAAWJ,EAAAA,EAAAA,UAAS,IAC1B24B,EAAUC,IAAe54B,EAAAA,EAAAA,UAAiB,KAC1CO,EAASC,IAAcR,EAAAA,EAAAA,WAAS,IAChCyxB,EAAcoH,IAAmB74B,EAAAA,EAAAA,UAAsB,OACvD4yB,EAAkBC,IAAuB7yB,EAAAA,EAAAA,WAAkB,GAG5D6uB,GAAcrW,EAAAA,EAAAA,UAAQ,KACnB5L,EAAAA,EAAAA,mBACN,IAEG7L,GAAiBC,EAAAA,EAAAA,QAAY,MAC7BqyB,GAAWryB,EAAAA,EAAAA,QAAuB,MAClCC,GAAmBD,EAAAA,EAAAA,QAA8B,MACjDE,GAAmBF,EAAAA,EAAAA,SAAO,IAGxBK,KAAMy3B,EAAUv3B,UAAW2a,GAAgBza,EAAAA,GAAS2a,wBAAwB,CAClFza,aAAc1B,EACd2B,WAAYzB,EACZ0B,UAAW,IACV,CACDC,MAAOrC,EACPsC,2BAA2B,KAI7BC,EAAAA,EAAAA,YAAU,KACR,GAAKvC,GAEDq5B,EAAU,CAAC,IAAD72B,EAAAC,EACZ,MAAMC,GAAoB,OAAR22B,QAAQ,IAARA,OAAQ,EAARA,EAAkB12B,SAAU,GACxCC,GAAyC,QAA5BJ,EAAC62B,EAAiBx2B,kBAAU,IAAAL,OAAA,EAA5BA,EAA8BI,cAA0C,QAAhCH,EAAK42B,EAAiBx2B,kBAAU,IAAAJ,OAAA,EAA5BA,EAA8BK,QAAS,EAEzF,IAATpC,GACFy4B,EAAYz2B,GACZ3B,EAAW2B,EAASf,OAASiB,GAAcF,EAASf,OAAS,IAE7Dw3B,GAAYp2B,IACV,MAAMC,EAAc,IAAIC,IAAIF,EAAKG,KAAKC,GAAcA,EAAKC,OACnDC,EAAiBX,EAASY,QAAQH,IAAeH,EAAYO,IAAIJ,EAAKC,OACtEI,EAAU,IAAIT,KAASM,GAE7B,OADAtC,EAAWyC,EAAQ7B,OAASiB,GAAcS,EAAe1B,OAAS,GAC3D6B,KAIX/B,EAAiBgC,SAAU,CAC7B,IACC,CAAC41B,EAAU34B,EAAMV,IAEpB,MAAMs5B,EAAgBJ,GAGtB32B,EAAAA,EAAAA,YAAU,KACR,GAAKvC,GAEDK,IAAeG,EAcnB,OAZIgB,EAAiBiC,SACnB6C,aAAa9E,EAAiBiC,SAGhCjC,EAAiBiC,QAAU8C,YAAW,KACpC9F,EAAmBJ,GACnBM,EAAQ,GACRw4B,EAAY,IACZp4B,GAAW,GACXU,EAAiBgC,SAAU,IAC1B,KAEI,KACDjC,EAAiBiC,SACnB6C,aAAa9E,EAAiBiC,YAGjC,CAACpD,EAAYG,EAAiBR,KAGjCuC,EAAAA,EAAAA,YAAU,KACJvC,GACFW,EAAQ,GACRI,GAAW,GACXU,EAAiBgC,SAAU,IAE3BnD,EAAc,IACdG,EAAmB,IACnBE,EAAQ,GACRw4B,EAAY,IACZp4B,GAAW,GACXU,EAAiBgC,SAAU,KAE5B,CAACzD,IAGJ,MAAMu5B,GAAiBjZ,EAAAA,EAAAA,cACpBnL,IACC,GAA6B,IAAzBmkB,EAAc33B,OAAc,OAEhC,IAAImzB,EACJ,OAAQ3f,GACN,IAAK,KACH2f,GACwB,IAAtB3B,EACImG,EAAc33B,OAAS,EACvB6H,KAAKI,IAAIupB,EAAmB,EAAG,GACrC,MACF,IAAK,OACH2B,GACwB,IAAtB3B,EACI,EACA3pB,KAAKC,IAAI0pB,EAAmB,EAAGmG,EAAc33B,OAAS,GAC5D,MACF,IAAK,OACHmzB,EAAW,EACX,MACF,IAAK,MACHA,EAAWwE,EAAc33B,OAAS,EAClC,MACF,QACE,OAGJyxB,EAAoB0B,GACpBsE,EAAgBE,EAAcxE,IAG9BvuB,YAAW,KACT,MAAMwuB,EAAajgB,SAASnE,cAAc,kBAAD7D,OACrBwsB,EAAcxE,GAAU1xB,IAAG,OAE/C,GAAI2xB,EAAY,CACd,MAAMC,EACU,SAAd7f,EACI,QACc,QAAdA,EACE,MACA,UACR4f,EAAWnkB,eAAe,CACxBqkB,SAAU,SACVpkB,MAAOmkB,GAEX,IACC,OAEL,CAACsE,EAAenG,IAIZ+B,GAAe5U,EAAAA,EAAAA,cAClBrX,IACC3I,EAAc2I,GAEVzH,EAAiBiC,SACnB6C,aAAa9E,EAAiBiC,WAOlC,IAII+1B,GAAmBlZ,EAAAA,EAAAA,cACtBnF,IACCie,EAAgBje,GAChBhb,EAASgb,GACT5U,YAAW,IAAMnG,KAAY,OAE/B,CAACD,EAAUC,IAIPwU,GAAgB0L,EAAAA,EAAAA,cACnBvX,IACC,GAAc,WAAVA,EAAElC,IACJzG,SACK,GAAI,CAAC,YAAa,UAAW,OAAQ,OAAOmE,SAASwE,EAAElC,KAAM,CAClEkC,EAAEO,iBACFP,EAAEqN,kBASFmjB,EAPqE,CACnE5D,UAAW,OACXC,QAAS,KACTC,KAAM,OACNC,IAAK,OAGqB/sB,EAAElC,KAChC,IAEF,CAAC0yB,EAAgBn5B,IAIb21B,GAAsBzV,EAAAA,EAAAA,cACzBvX,IACC,IAAK/I,EAAS,OAGd,MAAMgJ,EAASD,EAAEC,OACjB,GACqB,UAAnBA,EAAOgtB,SACY,aAAnBhtB,EAAOgtB,UACPhtB,EAAOitB,UAAUC,SAAS,yBAC1BltB,EAAO4lB,QAAQ,wBAJjB,CASA,GAAI7lB,EAAE8L,SAAqB,MAAV9L,EAAElC,IAOjB,OANAkC,EAAEO,iBACFP,EAAEqN,uBACE9U,EAAemC,UACjBnC,EAAemC,QAAQgD,QACvBnF,EAAemC,QAAQ0yB,WAM3B,GAAI,CAAC,YAAa,UAAW,OAAQ,OAAO5xB,SAASwE,EAAElC,KAAM,CAC3DkC,EAAEO,iBACFP,EAAEqN,kBASFmjB,EAPqE,CACnE5D,UAAW,OACXC,QAAS,KACTC,KAAM,OACNC,IAAK,OAGqB/sB,EAAElC,KAChC,CAzBA,IA2BF,CAAC7G,EAASu5B,IAIN7yB,GAAUqS,EAAAA,EAAAA,UACd,IAAM,CACJ,CACEpS,MAAO,GACPE,IAAK,SACLC,MAAO,GACPC,OAAQA,CAACsvB,EAAcrvB,KACrBK,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACLuL,OAAQ,UACRX,QAAS,OACTO,eAAgB,SAChBN,WAAY,UAEd7J,QAASA,KACP8wB,EAAgBpyB,GAChB,MAAM+Z,EAAQuY,EAAc3tB,WACzB0jB,GAAYA,EAAEjsB,MAAQ4D,EAAO5D,MAEhCgwB,EAAoBrS,IACpB3Z,UAEFC,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACLR,MAAO,OACPqpB,OAAQ,OACRle,aAAc,MACd1G,QACc,OAAZymB,QAAY,IAAZA,OAAY,EAAZA,EAAc5uB,OAAQ4D,EAAO5D,IACzB,oBACA,oBACNiI,iBACc,OAAZ2mB,QAAY,IAAZA,OAAY,EAAZA,EAAc5uB,OAAQ4D,EAAO5D,IAAM,UAAY,QACjD8O,QAAS,OACTC,WAAY,SACZM,eAAgB,SAChB2d,WAAY,iBACZhpB,UAEW,OAAZ4qB,QAAY,IAAZA,OAAY,EAAZA,EAAc5uB,OAAQ4D,EAAO5D,MAC5BiE,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACLR,MAAO,MACPqpB,OAAQ,MACRle,aAAc,MACd5G,gBAAiB,gBAQ/B,CACE1E,MAAO,OACPC,UAAW,OACXC,IAAK,OACLE,OAAQA,CAACsvB,EAAcrvB,KACrBG,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,GAAIhL,SAAA,EAC5DC,EAAAA,EAAAA,KAACsxB,GAAAA,EAAY,CAACrxB,MAAO,CAAEE,MAAO,cAC9BL,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAC2L,GAAI,CAACujB,QAAM,EAAAnvB,SAAEivB,KACdhvB,EAAAA,EAAAA,KAAA,UACAF,EAAAA,EAAAA,MAAC6L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,QAASL,SAAA,CAAC,IAChDJ,EAAOyyB,oBAMnB,CACE9yB,MAAO,OACPE,IAAK,OACLE,OAAQA,CAACsvB,EAAcrvB,KAAY,IAAA0yB,EAAA,OACjCryB,EAAAA,EAAAA,KAACmK,EAAAA,EAAG,CAAChK,MAAM,OAAMJ,UACE,QAAhBsyB,EAAA1yB,EAAO8oB,iBAAS,IAAA4J,OAAA,EAAhBA,EAAkBp1B,OAAQ,cAIjC,CACEqC,MAAO,SACPC,UAAW,SACXC,IAAK,SACLE,OAASsvB,IACPlvB,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,GAAIhL,SAAA,EAC5DC,EAAAA,EAAAA,KAACmvB,GAAAA,EAAa,CAAClvB,MAAO,CAAEE,MAAO,WAC/BH,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEivB,QAIb,CACE1vB,MAAO,QACPC,UAAW,QACXC,IAAK,QACLE,OAASsvB,IACPlvB,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,GAAIhL,SAAA,EAC5DC,EAAAA,EAAAA,KAACovB,GAAAA,EAAY,CAACnvB,MAAO,CAAEE,MAAO,WAC9BH,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEivB,GAAQ,UAIrB,CACE1vB,MAAO,SACPE,IAAK,SACLE,OAAQA,CAACsvB,EAAcrvB,KAAY,IAAA2yB,EAAA,OACjCtyB,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,QAASL,UAC9B,QAAlBuyB,EAAA3yB,EAAOkX,mBAAW,IAAAyb,OAAA,EAAlBA,EAAoBC,cAAe,UAK5C,CAAC5H,EAAcsH,IAIX3C,GAAcrW,EAAAA,EAAAA,cAClB,CAACtZ,EAAc+Z,KAAc,CAC3BzY,QAASA,KACP8wB,EAAgBpyB,GAChBosB,EAAyB,OAALrS,QAAK,IAALA,EAAAA,EAAS,IAE/BzZ,MAAO,CACLuL,OAAQ,UACRxH,iBACc,OAAZ2mB,QAAY,IAAZA,OAAY,EAAZA,EAAc5uB,OAAQ4D,EAAO5D,IAAM,UAAY,QACjDmI,QACc,OAAZymB,QAAY,IAAZA,OAAY,EAAZA,EAAc5uB,OAAQ4D,EAAO5D,IACzB,oBACA,oBACN6O,aAAc,MACdme,WAAY,iBAEdyB,aAAe9oB,KACG,OAAZipB,QAAY,IAAZA,OAAY,EAAZA,EAAc5uB,OAAQ4D,EAAO5D,MAC/B2F,EAAEuB,cAAchD,MAAM+D,gBAAkB,YAG5C0mB,aAAehpB,KACG,OAAZipB,QAAY,IAAZA,OAAY,EAAZA,EAAc5uB,OAAQ4D,EAAO5D,MAC/B2F,EAAEuB,cAAchD,MAAM+D,gBAAkB,aAI9C,CAAC2mB,KAIHzvB,EAAAA,EAAAA,YAAU,KACJvC,GACFo5B,EAAgB,MAChBhG,GAAqB,KAErB9yB,EAAc,IACd84B,EAAgB,MAChBhG,GAAqB,GACjB5xB,EAAiBiC,UACnB6C,aAAa9E,EAAiBiC,SAC9BjC,EAAiBiC,QAAU,OAIxB,KACDjC,EAAiBiC,SACnB6C,aAAa9E,EAAiBiC,YAGjC,CAACzD,KAGJuC,EAAAA,EAAAA,YAAU,KACR,GAAIvC,GAAWs5B,EAAc33B,OAAS,GAAgB,OAAXytB,QAAW,IAAXA,GAAAA,EAAahsB,MAAQ4uB,EAAc,CAC5E,MAAM6H,EAAoBP,EAAc/sB,MAAM4O,GAAeA,EAAK/X,MAAQgsB,EAAYhsB,MACtF,GAAIy2B,EAAmB,CACrBT,EAAgBS,GAChB,MAAM9Y,EAAQuY,EAAc3tB,WAAWwP,GAAeA,EAAK/X,MAAQgsB,EAAYhsB,MAC/EgwB,EAAoBrS,GAGpBxa,YAAW,KACT,MAAMwuB,EAAajgB,SAASnE,cAAc,kBAAD7D,OACrB+sB,EAAkBz2B,IAAG,OAErC2xB,GACFA,EAAWnkB,eAAe,CACxBqkB,SAAU,SACVpkB,MAAO,aAGV,IACL,CACF,IACC,CAAC7Q,EAASs5B,EAA0B,OAAXlK,QAAW,IAAXA,OAAW,EAAXA,EAAahsB,IAAK4uB,KAG9CzvB,EAAAA,EAAAA,YAAU,KACR,GAAIvC,GAAWsB,EAAemC,QAAS,CACrC,MAAMmzB,EAAcA,KACdt1B,EAAemC,UACjBnC,EAAemC,QAAQgD,QACvBnF,EAAemC,QAAQ0yB,WAI3BS,IACA,MAAMC,EAAQtwB,WAAWqwB,EAAa,KAEtC,MAAO,IAAMtwB,aAAauwB,EAC5B,IACC,CAAC72B,KAGJuC,EAAAA,EAAAA,YAAU,KACR,GAAIvC,EAEF,OADA8U,SAASC,iBAAiB,UAAWghB,GAAqB,GACnD,IACLjhB,SAASE,oBAAoB,UAAW+gB,GAAqB,KAEhE,CAAC/1B,EAAS+1B,IAGb,MAAMqB,GAAoB9W,EAAAA,EAAAA,cAAY,KACpC8Y,EAAgB,MAChBhG,GAAqB,KACpB,IAEH,OACEjsB,EAAAA,EAAAA,MAACe,EAAAA,EAAK,CACJvB,MAAM,0BACNwB,KAAMnI,EACNI,SAAUA,EACVgI,OAAQ,KACRtB,MAAO,IACPQ,MAAO,CAAE+vB,IAAK,IACdC,gBAAiBnvB,IACXA,GAAQ7G,EAAemC,SACzB8C,YAAW,KAAO,IAADC,EAAA6C,EACO,QAAtB7C,EAAAlF,EAAemC,eAAO,IAAA+C,GAAtBA,EAAwBC,QACF,QAAtB4C,EAAA/H,EAAemC,eAAO,IAAA4F,GAAtBA,EAAwB8sB,WACvB,MAEL/uB,SAAA,EAEFC,EAAAA,EAAAA,KAAA,OACEuB,IAAKgrB,EACLtsB,MAAO,CAAEqB,aAAc,IACvBS,UAAWwL,EACXrC,SAAU,EAAEnL,UAEZC,EAAAA,EAAAA,KAACvH,EAAAA,EAAK,CACJ8I,IAAKtH,EACLuH,YAAY,sEACZI,MAAO5I,EACPyI,SAAUC,GAAKmsB,EAAansB,EAAEC,OAAOC,OACrCsuB,QAAQlwB,EAAAA,EAAAA,KAACmwB,GAAAA,EAAc,IACvBlwB,MAAO,CAAER,MAAO,QAChBsC,UAAWL,IAEK,UAAVA,EAAElC,KAAmBmrB,GACvBwH,EAAiBxH,IAGrByF,QAASL,EACTjuB,WAAS,EACTW,OAAQA,KAEF9J,GAAWsB,EAAemC,SAC5B8C,YAAW,KACLvG,GAAWsB,EAAemC,SAC5BnC,EAAemC,QAAQgD,UAExB,KAGPixB,OACEr3B,GAAcoc,GACZpV,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEG,SAAU,OAAQD,MAAO,QAASJ,SAAC,iBAG/C,UAKVC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEoD,UAAW,IAAKmtB,SAAU,QAASzwB,SAC9CqV,GACCpV,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEwE,UAAW,SAAUC,QAAS,IAAK3E,UAC/CC,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAC,uBAEmB,IAAzBkyB,EAAc33B,QAChB0F,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEwE,UAAW,SAAUC,QAAS,IAAK3E,UAC/CC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAW7C,SACnB/G,EACG,uCACA,2BAIR8G,EAAAA,EAAAA,MAAA,OACEkD,SAAWtB,IACT,MAAMC,EAASD,EAAEuB,cACXC,EAAYvB,EAAOuB,UACnBC,EAAexB,EAAOwB,cAEFD,EADLvB,EAAOyB,cAC0BD,EAE/B,IAAO1J,IAAY2b,IAAgBhb,EAAiBgC,UACzEhC,EAAiBgC,SAAU,EAC3B9C,GAAQoC,GAAQA,EAAO,MAG3BuE,MAAO,CAAEoD,UAAW,IAAKC,UAAW,QAASvD,SAAA,EAE7CC,EAAAA,EAAAA,KAACuD,EAAAA,EAAK,CACJlE,QAASA,EACTmE,WAAYyuB,EACZxuB,OAAO,MACPjI,YAAY,EACZkI,KAAK,QACLa,OAAQ,CAAEC,OAAGP,GACbN,MAAO2rB,IAER71B,GAAWw4B,EAAc33B,OAAS,IACjC0F,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEwE,UAAW,SAAUC,QAAS,MAAOvE,MAAO,OAAQwE,UAAW,qBAAsB5E,SAChGqV,EAAc,kBAAoB,mC,mDC7lBnD,MAAQgU,MAAK,GAAEzd,KAAK,IAAIC,EAAAA,EAgWxB,GArV4ElT,IAOrE,IAPsE,QAC3EC,EAAO,UACP85B,EAAS,eACTC,EAAc,SACd35B,EAAQ,cACRynB,EAAa,mBACbmS,GACDj6B,EACC,MAAMk6B,GAAmB14B,EAAAA,EAAAA,QAA0B,MAG7C24B,GAAgB5Z,EAAAA,EAAAA,cAAY,KAChCwZ,IAEIE,GACFzzB,YAAW,KACTyzB,MACC,OAEJ,CAACF,EAAWE,IAkCf,OA/BAz3B,EAAAA,EAAAA,YAAU,KACR,IAAKvC,EAAS,OAEd,MAAM4U,EAAiB7L,IAEP,UAAVA,EAAElC,KAAoBkC,EAAE8L,QAKT,UAAV9L,EAAElC,KAAmBkC,EAAE8L,SAC9B9L,EAAEO,iBACFywB,KAGiB,WAAVhxB,EAAElC,MACTkC,EAAEO,iBACFlJ,MAXA2I,EAAEO,iBACF4wB,MAqBJ,OAPAC,OAAOplB,iBAAiB,UAAWH,GAG/BqlB,EAAiBx2B,SACnBw2B,EAAiBx2B,QAAQgD,QAGpB,IAAM0zB,OAAOnlB,oBAAoB,UAAWJ,KAClD,CAAC5U,EAASk6B,EAAeH,EAAgB35B,KAG1C+G,EAAAA,EAAAA,MAACe,EAAAA,EAAK,CACJvB,MAAO,KACPwB,KAAMnI,EACNI,SAAUA,EACVgI,OAAQ,KACRtB,MAAO,IACPszB,UAAQ,EACRC,cAAc,EACdC,UAAU,EACVC,UAAW,CAAExuB,QAAS,aAAc3E,SAAA,EAGpCD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEwE,UAAW,SAAUnD,aAAc,QAASvB,SAAA,EACxDC,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACL4K,QAAS,eACTsoB,UAAW,6BACX7xB,aAAc,QACdvB,UAEFC,EAAAA,EAAAA,KAACgK,EAAAA,EAAmB,CAClB/J,MAAO,CACLE,MAAO,UACPC,SAAU,OACVnE,OAAQ,wDAId+D,EAAAA,EAAAA,KAACopB,GAAK,CAACM,MAAO,EAAGzpB,MAAO,CAAEoL,OAAQ,QAASlL,MAAO,UAAWD,WAAY,KAAMH,SAAC,8BAGhFC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,QAASL,SAAC,wDAMrDygB,IACC1gB,EAAAA,EAAAA,MAAA,OACEG,MAAO,CACLyoB,WAAY,oDACZxkB,OAAQ,oBACR0G,aAAc,OACdlG,QAAS,OACTpD,aAAc,OACdqnB,UAAW,sCACX5oB,SAAA,EAEFD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUxJ,aAAc,QAASvB,SAAA,EAC1EC,EAAAA,EAAAA,KAAC4oB,EAAAA,EAAgB,CAAC3oB,MAAO,CAAEG,SAAU,OAAQD,MAAO,UAAWwpB,YAAa,UAC5E3pB,EAAAA,EAAAA,KAACopB,GAAK,CAACM,MAAO,EAAGzpB,MAAO,CAAEoL,OAAQ,EAAGlL,MAAO,UAAWC,SAAU,QAASL,SAAC,qBAI7ED,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQumB,oBAAqB,UAAWrmB,IAAK,QAAShL,SAAA,EAC3ED,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CACV4K,QAAS,OACTC,WAAY,SACZC,IAAK,MACLrG,QAAS,WACTgkB,WAAY,2BACZ9d,aAAc,OACd7K,SAAA,EACAC,EAAAA,EAAAA,KAAC4oB,EAAAA,EAAgB,CAAC3oB,MAAO,CAAEE,MAAO,UAAWC,SAAU,WACvDN,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,OAAQyK,QAAS,SAAU9K,SAAC,aACtEC,EAAAA,EAAAA,KAAC2L,GAAI,CAACujB,QAAM,EAACjvB,MAAO,CAAEG,SAAU,QAASL,SAAEygB,EAAcrI,oBAG7DrY,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CACV4K,QAAS,OACTC,WAAY,SACZC,IAAK,MACLrG,QAAS,WACTgkB,WAAY,2BACZ9d,aAAc,OACd7K,SAAA,EACAC,EAAAA,EAAAA,KAACsxB,GAAAA,EAAY,CAACrxB,MAAO,CAAEE,MAAO,UAAWC,SAAU,WACnDN,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,OAAQyK,QAAS,SAAU9K,SAAC,cACtEC,EAAAA,EAAAA,KAAC2L,GAAI,CAACujB,QAAM,EAACjvB,MAAO,CAAEG,SAAU,QAASL,SAAEygB,EAAcnI,eAAiB,eAG9EvY,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CACV4K,QAAS,OACTC,WAAY,SACZC,IAAK,MACLrG,QAAS,WACTgkB,WAAY,2BACZ9d,aAAc,OACd7K,SAAA,EACAC,EAAAA,EAAAA,KAACozB,GAAAA,EAAgB,CAACnzB,MAAO,CAAEE,MAAO,UAAWC,SAAU,WACvDN,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,OAAQyK,QAAS,SAAU9K,SAAC,UACtEC,EAAAA,EAAAA,KAAC2L,GAAI,CAACujB,QAAM,EAACjvB,MAAO,CAAEG,SAAU,QAASL,SAAE2H,IAAM8Y,EAAcrQ,MAAMnI,OAAO,uBAGhFlI,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CACV4K,QAAS,OACTC,WAAY,SACZC,IAAK,MACLrG,QAAS,WACTgkB,WAAY,2BACZ9d,aAAc,OACd7K,SAAA,EACAC,EAAAA,EAAAA,KAACqzB,GAAAA,EAAc,CAACpzB,MAAO,CAAEE,MAAO,UAAWC,SAAU,WACrDN,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,OAAQyK,QAAS,SAAU9K,SAAC,YACtED,EAAAA,EAAAA,MAAC6L,GAAI,CAACujB,QAAM,EAACjvB,MAAO,CAAEG,SAAU,OAAQD,MAAO,WAAYJ,SAAA,CAAC,UACjB,kBAA/BygB,EAActN,aAA4BsN,EAActN,aAAeogB,WAAW9S,EAActN,eAAiB,GAAGxS,QAAQ,mBAQlJV,EAAAA,EAAAA,KAAC4xB,GAAAA,EAAO,CAAC3xB,MAAO,CAAEoL,OAAQ,SAAUof,YAAa,cAGjD3qB,EAAAA,EAAAA,MAACsB,EAAAA,EAAK,CAAC0M,UAAU,WAAWpK,KAAK,SAASzD,MAAO,CAAER,MAAO,QAASM,SAAA,EACjED,EAAAA,EAAAA,MAAC6C,EAAAA,GAAM,CACLpB,IAAKqxB,EACLhwB,KAAK,UACLc,KAAK,QACLb,MAAM7C,EAAAA,EAAAA,KAAC6Q,EAAAA,EAAY,IACnB5P,QAAS4xB,EACT5yB,MAAO,CACLR,MAAO,OACPqpB,OAAQ,OACRJ,WAAY,oDACZxkB,OAAQ,OACRhE,WAAY,IACZE,SAAU,OACVwK,aAAc,MACd+d,UAAW,qCACX9d,QAAS,OACTC,WAAY,SACZM,eAAgB,SAChByd,SAAU,WACVE,WAAY,iBAEdyB,aAAe9oB,IACbA,EAAEuB,cAAchD,MAAMszB,UAAY,mBAClC7xB,EAAEuB,cAAchD,MAAM0oB,UAAY,sCAEpC+B,aAAehpB,IACbA,EAAEuB,cAAchD,MAAMszB,UAAY,gBAClC7xB,EAAEuB,cAAchD,MAAM0oB,UAAY,sCAClC5oB,SAAA,EAEFC,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAE4B,KAAM,EAAG4C,UAAW,OAAQnE,WAAY,OAAQP,SAAC,kCAGhEC,EAAAA,EAAAA,KAACwzB,GAAAA,EAAK,CACJC,OAAO3zB,EAAAA,EAAAA,MAAA,QAAMG,MAAO,CAClByoB,WAAY,2BACZhkB,QAAS,UACTkG,aAAc,MACdxK,SAAU,OACVF,WAAY,IACZC,MAAO,QACP0K,QAAS,OACTC,WAAY,SACZC,IAAK,OACLhL,SAAA,EACAC,EAAAA,EAAAA,KAAC0zB,GAAAA,EAAa,IAAG,YAEnBzzB,MAAO,CAAE0pB,YAAa,aAI1B7pB,EAAAA,EAAAA,MAAC6C,EAAAA,GAAM,CACLe,KAAK,QACLb,MAAM7C,EAAAA,EAAAA,KAAC4oB,EAAAA,EAAgB,IACvB3nB,QAASyxB,EACTzyB,MAAO,CACLR,MAAO,OACPqpB,OAAQ,OACRJ,WAAY,oDACZvoB,MAAO,QACP+D,OAAQ,OACRhE,WAAY,IACZE,SAAU,OACVwK,aAAc,MACd+d,UAAW,qCACX9d,QAAS,OACTC,WAAY,SACZM,eAAgB,SAChByd,SAAU,WACVE,WAAY,iBAEdyB,aAAe9oB,IACbA,EAAEuB,cAAchD,MAAMszB,UAAY,mBAClC7xB,EAAEuB,cAAchD,MAAM0oB,UAAY,sCAEpC+B,aAAehpB,IACbA,EAAEuB,cAAchD,MAAMszB,UAAY,gBAClC7xB,EAAEuB,cAAchD,MAAM0oB,UAAY,sCAClC5oB,SAAA,EAEFC,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAE4B,KAAM,EAAG4C,UAAW,OAAQnE,WAAY,OAAQP,SAAC,6CAGhEC,EAAAA,EAAAA,KAACwzB,GAAAA,EAAK,CACJC,OAAO3zB,EAAAA,EAAAA,MAAA,QAAMG,MAAO,CAClByoB,WAAY,2BACZhkB,QAAS,UACTkG,aAAc,MACdxK,SAAU,OACVF,WAAY,IACZC,MAAO,QACP0K,QAAS,OACTC,WAAY,SACZC,IAAK,OACLhL,SAAA,CAAC,SACIC,EAAAA,EAAAA,KAAC0zB,GAAAA,EAAa,OAErBzzB,MAAO,CAAE0pB,YAAa,aAK1B3pB,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLe,KAAK,SACLb,MAAM7C,EAAAA,EAAAA,KAACkxB,GAAAA,EAAa,IACpBjwB,QAASlI,EACT6J,KAAK,OACL3C,MAAO,CACLR,MAAO,OACPqpB,OAAQ,OACR5oB,WAAY,IACZE,SAAU,OACVD,MAAO,UACP4oB,WAAY,iBAEdyB,aAAe9oB,IACbA,EAAEuB,cAAchD,MAAME,MAAQ,UAC9BuB,EAAEuB,cAAchD,MAAMyoB,WAAa,WAErCgC,aAAehpB,IACbA,EAAEuB,cAAchD,MAAME,MAAQ,UAC9BuB,EAAEuB,cAAchD,MAAMyoB,WAAa,eACnC3oB,SACH,oBAMHC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CACVI,UAAW,OACXqE,QAAS,YACTgkB,WAAY,oDACZ9d,aAAc,MACd1G,OAAQ,qBACRnE,UACAD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,OAAQhL,SAAA,EAChEC,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAEG,SAAU,QAASL,SAAC,kBACnCC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAE4B,KAAM,GAAI9B,UACtBD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC1L,MAAO,CAAEG,SAAU,OAAQD,MAAO,UAAWwzB,WAAY,OAAQ5zB,SAAA,EACrEC,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,UAAc,uBAAcC,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,eAAmB,uBAAcC,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,QAAY,sBAOzGC,EAAAA,EAAAA,KAAA,SAAAD,SAAA,mT,wFC5TN,MAAQqpB,MAAK,GAAEzd,KAAK,IAAIC,EAAAA,GAChBpT,OAAO,IAAIC,EAAAA,EAgWnB,GAvVsDC,IAK/C,IALgD,QACrDC,EAAO,QACPmM,EAAO,WACP8uB,EAAU,UACVnB,GACD/5B,EAEC,MAAQ6B,KAAMs5B,EAAcp5B,UAAWC,GAAYC,EAAAA,GAASm5B,uBAC1D,CAAC,EACD,CAAE94B,MAAOrC,IAILo7B,GAAWriB,EAAAA,EAAAA,UAAQ,KACH,OAAZmiB,QAAY,IAAZA,OAAY,EAAZA,EAAsBv4B,SAAU,IACvC,CAACu4B,KAEG76B,EAAYC,IAAiBC,EAAAA,EAAAA,UAAS,KACtC86B,EAAWC,IAAgB/6B,EAAAA,EAAAA,UAAiB,UAG7Cg7B,GAAgBxiB,EAAAA,EAAAA,UAAQ,KAC5B,IAAKqiB,IAAa1rB,MAAMC,QAAQyrB,GAAW,MAAO,GAGlD,IAAII,EAAiBJ,EAUrB,GAREI,EADgB,WAAdH,EACeD,EAAS93B,QAAQm4B,GAA8B,UAAhBA,EAAKnqB,SAEpC8pB,EAAS93B,QAAQm4B,IAC/BA,EAAKnqB,QAA0B,cAAhBmqB,EAAKnqB,UAKpBjR,EAAY,OAAOm7B,EAExB,MAAMp3B,EAAc/D,EAAWgE,cAC/B,OAAOm3B,EAAel4B,QAAQm4B,IAAe,IAADC,EAC1C,MAAMC,EAAYF,EAAKjc,YAAc,GAC/B+L,GAAmC,QAApBmQ,EAAAD,EAAK5Z,uBAAe,IAAA6Z,OAAA,EAApBA,EAAsB1Z,YAAa,GAClDxK,EAAOikB,EAAKjkB,MAAQ,GACpBmZ,EAA2C,kBAAtB8K,EAAKlhB,aAA4BkhB,EAAKlhB,aAAa1V,WAAasP,OAAOsnB,EAAKlhB,cAAgB,IAEvH,OACEohB,EAAUt3B,cAAcE,SAASH,IACjCmnB,EAAalnB,cAAcE,SAASH,IACpCoT,EAAKjT,SAASlE,IACdswB,EAAYpsB,SAASlE,QAGxB,CAAC+6B,EAAU/6B,EAAYg7B,IAQpBO,EAAuBA,CAAC7b,EAAiBC,IACzCD,IAAWC,EAAwB,OACnCA,EAAwB,UACrB,SAGH6b,EAAkBJ,IAEtBR,EAAWQ,GACXtvB,KAGI+tB,EAAgBA,KACpBJ,IACA3tB,KAGF,OACEhF,EAAAA,EAAAA,MAAC20B,GAAAA,EAAM,CACLn1B,OACEQ,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUM,eAAgB,iBAAkBrL,SAAA,EACrFC,EAAAA,EAAAA,KAACopB,GAAK,CAACM,MAAO,EAAGzpB,MAAO,CAAEoL,OAAQ,EAAGlL,MAAO,WAAYJ,SAAC,4BAGzDC,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLC,KAAK,OACLC,MAAM7C,EAAAA,EAAAA,KAACkxB,GAAAA,EAAa,IACpBjwB,QAAS6D,EACTpB,KAAK,aAIXgxB,UAAU,OACV5zB,KAAMnI,EACNmM,QAASA,EACTrF,MAAO,IACPyzB,UAAW,CAAExuB,QAAS,QACtBiwB,YAAa,CACXC,aAAc,oBACdlwB,QAAS,uBACT3E,SAAA,EAGFC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEqB,aAAc,QAASvB,UACnCD,EAAAA,EAAAA,MAACsB,EAAAA,EAAK,CAAC0M,UAAU,WAAWpK,KAAK,SAASzD,MAAO,CAAER,MAAO,QAASM,SAAA,EACjEC,EAAAA,EAAAA,KAACxH,GAAM,CACLgJ,YAAY,6CACZI,MAAO5I,EACPyI,SAAWC,GAAMzI,EAAcyI,EAAEC,OAAOC,OACxCsuB,QAAQlwB,EAAAA,EAAAA,KAACmwB,GAAAA,EAAc,IACvB0E,YAAU,EACVnxB,KAAK,WAGP1D,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLC,KAAK,UACLC,MAAM7C,EAAAA,EAAAA,KAAC6Q,EAAAA,EAAY,IACnB5P,QAAS4xB,EACT5yB,MAAO,CACLR,MAAO,OACPqpB,OAAQ,OACRJ,WAAY,oDACZxkB,OAAQ,OACRhE,WAAY,IACZ0K,aAAc,OACd7K,SACH,uCAMLC,EAAAA,EAAAA,KAAC4xB,GAAAA,EAAO,CAAC3xB,MAAO,CAAEoL,OAAQ,aAG1BrL,EAAAA,EAAAA,KAAC80B,GAAAA,EAAI,CACHC,UAAWf,EACXvyB,SAAUwyB,EACV1iB,MAAO,CACL,CACE/R,IAAK,SACLoR,OACE9Q,EAAAA,EAAAA,MAAA,QAAAC,SAAA,CAAM,yBACgB,OAARg0B,QAAQ,IAARA,OAAQ,EAARA,EAAU93B,QAAQ0B,GAAwB,UAAbA,EAAEsM,SAAoB3P,SAAU,EAAE,QAIjF,CACEkF,IAAK,YACLoR,OACE9Q,EAAAA,EAAAA,MAAA,QAAAC,SAAA,CAAM,sBACkB,OAARg0B,QAAQ,IAARA,OAAQ,EAARA,EAAU93B,QAAQ0B,IAAYA,EAAEsM,QAAuB,cAAbtM,EAAEsM,SAAwB3P,SAAU,EAAE,SAKtG2F,MAAO,CAAEqB,aAAc,OAIzBtB,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAE6oB,OAAQ,sBAAuB0H,SAAU,QAASzwB,SAC7DrF,GACCoF,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEwE,UAAW,SAAUC,QAAS,QAAS3E,SAAA,EACnDC,EAAAA,EAAAA,KAACg1B,GAAAA,EAAI,CAACtxB,KAAK,WACX1D,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEI,UAAW,QAASN,UAChCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAW7C,SAAC,0BAGA,IAAzBm0B,EAAc55B,QAChB0F,EAAAA,EAAAA,KAACi1B,GAAAA,EAAK,CACJtvB,aACE7F,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACEC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAW7C,SACnB/G,EAAa,uCAAyC,yBAEvDA,IACAgH,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEI,UAAW,OAAQN,UAC/BC,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CAACC,KAAK,OAAO3B,QAAS4xB,EAAc9yB,SAAC,gCAOpDE,MAAO,CAAEI,UAAW,WAGtBL,EAAAA,EAAAA,KAACk1B,GAAAA,EAAI,CACH1xB,WAAY0wB,EACZiB,WAAaf,IAAI,IAAAgB,EAvII1c,EAAiBC,EAuIrB,OACf3Y,EAAAA,EAAAA,KAACk1B,GAAAA,EAAK7D,KAAI,CACRpxB,MAAO,CACLyE,QAAS,OACTR,OAAQ,oBACR0G,aAAc,MACdtJ,aAAc,OACdonB,WAAY,QACZld,OAAQ,UACRud,WAAY,iBAEdyB,aAAe9oB,IACbA,EAAEuB,cAAchD,MAAM0oB,UAAY,gCAClCjnB,EAAEuB,cAAchD,MAAMszB,UAAY,oBAEpC7I,aAAehpB,IACbA,EAAEuB,cAAchD,MAAM0oB,UAAY,OAClCjnB,EAAEuB,cAAchD,MAAMszB,UAAY,iBAEpCtyB,QAASA,IAAMuzB,EAAeJ,GAAMr0B,UAEpCD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAER,MAAO,QAASM,SAAA,EAE5BD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CACV4K,QAAS,OACTO,eAAgB,gBAChBN,WAAY,SACZxJ,aAAc,OACdvB,SAAA,EACAD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,OAAQhL,SAAA,EAChEC,EAAAA,EAAAA,KAACq1B,GAAAA,EAAM,CACLxyB,MAAM7C,EAAAA,EAAAA,KAAC4oB,EAAAA,EAAgB,IACvB3oB,MAAO,CACLyoB,WAAY,oDACZvoB,MAAO,YAGXH,EAAAA,EAAAA,KAAC2L,GAAI,CAACujB,QAAM,EAACjvB,MAAO,CAAEG,SAAU,QAASL,SACtCq0B,EAAKjc,iBAGVrY,EAAAA,EAAAA,MAACsB,EAAAA,EAAK,CAAArB,SAAA,CACa,UAAhBq0B,EAAKnqB,QACJjK,EAAAA,EAAAA,KAACmK,EAAAA,EAAG,CAAChK,MAAM,SAAQJ,SAAC,WAEpBC,EAAAA,EAAAA,KAACmK,EAAAA,EAAG,CAAChK,MAAM,QAAOJ,SAAC,eAErBC,EAAAA,EAAAA,KAACmK,EAAAA,EAAG,CAAChK,OAtLMuY,EAsLuB0b,EAAKrY,QAtLXpD,EAsLoByb,EAAKpY,kBArLnEtD,IAAWC,EAAwB,UACnCA,EAAwB,UACrB,SAmLmF5Y,SACrEw0B,EAAqBH,EAAKrY,QAASqY,EAAKpY,4BAM/Clc,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CACV4K,QAAS,OACTC,WAAY,SACZC,IAAK,MACLzJ,aAAc,OACdvB,SAAA,EACAC,EAAAA,EAAAA,KAACsxB,GAAAA,EAAY,CAACrxB,MAAO,CAAEE,MAAO,UAAWC,SAAU,WACnDJ,EAAAA,EAAAA,KAAC2L,GAAI,CAAC1L,MAAO,CAAEG,SAAU,OAAQD,MAAO,WAAYJ,UAC7B,QAApBq1B,EAAAhB,EAAK5Z,uBAAe,IAAA4a,OAAA,EAApBA,EAAsBza,YAAayZ,EAAK/b,eAAiB,YAK9DvY,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CACV4K,QAAS,OACTO,eAAgB,gBAChBN,WAAY,UACZ/K,SAAA,EACAD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,OAAQhL,SAAA,EAChEC,EAAAA,EAAAA,KAACozB,GAAAA,EAAgB,CAACnzB,MAAO,CAAEE,MAAO,UAAWC,SAAU,WACvDJ,EAAAA,EAAAA,KAAC2L,GAAI,CAAC1L,MAAO,CAAEG,SAAU,OAAQD,MAAO,WAAYJ,SACjDq0B,EAAKjkB,KAAOzI,IAAM0sB,EAAKjkB,MAAMnI,OAAO,cAAgB,YAGzDlI,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,OAAQhL,SAAA,EAChEC,EAAAA,EAAAA,KAACqzB,GAAAA,EAAc,CAACpzB,MAAO,CAAEE,MAAO,UAAWC,SAAU,WACrDN,EAAAA,EAAAA,MAAC6L,GAAI,CAACujB,QAAM,EAACjvB,MAAO,CAAEG,SAAU,OAAQD,MAAO,WAAYJ,SAAA,CAAC,UAC1B,kBAAtBq0B,EAAKlhB,aAA4BkhB,EAAKlhB,aAAeogB,WAAWc,EAAKlhB,eAAiB,GAAGxS,QAAQ,aAMjHZ,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CACV4K,QAAS,OACTE,IAAK,MACL1K,UAAW,OACX+K,eAAgB,YAChBrL,SAAA,EACAC,EAAAA,EAAAA,KAACkK,EAAAA,EAAO,CAAC5K,MAAM,YAAWS,UACxBC,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLC,KAAK,OACLC,MAAM7C,EAAAA,EAAAA,KAACs1B,GAAAA,EAAW,IAClB5xB,KAAK,QACLzC,QAAUS,IACRA,EAAEqN,kBACFylB,EAAeJ,IAEjBn0B,MAAO,CAAEE,MAAO,eAGH,UAAhBi0B,EAAKnqB,SACJjK,EAAAA,EAAAA,KAACkK,EAAAA,EAAO,CAAC5K,MAAM,aAAYS,UACzBC,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLC,KAAK,OACLC,MAAM7C,EAAAA,EAAAA,KAACu1B,EAAAA,EAAe,IACtB7xB,KAAK,QACLzC,QAAUS,IACRA,EAAEqN,mBAGJ9O,MAAO,CAAEE,MAAO,wBAQ9B3E,YAAY,OAMlBwE,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CACV4oB,SAAU,WACV6H,OAAQ,EACR1H,KAAM,EACNC,MAAO,EACPvkB,QAAS,OACTgkB,WAAY,QACZ/jB,UAAW,qBACX5E,UACAD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CACV4K,QAAS,OACTO,eAAgB,gBAChBN,WAAY,UACZ/K,SAAA,EACAD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,QAASL,SAAA,CAAC,gBACpCm0B,EAAc55B,WAE9B0F,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,QAASL,SAAC,4D,gBCnX9D,MAAQqpB,MAAK,GAAEzd,KAAK,IAAIC,EAAAA,EAqOxB,GAxM0DlT,IAInD,IAAD88B,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,IAJqD,QACzDn9B,EAAO,SACPI,EAAQ,UACR6M,GACDlN,EACC,MAAOq9B,EAAgBC,IAAqB98B,EAAAA,EAAAA,UAAgC,OAGpEqB,KAAM07B,EAAax7B,UAAWC,GAAYC,EAAAA,GAASC,mBAAmB,CAC5EmB,IAAK6J,GACJ,CAAE5K,MAAOrC,IAAYiN,KAExB1K,EAAAA,EAAAA,YAAU,KACR,GAAIvC,GAAWiN,GAAaqwB,EAAa,CACvC,MAAMr9B,GAAuB,OAAXq9B,QAAW,IAAXA,OAAW,EAAXA,EAAqB36B,SAAU,GAC3CsF,EAAUyH,MAAMC,QAAQ1P,GAAYA,EAASsM,MAAM3I,GAAWA,EAAER,MAAQ6J,IAAa,KACvFhF,GACFo1B,EAAkBp1B,EAEtB,IACC,CAACjI,EAASiN,EAAWqwB,IAExB,MAAMC,EAAeA,KACnBF,EAAkB,MAClBj9B,KAGF,OAAKg9B,GAsBH/1B,EAAAA,EAAAA,KAACa,EAAAA,EAAK,CACJvB,OACEQ,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAE4K,QAAS,OAAQC,WAAY,SAAUC,IAAK,OAAQhL,SAAA,EAChEC,EAAAA,EAAAA,KAAA,QAAAD,SAAM,kCACNC,EAAAA,EAAAA,KAACmK,EAAAA,EAAG,CAAChK,MAAM,OAAOF,MAAO,CAAEoL,OAAQ,GAAItL,SACpCg2B,EAAe54B,SAItB2D,KAAMnI,EACNI,SAAUm9B,EACVn1B,OAAQ,KACRtB,MAAO,IACPuB,gBAAc,EAAAjB,UAEdD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEyE,QAAS,UAAW3E,SAAA,EAEhCD,EAAAA,EAAAA,MAAA,OAAKG,MAAO,CAAEqB,aAAc,QAASvB,SAAA,EACnCC,EAAAA,EAAAA,KAACopB,GAAK,CAACM,MAAO,EAAGzpB,MAAO,CAAEoL,OAAQ,YAAalL,MAAO,WAAYJ,SAC/Dg2B,EAAe94B,QAES,QAA1Bu4B,EAAAO,EAAe34B,mBAAW,IAAAo4B,OAAA,EAA1BA,EAA4Bn4B,gBAC3ByC,EAAAA,EAAAA,MAACqK,EAAAA,EAAG,CAAChK,MAAM,QAAQF,MAAO,CAAEG,SAAU,QAASL,SAAA,CAAC,YACpCg2B,EAAe34B,YAAYC,oBAK3C2C,EAAAA,EAAAA,KAAC4xB,GAAAA,EAAO,CAAC3xB,MAAO,CAAEoL,OAAQ,aAG1BvL,EAAAA,EAAAA,MAACq2B,GAAAA,EAAY,CACX72B,MAAM,sBACN6N,OAAQ,EACRzJ,KAAK,QACL2N,UAAQ,EACRpR,MAAO,CAAEqB,aAAc,QAASvB,SAAA,EAEhCC,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,eAAewlB,KAAM,EAAEr2B,UAC9CC,EAAAA,EAAAA,KAAC2L,GAAI,CAACujB,QAAM,EAAAnvB,SAAEg2B,EAAe94B,UAGJ,QAA1Bw4B,EAAAM,EAAe34B,mBAAW,IAAAq4B,OAAA,EAA1BA,EAA4Bp4B,gBAC3B2C,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,eAAc7Q,UACrCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEg2B,EAAe34B,YAAYC,kBAIX,QAA1Bq4B,EAAAK,EAAe34B,mBAAW,IAAAs4B,OAAA,EAA1BA,EAA4Bp4B,gBAC3B0C,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,eAAc7Q,UACrCC,EAAAA,EAAAA,KAAC2L,GAAI,CAACrB,MAAI,EAAAvK,SAAEg2B,EAAe34B,YAAYE,kBAI3C0C,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,MAAK7Q,UAC5BC,EAAAA,EAAAA,KAAC2L,GAAI,CAACrB,MAAI,EAAAvK,SAAEg2B,EAAe54B,QAG5B44B,EAAeM,QACdr2B,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,QAAO7Q,UAC9BC,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEg2B,EAAeM,UAIzBN,EAAeO,OACdt2B,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,OAAM7Q,UAC7BC,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEg2B,EAAeO,SAIzBP,EAAepwB,cACd3F,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,cAAcwlB,KAAM,EAAEr2B,UAC7CC,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEg2B,EAAepwB,oBAM5B7F,EAAAA,EAAAA,MAACq2B,GAAAA,EAAY,CACX72B,MAAM,gBACN6N,OAAQ,EACRzJ,KAAK,QACL2N,UAAQ,EACRpR,MAAO,CAAEqB,aAAc,QAASvB,SAAA,EAEhCC,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,gBAAe7Q,UACtCD,EAAAA,EAAAA,MAAC6L,GAAI,CAACujB,QAAM,EAACjvB,MAAO,CAAEE,MAAO,UAAWC,SAAU,QAASL,SAAA,CAAC,UAC5B,QAA5B41B,EAAAI,EAAex4B,qBAAa,IAAAo4B,OAAA,EAA5BA,EAA8Bj1B,QAAQ,KAAM,aAIlDV,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,MAAK7Q,UAC5BD,EAAAA,EAAAA,MAAC6L,GAAI,CAAC1L,MAAO,CAAEE,MAAO,WAAYJ,SAAA,CAAC,UACb,QAAlB61B,EAAAG,EAAezc,WAAG,IAAAsc,OAAA,EAAlBA,EAAoBl1B,QAAQ,KAAM,aAIZ,QAA3Bm1B,EAAAE,EAAe3jB,oBAAY,IAAAyjB,OAAA,EAA3BA,EAA6B54B,QAC5B+C,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,WAAU7Q,UACjCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEg2B,EAAe3jB,aAAanV,cAIUgH,KAArB,QAA3B6xB,EAAAC,EAAe3jB,oBAAY,IAAA0jB,OAAA,EAA3BA,EAA6B3jB,kBAC5BnS,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,WAAU7Q,UACjCD,EAAAA,EAAAA,MAACqK,EAAAA,EAAG,CAAChK,MAAM,SAAQJ,SAAA,CAChBg2B,EAAe3jB,aAAaD,eAAe,kBAOrBlO,IAA7B8xB,EAAeQ,gBAAwDtyB,IAA7B8xB,EAAeS,aACzD12B,EAAAA,EAAAA,MAACq2B,GAAAA,EAAY,CACX72B,MAAM,oBACN6N,OAAQ,EACRzJ,KAAK,QACL2N,UAAQ,EAAAtR,SAAA,MAEsBkE,IAA7B8xB,EAAeQ,YACdv2B,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,gBAAe7Q,UACtCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEg2B,EAAeQ,mBAIItyB,IAA7B8xB,EAAeS,YACdx2B,EAAAA,EAAAA,KAACm2B,GAAAA,EAAa9E,KAAI,CAACzgB,MAAM,gBAAe7Q,UACtCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAEg2B,EAAeS,kBAO9Bx2B,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CACVI,UAAW,OACXqE,QAAS,OACTV,gBAAiB,UACjB4G,aAAc,MACdnG,UAAW,UACX1E,UACAC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAY3C,MAAO,CAAEG,SAAU,QAASL,SAAC,mFAlKxDC,EAAAA,EAAAA,KAACa,EAAAA,EAAK,CACJvB,MAAM,kBACNwB,KAAMnI,EACNI,SAAUm9B,EACVn1B,OAAQ,KACRtB,MAAO,IACPuB,gBAAc,EAAAjB,UAEdC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEwE,UAAW,SAAUC,QAAS,aAAc3E,SACvDrF,GACCsF,EAAAA,EAAAA,KAAC2L,GAAI,CAAA5L,SAAC,gCAENC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC/I,KAAK,YAAW7C,SAAC,4BCnD3B4L,KAAK,IAAIC,EAAAA,EAkejB,GAjdkDlT,IAA8B,IAAD+9B,EAAA,IAA5B,SAAE/iB,EAAQ,UAAEC,GAAWjb,EAExE,MAAMg+B,EAAUjjB,EAAmB,CAAEC,WAAUC,eAGzC,SACJC,EAAQ,KACRmE,EAAI,OACJuE,EAAM,QACN8D,EAAO,iBACP3O,EAAgB,qBAChB4R,EAAoB,oBACpBlU,EAAmB,kBACnBC,EAAiB,YACjB2U,EAAW,eACXqC,EAAc,eACdxH,EAAc,gBACdwJ,EAAe,YACfG,GACEmO,EAEJ,OACE52B,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,EAAqB1pB,SAAA,EAEnCC,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,KAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,KAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,KAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,KAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,KAGhBzpB,EAAAA,EAAAA,KAAC22B,GAAU,CACTjjB,SAAUA,EACVoF,aAAcf,EAAKe,aACnBtH,aAAcuG,EAAKvG,aACnB6X,UAAWtR,EAAKE,aAAa1G,MAAMjX,OACnCgvB,YAAa7X,EAAiByB,aAC9BqW,qBAAsBxR,EAAKgB,gBAC3ByQ,iBAAkBzR,EAAK4B,kBAIzB3Z,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,GAA0B1pB,UACxCC,EAAAA,EAAAA,KAAC42B,GAAU,CACT3e,aAAcF,EAAKE,aACnBgS,wBAAyB7B,EACzBG,YAAaA,EACbzP,aAAcf,EAAKe,aACnBoR,eAAgBwH,IACd,GAAIA,EAAK,GAAI,CACX,MAAMrJ,EAAWzU,EAAS0C,mBAAmBpR,MAC1C+pB,GAAWA,EAAElzB,MAAQ21B,EAAK,GAAGtZ,cAE1BtE,EAAOF,EAAS4C,eAAetR,MAClC8iB,GAAWA,EAAEjsB,MAAQ21B,EAAK,GAAGpZ,YAEhCP,EAAKiB,aAAa,CAChBb,WAAYuZ,EAAK,GAAGvZ,YAAc,GAClChI,KAAMuhB,EAAK,GAAGvhB,KACdiI,YAAasZ,EAAK,GAAGtZ,aAAe,GACpCC,eAAuB,OAARgQ,QAAQ,IAARA,OAAQ,EAARA,EAAU1N,aAAqB,OAAR0N,QAAQ,IAARA,OAAQ,EAARA,EAAUprB,OAAQ,GACxDqb,UAAWoZ,EAAK,GAAGpZ,WAAa,GAChCC,gBAAoB,OAAJzE,QAAI,IAAJA,OAAI,EAAJA,EAAM7W,OAAQ,GAC9Bub,aAAckZ,EAAK,GAAGlZ,cAAgB,QAE1C,GAEF2R,oBAAqB7N,EAAOyB,kBAC5BqM,gBAAiB9N,EAAO2B,cACxBvjB,QAASkZ,EAASgB,qBAKtB9U,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAoB1pB,SAAA,EAElCC,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAGhB3pB,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAqB1pB,SAAA,EACnCC,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,GAAuB1pB,UACrCC,EAAAA,EAAAA,KAAC2L,GAAI,CAAC5H,UAAW0lB,GAAsB1pB,SAAC,+BAG1CC,EAAAA,EAAAA,KAAC6qB,EAAiB,CAChBxrB,QAAS,CACP,CACEG,IAAK,aACLF,MAAO,uBACPC,UAAW,aACXqD,KAAM,UACNwK,UAAU,EACV3N,MAAO,IACPC,OAAQA,CAACkC,EAAYjC,EAAa+Z,KAEhC,MAAMmd,EAAcj1B,EACfjC,EAAO4P,aACJ,GAAA9J,OAAG9F,EAAO4P,cAAY9J,OAAG9F,EAAOtC,aAAY,IAAAoI,OAAO9F,EAAOtC,cAAiB,IAAKmS,OAChF,kBACJ,iBACJ,OACExP,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACLuL,OAAQ,UACR9G,QAAS,UACTkG,aAAc,MACd1G,OAAQtC,EAAQ,oBAAsB,oBACtCoC,gBAAiBpC,EAAQ,UAAY,WAEvCX,QAASA,KACc,kBAAVyY,GACT4C,EAAO6B,0BAA0BzE,IAEnC3Z,UAEFC,EAAAA,EAAAA,KAAA,QAAMC,MAAO,CAAEE,MAAOyB,EAAQ,UAAY,WAAY7B,SACnD82B,QAMX,CACEr3B,IAAK,WACLF,MAAO,qBACPC,UAAW,WACXqD,KAAM,QACNwK,UAAU,EACV3N,MAAO,IACPC,OAAQA,CAACkC,EAAYjC,EAAa+Z,KAChC,MAAMqF,EAAapf,EAAeof,UAC5B+X,GAAwB,OAAT/X,QAAS,IAATA,OAAS,EAATA,EAAWlX,qBAAsB,EAChDkvB,EAAWp3B,EAAO0P,UAAY0P,EAGpC,IAAIiY,EAAc,eAKR,IAADC,EAJLF,IAGAC,EADEp1B,EACS,GAAA6D,OAAM7D,EAAK,WAAA6D,OAAUqxB,EAAY,KAGjC,GAAArxB,QAAqB,QAAfwxB,EAAAt3B,EAAO0P,gBAAQ,IAAA4nB,OAAA,EAAfA,EAAiB9lB,OAAO,KAAM,QAAO,WAAA1L,OAAUqxB,EAAY,MAIhF,OACE92B,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACLuL,OAAQ,UACR9G,QAAS,UACTkG,aAAc,MACd1G,OAAQ6yB,EAAW,oBAAsB,qBAE3C91B,QAASA,KACHtB,EAAOkH,YAA+B,kBAAV6S,EAC9B4C,EAAOuB,eAAenE,GACZ/Z,EAAOkH,YACjBtB,EAAAA,GAAQG,QAAQ,kCAElB3F,UAEFC,EAAAA,EAAAA,KAAA,QAAAD,SAAOi3B,QAKf,CACEx3B,IAAK,MACLF,MAAO,mBACPC,UAAW,MACXqD,KAAM,SACNnD,MAAO,GACPwN,UAAU,GAEZ,CACEzN,IAAK,YACLF,MAAO,qBACPC,UAAW,YACXqD,KAAM,SACNnD,MAAO,GACPwN,UAAU,GAEZ,CACEzN,IAAK,QACLF,MAAO,oBACPC,UAAW,QACXqD,KAAM,SACNnD,MAAO,IACPwN,UAAU,GAEZ,CACEzN,IAAK,SACLF,MAAO,sBACPC,UAAW,SACXqD,KAAM,SACNnD,MAAO,IACPwN,UAAU,IAGdzJ,WAAYuU,EAAKE,aAAa1G,MAAM1V,KAAI,CAACC,EAAM4d,KAAKrJ,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC/CvU,GAAI,IACP0D,IAAKka,EAAMlc,eAEbqO,OAAQ0F,IAEN,MAAM2lB,EAAe3lB,EAAM1V,KAAI,CAACC,EAAM8H,KACpC,MAAM8f,EAAc3L,EAAKE,aAAa1G,MAAM3N,GAC5C,OACE9H,EAAKyW,OAAmB,OAAXmR,QAAW,IAAXA,OAAW,EAAXA,EAAanR,OAC1BzW,EAAK0W,UAAyB,OAAXkR,QAAW,IAAXA,GAAAA,EAAalR,WAGzB1W,KAIX46B,EAAQzW,kBAAkBiX,IAE5BprB,MAAOiM,EAAKqB,QACZrN,SAAUgM,EAAKwB,YACfnN,gBAAiB+C,EACjBzU,QACEkZ,EAASY,gBACTZ,EAAS6B,cACT7B,EAASgC,mBAEX7R,UAAU,mBACVL,KAAK,QACLD,OAAO,MACP4I,oBAAqBiQ,EAAOjQ,0BAKhCrM,EAAAA,EAAAA,KAACm3B,GAAW,CACV1lB,iBAAkBA,EAClBD,aAAcuG,EAAKvG,aACnBsZ,iBAAkBlpB,GAASmW,EAAK4B,eAAe,CAAE9H,SAAUjQ,IAC3DmpB,qBAAsBf,GACpBjS,EAAK4B,eAAe,CAClB7H,aAAckY,EAAU,aAAe,WAG3CgB,mBAAoBppB,GAASmW,EAAK4B,eAAe,CAAEd,WAAYjX,UAKnE9B,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAAiB1pB,SAAA,EAE/BC,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAChBzpB,EAAAA,EAAAA,KAAA,OAAK+D,UAAW0lB,MAEhB3pB,EAAAA,EAAAA,MAAA,OAAKiE,UAAW0lB,GAA8B1pB,SAAA,EAC5CC,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLC,KAAK,UACLc,KAAK,QACLb,MAAM7C,EAAAA,EAAAA,KAACoR,EAAAA,EAAY,IACnBnQ,QAASmf,EAAQU,gBACjBpmB,QAASkZ,EAASsD,kBAClBnT,UAAW0lB,GAAkB1pB,SAC9B,kCAIDD,EAAAA,EAAAA,MAAC6C,EAAAA,GAAM,CACLC,KAAK,UACLc,KAAK,QACLb,MAAM7C,EAAAA,EAAAA,KAACoR,EAAAA,EAAY,IACnBnQ,QAASmf,EAAQkC,mBACjB5nB,QAASkZ,EAASsD,mBAAqBtD,EAAS0D,kBAChDvT,UAAW0lB,GAAkB1pB,SAAA,CAC9B,gBACK2T,EAAW,SAAW,gBAAgB,YAG5C1T,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLe,KAAK,QACLb,MAAM7C,EAAAA,EAAAA,KAAC4oB,EAAAA,EAAgB,IACvB3nB,QAASqb,EAAO+B,mBAChBta,UAAW0lB,GAAsB1pB,SAClC,iCAIDC,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLe,KAAK,QACLb,MAAM7C,EAAAA,EAAAA,KAACo3B,EAAAA,EAAa,IACpBn2B,QAASA,KACP8W,EAAK6B,YACLrU,EAAAA,GAAQC,QAAQ,oCAElBzB,UAAW0lB,GAAmB1pB,SAC/B,sCAIDD,EAAAA,EAAAA,MAAC6C,EAAAA,GAAM,CACLe,KAAK,QACLb,MAAM7C,EAAAA,EAAAA,KAACu1B,EAAAA,EAAe,IACtBxxB,UAAW0lB,GACXxoB,QAAS8iB,EAAYhkB,SAAA,CACtB,4BACkC,SAAtBgY,EAAKe,aAA0B,OAAS,UAAU,YAG/D9Y,EAAAA,EAAAA,KAAC2C,EAAAA,GAAM,CACLe,KAAK,QACLb,MAAM7C,EAAAA,EAAAA,KAACq3B,EAAAA,EAAgB,IACvBtzB,UAAW0lB,GACXxoB,QAASmlB,EAAermB,SACzB,kCAKHC,EAAAA,EAAAA,KAAA,OACEC,MAAO,CACLyoB,WAAY,oDACZhkB,QAAS,YACTkG,aAAc,OACd1G,OAAQ,oBACR2kB,SAAU,WACV4H,OAAQ,EACR9H,UAAW,kCACX5oB,UAEFC,EAAAA,EAAAA,KAAA,OAAKC,MAAO,CAAEwE,UAAW,SAAU1E,UACjCD,EAAAA,EAAAA,MAAC6L,GAAI,CACH1L,MAAO,CACLE,MAAO,UACPC,SAAU,OACVyK,QAAS,QACT3K,WAAY,IACZyzB,WAAY,QACZ5zB,SAAA,CACH,WACGC,EAAAA,EAAAA,KAAA,UAAAD,SAAQ,wBAA4B,uPASf,OAA9Buc,EAAOE,qBACNxc,EAAAA,EAAAA,KAAC4P,EAAmB,CAClBjX,SAAS,EACTG,SAAUsW,EACVrW,SAAUujB,EAAOwB,gBACjBlY,WAA6D,QAAlD6wB,EAAA1e,EAAKE,aAAa1G,MAAM+K,EAAOE,2BAAmB,IAAAia,OAAA,EAAlDA,EAAoD5vB,aAAc,MAIjF7G,EAAAA,EAAAA,KAACs3B,GAAsB,CACrB3+B,QAAS2jB,EAAOI,qBAChB5jB,SAAUuvB,IACJtQ,EAAKE,aAAaG,cAAgBiQ,EAAStsB,MAC/Cgc,EAAKiB,aAAa,CAChBZ,YAAaiQ,EAAStsB,IACtBsc,cAAegQ,EAAS1N,YAE1B2B,EAAO0B,qBACP9e,YAAW,IAAMod,EAAO2B,iBAAiB,KACzC1Y,EAAAA,GAAQC,QAAQ,aAADC,OAAc4iB,EAAS1N,UAAS,+BAEjD5hB,SAAUujB,EAAO0B,sBAInBhe,EAAAA,EAAAA,KAACu3B,GAAkB,CACjB5+B,QAAS2jB,EAAOM,iBAChB9jB,SAAUgb,IACJiE,EAAKE,aAAaK,YAAcxE,EAAK/X,MACzCgc,EAAKiB,aAAa,CAChBV,UAAWxE,EAAK/X,IAChBwc,eAAgBzE,EAAK7W,OAEvBqf,EAAO4B,iBACP3Y,EAAAA,GAAQC,QAAQ,SAADC,OAAUqO,EAAK7W,KAAI,4CAEpClE,SAAUujB,EAAO4B,kBAGnBle,EAAAA,EAAAA,KAACw3B,GAAyB,CACxB7+B,QAAS2jB,EAAOQ,wBAChB2V,UAAWA,KACT1a,EAAK6B,YACL0C,EAAOkC,wBACP4B,EAAQK,iBAAiB,MACzBlb,EAAAA,GAAQC,QAAQ,wCAElBktB,eAAgBA,KACdpW,EAAOkC,wBACP4B,EAAQK,iBAAiB,OAE3B1nB,SAAUujB,EAAOkC,sBACjBgC,cAAeJ,EAAQI,cACvBmS,mBAAoBA,KAElBrW,EAAO6B,0BAA0B,OAIrCne,EAAAA,EAAAA,KAACy3B,GAAmB,CAClB9+B,QAAS2jB,EAAOY,2BAChBnkB,SAAUujB,EAAOoC,yBACjB9Y,UAAW0W,EAAOkB,qBAGpBxd,EAAAA,EAAAA,KAAC2P,EAAqB,CACpBhX,QAAS2jB,EAAOc,6BAChBtkB,SAAU8H,IAAY,IAADqR,EAAAD,EAAAwR,EAAAkU,EACnB,GAAwC,OAApCpb,EAAOgB,yBAAmC,OAE9C,MAAMjiB,EAAW,IAAI0c,EAAKE,aAAa1G,OAEvClW,EAASihB,EAAOgB,0BAA0BzW,WAAajG,EAAQ7E,KAAO,GACtEV,EAASihB,EAAOgB,0BAA0B/N,aAAe3O,EAAQ3D,MAAQ,GACzE5B,EAASihB,EAAOgB,0BAA0BjgB,cACrB,QAAnB4U,EAAArR,EAAQxD,mBAAW,IAAA6U,OAAA,EAAnBA,EAAqB5U,eAAgB,GACvChC,EAASihB,EAAOgB,0BAA0B7c,MAAQG,EAAQrD,eAAiB,EAC3ElC,EAASihB,EAAOgB,0BAA0BnL,gBAAqC,QAApBH,EAAApR,EAAQwR,oBAAY,IAAAJ,OAAA,EAApBA,EAAsBG,iBAAkB,EACnG9W,EAASihB,EAAOgB,0BAA0BxB,eAAoC,QAApB0H,EAAA5iB,EAAQwR,oBAAY,IAAAoR,OAAA,EAApBA,EAAsB1H,gBAAiB,GACjGzgB,EAASihB,EAAOgB,0BAA0B1B,SAAWhb,EAAQgb,WAA+B,QAAvB8b,EAAI92B,EAAQxD,mBAAW,IAAAs6B,OAAA,EAAnBA,EAAqB9b,WAAY,GAC1GvgB,EAASihB,EAAOgB,0BAA0BzB,QAAUjb,EAAQib,SAAW,GAEvE6a,EAAQzW,kBAAkB5kB,GAC1BihB,EAAO8B,6BACP9B,EAAOuB,eAAevB,EAAOgB,0BAC7B/X,EAAAA,GAAQC,QAAQ,YAADC,OAAa7E,EAAQ3D,KAAI,8BAE1ClE,SAAUujB,EAAO8B,8BAGnBpe,EAAAA,EAAAA,KAAC23B,GAAc,CACbh/B,QAAS2jB,EAAOU,sBAChBlY,QAASwX,EAAOgC,oBAChBsV,WAAYQ,IAEVrc,EAAK8B,aAAaua,GAAM,KAElBrc,EAAKE,aAAa1G,MAAMjX,OAAS,GACnCo8B,EAAQzW,kBAAkBlI,EAAKE,aAAa1G,UAGhDqC,EAAS8D,iBACT4E,EAAOgC,sBACP/Y,EAAAA,GAAQC,QAAQ,SAADC,OAAU2uB,EAAKjc,WAAU,4BAE1Csa,UAAWA,KACT1a,EAAK6B,YACL0C,EAAOgC,sBACP/Y,EAAAA,GAAQC,QAAQ,6C,kDCrenB,MAAMoyB,EAAoBl/B,IAOA,IAPC,OAChCg3B,EAAM,QACNlqB,EAAO,MACPlG,EAAK,YACLu4B,EAAW,UACXje,EAAS,aACTxS,GACyB1O,EACrB8M,IACFsyB,EAAAA,EAAAA,IAAU,UAAU,GAADryB,OAAKnG,EAAK,KAAAmG,OAAIiqB,EAAM,mBAC5B,OAAXmI,QAAW,IAAXA,GAAAA,IACS,OAATje,QAAS,IAATA,GAAAA,MAGAke,EAAAA,EAAAA,IAAU,QAAS1wB,GAAY,aAAA3B,OAAiBiqB,EAAM,KAAAjqB,OAAInG,I,mFClBvD,MAAMwY,EAAsBA,KAAO,IAADigB,EACvC,MAAMlyB,GAAW6L,EAAAA,EAAAA,UAAQ,KAAM5L,EAAAA,EAAAA,mBAAkB,IAC3CmO,GAAyB,OAARpO,QAAQ,IAARA,OAAQ,EAARA,EAAUqO,mBAA2B,OAARrO,QAAQ,IAARA,GAA2B,QAAnBkyB,EAARlyB,EAAUsO,yBAAiB,IAAA4jB,OAAnB,EAARA,EAA6Bh8B,MAGzExB,KAAM4b,EAAY,UAAE1b,GAAcE,EAAAA,GAASyb,oBACjD,CAAElC,gBAAiBD,EAAgB5a,KAAM,EAAG2+B,MAAO,GACnD,CACEh9B,MAAOiZ,EACPhZ,2BAA2B,IAIzB6b,GAAWpF,EAAAA,EAAAA,UAAQ,KACvB,MAAMqF,GAA8B,OAAZZ,QAAY,IAAZA,OAAY,EAAZA,EAAsB7a,SAAU6a,GAAgB,CAAC,EACzE,OAAO9N,MAAMC,QAAQyO,GAAkBA,EAAe,GAAKA,IAC1D,CAACZ,IAIE8hB,GAA2B,OAARnhB,QAAQ,IAARA,OAAQ,EAARA,EAAUohB,gBAAiB,UAC9CC,GAA8B,OAARrhB,QAAQ,IAARA,OAAQ,EAARA,EAAUshB,mBAAoB,UAM1D,MAAO,CAELxgB,uBAL4BygB,EAAAA,EAAAA,IAAgBJ,GAM5CpgB,0BAL+BygB,EAAAA,EAAAA,IAAmBH,GAQlDF,kBACAE,qBAGA19B,YAGAqc,Y,oFCbG,MAAMzC,EAA2CkkB,IAGtD,MAAMC,GAAc9mB,EAAAA,EAAAA,UAAQ,KAAM+mB,EAAAA,EAAAA,IAAeF,IAAa,CAACA,IAGzDG,GAAehnB,EAAAA,EAAAA,UAAQ,KAC3B,MAAMinB,EAASC,EAAAA,GAAWL,GAC1B,IAAKI,GAA4B,kBAAXA,KAAyB,WAAYA,GACzD,MAAM,IAAIE,MAAM,UAADpzB,OAAW8yB,EAAU,4DAEtC,OAAOI,IACN,CAACJ,IA4FJ,MAAO,CAELviB,UA3FgB,WAAkC,IAAjC8iB,EAAsBC,UAAAz+B,OAAA,QAAA2J,IAAA80B,UAAA,GAAAA,UAAA,GAAG,CAAC,EAC3C,MAAMC,EAAQR,EAAYS,YAAYH,GACtC,OAAAzoB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACK2oB,GAAK,IACRvkB,QAASukB,EAAMvkB,SAEnB,EAsFEykB,WAnFiB,SAAC7uB,GAA6C,IAAjCyuB,EAAsBC,UAAAz+B,OAAA,QAAA2J,IAAA80B,UAAA,GAAAA,UAAA,GAAG,CAAC,EACxD,MAAMC,EAAQR,EAAYW,iBAAe9oB,EAAAA,EAAAA,GAAC,CAAEhG,MAAOyuB,IACnD,OAAAzoB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACK2oB,GAAK,IACRvkB,QAASukB,EAAMvkB,SAEnB,EAgFE0C,UA7EgBA,KAChB,MAAOiiB,EAAgB99B,GAAUk9B,EAAYa,oBAEvCriB,GAASiC,EAAAA,EAAAA,cAAY8H,UACzB,IAEE,MAAO,CAAExmB,WADc6+B,EAAe7+B,GAAM++B,SACnBpxB,MAAO,KAClC,CAAE,MAAOA,GACP,MAAO,CAAE3N,KAAM,KAAM2N,QACvB,IACC,CAACkxB,IAEJ,OAAA/oB,EAAAA,EAAAA,GAAA,CACE2G,UACG1b,IAgELic,UA3DgBA,KAChB,MAAOgiB,EAAgBj+B,GAAUk9B,EAAYgB,oBAEvCpiB,GAAS6B,EAAAA,EAAAA,cAAY8H,MAAO1W,EAAY9P,KAC5C,IAEE,MAAO,CAAEA,WADcg/B,EAAe,CAAElvB,KAAI9P,SAAQ++B,SAC3BpxB,MAAO,KAClC,CAAE,MAAOA,GACP,MAAO,CAAE3N,KAAM,KAAM2N,QACvB,IACC,CAACqxB,IAEJ,OAAAlpB,EAAAA,EAAAA,GAAA,CACE+G,UACG9b,IA8CLm+B,UAzCgBA,KAChB,MAAOC,EAAgBp+B,GAAUk9B,EAAYmB,oBAEvCC,GAAS3gB,EAAAA,EAAAA,cAAY8H,UACzB,IAEE,MAAO,CAAExmB,WADcm/B,EAAervB,GAAIivB,SACjBpxB,MAAO,KAClC,CAAE,MAAOA,GACP,MAAO,CAAE3N,KAAM,KAAM2N,QACvB,IACC,CAACwxB,IAEJ,OAAArpB,EAAAA,EAAAA,GAAA,CACEwpB,OAAQD,EACRA,UACGt+B,IA6BLw+B,WArBgB7gB,EAAAA,EAAAA,cAAY,KACrB,CACL8gB,OAAQrB,EAAasB,OACrBC,IAAKvB,EAAawB,IAClBljB,OAAQ0hB,EAAayB,OACrB/iB,OAAQshB,EAAa0B,OACrBP,OAAQnB,EAAa2B,UAEtB,CAAC3B,IAgBFH,aACAG,gB,6DC9IG,MAAMjJ,EAAuB/2B,IAU7B,IAV8B,OACnCg3B,EAAM,MACNpwB,EAAK,eACLqwB,EAAc,QACdlb,GAMD/b,EACC,MAAM,UACJ+B,EAAS,UACT6/B,EAAS,QACTC,EAAO,KACPhgC,EAAI,MACJ2N,EAAK,MACLsyB,GACE7K,EAGE8K,GAAiBvgC,EAAAA,EAAAA,SAAgB,GAEjCwgC,GAAaxgC,EAAAA,EAAAA,QAAe,KAElCgB,EAAAA,EAAAA,YAAU,KAER,MAAMy/B,EAAaF,EAAer+B,QAIlC,GAHAq+B,EAAer+B,QAAU3B,IAAa,EAGlCA,EACF,OAIF,IAAKkgC,EACH,OAIF,MAAMC,EAAS,GAAAn1B,OAAM60B,EAAS,KAAA70B,OAAI80B,EAAO,KAAA90B,QAAQ,OAAJlL,QAAI,IAAJA,OAAI,EAAJA,EAAM4mB,aAAc,GAAE,KAAA1b,QAAS,OAALyC,QAAK,IAALA,OAAK,EAALA,EAAO+B,SAAU,IAIxF,GAAIywB,EAAWt+B,UAAYw+B,EAA3B,CAKA,GAAIN,GAAa//B,EAAM,CACgB,OAAjB,OAAJA,QAAI,IAAJA,OAAI,EAAJA,EAAM4mB,cAA0B,OAAJ5mB,QAAI,IAAJA,GAAAA,EAAM0P,QAAlD,MAIM4wB,EAAYpmB,GAElBmjB,EAAAA,EAAAA,GAAkB,CAChBlI,SACApwB,QACAkG,SAAS,EACTqyB,YAAagD,IAGfH,EAAWt+B,QAAUw+B,EAGjBJ,GAEFt7B,YAAW,KACTs7B,IAEAE,EAAWt+B,QAAU,KACpB,IAEP,CAGA,GAAIm+B,GAAWryB,EAAO,CAAC,IAADsZ,EACpB,MAAMpa,GACC,OAALc,QAAK,IAALA,GAAW,QAANsZ,EAALtZ,EAAO3N,YAAI,IAAAinB,OAAN,EAALA,EAAajc,WACR,OAAL2C,QAAK,IAALA,OAAK,EAALA,EAAO3C,WACF,OAAL2C,QAAK,IAALA,OAAK,EAALA,EAAOA,QAAK,aAAAzC,OACCiqB,EAAM,KAAAjqB,OAAInG,IAEzBs4B,EAAAA,EAAAA,GAAkB,CAChBlI,SACApwB,QACAkG,SAAS,EACT4B,iBAGFszB,EAAWt+B,QAAUw+B,EAGjBJ,GAEFt7B,YAAW,KACTs7B,IAEAE,EAAWt+B,QAAU,KACpB,IAEP,CAxDA,IAyDC,CACD3B,EACA6/B,EACAC,EACAhgC,EACA2N,EACAwnB,EACApwB,EACAmV,EACA+lB,I,8DC3HG,MAAM1C,EAAYA,CAACl1B,EAA2BgtB,KACtC,YAAThtB,EACF2C,EAAAA,GAAQC,QAAQoqB,GACE,UAAThtB,GACT2C,EAAAA,GAAQ2C,MAAM0nB,IAiBsD2I,KACtE,MAAMuC,EAbgEvC,IAC9D7I,IAAwC,IAADqL,EAC7C,MAAMC,EAAkB,OAAVpC,EAAAA,SAAU,IAAVA,EAAAA,IAAwB,QAAdmC,EAAVnC,EAAAA,GAAaL,UAAW,IAAAwC,OAAd,EAAVA,EAA2BrL,GACzC,IAAKsL,EAEH,MAAM,IAAInC,MAAM,iBAADpzB,OAAkBqH,OAAOyrB,GAAW,KAAA9yB,OAAIqH,OAAO4iB,GAAO,qBAEvE,OAAOsL,GAMQC,CAAqB1C,IAahC2C,CAAqB,O","sources":["pages/RetaillBill/components/ProductSelectionModal.tsx","pages/RetaillBill/components/StockSelectionModal.tsx","components/common/AntdEditableTable.tsx","pages/RetaillBill/hooks/useBillCalculations.ts","helpers/amount_calculations.ts","pages/RetaillBill/hooks/useAdvancedBilling.ts","pages/RetaillBill/hooks/useBillData.ts","pages/RetaillBill/hooks/useBillForm.ts","pages/RetaillBill/hooks/useBillModals.ts","pages/RetaillBill/hooks/useBillItems.ts","pages/RetaillBill/hooks/useBillActions.ts","pages/RetaillBill/hooks/useBillKeyboardShortcuts.ts","pages/RetaillBill/components/DocumentTypeToggle.tsx","webpack://SUBRIVA-BILLING/./src/pages/RetaillBill/components/BillDataGrid.module.css?232c","pages/RetaillBill/components/BillTopBar.tsx","pages/RetaillBill/components/BillHeader.tsx","pages/RetaillBill/components/BillSummary.tsx","pages/RetaillBill/components/CustomerSelectionModal.tsx","pages/RetaillBill/components/UserSelectionModal.tsx","pages/RetaillBill/components/BillSaveConfirmationModal.tsx","pages/RetaillBill/components/BillListDrawer.tsx","pages/RetaillBill/components/ProductDetailsModal.tsx","pages/RetaillBill/components/BillDataGrid.tsx","components/common/handleApiResponse.ts","hooks/useTemplateSettings.ts","hooks/useGenericCrudRTK.ts","components/common/useHandleApiResponse.ts","helpers/Common_functions.ts"],"sourcesContent":["import React, { useEffect, useState, FC, KeyboardEvent, useRef } from 'react';\r\nimport { Modal, Table, Input, Button, Space, message } from 'antd';\r\nimport type { InputRef } from 'antd/es/input';\r\nimport { BarcodeOutlined, ScanOutlined } from '@ant-design/icons';\r\nimport type { ColumnType } from 'antd/es/table';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\nimport BarcodeScanner from '../../../components/common/BarcodeScanner';\r\n\r\nconst { Search } = Input;\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name?: string;\r\n  sku?: string;\r\n  selling_price?: number;\r\n  hsn_code?: string;\r\n  hsn_sac?: string;\r\n  VariantItem?: {\r\n    variant_name?: string;\r\n    variant_code?: string;\r\n    hsn_code?: string;\r\n  };\r\n  CategoryItem?: {\r\n    category_name?: string;\r\n    tax_percentage?: number;\r\n  };\r\n}\r\n\r\ninterface ProductSelectionModalProps {\r\n  visible: boolean;\r\n  products?: Product[]; // Optional - if not provided, will load from API\r\n  onSelect: (product: Product) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst ProductSelectionModal: FC<ProductSelectionModalProps> = ({\r\n  visible,\r\n  products: providedProducts,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [debouncedSearch, setDebouncedSearch] = useState('');\r\n  const [page, setPage] = useState(1);\r\n  const [allProducts, setAllProducts] = useState<Product[]>([]);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [selectedRowKey, setSelectedRowKey] = useState<React.Key | null>(null);\r\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\r\n  const [scannerVisible, setScannerVisible] = useState(false);\r\n  const searchInputRef = useRef<InputRef>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isLoadingMoreRef = useRef(false);\r\n\r\n  // Only load from API if products not provided\r\n  const shouldLoadFromAPI = !providedProducts || providedProducts.length === 0;\r\n\r\n  // Use RTK Query for products with pagination and search (only if not provided)\r\n  const { data: productsData, isLoading: loading } = apiSlice.useGetProductQuery({\r\n    searchString: debouncedSearch,\r\n    pageNumber: page,\r\n    pageLimit: 10,\r\n  }, {\r\n    skip: !visible || !shouldLoadFromAPI,\r\n    refetchOnMountOrArgChange: true,\r\n  });\r\n\r\n  // Accumulate products for infinite scroll (only if loading from API)\r\n  useEffect(() => {\r\n    // Only process when modal is visible and loading from API\r\n    if (!visible || !shouldLoadFromAPI) return;\r\n    \r\n    if (productsData) {\r\n      const newItems = (productsData as any)?.result || [];\r\n      const totalCount = (productsData as any).pagination?.totalCount || (productsData as any).pagination?.total || 0;\r\n      \r\n      if (page === 1) {\r\n        setAllProducts(newItems);\r\n        setHasMore(newItems.length < totalCount && newItems.length > 0);\r\n      } else {\r\n        setAllProducts(prev => {\r\n          const existingIds = new Set(prev.map((item: any) => item._id));\r\n          const uniqueNewItems = newItems.filter((item: any) => !existingIds.has(item._id));\r\n          const updated = [...prev, ...uniqueNewItems];\r\n          setHasMore(updated.length < totalCount && uniqueNewItems.length > 0);\r\n          return updated;\r\n        });\r\n      }\r\n      \r\n      isLoadingMoreRef.current = false;\r\n    }\r\n  }, [productsData, page, shouldLoadFromAPI, visible]);\r\n\r\n  // Use provided products OR loaded products\r\n  const sourceProducts = providedProducts || allProducts;\r\n\r\n  // Client-side filtering (fast when using provided products)\r\n  const filteredProducts: Product[] = sourceProducts?.filter((p: Product) => {\r\n    if (!searchTerm) return true;\r\n    const searchLower = searchTerm.toLowerCase();\r\n    return (\r\n      (p.name?.toLowerCase() || '').includes(searchLower) ||\r\n      (p.sku?.toLowerCase() || '').includes(searchLower) ||\r\n      p.VariantItem?.variant_name?.toLowerCase().includes(searchLower) ||\r\n      p.VariantItem?.variant_code?.toLowerCase().includes(searchLower) ||\r\n      (p.selling_price?.toString() || '').includes(searchLower)\r\n    );\r\n  }).sort((a: Product, b: Product) => {\r\n    // Prioritize exact matches and matches at the beginning\r\n    const searchLower = searchTerm.toLowerCase();\r\n    \r\n    // Check for exact matches first\r\n    const aExactMatch = (a.name?.toLowerCase() || '') === searchLower || \r\n                        a.VariantItem?.variant_name?.toLowerCase() === searchLower ||\r\n                        (a.sku?.toLowerCase() || '') === searchLower;\r\n    const bExactMatch = (b.name?.toLowerCase() || '') === searchLower || \r\n                        b.VariantItem?.variant_name?.toLowerCase() === searchLower ||\r\n                        (b.sku?.toLowerCase() || '') === searchLower;\r\n    \r\n    if (aExactMatch && !bExactMatch) return -1;\r\n    if (!aExactMatch && bExactMatch) return 1;\r\n    \r\n    // Then check for matches at the beginning\r\n    const aStartsWith = (a.name?.toLowerCase() || '').startsWith(searchLower) || \r\n                        a.VariantItem?.variant_name?.toLowerCase().startsWith(searchLower) ||\r\n                        (a.sku?.toLowerCase() || '').startsWith(searchLower);\r\n    const bStartsWith = (b.name?.toLowerCase() || '').startsWith(searchLower) || \r\n                        b.VariantItem?.variant_name?.toLowerCase().startsWith(searchLower) ||\r\n                        (b.sku?.toLowerCase() || '').startsWith(searchLower);\r\n    \r\n    if (aStartsWith && !bStartsWith) return -1;\r\n    if (!aStartsWith && bStartsWith) return 1;\r\n    \r\n    return 0;\r\n  }) || [];\r\n\r\n  // Debounce search (only for API mode)\r\n  useEffect(() => {\r\n    if (!shouldLoadFromAPI || !visible) return;\r\n\r\n    // Skip if value hasn't changed (prevents clearing immediately on open)\r\n    if (searchTerm === debouncedSearch) return;\r\n    \r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n    \r\n    searchTimeoutRef.current = setTimeout(() => {\r\n      setDebouncedSearch(searchTerm);\r\n      setPage(1);\r\n      setAllProducts([]);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    }, 300);\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [searchTerm, debouncedSearch, shouldLoadFromAPI, visible]);\r\n\r\n  useEffect(() => {\r\n    setHighlightedIndex(0);\r\n    if (filteredProducts.length > 0) {\r\n      setSelectedRowKey(filteredProducts[0]._id);\r\n    } else {\r\n      setSelectedRowKey(null);\r\n    }\r\n  }, [searchTerm, filteredProducts.length]);\r\n\r\n  // Reset when modal opens/closes (only run on visibility change)\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n      }, 100);\r\n      \r\n      // Only reset if loading from API\r\n      if (shouldLoadFromAPI) {\r\n        setPage(1);\r\n        setHasMore(true);\r\n        isLoadingMoreRef.current = false;\r\n      }\r\n    } else {\r\n      setSearchTerm('');\r\n      if (shouldLoadFromAPI) {\r\n        setDebouncedSearch('');\r\n        setPage(1);\r\n        setAllProducts([]);\r\n        setHasMore(true);\r\n        isLoadingMoreRef.current = false;\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [visible]); // Only depend on visible to avoid infinite loops\r\n\r\n  const columns: ColumnType<Product>[] = [\r\n    { \r\n      title: 'Product & Variant', \r\n      dataIndex: 'name', \r\n      key: 'name', \r\n      width: 250,\r\n      render: (name, record) => (\r\n        <div>\r\n          <div style={{ fontWeight: 600, color: '#1890ff' }}>{name}</div>\r\n          {record.VariantItem?.variant_name && (\r\n            <div style={{ fontSize: '12px', color: '#52c41a', marginTop: '2px' }}>\r\n              Variant: {record.VariantItem.variant_name}\r\n              {record.VariantItem?.variant_code && (\r\n                <span style={{ marginLeft: '8px', color: '#fa8c16', fontSize: '11px' }}>\r\n                  ({record.VariantItem.variant_code})\r\n                </span>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    { title: 'Variant', dataIndex: 'VariantItem', key: 'variant', width: 120, \r\n      render: (variant) => variant?.variant_name ? (\r\n        <span style={{ color: '#52c41a', fontWeight: 500 }}>{variant.variant_name}</span>\r\n      ) : (\r\n        <span style={{ color: '#bfbfbf', fontStyle: 'italic' }}>No variant</span>\r\n      ) },\r\n    { title: 'SKU', dataIndex: 'sku', key: 'sku', width: 120 },\r\n    { title: 'Price', dataIndex: 'selling_price', key: 'selling_price', width: 100,\r\n      render: (price) => (\r\n        <span style={{ \r\n          color: '#52c41a', \r\n          fontWeight: 600, \r\n          fontSize: '14px' \r\n        }}>\r\n          {price?.toFixed(2) || '0.00'}\r\n        </span>\r\n      ) },\r\n  ];\r\n\r\n  const handleSelectRow = (product: Product) => {\r\n    onSelect(product);\r\n  };\r\n\r\n  // Handle barcode scan\r\n  const handleBarcodeScan = (barcode: string) => {\r\n    setSearchTerm(barcode);\r\n    setScannerVisible(false);\r\n    \r\n    // Try to find product by barcode/SKU\r\n    const foundProduct = sourceProducts?.find((p: Product) => {\r\n      const searchLower = barcode.toLowerCase();\r\n      return (\r\n        (p.sku?.toLowerCase() || '').includes(searchLower) ||\r\n        (p.name?.toLowerCase() || '').includes(searchLower) ||\r\n        p.VariantItem?.variant_code?.toLowerCase().includes(searchLower)\r\n      );\r\n    });\r\n\r\n    if (foundProduct) {\r\n      // Auto-select the found product\r\n      setTimeout(() => {\r\n        onSelect(foundProduct);\r\n      }, 500);\r\n      message.success(`Product found: ${foundProduct.name}`);\r\n    } else {\r\n      message.warning(`No product found with barcode: ${barcode}`);\r\n    }\r\n  };\r\n\r\n  const handleSearchKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!filteredProducts.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        const next = Math.min(prev + 1, filteredProducts.length - 1);\r\n        setSelectedRowKey(filteredProducts[next]._id);\r\n        return next;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        const prevIndex = Math.max(prev - 1, 0);\r\n        setSelectedRowKey(filteredProducts[prevIndex]._id);\r\n        return prevIndex;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedProduct = filteredProducts[highlightedIndex];\r\n      if (selectedProduct) {\r\n        handleSelectRow(selectedProduct);\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      onCancel();\r\n    }\r\n  };\r\n\r\n  // Auto-focus back to search input when clicking outside\r\n  const handleModalClick = () => {\r\n    searchInputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select Product & Variant (F5 to reopen anytime)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      width={900}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div onClick={handleModalClick}>\r\n        <Space.Compact style={{ marginBottom: 16, width: '100%' }}>\r\n          <Search\r\n            ref={searchInputRef}\r\n            placeholder=\"Search by product name, variant, SKU, or price (use  arrows to navigate, Enter to select)\"\r\n            onChange={e => setSearchTerm(e.target.value)}\r\n            style={{ flex: 1 }}\r\n            autoFocus\r\n            onKeyDown={handleSearchKeyDown}\r\n            onBlur={() => {\r\n              // Re-focus after a short delay to ensure it stays focused\r\n              setTimeout(() => {\r\n                if (visible) {\r\n                  searchInputRef.current?.focus();\r\n                }\r\n              }, 10);\r\n            }}\r\n            value={searchTerm}\r\n          />\r\n          <Button \r\n            type=\"primary\" \r\n            icon={<ScanOutlined />}\r\n            onClick={() => setScannerVisible(true)}\r\n            style={{ minWidth: 100 }}\r\n          >\r\n            Scan\r\n          </Button>\r\n        </Space.Compact>\r\n        {shouldLoadFromAPI ? (\r\n          <div\r\n            onScroll={(e: any) => {\r\n              const target = e.currentTarget;\r\n              const scrollTop = target.scrollTop;\r\n              const scrollHeight = target.scrollHeight;\r\n              const clientHeight = target.clientHeight;\r\n              const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\r\n              \r\n              if (scrollPercentage > 0.7 && hasMore && !loading && !isLoadingMoreRef.current) {\r\n                isLoadingMoreRef.current = true;\r\n                setPage(prev => prev + 1);\r\n              }\r\n            }}\r\n            style={{ maxHeight: 360, overflowY: 'auto' }}\r\n          >\r\n            <Table\r\n              dataSource={filteredProducts}\r\n              columns={columns}\r\n              loading={loading && filteredProducts.length === 0}\r\n              rowKey=\"_id\"\r\n              size=\"small\"\r\n              pagination={false}\r\n              onRow={(record, idx) => ({\r\n                onClick: () => {\r\n                  handleSelectRow(record);\r\n                  setTimeout(() => {\r\n                    searchInputRef.current?.focus();\r\n                  }, 10);\r\n                },\r\n                onDoubleClick: () => handleSelectRow(record),\r\n                className:\r\n                  idx === highlightedIndex\r\n                    ? 'ant-table-row ant-table-row-selected'\r\n                    : 'ant-table-row',\r\n                style: {\r\n                  backgroundColor: idx === highlightedIndex ? '#e6f7ff' : undefined,\r\n                  border: idx === highlightedIndex ? '2px solid #1890ff' : undefined,\r\n                },\r\n              })}\r\n              rowSelection={{\r\n                type: 'radio',\r\n                selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n                onChange: keys => {\r\n                  setSelectedRowKey(keys[0]);\r\n                  const idx = filteredProducts.findIndex(p => p._id === keys[0]);\r\n                  if (idx !== -1) setHighlightedIndex(idx);\r\n                },\r\n              }}\r\n              scroll={{ y: undefined }}\r\n            />\r\n            {hasMore && filteredProducts.length > 0 && (\r\n              <div style={{ textAlign: 'center', padding: '8px', color: '#999', borderTop: '1px solid #f0f0f0' }}>\r\n                {loading ? 'Loading more...' : 'Scroll for more products'}\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <Table\r\n            dataSource={filteredProducts}\r\n            columns={columns}\r\n            loading={false}\r\n            rowKey=\"_id\"\r\n            size=\"small\"\r\n            pagination={false}\r\n            onRow={(record, idx) => ({\r\n              onClick: () => {\r\n                handleSelectRow(record);\r\n                setTimeout(() => {\r\n                  searchInputRef.current?.focus();\r\n                }, 10);\r\n              },\r\n              onDoubleClick: () => handleSelectRow(record),\r\n              className:\r\n                idx === highlightedIndex\r\n                  ? 'ant-table-row ant-table-row-selected'\r\n                  : 'ant-table-row',\r\n              style: {\r\n                backgroundColor: idx === highlightedIndex ? '#e6f7ff' : undefined,\r\n                border: idx === highlightedIndex ? '2px solid #1890ff' : undefined,\r\n              },\r\n            })}\r\n            rowSelection={{\r\n              type: 'radio',\r\n              selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n              onChange: keys => {\r\n                setSelectedRowKey(keys[0]);\r\n                const idx = filteredProducts.findIndex(p => p._id === keys[0]);\r\n                if (idx !== -1) setHighlightedIndex(idx);\r\n              },\r\n            }}\r\n            scroll={{ y: 300 }}\r\n          />\r\n        )}\r\n        <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n          <strong>Keyboard Shortcuts:</strong>  Navigate products | Enter Select | Escape Cancel\r\n          <br />\r\n          <strong>Search:</strong> Product name, variant name, SKU, or price\r\n          <br />\r\n          <strong>Barcode Scanner:</strong> Click \"Scan\" button or use USB barcode scanner\r\n          <br />\r\n          <strong>Tip:</strong> Press F5 anytime to reopen this modal for product changes\r\n        </div>\r\n      </div>\r\n\r\n      {/* Barcode Scanner Modal */}\r\n      <BarcodeScanner\r\n        visible={scannerVisible}\r\n        onClose={() => setScannerVisible(false)}\r\n        onScan={handleBarcodeScan}\r\n        title=\"Scan Product Barcode\"\r\n        description=\"Scan barcode to find product automatically\"\r\n      />\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProductSelectionModal;\r\n","import React, { useEffect, useState, FC, KeyboardEvent, useRef } from 'react';\r\nimport { Modal, Table, Input, Tag, Tooltip, message } from 'antd';\r\nimport type { InputRef } from 'antd/es/input';\r\nimport type { ColumnType } from 'antd/es/table';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport SessionStorageEncryption from '../../../helpers/encryption';\r\nimport dayjs from 'dayjs';\r\nimport {\r\n  ExclamationCircleOutlined,\r\n  CheckCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport type { Stock } from '../../../types/entities';\r\n\r\nconst { Search } = Input;\r\n\r\ninterface StockSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (stock: {\r\n    id: string;\r\n    _id: string;\r\n    batch_no: string;\r\n    name: string;\r\n    code?: string;\r\n    available_quantity: number;\r\n    available_loose_quantity?: number;\r\n    sell_price: number;\r\n    ProductItem?: any;\r\n  }) => void;\r\n  onCancel: () => void;\r\n  productId: string;\r\n}\r\n\r\nconst StockSelectionModal: FC<StockSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n  productId, // <-- Destructure\r\n}) => {\r\n  // Resolve user role to decide which stock API to call\r\n  const userItem = getCurrentUser();\r\n  const scopeData = SessionStorageEncryption.getItem('scope');\r\n  const userRole = (\r\n    scopeData?.userType ||\r\n    userItem?.user_type ||\r\n    userItem?.usertype ||\r\n    userItem?.user_role ||\r\n    ''\r\n  ).toLowerCase();\r\n  const isOrganisationUser = userRole === 'organisationuser';\r\n  const isBranchUser = userRole === 'branchuser';\r\n\r\n  // Only fetch after a product is selected and modal is visible\r\n  const shouldFetch = !!productId && !!visible;\r\n\r\n  // Organisation users -> stock_audit\r\n  const { data: orgStocksData, isLoading: loadingOrg } =\r\n    apiSlice.useGetStockAuditQuery(\r\n      { product_id: productId },\r\n      {\r\n        skip: !shouldFetch || !isOrganisationUser,\r\n        refetchOnMountOrArgChange: true,\r\n        refetchOnFocus: true,\r\n        refetchOnReconnect: true,\r\n      }\r\n    );\r\n\r\n  // Branch users -> branch_stock\r\n  const { data: branchStocksData, isLoading: loadingBranch } =\r\n    apiSlice.useGetBranchStockQuery(\r\n      { product_id: productId },\r\n      {\r\n        skip: !shouldFetch || !isBranchUser,\r\n        refetchOnMountOrArgChange: true,\r\n        refetchOnFocus: true,\r\n        refetchOnReconnect: true,\r\n      }\r\n    );\r\n\r\n  const stocks = (\r\n    (isOrganisationUser\r\n      ? (orgStocksData as any)?.result\r\n      : isBranchUser\r\n      ? (branchStocksData as any)?.result\r\n      : []) || []\r\n  ) as Stock[];\r\n  const loading = loadingOrg || loadingBranch;\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedRowKey, setSelectedRowKey] = useState<React.Key | null>(null);\r\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\r\n  const [errorMessage, setErrorMessage] = useState<string>('');\r\n  const tableBodyRef = useRef<HTMLDivElement>(null);\r\n  const searchInputRef = useRef<InputRef>(null);\r\n\r\n  // Helper function to check if stock is expired\r\n  const isStockExpired = (stock: Stock): boolean => {\r\n    return !!(stock.expiry_date && dayjs(stock.expiry_date).isBefore(dayjs()));\r\n  };\r\n\r\n  // Helper function to check if stock has zero quantity\r\n  const isStockOutOfStock = (stock: Stock): boolean => {\r\n    return stock.available_quantity <= 0;\r\n  };\r\n\r\n  // Helper function to show expired stock error message\r\n  const showExpiredStockError = (stock: Stock) => {\r\n    const expiryDate = dayjs(stock.expiry_date).format('DD/MM/YYYY');\r\n    const errorMsg = `Cannot select expired stock! This item expired on ${expiryDate}. Please select a valid stock item.`;\r\n    setErrorMessage(errorMsg);\r\n    message.error(errorMsg);\r\n\r\n    // Clear error message after 5 seconds\r\n    setTimeout(() => {\r\n      setErrorMessage('');\r\n    }, 5000);\r\n  };\r\n\r\n  // Helper function to show out of stock error message\r\n  const showOutOfStockError = (stock: Stock) => {\r\n    const errorMsg = `Cannot select out of stock item! This item has 0 available quantity. Please select a stock item with available quantity.`;\r\n    setErrorMessage(errorMsg);\r\n    message.error(errorMsg);\r\n\r\n    // Clear error message after 5 seconds\r\n    setTimeout(() => {\r\n      setErrorMessage('');\r\n    }, 5000);\r\n  };\r\n\r\n  const filteredStocks: Stock[] =\r\n    (Array.isArray(stocks) ? stocks : []).filter((s: Stock) => {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      return (\r\n        s.batch_no?.toLowerCase().includes(searchLower) ||\r\n        s.ProductItem?.name?.toLowerCase().includes(searchLower) ||\r\n        s.ProductItem?.VariantItem?.variant_name\r\n          ?.toLowerCase()\r\n          .includes(searchLower) ||\r\n        s.available_quantity?.toString().includes(searchLower) ||\r\n        s.sell_price?.toString().includes(searchLower)\r\n      );\r\n    });\r\n\r\n  // Show all stocks including expired ones, but disable selection of expired items\r\n  const allStocks = filteredStocks;\r\n\r\n  useEffect(() => {\r\n    setHighlightedIndex(0);\r\n    setErrorMessage(''); // Clear any existing error messages\r\n    if (allStocks.length > 0) {\r\n      // Find the first valid stock (not expired and not out of stock)\r\n      let firstValidIndex = 0;\r\n      while (\r\n        firstValidIndex < allStocks.length &&\r\n        ((allStocks[firstValidIndex].expiry_date &&\r\n          dayjs(allStocks[firstValidIndex].expiry_date).isBefore(dayjs())) ||\r\n          allStocks[firstValidIndex].available_quantity <= 0)\r\n      ) {\r\n        firstValidIndex++;\r\n      }\r\n      if (firstValidIndex < allStocks.length) {\r\n        setSelectedRowKey(allStocks[firstValidIndex]._id);\r\n        setHighlightedIndex(firstValidIndex);\r\n      } else {\r\n        setSelectedRowKey(null);\r\n      }\r\n    } else {\r\n      setSelectedRowKey(null);\r\n    }\r\n  }, [searchTerm, visible, stocks]);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setErrorMessage(''); // Clear error messages when modal opens\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n      }, 0);\r\n    }\r\n  }, [visible]);\r\n\r\n  useEffect(() => {\r\n    if (tableBodyRef.current) {\r\n      const row = tableBodyRef.current.querySelector(\r\n        `.ant-table-row[data-row-key='${allStocks[highlightedIndex]?._id}']`\r\n      ) as HTMLElement;\r\n      row?.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  }, [highlightedIndex, allStocks]);\r\n\r\n  // RTK Query automatically loads stocks on mount\r\n  // For product filtering, it's handled client-side from cached data\r\n  // TODO: Implement server-side product filtering with RTK Query if needed\r\n\r\n  const columns: ColumnType<Stock>[] = [\r\n    {\r\n      title: 'Product',\r\n      dataIndex: 'ProductItem',\r\n      key: 'product',\r\n      render: (ProductItem: any) => ProductItem?.name || 'N/A',\r\n    },\r\n    {\r\n      title: 'Variant',\r\n      dataIndex: 'ProductItem',\r\n      key: 'variant',\r\n      render: (ProductItem: any) =>\r\n        ProductItem?.VariantItem?.variant_name || 'N/A',\r\n    },\r\n    { title: 'Batch No', dataIndex: 'batch_no', key: 'batch_no' },\r\n    {\r\n      title: 'Available',\r\n      dataIndex: 'available_quantity',\r\n      key: 'available_quantity',\r\n      render: (available_quantity: number, record: Stock) => {\r\n        const isOutOfStock = available_quantity <= 0;\r\n        return (\r\n          <span\r\n            style={{\r\n              color: isOutOfStock ? '#ff4d4f' : '#52c41a',\r\n              fontWeight: isOutOfStock ? 'bold' : 'normal',\r\n            }}\r\n          >\r\n            {available_quantity}\r\n            {isOutOfStock && (\r\n              <ExclamationCircleOutlined\r\n                style={{ marginLeft: 4, color: '#ff4d4f' }}\r\n              />\r\n            )}\r\n          </span>\r\n        );\r\n      },\r\n    },\r\n    { title: 'Price', dataIndex: 'sell_price', key: 'sell_price' },\r\n    {\r\n      title: 'Expiry Date',\r\n      dataIndex: 'expiry_date',\r\n      key: 'expiry_date',\r\n      render: (expiry_date: string, record: Stock) => {\r\n        if (!expiry_date)\r\n          return <span style={{ color: '#999' }}>No Expiry</span>;\r\n\r\n        const expiryDate = dayjs(expiry_date);\r\n        const today = dayjs();\r\n        const isExpired = expiryDate.isBefore(today);\r\n        const daysUntilExpiry = expiryDate.diff(today, 'days');\r\n\r\n        let color = 'green';\r\n        let icon = <CheckCircleOutlined />;\r\n        let status = 'Valid';\r\n\r\n        if (isExpired) {\r\n          color = 'red';\r\n          icon = <ExclamationCircleOutlined />;\r\n          status = 'Expired';\r\n        } else if (daysUntilExpiry <= 30) {\r\n          color = 'orange';\r\n          icon = <ExclamationCircleOutlined />;\r\n          status = `Expires in ${daysUntilExpiry} days`;\r\n        }\r\n\r\n        return (\r\n          <Tooltip title={status}>\r\n            <Tag color={color} icon={icon}>\r\n              {expiryDate.format('DD/MM/YYYY')}\r\n            </Tag>\r\n          </Tooltip>\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  const handleSelectRow = (stock: Stock) => {\r\n    // Check if stock is expired and show error message\r\n    if (isStockExpired(stock)) {\r\n      showExpiredStockError(stock);\r\n      return;\r\n    }\r\n\r\n    // Check if stock is out of stock and show error message\r\n    if (isStockOutOfStock(stock)) {\r\n      showOutOfStockError(stock);\r\n      return;\r\n    }\r\n\r\n    // Clear any existing error message\r\n    setErrorMessage('');\r\n\r\n    onSelect({\r\n      id: stock._id,\r\n      _id: stock._id,\r\n      batch_no: stock.batch_no,\r\n      name: stock.ProductItem?.name || stock.name || '',\r\n      code: stock.code,\r\n      available_quantity: stock.available_quantity,\r\n      available_loose_quantity: stock.available_loose_quantity,\r\n      sell_price: stock.sell_price,\r\n      ProductItem: stock.ProductItem, // Include ProductItem for pack_size\r\n    });\r\n  };\r\n\r\n  const handleSearchKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!allStocks.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        let next = prev + 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          next < allStocks.length &&\r\n          ((allStocks[next].expiry_date &&\r\n            dayjs(allStocks[next].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[next].available_quantity <= 0)\r\n        ) {\r\n          next++;\r\n        }\r\n        const finalNext = Math.min(next, allStocks.length - 1);\r\n        setSelectedRowKey(allStocks[finalNext]._id);\r\n        return finalNext;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        let prevIndex = prev - 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          prevIndex >= 0 &&\r\n          ((allStocks[prevIndex].expiry_date &&\r\n            dayjs(allStocks[prevIndex].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[prevIndex].available_quantity <= 0)\r\n        ) {\r\n          prevIndex--;\r\n        }\r\n        const finalPrev = Math.max(prevIndex, 0);\r\n        setSelectedRowKey(allStocks[finalPrev]._id);\r\n        return finalPrev;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedStock = allStocks[highlightedIndex];\r\n      if (selectedStock) {\r\n        handleSelectRow(selectedStock);\r\n        // Only close modal if selection was successful (not expired and not out of stock)\r\n        if (\r\n          !isStockExpired(selectedStock) &&\r\n          !isStockOutOfStock(selectedStock)\r\n        ) {\r\n          onCancel(); // Close the modal after selection\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleTableKeyDown = (e: KeyboardEvent<HTMLDivElement>) => {\r\n    if (!allStocks.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(i => {\r\n        let next = i + 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          next < allStocks.length &&\r\n          ((allStocks[next].expiry_date &&\r\n            dayjs(allStocks[next].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[next].available_quantity <= 0)\r\n        ) {\r\n          next++;\r\n        }\r\n        const finalNext = Math.min(next, allStocks.length - 1);\r\n        setSelectedRowKey(allStocks[finalNext]._id);\r\n        return finalNext;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(i => {\r\n        let prev = i - 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          prev >= 0 &&\r\n          ((allStocks[prev].expiry_date &&\r\n            dayjs(allStocks[prev].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[prev].available_quantity <= 0)\r\n        ) {\r\n          prev--;\r\n        }\r\n        const finalPrev = Math.max(prev, 0);\r\n        setSelectedRowKey(allStocks[finalPrev]._id);\r\n        return finalPrev;\r\n      });\r\n      // Keep focus on search input\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedStock = allStocks[highlightedIndex];\r\n      if (selectedStock) {\r\n        handleSelectRow(selectedStock);\r\n        // Only close modal if selection was successful (not expired and not out of stock)\r\n        if (\r\n          !isStockExpired(selectedStock) &&\r\n          !isStockOutOfStock(selectedStock)\r\n        ) {\r\n          onCancel(); // Close the modal after selection\r\n        }\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Tab' && e.shiftKey) {\r\n      e.preventDefault();\r\n      searchInputRef.current?.focus();\r\n    }\r\n  };\r\n\r\n  // Auto-focus back to search input when clicking outside\r\n  const handleModalClick = () => {\r\n    searchInputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select Stock (F7 to reopen anytime)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      width={800}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div onClick={handleModalClick}>\r\n        <Search\r\n          ref={searchInputRef}\r\n          placeholder=\"Search stocks (use  arrows to navigate, Enter to select)\"\r\n          onChange={e => setSearchTerm(e.target.value)}\r\n          style={{ marginBottom: 16 }}\r\n          autoFocus\r\n          onKeyDown={handleSearchKeyDown}\r\n          onBlur={() => {\r\n            // Re-focus after a short delay to ensure it stays focused\r\n            setTimeout(() => {\r\n              if (visible) {\r\n                searchInputRef.current?.focus();\r\n              }\r\n            }, 10);\r\n          }}\r\n        />\r\n\r\n        {/* Error Message Display */}\r\n        {errorMessage && (\r\n          <div\r\n            style={{\r\n              marginBottom: 16,\r\n              padding: '12px 16px',\r\n              backgroundColor: '#fff2f0',\r\n              border: '1px solid #ffccc7',\r\n              borderRadius: '6px',\r\n              color: '#cf1322',\r\n              fontSize: '14px',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '8px',\r\n            }}\r\n          >\r\n            <ExclamationCircleOutlined style={{ color: '#cf1322' }} />\r\n            {errorMessage}\r\n          </div>\r\n        )}\r\n\r\n        <div\r\n          onKeyDown={handleTableKeyDown}\r\n          tabIndex={0}\r\n          ref={tableBodyRef}\r\n          style={{ outline: 'none' }}\r\n        >\r\n          <Table\r\n            dataSource={allStocks}\r\n            columns={columns}\r\n            loading={loading}\r\n            rowKey=\"_id\"\r\n            size=\"small\"\r\n            pagination={false}\r\n            title={() => (\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  justifyContent: 'space-between',\r\n                  alignItems: 'center',\r\n                  padding: '8px 0',\r\n                }}\r\n              >\r\n                <span>Stock Items</span>\r\n                <div style={{ fontSize: '12px', color: '#666' }}>\r\n                  <span style={{ color: '#52c41a' }}> Valid</span>\r\n                  <span style={{ margin: '0 8px', color: '#faad14' }}>\r\n                     Near Expiry\r\n                  </span>\r\n                  <span style={{ color: '#ff4d4f' }}>\r\n                     Expired/Out of Stock (Disabled)\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            )}\r\n            onRow={(record, idx) => {\r\n              const isExpired = isStockExpired(record);\r\n              const isOutOfStock = isStockOutOfStock(record);\r\n              return {\r\n                onClick: () => {\r\n                  if (!isExpired && !isOutOfStock) {\r\n                    handleSelectRow(record);\r\n                    // Keep focus on search input after selection\r\n                    setTimeout(() => {\r\n                      searchInputRef.current?.focus();\r\n                    }, 10);\r\n                  } else if (isExpired) {\r\n                    showExpiredStockError(record);\r\n                  } else if (isOutOfStock) {\r\n                    showOutOfStockError(record);\r\n                  }\r\n                },\r\n                onDoubleClick: () => {\r\n                  if (!isExpired && !isOutOfStock) {\r\n                    handleSelectRow(record);\r\n                  } else if (isExpired) {\r\n                    showExpiredStockError(record);\r\n                  } else if (isOutOfStock) {\r\n                    showOutOfStockError(record);\r\n                  }\r\n                },\r\n                className:\r\n                  idx === highlightedIndex\r\n                    ? 'ant-table-row ant-table-row-selected'\r\n                    : 'ant-table-row',\r\n                'data-row-key': record._id,\r\n                style: {\r\n                  opacity: isExpired || isOutOfStock ? 0.6 : 1,\r\n                  cursor: isExpired || isOutOfStock ? 'not-allowed' : 'pointer',\r\n                  backgroundColor:\r\n                    isExpired || isOutOfStock ? '#f5f5f5' : undefined,\r\n                },\r\n              };\r\n            }}\r\n            rowSelection={{\r\n              type: 'radio',\r\n              selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n              onChange: (keys: React.Key[]) => {\r\n                setSelectedRowKey(keys[0]);\r\n                const idx = allStocks.findIndex(s => s._id === keys[0]);\r\n                if (idx !== -1) setHighlightedIndex(idx);\r\n              },\r\n              getCheckboxProps: (record: Stock) => ({\r\n                disabled: isStockExpired(record) || isStockOutOfStock(record),\r\n              }),\r\n            }}\r\n          />\r\n          <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n            <strong>Keyboard Shortcuts:</strong>  Navigate stocks | Enter\r\n            Select | Escape Cancel\r\n            <br />\r\n            <strong>Tip:</strong> Press F7 anytime to reopen this modal for\r\n            stock changes\r\n            <br />\r\n            <strong>Note:</strong> Expired items () and out of stock items\r\n            () are shown but cannot be selected. Navigation automatically\r\n            skips expired and out of stock items.\r\n            <br />\r\n            <strong>Error Handling:</strong> Attempting to select expired or out\r\n            of stock items will show an error message and prevent selection.\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default StockSelectionModal;\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Table,\r\n  Input,\r\n  InputNumber,\r\n  Select,\r\n  DatePicker,\r\n  Button,\r\n  Space,\r\n  Modal,\r\n  Typography,\r\n  message,\r\n  TableProps,\r\n} from 'antd';\r\nimport type { SizeType } from 'antd/es/config-provider/SizeContext';\r\nimport { PlusOutlined, DeleteOutlined, SaveOutlined } from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport './AntdEditableTable.css';\r\nimport ProductSelectionModal from '../../pages/RetaillBill/components/ProductSelectionModal';\r\nimport StockSelectionModal from '../../pages/RetaillBill/components/StockSelectionModal';\r\n\r\nconst { Text } = Typography;\r\n\r\nexport interface AntdEditableColumn {\r\n  title: string;\r\n  dataIndex: string;\r\n  key?: string;\r\n  defaultValue?: any;\r\n  type?: 'text' | 'number' | 'select' | 'date' | 'product' | 'stock';\r\n  options?: { label: string; value: any }[];\r\n  required?: boolean;\r\n  width?: number;\r\n  editable?: boolean;\r\n  validation?: (value: any) => string | undefined;\r\n  render?: (value: any, record?: any, rowIndex?: number) => React.ReactNode;\r\n}\r\n\r\nexport interface AntdEditableTableProps {\r\n  columns: AntdEditableColumn[];\r\n  dataSource: any[];\r\n  onSave: (data: any[]) => void;\r\n  onAdd?: () => void;\r\n  onDelete?: (indices: number[]) => void;\r\n  onProductSelect?: (product: any, rowIndex: number) => void;\r\n  allowAdd?: boolean;\r\n  allowDelete?: boolean;\r\n  rowKey?: string;\r\n  loading?: boolean;\r\n  compact?: boolean;\r\n  enableKeyboardNav?: boolean;\r\n  size?: SizeType;\r\n  className?: string;\r\n  externalEditingCell?: { row: number; col: number } | null;\r\n}\r\n\r\nconst AntdEditableTable: React.FC<AntdEditableTableProps> = ({\r\n  columns,\r\n  dataSource,\r\n  onSave,\r\n  onAdd,\r\n  onDelete,\r\n  allowAdd = true,\r\n  allowDelete = true,\r\n  rowKey = 'key',\r\n  loading = false,\r\n  compact = false,\r\n  enableKeyboardNav = true,\r\n  size = 'middle',\r\n  className,\r\n  onProductSelect,\r\n  externalEditingCell,\r\n}) => {\r\n  const [data, setData] = useState<any[]>([]);\r\n  const [selectedRows, setSelectedRows] = useState<any[]>([]);\r\n  const [editingCell, setEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n  const firstLoadRef = useRef(true);\r\n\r\n  useEffect(() => {\r\n    setData(dataSource);\r\n\r\n    const firstProductColIndex = columns.findIndex(\r\n      col => col.dataIndex === 'product_id'\r\n    );\r\n\r\n    //  Auto-focus only if table is empty on first load\r\n    if (\r\n      firstLoadRef.current &&\r\n      dataSource.length === 0 &&\r\n      firstProductColIndex >= 0\r\n    ) {\r\n      setEditingCell({ row: 0, col: firstProductColIndex });\r\n      firstLoadRef.current = false; // Prevent repeat auto-focus\r\n    }else{\r\n      setSelectedRows(dataSource.length>0?[String(dataSource.length-1)]:[])\r\n    }\r\n  }, [dataSource, columns]);\r\n\r\n  // Sync editingCell with externalEditingCell prop\r\n  useEffect(() => {\r\n    if (externalEditingCell) {\r\n      setEditingCell(externalEditingCell);\r\n    }\r\n  }, [externalEditingCell]);\r\n\r\n  const handleAddRow = () => {\r\n    onAdd?.();\r\n    // Set focus to the first editable cell of the new row (after parent updates data)\r\n    const firstEditableCol = columns.findIndex(col => col.editable !== false);\r\n    if (firstEditableCol >= 0) {\r\n      setEditingCell({ row: data.length, col: firstEditableCol });\r\n    }\r\n  };\r\n\r\n  const handleDeleteRow = () => {\r\n    if (data.length === 0) {\r\n      message.warning('No rows to delete');\r\n      return;\r\n    }\r\n    Modal.confirm({\r\n      title: 'Are you sure you want to delete the selected Bill Items?',\r\n      onOk: () => {\r\n        const newData = data.slice(0, -1);\r\n        setData(newData);\r\n        onSave(newData);\r\n        onDelete?.(selectedRows);\r\n      },\r\n    });\r\n  };\r\n\r\n  const saveCell = (row: number, col: number, value: any): boolean => {\r\n    const column = columns[col];\r\n\r\n    // Basic validation\r\n    if (column.required && (!value || value === '')) {\r\n      message.error(`${column.title} is required`);\r\n      return false;\r\n    }\r\n\r\n    // Custom validation\r\n    if (column.validation) {\r\n      const error = column.validation(value);\r\n      if (error) {\r\n        message.error(error);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const newData = [...data];\r\n    newData[row][columns[col].dataIndex] = value;\r\n    setData(newData);\r\n    onSave(newData);\r\n    return true;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.ctrlKey && e.key === 's') {\r\n        e.preventDefault();\r\n        onSave(data);\r\n      }\r\n      if (e.shiftKey && e.key.toLowerCase() === 'a' && allowAdd) {\r\n        e.preventDefault();\r\n        handleAddRow();\r\n      }\r\n    };\r\n    if (enableKeyboardNav) {\r\n      document.addEventListener('keydown', handleKeyDown);\r\n      return () => document.removeEventListener('keydown', handleKeyDown);\r\n    }\r\n  }, [data, allowAdd, onSave, enableKeyboardNav, handleAddRow]);\r\n\r\n  const rowSelection: TableProps<any>['rowSelection'] = {\r\n    onChange: (selectedRowKeys: React.Key[], selectedRows:any[]) => {\r\n      setSelectedRows([...selectedRowKeys]);\r\n    },\r\n  };\r\n  \r\n  // Helper to find the next editable column index\r\n  function getNextEditableCol(startCol: number, direction: 1 | -1, columns: AntdEditableColumn[]): number {\r\n    let col = startCol + direction;\r\n    while (col >= 0 && col < columns.length) {\r\n      if (columns[col].editable !== false) return col;\r\n      col += direction;\r\n    }\r\n    return -1; // No editable column found\r\n  }\r\n\r\n  const EditableCell = ({\r\n    row,\r\n    col,\r\n    value,\r\n  }: {\r\n    row: number;\r\n    col: number;\r\n    value: any;\r\n  }) => {\r\n    const [cellValue, setCellValue] = useState(value);\r\n    const inputRef = useRef<any>(null);\r\n    const column = columns[col];\r\n    const [isProductModalVisible, setIsProductModalVisible] = useState(false);\r\n    const [isStockModalVisible, setIsStockModalVisible] = useState(false);\r\n\r\n    useEffect(() => {\r\n      setCellValue(value);\r\n      //  Focus input/select when cell enters edit mode\r\n      setTimeout(() => {\r\n        inputRef.current?.focus();\r\n      }, 50);\r\n    }, [value]);\r\n\r\n    const handleChange = (val: any) => {\r\n      setCellValue(val);\r\n      saveCell(row, col, val);\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n      if (column.type === 'product' && e.key === 'Enter') {\r\n        e.stopPropagation();\r\n        setIsProductModalVisible(true);\r\n        return; // Do not validate or move cell yet!\r\n      }\r\n      if (column.type === 'stock' && e.key === 'Enter') {\r\n        e.stopPropagation();\r\n        setIsStockModalVisible(true);\r\n        return;\r\n      }\r\n      if (e.key === 'Tab') {\r\n        e.preventDefault();\r\n        // Only validate on Tab\r\n        if (column.required && (!cellValue || cellValue === '')) {\r\n          message.error(`${column.title} is required`);\r\n          return;\r\n        }\r\n        const nextCol = e.shiftKey ? col - 1 : col + 1;\r\n        const nextRow = row + (nextCol >= columns.length ? 1 : 0);\r\n        const colIndex = (nextCol + columns.length) % columns.length;\r\n        if (nextRow < data.length) {\r\n          setEditingCell({ row: nextRow, col: colIndex });\r\n        } else if (allowAdd) {\r\n          handleAddRow();\r\n          setEditingCell({ row: data.length, col: colIndex });\r\n        }\r\n      } else if (e.key === 'Escape') {\r\n        setEditingCell(null);\r\n      }\r\n    };\r\n\r\n    const handleProductSelect = (product: any) => {\r\n      if (onProductSelect) {\r\n        onProductSelect(product, row);\r\n      }\r\n      setIsProductModalVisible(false);\r\n      setEditingCell(null);\r\n    };\r\n\r\n    const handleStockSelect = (stock: any) => {\r\n      // Set stock_id and batch_no in the row\r\n      const newData = [...data];\r\n      newData[row].stock_id = stock.id || stock._id || '';\r\n      newData[row].batch_no = stock.batch_no || '';\r\n      setData(newData);\r\n      onSave(newData);\r\n      setIsStockModalVisible(false);\r\n      setEditingCell(null);\r\n    };\r\n\r\n    switch (column.type) {\r\n      case 'product':\r\n        // Display product name instead of product_id when cell is focused\r\n        const productName = data[row]?.product_name\r\n          ? `${data[row].product_name}${data[row]?.variant_name ? ` ${data[row].variant_name}` : ''}`.trim()\r\n          : cellValue; // Fallback to product_id if name not available\r\n        return (\r\n          <>\r\n            <div onClick={e => e.stopPropagation()}>\r\n              <Input\r\n                ref={inputRef}\r\n                value={productName}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder=\"Press Enter to select product\"\r\n                readOnly\r\n                style={{ cursor: 'pointer' }}\r\n              />\r\n            </div>\r\n            {isProductModalVisible && (\r\n              <ProductSelectionModal\r\n                visible={isProductModalVisible}\r\n                onSelect={handleProductSelect}\r\n                onCancel={() => setIsProductModalVisible(false)}\r\n              />\r\n            )}\r\n          </>\r\n        );\r\n      case 'stock':\r\n        return (\r\n          <>\r\n            <div onClick={e => e.stopPropagation()}>\r\n              <Input\r\n                ref={inputRef}\r\n                value={data[row]?.batch_no || cellValue}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder=\"Press Enter to select stock\"\r\n                readOnly\r\n              />\r\n            </div>\r\n            {isStockModalVisible && (\r\n              <StockSelectionModal\r\n                visible={isStockModalVisible}\r\n                onSelect={handleStockSelect}\r\n                onCancel={() => setIsStockModalVisible(false)}\r\n                productId={data[row]?.product_id || ''}\r\n              />\r\n            )}\r\n          </>\r\n        );\r\n      case 'number':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <InputNumber\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              onChange={handleChange}\r\n              onBlur={() => setEditingCell(null)}\r\n              controls={false}\r\n              onKeyDown={e => {\r\n                // Allow Enter/Tab to move to next editable cell\r\n                if (e.key === 'Tab' || e.key === 'Enter') {\r\n                  e.preventDefault();\r\n                  // Only validate on Tab or Enter\r\n                  if (column.required && (!cellValue || cellValue === '')) {\r\n                    message.error(`${column.title} is required`);\r\n                    return;\r\n                  }\r\n                  const direction = e.shiftKey ? -1 : 1;\r\n                  const nextCol = getNextEditableCol(col, direction, columns);\r\n                  if (nextCol !== -1) {\r\n                    setEditingCell({ row, col: nextCol });\r\n                  } else {\r\n                    // Move to next/previous row's first editable cell\r\n                    const nextRow = direction > 0 ? row + 1 : row - 1;\r\n                    if (nextRow >= 0 && nextRow < data.length) {\r\n                      const firstEditableCol = getNextEditableCol(-1, 1, columns);\r\n                      if (firstEditableCol !== -1) {\r\n                        setEditingCell({ row: nextRow, col: firstEditableCol });\r\n                      }\r\n                    } else if (direction > 0 && allowAdd) {\r\n                      // Add new row if moving forward and at the end\r\n                      handleAddRow();\r\n                      const firstEditableCol = getNextEditableCol(-1, 1, columns);\r\n                      if (firstEditableCol !== -1) {\r\n                        setEditingCell({ row: data.length, col: firstEditableCol });\r\n                      }\r\n                    } else {\r\n                      // Exit edit mode if no more rows\r\n                      setEditingCell(null);\r\n                    }\r\n                  }\r\n                } else if (e.key === 'Escape') {\r\n                  setEditingCell(null);\r\n                }\r\n              }}\r\n              style={{ width: '100%' }}\r\n            />\r\n          </div>\r\n        );\r\n      case 'select':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <Select\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              options={column.options}\r\n              onChange={val => {\r\n                const success = saveCell(row, col, val);\r\n                if (success) {\r\n                  // Move to next editable cell\r\n                  const nextCol = col + 1;\r\n                  const nextRow = row + (nextCol >= columns.length ? 1 : 0);\r\n                  const colIndex = (nextCol + columns.length) % columns.length;\r\n\r\n                  if (nextRow < data.length) {\r\n                    setEditingCell({ row: nextRow, col: colIndex });\r\n                  } else if (allowAdd) {\r\n                    handleAddRow();\r\n                    setEditingCell({ row: data.length, col: colIndex });\r\n                  }\r\n                }else {\r\n                  // Validation failed; keep focus\r\n                  setTimeout(() => {\r\n                    inputRef.current?.focus();\r\n                  }, 50);\r\n                }\r\n              }}\r\n              style={{ width: '100%' }}\r\n              onKeyDown={e => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  e.preventDefault(); // Block default key behavior\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n        );\r\n\r\n      case 'date':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <DatePicker\r\n              ref={inputRef}\r\n              value={cellValue ? dayjs(cellValue) : null}\r\n              onChange={date => {\r\n                handleChange(date ? date.format('YYYY-MM-DD') : null);\r\n                setEditingCell(null);\r\n              }}\r\n              onBlur={() => setEditingCell(null)}\r\n              onKeyDown={handleKeyDown}\r\n              style={{ width: '100%' }}\r\n            />\r\n          </div>\r\n        );\r\n      default:\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <Input\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              onChange={e => handleChange(e.target.value)}\r\n              onBlur={() => setEditingCell(null)}\r\n              onKeyDown={handleKeyDown}\r\n            />\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  const mergedColumns = columns.map((col, colIndex) => ({\r\n    ...col,\r\n    onCell: (_record: any, rowIndex?: number) => ({\r\n      onClick: () => {\r\n        if (typeof rowIndex === 'number') {\r\n          setEditingCell({ row: rowIndex, col: colIndex });\r\n        }\r\n      },\r\n      onContextMenu: (e: React.MouseEvent) => {\r\n        e.preventDefault(); //  Prevent default context menu\r\n        if (typeof rowIndex === 'number') {\r\n          setEditingCell({ row: rowIndex, col: colIndex });\r\n        }\r\n      },\r\n    }),\r\n    render: (val: any, record: any, rowIndex: number) => {\r\n      if (\r\n        editingCell &&\r\n        editingCell.row === rowIndex &&\r\n        editingCell.col === colIndex\r\n      ) {\r\n        return (\r\n          <EditableCell\r\n            key={`${rowIndex}-${colIndex}`}\r\n            row={rowIndex}\r\n            col={colIndex}\r\n            value={record[col.dataIndex]}\r\n          />\r\n        );\r\n      }\r\n      // Use custom render if provided and not editing\r\n      if (typeof col.render === 'function') {\r\n        return col.render(val, record, rowIndex);\r\n      }\r\n      // Show batch_no for stock_id column when not editing\r\n      if (col.dataIndex === 'batch_no') {\r\n        return record.batch_no || record[col.dataIndex];\r\n      }\r\n      // Show product_name for product_id column when not editing\r\n      if (col.dataIndex === 'product_id') {\r\n        return record.product_name || record[col.dataIndex];\r\n      }\r\n      if (col.type === 'select' && col.options) {\r\n        const option = col.options.find(\r\n          opt => opt.value === record[col.dataIndex]\r\n        );\r\n        return option ? option.label : record[col.dataIndex];\r\n      }\r\n      return record[col.dataIndex];\r\n    },\r\n  }));\r\n\r\n  return (\r\n    <div\r\n      className={`antd-editable-table ${compact ? 'compact' : ''} ${\r\n        className || ''\r\n      }`}\r\n    >\r\n      <div className=\"table-toolbar\">\r\n        <Space>\r\n          {allowAdd && (\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<PlusOutlined />}\r\n              onClick={handleAddRow}\r\n            >\r\n              Add Row (Shift+A)\r\n            </Button>\r\n          )}\r\n          {allowDelete && (\r\n            <Button danger icon={<DeleteOutlined />} onClick={handleDeleteRow}>\r\n              Delete Row\r\n            </Button>\r\n          )}\r\n          <Button\r\n            type=\"primary\"\r\n            icon={<SaveOutlined />}\r\n            onClick={() => onSave(data)}\r\n          >\r\n            Save (Ctrl+S)\r\n          </Button>\r\n        </Space>\r\n        <Text type=\"secondary\" className=\"table-info\">\r\n          Use Tab / Shift+Tab to navigate cells\r\n        </Text>\r\n      </div>\r\n      <Table\r\n        bordered\r\n        dataSource={data}\r\n        columns={mergedColumns}\r\n        rowKey={rowKey}\r\n        loading={loading}\r\n        pagination={false}\r\n        size={size}\r\n        scroll={{ y: 400 }}\r\n        rowSelection={{...rowSelection,type:\"checkbox\",selectedRowKeys:selectedRows}}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AntdEditableTable;\r\n","import { useMemo } from 'react';\r\nimport { calculateBillTotals } from '../../../helpers/amount_calculations';\r\nimport { BillItem } from '../../../types/entities';\r\n\r\ninterface BillSettings {\r\n  isGstIncluded: boolean;\r\n  discount: number;\r\n  discountType: 'percentage' | 'amount';\r\n}\r\n\r\nexport const useBillCalculations = (\r\n  items: BillItem[],\r\n  billSettings: BillSettings\r\n) => {\r\n  const billCalculations = useMemo(() => {\r\n    if (!items.length)\r\n      return {\r\n        sub_total: 0,\r\n        value_of_goods: 0,\r\n        total_gst: 0,\r\n        cgst: 0,\r\n        sgst: 0,\r\n        total_amount: 0,\r\n        discountValue: 0,\r\n      };\r\n\r\n    return calculateBillTotals({\r\n      items,\r\n      productList: [], // Not needed - tax_percentage stored in bill items\r\n      isGstIncluded: billSettings.isGstIncluded,\r\n      discount: billSettings.discount,\r\n      discountType: billSettings.discountType,\r\n    });\r\n  }, [items, billSettings]);\r\n\r\n  return billCalculations;\r\n};\r\n\r\n","/**\r\n * Centralized bill calculation utility\r\n * @param items - array of bill items\r\n * @param productList - product list (for tax/category lookup)\r\n * @param isGstIncluded - whether GST is included in price\r\n * @param discount - discount value\r\n * @param discountType - 'percentage' or 'amount'\r\n * @returns { totalAmount, totalGST, cgst, sgst, valueOfGoods, subtotal, itemsWithTax }\r\n */\r\nexport function calculateBillTotals({\r\n  items,\r\n  productList,\r\n  isGstIncluded,\r\n  discount,\r\n  discountType,\r\n}: {\r\n  items: any[];\r\n  productList: any[];\r\n  isGstIncluded: boolean;\r\n  discount: number;\r\n  discountType: \"percentage\" | \"amount\";\r\n}) {\r\n  // Calculate item base amounts\r\n  const itemsWithTax = items.map((item) => {\r\n    const product = productList?.find((p: any) => p._id === item.product_id);\r\n    // Use item's tax_percentage if available, otherwise get from product category, or default to 18%\r\n    let taxPercentage = item.tax_percentage || product?.CategoryItem?.tax_percentage || 18;\r\n    \r\n    // If still no tax percentage, use a default based on common GST rates\r\n    if (!taxPercentage || taxPercentage === 0) {\r\n      // Default to 18% GST for most goods\r\n      taxPercentage = 18;\r\n    }\r\n    \r\n\r\n    // Calculate base amount (before GST)\r\n    const baseAmount =\r\n      Number(item.qty || 0) * Number(item.price || 0) +\r\n      Number(item.loose_qty || 0) *\r\n        (Number(item.price || 0) / (product?.VariantItem?.pack_size || 1) || 0);\r\n    \r\n    // Calculate amount (with GST if applicable)\r\n    let amount = baseAmount;\r\n    if (!isGstIncluded && taxPercentage > 0) {\r\n      amount = baseAmount + (baseAmount * taxPercentage / 100);\r\n    }\r\n    return {\r\n      ...item,\r\n      tax_percentage: taxPercentage,\r\n      baseAmount,\r\n      amount,\r\n    };\r\n  });\r\n\r\n  // sub_total: sum of all item.amount values (table total before discount/GST)\r\n  const sub_total = itemsWithTax.reduce(\r\n    (sum, item) => sum + Number(item.amount),\r\n    0\r\n  );\r\n\r\n  // base_sub_total: sum of all item base amounts (before GST and discount)\r\n  const base_sub_total = itemsWithTax.reduce(\r\n    (sum, item) => sum + Number(item.baseAmount),\r\n    0\r\n  );\r\n\r\n  // Discount\r\n  let discountValue = 0;\r\n  if (discount > 0) {\r\n    if (discountType === \"percentage\") {\r\n      discountValue = base_sub_total * (discount / 100);\r\n    } else {\r\n      discountValue = discount;\r\n    }\r\n  }\r\n\r\n  // Discounted value of goods\r\n  const discounted_value_of_goods = base_sub_total - discountValue;\r\n\r\n  let total_gst = 0;\r\n  let value_of_goods = 0;\r\n  let total_amount = 0;\r\n  // Calculate GST and totals for each item\r\n  itemsWithTax.forEach(item => {\r\n    let discountedBase = item.baseAmount;\r\n    if (discount > 0) {\r\n      if (discountType === \"percentage\") {\r\n        discountedBase = item.baseAmount - (item.baseAmount * (discount / 100));\r\n      } else {\r\n        discountedBase = item.baseAmount - ((discount/base_sub_total)*item.baseAmount);\r\n      }\r\n    }\r\n    \r\n    let gstAmount = 0;\r\n    if (!isGstIncluded) {\r\n      // GST Excluded: GST is added on top\r\n      if (item.tax_percentage > 0) {\r\n        gstAmount = discountedBase * (item.tax_percentage / 100);\r\n        value_of_goods += discountedBase;\r\n        total_gst += gstAmount;\r\n        total_amount += discountedBase + gstAmount;\r\n      } else {\r\n        // No tax\r\n        value_of_goods += discountedBase;\r\n        total_amount += discountedBase;\r\n      }\r\n    } else {\r\n      // GST Included: GST is part of the price, extract it\r\n      if (item.tax_percentage > 0) {\r\n        gstAmount = discountedBase * (item.tax_percentage / (100 + item.tax_percentage));\r\n        value_of_goods += discountedBase - gstAmount;\r\n        total_gst += gstAmount;\r\n        total_amount += discountedBase;\r\n      } else {\r\n        // No tax\r\n        value_of_goods += discountedBase;\r\n        total_amount += discountedBase;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Calculate CGST and SGST (each is total_gst / 2)\r\n  const cgst = total_gst / 2;\r\n  const sgst = total_gst / 2;\r\n\r\n  return {\r\n    sub_total,\r\n    value_of_goods,\r\n    total_gst,\r\n    cgst,\r\n    sgst,\r\n    total_amount,\r\n    discountValue,\r\n  };\r\n}\r\n","import { useEffect, useMemo, useCallback } from 'react';\r\nimport { message } from 'antd';\r\nimport React from 'react';\r\nimport ReactDOMServer from 'react-dom/server';\r\nimport dayjs from 'dayjs';\r\nimport { useBillData } from './useBillData';\r\nimport { useBillForm } from './useBillForm';\r\nimport { useBillModals } from './useBillModals';\r\nimport { useBillItems } from './useBillItems';\r\nimport { useBillCalculations } from './useBillCalculations';\r\nimport { useBillKeyboardShortcuts } from './useBillKeyboardShortcuts';\r\nimport { useBillActions } from './useBillActions';\r\nimport { useTemplateSettings } from '../../../hooks/useTemplateSettings';\r\n\r\ninterface AdvancedBillingProps {\r\n  billdata?: any;\r\n  onSuccess?: () => void;\r\n}\r\n\r\n/**\r\n *  MASTER ADVANCED BILLING HOOK\r\n * \r\n * This hook orchestrates all billing functionality:\r\n * - Data fetching and management\r\n * - Form state management\r\n * - Item calculations\r\n * - Modal management\r\n * - Keyboard shortcuts\r\n * - Save/print/clear actions\r\n * \r\n * Reduces main component from 3500+ lines to ~400 lines\r\n */\r\nexport const useAdvancedBilling = ({ billdata, onSuccess }: AdvancedBillingProps) => {\r\n  // 1. Data Management\r\n  const billData = useBillData(billdata);\r\n  const { BillTemplateComponent, InvoiceTemplateComponent, settings } = useTemplateSettings();\r\n\r\n  // 2. Form State Management\r\n  const form = useBillForm();\r\n\r\n  // 3. Modal Management\r\n  const modals = useBillModals();\r\n\r\n  // 4. Item Management & Calculations\r\n  const items = useBillItems({\r\n    productOptions: [], // Not needed - product data stored in bill items\r\n    branchId: billData.branchId,\r\n    branchStockListResult: billData.branchStockListResult,\r\n    stockAuditListResult: billData.stockAuditListResult,\r\n    billSettings: form.billSettings,\r\n  });\r\n\r\n  // 5. Bill Calculations\r\n  const billCalculations = useBillCalculations(\r\n    form.billFormData.items,\r\n    form.billSettings\r\n  );\r\n\r\n  // 6. Save/Print/Clear Actions\r\n  const actions = useBillActions({\r\n    billFormData: form.billFormData,\r\n    billSettings: form.billSettings,\r\n    billCalculations,\r\n    documentType: form.documentType,\r\n    branchId: billData.branchId,\r\n    createSalesRecord: billData.createSalesRecord,\r\n    updateSalesRecord: billData.updateSalesRecord,\r\n    createInvoiceNumber: billData.createInvoiceNumber,\r\n    billdata,\r\n    onSuccess,\r\n    onSaveSuccess: (savedData) => {\r\n      modals.openSaveConfirmation();\r\n    },\r\n  });\r\n\r\n  // Handle items change with calculation\r\n  const handleItemsChange = useCallback(\r\n    (newItems: any[]) => {\r\n      const calculatedItems = items.handleItemsChange(newItems);\r\n      form.updateItems(calculatedItems);\r\n    },\r\n    [items, form]\r\n  );\r\n\r\n  // Handle quantity change\r\n  const handleQuantityChange = useCallback(\r\n    (rowIndex: number, field: 'qty' | 'loose_qty', value: number) => {\r\n      const newItems = [...form.billFormData.items];\r\n      const item = newItems[rowIndex];\r\n\r\n      // Update the quantity\r\n      newItems[rowIndex] = { ...item, [field]: value };\r\n\r\n      // Recalculate through handleItemsChange\r\n      handleItemsChange(newItems);\r\n    },\r\n    [form.billFormData.items, handleItemsChange]\r\n  );\r\n\r\n  // Handle product selection\r\n  const handleProductSelect = useCallback(\r\n    (product: any, rowOrIndex: any) => {\r\n      const newItems = [...form.billFormData.items];\r\n      \r\n      // Find row index - AntdEditableTable passes row object, others might pass index number\r\n      let rowIndex: number;\r\n      if (typeof rowOrIndex === 'number') {\r\n        rowIndex = rowOrIndex;\r\n      } else {\r\n        // rowOrIndex is the row object - find its index by key\r\n        rowIndex = newItems.findIndex(item => (item as any).key === rowOrIndex.key);\r\n      }\r\n      \r\n      if (rowIndex === -1) {\r\n        console.error(' Could not find row index for product selection!');\r\n        return;\r\n      }\r\n      \r\n      // Store ALL product data (including tax %) for calculations\r\n      newItems[rowIndex].product_id = product.id || product._id || '';\r\n      newItems[rowIndex].product_name = product.name || '';\r\n      newItems[rowIndex].variant_name = product.VariantItem?.variant_name || '';\r\n      newItems[rowIndex].price = product.selling_price || 0;\r\n      newItems[rowIndex].tax_percentage = product.CategoryItem?.tax_percentage || 0;\r\n      newItems[rowIndex].category_name = product.CategoryItem?.category_name || '';\r\n      \r\n      handleItemsChange(newItems);\r\n      modals.openStockModal(rowIndex);\r\n    },\r\n    [form.billFormData.items, handleItemsChange, modals]\r\n  );\r\n\r\n  // Handle stock selection\r\n  const handleStockSelect = useCallback(\r\n    (stock: any) => {\r\n      if (modals.stockModalRowIndex === null) return;\r\n\r\n      const newItems = [...form.billFormData.items];\r\n      const rowIndex = modals.stockModalRowIndex;\r\n      const currentItem = { ...newItems[rowIndex] };\r\n\r\n      currentItem.stock_id = stock.id || stock._id || '';\r\n      currentItem.batch_no = stock.batch_no || '';\r\n\r\n      const productFromStock = stock.ProductItem;\r\n      if (productFromStock) {\r\n        currentItem.product_id = currentItem.product_id || productFromStock._id || '';\r\n        currentItem.product_name = productFromStock.name || currentItem.product_name || '';\r\n        currentItem.variant_name =\r\n          currentItem.variant_name || productFromStock.VariantItem?.variant_name || '';\r\n        currentItem.tax_percentage =\r\n          typeof currentItem.tax_percentage === 'number' && currentItem.tax_percentage !== undefined\r\n            ? currentItem.tax_percentage\r\n            : productFromStock.CategoryItem?.tax_percentage || 0;\r\n        currentItem.category_name =\r\n          currentItem.category_name || productFromStock.CategoryItem?.category_name || '';\r\n      }\r\n\r\n      // Save stock data for display AND price calculation\r\n      (currentItem as any).stockData = {\r\n        _id: stock.id || stock._id,\r\n        available_quantity: stock.available_quantity || 0,\r\n        available_loose_quantity: stock.available_loose_quantity || 0,\r\n        batch_no: stock.batch_no || '',\r\n        pack_size: stock.ProductItem?.VariantItem?.pack_size || 1,\r\n        sell_price: stock.sell_price || 0, //  ADD THIS!\r\n        mrp: stock.mrp || stock.sell_price || 0,\r\n        ProductItem: stock.ProductItem,\r\n      };\r\n\r\n      newItems[rowIndex] = currentItem;\r\n\r\n      handleItemsChange(newItems);\r\n      modals.closeStockModal();\r\n\r\n      // Focus on qty field\r\n      const qtyColIndex = 2; // Adjust based on your column order\r\n      modals.setExternalEditingCell({ row: modals.stockModalRowIndex, col: qtyColIndex });\r\n    },\r\n    [modals, form.billFormData.items, handleItemsChange]\r\n  );\r\n\r\n  // Handle print\r\n  const handlePrint = useCallback(async () => {\r\n    if (!form.billFormData.items || form.billFormData.items.length === 0) {\r\n      message.warning('Please add items before printing');\r\n      return;\r\n    }\r\n\r\n    // Always use customerListResult for both bills and invoices\r\n    const partyList = billData.customerListResult;\r\n    const selectedParty = partyList.find((p: any) => p._id === form.billFormData.customer_id);\r\n\r\n    const billDataForPDF = {\r\n      invoice_no: form.billFormData.invoice_no,\r\n      date: form.billFormData.date,\r\n      customerName: selectedParty?.full_name || selectedParty?.name || '',\r\n      customerAddress: selectedParty?.address || selectedParty?.address1 || '',\r\n      customerCity: selectedParty?.city || '',\r\n      customerState: selectedParty?.state || '',\r\n      customerPincode: selectedParty?.pincode || '',\r\n      customerPhone: selectedParty?.phone || selectedParty?.mobile || '',\r\n      customerEmail: selectedParty?.email || '',\r\n      customer_gstin: selectedParty?.gst_no || '',\r\n      customer_pan: selectedParty?.pan_no || '',\r\n      items: form.billFormData.items,\r\n      total: billCalculations.total_amount,\r\n      total_amount: billCalculations.total_amount,\r\n      value_of_goods: billCalculations.value_of_goods,\r\n      sub_total: billCalculations.sub_total,\r\n      total_gst: billCalculations.total_gst,\r\n      cgst: billCalculations.cgst,\r\n      sgst: billCalculations.sgst,\r\n      discountValue: billCalculations.discountValue,\r\n      discount: form.billSettings.discount,\r\n      discount_type: form.billSettings.discountType,\r\n      is_gst_included: form.billSettings.isGstIncluded,\r\n      payment_mode: form.billFormData.payment_mode,\r\n      // Payment status fields\r\n      is_paid: form.billSettings.isPaid,\r\n      is_partially_paid: form.billSettings.isPartiallyPaid,\r\n      paid_amount: form.billSettings.isPartiallyPaid\r\n        ? form.billSettings.paidAmount\r\n        : form.billSettings.isPaid\r\n          ? billCalculations.total_amount\r\n          : 0,\r\n      organisationItems: billData.organisationDetails,\r\n      branchItems: billData.branchDetails,\r\n    };\r\n\r\n    // Generate QR code if enabled\r\n    let qrCodeDataUrl = '';\r\n    if (settings?.enable_payment_qr && settings?.upi_id) {\r\n      try {\r\n        const { generateUPIQRCode, formatBillToUPIParams } = await import('../../../helpers/upiPayment');\r\n        const upiParams = formatBillToUPIParams(billDataForPDF, settings);\r\n        if (upiParams) {\r\n          qrCodeDataUrl = await generateUPIQRCode(upiParams, { width: settings?.qr_size || 150 });\r\n        }\r\n      } catch (error) {\r\n        console.error('Error generating QR code for print:', error);\r\n      }\r\n    }\r\n\r\n    // Add QR code to settings\r\n    const enhancedSettings = {\r\n      ...settings,\r\n      qrCodeDataUrl,\r\n    };\r\n\r\n    // Select appropriate template\r\n    const TemplateComponent = form.documentType === 'bill' \r\n      ? BillTemplateComponent \r\n      : InvoiceTemplateComponent;\r\n\r\n    // Render template to HTML\r\n    const element = React.createElement(TemplateComponent, { \r\n      billData: billDataForPDF, \r\n      settings: enhancedSettings \r\n    });\r\n    const templateHtml = ReactDOMServer.renderToString(element);\r\n\r\n    // Import and use PDF helper for printing\r\n    const { printAsPDF } = await import('../../../helpers/pdfHelper');\r\n    const fileName = `${form.documentType}_${billDataForPDF.invoice_no}_${dayjs().format('YYYYMMDD')}`;\r\n    \r\n    await printAsPDF(templateHtml, fileName, form.documentType);\r\n  }, [form, billCalculations, billData, BillTemplateComponent, InvoiceTemplateComponent, settings]);\r\n\r\n  // Handle download PDF\r\n  const handleDownload = useCallback(async () => {\r\n    if (!form.billFormData.items || form.billFormData.items.length === 0) {\r\n      message.warning('Please add items before downloading');\r\n      return;\r\n    }\r\n\r\n    // Always use customerListResult for both bills and invoices\r\n    const partyList = billData.customerListResult;\r\n    const selectedParty = partyList.find((p: any) => p._id === form.billFormData.customer_id);\r\n\r\n    const billDataForPDF = {\r\n      invoice_no: form.billFormData.invoice_no,\r\n      date: form.billFormData.date,\r\n      customerName: selectedParty?.full_name || selectedParty?.name || '',\r\n      customerAddress: selectedParty?.address || selectedParty?.address1 || '',\r\n      customerCity: selectedParty?.city || '',\r\n      customerState: selectedParty?.state || '',\r\n      customerPincode: selectedParty?.pincode || '',\r\n      customerPhone: selectedParty?.phone || selectedParty?.mobile || '',\r\n      customerEmail: selectedParty?.email || '',\r\n      customer_gstin: selectedParty?.gst_no || '',\r\n      customer_pan: selectedParty?.pan_no || '',\r\n      items: form.billFormData.items,\r\n      total: billCalculations.total_amount,\r\n      total_amount: billCalculations.total_amount,\r\n      value_of_goods: billCalculations.value_of_goods,\r\n      sub_total: billCalculations.sub_total,\r\n      total_gst: billCalculations.total_gst,\r\n      cgst: billCalculations.cgst,\r\n      sgst: billCalculations.sgst,\r\n      discountValue: billCalculations.discountValue,\r\n      discount: form.billSettings.discount,\r\n      discount_type: form.billSettings.discountType,\r\n      is_gst_included: form.billSettings.isGstIncluded,\r\n      payment_mode: form.billFormData.payment_mode,\r\n      // Payment status fields\r\n      is_paid: form.billSettings.isPaid,\r\n      is_partially_paid: form.billSettings.isPartiallyPaid,\r\n      paid_amount: form.billSettings.isPartiallyPaid\r\n        ? form.billSettings.paidAmount\r\n        : form.billSettings.isPaid\r\n          ? billCalculations.total_amount\r\n          : 0,\r\n      organisationItems: billData.organisationDetails,\r\n      branchItems: billData.branchDetails,\r\n    };\r\n\r\n    // Generate QR code if enabled\r\n    let qrCodeDataUrl = '';\r\n    if (settings?.enable_payment_qr && settings?.upi_id) {\r\n      try {\r\n        const { generateUPIQRCode, formatBillToUPIParams } = await import('../../../helpers/upiPayment');\r\n        const upiParams = formatBillToUPIParams(billDataForPDF, settings);\r\n        if (upiParams) {\r\n          qrCodeDataUrl = await generateUPIQRCode(upiParams, { width: settings?.qr_size || 150 });\r\n        }\r\n      } catch (error) {\r\n        console.error('Error generating QR code for download:', error);\r\n      }\r\n    }\r\n\r\n    // Add QR code to settings\r\n    const enhancedSettings = {\r\n      ...settings,\r\n      qrCodeDataUrl,\r\n    };\r\n\r\n    // Select appropriate template\r\n    const TemplateComponent = form.documentType === 'bill' \r\n      ? BillTemplateComponent \r\n      : InvoiceTemplateComponent;\r\n\r\n    // Render template to HTML\r\n    const element = React.createElement(TemplateComponent, { \r\n      billData: billDataForPDF, \r\n      settings: enhancedSettings \r\n    });\r\n    const templateHtml = ReactDOMServer.renderToString(element);\r\n\r\n    // Import and use PDF helper\r\n    const { downloadAsPDF } = await import('../../../helpers/pdfHelper');\r\n    const fileName = `${form.documentType}_${billDataForPDF.invoice_no}_${dayjs().format('YYYYMMDD')}`;\r\n    \r\n    await downloadAsPDF(templateHtml, fileName, form.documentType);\r\n  }, [form, billCalculations, billData, BillTemplateComponent, InvoiceTemplateComponent, settings]);\r\n\r\n  // 7. Keyboard Shortcuts\r\n  const shortcuts = useBillKeyboardShortcuts({\r\n    onF1AddItem: form.addItem,\r\n    onF2SaveDraft: actions.handleSaveDraft,\r\n    onF3CompleteBill: actions.handleCompleteBill,\r\n    onF4Clear: () => {\r\n      form.resetForm();\r\n      message.success('Bill form cleared successfully!');\r\n    },\r\n    onF5ProductSelection: () => {\r\n      // Logic to open product selection for current row\r\n      modals.openProductSelectionModal(modals.lastInteractedRowIndex);\r\n    },\r\n    onF6BillList: modals.openBillListDrawer,\r\n    onF7StockSelection: () => {\r\n      // Logic to open stock selection for current row\r\n      const rowIndex = form.billFormData.items.findIndex(\r\n        (item: any) => item.product_id && !item.stock_id\r\n      );\r\n      if (rowIndex !== -1) {\r\n        modals.openStockModal(rowIndex);\r\n      } else {\r\n        message.warning('Please select a product first');\r\n      }\r\n    },\r\n    onF8Print: handlePrint,\r\n    onEndCustomer: modals.openCustomerModal,\r\n    onCtrlU: modals.openUserModal,\r\n    onCtrlS: actions.handleSaveDraft,\r\n    onCtrlN: form.addItem,\r\n    onCtrlP: handlePrint,\r\n    onCtrlR: () => {\r\n      form.resetForm();\r\n      message.success('Ready for next bill!', 2);\r\n    },\r\n  });\r\n\r\n  // 8. Initialize data on mount\r\n  useEffect(() => {\r\n    // Products, Customers, Vendors, Users: All loaded by modals when opened\r\n    // Selected product data (with tax %) is stored in bill items for calculations\r\n    \r\n    // Get invoice number for new bills\r\n    if (!billdata && !billData.invoice_no_create_loading && !form.billFormData.invoice_no) {\r\n      billData.refetchInvoiceNo();\r\n    }\r\n\r\n    // Load bill data if editing\r\n    if (billdata) {\r\n      form.loadBillData(billdata, () => {\r\n        // Recalculate items after loading to populate stock data\r\n        if (form.billFormData.items.length > 0) {\r\n          const calculatedItems = items.calculateItemAmounts(form.billFormData.items);\r\n          form.updateItems(calculatedItems);\r\n        }\r\n      });\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [billdata?._id]);\r\n\r\n  // 9. Set invoice number\r\n  useEffect(() => {\r\n    if (billData.invoiceNoData?.result?.invoice_no && !billdata) {\r\n      form.updateHeader({ invoice_no: billData.invoiceNoData.result.invoice_no });\r\n    }\r\n  }, [billData.invoiceNoData, billdata]);\r\n\r\n  // 10. Initialize empty items for new bills\r\n  useEffect(() => {\r\n    if (!billdata && form.billFormData.items.length === 0) {\r\n      form.addItem();\r\n    }\r\n  }, [billdata, form.billFormData.items.length]);\r\n\r\n  // 11. Auto-set current user as billed_by\r\n  useEffect(() => {\r\n    if (!billdata && billData.userListResult.length && billData.user?._id && !form.billFormData.billed_by) {\r\n      const currentUser = billData.userListResult.find((u: any) => u._id === billData.user?._id);\r\n      if (currentUser && billData.user) {\r\n        form.updateHeader({\r\n          billed_by: billData.user._id,\r\n          billed_by_name: currentUser.name || billData.user.name || '',\r\n        });\r\n      }\r\n    }\r\n  }, [billData.userListResult, billData.user, billdata, form.billFormData.billed_by]);\r\n\r\n  // 12. Update document type from settings\r\n  useEffect(() => {\r\n    if (!billdata && billData.settings?.default_document_type) {\r\n      form.setDocumentType(billData.settings.default_document_type as 'bill' | 'invoice');\r\n    }\r\n  }, [billData.settings, billdata]);\r\n\r\n  // 13. Recalculate items when editing and stock data is loaded\r\n  useEffect(() => {\r\n    if (billdata && form.billFormData.items.length > 0 && \r\n        (billData.branchStockListResult.length > 0 || billData.stockAuditListResult.length > 0)) {\r\n      \r\n      // Check if any item needs stock data populated\r\n      const needsStockData = form.billFormData.items.some(\r\n        (item: any) => item.stock_id && !item.stockData\r\n      );\r\n      \r\n      if (needsStockData) {\r\n        // Recalculate items to populate stockData from stock lists\r\n        const calculatedItems = items.calculateItemAmounts(form.billFormData.items);\r\n        form.updateItems(calculatedItems);\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    billdata?._id, // Trigger when different bill is loaded\r\n    form.billFormData.items.length, \r\n    billData.branchStockListResult.length, \r\n    billData.stockAuditListResult.length\r\n  ]);\r\n\r\n  // Return all necessary data and functions\r\n  return {\r\n    // Data\r\n    billData,\r\n    \r\n    // Form\r\n    form,\r\n    billFormData: form.billFormData,\r\n    billSettings: form.billSettings,\r\n    documentType: form.documentType,\r\n    \r\n    // Calculations\r\n    billCalculations,\r\n    \r\n    // Modals\r\n    modals,\r\n    \r\n    // Actions\r\n    actions,\r\n    \r\n    // Handlers\r\n    handleItemsChange,\r\n    handleQuantityChange,\r\n    handleProductSelect,\r\n    handleStockSelect,\r\n    handlePrint,\r\n    handleDownload,\r\n    \r\n    // Keyboard\r\n    shortcuts,\r\n\r\n    // Options for dropdowns\r\n    // Product options not needed - products loaded in modal on demand\r\n    productOptions: [],\r\n    \r\n    customerOptions: useMemo(() => {\r\n      const options = billData.customerListResult.map((customer: any) => ({\r\n        label: `${customer.full_name} - ${customer.mobile}`,\r\n        value: customer._id,\r\n      }));\r\n\r\n      if (form.billFormData.customer_id && form.billFormData.customer_name) {\r\n        const exists = options.some((opt: { value: string }) => opt.value === form.billFormData.customer_id);\r\n        if (!exists) {\r\n          options.push({\r\n            value: form.billFormData.customer_id,\r\n            label: form.billFormData.customer_name,\r\n          });\r\n        }\r\n      }\r\n\r\n      return options;\r\n    }, [\r\n      billData.customerListResult,\r\n      form.billFormData.customer_id,\r\n      form.billFormData.customer_name,\r\n    ]),\r\n    \r\n    userOptions: useMemo(() => {\r\n      const options = billData.userListResult.map((user: any) => ({\r\n        label: `${user.name} (${user.roleItems?.name || 'No Role'})`,\r\n        value: user._id,\r\n      }));\r\n\r\n      if (form.billFormData.billed_by && form.billFormData.billed_by_name) {\r\n        const exists = options.some((opt: { value: string }) => opt.value === form.billFormData.billed_by);\r\n        if (!exists) {\r\n          options.push({\r\n            value: form.billFormData.billed_by,\r\n            label: form.billFormData.billed_by_name,\r\n          });\r\n        }\r\n      }\r\n\r\n      return options;\r\n    }, [\r\n      billData.userListResult,\r\n      form.billFormData.billed_by,\r\n      form.billFormData.billed_by_name,\r\n    ]),\r\n  };\r\n};\r\n\r\n","import { useMemo } from 'react';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport { useGenericCrudRTK } from '../../../hooks/useGenericCrudRTK';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\n/**\r\n * Hook to manage all data fetching for the bill\r\n * Centralizes all RTK Query hooks and data extraction\r\n */\r\nexport const useBillData = (billdata?: any) => {\r\n  const user = getCurrentUser();\r\n  const branchId = user?.branch_id;\r\n  const organisationId = user?.organisation_id || user?.organisationItems?._id;\r\n\r\n  // RTK Query API hooks\r\n  const SalesRecord = useGenericCrudRTK('SalesRecord');\r\n  const InvoiceNumberApi = useGenericCrudRTK('InvoiceNumber');\r\n\r\n  // Skip products - will load when modal opens (like Customer/Vendor/User)\r\n  // Selected product data will be stored in bill items for calculations\r\n  const {\r\n    data: productListData,\r\n    isLoading: productLoading,\r\n    refetch: refetchProducts,\r\n  } = apiSlice.useGetProductQuery({}, { skip: true });\r\n\r\n  const {\r\n    data: customerListData,\r\n    isLoading: customerLoading,\r\n    refetch: refetchCustomers,\r\n  } = apiSlice.useGetCustomerQuery({}, { skip: true });\r\n\r\n  const {\r\n    data: vendorListData,\r\n    isLoading: vendorLoading,\r\n    refetch: refetchVendors,\r\n  } = apiSlice.useGetVendorQuery({}, { skip: true });\r\n\r\n  const {\r\n    data: userListData,\r\n    isLoading: userLoading,\r\n    refetch: refetchUsers,\r\n  } = apiSlice.useGetBillingUsersQuery({}, { skip: true });\r\n\r\n  // Stock APIs - conditional based on branch\r\n  const shouldFetchStockAudit = !branchId && !!billdata;\r\n  const {\r\n    data: stockAuditListData,\r\n    isLoading: stockLoading,\r\n    refetch: refetchStockAudit,\r\n  } = apiSlice.useGetStockAuditQuery({}, { skip: !shouldFetchStockAudit });\r\n\r\n  const {\r\n    data: branchStockListData,\r\n    isLoading: branchStockLoading,\r\n    refetch: refetchBranchStock,\r\n  } = apiSlice.useGetBranchStockQuery({}, { skip: !branchId });\r\n\r\n  const { data: invoiceNoData, refetch: refetchInvoiceNo } =\r\n    InvoiceNumberApi.useGetAll();\r\n\r\n  // Fetch organization data\r\n  const { data: organisationsData } = apiSlice.useGetOrganisationsQuery(\r\n    { organisation_id: organisationId },\r\n    { skip: !organisationId }\r\n  );\r\n\r\n  // Fetch settings\r\n  const { data: settingsData } = apiSlice.useGetSettingsQuery(\r\n    { organisation_id: organisationId, pageNumber: 1, pageLimit: 1 },\r\n    { skip: !organisationId, refetchOnMountOrArgChange: false }\r\n  );\r\n\r\n  // Extract results from API responses\r\n  const productListResult = useMemo(\r\n    () => (Array.isArray((productListData as any)?.result) ? (productListData as any).result : []),\r\n    [productListData]\r\n  );\r\n\r\n  const customerListResult = useMemo(\r\n    () => (Array.isArray((customerListData as any)?.result) ? (customerListData as any).result : []),\r\n    [customerListData]\r\n  );\r\n\r\n  const vendorListResult = useMemo(\r\n    () => (Array.isArray((vendorListData as any)?.result) ? (vendorListData as any).result : []),\r\n    [vendorListData]\r\n  );\r\n\r\n  const userListResult = useMemo(\r\n    () => (Array.isArray((userListData as any)?.result) ? (userListData as any).result : []),\r\n    [userListData]\r\n  );\r\n\r\n  const stockAuditListResult = useMemo(\r\n    () => (Array.isArray((stockAuditListData as any)?.result) ? (stockAuditListData as any).result : []),\r\n    [stockAuditListData]\r\n  );\r\n\r\n  const branchStockListResult = useMemo(\r\n    () => (Array.isArray((branchStockListData as any)?.result) ? (branchStockListData as any).result : []),\r\n    [branchStockListData]\r\n  );\r\n\r\n  const organisationDetails = useMemo(() => {\r\n    const result = (organisationsData as any)?.result;\r\n    if (Array.isArray(result)) return result[0];\r\n    return result || user?.organisationItems || {};\r\n  }, [organisationsData, user]);\r\n\r\n  const branchDetails = useMemo(() => user?.branchItems || {}, [user]);\r\n\r\n  const settings = useMemo(() => {\r\n    const settingsResult = (settingsData as any)?.result || settingsData || {};\r\n    return Array.isArray(settingsResult) ? settingsResult[0] : settingsResult;\r\n  }, [settingsData]);\r\n\r\n  // Mutations\r\n  const { create: createSalesRecord, isLoading: saleCreateLoading } =\r\n    SalesRecord.useCreate();\r\n  const { update: updateSalesRecord, isLoading: saleUpdateLoading } =\r\n    SalesRecord.useUpdate();\r\n  const { create: createInvoiceNumber, isLoading: invoice_no_create_loading } =\r\n    InvoiceNumberApi.useCreate();\r\n\r\n  // Refetch all data\r\n  const refetchAllData = () => {\r\n    refetchProducts();\r\n    refetchCustomers();\r\n    refetchVendors();\r\n    refetchUsers();\r\n    if (branchId) {\r\n      refetchBranchStock();\r\n    } else if (shouldFetchStockAudit) {\r\n      refetchStockAudit();\r\n    }\r\n  };\r\n\r\n  return {\r\n    // User & Organization\r\n    user,\r\n    branchId,\r\n    organisationId,\r\n    organisationDetails,\r\n    branchDetails,\r\n    settings,\r\n\r\n    // Lists\r\n    productListResult,\r\n    customerListResult,\r\n    vendorListResult,\r\n    userListResult,\r\n    stockAuditListResult,\r\n    branchStockListResult,\r\n\r\n    // Loading states\r\n    productLoading,\r\n    customerLoading,\r\n    vendorLoading,\r\n    userLoading,\r\n    stockLoading,\r\n    branchStockLoading,\r\n    saleCreateLoading,\r\n    saleUpdateLoading,\r\n    invoice_no_create_loading,\r\n\r\n    // Mutations\r\n    createSalesRecord,\r\n    updateSalesRecord,\r\n    createInvoiceNumber,\r\n\r\n    // Refetch functions\r\n    refetchProducts,\r\n    refetchCustomers,\r\n    refetchVendors,\r\n    refetchUsers,\r\n    refetchStockAudit,\r\n    refetchBranchStock,\r\n    refetchInvoiceNo,\r\n    refetchAllData,\r\n\r\n    // Invoice number\r\n    invoiceNoData,\r\n  };\r\n};\r\n\r\n","import { useState, useCallback } from 'react';\r\nimport dayjs from 'dayjs';\r\nimport { BillFormData, BillItem } from '../../../types/entities';\r\n\r\ninterface BillSettings {\r\n  isPaid: boolean;\r\n  isPartiallyPaid: boolean;\r\n  isRetail: boolean;\r\n  isGstIncluded: boolean;\r\n  discount: number;\r\n  discountType: 'percentage' | 'amount';\r\n  paidAmount: number;\r\n}\r\n\r\n/**\r\n * Hook to manage bill form state and settings\r\n */\r\nexport const useBillForm = () => {\r\n  const [billFormData, setBillFormData] = useState<BillFormData>({\r\n    invoice_no: '',\r\n    date: dayjs().format('YYYY-MM-DD'),\r\n    customer_id: '',\r\n    customer_name: '',\r\n    billed_by: '',\r\n    billed_by_name: '',\r\n    payment_mode: 'cash',\r\n    items: [],\r\n  });\r\n\r\n  const [billSettings, setBillSettings] = useState<BillSettings>({\r\n    isPaid: true,\r\n    isPartiallyPaid: false,\r\n    isRetail: true,\r\n    isGstIncluded: true,\r\n    discount: 0,\r\n    discountType: 'percentage',\r\n    paidAmount: 0,\r\n  });\r\n\r\n  const [documentType, setDocumentType] = useState<'bill' | 'invoice'>('bill');\r\n\r\n  // Update header fields\r\n  const updateHeader = useCallback((updates: Partial<BillFormData>) => {\r\n    setBillFormData(prev => ({ ...prev, ...updates }));\r\n  }, []);\r\n\r\n  // Update items\r\n  const updateItems = useCallback((items: BillItem[]) => {\r\n    setBillFormData(prev => ({ ...prev, items }));\r\n  }, []);\r\n\r\n  // Add item\r\n  const addItem = useCallback(() => {\r\n    const newItem: BillItem = {\r\n      product_id: '',\r\n      product_name: '',\r\n      variant_name: '',\r\n      stock_id: '',\r\n      batch_no: '',\r\n      qty: 0,\r\n      loose_qty: 0,\r\n      price: 0,\r\n      mrp: 0,\r\n      amount: 0,\r\n      tax_percentage: 0,\r\n    };\r\n    setBillFormData(prev => ({ ...prev, items: [...prev.items, newItem] }));\r\n  }, []);\r\n\r\n  // Delete items\r\n  const deleteItems = useCallback((indices: number[]) => {\r\n    setBillFormData(prev => ({\r\n      ...prev,\r\n      items: prev.items.filter((_, index) => !indices.includes(index)),\r\n    }));\r\n  }, []);\r\n\r\n  // Update settings\r\n  const updateSettings = useCallback((updates: Partial<BillSettings>) => {\r\n    setBillSettings(prev => ({ ...prev, ...updates }));\r\n  }, []);\r\n\r\n  // Reset form\r\n  const resetForm = useCallback(() => {\r\n    setBillFormData({\r\n      invoice_no: '',\r\n      date: dayjs().format('YYYY-MM-DD'),\r\n      customer_id: '',\r\n      customer_name: '',\r\n      billed_by: '',\r\n      billed_by_name: '',\r\n      payment_mode: 'cash',\r\n      items: [\r\n        {\r\n          product_id: '',\r\n          product_name: '',\r\n          variant_name: '',\r\n          stock_id: '',\r\n          batch_no: '',\r\n          qty: 0,\r\n          loose_qty: 0,\r\n          price: 0,\r\n          mrp: 0,\r\n          amount: 0,\r\n          tax_percentage: 0,\r\n        },\r\n      ],\r\n    });\r\n\r\n    setBillSettings({\r\n      isPaid: true,\r\n      isPartiallyPaid: false,\r\n      isRetail: true,\r\n      isGstIncluded: true,\r\n      discount: 0,\r\n      discountType: 'percentage',\r\n      paidAmount: 0,\r\n    });\r\n\r\n    setDocumentType('bill');\r\n  }, []);\r\n\r\n  // Load bill data (for editing)\r\n  const loadBillData = useCallback((billdata: any, onLoadComplete?: () => void) => {\r\n    // Always use customerDetails for both bills and invoices\r\n    const partyDetails = billdata.customerDetails;\r\n    const partyId = billdata.customer_id;\r\n    const partyName =\r\n      partyDetails?.full_name || partyDetails?.name || '';\r\n\r\n    setBillFormData({\r\n      invoice_no: billdata.invoice_no,\r\n      date: dayjs(billdata.date).format('YYYY-MM-DD'),\r\n      customer_id: partyId,\r\n      customer_name: partyName,\r\n      billed_by: billdata.billed_by || '',\r\n      billed_by_name: billdata.billedByDetails?.name || '',\r\n      payment_mode: billdata.payment_mode,\r\n      items:\r\n        billdata.Items?.map((item: any) => ({\r\n          _id: item._id,\r\n          product_id: item.product_id,\r\n          product_name: item.productItems?.name || item.product_name || '',\r\n          variant_name: item.productItems?.VariantItem?.variant_name || '',\r\n          stock_id: item.stock_id || item.branch_stock_id,\r\n          batch_no: item.batch_no || '',\r\n          qty: item.qty || 0,\r\n          loose_qty: item.loose_qty || 0,\r\n          price: item.price,\r\n          mrp: item.mrp || item.price,\r\n          amount: item.amount,\r\n          tax_percentage: item.tax_percentage || item.productItems?.CategoryItem?.tax_percentage || item.productItems?.tax_percentage || 0,\r\n          hsn_code: item.hsn_code || item.productItems?.hsn_code || item.productItems?.VariantItem?.hsn_code || '',\r\n          hsn_sac: item.hsn_sac || item.productItems?.hsn_sac || '',\r\n          discount: item.discount || 0,\r\n          description: item.description || '',\r\n          category_name: item.productItems?.CategoryItem?.category_name || '',\r\n        })) || [],\r\n    });\r\n\r\n    setBillSettings({\r\n      isPaid: billdata.is_paid ?? true,\r\n      isPartiallyPaid: billdata.is_partially_paid ?? false,\r\n      isRetail: billdata.sale_type === 'retail',\r\n      isGstIncluded: billdata.is_gst_included ?? true,\r\n      discount: billdata.discount ?? 0,\r\n      discountType: billdata.discount_type ?? 'percentage',\r\n      paidAmount: billdata.paid_amount ?? 0,\r\n    });\r\n\r\n    setDocumentType(billdata.document_type || 'bill');\r\n    \r\n    // Trigger callback after data is loaded\r\n    if (onLoadComplete) {\r\n      setTimeout(() => onLoadComplete(), 0);\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    billFormData,\r\n    billSettings,\r\n    documentType,\r\n    setBillFormData,\r\n    setBillSettings,\r\n    setDocumentType,\r\n    updateHeader,\r\n    updateItems,\r\n    addItem,\r\n    deleteItems,\r\n    updateSettings,\r\n    resetForm,\r\n    loadBillData,\r\n  };\r\n};\r\n\r\n","import { useState, useCallback } from 'react';\r\n\r\n/**\r\n * Hook to manage all modal states\r\n * Centralizes modal visibility and related state\r\n */\r\nexport const useBillModals = () => {\r\n  const [stockModalRowIndex, setStockModalRowIndex] = useState<number | null>(null);\r\n  const [customerModalVisible, setCustomerModalVisible] = useState(false);\r\n  const [userModalVisible, setUserModalVisible] = useState(false);\r\n  const [saveConfirmationVisible, setSaveConfirmationVisible] = useState(false);\r\n  const [billListDrawerVisible, setBillListDrawerVisible] = useState(false);\r\n  const [productDetailsModalVisible, setProductDetailsModalVisible] = useState(false);\r\n  const [productSelectionModalVisible, setProductSelectionModalVisible] = useState(false);\r\n  const [productSelectionRowIndex, setProductSelectionRowIndex] = useState<number | null>(null);\r\n  const [selectedProductId, setSelectedProductId] = useState<string>('');\r\n  const [lastInteractedRowIndex, setLastInteractedRowIndex] = useState<number>(0);\r\n  const [externalEditingCell, setExternalEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n\r\n  // Open stock modal for specific row\r\n  const openStockModal = useCallback((rowIndex: number) => {\r\n    setStockModalRowIndex(rowIndex);\r\n  }, []);\r\n\r\n  // Close stock modal\r\n  const closeStockModal = useCallback(() => {\r\n    setStockModalRowIndex(null);\r\n  }, []);\r\n\r\n  // Open customer modal\r\n  const openCustomerModal = useCallback(() => {\r\n    setCustomerModalVisible(true);\r\n  }, []);\r\n\r\n  // Close customer modal\r\n  const closeCustomerModal = useCallback(() => {\r\n    setCustomerModalVisible(false);\r\n  }, []);\r\n\r\n  // Open user modal\r\n  const openUserModal = useCallback(() => {\r\n    setUserModalVisible(true);\r\n  }, []);\r\n\r\n  // Close user modal\r\n  const closeUserModal = useCallback(() => {\r\n    setUserModalVisible(false);\r\n  }, []);\r\n\r\n  // Open product selection modal\r\n  const openProductSelectionModal = useCallback((rowIndex: number) => {\r\n    setProductSelectionRowIndex(rowIndex);\r\n    setProductSelectionModalVisible(true);\r\n    setLastInteractedRowIndex(rowIndex);\r\n  }, []);\r\n\r\n  // Close product selection modal\r\n  const closeProductSelectionModal = useCallback(() => {\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n  }, []);\r\n\r\n  // Open bill list drawer\r\n  const openBillListDrawer = useCallback(() => {\r\n    setBillListDrawerVisible(true);\r\n  }, []);\r\n\r\n  // Close bill list drawer\r\n  const closeBillListDrawer = useCallback(() => {\r\n    setBillListDrawerVisible(false);\r\n  }, []);\r\n\r\n  // Open save confirmation\r\n  const openSaveConfirmation = useCallback(() => {\r\n    setSaveConfirmationVisible(true);\r\n  }, []);\r\n\r\n  // Close save confirmation\r\n  const closeSaveConfirmation = useCallback(() => {\r\n    setSaveConfirmationVisible(false);\r\n  }, []);\r\n\r\n  // Open product details modal\r\n  const openProductDetailsModal = useCallback((productId: string) => {\r\n    setSelectedProductId(productId);\r\n    setProductDetailsModalVisible(true);\r\n  }, []);\r\n\r\n  // Close product details modal\r\n  const closeProductDetailsModal = useCallback(() => {\r\n    setProductDetailsModalVisible(false);\r\n    setSelectedProductId('');\r\n  }, []);\r\n\r\n  // Close all modals\r\n  const closeAllModals = useCallback(() => {\r\n    setStockModalRowIndex(null);\r\n    setCustomerModalVisible(false);\r\n    setUserModalVisible(false);\r\n    setSaveConfirmationVisible(false);\r\n    setBillListDrawerVisible(false);\r\n    setProductDetailsModalVisible(false);\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n    setSelectedProductId('');\r\n    setExternalEditingCell(null);\r\n  }, []);\r\n\r\n  return {\r\n    // States\r\n    stockModalRowIndex,\r\n    customerModalVisible,\r\n    userModalVisible,\r\n    saveConfirmationVisible,\r\n    billListDrawerVisible,\r\n    productDetailsModalVisible,\r\n    productSelectionModalVisible,\r\n    productSelectionRowIndex,\r\n    selectedProductId,\r\n    lastInteractedRowIndex,\r\n    externalEditingCell,\r\n\r\n    // Setters\r\n    setStockModalRowIndex,\r\n    setCustomerModalVisible,\r\n    setUserModalVisible,\r\n    setSaveConfirmationVisible,\r\n    setBillListDrawerVisible,\r\n    setProductDetailsModalVisible,\r\n    setProductSelectionModalVisible,\r\n    setProductSelectionRowIndex,\r\n    setSelectedProductId,\r\n    setLastInteractedRowIndex,\r\n    setExternalEditingCell,\r\n\r\n    // Actions\r\n    openStockModal,\r\n    closeStockModal,\r\n    openCustomerModal,\r\n    closeCustomerModal,\r\n    openUserModal,\r\n    closeUserModal,\r\n    openProductSelectionModal,\r\n    closeProductSelectionModal,\r\n    openBillListDrawer,\r\n    closeBillListDrawer,\r\n    openSaveConfirmation,\r\n    closeSaveConfirmation,\r\n    openProductDetailsModal,\r\n    closeProductDetailsModal,\r\n    closeAllModals,\r\n  };\r\n};\r\n\r\n","import { useCallback } from 'react';\r\nimport { message } from 'antd';\r\nimport { BillItem } from '../../../types/entities';\r\n\r\ninterface UseBillItemsProps {\r\n  productOptions: Array<{ label: string; value: string }>;\r\n  branchId: string | undefined;\r\n  branchStockListResult: any[];\r\n  stockAuditListResult: any[];\r\n  billSettings: {\r\n    isGstIncluded: boolean;\r\n  };\r\n}\r\n\r\nexport const useBillItems = ({\r\n  productOptions,\r\n  branchId,\r\n  branchStockListResult,\r\n  stockAuditListResult,\r\n  billSettings,\r\n}: UseBillItemsProps) => {\r\n  // Calculate item amounts with proper price and tax\r\n  const calculateItemAmounts = useCallback(\r\n    (items: BillItem[]) => {\r\n      return items.map(item => {\r\n        // If no product selected at all, return as is\r\n        if (!item.product_id) return item;\r\n\r\n        // If product selected but no stock yet, preserve product data\r\n        if (!item.stock_id) {\r\n          return {\r\n            ...item,\r\n            // Preserve product/variant names and tax even without stock\r\n            product_name: item.product_name || '',\r\n            variant_name: item.variant_name || '',\r\n            tax_percentage: item.tax_percentage || 0,\r\n            category_name: item.category_name || '',\r\n          };\r\n        }\r\n\r\n        // First try to use saved stockData (for new bills where stock list isn't loaded)\r\n        const savedStockData = (item as any).stockData;\r\n        \r\n        // If no saved stockData, try to find from stockListData (for editing existing bills)\r\n        const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n        const stockFromList = stockListData.find((s: any) => s._id === item.stock_id);\r\n        \r\n        // Use saved stock data if available, otherwise use stock from list\r\n        const stock = savedStockData || stockFromList;\r\n\r\n        if (stock) {\r\n          const sellPrice = stock.sell_price || 0;\r\n          \r\n          // Get pack size from stock data\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size || stock?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n          // Calculate loose item rate: sell_price / pack_size (since sell_price is per pack)\r\n          const looseRate = sellPrice / packSizeNum;\r\n\r\n          const baseAmount = (item.qty || 0) * sellPrice + (item.loose_qty || 0) * looseRate;\r\n\r\n          // Use tax_percentage from bill item (stored when product was selected)\r\n          // No need to lookup product - all data already in item\r\n          const taxPercentage = item.tax_percentage || 0;\r\n\r\n          let amount = baseAmount;\r\n          if (!billSettings.isGstIncluded) {\r\n            amount = baseAmount + (baseAmount * taxPercentage) / 100;\r\n          }\r\n\r\n          // Ensure batch_no is properly extracted from stockData\r\n          const batchNo = stock.batch_no || item.batch_no || '';\r\n\r\n          return {\r\n            ...item,\r\n            price: item.price || sellPrice,\r\n            mrp: stock.mrp || sellPrice,\r\n            amount: amount,\r\n            tax_percentage: taxPercentage,\r\n            // Keep product/variant names from item (already stored when selected)\r\n            product_name: item.product_name || '',\r\n            variant_name: item.variant_name || '',\r\n            category_name: item.category_name || '',\r\n            batch_no: batchNo,\r\n            stockData: {\r\n              ...stock,\r\n              batch_no: batchNo, // Ensure stockData also has batch_no\r\n            }, // Attach stock data for UI display\r\n          };\r\n        }\r\n\r\n        return item;\r\n      });\r\n    },\r\n    [branchId, branchStockListResult, stockAuditListResult, billSettings]\r\n  );\r\n\r\n  // Validate stock quantities\r\n  const validateStockQuantities = useCallback(\r\n    (items: BillItem[]) => {\r\n      return items.map(item => {\r\n        // Extract batch_no from item or stockData\r\n        const itemStockData = (item as any).stockData;\r\n        const batchNo = item.batch_no || itemStockData?.batch_no || '';\r\n        \r\n        const billItem: BillItem = {\r\n          product_id: item.product_id || '',\r\n          product_name: item.product_name || '',\r\n          variant_name: item.variant_name || '',\r\n          stock_id: item.stock_id || '',\r\n          batch_no: batchNo,\r\n          qty: item.qty || 0,\r\n          loose_qty: item.loose_qty || 0,\r\n          price: item.price || 0,\r\n          mrp: item.mrp || 0,\r\n          amount: item.amount || 0,\r\n          tax_percentage: item.tax_percentage || 0,\r\n          category_name: item.category_name || '',\r\n          stockData: itemStockData,\r\n        };\r\n\r\n        // Stock validation for pack and loose quantities\r\n        if (item.stock_id && (item.qty || item.loose_qty)) {\r\n          const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n          const stock = stockListData.find((s: any) => s._id === item.stock_id);\r\n\r\n          if (stock) {\r\n            // Get pack size from stock data\r\n            const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n            const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n            // Available pack quantity and actual loose quantity\r\n            const availablePackQty = stock.available_quantity || 0;\r\n            const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n            // Validate pack quantity (QTY field)\r\n            if (item.qty && item.qty > availablePackQty) {\r\n              message.error(\r\n                `Pack quantity (${item.qty}) exceeds available packs (${availablePackQty})`\r\n              );\r\n              billItem.qty = availablePackQty;\r\n            }\r\n\r\n            // Calculate max loose quantity based on remaining packs after QTY selection\r\n            const remainingPacks = availablePackQty - (item.qty || 0);\r\n            const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n            const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n            // Validate loose quantity (LOOSE QTY field)\r\n            if (item.loose_qty && item.loose_qty > maxLooseQty) {\r\n              message.error(\r\n                `Loose quantity (${item.loose_qty}) exceeds available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`\r\n              );\r\n              billItem.loose_qty = maxLooseQty;\r\n            }\r\n          }\r\n        }\r\n\r\n        return billItem;\r\n      });\r\n    },\r\n    [branchId, branchStockListResult, stockAuditListResult]\r\n  );\r\n\r\n  const handleItemsChange = useCallback(\r\n    (items: any[]): BillItem[] => {\r\n      // First validate stock quantities\r\n      const validatedItems = validateStockQuantities(items);\r\n\r\n      // Then calculate amounts\r\n      const itemsWithAmounts = calculateItemAmounts(validatedItems);\r\n\r\n      return itemsWithAmounts;\r\n    },\r\n    [validateStockQuantities, calculateItemAmounts]\r\n  );\r\n\r\n  return {\r\n    handleItemsChange,\r\n    calculateItemAmounts,\r\n    validateStockQuantities,\r\n  };\r\n};\r\n\r\n","import { useState, useCallback } from 'react';\r\nimport { message } from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport { useDispatch } from 'react-redux';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\ninterface BillActionsConfig {\r\n  billFormData: any;\r\n  billSettings: any;\r\n  billCalculations: any;\r\n  documentType: 'bill' | 'invoice';\r\n  branchId?: string;\r\n  createSalesRecord: any;\r\n  updateSalesRecord: any;\r\n  createInvoiceNumber: any;\r\n  billdata?: any;\r\n  onSuccess?: () => void;\r\n  onSaveSuccess?: (savedData: any) => void;\r\n}\r\n\r\n/**\r\n * Hook to handle all bill actions: save, print, clear\r\n * Manages save draft, complete bill, print operations\r\n */\r\nexport const useBillActions = (config: BillActionsConfig) => {\r\n  const dispatch = useDispatch();\r\n  const [savedBillData, setSavedBillData] = useState<any>(null);\r\n  const [createResponse, setCreateResponse] = useState<any>(null);\r\n  const [updateResponse, setUpdateResponse] = useState<any>(null);\r\n\r\n  // Validate stock quantities\r\n  const validateStockQuantities = useCallback((items: any[]) => {\r\n    const errors: string[] = [];\r\n    // Add your validation logic here\r\n    return errors;\r\n  }, []);\r\n\r\n  // Save draft (minimal validation)\r\n  const handleSaveDraft = useCallback(async () => {\r\n    if (!config.billFormData.invoice_no) {\r\n      message.error('Please enter an invoice number');\r\n      return false;\r\n    }\r\n\r\n    if (!config.billFormData.items || config.billFormData.items.length === 0) {\r\n      message.error('Please add at least one product/item to save as draft');\r\n      return false;\r\n    }\r\n\r\n    const validItems = config.billFormData.items.filter((item: any) => item.product_id);\r\n    if (validItems.length === 0) {\r\n      message.error('Please add at least one product/item to save as draft');\r\n      return false;\r\n    }\r\n\r\n    const payload = {\r\n      invoice_no: config.billFormData.invoice_no,\r\n      date: config.billFormData.date || dayjs().format('YYYY-MM-DD'),\r\n      customer_id: config.billFormData.customer_id || null,\r\n      billed_by: config.billFormData.billed_by || null,\r\n      payment_mode: config.billFormData.payment_mode || 'cash',\r\n      items: config.billFormData.items.map((item: any) => ({\r\n        product_id: item.product_id || null,\r\n        stock_id: item.stock_id || null,\r\n        ...(config.branchId && item.stock_id && { branch_stock_id: item.stock_id }),\r\n        qty: item.qty || 0,\r\n        loose_qty: item.loose_qty || 0,\r\n        price: item.price || 0,\r\n        mrp: item.mrp || 0,\r\n        amount: item.amount || 0,\r\n        tax_percentage: item.tax_percentage || 0,\r\n        _id: item._id,\r\n      })),\r\n      ...config.billCalculations,\r\n      discount: config.billSettings.discount,\r\n      discount_type: config.billSettings.discountType,\r\n      is_paid: config.billSettings.isPaid,\r\n      is_partially_paid: config.billSettings.isPartiallyPaid,\r\n      sale_type: config.billSettings.isRetail ? 'retail' : 'wholesale',\r\n      is_gst_included: config.billSettings.isGstIncluded,\r\n      paid_amount: config.billSettings.isPartiallyPaid\r\n        ? config.billSettings.paidAmount\r\n        : config.billSettings.isPaid\r\n          ? config.billCalculations.total_amount\r\n          : 0,\r\n      status: 'draft',\r\n      document_type: config.documentType,\r\n    };\r\n\r\n    try {\r\n      let response: any;\r\n      if (config.billdata) {\r\n        const result = await config.updateSalesRecord(config.billdata._id, payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setUpdateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      } else {\r\n        const result = await config.createSalesRecord(payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setCreateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      }\r\n\r\n      if (response?.statusCode === 200) {\r\n        message.success('Draft saved successfully!');\r\n        const savedData = {\r\n          ...payload,\r\n          customer_name: config.billFormData.customer_name,\r\n          total_amount: config.billCalculations.total_amount,\r\n        };\r\n        setSavedBillData(savedData);\r\n        config.onSaveSuccess?.(savedData);\r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error: any) {\r\n      // Check if it's a plan limit error\r\n      if (error?.data?.exception === 'PLAN_LIMIT_REACHED' || error?.data?.statusCode === 403) {\r\n        const meta = error?.data?.meta;\r\n        const errorMessage = error?.data?.message || 'You have reached the maximum limit for your plan.';\r\n        \r\n        if (meta) {\r\n          const detailedMessage = `${errorMessage}\\n\\nCurrent Usage: ${meta.current_count} / ${meta.max_limit} ${meta.resource_type}\\nPlan: ${meta.plan_type?.toUpperCase()}\\nUsage: ${meta.usage_percentage}%`;\r\n          message.error(detailedMessage, 8);\r\n        } else {\r\n          message.error(errorMessage, 8);\r\n        }\r\n      } else {\r\n        message.error('Failed to save draft. Please try again.');\r\n      }\r\n      return false;\r\n    }\r\n  }, [config, dispatch]);\r\n\r\n  // Complete bill (full validation)\r\n  const handleCompleteBill = useCallback(async () => {\r\n    if (\r\n      !config.billFormData.invoice_no ||\r\n      !config.billFormData.customer_id ||\r\n      !config.billFormData.items.length\r\n    ) {\r\n      message.error('Please fill all required fields');\r\n      return false;\r\n    }\r\n\r\n    const incompleteItems = config.billFormData.items.some(\r\n      (item: any) =>\r\n        !item.product_id || !item.stock_id || (!item.qty && !item.loose_qty) || !item.price\r\n    );\r\n\r\n    if (incompleteItems) {\r\n      message.error('Please complete all item details');\r\n      return false;\r\n    }\r\n\r\n    const stockValidationErrors = validateStockQuantities(config.billFormData.items);\r\n    if (stockValidationErrors.length > 0) {\r\n      message.error(`Stock validation errors:\\n${stockValidationErrors.join('\\n')}`);\r\n      return false;\r\n    }\r\n\r\n    const payload = {\r\n      invoice_no: config.billFormData.invoice_no,\r\n      date: config.billFormData.date,\r\n      customer_id: config.billFormData.customer_id,\r\n      billed_by: config.billFormData.billed_by,\r\n      payment_mode: config.billFormData.payment_mode,\r\n      items: config.billFormData.items.map((item: any) => ({\r\n        product_id: item.product_id,\r\n        stock_id: item.stock_id,\r\n        ...(config.branchId && { branch_stock_id: item.stock_id }),\r\n        qty: item.qty,\r\n        loose_qty: item.loose_qty,\r\n        price: item.price,\r\n        mrp: item.mrp,\r\n        amount: item.amount,\r\n        tax_percentage: item.tax_percentage,\r\n        hsn_code: item.hsn_code || '',\r\n        hsn_sac: item.hsn_sac || '',\r\n        discount: item.discount || 0,\r\n        description: item.description || '',\r\n        product_name: item.product_name || '',\r\n        variant_name: item.variant_name || '',\r\n        _id: item._id,\r\n      })),\r\n      ...config.billCalculations,\r\n      discount: config.billSettings.discount,\r\n      discount_type: config.billSettings.discountType,\r\n      is_paid: config.billSettings.isPaid,\r\n      is_partially_paid: config.billSettings.isPartiallyPaid,\r\n      sale_type: config.billSettings.isRetail ? 'retail' : 'wholesale',\r\n      is_gst_included: config.billSettings.isGstIncluded,\r\n      paid_amount: config.billSettings.isPartiallyPaid\r\n        ? config.billSettings.paidAmount\r\n        : config.billSettings.isPaid\r\n          ? config.billCalculations.total_amount\r\n          : 0,\r\n      status: 'completed',\r\n      document_type: config.documentType,\r\n    };\r\n\r\n    try {\r\n      let response: any;\r\n      if (config.billdata) {\r\n        const result = await config.updateSalesRecord(config.billdata._id, payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setUpdateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      } else {\r\n        const result = await config.createSalesRecord(payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setCreateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      }\r\n\r\n      if (response?.statusCode === 200) {\r\n        const savedData = {\r\n          ...payload,\r\n          customer_name: config.billFormData.customer_name,\r\n          total_amount: config.billCalculations.total_amount,\r\n        };\r\n        setSavedBillData(savedData);\r\n\r\n        // Invalidate stock caches\r\n        dispatch(apiSlice.util.invalidateTags(['StockAudit', 'BranchStock']));\r\n\r\n        config.onSaveSuccess?.(savedData);\r\n        \r\n        // Create new invoice number for next bill\r\n        if (!config.billdata) {\r\n          config.createInvoiceNumber({});\r\n        }\r\n        \r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error: any) {\r\n      // Check if it's a plan limit error\r\n      if (error?.data?.exception === 'PLAN_LIMIT_REACHED' || error?.data?.statusCode === 403) {\r\n        const meta = error?.data?.meta;\r\n        const errorMessage = error?.data?.message || 'You have reached the maximum limit for your plan.';\r\n        \r\n        if (meta) {\r\n          const detailedMessage = `${errorMessage}\\n\\nCurrent Usage: ${meta.current_count} / ${meta.max_limit} ${meta.resource_type}\\nPlan: ${meta.plan_type?.toUpperCase()}\\nUsage: ${meta.usage_percentage}%`;\r\n          message.error(detailedMessage, 8);\r\n        } else {\r\n          message.error(errorMessage, 8);\r\n        }\r\n      } else {\r\n        message.error('Failed to complete bill. Please try again.');\r\n      }\r\n      return false;\r\n    }\r\n  }, [config, validateStockQuantities, dispatch]);\r\n\r\n  return {\r\n    savedBillData,\r\n    createResponse,\r\n    updateResponse,\r\n    handleSaveDraft,\r\n    handleCompleteBill,\r\n    setSavedBillData,\r\n    setCreateResponse,\r\n    setUpdateResponse,\r\n  };\r\n};\r\n\r\n","import { useEffect } from 'react';\r\nimport { message } from 'antd';\r\n\r\ninterface KeyboardShortcutsConfig {\r\n  onF1AddItem: () => void;\r\n  onF2SaveDraft: () => void;\r\n  onF3CompleteBill: () => void;\r\n  onF4Clear: () => void;\r\n  onF5ProductSelection: () => void;\r\n  onF6BillList: () => void;\r\n  onF7StockSelection: () => void;\r\n  onF8Print: () => void;\r\n  onEndCustomer: () => void;\r\n  onCtrlU: () => void;\r\n  onCtrlS: () => void;\r\n  onCtrlN: () => void;\r\n  onCtrlP: () => void;\r\n  onCtrlR: () => void;\r\n}\r\n\r\n/**\r\n * Hook to manage keyboard shortcuts for the bill\r\n * Ultra-fast billing with keyboard-first interface\r\n */\r\nexport const useBillKeyboardShortcuts = (config: KeyboardShortcutsConfig) => {\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // Function keys\r\n      if (e.key === 'F1') {\r\n        e.preventDefault();\r\n        config.onF1AddItem();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F2') {\r\n        e.preventDefault();\r\n        config.onF2SaveDraft();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F3') {\r\n        e.preventDefault();\r\n        config.onF3CompleteBill();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F4') {\r\n        e.preventDefault();\r\n        config.onF4Clear();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F5') {\r\n        e.preventDefault();\r\n        config.onF5ProductSelection();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F6') {\r\n        e.preventDefault();\r\n        config.onF6BillList();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F7') {\r\n        e.preventDefault();\r\n        config.onF7StockSelection();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F8') {\r\n        e.preventDefault();\r\n        config.onF8Print();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'End') {\r\n        e.preventDefault();\r\n        config.onEndCustomer();\r\n        return;\r\n      }\r\n\r\n      // Ctrl key combinations\r\n      if (e.ctrlKey) {\r\n        switch (e.key) {\r\n          case 's':\r\n            e.preventDefault();\r\n            config.onCtrlS();\r\n            break;\r\n          case 'n':\r\n            e.preventDefault();\r\n            config.onCtrlN();\r\n            break;\r\n          case 'p':\r\n            e.preventDefault();\r\n            config.onCtrlP();\r\n            break;\r\n          case 'r':\r\n            e.preventDefault();\r\n            config.onCtrlR();\r\n            break;\r\n          case 'u':\r\n            e.preventDefault();\r\n            config.onCtrlU();\r\n            break;\r\n        }\r\n      }\r\n\r\n      // Quick quantity entry (Ctrl + 0-9)\r\n      if (e.ctrlKey && /^[0-9]$/.test(e.key)) {\r\n        e.preventDefault();\r\n        const activeElement = document.activeElement as HTMLElement;\r\n        if (activeElement?.closest('td[data-column-key=\"qty\"]')) {\r\n          const input = activeElement.querySelector('input') as HTMLInputElement;\r\n          if (input) {\r\n            input.value = e.key;\r\n            input.dispatchEvent(new Event('change', { bubbles: true }));\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, [config]);\r\n\r\n  // Return keyboard shortcut info\r\n  return {\r\n    shortcuts: [\r\n      { key: 'F1', description: 'Add Item' },\r\n      { key: 'F2', description: 'Save Draft' },\r\n      { key: 'F3', description: 'Complete Bill' },\r\n      { key: 'F4', description: 'Clear Form' },\r\n      { key: 'F5', description: 'Select Product' },\r\n      { key: 'F6', description: 'Bill List' },\r\n      { key: 'F7', description: 'Select Stock' },\r\n      { key: 'F8', description: 'Print' },\r\n      { key: 'End', description: 'Select Customer' },\r\n      { key: 'Ctrl+U', description: 'Select User' },\r\n      { key: 'Ctrl+S', description: 'Save' },\r\n      { key: 'Ctrl+N', description: 'Add Item' },\r\n      { key: 'Ctrl+R', description: 'Reset' },\r\n      { key: 'Tab', description: 'Navigate' },\r\n      { key: 'Enter', description: 'Edit' },\r\n      { key: 'Esc', description: 'Cancel' },\r\n    ],\r\n  };\r\n};\r\n\r\n","import React from 'react';\r\nimport { FileTextOutlined, PrinterOutlined } from '@ant-design/icons';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\ninterface DocumentTypeToggleProps {\r\n  value: 'bill' | 'invoice';\r\n  onChange: (value: 'bill' | 'invoice') => void;\r\n}\r\n\r\n/**\r\n * Compact Document Type Toggle\r\n * Matches the style of SALE TYPE, GST, PAYMENT toggles\r\n */\r\nconst DocumentTypeToggle: React.FC<DocumentTypeToggleProps> = ({\r\n  value,\r\n  onChange,\r\n}) => {\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        gap: 8,\r\n        background: '#fff',\r\n        padding: '6px 12px',\r\n        borderRadius: 10,\r\n        boxShadow: '0 2px 6px rgba(0,0,0,0.08)',\r\n      }}\r\n    >\r\n      {/* Label */}\r\n      <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\r\n        <FileTextOutlined style={{ fontSize: 15, color: '#667eea' }} />\r\n        <span style={{ fontWeight: 600, fontSize: 12, color: '#333' }}>\r\n          PRINT TYPE\r\n        </span>\r\n      </div>\r\n\r\n      {/* Toggle Switch */}\r\n      <div\r\n        onClick={() => onChange(value === 'bill' ? 'invoice' : 'bill')}\r\n        style={{\r\n          position: 'relative',\r\n          width: 100,\r\n          height: 30,\r\n          borderRadius: 16,\r\n          background:\r\n            value === 'bill'\r\n              ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'\r\n              : 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',\r\n          cursor: 'pointer',\r\n          transition: 'all 0.3s ease',\r\n          boxShadow: '0 2px 6px rgba(0,0,0,0.15)',\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: value === 'bill' ? 'flex-start' : 'flex-end',\r\n          padding: '0 3px',\r\n        }}\r\n      >\r\n        {/* Toggle Circle */}\r\n        <div\r\n          style={{\r\n            width: 24,\r\n            height: 24,\r\n            borderRadius: '50%',\r\n            background: '#fff',\r\n            boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\r\n            transition: 'all 0.3s ease',\r\n          }}\r\n        />\r\n\r\n        {/* Label inside toggle */}\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            left: value === 'bill' ? 32 : 'auto',\r\n            right: value === 'invoice' ? 32 : 'auto',\r\n            color: '#fff',\r\n            fontWeight: 'bold',\r\n            fontSize: 10,\r\n            letterSpacing: 0.5,\r\n            userSelect: 'none',\r\n          }}\r\n        >\r\n          {value === 'bill' ? 'BILL' : 'INVOICE'}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DocumentTypeToggle;\r\n","// extracted by mini-css-extract-plugin\nexport default {\"mainContainer\":\"BillDataGrid_mainContainer__Jnuo1\",\"gradientShift\":\"BillDataGrid_gradientShift__hhIW9\",\"backgroundCircle1\":\"BillDataGrid_backgroundCircle1__5PBPG\",\"float\":\"BillDataGrid_float__1VyT0\",\"backgroundCircle2\":\"BillDataGrid_backgroundCircle2__J+xMs\",\"backgroundCircle3\":\"BillDataGrid_backgroundCircle3__AgoEw\",\"backgroundCircle4\":\"BillDataGrid_backgroundCircle4__86Xfd\",\"backgroundCircle5\":\"BillDataGrid_backgroundCircle5__qpbiT\",\"headerContainer\":\"BillDataGrid_headerContainer__wfojf\",\"slideInDown\":\"BillDataGrid_slideInDown__l3LU5\",\"headerCircle1\":\"BillDataGrid_headerCircle1__8+aPI\",\"headerCircle2\":\"BillDataGrid_headerCircle2__Z9w17\",\"headerCircle3\":\"BillDataGrid_headerCircle3__3eMNm\",\"pulse\":\"BillDataGrid_pulse__EVfnw\",\"headerCircle4\":\"BillDataGrid_headerCircle4__fVITr\",\"headerCircle5\":\"BillDataGrid_headerCircle5__0E6vl\",\"headerContent\":\"BillDataGrid_headerContent__6Rnkr\",\"titleSection\":\"BillDataGrid_titleSection__LBuxT\",\"fadeInLeft\":\"BillDataGrid_fadeInLeft__YHJna\",\"titleIcon\":\"BillDataGrid_titleIcon__qffZU\",\"bounce\":\"BillDataGrid_bounce__fYaGs\",\"titleText\":\"BillDataGrid_titleText__XlvSS\",\"slideInRight\":\"BillDataGrid_slideInRight__+-bkg\",\"subtitleText\":\"BillDataGrid_subtitleText__Hgyav\",\"fadeInUp\":\"BillDataGrid_fadeInUp__Y00FE\",\"controlsSection\":\"BillDataGrid_controlsSection__PSC3w\",\"fadeInRight\":\"BillDataGrid_fadeInRight__eA5Bm\",\"controlGroup\":\"BillDataGrid_controlGroup__AFGBT\",\"saleTypeControl\":\"BillDataGrid_saleTypeControl__hzHpa\",\"slideInUp\":\"BillDataGrid_slideInUp__ZuvW2\",\"gstControl\":\"BillDataGrid_gstControl__AiGdY\",\"paymentControl\":\"BillDataGrid_paymentControl__BD0r9\",\"partialPaymentControl\":\"BillDataGrid_partialPaymentControl__unngo\",\"controlLabel\":\"BillDataGrid_controlLabel__QP4fP\",\"badgesContainer\":\"BillDataGrid_badgesContainer__bqqSt\",\"itemsBadge\":\"BillDataGrid_itemsBadge__o0Uro\",\"amountBadge\":\"BillDataGrid_amountBadge__IPSqT\",\"badgeText\":\"BillDataGrid_badgeText__9cTal\",\"invoiceDetailsGrid\":\"BillDataGrid_invoiceDetailsGrid__QPpaj\",\"itemsSection\":\"BillDataGrid_itemsSection__vJE1b\",\"itemsCircle1\":\"BillDataGrid_itemsCircle1__PQoMB\",\"rotate\":\"BillDataGrid_rotate__l3nA9\",\"itemsCircle2\":\"BillDataGrid_itemsCircle2__0lWcR\",\"scaleIn\":\"BillDataGrid_scaleIn__xFZvA\",\"billItemsGrid\":\"BillDataGrid_billItemsGrid__jpWQo\",\"billItemsHeader\":\"BillDataGrid_billItemsHeader__hxL0O\",\"billItemsTitle\":\"BillDataGrid_billItemsTitle__MQduV\",\"billItemsBadge\":\"BillDataGrid_billItemsBadge__vdJMk\",\"billSummary\":\"BillDataGrid_billSummary__yA4j-\",\"summaryCircle1\":\"BillDataGrid_summaryCircle1__PuveY\",\"summaryCircle2\":\"BillDataGrid_summaryCircle2__fdcks\",\"summaryHeader\":\"BillDataGrid_summaryHeader__h1BtQ\",\"summaryTitle\":\"BillDataGrid_summaryTitle__dSOoP\",\"summaryRow\":\"BillDataGrid_summaryRow__yUShR\",\"summaryLabel\":\"BillDataGrid_summaryLabel__cLnHd\",\"summaryValue\":\"BillDataGrid_summaryValue__LUh-6\",\"summaryTotal\":\"BillDataGrid_summaryTotal__ujvAB\",\"summaryTable\":\"BillDataGrid_summaryTable__ZpVlt\",\"totalAmountRow\":\"BillDataGrid_totalAmountRow__JXMuL\",\"totalAmountLabel\":\"BillDataGrid_totalAmountLabel__IVRMe\",\"totalAmountValue\":\"BillDataGrid_totalAmountValue__5W5mL\",\"discountValue\":\"BillDataGrid_discountValue__QjPij\",\"partialPaymentInfo\":\"BillDataGrid_partialPaymentInfo__OpO+-\",\"partialPaymentRow\":\"BillDataGrid_partialPaymentRow__Qy-Ni\",\"partialPaymentLabel\":\"BillDataGrid_partialPaymentLabel__yEvTO\",\"partialPaymentValue\":\"BillDataGrid_partialPaymentValue__SLg8d\",\"controlsContainer\":\"BillDataGrid_controlsContainer__2jCRg\",\"discountControl\":\"BillDataGrid_discountControl__n0WOI\",\"discountControlLabel\":\"BillDataGrid_discountControlLabel__0iwJ9\",\"discountControlInputs\":\"BillDataGrid_discountControlInputs__TbgUU\",\"partialPaymentControlLabel\":\"BillDataGrid_partialPaymentControlLabel__lxP98\",\"summaryTotalLabel\":\"BillDataGrid_summaryTotalLabel__u+656\",\"summaryTotalValue\":\"BillDataGrid_summaryTotalValue__sKz9B\",\"partialPaymentBalance\":\"BillDataGrid_partialPaymentBalance__lFxZE\",\"discountLabel\":\"BillDataGrid_discountLabel__906vd\",\"discountInputs\":\"BillDataGrid_discountInputs__9BUMD\",\"actionHub\":\"BillDataGrid_actionHub__SlPSg\",\"actionButtonsContainer\":\"BillDataGrid_actionButtonsContainer__BcfKu\",\"actionHubCircle1\":\"BillDataGrid_actionHubCircle1__ggNzA\",\"actionHubCircle2\":\"BillDataGrid_actionHubCircle2__Nb-oj\",\"actionHubCircle3\":\"BillDataGrid_actionHubCircle3__D2pna\",\"actionHubCircle4\":\"BillDataGrid_actionHubCircle4__ayVXK\",\"actionButtons\":\"BillDataGrid_actionButtons__tQbXu\",\"saveButton\":\"BillDataGrid_saveButton__vWggk\",\"billListButton\":\"BillDataGrid_billListButton__ahHFc\",\"refreshButton\":\"BillDataGrid_refreshButton__XnoTE\",\"printButton\":\"BillDataGrid_printButton__nkIDd\",\"downloadButton\":\"BillDataGrid_downloadButton__Jsy5n\",\"clearButton\":\"BillDataGrid_clearButton__518xA\",\"shortcutsInfo\":\"BillDataGrid_shortcutsInfo__kN1Ka\",\"shortcutsText\":\"BillDataGrid_shortcutsText__qGuNn\",\"customerField\":\"BillDataGrid_customerField__+4wOA\",\"customerFieldEndKey\":\"BillDataGrid_customerFieldEndKey__HaMh6\",\"stockField\":\"BillDataGrid_stockField__BQirP\",\"stockFieldSelected\":\"BillDataGrid_stockFieldSelected__x7NU5\",\"stockFieldIcon\":\"BillDataGrid_stockFieldIcon__WeVkj\",\"stockFieldWarning\":\"BillDataGrid_stockFieldWarning__7Lv+C\",\"saleTypeSwitch\":\"BillDataGrid_saleTypeSwitch__Xa4gR\",\"ant-switch-checked\":\"BillDataGrid_ant-switch-checked__rQynk\",\"gstSwitch\":\"BillDataGrid_gstSwitch__ZQG0t\",\"paymentSwitch\":\"BillDataGrid_paymentSwitch__KxB-J\",\"partialPaymentSwitch\":\"BillDataGrid_partialPaymentSwitch__5nNFs\",\"keyboardShortcuts\":\"BillDataGrid_keyboardShortcuts__2e-4z\",\"keyboardShortcutsContent\":\"BillDataGrid_keyboardShortcutsContent__5FpEl\",\"keyboardShortcutsText\":\"BillDataGrid_keyboardShortcutsText__A58I9\",\"slideInLeft\":\"BillDataGrid_slideInLeft__TTFPm\"};","import React from 'react';\r\nimport { Typography, Switch, Badge } from 'antd';\r\nimport { FileTextOutlined } from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport DocumentTypeToggle from './DocumentTypeToggle';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillTopBarProps {\r\n  billdata?: any;\r\n  documentType: 'bill' | 'invoice';\r\n  billSettings: {\r\n    isRetail: boolean;\r\n    isGstIncluded: boolean;\r\n    isPaid: boolean;\r\n    isPartiallyPaid: boolean;\r\n  };\r\n  itemCount: number;\r\n  totalAmount: number;\r\n  onDocumentTypeChange: (type: 'bill' | 'invoice') => void;\r\n  onSettingsChange: (settings: Partial<any>) => void;\r\n}\r\n\r\nconst BillTopBar: React.FC<BillTopBarProps> = ({\r\n  billdata,\r\n  documentType,\r\n  billSettings,\r\n  itemCount,\r\n  totalAmount,\r\n  onDocumentTypeChange,\r\n  onSettingsChange,\r\n}) => {\r\n  return (\r\n    <div className={styles.headerContainer}>\r\n      {/* Animated decorative background elements */}\r\n      <div className={styles.headerCircle1} />\r\n      <div className={styles.headerCircle2} />\r\n      <div className={styles.headerCircle3} />\r\n      <div className={styles.headerCircle4} />\r\n      <div className={styles.headerCircle5} />\r\n\r\n      <div className={styles.headerContent}>\r\n        {/* Title Section */}\r\n        <div className={styles.titleSection}>\r\n          <div className={styles.titleIcon}>\r\n            <FileTextOutlined style={{ fontSize: '24px', color: 'white' }} />\r\n          </div>\r\n          <div>\r\n            <Title level={4} className={styles.titleText}>\r\n              {billdata ? ' EDIT INVOICE' : ' NEW INVOICE'}\r\n            </Title>\r\n            <Text className={styles.subtitleText}>\r\n              Lightning Fast  {dayjs().format('DD MMM YYYY, dddd')}\r\n            </Text>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Controls Section */}\r\n        <div className={styles.controlsSection}>\r\n          {/* Document Type Toggle */}\r\n          <div style={{ marginRight: '12px' }}>\r\n            <DocumentTypeToggle value={documentType} onChange={onDocumentTypeChange} />\r\n          </div>\r\n\r\n          {/* Sale Type */}\r\n          <div className={`${styles.controlGroup} ${styles.saleTypeControl}`}>\r\n            <Text className={styles.controlLabel}> SALE TYPE</Text>\r\n            <Switch\r\n              checkedChildren=\"RETAIL\"\r\n              unCheckedChildren=\"WHOLESALE\"\r\n              checked={billSettings.isRetail}\r\n              onChange={checked => onSettingsChange({ isRetail: checked })}\r\n              className={styles.saleTypeSwitch}\r\n              size=\"small\"\r\n            />\r\n          </div>\r\n\r\n          {/* GST Toggle */}\r\n          <div className={`${styles.controlGroup} ${styles.gstControl}`}>\r\n            <Text className={styles.controlLabel}> GST</Text>\r\n            <Switch\r\n              checkedChildren=\"INCL\"\r\n              unCheckedChildren=\"EXCL\"\r\n              checked={billSettings.isGstIncluded}\r\n              onChange={checked => onSettingsChange({ isGstIncluded: checked })}\r\n              className={styles.gstSwitch}\r\n              size=\"small\"\r\n            />\r\n          </div>\r\n\r\n          {/* Payment Status */}\r\n          <div className={`${styles.controlGroup} ${styles.paymentControl}`}>\r\n            <Text className={styles.controlLabel}> PAYMENT</Text>\r\n            <Switch\r\n              checkedChildren=\"PAID\"\r\n              unCheckedChildren=\"UNPAID\"\r\n              checked={billSettings.isPaid}\r\n              onChange={checked =>\r\n                onSettingsChange({\r\n                  isPaid: checked,\r\n                  isPartiallyPaid: checked ? false : billSettings.isPartiallyPaid,\r\n                })\r\n              }\r\n              className={styles.paymentSwitch}\r\n              size=\"small\"\r\n            />\r\n          </div>\r\n\r\n          {/* Partial Payment */}\r\n          {!billSettings.isPaid && (\r\n            <div className={`${styles.controlGroup} ${styles.partialPaymentControl}`}>\r\n              <Text className={styles.controlLabel}> PARTIAL</Text>\r\n              <Switch\r\n                checkedChildren=\"YES\"\r\n                unCheckedChildren=\"NO\"\r\n                checked={billSettings.isPartiallyPaid}\r\n                onChange={checked => onSettingsChange({ isPartiallyPaid: checked })}\r\n                className={styles.partialPaymentSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* Items and Amount Badges */}\r\n          <div className={styles.badgesContainer}>\r\n            <div className={styles.itemsBadge}>\r\n              <Text className={styles.badgeText}> ITEMS: {itemCount}</Text>\r\n            </div>\r\n            <div className={styles.amountBadge}>\r\n              <Text className={styles.badgeText}> {totalAmount.toFixed(2)}</Text>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillTopBar;\r\n\r\n","import React, { useMemo } from 'react';\r\nimport { Typography, Tooltip } from 'antd';\r\nimport AntdEditableTable, {\r\n  AntdEditableColumn,\r\n} from '../../../components/common/AntdEditableTable';\r\n\r\nconst { Text } = Typography;\r\n\r\ninterface BillHeaderProps {\r\n  billFormData: {\r\n    invoice_no: string;\r\n    date: string;\r\n    customer_id: string;\r\n    customer_name?: string;\r\n    billed_by?: string;\r\n    billed_by_name?: string;\r\n    payment_mode: string;\r\n  };\r\n  customerOrVendorOptions: Array<{ label: string; value: string }>;\r\n  userOptions: Array<{ label: string; value: string }>;\r\n  documentType: 'bill' | 'invoice';\r\n  onHeaderChange: (headerRows: any[]) => void;\r\n  onCustomerModalOpen: () => void;\r\n  onUserModalOpen: () => void;\r\n  loading: boolean;\r\n}\r\n\r\nconst BillHeader: React.FC<BillHeaderProps> = ({\r\n  billFormData,\r\n  customerOrVendorOptions,\r\n  userOptions,\r\n  documentType,\r\n  onHeaderChange,\r\n  onCustomerModalOpen,\r\n  onUserModalOpen,\r\n  loading,\r\n}) => {\r\n  const headerColumns: AntdEditableColumn[] = useMemo(\r\n    () => [\r\n      {\r\n        key: 'invoice_no',\r\n        title: ' INVOICE #',\r\n        dataIndex: 'invoice_no',\r\n        type: 'text',\r\n        required: true,\r\n        width: 180,\r\n      },\r\n      {\r\n        key: 'date',\r\n        title: ' DATE',\r\n        dataIndex: 'date',\r\n        type: 'date',\r\n        required: true,\r\n        width: 150,\r\n      },\r\n      {\r\n        key: 'customer_id',\r\n        title: ' CUSTOMER',\r\n        dataIndex: 'customer_id',\r\n        type: 'text',\r\n        editable: false,\r\n        required: true,\r\n        width: 250,\r\n        render: (value: any) => {\r\n          const selectedItem = customerOrVendorOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          const placeholderText = 'Select customer';\r\n          const displayLabel =\r\n            selectedItem?.label || billFormData.customer_name || placeholderText;\r\n          const tooltipText = 'Click to open customer selection modal (or press End key)';\r\n\r\n          return (\r\n            <Tooltip title={tooltipText}>\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={onCustomerModalOpen}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#fafafa';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>{displayLabel}</span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#f0f8ff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  End\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'billed_by',\r\n        title: ' BILLED BY',\r\n        dataIndex: 'billed_by',\r\n        type: 'text',\r\n        editable: false,\r\n        required: false,\r\n        width: 250,\r\n        render: (value: any) => {\r\n          const selectedUser = userOptions.find((opt: any) => opt.value === value);\r\n          const displayLabel = selectedUser?.label || billFormData.billed_by_name || 'Select user';\r\n          return (\r\n            <Tooltip title=\"Click to open user selection modal (or press Ctrl+U key)\">\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#f0f8ff',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={onUserModalOpen}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#e6f7ff';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f8ff';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>{displayLabel}</span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#ffffff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  Ctrl+U\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'payment_mode',\r\n        title: ' PAYMENT',\r\n        dataIndex: 'payment_mode',\r\n        type: 'select',\r\n        options: [\r\n          { label: ' Cash', value: 'cash' },\r\n          { label: ' UPI', value: 'upi' },\r\n          { label: ' Card', value: 'card' },\r\n        ],\r\n        required: true,\r\n        width: 150,\r\n      },\r\n    ],\r\n    [customerOrVendorOptions, userOptions, documentType, onCustomerModalOpen, onUserModalOpen]\r\n  );\r\n\r\n  const headerData = useMemo(\r\n    () => [\r\n      {\r\n        invoice_no: billFormData.invoice_no,\r\n        date: billFormData.date,\r\n        customer_id: billFormData.customer_id,\r\n        billed_by: billFormData.billed_by,\r\n        payment_mode: billFormData.payment_mode,\r\n      },\r\n    ],\r\n    [\r\n      billFormData.invoice_no,\r\n      billFormData.date,\r\n      billFormData.customer_id,\r\n      billFormData.billed_by,\r\n      billFormData.payment_mode,\r\n    ]\r\n  );\r\n\r\n  return (\r\n    <AntdEditableTable\r\n      columns={headerColumns}\r\n      dataSource={headerData}\r\n      onSave={onHeaderChange}\r\n      allowAdd={false}\r\n      allowDelete={false}\r\n      loading={loading}\r\n      className=\"compact-header-grid\"\r\n      size=\"small\"\r\n      rowKey=\"invoice_no\"\r\n    />\r\n  );\r\n};\r\n\r\nexport default BillHeader;\r\n\r\n","import React from 'react';\r\nimport { Typography, InputNumber, Switch } from 'antd';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\nconst { Text } = Typography;\r\n\r\ninterface BillSummaryProps {\r\n  billCalculations: {\r\n    sub_total: number;\r\n    value_of_goods: number;\r\n    total_gst: number;\r\n    cgst: number;\r\n    sgst: number;\r\n    total_amount: number;\r\n    discountValue: number;\r\n  };\r\n  billSettings: {\r\n    discount: number;\r\n    discountType: 'percentage' | 'amount';\r\n    isPaid: boolean;\r\n    isPartiallyPaid: boolean;\r\n    paidAmount: number;\r\n  };\r\n  onDiscountChange: (value: number) => void;\r\n  onDiscountTypeChange: (checked: boolean) => void;\r\n  onPaidAmountChange: (value: number) => void;\r\n}\r\n\r\nconst BillSummary: React.FC<BillSummaryProps> = ({\r\n  billCalculations,\r\n  billSettings,\r\n  onDiscountChange,\r\n  onDiscountTypeChange,\r\n  onPaidAmountChange,\r\n}) => {\r\n  return (\r\n    <div className={styles.billSummary}>\r\n      {/* Decorative half circles for summary */}\r\n      <div className={styles.summaryCircle1} />\r\n      <div className={styles.summaryCircle2} />\r\n      \r\n      {/* Header */}\r\n      <div className={styles.summaryHeader}>\r\n        <Text className={styles.summaryTitle}> BILL SUMMARY</Text>\r\n      </div>\r\n\r\n      {/* Summary Table */}\r\n      <div className={styles.summaryTable}>\r\n        <div className={styles.summaryRow}>\r\n          <Text className={styles.summaryLabel}>Sub Total:</Text>\r\n          <Text className={styles.summaryValue}>\r\n            {billCalculations.sub_total.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        <div className={styles.summaryRow}>\r\n          <Text className={styles.summaryLabel}>Value of Goods:</Text>\r\n          <Text className={styles.summaryValue}>\r\n            {billCalculations.value_of_goods.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        <div className={styles.summaryRow}>\r\n          <Text className={styles.summaryLabel}>Total GST:</Text>\r\n          <Text className={styles.summaryValue}>\r\n            {billCalculations.total_gst.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        <div className={styles.summaryRow}>\r\n          <Text className={styles.summaryLabel}>CGST:</Text>\r\n          <Text className={styles.summaryValue}>\r\n            {billCalculations.cgst.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        <div className={styles.summaryRow}>\r\n          <Text className={styles.summaryLabel}>SGST:</Text>\r\n          <Text className={styles.summaryValue}>\r\n            {billCalculations.sgst.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        {billSettings.discount > 0 && (\r\n          <div className={styles.summaryRow}>\r\n            <Text className={styles.summaryLabel}>DISCOUNT:</Text>\r\n            <Text className={styles.discountValue}>\r\n              -\r\n              {billSettings.discountType === 'percentage'\r\n                ? (\r\n                    ((billCalculations.sub_total + billCalculations.total_gst) *\r\n                      (typeof billSettings.discount === 'number' ? billSettings.discount : 0)) /\r\n                    100\r\n                  ).toFixed(2)\r\n                : (typeof billSettings.discount === 'number'\r\n                    ? billSettings.discount\r\n                    : 0\r\n                  ).toFixed(2)}\r\n            </Text>\r\n          </div>\r\n        )}\r\n\r\n        <div className={styles.totalAmountRow}>\r\n          <Text className={styles.totalAmountLabel}>NET/EXC/REPL:</Text>\r\n          <Text className={styles.totalAmountValue}>\r\n            {billCalculations.total_amount.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        {billSettings.isPartiallyPaid && (\r\n          <div className={styles.partialPaymentInfo}>\r\n            <div className={styles.partialPaymentRow}>\r\n              <Text className={styles.partialPaymentLabel}>Paid Amount:</Text>\r\n              <Text className={styles.partialPaymentValue}>\r\n                \r\n                {(typeof billSettings.paidAmount === 'number'\r\n                  ? billSettings.paidAmount\r\n                  : 0\r\n                ).toFixed(2)}\r\n              </Text>\r\n            </div>\r\n            <div className={styles.partialPaymentRow}>\r\n              <Text className={styles.partialPaymentLabel}>Balance:</Text>\r\n              <Text className={styles.partialPaymentValue}>\r\n                \r\n                {(\r\n                  billCalculations.total_amount -\r\n                  (typeof billSettings.paidAmount === 'number' ? billSettings.paidAmount : 0)\r\n                ).toFixed(2)}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Discount & Payment Controls */}\r\n      <div className={styles.controlsContainer}>\r\n        {/* Discount Controls */}\r\n        <div className={styles.discountControl}>\r\n          <Text className={styles.discountControlLabel}> DISCOUNT</Text>\r\n          <div className={styles.discountControlInputs}>\r\n            <InputNumber\r\n              min={0}\r\n              value={billSettings.discount}\r\n              onChange={value => onDiscountChange(value || 0)}\r\n              style={{ width: 70 }}\r\n              size=\"small\"\r\n            />\r\n            <Switch\r\n              checkedChildren=\"%\"\r\n              unCheckedChildren=\"\"\r\n              checked={billSettings.discountType === 'percentage'}\r\n              onChange={onDiscountTypeChange}\r\n              size=\"small\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Partial Payment Controls */}\r\n        {billSettings.isPartiallyPaid && (\r\n          <div className={styles.partialPaymentControl}>\r\n            <Text className={styles.partialPaymentControlLabel}> PARTIAL PAY</Text>\r\n            <InputNumber\r\n              min={0}\r\n              max={billCalculations.total_amount}\r\n              value={billSettings.paidAmount}\r\n              onChange={value => onPaidAmountChange(value || 0)}\r\n              style={{ width: 90 }}\r\n              size=\"small\"\r\n              formatter={value => `${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')}\r\n              parser={value => Number(value!.replace(/\\s?|(,*)/g, ''))}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillSummary;\r\n\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Button,\r\n  Typography,\r\n  message,\r\n  Form,\r\n  Select,\r\n  Space,\r\n  Divider,\r\n  Tag,\r\n  Table,\r\n  Row,\r\n  Col,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  UserAddOutlined,\r\n  UserOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n  HomeOutlined,\r\n  PlusOutlined,\r\n  SaveOutlined,\r\n  CloseOutlined,\r\n} from '@ant-design/icons';\r\nimport { useHandleApiResponse } from '../../../components/common/useHandleApiResponse';\r\nimport { useGenericCrudRTK } from '../../../hooks/useGenericCrudRTK';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Option } = Select;\r\n\r\ninterface Customer {\r\n  _id: string;\r\n  full_name: string;\r\n  email: string;\r\n  mobile: string;\r\n  address: string;\r\n  customer_type: 'regular' | 'vip' | 'wholesale';\r\n}\r\n\r\ninterface NewCustomerData {\r\n  full_name: string;\r\n  email: string;\r\n  mobile: string;\r\n  address: string;\r\n  customer_type: 'regular' | 'vip' | 'wholesale';\r\n}\r\n\r\ninterface CustomerSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (customer: Customer) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst CustomerSelectionModalComponent: React.FC<CustomerSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [debouncedSearchTerm, setDebouncedSearchTerm] = useState('');\r\n  const [page, setPage] = useState(1);\r\n  const [allCustomers, setAllCustomers] = useState<Customer[]>([]);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [showAddForm, setShowAddForm] = useState(false);\r\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(\r\n    null\r\n  );\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n  const [showCreateGrid, setShowCreateGrid] = useState(false);\r\n  const [newCustomerData, setNewCustomerData] = useState<NewCustomerData>({\r\n    full_name: '',\r\n    email: '',\r\n    mobile: '',\r\n    address: '',\r\n    customer_type: 'regular',\r\n  });\r\n\r\n  const [form] = Form.useForm();\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const createGridRef = useRef<HTMLDivElement>(null);\r\n  const firstFormInputRef = useRef<any>(null);\r\n  const isLoadingMoreRef = useRef(false);\r\n\r\n  // RTK Query hooks for Customer - with pagination\r\n  const { data: customerData, isLoading: customerLoading, refetch: refetchCustomerList } = \r\n    apiSlice.useGetCustomerQuery(\r\n      { \r\n        searchString: debouncedSearchTerm,\r\n        pageNumber: page,\r\n        pageLimit: 10\r\n      },\r\n      { \r\n        skip: !visible, // Only fetch when modal is open\r\n        refetchOnMountOrArgChange: true,\r\n      }\r\n    );\r\n  \r\n  const customerRTK = useGenericCrudRTK('Customer');\r\n  const { create: createCustomer, ...createResult } = customerRTK.useCreate();\r\n  const createLoading = createResult.isLoading;\r\n\r\n  // Accumulate customers for infinite scroll\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n    \r\n    if (customerData) {\r\n      const newItems = (customerData as any)?.result || [];\r\n      const totalCount = (customerData as any).pagination?.totalCount || (customerData as any).pagination?.total || 0;\r\n      \r\n      if (page === 1) {\r\n        // First page - replace all items\r\n        setAllCustomers(newItems);\r\n        setHasMore(newItems.length < totalCount && newItems.length > 0);\r\n        if (newItems.length > 0) {\r\n          setShowCreateGrid(false);\r\n          setShowAddForm(false);\r\n        }\r\n      } else {\r\n        // Subsequent pages - append items\r\n        setAllCustomers(prev => {\r\n          const existingIds = new Set(prev.map((item: any) => item._id));\r\n          const uniqueNewItems = newItems.filter((item: any) => !existingIds.has(item._id));\r\n          const updated = [...prev, ...uniqueNewItems];\r\n          setHasMore(updated.length < totalCount && uniqueNewItems.length > 0);\r\n          return updated;\r\n        });\r\n        if (newItems.length > 0) {\r\n          setShowCreateGrid(false);\r\n          setShowAddForm(false);\r\n        }\r\n      }\r\n      \r\n      isLoadingMoreRef.current = false;\r\n    }\r\n  }, [customerData, page, visible]);\r\n\r\n  const filteredCustomers = allCustomers;\r\n\r\n  // Check if search has no results and should show create grid\r\n  const shouldShowCreateGrid = useMemo(() => {\r\n    return (\r\n      searchTerm.trim() && !customerLoading && filteredCustomers.length === 0\r\n    );\r\n  }, [searchTerm, customerLoading, filteredCustomers.length]);\r\n\r\n  // Memoized customer type color function\r\n  const getCustomerTypeColor = useCallback((type: string) => {\r\n    const colorMap: Record<string, string> = {\r\n      vip: 'gold',\r\n      wholesale: 'blue',\r\n      regular: 'green',\r\n    };\r\n    return colorMap[type] || 'green';\r\n  }, []);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToCustomer = useCallback(\r\n    (direction: 'up' | 'down' | 'home' | 'end') => {\r\n      if (filteredCustomers.length === 0) return;\r\n\r\n      let newIndex: number;\r\n      switch (direction) {\r\n        case 'up':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? filteredCustomers.length - 1\r\n              : Math.max(selectedRowIndex - 1, 0);\r\n          break;\r\n        case 'down':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? 0\r\n              : Math.min(selectedRowIndex + 1, filteredCustomers.length - 1);\r\n          break;\r\n        case 'home':\r\n          newIndex = 0;\r\n          break;\r\n        case 'end':\r\n          newIndex = filteredCustomers.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedCustomer(filteredCustomers[newIndex]);\r\n\r\n      // Scroll to the selected row\r\n      setTimeout(() => {\r\n        const rowElement = document.querySelector(\r\n          `[data-row-key=\"${filteredCustomers[newIndex]._id}\"]`\r\n        ) as HTMLElement;\r\n        if (rowElement) {\r\n          const scrollBehavior =\r\n            direction === 'home'\r\n              ? 'start'\r\n              : direction === 'end'\r\n                ? 'end'\r\n                : 'nearest';\r\n          rowElement.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: scrollBehavior,\r\n          });\r\n        }\r\n      }, 100);\r\n    },\r\n    [filteredCustomers, selectedRowIndex]\r\n  );\r\n\r\n  // Debounced search function with pagination reset\r\n  const handleSearch = useCallback(\r\n    (value: string) => {\r\n      setSearchTerm(value);\r\n\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n\r\n      searchTimeoutRef.current = setTimeout(() => {\r\n        setDebouncedSearchTerm(value.trim());\r\n        // Reset to page 1 when search changes\r\n        setPage(1);\r\n        setHasMore(true);\r\n        isLoadingMoreRef.current = false;\r\n      }, 300);\r\n    },\r\n    []\r\n  );\r\n\r\n  // Handle customer selection\r\n  const handleCustomerSelect = useCallback(\r\n    (customer: Customer) => {\r\n      setSelectedCustomer(customer);\r\n      onSelect(customer);\r\n      setTimeout(() => onCancel(), 100);\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Function to clear form data\r\n  const clearFormData = useCallback(() => {\r\n    setNewCustomerData({\r\n      full_name: '',\r\n      email: '',\r\n      mobile: '',\r\n      address: '',\r\n      customer_type: 'regular',\r\n    });\r\n    form.resetFields();\r\n  }, [form]);\r\n\r\n  // Handle new customer creation from unified form\r\n  const handleCreateCustomerFromForm = useCallback(async () => {\r\n    try {\r\n      // Validate required fields - only Full Name and Mobile are mandatory\r\n      if (!newCustomerData.full_name.trim()) {\r\n        message.error('Full name is required');\r\n        return;\r\n      }\r\n      if (!newCustomerData.mobile.trim()) {\r\n        message.error('Mobile number is required');\r\n        return;\r\n      }\r\n\r\n      // Call RTK mutation - the response will be handled by useHandleApiResponse\r\n      const result = await createCustomer(newCustomerData);\r\n      if (!result.error && result.data) {\r\n        // Customer created successfully, get the new customer data\r\n        const newCustomer = result.data?.data || result.data?.result || result.data;\r\n        if (newCustomer) {\r\n          // Clear form and hide form UI\r\n          clearFormData();\r\n          setShowAddForm(false);\r\n          setShowCreateGrid(false);\r\n          \r\n          // Refresh customer list\r\n          refetchCustomerList();\r\n          \r\n          // Select the newly created customer\r\n          setTimeout(() => {\r\n            handleCustomerSelect(newCustomer);\r\n          }, 100);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      message.error('Failed to create customer');\r\n      // Clear form data on error\r\n      clearFormData();\r\n    }\r\n  }, [newCustomerData, createCustomer, handleCustomerSelect, clearFormData, refetchCustomerList]);\r\n\r\n  // Handle form field changes\r\n  const handleFormFieldChange = useCallback(\r\n    (field: keyof NewCustomerData, value: string) => {\r\n      setNewCustomerData(prev => ({\r\n        ...prev,\r\n        [field]: value,\r\n      }));\r\n    },\r\n    []\r\n  );\r\n\r\n  // Remove the navigateToNextField function as it's no longer needed\r\n\r\n  // Handle keyboard events (excluding Enter key which is handled by input field)\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onCancel();\r\n      } else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToCustomer(directionMap[e.key]);\r\n      }\r\n    },\r\n    [navigateToCustomer, onCancel]\r\n  );\r\n\r\n  // Global keyboard event handler\r\n  const handleGlobalKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (!visible) return;\r\n\r\n      // Don't interfere if user is typing in form inputs\r\n      const target = e.target as HTMLElement;\r\n      if (\r\n        target.tagName === 'INPUT' ||\r\n        target.tagName === 'TEXTAREA' ||\r\n        target.classList.contains('ant-select-selector') ||\r\n        target.closest('.ant-select-dropdown')\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === 'f') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Handle Ctrl+N for new customer creation\r\n      if (e.ctrlKey && e.key === 'n') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (shouldShowCreateGrid) {\r\n          setShowCreateGrid(true);\r\n          setTimeout(() => {\r\n            if (createGridRef.current) {\r\n              const firstInput = createGridRef.current.querySelector(\r\n                'input'\r\n              ) as HTMLInputElement;\r\n              if (firstInput) {\r\n                firstInput.focus();\r\n                firstInput.select();\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Only handle navigation keys globally when not in form inputs\r\n      if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToCustomer(directionMap[e.key]);\r\n      }\r\n    },\r\n    [visible, navigateToCustomer, shouldShowCreateGrid]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: Customer) => (\r\n          <div\r\n            style={{\r\n              cursor: 'pointer',\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n            }}\r\n            onClick={() => {\r\n              setSelectedCustomer(record);\r\n              const index = filteredCustomers.findIndex(\r\n                (c: Customer) => c._id === record._id\r\n              );\r\n              setSelectedRowIndex(index);\r\n              // Don't auto-select here, let user click the row or press Enter\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                borderRadius: '50%',\r\n                border:\r\n                  selectedCustomer?._id === record._id\r\n                    ? '2px solid #1890ff'\r\n                    : '2px solid #d9d9d9',\r\n                backgroundColor:\r\n                  selectedCustomer?._id === record._id ? '#1890ff' : 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedCustomer?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Customer Name',\r\n        dataIndex: 'full_name',\r\n        key: 'full_name',\r\n        render: (text: string, record: Customer) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <Text strong>{text}</Text>\r\n            <Tag color={getCustomerTypeColor(record.customer_type)}>\r\n              {record.customer_type.toUpperCase()}\r\n            </Tag>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Mobile',\r\n        dataIndex: 'mobile',\r\n        key: 'mobile',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Address',\r\n        dataIndex: 'address',\r\n        key: 'address',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'flex-start', gap: 8 }}>\r\n            <HomeOutlined style={{ color: '#666', marginTop: '2px' }} />\r\n            <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n              {text || '-'}\r\n            </Text>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedCustomer, filteredCustomers, getCustomerTypeColor]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: Customer, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedCustomer(record);\r\n        setSelectedRowIndex(index ?? 0);\r\n        // Don't auto-select on row click, let user press Enter to confirm\r\n      },\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedCustomer?._id === record._id ? '#f0f8ff' : 'white',\r\n        border:\r\n          selectedCustomer?._id === record._id\r\n            ? '2px solid #1890ff'\r\n            : '1px solid #f0f0f0',\r\n        borderRadius: '4px',\r\n        transition: 'all 0.2s ease',\r\n      },\r\n      onMouseEnter: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedCustomer?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = '#f5f5f5';\r\n        }\r\n      },\r\n      onMouseLeave: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedCustomer?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = 'white';\r\n        }\r\n      },\r\n    }),\r\n    [selectedCustomer]\r\n  );\r\n\r\n  // Handle modal close (RTK Query automatically loads customers)\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setSelectedCustomer(null);\r\n      setSelectedRowIndex(-1);\r\n      setShowCreateGrid(false);\r\n      // Reset pagination when modal opens\r\n      setPage(1);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    } else {\r\n      setSearchTerm('');\r\n      setDebouncedSearchTerm('');\r\n      setSelectedCustomer(null);\r\n      setSelectedRowIndex(-1);\r\n      setShowCreateGrid(false);\r\n      setShowAddForm(false);\r\n      clearFormData();\r\n      // Reset pagination when modal closes\r\n      setPage(1);\r\n      setAllCustomers([]);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = null;\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [visible, clearFormData]);\r\n\r\n  // Auto-show create form when search has no results\r\n  useEffect(() => {\r\n    if (shouldShowCreateGrid && !showCreateGrid && !showAddForm) {\r\n      setShowCreateGrid(true);\r\n    }\r\n  }, [shouldShowCreateGrid, showCreateGrid, showAddForm]);\r\n\r\n  // Focus search input when modal becomes visible (but not when create form is shown)\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current && !showAddForm && !showCreateGrid) {\r\n      const focusSearch = () => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n      };\r\n\r\n      focusSearch();\r\n      const timer = setTimeout(focusSearch, 100);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [visible, showAddForm, showCreateGrid]);\r\n\r\n  // Focus on first form field when create form is shown\r\n  useEffect(() => {\r\n    if ((showAddForm || showCreateGrid) && visible) {\r\n      const timer = setTimeout(() => {\r\n        if (firstFormInputRef.current) {\r\n          firstFormInputRef.current.focus();\r\n          firstFormInputRef.current.select();\r\n        }\r\n      }, 100);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [showAddForm, showCreateGrid, visible]); // Depend on all three to trigger when form is shown\r\n\r\n  // Remove the useLayoutEffect that was causing focus to reset\r\n\r\n  // Global keyboard event listener\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('keydown', handleGlobalKeyDown, true);\r\n      return () =>\r\n        document.removeEventListener('keydown', handleGlobalKeyDown, true);\r\n    }\r\n  }, [visible, handleGlobalKeyDown]);\r\n\r\n  // Handle API responses using RTK mutations\r\n  useHandleApiResponse({\r\n    action: 'create',\r\n    title: 'Customer',\r\n    mutationResult: createResult,\r\n    refetch: refetchCustomerList,\r\n  });\r\n\r\n  // Watch createLoading state to show/hide loading message\r\n  useEffect(() => {\r\n    if (createLoading) {\r\n      // Show loading message when API call starts\r\n      message.loading({\r\n        content: 'Creating customer...',\r\n        key: 'customer-creation',\r\n        duration: 0,\r\n      });\r\n    } else {\r\n      // Hide loading message when API call completes\r\n      message.destroy('customer-creation');\r\n    }\r\n  }, [createLoading]);\r\n\r\n  // Note: Customer creation success is handled in handleCreateCustomerFromForm\r\n  // The useHandleApiResponse hook handles notifications automatically\r\n  // No need for additional useEffect watching createResult\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedCustomer(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n  return (\r\n    <Modal\r\n      title=\"Select Customer\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={1000}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current && !showAddForm && !showCreateGrid) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Space.Compact style={{ width: '100%' }}>\r\n          <Input\r\n            ref={searchInputRef}\r\n            placeholder=\"Search customers... (Ctrl+N: New customer, : Navigate, Enter: Select, Esc: Close)\"\r\n            value={searchTerm}\r\n            onChange={e => handleSearch(e.target.value)}\r\n            prefix={<SearchOutlined />}\r\n            style={{ flex: 1 }}\r\n            onKeyDown={e => {\r\n              // Only handle Enter key in search input, let other keys bubble up\r\n              if (e.key === 'Enter' && selectedCustomer) {\r\n                handleCustomerSelect(selectedCustomer);\r\n              }\r\n            }}\r\n            onFocus={handleSearchFocus}\r\n            autoFocus={!showAddForm && !showCreateGrid}\r\n            onBlur={\r\n              !showAddForm && !showCreateGrid\r\n                ? () => {\r\n                    // Only auto-focus back to search if no forms are shown\r\n                    if (visible && searchInputRef.current) {\r\n                      setTimeout(() => {\r\n                        if (\r\n                          visible &&\r\n                          searchInputRef.current &&\r\n                          !showAddForm &&\r\n                          !showCreateGrid\r\n                        ) {\r\n                          searchInputRef.current.focus();\r\n                        }\r\n                      }, 10);\r\n                    }\r\n                  }\r\n                : undefined\r\n            }\r\n            suffix={\r\n              searchTerm && customerLoading ? (\r\n                <div style={{ fontSize: '12px', color: '#999' }}>\r\n                  Searching...\r\n                </div>\r\n              ) : null\r\n            }\r\n          />\r\n          <Button\r\n            type={showAddForm ? 'default' : 'primary'}\r\n            icon={<UserAddOutlined />}\r\n            onClick={() => {\r\n              const newState = !showAddForm;\r\n              setShowAddForm(newState);\r\n              if (!newState) {\r\n                // Clear form data when switching back to search mode\r\n                clearFormData();\r\n              }\r\n              // Focus will be handled by the useEffect when visible changes\r\n            }}\r\n            style={{ minWidth: 120 }}\r\n          >\r\n            {showAddForm ? 'Cancel' : 'Add New'}\r\n          </Button>\r\n        </Space.Compact>\r\n      </div>\r\n\r\n      {/* Unified Create Form - Shows when search has no results or when Add New is clicked */}\r\n      {(showCreateGrid || showAddForm) && (\r\n        <div\r\n          ref={createGridRef}\r\n          style={{\r\n            marginBottom: 20,\r\n            padding: 24,\r\n            border: '2px solid #6366f1',\r\n            borderRadius: 16,\r\n            backgroundColor:\r\n              'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\r\n            background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\r\n            boxShadow:\r\n              '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',\r\n            position: 'relative',\r\n            overflow: 'hidden',\r\n          }}\r\n          tabIndex={-1}\r\n        >\r\n          {/* Decorative background elements */}\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              top: -20,\r\n              right: -20,\r\n              width: 100,\r\n              height: 100,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n              opacity: 0.1,\r\n              zIndex: 0,\r\n            }}\r\n          />\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              bottom: -30,\r\n              left: -30,\r\n              width: 80,\r\n              height: 80,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)',\r\n              opacity: 0.1,\r\n              zIndex: 0,\r\n            }}\r\n          />\r\n\r\n          <Row\r\n            justify=\"space-between\"\r\n            align=\"middle\"\r\n            style={{ marginBottom: 24, position: 'relative', zIndex: 1 }}\r\n          >\r\n            <Col>\r\n              <Title\r\n                level={4}\r\n                style={{\r\n                  margin: 0,\r\n                  background:\r\n                    'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n                  WebkitBackgroundClip: 'text',\r\n                  WebkitTextFillColor: 'transparent',\r\n                  backgroundClip: 'text',\r\n                  fontWeight: 700,\r\n                  fontSize: '20px',\r\n                }}\r\n              >\r\n                <PlusOutlined style={{ marginRight: 8, color: '#6366f1' }} />\r\n                Create New Customer\r\n              </Title>\r\n              <Text\r\n                style={{\r\n                  fontSize: '14px',\r\n                  color: '#64748b',\r\n                  fontWeight: 500,\r\n                  display: 'block',\r\n                  marginTop: 4,\r\n                }}\r\n              >\r\n                 Fill in the details below to create a new customer\r\n              </Text>\r\n            </Col>\r\n            <Col>\r\n              <Space size=\"middle\">\r\n                <Button\r\n                  size=\"middle\"\r\n                  icon={<CloseOutlined />}\r\n                  onClick={() => {\r\n                    setShowCreateGrid(false);\r\n                    setShowAddForm(false);\r\n                    refetchCustomerList(); // Refresh customer list after cancel\r\n                    clearFormData();\r\n                  }}\r\n                  style={{\r\n                    border: '2px solid #e2e8f0',\r\n                    borderRadius: 8,\r\n                    fontWeight: 600,\r\n                    color: '#64748b',\r\n                    background: 'white',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    height: 40,\r\n                    padding: '0 20px',\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </Button>\r\n                <Button\r\n                  type=\"primary\"\r\n                  size=\"middle\"\r\n                  icon={<SaveOutlined />}\r\n                  onClick={handleCreateCustomerFromForm}\r\n                  loading={createLoading}\r\n                  style={{\r\n                    background:\r\n                      'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n                    border: 'none',\r\n                    borderRadius: 8,\r\n                    fontWeight: 600,\r\n                    height: 40,\r\n                    padding: '0 24px',\r\n                    boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)',\r\n                    transition: 'all 0.3s ease',\r\n                  }}\r\n                >\r\n                  Create & Select\r\n                </Button>\r\n              </Space>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form\r\n            form={form}\r\n            layout=\"vertical\"\r\n            size=\"middle\"\r\n            style={{ position: 'relative', zIndex: 1 }}\r\n          >\r\n            <div\r\n              style={{\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 1fr',\r\n                gap: 20,\r\n                marginBottom: 20,\r\n              }}\r\n            >\r\n              <Form.Item\r\n                name=\"full_name\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <UserOutlined style={{ color: '#6366f1' }} />\r\n                    Full Name\r\n                  </span>\r\n                }\r\n                rules={[{ required: true, message: 'Please enter full name' }]}\r\n              >\r\n                <Input\r\n                  ref={firstFormInputRef}\r\n                  name=\"full_name\"\r\n                  placeholder=\"Enter full name\"\r\n                  prefix={<UserOutlined style={{ color: '#9ca3af' }} />}\r\n                  autoFocus={showAddForm || showCreateGrid}\r\n                  value={newCustomerData.full_name}\r\n                  onChange={e =>\r\n                    handleFormFieldChange('full_name', e.target.value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"mobile\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <PhoneOutlined style={{ color: '#10b981' }} />\r\n                    Mobile Number\r\n                  </span>\r\n                }\r\n                rules={[\r\n                  { required: true, message: 'Please enter mobile number' },\r\n                  {\r\n                    pattern: /^[0-9]{10}$/,\r\n                    message: 'Mobile must be 10 digits',\r\n                  },\r\n                ]}\r\n              >\r\n                <Input\r\n                  name=\"mobile\"\r\n                  placeholder=\"Enter mobile number\"\r\n                  prefix={<PhoneOutlined style={{ color: '#9ca3af' }} />}\r\n                  value={newCustomerData.mobile}\r\n                  onChange={e =>\r\n                    handleFormFieldChange('mobile', e.target.value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"email\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <MailOutlined style={{ color: '#f59e0b' }} />\r\n                    Email\r\n                  </span>\r\n                }\r\n                rules={[{ type: 'email', message: 'Please enter valid email' }]}\r\n              >\r\n                <Input\r\n                  name=\"email\"\r\n                  placeholder=\"Enter email\"\r\n                  prefix={<MailOutlined style={{ color: '#9ca3af' }} />}\r\n                  value={newCustomerData.email}\r\n                  onChange={e => handleFormFieldChange('email', e.target.value)}\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              {/* <Form.Item\r\n                name=\"customer_type\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <Tag\r\n                      style={{\r\n                        background:\r\n                          'linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)',\r\n                        color: 'white',\r\n                        border: 'none',\r\n                        borderRadius: 6,\r\n                        padding: '2px 8px',\r\n                        fontSize: '10px',\r\n                        fontWeight: 600,\r\n                      }}\r\n                    >\r\n                      TYPE\r\n                    </Tag>\r\n                    Customer Type\r\n                  </span>\r\n                }\r\n                initialValue=\"regular\"\r\n              >\r\n                <Select\r\n                  value={newCustomerData.customer_type}\r\n                  onChange={value =>\r\n                    handleFormFieldChange('customer_type', value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                >\r\n                  <Option value=\"regular\">Regular</Option>\r\n                  <Option value=\"vip\">VIP</Option>\r\n                  <Option value=\"wholesale\">Wholesale</Option>\r\n                </Select>\r\n              </Form.Item> */}\r\n            </div>\r\n\r\n            <Form.Item\r\n              name=\"address\"\r\n              label={\r\n                <span\r\n                  style={{\r\n                    fontWeight: 600,\r\n                    color: '#374151',\r\n                    fontSize: '14px',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: 6,\r\n                  }}\r\n                >\r\n                  <HomeOutlined style={{ color: '#ef4444' }} />\r\n                  Address\r\n                </span>\r\n              }\r\n            >\r\n              <Input.TextArea\r\n                name=\"address\"\r\n                placeholder=\"Enter address\"\r\n                rows={3}\r\n                value={newCustomerData.address}\r\n                onChange={e => handleFormFieldChange('address', e.target.value)}\r\n                onKeyDown={e => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    // If it's the last field, create the customer\r\n                    handleCreateCustomerFromForm();\r\n                  }\r\n                }}\r\n                style={{\r\n                  borderRadius: 10,\r\n                  border: '2px solid #e5e7eb',\r\n                  padding: '12px 16px',\r\n                  fontSize: '14px',\r\n                  transition: 'all 0.3s ease',\r\n                  boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                  background: 'white',\r\n                  resize: 'none',\r\n                }}\r\n              />\r\n            </Form.Item>\r\n          </Form>\r\n        </div>\r\n      )}\r\n\r\n      <Divider style={{ margin: '16px 0' }} />\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {customerLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading customers...</Text>\r\n          </div>\r\n        ) : filteredCustomers.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No customers found matching your search.'\r\n                : 'No customers available.'}\r\n            </Text>\r\n            {searchTerm && (\r\n              <div style={{ marginTop: 16 }}>\r\n                <Text type=\"secondary\">\r\n                  Press Ctrl+N to create a new customer instantly\r\n                </Text>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div\r\n            onScroll={(e: any) => {\r\n              const target = e.currentTarget;\r\n              const scrollTop = target.scrollTop;\r\n              const scrollHeight = target.scrollHeight;\r\n              const clientHeight = target.clientHeight;\r\n              const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\r\n              \r\n              if (scrollPercentage > 0.7 && hasMore && !customerLoading && !isLoadingMoreRef.current) {\r\n                isLoadingMoreRef.current = true;\r\n                setPage(prev => prev + 1);\r\n              }\r\n            }}\r\n            style={{ maxHeight: 360, overflowY: 'auto' }}\r\n          >\r\n            <Table\r\n              columns={columns}\r\n              dataSource={filteredCustomers}\r\n              rowKey=\"_id\"\r\n              pagination={false}\r\n              size=\"small\"\r\n              scroll={{ y: undefined }}\r\n              onRow={getRowProps}\r\n            />\r\n            {hasMore && filteredCustomers.length > 0 && (\r\n              <div style={{ textAlign: 'center', padding: '8px', color: '#999', borderTop: '1px solid #f0f0f0' }}>\r\n                {customerLoading ? 'Loading more...' : 'Scroll for more customers'}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\n// Memoize the component to prevent unnecessary re-renders\r\nconst CustomerSelectionModal = React.memo(CustomerSelectionModalComponent);\r\nexport default CustomerSelectionModal;\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Typography,\r\n  Table,\r\n  Tag,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  UserOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n} from '@ant-design/icons';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface User {\r\n  _id: string;\r\n  name: string;\r\n  email: string;\r\n  mobile: string;\r\n  user_name: string;\r\n  roleItems?: {\r\n    name: string;\r\n  };\r\n  branchItems?: {\r\n    branch_name: string;\r\n  };\r\n  organisationItems?: {\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface UserSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (user: User) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst UserSelectionModal: React.FC<UserSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [debouncedSearch, setDebouncedSearch] = useState('');\r\n  const [page, setPage] = useState(1);\r\n  const [allUsers, setAllUsers] = useState<User[]>([]);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n  \r\n  // Get current user from session storage\r\n  const currentUser = useMemo(() => {\r\n    return getCurrentUser();\r\n  }, []);\r\n\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isLoadingMoreRef = useRef(false);\r\n\r\n  // Use RTK Query for billing users with pagination\r\n  const { data: userData, isLoading: userLoading } = apiSlice.useGetBillingUsersQuery({\r\n    searchString: debouncedSearch,\r\n    pageNumber: page,\r\n    pageLimit: 10,\r\n  }, {\r\n    skip: !visible,\r\n    refetchOnMountOrArgChange: true,\r\n  });\r\n\r\n  // Accumulate users for infinite scroll\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n    \r\n    if (userData) {\r\n      const newItems = (userData as any)?.result || [];\r\n      const totalCount = (userData as any).pagination?.totalCount || (userData as any).pagination?.total || 0;\r\n      \r\n      if (page === 1) {\r\n        setAllUsers(newItems);\r\n        setHasMore(newItems.length < totalCount && newItems.length > 0);\r\n      } else {\r\n        setAllUsers(prev => {\r\n          const existingIds = new Set(prev.map((item: any) => item._id));\r\n          const uniqueNewItems = newItems.filter((item: any) => !existingIds.has(item._id));\r\n          const updated = [...prev, ...uniqueNewItems];\r\n          setHasMore(updated.length < totalCount && uniqueNewItems.length > 0);\r\n          return updated;\r\n        });\r\n      }\r\n      \r\n      isLoadingMoreRef.current = false;\r\n    }\r\n  }, [userData, page, visible]);\r\n\r\n  const filteredUsers = allUsers;\r\n\r\n  // Debounce search\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n\r\n    if (searchTerm === debouncedSearch) return;\r\n\r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n    \r\n    searchTimeoutRef.current = setTimeout(() => {\r\n      setDebouncedSearch(searchTerm);\r\n      setPage(1);\r\n      setAllUsers([]);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    }, 300);\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [searchTerm, debouncedSearch, visible]);\r\n\r\n  // Reset state when modal opens/closes\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setPage(1);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    } else {\r\n      setSearchTerm('');\r\n      setDebouncedSearch('');\r\n      setPage(1);\r\n      setAllUsers([]);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    }\r\n  }, [visible]);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToUser = useCallback(\r\n    (direction: 'up' | 'down' | 'home' | 'end') => {\r\n      if (filteredUsers.length === 0) return;\r\n\r\n      let newIndex: number;\r\n      switch (direction) {\r\n        case 'up':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? filteredUsers.length - 1\r\n              : Math.max(selectedRowIndex - 1, 0);\r\n          break;\r\n        case 'down':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? 0\r\n              : Math.min(selectedRowIndex + 1, filteredUsers.length - 1);\r\n          break;\r\n        case 'home':\r\n          newIndex = 0;\r\n          break;\r\n        case 'end':\r\n          newIndex = filteredUsers.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedUser(filteredUsers[newIndex]);\r\n\r\n      // Scroll to the selected row\r\n      setTimeout(() => {\r\n        const rowElement = document.querySelector(\r\n          `[data-row-key=\"${filteredUsers[newIndex]._id}\"]`\r\n        ) as HTMLElement;\r\n        if (rowElement) {\r\n          const scrollBehavior =\r\n            direction === 'home'\r\n              ? 'start'\r\n              : direction === 'end'\r\n                ? 'end'\r\n                : 'nearest';\r\n          rowElement.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: scrollBehavior,\r\n          });\r\n        }\r\n      }, 100);\r\n    },\r\n    [filteredUsers, selectedRowIndex]\r\n  );\r\n\r\n  // Debounced search function\r\n  const handleSearch = useCallback(\r\n    (value: string) => {\r\n      setSearchTerm(value);\r\n\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n\r\n      // Search will be handled client-side from cached RTK Query data\r\n      // For server-side search, use refetch with query parameters\r\n      // TODO: Implement server-side search with RTK Query if needed\r\n    },\r\n    []\r\n  );\r\n\r\n  // Handle user selection\r\n  const handleUserSelect = useCallback(\r\n    (user: User) => {\r\n      setSelectedUser(user);\r\n      onSelect(user);\r\n      setTimeout(() => onCancel(), 100);\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Handle keyboard events\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onCancel();\r\n      } else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToUser(directionMap[e.key]);\r\n      }\r\n    },\r\n    [navigateToUser, onCancel]\r\n  );\r\n\r\n  // Global keyboard event handler\r\n  const handleGlobalKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (!visible) return;\r\n\r\n      // Don't interfere if user is typing in form inputs\r\n      const target = e.target as HTMLElement;\r\n      if (\r\n        target.tagName === 'INPUT' ||\r\n        target.tagName === 'TEXTAREA' ||\r\n        target.classList.contains('ant-select-selector') ||\r\n        target.closest('.ant-select-dropdown')\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === 'f') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Only handle navigation keys globally when not in form inputs\r\n      if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToUser(directionMap[e.key]);\r\n      }\r\n    },\r\n    [visible, navigateToUser]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: User) => (\r\n          <div\r\n            style={{\r\n              cursor: 'pointer',\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n            }}\r\n            onClick={() => {\r\n              setSelectedUser(record);\r\n              const index = filteredUsers.findIndex(\r\n                (u: User) => u._id === record._id\r\n              );\r\n              setSelectedRowIndex(index);\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                borderRadius: '50%',\r\n                border:\r\n                  selectedUser?._id === record._id\r\n                    ? '2px solid #1890ff'\r\n                    : '2px solid #d9d9d9',\r\n                backgroundColor:\r\n                  selectedUser?._id === record._id ? '#1890ff' : 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedUser?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Name',\r\n        dataIndex: 'name',\r\n        key: 'name',\r\n        render: (text: string, record: User) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <UserOutlined style={{ color: '#1890ff' }} />\r\n            <div>\r\n              <Text strong>{text}</Text>\r\n              <br />\r\n              <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n                @{record.user_name}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Role',\r\n        key: 'role',\r\n        render: (text: string, record: User) => (\r\n          <Tag color=\"blue\">\r\n            {record.roleItems?.name || 'No Role'}\r\n          </Tag>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Mobile',\r\n        dataIndex: 'mobile',\r\n        key: 'mobile',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Branch',\r\n        key: 'branch',\r\n        render: (text: string, record: User) => (\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            {record.branchItems?.branch_name || '-'}\r\n          </Text>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedUser, filteredUsers]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: User, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedUser(record);\r\n        setSelectedRowIndex(index ?? 0);\r\n      },\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedUser?._id === record._id ? '#f0f8ff' : 'white',\r\n        border:\r\n          selectedUser?._id === record._id\r\n            ? '2px solid #1890ff'\r\n            : '1px solid #f0f0f0',\r\n        borderRadius: '4px',\r\n        transition: 'all 0.2s ease',\r\n      },\r\n      onMouseEnter: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedUser?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = '#f5f5f5';\r\n        }\r\n      },\r\n      onMouseLeave: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedUser?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = 'white';\r\n        }\r\n      },\r\n    }),\r\n    [selectedUser]\r\n  );\r\n\r\n  // Handle modal close (RTK Query automatically loads on mount)\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setSelectedUser(null);\r\n      setSelectedRowIndex(-1);\r\n    } else {\r\n      setSearchTerm('');\r\n      setSelectedUser(null);\r\n      setSelectedRowIndex(-1);\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = null;\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [visible]);\r\n\r\n  // Auto-select current user when users are loaded\r\n  useEffect(() => {\r\n    if (visible && filteredUsers.length > 0 && currentUser?._id && !selectedUser) {\r\n      const currentUserInList = filteredUsers.find((user: User) => user._id === currentUser._id);\r\n      if (currentUserInList) {\r\n        setSelectedUser(currentUserInList);\r\n        const index = filteredUsers.findIndex((user: User) => user._id === currentUser._id);\r\n        setSelectedRowIndex(index);\r\n        \r\n        // Scroll to the selected user after a short delay\r\n        setTimeout(() => {\r\n          const rowElement = document.querySelector(\r\n            `[data-row-key=\"${currentUserInList._id}\"]`\r\n          ) as HTMLElement;\r\n          if (rowElement) {\r\n            rowElement.scrollIntoView({\r\n              behavior: 'smooth',\r\n              block: 'center',\r\n            });\r\n          }\r\n        }, 200);\r\n      }\r\n    }\r\n  }, [visible, filteredUsers, currentUser?._id, selectedUser]);\r\n\r\n  // Focus search input when modal becomes visible\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current) {\r\n      const focusSearch = () => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n      };\r\n\r\n      focusSearch();\r\n      const timer = setTimeout(focusSearch, 100);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [visible]);\r\n\r\n  // Global keyboard event listener\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('keydown', handleGlobalKeyDown, true);\r\n      return () =>\r\n        document.removeEventListener('keydown', handleGlobalKeyDown, true);\r\n    }\r\n  }, [visible, handleGlobalKeyDown]);\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedUser(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select User (Billed By)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={900}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Input\r\n          ref={searchInputRef}\r\n          placeholder=\"Search users... (: Navigate, Enter: Select, Esc: Close)\"\r\n          value={searchTerm}\r\n          onChange={e => handleSearch(e.target.value)}\r\n          prefix={<SearchOutlined />}\r\n          style={{ width: '100%' }}\r\n          onKeyDown={e => {\r\n            // Only handle Enter key in search input, let other keys bubble up\r\n            if (e.key === 'Enter' && selectedUser) {\r\n              handleUserSelect(selectedUser);\r\n            }\r\n          }}\r\n          onFocus={handleSearchFocus}\r\n          autoFocus\r\n          onBlur={() => {\r\n            // Auto-focus back to search if modal is still visible\r\n            if (visible && searchInputRef.current) {\r\n              setTimeout(() => {\r\n                if (visible && searchInputRef.current) {\r\n                  searchInputRef.current.focus();\r\n                }\r\n              }, 10);\r\n            }\r\n          }}\r\n          suffix={\r\n            searchTerm && userLoading ? (\r\n              <div style={{ fontSize: '12px', color: '#999' }}>\r\n                Searching...\r\n              </div>\r\n            ) : null\r\n          }\r\n        />\r\n      </div>\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {userLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading users...</Text>\r\n          </div>\r\n        ) : filteredUsers.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No users found matching your search.'\r\n                : 'No users available.'}\r\n            </Text>\r\n          </div>\r\n        ) : (\r\n          <div\r\n            onScroll={(e: any) => {\r\n              const target = e.currentTarget;\r\n              const scrollTop = target.scrollTop;\r\n              const scrollHeight = target.scrollHeight;\r\n              const clientHeight = target.clientHeight;\r\n              const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\r\n              \r\n              if (scrollPercentage > 0.7 && hasMore && !userLoading && !isLoadingMoreRef.current) {\r\n                isLoadingMoreRef.current = true;\r\n                setPage(prev => prev + 1);\r\n              }\r\n            }}\r\n            style={{ maxHeight: 360, overflowY: 'auto' }}\r\n          >\r\n            <Table\r\n              columns={columns}\r\n              dataSource={filteredUsers}\r\n              rowKey=\"_id\"\r\n              pagination={false}\r\n              size=\"small\"\r\n              scroll={{ y: undefined }}\r\n              onRow={getRowProps}\r\n            />\r\n            {hasMore && filteredUsers.length > 0 && (\r\n              <div style={{ textAlign: 'center', padding: '8px', color: '#999', borderTop: '1px solid #f0f0f0' }}>\r\n                {userLoading ? 'Loading more...' : 'Scroll for more users'}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default UserSelectionModal;\r\n","import React, { useEffect, useRef, useCallback } from 'react';\r\nimport { Modal, Button, Typography, Space, Divider, Badge } from 'antd';\r\nimport { \r\n  FileTextOutlined, \r\n  PlusOutlined, \r\n  CheckCircleOutlined,\r\n  DollarOutlined,\r\n  UserOutlined,\r\n  CalendarOutlined,\r\n  EnterOutlined,\r\n  CloseOutlined\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillSaveConfirmationModalProps {\r\n  visible: boolean;\r\n  onNewBill: () => void;\r\n  onContinueBill: () => void;\r\n  onCancel: () => void;\r\n  savedBillData?: any;\r\n  onOpenProductModal?: () => void; // Callback to open product selection\r\n}\r\n\r\nconst BillSaveConfirmationModal: React.FC<BillSaveConfirmationModalProps> = ({\r\n  visible,\r\n  onNewBill,\r\n  onContinueBill,\r\n  onCancel,\r\n  savedBillData,\r\n  onOpenProductModal\r\n}) => {\r\n  const newBillButtonRef = useRef<HTMLButtonElement>(null);\r\n\r\n  // Handle new bill with auto-open product modal\r\n  const handleNewBill = useCallback(() => {\r\n    onNewBill();\r\n    // Open product selection modal after a short delay to allow form reset\r\n    if (onOpenProductModal) {\r\n      setTimeout(() => {\r\n        onOpenProductModal();\r\n      }, 100);\r\n    }\r\n  }, [onNewBill, onOpenProductModal]);\r\n\r\n  // Keyboard shortcuts\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // Enter = New Bill (primary action)\r\n      if (e.key === 'Enter' && !e.ctrlKey) {\r\n        e.preventDefault();\r\n        handleNewBill();\r\n      }\r\n      // Ctrl+Enter = Continue Bill\r\n      else if (e.key === 'Enter' && e.ctrlKey) {\r\n        e.preventDefault();\r\n        onContinueBill();\r\n      }\r\n      // Escape = Close\r\n      else if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        onCancel();\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    \r\n    // Auto-focus on the primary button\r\n    if (newBillButtonRef.current) {\r\n      newBillButtonRef.current.focus();\r\n    }\r\n\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [visible, handleNewBill, onContinueBill, onCancel]);\r\n\r\n  return (\r\n    <Modal\r\n      title={null}\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={540}\r\n      centered\r\n      maskClosable={false}\r\n      closable={false}\r\n      bodyStyle={{ padding: '24px 20px' }}\r\n    >\r\n      {/* Success Header with Animation */}\r\n      <div style={{ textAlign: 'center', marginBottom: '20px' }}>\r\n        <div \r\n          style={{ \r\n            display: 'inline-block',\r\n            animation: 'successPulse 0.6s ease-out',\r\n            marginBottom: '12px'\r\n          }}\r\n        >\r\n          <CheckCircleOutlined \r\n            style={{ \r\n              color: '#10b981', \r\n              fontSize: '48px',\r\n              filter: 'drop-shadow(0 4px 12px rgba(16, 185, 129, 0.3))'\r\n            }} \r\n          />\r\n        </div>\r\n        <Title level={4} style={{ margin: '6px 0', color: '#10b981', fontWeight: 700 }}>\r\n          Bill Saved Successfully!\r\n        </Title>\r\n        <Text type=\"secondary\" style={{ fontSize: '13px' }}>\r\n          Choose your next action using keyboard shortcuts\r\n        </Text>\r\n      </div>\r\n\r\n      {/* Bill Summary Card */}\r\n      {savedBillData && (\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)',\r\n            border: '2px solid #10b981',\r\n            borderRadius: '10px',\r\n            padding: '14px',\r\n            marginBottom: '20px',\r\n            boxShadow: '0 4px 16px rgba(16, 185, 129, 0.1)',\r\n          }}\r\n        >\r\n          <div style={{ display: 'flex', alignItems: 'center', marginBottom: '12px' }}>\r\n            <FileTextOutlined style={{ fontSize: '16px', color: '#059669', marginRight: '6px' }} />\r\n            <Title level={5} style={{ margin: 0, color: '#059669', fontSize: '14px' }}>\r\n              Bill Summary\r\n            </Title>\r\n          </div>\r\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\r\n            <div style={{ \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              gap: '8px',\r\n              padding: '6px 10px',\r\n              background: 'rgba(255, 255, 255, 0.7)',\r\n              borderRadius: '6px'\r\n            }}>\r\n              <FileTextOutlined style={{ color: '#10b981', fontSize: '14px' }} />\r\n              <div>\r\n                <Text type=\"secondary\" style={{ fontSize: '10px', display: 'block' }}>Invoice</Text>\r\n                <Text strong style={{ fontSize: '12px' }}>{savedBillData.invoice_no}</Text>\r\n              </div>\r\n            </div>\r\n            <div style={{ \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              gap: '8px',\r\n              padding: '6px 10px',\r\n              background: 'rgba(255, 255, 255, 0.7)',\r\n              borderRadius: '6px'\r\n            }}>\r\n              <UserOutlined style={{ color: '#10b981', fontSize: '14px' }} />\r\n              <div>\r\n                <Text type=\"secondary\" style={{ fontSize: '10px', display: 'block' }}>Customer</Text>\r\n                <Text strong style={{ fontSize: '12px' }}>{savedBillData.customer_name || 'N/A'}</Text>\r\n              </div>\r\n            </div>\r\n            <div style={{ \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              gap: '8px',\r\n              padding: '6px 10px',\r\n              background: 'rgba(255, 255, 255, 0.7)',\r\n              borderRadius: '6px'\r\n            }}>\r\n              <CalendarOutlined style={{ color: '#10b981', fontSize: '14px' }} />\r\n              <div>\r\n                <Text type=\"secondary\" style={{ fontSize: '10px', display: 'block' }}>Date</Text>\r\n                <Text strong style={{ fontSize: '12px' }}>{dayjs(savedBillData.date).format('DD/MM/YYYY')}</Text>\r\n              </div>\r\n            </div>\r\n            <div style={{ \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              gap: '8px',\r\n              padding: '6px 10px',\r\n              background: 'rgba(255, 255, 255, 0.7)',\r\n              borderRadius: '6px'\r\n            }}>\r\n              <DollarOutlined style={{ color: '#10b981', fontSize: '14px' }} />\r\n              <div>\r\n                <Text type=\"secondary\" style={{ fontSize: '10px', display: 'block' }}>Amount</Text>\r\n                <Text strong style={{ fontSize: '12px', color: '#059669' }}>\r\n                  {(typeof savedBillData.total_amount === 'number' ? savedBillData.total_amount : parseFloat(savedBillData.total_amount) || 0).toFixed(2)}\r\n                </Text>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <Divider style={{ margin: '18px 0', borderColor: '#e5e7eb' }} />\r\n\r\n      {/* Action Buttons with Keyboard Hints */}\r\n      <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n        <Button\r\n          ref={newBillButtonRef}\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          icon={<PlusOutlined />}\r\n          onClick={handleNewBill}\r\n          style={{\r\n            width: '100%',\r\n            height: '48px',\r\n            background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n            border: 'none',\r\n            fontWeight: 600,\r\n            fontSize: '15px',\r\n            borderRadius: '8px',\r\n            boxShadow: '0 4px 16px rgba(16, 185, 129, 0.3)',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            position: 'relative',\r\n            transition: 'all 0.3s ease'\r\n          }}\r\n          onMouseEnter={(e) => {\r\n            e.currentTarget.style.transform = 'translateY(-2px)';\r\n            e.currentTarget.style.boxShadow = '0 6px 20px rgba(16, 185, 129, 0.4)';\r\n          }}\r\n          onMouseLeave={(e) => {\r\n            e.currentTarget.style.transform = 'translateY(0)';\r\n            e.currentTarget.style.boxShadow = '0 4px 16px rgba(16, 185, 129, 0.3)';\r\n          }}\r\n        >\r\n          <span style={{ flex: 1, textAlign: 'left', marginLeft: '8px' }}>\r\n             Create New Bill\r\n          </span>\r\n          <Badge \r\n            count={<span style={{ \r\n              background: 'rgba(255, 255, 255, 0.3)',\r\n              padding: '3px 8px',\r\n              borderRadius: '5px',\r\n              fontSize: '11px',\r\n              fontWeight: 600,\r\n              color: 'white',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '3px'\r\n            }}>\r\n              <EnterOutlined /> Enter\r\n            </span>} \r\n            style={{ marginRight: '6px' }}\r\n          />\r\n        </Button>\r\n        \r\n        <Button\r\n          size=\"large\"\r\n          icon={<FileTextOutlined />}\r\n          onClick={onContinueBill}\r\n          style={{\r\n            width: '100%',\r\n            height: '48px',\r\n            background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\r\n            color: 'white',\r\n            border: 'none',\r\n            fontWeight: 600,\r\n            fontSize: '15px',\r\n            borderRadius: '8px',\r\n            boxShadow: '0 4px 16px rgba(59, 130, 246, 0.3)',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            position: 'relative',\r\n            transition: 'all 0.3s ease'\r\n          }}\r\n          onMouseEnter={(e) => {\r\n            e.currentTarget.style.transform = 'translateY(-2px)';\r\n            e.currentTarget.style.boxShadow = '0 6px 20px rgba(59, 130, 246, 0.4)';\r\n          }}\r\n          onMouseLeave={(e) => {\r\n            e.currentTarget.style.transform = 'translateY(0)';\r\n            e.currentTarget.style.boxShadow = '0 4px 16px rgba(59, 130, 246, 0.3)';\r\n          }}\r\n        >\r\n          <span style={{ flex: 1, textAlign: 'left', marginLeft: '8px' }}>\r\n             Continue with Current Bill\r\n          </span>\r\n          <Badge \r\n            count={<span style={{ \r\n              background: 'rgba(255, 255, 255, 0.3)',\r\n              padding: '3px 8px',\r\n              borderRadius: '5px',\r\n              fontSize: '11px',\r\n              fontWeight: 600,\r\n              color: 'white',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '3px'\r\n            }}>\r\n              Ctrl+<EnterOutlined />\r\n            </span>} \r\n            style={{ marginRight: '6px' }}\r\n          />\r\n        </Button>\r\n\r\n        {/* Close Button */}\r\n        <Button\r\n          size=\"middle\"\r\n          icon={<CloseOutlined />}\r\n          onClick={onCancel}\r\n          type=\"text\"\r\n          style={{\r\n            width: '100%',\r\n            height: '36px',\r\n            fontWeight: 500,\r\n            fontSize: '13px',\r\n            color: '#6b7280',\r\n            transition: 'all 0.3s ease'\r\n          }}\r\n          onMouseEnter={(e) => {\r\n            e.currentTarget.style.color = '#374151';\r\n            e.currentTarget.style.background = '#f3f4f6';\r\n          }}\r\n          onMouseLeave={(e) => {\r\n            e.currentTarget.style.color = '#6b7280';\r\n            e.currentTarget.style.background = 'transparent';\r\n          }}\r\n        >\r\n          Close (ESC)\r\n        </Button>\r\n      </Space>\r\n\r\n      {/* Keyboard Shortcuts Info */}\r\n      <div style={{ \r\n        marginTop: '16px',\r\n        padding: '10px 12px',\r\n        background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)',\r\n        borderRadius: '6px',\r\n        border: '1px solid #fbbf24'\r\n      }}>\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n          <span style={{ fontSize: '14px' }}></span>\r\n          <div style={{ flex: 1 }}>\r\n            <Text style={{ fontSize: '11px', color: '#78350f', lineHeight: '1.5' }}>\r\n              <strong>Enter</strong> = New Bill  <strong>Ctrl+Enter</strong> = Continue  <strong>ESC</strong> = Close\r\n            </Text>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* CSS Animation */}\r\n      <style>{`\r\n        @keyframes successPulse {\r\n          0% {\r\n            transform: scale(0);\r\n            opacity: 0;\r\n          }\r\n          50% {\r\n            transform: scale(1.1);\r\n          }\r\n          100% {\r\n            transform: scale(1);\r\n            opacity: 1;\r\n          }\r\n        }\r\n      `}</style>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default BillSaveConfirmationModal;\r\n","import React, { useState, useEffect, useMemo } from 'react';\r\nimport { \r\n  Drawer, \r\n  List, \r\n  Typography, \r\n  Button, \r\n  Input, \r\n  Space, \r\n  Tag, \r\n  Avatar, \r\n  Badge,\r\n  Tooltip,\r\n  Divider,\r\n  Empty,\r\n  Spin,\r\n  Tabs\r\n} from 'antd';\r\nimport { \r\n  SearchOutlined, \r\n  FileTextOutlined, \r\n  UserOutlined, \r\n  CalendarOutlined,\r\n  DollarOutlined,\r\n  EyeOutlined,\r\n  PrinterOutlined,\r\n  PlusOutlined,\r\n  CloseOutlined\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Search } = Input;\r\n\r\ninterface BillListDrawerProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onViewBill: (bill: any) => void;\r\n  onNewBill: () => void;\r\n}\r\n\r\nconst BillListDrawer: React.FC<BillListDrawerProps> = ({\r\n  visible,\r\n  onClose,\r\n  onViewBill,\r\n  onNewBill\r\n}) => {\r\n  // Use RTK Query for sales records - Only fetch when drawer is open\r\n  const { data: billListData, isLoading: loading } = apiSlice.useGetSalesRecordQuery(\r\n    {},\r\n    { skip: !visible } //  Only fetch when drawer is visible\r\n  );\r\n  \r\n  // Memoize billList to prevent infinite re-renders\r\n  const billList = useMemo(() => {\r\n    return (billListData as any)?.result || [];\r\n  }, [billListData]);\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [activeTab, setActiveTab] = useState<string>('drafts');\r\n\r\n  // Filter bills based on status and search term\r\n  const filteredBills = useMemo(() => {\r\n    if (!billList || !Array.isArray(billList)) return [];\r\n    \r\n    // First filter by status\r\n    let statusFiltered = billList;\r\n    if (activeTab === 'drafts') {\r\n      statusFiltered = billList.filter((bill: any) => bill.status === 'draft');\r\n    } else {\r\n      statusFiltered = billList.filter((bill: any) => \r\n        !bill.status || bill.status === 'completed'\r\n      );\r\n    }\r\n    \r\n    // Then filter by search term\r\n    if (!searchTerm) return statusFiltered;\r\n    \r\n    const searchLower = searchTerm.toLowerCase();\r\n    return statusFiltered.filter((bill: any) => {\r\n      const invoiceNo = bill.invoice_no || '';\r\n      const customerName = bill.customerDetails?.full_name || '';\r\n      const date = bill.date || '';\r\n      const totalAmount = typeof bill.total_amount === 'number' ? bill.total_amount.toString() : String(bill.total_amount || '');\r\n      \r\n      return (\r\n        invoiceNo.toLowerCase().includes(searchLower) ||\r\n        customerName.toLowerCase().includes(searchLower) ||\r\n        date.includes(searchTerm) ||\r\n        totalAmount.includes(searchTerm)\r\n      );\r\n    });\r\n  }, [billList, searchTerm, activeTab]);\r\n\r\n  const getPaymentStatusColor = (isPaid: boolean, isPartiallyPaid: boolean) => {\r\n    if (isPaid && !isPartiallyPaid) return 'success';\r\n    if (isPartiallyPaid) return 'warning';\r\n    return 'error';\r\n  };\r\n\r\n  const getPaymentStatusText = (isPaid: boolean, isPartiallyPaid: boolean) => {\r\n    if (isPaid && !isPartiallyPaid) return 'Paid';\r\n    if (isPartiallyPaid) return 'Partial';\r\n    return 'Unpaid';\r\n  };\r\n\r\n  const handleViewBill = (bill: any) => {\r\n\r\n    onViewBill(bill);\r\n    onClose();\r\n  };\r\n\r\n  const handleNewBill = () => {\r\n    onNewBill();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n          <Title level={4} style={{ margin: 0, color: '#1f2937' }}>\r\n             Bill List\r\n          </Title>\r\n          <Button\r\n            type=\"text\"\r\n            icon={<CloseOutlined />}\r\n            onClick={onClose}\r\n            size=\"small\"\r\n          />\r\n        </div>\r\n      }\r\n      placement=\"left\"\r\n      open={visible}\r\n      onClose={onClose}\r\n      width={400}\r\n      bodyStyle={{ padding: '16px' }}\r\n      headerStyle={{ \r\n        borderBottom: '1px solid #e5e7eb',\r\n        padding: '16px 16px 12px 16px'\r\n      }}\r\n    >\r\n      {/* Search and New Bill Section */}\r\n      <div style={{ marginBottom: '16px' }}>\r\n        <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n          <Search\r\n            placeholder=\"Search bills by invoice, customer, date...\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n            prefix={<SearchOutlined />}\r\n            allowClear\r\n            size=\"large\"\r\n          />\r\n          \r\n          <Button\r\n            type=\"primary\"\r\n            icon={<PlusOutlined />}\r\n            onClick={handleNewBill}\r\n            style={{\r\n              width: '100%',\r\n              height: '40px',\r\n              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n              border: 'none',\r\n              fontWeight: 600,\r\n              borderRadius: '8px',\r\n            }}\r\n          >\r\n             Create New Bill\r\n          </Button>\r\n        </Space>\r\n      </div>\r\n\r\n      <Divider style={{ margin: '16px 0' }} />\r\n\r\n      {/* Tabs for Drafts and Completed */}\r\n      <Tabs\r\n        activeKey={activeTab}\r\n        onChange={setActiveTab}\r\n        items={[\r\n          {\r\n            key: 'drafts',\r\n            label: (\r\n              <span>\r\n                 Drafts ({billList?.filter((b: any) => b.status === 'draft').length || 0})\r\n              </span>\r\n            ),\r\n          },\r\n          {\r\n            key: 'completed',\r\n            label: (\r\n              <span>\r\n                 Completed ({billList?.filter((b: any) => !b.status || b.status === 'completed').length || 0})\r\n              </span>\r\n            ),\r\n          },\r\n        ]}\r\n        style={{ marginBottom: 16 }}\r\n      />\r\n\r\n      {/* Bill List */}\r\n      <div style={{ height: 'calc(100vh - 250px)', overflow: 'auto' }}>\r\n        {loading ? (\r\n          <div style={{ textAlign: 'center', padding: '40px' }}>\r\n            <Spin size=\"large\" />\r\n            <div style={{ marginTop: '16px' }}>\r\n              <Text type=\"secondary\">Loading bills...</Text>\r\n            </div>\r\n          </div>\r\n        ) : filteredBills.length === 0 ? (\r\n          <Empty\r\n            description={\r\n              <div>\r\n                <Text type=\"secondary\">\r\n                  {searchTerm ? 'No bills found matching your search.' : 'No bills available.'}\r\n                </Text>\r\n                {!searchTerm && (\r\n                  <div style={{ marginTop: '8px' }}>\r\n                    <Button type=\"link\" onClick={handleNewBill}>\r\n                      Create your first bill\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            }\r\n            style={{ marginTop: '40px' }}\r\n          />\r\n        ) : (\r\n          <List\r\n            dataSource={filteredBills}\r\n            renderItem={(bill) => (\r\n              <List.Item\r\n                style={{\r\n                  padding: '16px',\r\n                  border: '1px solid #e5e7eb',\r\n                  borderRadius: '8px',\r\n                  marginBottom: '12px',\r\n                  background: 'white',\r\n                  cursor: 'pointer',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onMouseEnter={(e) => {\r\n                  e.currentTarget.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';\r\n                  e.currentTarget.style.transform = 'translateY(-2px)';\r\n                }}\r\n                onMouseLeave={(e) => {\r\n                  e.currentTarget.style.boxShadow = 'none';\r\n                  e.currentTarget.style.transform = 'translateY(0)';\r\n                }}\r\n                onClick={() => handleViewBill(bill)}\r\n              >\r\n                <div style={{ width: '100%' }}>\r\n                  {/* Header with Invoice and Status */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center',\r\n                    marginBottom: '8px'\r\n                  }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <Avatar \r\n                        icon={<FileTextOutlined />} \r\n                        style={{ \r\n                          background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\r\n                          color: 'white'\r\n                        }} \r\n                      />\r\n                      <Text strong style={{ fontSize: '14px' }}>\r\n                        {bill.invoice_no}\r\n                      </Text>\r\n                    </div>\r\n                    <Space>\r\n                      {bill.status === 'draft' ? (\r\n                        <Tag color=\"orange\">DRAFT</Tag>\r\n                      ) : (\r\n                        <Tag color=\"green\">COMPLETED</Tag>\r\n                      )}\r\n                      <Tag color={getPaymentStatusColor(bill.is_paid, bill.is_partially_paid)}>\r\n                        {getPaymentStatusText(bill.is_paid, bill.is_partially_paid)}\r\n                      </Tag>\r\n                    </Space>\r\n                  </div>\r\n\r\n                  {/* Customer Info */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    alignItems: 'center', \r\n                    gap: '8px',\r\n                    marginBottom: '6px'\r\n                  }}>\r\n                    <UserOutlined style={{ color: '#6b7280', fontSize: '12px' }} />\r\n                    <Text style={{ fontSize: '12px', color: '#374151' }}>\r\n                      {bill.customerDetails?.full_name || bill.customer_name || 'N/A'}\r\n                    </Text>\r\n                  </div>\r\n\r\n                  {/* Date and Amount */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center'\r\n                  }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <CalendarOutlined style={{ color: '#6b7280', fontSize: '12px' }} />\r\n                      <Text style={{ fontSize: '12px', color: '#6b7280' }}>\r\n                        {bill.date ? dayjs(bill.date).format('DD/MM/YYYY') : 'N/A'}\r\n                      </Text>\r\n                    </div>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <DollarOutlined style={{ color: '#10b981', fontSize: '12px' }} />\r\n                      <Text strong style={{ fontSize: '14px', color: '#10b981' }}>\r\n                        {(typeof bill.total_amount === 'number' ? bill.total_amount : parseFloat(bill.total_amount) || 0).toFixed(2)}\r\n                      </Text>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Action Buttons */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    gap: '8px', \r\n                    marginTop: '12px',\r\n                    justifyContent: 'flex-end'\r\n                  }}>\r\n                    <Tooltip title=\"View Bill\">\r\n                      <Button\r\n                        type=\"text\"\r\n                        icon={<EyeOutlined />}\r\n                        size=\"small\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          handleViewBill(bill);\r\n                        }}\r\n                        style={{ color: '#3b82f6' }}\r\n                      />\r\n                    </Tooltip>\r\n                    {bill.status !== 'draft' && (\r\n                      <Tooltip title=\"Print Bill\">\r\n                        <Button\r\n                          type=\"text\"\r\n                          icon={<PrinterOutlined />}\r\n                          size=\"small\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            // Handle print functionality\r\n                          }}\r\n                          style={{ color: '#10b981' }}\r\n                        />\r\n                      </Tooltip>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </List.Item>\r\n            )}\r\n            pagination={false}\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      {/* Footer Stats */}\r\n      <div style={{ \r\n        position: 'absolute', \r\n        bottom: 0, \r\n        left: 0, \r\n        right: 0, \r\n        padding: '16px',\r\n        background: 'white',\r\n        borderTop: '1px solid #e5e7eb'\r\n      }}>\r\n        <div style={{ \r\n          display: 'flex', \r\n          justifyContent: 'space-between', \r\n          alignItems: 'center'\r\n        }}>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            Total Bills: {filteredBills.length}\r\n          </Text>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n             Click on any bill to view details\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Drawer>\r\n  );\r\n};\r\n\r\nexport default BillListDrawer;\r\n","import React, { FC, useEffect, useState } from 'react';\r\nimport { Modal, Descriptions, Typography, Tag, Divider } from 'antd';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface ProductDetailsModalProps {\r\n  visible: boolean;\r\n  onCancel: () => void;\r\n  productId: string;\r\n}\r\n\r\ninterface ProductDetails {\r\n  _id: string;\r\n  name: string;\r\n  sku: string;\r\n  description?: string;\r\n  selling_price: number;\r\n  mrp: number;\r\n  VariantItem?: {\r\n    variant_name: string;\r\n    variant_code?: string;\r\n  };\r\n  CategoryItem?: {\r\n    name: string;\r\n    tax_percentage: number;\r\n  };\r\n  brand?: string;\r\n  unit?: string;\r\n  min_stock?: number;\r\n  max_stock?: number;\r\n}\r\n\r\nconst ProductDetailsModal: FC<ProductDetailsModalProps> = ({\r\n  visible,\r\n  onCancel,\r\n  productId,\r\n}) => {\r\n  const [productDetails, setProductDetails] = useState<ProductDetails | null>(null);\r\n\r\n  // Load product when modal opens\r\n  const { data: productData, isLoading: loading } = apiSlice.useGetProductQuery({\r\n    _id: productId,\r\n  }, { skip: !visible || !productId });\r\n\r\n  useEffect(() => {\r\n    if (visible && productId && productData) {\r\n      const products = (productData as any)?.result || [];\r\n      const product = Array.isArray(products) ? products.find((p: any) => p._id === productId) : null;\r\n      if (product) {\r\n        setProductDetails(product);\r\n      }\r\n    }\r\n  }, [visible, productId, productData]);\r\n\r\n  const handleCancel = () => {\r\n    setProductDetails(null);\r\n    onCancel();\r\n  };\r\n\r\n  if (!productDetails) {\r\n    return (\r\n      <Modal\r\n        title=\"Product Details\"\r\n        open={visible}\r\n        onCancel={handleCancel}\r\n        footer={null}\r\n        width={600}\r\n        destroyOnClose\r\n      >\r\n        <div style={{ textAlign: 'center', padding: '40px 20px' }}>\r\n          {loading ? (\r\n            <Text>Loading product details...</Text>\r\n          ) : (\r\n            <Text type=\"secondary\">Product not found</Text>\r\n          )}\r\n        </div>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n          <span> Product Details</span>\r\n          <Tag color=\"blue\" style={{ margin: 0 }}>\r\n            {productDetails.sku}\r\n          </Tag>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={handleCancel}\r\n      footer={null}\r\n      width={700}\r\n      destroyOnClose\r\n    >\r\n      <div style={{ padding: '16px 0' }}>\r\n        {/* Product Name and Variant */}\r\n        <div style={{ marginBottom: '24px' }}>\r\n          <Title level={4} style={{ margin: '0 0 8px 0', color: '#1890ff' }}>\r\n            {productDetails.name}\r\n          </Title>\r\n          {productDetails.VariantItem?.variant_name && (\r\n            <Tag color=\"green\" style={{ fontSize: '12px' }}>\r\n              Variant: {productDetails.VariantItem.variant_name}\r\n            </Tag>\r\n          )}\r\n        </div>\r\n\r\n        <Divider style={{ margin: '16px 0' }} />\r\n\r\n        {/* Product Information */}\r\n        <Descriptions\r\n          title=\"Product Information\"\r\n          column={2}\r\n          size=\"small\"\r\n          bordered\r\n          style={{ marginBottom: '24px' }}\r\n        >\r\n          <Descriptions.Item label=\"Product Name\" span={2}>\r\n            <Text strong>{productDetails.name}</Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.VariantItem?.variant_name && (\r\n            <Descriptions.Item label=\"Variant Name\">\r\n              <Text>{productDetails.VariantItem.variant_name}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.VariantItem?.variant_code && (\r\n            <Descriptions.Item label=\"Variant Code\">\r\n              <Text code>{productDetails.VariantItem.variant_code}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          <Descriptions.Item label=\"SKU\">\r\n            <Text code>{productDetails.sku}</Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.brand && (\r\n            <Descriptions.Item label=\"Brand\">\r\n              <Text>{productDetails.brand}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.unit && (\r\n            <Descriptions.Item label=\"Unit\">\r\n              <Text>{productDetails.unit}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.description && (\r\n            <Descriptions.Item label=\"Description\" span={2}>\r\n              <Text>{productDetails.description}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n        </Descriptions>\r\n\r\n        {/* Pricing Information */}\r\n        <Descriptions\r\n          title=\"Pricing & Tax\"\r\n          column={2}\r\n          size=\"small\"\r\n          bordered\r\n          style={{ marginBottom: '24px' }}\r\n        >\r\n          <Descriptions.Item label=\"Selling Price\">\r\n            <Text strong style={{ color: '#52c41a', fontSize: '16px' }}>\r\n              {productDetails.selling_price?.toFixed(2) || '0.00'}\r\n            </Text>\r\n          </Descriptions.Item>\r\n          \r\n          <Descriptions.Item label=\"MRP\">\r\n            <Text style={{ color: '#fa8c16' }}>\r\n              {productDetails.mrp?.toFixed(2) || '0.00'}\r\n            </Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.CategoryItem?.name && (\r\n            <Descriptions.Item label=\"Category\">\r\n              <Text>{productDetails.CategoryItem.name}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.CategoryItem?.tax_percentage !== undefined && (\r\n            <Descriptions.Item label=\"Tax Rate\">\r\n              <Tag color=\"orange\">\r\n                {productDetails.CategoryItem.tax_percentage}%\r\n              </Tag>\r\n            </Descriptions.Item>\r\n          )}\r\n        </Descriptions>\r\n\r\n        {/* Stock Information */}\r\n        {(productDetails.min_stock !== undefined || productDetails.max_stock !== undefined) && (\r\n          <Descriptions\r\n            title=\"Stock Information\"\r\n            column={2}\r\n            size=\"small\"\r\n            bordered\r\n          >\r\n            {productDetails.min_stock !== undefined && (\r\n              <Descriptions.Item label=\"Minimum Stock\">\r\n                <Text>{productDetails.min_stock}</Text>\r\n              </Descriptions.Item>\r\n            )}\r\n            \r\n            {productDetails.max_stock !== undefined && (\r\n              <Descriptions.Item label=\"Maximum Stock\">\r\n                <Text>{productDetails.max_stock}</Text>\r\n              </Descriptions.Item>\r\n            )}\r\n          </Descriptions>\r\n        )}\r\n\r\n        {/* Footer Information */}\r\n        <div style={{ \r\n          marginTop: '24px', \r\n          padding: '16px', \r\n          backgroundColor: '#f6f8fa', \r\n          borderRadius: '8px',\r\n          textAlign: 'center'\r\n        }}>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            Right-click on product field to view details  Press ESC to close\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProductDetailsModal;\r\n","import React from 'react';\r\nimport { Typography, Button, message } from 'antd';\r\nimport {\r\n  SaveOutlined,\r\n  PrinterOutlined,\r\n  FileTextOutlined,\r\n  ClearOutlined,\r\n  DownloadOutlined,\r\n} from '@ant-design/icons';\r\nimport AntdEditableTable from '../../../components/common/AntdEditableTable';\r\nimport { useAdvancedBilling } from '../hooks/useAdvancedBilling';\r\nimport BillTopBar from './BillTopBar';\r\nimport BillHeader from './BillHeader';\r\nimport BillSummary from './BillSummary';\r\nimport StockSelectionModal from './StockSelectionModal';\r\nimport CustomerSelectionModal from './CustomerSelectionModal';\r\nimport UserSelectionModal from './UserSelectionModal';\r\nimport BillSaveConfirmationModal from './BillSaveConfirmationModal';\r\nimport BillListDrawer from './BillListDrawer';\r\nimport ProductDetailsModal from './ProductDetailsModal';\r\nimport ProductSelectionModal from './ProductSelectionModal';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\nconst { Text } = Typography;\r\n\r\ninterface BillDataGridProps {\r\n  billdata?: any;\r\n  onSuccess?: (formattedBill?: any) => void;\r\n}\r\n\r\n/**\r\n *  REFACTORED BillDataGrid Component\r\n * \r\n * Before: 3,493 lines of code\r\n * After: ~497 lines (86% reduction!)\r\n * \r\n * All logic moved to hooks:\r\n * - useAdvancedBilling: Master orchestration\r\n * - Data, form, modals, calculations, actions\r\n */\r\nconst BillDataGrid: React.FC<BillDataGridProps> = ({ billdata, onSuccess }) => {\r\n  //  ONE HOOK TO RULE THEM ALL\r\n  const billing = useAdvancedBilling({ billdata, onSuccess });\r\n\r\n  // Destructure for easier access\r\n  const {\r\n    billData,\r\n    form,\r\n    modals,\r\n    actions,\r\n    billCalculations,\r\n    handleQuantityChange,\r\n    handleProductSelect,\r\n    handleStockSelect,\r\n    handlePrint,\r\n    handleDownload,\r\n    productOptions,\r\n    customerOptions,\r\n    userOptions,\r\n  } = billing;\r\n\r\n  return (\r\n    <div className={styles.mainContainer}>\r\n      {/* Background Half Circles */}\r\n      <div className={styles.backgroundCircle1} />\r\n      <div className={styles.backgroundCircle2} />\r\n      <div className={styles.backgroundCircle3} />\r\n      <div className={styles.backgroundCircle4} />\r\n      <div className={styles.backgroundCircle5} />\r\n\r\n      {/* Top Bar with Controls */}\r\n      <BillTopBar\r\n        billdata={billdata}\r\n        documentType={form.documentType}\r\n        billSettings={form.billSettings}\r\n        itemCount={form.billFormData.items.length}\r\n        totalAmount={billCalculations.total_amount}\r\n        onDocumentTypeChange={form.setDocumentType}\r\n        onSettingsChange={form.updateSettings}\r\n      />\r\n\r\n      {/* Invoice Header */}\r\n      <div className={styles.invoiceDetailsGrid}>\r\n        <BillHeader\r\n          billFormData={form.billFormData}\r\n          customerOrVendorOptions={customerOptions}\r\n          userOptions={userOptions}\r\n          documentType={form.documentType}\r\n          onHeaderChange={rows => {\r\n            if (rows[0]) {\r\n              const customer = billData.customerListResult.find(\r\n                (c: any) => c._id === rows[0].customer_id\r\n              );\r\n              const user = billData.userListResult.find(\r\n                (u: any) => u._id === rows[0].billed_by\r\n              );\r\n              form.updateHeader({\r\n                invoice_no: rows[0].invoice_no || '',\r\n                date: rows[0].date,\r\n                customer_id: rows[0].customer_id || '',\r\n                customer_name: customer?.full_name || customer?.name || '',\r\n                billed_by: rows[0].billed_by || '',\r\n                billed_by_name: user?.name || '',\r\n                payment_mode: rows[0].payment_mode || 'cash',\r\n              });\r\n            }\r\n          }}\r\n          onCustomerModalOpen={modals.openCustomerModal}\r\n          onUserModalOpen={modals.openUserModal}\r\n          loading={billData.customerLoading}\r\n        />\r\n      </div>\r\n\r\n      {/* Items Section with Summary */}\r\n      <div className={styles.itemsSection}>\r\n        {/* Decorative circles */}\r\n        <div className={styles.itemsCircle1} />\r\n        <div className={styles.itemsCircle2} />\r\n\r\n        {/* Bill Items Grid */}\r\n        <div className={styles.billItemsGrid}>\r\n          <div className={styles.billItemsHeader}>\r\n            <Text className={styles.billItemsTitle}> BILL ITEMS</Text>\r\n          </div>\r\n\r\n          <AntdEditableTable\r\n            columns={[\r\n              {\r\n                key: 'product_id',\r\n                title: ' PRODUCT',\r\n                dataIndex: 'product_id',\r\n                type: 'product',\r\n                required: true,\r\n                width: 280,\r\n                render: (value: any, record: any, index?: number) => {\r\n                  // Use product data stored in bill item (not from options)\r\n                  const displayName = value\r\n                    ? (record.product_name\r\n                        ? `${record.product_name}${record.variant_name ? ` ${record.variant_name}` : ''}`.trim()\r\n                        : 'Unknown Product')\r\n                    : 'Select product';\r\n                  return (\r\n                    <div\r\n                      style={{\r\n                        cursor: 'pointer',\r\n                        padding: '4px 8px',\r\n                        borderRadius: '4px',\r\n                        border: value ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                        backgroundColor: value ? '#f6ffed' : '#fafafa',\r\n                      }}\r\n                      onClick={() => {\r\n                        if (typeof index === 'number') {\r\n                          modals.openProductSelectionModal(index);\r\n                        }\r\n                      }}\r\n                    >\r\n                      <span style={{ color: value ? '#52c41a' : '#1890ff' }}>\r\n                        {displayName}\r\n                      </span>\r\n                    </div>\r\n                  );\r\n                },\r\n              },\r\n              {\r\n                key: 'stock_id',\r\n                title: ' STOCK',\r\n                dataIndex: 'batch_no',\r\n                type: 'stock',\r\n                required: true,\r\n                width: 200,\r\n                render: (value: any, record: any, index?: number) => {\r\n                  const stockData = (record as any).stockData;\r\n                  const availableQty = stockData?.available_quantity || 0;\r\n                  const hasStock = record.stock_id || stockData;\r\n                  \r\n                  // Determine display text\r\n                  let displayText = 'Select Stock';\r\n                  if (hasStock) {\r\n                    // If we have batch_no, show it with quantity\r\n                    if (value) {\r\n                      displayText = `${value} (Qty: ${availableQty})`;\r\n                    } else {\r\n                      // If stock is selected but no batch_no, show stock ID\r\n                      displayText = `${record.stock_id?.slice(-8) || 'Stock'} (Qty: ${availableQty})`;\r\n                    }\r\n                  }\r\n                  \r\n                  return (\r\n                    <div\r\n                      style={{\r\n                        cursor: 'pointer',\r\n                        padding: '4px 8px',\r\n                        borderRadius: '4px',\r\n                        border: hasStock ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                      }}\r\n                      onClick={() => {\r\n                        if (record.product_id && typeof index === 'number') {\r\n                          modals.openStockModal(index);\r\n                        } else if (!record.product_id) {\r\n                          message.warning('Please select a product first');\r\n                        }\r\n                      }}\r\n                    >\r\n                      <span>{displayText}</span>\r\n                    </div>\r\n                  );\r\n                },\r\n              },\r\n              {\r\n                key: 'qty',\r\n                title: ' QTY',\r\n                dataIndex: 'qty',\r\n                type: 'number',\r\n                width: 90,\r\n                editable: true,\r\n              },\r\n              {\r\n                key: 'loose_qty',\r\n                title: ' LOOSE',\r\n                dataIndex: 'loose_qty',\r\n                type: 'number',\r\n                width: 90,\r\n                editable: true,\r\n              },\r\n              {\r\n                key: 'price',\r\n                title: ' RATE',\r\n                dataIndex: 'price',\r\n                type: 'number',\r\n                width: 120,\r\n                editable: false,\r\n              },\r\n              {\r\n                key: 'amount',\r\n                title: ' AMOUNT',\r\n                dataIndex: 'amount',\r\n                type: 'number',\r\n                width: 130,\r\n                editable: false,\r\n              },\r\n            ]}\r\n            dataSource={form.billFormData.items.map((item, index) => ({\r\n              ...item,\r\n              key: index.toString(),\r\n            }))}\r\n            onSave={items => {\r\n              // Handle quantity changes\r\n              const updatedItems = items.map((item, idx) => {\r\n                const currentItem = form.billFormData.items[idx];\r\n                if (\r\n                  item.qty !== currentItem?.qty ||\r\n                  item.loose_qty !== currentItem?.loose_qty\r\n                ) {\r\n                  // Quantity changed, recalculate\r\n                  return item;\r\n                }\r\n                return item;\r\n              });\r\n              billing.handleItemsChange(updatedItems);\r\n            }}\r\n            onAdd={form.addItem}\r\n            onDelete={form.deleteItems}\r\n            onProductSelect={handleProductSelect}\r\n            loading={\r\n              billData.productLoading ||\r\n              billData.stockLoading ||\r\n              billData.branchStockLoading\r\n            }\r\n            className=\"modern-bill-grid\"\r\n            size=\"small\"\r\n            rowKey=\"key\"\r\n            externalEditingCell={modals.externalEditingCell}\r\n          />\r\n        </div>\r\n\r\n        {/* Bill Summary - Right Side */}\r\n        <BillSummary\r\n          billCalculations={billCalculations}\r\n          billSettings={form.billSettings}\r\n          onDiscountChange={value => form.updateSettings({ discount: value })}\r\n          onDiscountTypeChange={checked =>\r\n            form.updateSettings({\r\n              discountType: checked ? 'percentage' : 'amount',\r\n            })\r\n          }\r\n          onPaidAmountChange={value => form.updateSettings({ paidAmount: value })}\r\n        />\r\n      </div>\r\n\r\n      {/* Action Hub */}\r\n      <div className={styles.actionHub}>\r\n        {/* Background decoration */}\r\n        <div className={styles.actionHubCircle1} />\r\n        <div className={styles.actionHubCircle2} />\r\n        <div className={styles.actionHubCircle3} />\r\n        <div className={styles.actionHubCircle4} />\r\n\r\n        <div className={styles.actionButtonsContainer}>\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            icon={<SaveOutlined />}\r\n            onClick={actions.handleSaveDraft}\r\n            loading={billData.saleCreateLoading}\r\n            className={styles.saveButton}\r\n          >\r\n             SAVE DRAFT (F2)\r\n          </Button>\r\n\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            icon={<SaveOutlined />}\r\n            onClick={actions.handleCompleteBill}\r\n            loading={billData.saleCreateLoading || billData.saleUpdateLoading}\r\n            className={styles.saveButton}\r\n          >\r\n             {billdata ? 'UPDATE' : 'COMPLETE BILL'} (F3)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<FileTextOutlined />}\r\n            onClick={modals.openBillListDrawer}\r\n            className={styles.billListButton}\r\n          >\r\n             BILL LIST (F6)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<ClearOutlined />}\r\n            onClick={() => {\r\n              form.resetForm();\r\n              message.success('Bill form cleared successfully!');\r\n            }}\r\n            className={styles.clearButton}\r\n          >\r\n             CLEAR (F4 / Ctrl+R)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<PrinterOutlined />}\r\n            className={styles.printButton}\r\n            onClick={handlePrint}\r\n          >\r\n             PRINT {form.documentType === 'bill' ? 'BILL' : 'INVOICE'} (F8)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<DownloadOutlined />}\r\n            className={styles.downloadButton}\r\n            onClick={handleDownload}\r\n          >\r\n             DOWNLOAD PDF\r\n          </Button>\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)',\r\n            padding: '14px 18px',\r\n            borderRadius: '10px',\r\n            border: '1px solid #cbd5e1',\r\n            position: 'relative',\r\n            zIndex: 1,\r\n            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.05)',\r\n          }}\r\n        >\r\n          <div style={{ textAlign: 'right' }}>\r\n            <Text\r\n              style={{\r\n                color: '#475569',\r\n                fontSize: '12px',\r\n                display: 'block',\r\n                fontWeight: 600,\r\n                lineHeight: '18px',\r\n              }}\r\n            >\r\n               <strong>Keyboard Shortcuts:</strong> Ctrl+S (Save)  Ctrl+N (Add)  F4/Ctrl+R\r\n              (Clear)  Tab/Shift+Tab (Navigate)  Enter (Edit)  Esc (Cancel)  End (Customer) \r\n              Ctrl+U (User)  F5 (Product)  F6 (Bill List)  F7 (Stock)\r\n            </Text>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modals */}\r\n      {modals.stockModalRowIndex !== null && (\r\n        <StockSelectionModal\r\n          visible={true}\r\n          onSelect={handleStockSelect}\r\n          onCancel={modals.closeStockModal}\r\n          productId={form.billFormData.items[modals.stockModalRowIndex]?.product_id || ''}\r\n        />\r\n      )}\r\n\r\n      <CustomerSelectionModal\r\n        visible={modals.customerModalVisible}\r\n        onSelect={customer => {\r\n          if (form.billFormData.customer_id === customer._id) return;\r\n          form.updateHeader({\r\n            customer_id: customer._id,\r\n            customer_name: customer.full_name,\r\n          });\r\n          modals.closeCustomerModal();\r\n          setTimeout(() => modals.openUserModal(), 100);\r\n          message.success(`Customer \"${customer.full_name}\" selected successfully!`);\r\n        }}\r\n        onCancel={modals.closeCustomerModal}\r\n      />\r\n\r\n\r\n      <UserSelectionModal\r\n        visible={modals.userModalVisible}\r\n        onSelect={user => {\r\n          if (form.billFormData.billed_by === user._id) return;\r\n          form.updateHeader({\r\n            billed_by: user._id,\r\n            billed_by_name: user.name,\r\n          });\r\n          modals.closeUserModal();\r\n          message.success(`User \"${user.name}\" selected as billed by successfully!`);\r\n        }}\r\n        onCancel={modals.closeUserModal}\r\n      />\r\n\r\n      <BillSaveConfirmationModal\r\n        visible={modals.saveConfirmationVisible}\r\n        onNewBill={() => {\r\n          form.resetForm();\r\n          modals.closeSaveConfirmation();\r\n          actions.setSavedBillData(null);\r\n          message.success('New bill form cleared successfully!');\r\n        }}\r\n        onContinueBill={() => {\r\n          modals.closeSaveConfirmation();\r\n          actions.setSavedBillData(null);\r\n        }}\r\n        onCancel={modals.closeSaveConfirmation}\r\n        savedBillData={actions.savedBillData}\r\n        onOpenProductModal={() => {\r\n          // Open product selection modal for the first row (index 0)\r\n          modals.openProductSelectionModal(0);\r\n        }}\r\n      />\r\n\r\n      <ProductDetailsModal\r\n        visible={modals.productDetailsModalVisible}\r\n        onCancel={modals.closeProductDetailsModal}\r\n        productId={modals.selectedProductId}\r\n      />\r\n\r\n      <ProductSelectionModal\r\n        visible={modals.productSelectionModalVisible}\r\n        onSelect={product => {\r\n          if (modals.productSelectionRowIndex === null) return;\r\n          \r\n          const newItems = [...form.billFormData.items];\r\n          // Store ALL product data (including tax %, HSN code) for calculations\r\n          newItems[modals.productSelectionRowIndex].product_id = product._id || '';\r\n          newItems[modals.productSelectionRowIndex].product_name = product.name || '';\r\n          newItems[modals.productSelectionRowIndex].variant_name =\r\n            product.VariantItem?.variant_name || '';\r\n          newItems[modals.productSelectionRowIndex].price = product.selling_price || 0;\r\n          newItems[modals.productSelectionRowIndex].tax_percentage = product.CategoryItem?.tax_percentage || 0;\r\n          newItems[modals.productSelectionRowIndex].category_name = product.CategoryItem?.category_name || '';\r\n          newItems[modals.productSelectionRowIndex].hsn_code = product.hsn_code || product.VariantItem?.hsn_code || '';\r\n          newItems[modals.productSelectionRowIndex].hsn_sac = product.hsn_sac || '';\r\n          \r\n          billing.handleItemsChange(newItems);\r\n          modals.closeProductSelectionModal();\r\n          modals.openStockModal(modals.productSelectionRowIndex);\r\n          message.success(`Product \"${product.name}\" selected successfully!`);\r\n        }}\r\n        onCancel={modals.closeProductSelectionModal}\r\n      />\r\n\r\n      <BillListDrawer\r\n        visible={modals.billListDrawerVisible}\r\n        onClose={modals.closeBillListDrawer}\r\n        onViewBill={bill => {\r\n          // Load bill for editing\r\n          form.loadBillData(bill, () => {\r\n            // Recalculate items after loading to populate stock data\r\n            if (form.billFormData.items.length > 0) {\r\n              billing.handleItemsChange(form.billFormData.items);\r\n            }\r\n          });\r\n          billData.refetchAllData();\r\n          modals.closeBillListDrawer();\r\n          message.success(`Bill \"${bill.invoice_no}\" loaded successfully!`);\r\n        }}\r\n        onNewBill={() => {\r\n          form.resetForm();\r\n          modals.closeBillListDrawer();\r\n          message.success('New bill form cleared successfully!');\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillDataGrid;\r\n\r\n","import { showToast } from \"../../helpers/Common_functions\";\r\n\r\ntype ActionType = \"create\" | \"update\" | \"delete\";\r\n\r\ninterface ApiResponseHandlerParams {\r\n  action: ActionType;\r\n  success: boolean;\r\n  title: string;\r\n  getAllItems?: () => void;\r\n  resetForm?: () => void;\r\n  errorMessage?: string;\r\n}\r\n\r\nexport const handleApiResponse = ({\r\n  action,\r\n  success,\r\n  title,\r\n  getAllItems,\r\n  resetForm,\r\n  errorMessage,\r\n}: ApiResponseHandlerParams) => {\r\n  if (success) {\r\n    showToast(\"success\", `${title} ${action}d successfully`);\r\n    getAllItems?.();\r\n    resetForm?.();\r\n    // RTK Query handles cache invalidation automatically, no need for manual clearing\r\n  } else {\r\n    showToast(\"error\", errorMessage || `Failed to ${action} ${title}`);\r\n  }\r\n};\r\n","import { useMemo } from 'react';\r\nimport { apiSlice } from '../services/redux/api/apiSlice';\r\nimport { getCurrentUser } from '../helpers/auth';\r\nimport { getBillTemplate, getInvoiceTemplate, BillTemplateKey, InvoiceTemplateKey } from '../pages/RetaillBill/templates/registry';\r\n\r\n/**\r\n * Hook to get selected templates from settings\r\n * Returns the template components based on user's settings\r\n */\r\nexport const useTemplateSettings = () => {\r\n  const userItem = useMemo(() => getCurrentUser(), []);\r\n  const organisationId = userItem?.organisation_id || userItem?.organisationItems?._id;\r\n\r\n  // Fetch settings for current organisation\r\n  const { data: settingsData, isLoading } = apiSlice.useGetSettingsQuery(\r\n    { organisation_id: organisationId, page: 1, limit: 1 },\r\n    { \r\n      skip: !organisationId,\r\n      refetchOnMountOrArgChange: false\r\n    }\r\n  );\r\n\r\n  const settings = useMemo(() => {\r\n    const settingsResult = (settingsData as any)?.result || settingsData || {};\r\n    return Array.isArray(settingsResult) ? settingsResult[0] : settingsResult;\r\n  }, [settingsData]);\r\n\r\n  // Get selected template keys from API (no defaults - use actual API values)\r\n  // getBillTemplate/getInvoiceTemplate have built-in fallbacks to 'classic' if key is invalid\r\n  const billTemplateKey = (settings?.bill_template || 'classic') as BillTemplateKey;\r\n  const invoiceTemplateKey = (settings?.invoice_template || 'classic') as InvoiceTemplateKey;\r\n\r\n  // Get template components (these functions handle invalid keys gracefully)\r\n  const BillTemplateComponent = getBillTemplate(billTemplateKey);\r\n  const InvoiceTemplateComponent = getInvoiceTemplate(invoiceTemplateKey);\r\n\r\n  return {\r\n    // Template components ready to use\r\n    BillTemplateComponent,\r\n    InvoiceTemplateComponent,\r\n    \r\n    // Template keys\r\n    billTemplateKey,\r\n    invoiceTemplateKey,\r\n    \r\n    // Loading state\r\n    isLoading,\r\n    \r\n    // Settings data (if you need other settings)\r\n    settings,\r\n  };\r\n};\r\n\r\n","import { useCallback, useMemo } from 'react';\r\nimport { getEntityHooks } from '../services/redux/api/apiSlice';\r\nimport { API_ROUTES } from '../services/api/utils';\r\n// Define EntityName type locally\r\ntype EntityName = string;\r\n\r\n// Type for RTK query parameters\r\nexport interface RTKQueryParams {\r\n  pageNumber?: number;\r\n  pageLimit?: number;\r\n  [key: string]: any;\r\n}\r\n\r\n// Type for RTK mutation result\r\nexport interface RTKMutationResult<T = any> {\r\n  data?: T;\r\n  error?: any;\r\n  isLoading: boolean;\r\n  isSuccess: boolean;\r\n  isError: boolean;\r\n}\r\n\r\n// Type for RTK query result\r\nexport interface RTKQueryResult<T = any> {\r\n  data?: T;\r\n  error?: any;\r\n  isLoading: boolean;\r\n  isSuccess: boolean;\r\n  isError: boolean;\r\n  refetch: () => void;\r\n}\r\n\r\n/**\r\n * Custom hook that provides RTK Query functionality for any entity\r\n * Works with the existing createCrudRoutes system\r\n */\r\nexport const useGenericCrudRTK = <T extends EntityName>(entityName: T) => {\r\n  \r\n  // Get the RTK hooks for this entity\r\n  const entityHooks = useMemo(() => getEntityHooks(entityName), [entityName]);\r\n  \r\n  // Check if entity exists in API_ROUTES\r\n  const entityRoutes = useMemo(() => {\r\n    const routes = API_ROUTES[entityName as keyof typeof API_ROUTES];\r\n    if (!routes || typeof routes !== 'object' || !('GetAll' in routes)) {\r\n      throw new Error(`Entity ${entityName} not found in API_ROUTES or doesn't follow CRUD pattern`);\r\n    }\r\n    return routes as any;\r\n  }, [entityName]);\r\n\r\n  // Get all records with pagination and filters\r\n  const useGetAll = (params: RTKQueryParams = {}) => {\r\n    const query = entityHooks.useGetQuery(params);\r\n    return {\r\n      ...query,\r\n      refetch: query.refetch,\r\n    } as RTKQueryResult;\r\n  };\r\n\r\n  // Get single record by ID\r\n  const useGetById = (id: string, params: RTKQueryParams = {}) => {\r\n    const query = entityHooks.useGetByIdQuery({ id, ...params });\r\n    return {\r\n      ...query,\r\n      refetch: query.refetch,\r\n    } as RTKQueryResult;\r\n  };\r\n\r\n  // Create new record\r\n  const useCreate = () => {\r\n    const [createMutation, result] = entityHooks.useCreateMutation();\r\n    \r\n    const create = useCallback(async (data: any) => {\r\n      try {\r\n        const response = await createMutation(data).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [createMutation]);\r\n\r\n    return {\r\n      create,\r\n      ...result,\r\n    } as RTKMutationResult & { create: (data: any) => Promise<{ data: any; error: any }> };\r\n  };\r\n\r\n  // Update existing record\r\n  const useUpdate = () => {\r\n    const [updateMutation, result] = entityHooks.useUpdateMutation();\r\n    \r\n    const update = useCallback(async (id: string, data: any) => {\r\n      try {\r\n        const response = await updateMutation({ id, data }).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [updateMutation]);\r\n\r\n    return {\r\n      update,\r\n      ...result,\r\n    } as RTKMutationResult & { update: (id: string, data: any) => Promise<{ data: any; error: any }> };\r\n  };\r\n\r\n  // Delete record\r\n  const useDelete = () => {\r\n    const [deleteMutation, result] = entityHooks.useDeleteMutation();\r\n    \r\n    const remove = useCallback(async (id: string) => {\r\n      try {\r\n        const response = await deleteMutation(id).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [deleteMutation]);\r\n\r\n    return {\r\n      delete: remove,\r\n      remove, // Alias for delete\r\n      ...result,\r\n    } as RTKMutationResult & { \r\n      delete: (id: string) => Promise<{ data: any; error: any }>;\r\n      remove: (id: string) => Promise<{ data: any; error: any }>;\r\n    };\r\n  };\r\n\r\n  // Get entity routes for manual API calls\r\n  const getRoutes = useCallback(() => {\r\n    return {\r\n      getAll: entityRoutes.GetAll,\r\n      get: entityRoutes.Get,\r\n      create: entityRoutes.Create,\r\n      update: entityRoutes.Update,\r\n      delete: entityRoutes.Delete,\r\n    };\r\n  }, [entityRoutes]);\r\n\r\n  return {\r\n    // Query hooks\r\n    useGetAll,\r\n    useGetById,\r\n    \r\n    // Mutation hooks\r\n    useCreate,\r\n    useUpdate,\r\n    useDelete,\r\n    \r\n    // Utility functions\r\n    getRoutes,\r\n    \r\n    // Entity info\r\n    entityName,\r\n    entityRoutes,\r\n  };\r\n};\r\n\r\n// Export individual hooks for convenience\r\nexport const useEntityQuery = <T extends EntityName>(entityName: T, params: RTKQueryParams = {}) => {\r\n  const { useGetAll } = useGenericCrudRTK(entityName);\r\n  return useGetAll(params);\r\n};\r\n\r\nexport const useEntityMutation = <T extends EntityName>(entityName: T) => {\r\n  const { useCreate, useUpdate, useDelete } = useGenericCrudRTK(entityName);\r\n  return {\r\n    useCreate,\r\n    useUpdate,\r\n    useDelete,\r\n  };\r\n};\r\n\r\n// Export for backward compatibility\r\nexport default useGenericCrudRTK;","import { handleApiResponse } from './handleApiResponse';\r\nimport { useEffect, useRef } from 'react';\r\n\r\n// RTK Query mutation result type\r\ninterface RTKMutationResult {\r\n  isLoading?: boolean;\r\n  isSuccess?: boolean;\r\n  isError?: boolean;\r\n  data?: any;\r\n  error?: any;\r\n  reset?: () => void;\r\n}\r\n\r\nexport const useHandleApiResponse = ({\r\n  action,\r\n  title,\r\n  mutationResult,\r\n  refetch,\r\n}: {\r\n  action: 'create' | 'update' | 'delete';\r\n  title: string;\r\n  mutationResult: RTKMutationResult;\r\n  refetch?: () => void;\r\n}) => {\r\n  const {\r\n    isLoading,\r\n    isSuccess,\r\n    isError,\r\n    data,\r\n    error,\r\n    reset,\r\n  } = mutationResult;\r\n\r\n  // Track previous loading state to detect transitions\r\n  const prevLoadingRef = useRef<boolean>(false);\r\n  // Track if we've already handled this result to prevent duplicate notifications\r\n  const handledRef = useRef<string>('');\r\n\r\n  useEffect(() => {\r\n    // Track transition from loading to not-loading\r\n    const wasLoading = prevLoadingRef.current;\r\n    prevLoadingRef.current = isLoading || false;\r\n\r\n    // Skip if still loading\r\n    if (isLoading) {\r\n      return;\r\n    }\r\n\r\n    // Only process if we just transitioned from loading to not-loading\r\n    if (!wasLoading) {\r\n      return;\r\n    }\r\n\r\n    // Create a unique key for this result to prevent duplicate handling\r\n    const resultKey = `${isSuccess}-${isError}-${data?.statusCode || ''}-${error?.status || ''}`;\r\n    \r\n    // Skip if we've already handled this exact result\r\n    // Since we're tracking loading transitions, this should only trigger once per mutation\r\n    if (handledRef.current === resultKey) {\r\n      return;\r\n    }\r\n\r\n    // Handle success case\r\n    if (isSuccess && data) {\r\n      const success = data?.statusCode === 200 || data?.status === 'success' || isSuccess;\r\n\r\n      // Prepare refetch function for handleApiResponse\r\n      // RTK Query provides refetch function, entityApi parameter is deprecated\r\n      const refetchFn = refetch;\r\n\r\n      handleApiResponse({\r\n        action,\r\n        title,\r\n        success: true,\r\n        getAllItems: refetchFn,\r\n      });\r\n\r\n      handledRef.current = resultKey;\r\n\r\n      // Reset mutation state if reset function is available\r\n      if (reset) {\r\n        // Delay reset slightly to ensure state updates are processed\r\n        setTimeout(() => {\r\n          reset();\r\n          // Clear handled ref to allow handling new mutations\r\n          handledRef.current = '';\r\n        }, 100);\r\n      }\r\n    }\r\n\r\n    // Handle error case\r\n    if (isError && error) {\r\n      const errorMessage = \r\n        error?.data?.message || \r\n        error?.message || \r\n        error?.error || \r\n        `Failed to ${action} ${title}`;\r\n\r\n      handleApiResponse({\r\n        action,\r\n        title,\r\n        success: false,\r\n        errorMessage,\r\n      });\r\n\r\n      handledRef.current = resultKey;\r\n\r\n      // Reset mutation state if reset function is available\r\n      if (reset) {\r\n        // Delay reset slightly to ensure state updates are processed\r\n        setTimeout(() => {\r\n          reset();\r\n          // Clear handled ref to allow handling new mutations\r\n          handledRef.current = '';\r\n        }, 100);\r\n      }\r\n    }\r\n  }, [\r\n    isLoading,\r\n    isSuccess,\r\n    isError,\r\n    data,\r\n    error,\r\n    action,\r\n    title,\r\n    refetch,\r\n    reset,\r\n  ]);\r\n};\r\n","import { message } from \"antd\";\r\nimport { API_ROUTES } from \"../services/api/utils\";\r\n\r\nexport const showToast = (type: \"success\" | \"error\", content: string) => {\r\n  if (type === \"success\") {\r\n    message.success(content);\r\n  } else if (type === \"error\") {\r\n    message.error(content);\r\n  }\r\n};\r\n\r\n// Generic function to generate API route getters for any entity\r\nexport const createApiRouteGetter = <T extends keyof typeof API_ROUTES>(entityName: T) => {\r\n  return (action: keyof typeof API_ROUTES[T]) => {\r\n    const route = API_ROUTES?.[entityName]?.[action];\r\n    if (!route) {\r\n\r\n      throw new Error(`API route for ${String(entityName)}.${String(action)} is not defined.`);\r\n    }\r\n    return route;\r\n  };\r\n};\r\n\r\n// Generic CRUD factory that creates all CRUD operations for an entity\r\nexport const createCrudOperations = <T extends keyof typeof API_ROUTES>(entityName: T) => {\r\n  const getRoute = createApiRouteGetter(entityName);\r\n  \r\n  return {\r\n    getAll: () => getRoute(\"GetAll\" as keyof typeof API_ROUTES[T]),\r\n    create: () => getRoute(\"Create\" as keyof typeof API_ROUTES[T]),\r\n    update: () => getRoute(\"Update\" as keyof typeof API_ROUTES[T]),\r\n    delete: () => getRoute(\"Delete\" as keyof typeof API_ROUTES[T]),\r\n    get: () => getRoute(\"Get\" as keyof typeof API_ROUTES[T]),\r\n  };\r\n};\r\n\r\n// Auto-generated CRUD operations for all entities (minimal - only for fallback)\r\nexport const CrudOperations = {\r\n  Unit: createCrudOperations(\"Unit\"),\r\n  // Note: All API calls are now handled by RTK Query via apiSlice\r\n  // because they don't follow the standard CRUD pattern\r\n} as const;"],"names":["Search","Input","_ref","visible","products","providedProducts","onSelect","onCancel","searchTerm","setSearchTerm","useState","debouncedSearch","setDebouncedSearch","page","setPage","allProducts","setAllProducts","hasMore","setHasMore","selectedRowKey","setSelectedRowKey","highlightedIndex","setHighlightedIndex","scannerVisible","setScannerVisible","searchInputRef","useRef","searchTimeoutRef","isLoadingMoreRef","shouldLoadFromAPI","length","data","productsData","isLoading","loading","apiSlice","useGetProductQuery","searchString","pageNumber","pageLimit","skip","refetchOnMountOrArgChange","useEffect","_pagination","_pagination2","newItems","result","totalCount","pagination","total","prev","existingIds","Set","map","item","_id","uniqueNewItems","filter","has","updated","current","sourceProducts","filteredProducts","p","_p$name","_p$sku","_p$VariantItem","_p$VariantItem$varian","_p$VariantItem2","_p$VariantItem2$varia","_p$selling_price","searchLower","toLowerCase","name","includes","sku","VariantItem","variant_name","variant_code","selling_price","toString","sort","a","b","_a$name","_a$VariantItem","_a$VariantItem$varian","_a$sku","_b$name","_b$VariantItem","_b$VariantItem$varian","_b$sku","_a$name2","_a$VariantItem2","_a$VariantItem2$varia","_a$sku2","_b$name2","_b$VariantItem2","_b$VariantItem2$varia","_b$sku2","aExactMatch","bExactMatch","aStartsWith","startsWith","bStartsWith","clearTimeout","setTimeout","_searchInputRef$curre","focus","columns","title","dataIndex","key","width","render","record","_record$VariantItem","_record$VariantItem2","_jsxs","children","_jsx","style","fontWeight","color","fontSize","marginTop","marginLeft","variant","fontStyle","price","toFixed","handleSelectRow","product","Modal","open","footer","destroyOnClose","onClick","handleModalClick","_searchInputRef$curre4","Space","Compact","marginBottom","ref","placeholder","onChange","e","target","value","flex","autoFocus","onKeyDown","_searchInputRef$curre2","preventDefault","next","Math","min","_searchInputRef$curre3","prevIndex","max","selectedProduct","onBlur","_searchInputRef$curre5","Button","type","icon","ScanOutlined","minWidth","onScroll","currentTarget","scrollTop","scrollHeight","clientHeight","maxHeight","overflowY","Table","dataSource","rowKey","size","onRow","idx","_searchInputRef$curre6","onDoubleClick","className","backgroundColor","undefined","border","rowSelection","selectedRowKeys","keys","findIndex","scroll","y","textAlign","padding","borderTop","_searchInputRef$curre7","BarcodeScanner","onClose","onScan","barcode","foundProduct","find","_p$sku2","_p$name2","_p$VariantItem3","_p$VariantItem3$varia","message","success","concat","warning","description","productId","userItem","getCurrentUser","scopeData","SessionStorageEncryption","getItem","userRole","userType","user_type","usertype","user_role","isOrganisationUser","isBranchUser","shouldFetch","orgStocksData","loadingOrg","useGetStockAuditQuery","product_id","refetchOnFocus","refetchOnReconnect","branchStocksData","loadingBranch","useGetBranchStockQuery","stocks","errorMessage","setErrorMessage","tableBodyRef","isStockExpired","stock","expiry_date","dayjs","isBefore","isStockOutOfStock","available_quantity","showExpiredStockError","expiryDate","format","errorMsg","error","showOutOfStockError","allStocks","Array","isArray","s","_s$batch_no","_s$ProductItem","_s$ProductItem$name","_s$ProductItem2","_s$ProductItem2$Varia","_s$ProductItem2$Varia2","_s$available_quantity","_s$sell_price","batch_no","ProductItem","sell_price","firstValidIndex","_allStocks$highlighte","row","querySelector","scrollIntoView","block","_ProductItem$VariantI","isOutOfStock","ExclamationCircleOutlined","today","isExpired","daysUntilExpiry","diff","CheckCircleOutlined","status","Tooltip","Tag","_stock$ProductItem","id","code","available_loose_quantity","finalNext","finalPrev","selectedStock","_searchInputRef$curre8","borderRadius","display","alignItems","gap","i","shiftKey","tabIndex","outline","justifyContent","margin","_searchInputRef$curre9","opacity","cursor","getCheckboxProps","disabled","Text","Typography","onSave","onAdd","onDelete","allowAdd","allowDelete","compact","enableKeyboardNav","onProductSelect","externalEditingCell","setData","selectedRows","setSelectedRows","editingCell","setEditingCell","firstLoadRef","firstProductColIndex","col","String","handleAddRow","firstEditableCol","editable","saveCell","column","required","validation","newData","handleKeyDown","ctrlKey","document","addEventListener","removeEventListener","getNextEditableCol","startCol","direction","EditableCell","_ref2","_data$row","_data$row2","_data$row3","_data$row4","cellValue","setCellValue","inputRef","isProductModalVisible","setIsProductModalVisible","isStockModalVisible","setIsStockModalVisible","_inputRef$current","handleChange","val","stopPropagation","nextCol","nextRow","colIndex","handleProductSelect","handleStockSelect","stock_id","productName","product_name","trim","_Fragment","readOnly","ProductSelectionModal","StockSelectionModal","InputNumber","controls","Select","options","_inputRef$current2","DatePicker","date","mergedColumns","_objectSpread","onCell","_record","rowIndex","onContextMenu","option","opt","label","PlusOutlined","danger","DeleteOutlined","handleDeleteRow","confirm","onOk","slice","SaveOutlined","bordered","useBillCalculations","items","billSettings","billCalculations","useMemo","productList","isGstIncluded","discount","discountType","itemsWithTax","_product$CategoryItem","_product$VariantItem","taxPercentage","tax_percentage","CategoryItem","baseAmount","Number","qty","loose_qty","pack_size","amount","sub_total","reduce","sum","base_sub_total","discountValue","total_gst","value_of_goods","total_amount","forEach","discountedBase","gstAmount","cgst","sgst","calculateBillTotals","useAdvancedBilling","billdata","onSuccess","billData","_user$organisationIte","user","branchId","branch_id","organisationId","organisation_id","organisationItems","SalesRecord","useGenericCrudRTK","InvoiceNumberApi","productListData","productLoading","refetch","refetchProducts","customerListData","customerLoading","refetchCustomers","useGetCustomerQuery","vendorListData","vendorLoading","refetchVendors","useGetVendorQuery","userListData","userLoading","refetchUsers","useGetBillingUsersQuery","shouldFetchStockAudit","stockAuditListData","stockLoading","refetchStockAudit","branchStockListData","branchStockLoading","refetchBranchStock","invoiceNoData","refetchInvoiceNo","useGetAll","organisationsData","useGetOrganisationsQuery","settingsData","useGetSettingsQuery","productListResult","customerListResult","vendorListResult","userListResult","stockAuditListResult","branchStockListResult","organisationDetails","branchDetails","branchItems","settings","settingsResult","create","createSalesRecord","saleCreateLoading","useCreate","update","updateSalesRecord","saleUpdateLoading","useUpdate","createInvoiceNumber","invoice_no_create_loading","refetchAllData","useBillData","BillTemplateComponent","InvoiceTemplateComponent","useTemplateSettings","form","useBillForm","billFormData","setBillFormData","invoice_no","customer_id","customer_name","billed_by","billed_by_name","payment_mode","setBillSettings","isPaid","isPartiallyPaid","isRetail","paidAmount","documentType","setDocumentType","updateHeader","useCallback","updates","updateItems","addItem","newItem","mrp","deleteItems","indices","_","index","updateSettings","resetForm","loadBillData","onLoadComplete","_billdata$billedByDet","_billdata$Items","_billdata$is_paid","_billdata$is_partiall","_billdata$is_gst_incl","_billdata$discount","_billdata$discount_ty","_billdata$paid_amount","partyDetails","customerDetails","partyId","partyName","full_name","billedByDetails","Items","_item$productItems","_item$productItems2","_item$productItems2$V","_item$productItems3","_item$productItems3$C","_item$productItems4","_item$productItems5","_item$productItems6","_item$productItems6$V","_item$productItems7","_item$productItems8","_item$productItems8$C","productItems","branch_stock_id","hsn_code","hsn_sac","category_name","is_paid","is_partially_paid","sale_type","is_gst_included","discount_type","paid_amount","document_type","modals","useBillModals","stockModalRowIndex","setStockModalRowIndex","customerModalVisible","setCustomerModalVisible","userModalVisible","setUserModalVisible","saveConfirmationVisible","setSaveConfirmationVisible","billListDrawerVisible","setBillListDrawerVisible","productDetailsModalVisible","setProductDetailsModalVisible","productSelectionModalVisible","setProductSelectionModalVisible","productSelectionRowIndex","setProductSelectionRowIndex","selectedProductId","setSelectedProductId","lastInteractedRowIndex","setLastInteractedRowIndex","setExternalEditingCell","openStockModal","closeStockModal","openCustomerModal","closeCustomerModal","openUserModal","closeUserModal","openProductSelectionModal","closeProductSelectionModal","openBillListDrawer","closeBillListDrawer","openSaveConfirmation","closeSaveConfirmation","openProductDetailsModal","closeProductDetailsModal","closeAllModals","productOptions","calculateItemAmounts","savedStockData","stockData","stockFromList","_stock$ProductItem$Va","sellPrice","packSize","looseRate","parseInt","batchNo","validateStockQuantities","itemStockData","billItem","_stock$ProductItem2","_stock$ProductItem2$V","packSizeNum","availablePackQty","availableLooseQty","remainingPacks","maxLooseQty","handleItemsChange","validatedItems","useBillItems","actions","config","dispatch","useDispatch","savedBillData","setSavedBillData","createResponse","setCreateResponse","updateResponse","setUpdateResponse","handleSaveDraft","async","payload","_response","response","statusCode","_config$onSaveSuccess","savedData","onSaveSuccess","call","_error$data","_error$data2","exception","_error$data3","_error$data4","meta","_meta$plan_type","detailedMessage","current_count","max_limit","resource_type","plan_type","toUpperCase","usage_percentage","handleCompleteBill","some","stockValidationErrors","join","_response2","_config$onSaveSuccess2","util","invalidateTags","_error$data5","_error$data6","_error$data7","_error$data8","_meta$plan_type2","useBillActions","calculatedItems","handleQuantityChange","field","rowOrIndex","_product$CategoryItem2","console","currentItem","productFromStock","_productFromStock$Var","_productFromStock$Cat","_productFromStock$Cat2","handlePrint","selectedParty","billDataForPDF","customerName","customerAddress","address","address1","customerCity","city","customerState","state","customerPincode","pincode","customerPhone","phone","mobile","customerEmail","email","customer_gstin","gst_no","customer_pan","pan_no","qrCodeDataUrl","enable_payment_qr","upi_id","generateUPIQRCode","formatBillToUPIParams","upiParams","qr_size","enhancedSettings","TemplateComponent","element","React","templateHtml","ReactDOMServer","printAsPDF","fileName","handleDownload","downloadAsPDF","shortcuts","onF1AddItem","onF2SaveDraft","onF3CompleteBill","onF4Clear","onF5ProductSelection","onF6BillList","onF7StockSelection","onF8Print","onEndCustomer","onCtrlU","onCtrlS","onCtrlN","onCtrlP","onCtrlR","test","activeElement","closest","input","dispatchEvent","Event","bubbles","_billData$invoiceNoDa","_billData$invoiceNoDa2","_billData$user","currentUser","u","_billData$user2","_billData$settings","default_document_type","customerOptions","customer","push","userOptions","_user$roleItems","roleItems","background","boxShadow","FileTextOutlined","position","height","transition","left","right","letterSpacing","userSelect","Title","itemCount","totalAmount","onDocumentTypeChange","onSettingsChange","styles","level","marginRight","DocumentTypeToggle","Switch","checkedChildren","unCheckedChildren","checked","customerOrVendorOptions","onHeaderChange","onCustomerModalOpen","onUserModalOpen","headerColumns","selectedItem","displayLabel","onMouseEnter","borderColor","onMouseLeave","selectedUser","headerData","AntdEditableTable","onDiscountChange","onDiscountTypeChange","onPaidAmountChange","formatter","replace","parser","Option","CustomerSelectionModalComponent","debouncedSearchTerm","setDebouncedSearchTerm","allCustomers","setAllCustomers","showAddForm","setShowAddForm","selectedCustomer","setSelectedCustomer","selectedRowIndex","setSelectedRowIndex","showCreateGrid","setShowCreateGrid","newCustomerData","setNewCustomerData","customer_type","Form","useForm","modalRef","createGridRef","firstFormInputRef","customerData","refetchCustomerList","_customerRTK$useCreat","createCustomer","createResult","_objectWithoutProperties","_excluded","createLoading","filteredCustomers","shouldShowCreateGrid","getCustomerTypeColor","vip","wholesale","regular","navigateToCustomer","newIndex","rowElement","scrollBehavior","behavior","handleSearch","handleCustomerSelect","clearFormData","resetFields","handleCreateCustomerFromForm","_result$data","_result$data2","newCustomer","handleFormFieldChange","ArrowDown","ArrowUp","Home","End","handleGlobalKeyDown","tagName","classList","contains","select","firstInput","text","c","strong","PhoneOutlined","MailOutlined","HomeOutlined","getRowProps","focusSearch","timer","useHandleApiResponse","action","mutationResult","content","duration","destroy","handleSearchFocus","top","afterOpenChange","prefix","SearchOutlined","onFocus","suffix","UserAddOutlined","newState","overflow","zIndex","bottom","Row","justify","align","Col","WebkitBackgroundClip","WebkitTextFillColor","backgroundClip","CloseOutlined","layout","gridTemplateColumns","Item","UserOutlined","rules","pattern","TextArea","rows","resize","Divider","allUsers","setAllUsers","setSelectedUser","userData","filteredUsers","navigateToUser","handleUserSelect","user_name","_record$roleItems","_record$branchItems","branch_name","currentUserInList","onNewBill","onContinueBill","onOpenProductModal","newBillButtonRef","handleNewBill","window","centered","maskClosable","closable","bodyStyle","animation","CalendarOutlined","DollarOutlined","parseFloat","transform","Badge","count","EnterOutlined","lineHeight","onViewBill","billListData","useGetSalesRecordQuery","billList","activeTab","setActiveTab","filteredBills","statusFiltered","bill","_bill$customerDetails","invoiceNo","getPaymentStatusText","handleViewBill","Drawer","placement","headerStyle","borderBottom","allowClear","Tabs","activeKey","Spin","Empty","List","renderItem","_bill$customerDetails2","Avatar","EyeOutlined","PrinterOutlined","_productDetails$Varia","_productDetails$Varia2","_productDetails$Varia3","_productDetails$selli","_productDetails$mrp","_productDetails$Categ","_productDetails$Categ2","productDetails","setProductDetails","productData","handleCancel","Descriptions","span","brand","unit","min_stock","max_stock","_form$billFormData$it","billing","BillTopBar","BillHeader","displayName","availableQty","hasStock","displayText","_record$stock_id","updatedItems","BillSummary","ClearOutlined","DownloadOutlined","CustomerSelectionModal","UserSelectionModal","BillSaveConfirmationModal","ProductDetailsModal","_product$VariantItem2","BillListDrawer","handleApiResponse","getAllItems","showToast","_userItem$organisatio","limit","billTemplateKey","bill_template","invoiceTemplateKey","invoice_template","getBillTemplate","getInvoiceTemplate","entityName","entityHooks","getEntityHooks","entityRoutes","routes","API_ROUTES","Error","params","arguments","query","useGetQuery","useGetById","useGetByIdQuery","createMutation","useCreateMutation","unwrap","updateMutation","useUpdateMutation","useDelete","deleteMutation","useDeleteMutation","remove","delete","getRoutes","getAll","GetAll","get","Get","Create","Update","Delete","isSuccess","isError","reset","prevLoadingRef","handledRef","wasLoading","resultKey","refetchFn","getRoute","_API_ROUTES$entityNam","route","createApiRouteGetter","createCrudOperations"],"sourceRoot":""}