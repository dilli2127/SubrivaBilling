"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[883],{74198:(e,t,l)=>{l.d(t,{_V:()=>i});l(65043);var a=l(91449);l(75547);const i=e=>{const t=a.LE[e]||(0,a.lX)(e);return{get:t.getAll(),create:t.create(),update:t.update(),delete:t.delete()}}},74883:(e,t,l)=>{l.d(t,{r:()=>ie});var a=l(89379),i=l(65043),n=l(96651),s=l(60647),d=l(47419),o=l(11645),r=l(26553),c=l(36621),u=l(93504),m=l(95206),p=l(33359),h=l(9316),g=l(83003),x=l(62305),y=l(97031),v=l(91449),f=l(60446),A=l.n(f);var b=l(22671),j=l(53986),_=l(83833),C=l(88655),k=l(73847),F=l(70579);const w=["key","name","fieldKey"],S=e=>{const{FormValue:t,onSubmit:l,onCancel:n,formItems:s,onChildCancel:r,formColumns:c,splitLabelAndField:u,nested:p,nestedInputs:h,wrapperCol:g,labelCol:y,initialValues:v,loading:f,form:A,onValuesChange:b}=e,S=c||1;return(0,i.useEffect)((()=>{v&&(null===A||void 0===A||A.setFieldsValue(v))}),[v,A]),(0,F.jsxs)("div",{style:{position:"relative",height:"100%"},children:[(0,F.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"600px 600px",opacity:.1,zIndex:0}}),(0,F.jsxs)(x.A,{form:A,onFinish:e=>{l?l(e):t&&t(e),null===A||void 0===A||A.resetFields()},layout:"vertical",onValuesChange:b,children:[(0,F.jsxs)(d.A,{gutter:[16,16],children:[null===s||void 0===s?void 0:s.map(((e,t)=>{var l;return(0,F.jsx)(o.A,{span:24/S,children:u?(0,F.jsxs)("div",{children:[(0,F.jsxs)(_.A.Text,{strong:!0,children:[e.label," ",(null===(l=e.rules)||void 0===l?void 0:l.some((e=>e.required)))&&(0,F.jsx)(_.A.Text,{type:"danger",children:"*"})]}),(0,F.jsx)(x.A.Item,{name:e.name,rules:e.rules,style:{marginTop:"8px"},children:e.component})]}):(0,F.jsx)(x.A.Item,{label:(0,F.jsx)(_.A.Text,{strong:!0,children:e.label}),name:e.name,rules:e.rules,labelCol:{span:y},wrapperCol:{span:g},children:e.component})},t)})),p&&(0,F.jsx)(x.A.List,{name:"nestedItems",children:(e,t)=>{let{add:l,remove:i}=t;return(0,F.jsxs)(F.Fragment,{children:[e.map((e=>{let{key:t,name:l,fieldKey:n}=e,s=(0,j.A)(e,w);return(0,F.jsxs)(d.A,{gutter:[16,16],align:"middle",children:[h.map(((e,t)=>(0,F.jsx)(o.A,{children:(0,F.jsx)(x.A.Item,(0,a.A)((0,a.A)({},s),{},{name:[l,e.name],fieldKey:[n,e.name],rules:[{required:!0,message:"Missing ".concat(e.label)}],label:e.label,children:e.component}))},t))),(0,F.jsx)(o.A,{children:(0,F.jsx)(C.A,{onClick:()=>i(l)})})]},t)})),(0,F.jsx)(d.A,{justify:"center",children:(0,F.jsx)(o.A,{children:(0,F.jsx)(m.Ay,{type:"primary",onClick:()=>l(),icon:(0,F.jsx)(k.A,{}),children:"Add More Field"})})})]})}})]}),(0,F.jsxs)(d.A,{justify:"end",gutter:[16,16],style:{padding:"16px"},children:[(0,F.jsx)(o.A,{children:(0,F.jsx)(m.Ay,{onClick:()=>{n?n():r&&r(!1),null===A||void 0===A||A.resetFields()},children:"Cancel"})}),(0,F.jsx)(o.A,{children:(0,F.jsx)(m.Ay,{type:"primary",htmlType:"submit",loading:f,children:"Submit"})})]})]})]})};var I=l(4413),L=l(83537),N=l(89472),O=l(66507);var T=l(7866),M=l(12624),P=l(32513),R=l(96603);const{TextArea:D}=c.A,V=[{label:"Text",value:"text",category:"text"},{label:"Text Area",value:"textarea",category:"text"},{label:"Email",value:"email",category:"text"},{label:"Phone",value:"phone",category:"text"},{label:"URL",value:"url",category:"text"},{label:"Password",value:"password",category:"text"},{label:"Number (Integer)",value:"number",category:"number"},{label:"Decimal",value:"decimal",category:"number"},{label:"Boolean (Yes/No)",value:"boolean",category:"choice"},{label:"Checkbox",value:"checkbox",category:"choice"},{label:"Select (Dropdown)",value:"select",category:"choice"},{label:"Multi-Select",value:"multiselect",category:"choice"},{label:"Radio Buttons",value:"radio",category:"choice"},{label:"Date",value:"date",category:"date"},{label:"DateTime",value:"datetime",category:"date"}],E=e=>{const{field_name:t,label:l}=e,a=(e=>{const{label:t,is_required:l,validation_rules:a,field_type:i}=e,n=[];return l&&n.push({required:!0,message:"Please enter ".concat(t.toLowerCase())}),("email"===i||null!==a&&void 0!==a&&a.email)&&n.push({type:"email",message:"Please enter a valid email address"}),"url"===i&&n.push({type:"url",message:"Please enter a valid URL"}),void 0!==(null===a||void 0===a?void 0:a.min)&&n.push({type:"number",min:a.min,message:"Minimum value is ".concat(a.min)}),void 0!==(null===a||void 0===a?void 0:a.max)&&n.push({type:"number",max:a.max,message:"Maximum value is ".concat(a.max)}),null!==a&&void 0!==a&&a.pattern&&n.push({pattern:new RegExp(a.pattern),message:a.patternMessage||"Invalid format"}),n})(e),{component:i,valuePropName:n}=(e=>{const{field_type:t,label:l,placeholder:a,validation_rules:i}=e,n=a||"Enter ".concat(l.toLowerCase()),s=Array.isArray(null===i||void 0===i?void 0:i.options)?i.options:[];let d,o;switch(t.toLowerCase()){case"text":case"string":default:d=(0,F.jsx)(c.A,{placeholder:n});break;case"textarea":d=(0,F.jsx)(D,{rows:4,placeholder:n});break;case"email":d=(0,F.jsx)(c.A,{type:"email",placeholder:n});break;case"phone":case"tel":d=(0,F.jsx)(c.A,{type:"tel",placeholder:n});break;case"url":d=(0,F.jsx)(c.A,{type:"url",placeholder:n});break;case"password":d=(0,F.jsx)(c.A.Password,{placeholder:n});break;case"number":case"integer":d=(0,F.jsx)(T.A,{placeholder:n,style:{width:"100%"},min:null===i||void 0===i?void 0:i.min,max:null===i||void 0===i?void 0:i.max});break;case"decimal":case"float":d=(0,F.jsx)(T.A,{placeholder:n,style:{width:"100%"},min:null===i||void 0===i?void 0:i.min,max:null===i||void 0===i?void 0:i.max,step:.01,precision:2});break;case"boolean":case"switch":d=(0,F.jsx)(M.A,{checkedChildren:"Yes",unCheckedChildren:"No",defaultChecked:!1}),o="checked";break;case"checkbox":d=(0,F.jsx)(P.A,{children:l}),o="checked";break;case"select":case"dropdown":d=(0,F.jsx)(r.A,{placeholder:n,allowClear:!0,showSearch:!0,optionFilterProp:"children",options:s.map((e=>({label:e,value:e})))});break;case"multiselect":d=(0,F.jsx)(r.A,{mode:"multiple",placeholder:n,allowClear:!0,showSearch:!0,optionFilterProp:"children",options:s.map((e=>({label:e,value:e})))});break;case"radio":d=(0,F.jsx)(R.Ay.Group,{children:s.map((e=>(0,F.jsx)(R.Ay,{value:e,children:e},e)))});break;case"date":d=(0,F.jsx)(u.A,{style:{width:"100%"},format:"YYYY-MM-DD",placeholder:n});break;case"datetime":d=(0,F.jsx)(u.A,{showTime:!0,style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss",placeholder:n})}return{component:d,valuePropName:o}})(e),s={label:l,name:t,rules:a,component:i};return n&&(s.valuePropName=n),s};var q=l(74198);var B=l(62751),z=l(6051),U=l(42261),Y=l(14524),G=l(8354);const{TextArea:K}=c.A,W=i.memo((e=>{let{form:t,editingField:l,optionsText:a,onOptionsChange:n}=e;const s=x.A.useWatch("field_type",t),u=(0,i.useMemo)((()=>["select","multiselect","radio"].includes(s)),[s]),m=(0,i.useMemo)((()=>["number","integer","decimal"].includes(s)),[s]);return(0,F.jsxs)(x.A,{form:t,layout:"vertical",initialValues:{is_required:!1,is_active:!0,is_global:!1,display_order:0},children:[(0,F.jsxs)(d.A,{gutter:16,children:[(0,F.jsx)(o.A,{span:12,children:(0,F.jsx)(x.A.Item,{label:"Entity Name",name:"entity_name",rules:[{required:!0,message:"Please enter entity name"}],children:(0,F.jsx)(c.A,{disabled:!!l,placeholder:"e.g., products, customers"})})}),(0,F.jsx)(o.A,{span:12,children:(0,F.jsx)(x.A.Item,{label:"Field Name",name:"field_name",rules:[{required:!0,message:"Please enter field name"},{pattern:/^[a-z_][a-z0-9_]*$/i,message:"Must start with a letter, only letters, numbers, underscores"}],extra:"Use lowercase with underscores (e.g., custom_field_1)",children:(0,F.jsx)(c.A,{placeholder:"e.g., custom_field_1",disabled:!!l})})})]}),(0,F.jsxs)(d.A,{gutter:16,children:[(0,F.jsx)(o.A,{span:12,children:(0,F.jsx)(x.A.Item,{label:"Field Type",name:"field_type",rules:[{required:!0,message:"Please select field type"}],children:(0,F.jsx)(r.A,{placeholder:"Select field type",options:V})})}),(0,F.jsx)(o.A,{span:12,children:(0,F.jsx)(x.A.Item,{label:"Label",name:"label",rules:[{required:!0,message:"Please enter label"}],children:(0,F.jsx)(c.A,{placeholder:"Field label shown to users"})})})]}),(0,F.jsx)(x.A.Item,{label:"Placeholder",name:"placeholder",children:(0,F.jsx)(c.A,{placeholder:"Placeholder text (optional)"})}),u&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(G.A,{children:"Options Configuration"}),(0,F.jsx)(x.A.Item,{label:"Options (one per line)",extra:"Enter each option on a new line",required:!0,children:(0,F.jsx)(K,{rows:4,value:a,onChange:e=>n(e.target.value),placeholder:"Option 1\nOption 2\nOption 3"})})]}),m&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(G.A,{children:"Number Validation"}),(0,F.jsxs)(d.A,{gutter:16,children:[(0,F.jsx)(o.A,{span:12,children:(0,F.jsx)(x.A.Item,{label:"Min Value",name:"min",children:(0,F.jsx)(T.A,{placeholder:"Min",style:{width:"100%"}})})}),(0,F.jsx)(o.A,{span:12,children:(0,F.jsx)(x.A.Item,{label:"Max Value",name:"max",children:(0,F.jsx)(T.A,{placeholder:"Max",style:{width:"100%"}})})})]})]}),(0,F.jsx)(G.A,{children:"Display Settings"}),(0,F.jsxs)(d.A,{gutter:16,children:[(0,F.jsx)(o.A,{span:12,children:(0,F.jsx)(x.A.Item,{label:"Display Order",name:"display_order",extra:"Lower numbers appear first",children:(0,F.jsx)(T.A,{min:0,style:{width:"100%"}})})}),(0,F.jsx)(o.A,{span:12,children:(0,F.jsx)(x.A.Item,{label:"Business Type",name:"business_type",children:(0,F.jsx)(c.A,{placeholder:"Business type (optional)"})})})]}),(0,F.jsxs)(d.A,{gutter:16,children:[(0,F.jsx)(o.A,{span:8,children:(0,F.jsx)(x.A.Item,{label:"Required Field",name:"is_required",valuePropName:"checked",children:(0,F.jsx)(M.A,{})})}),(0,F.jsx)(o.A,{span:8,children:(0,F.jsx)(x.A.Item,{label:"Active",name:"is_active",valuePropName:"checked",children:(0,F.jsx)(M.A,{defaultChecked:!0})})}),(0,F.jsx)(o.A,{span:8,children:(0,F.jsx)(x.A.Item,{label:"Global Field",name:"is_global",valuePropName:"checked",children:(0,F.jsx)(M.A,{})})})]})]})}));W.displayName="FieldForm";const $=W;var H=l(76399),X=l(39249);const Z=e=>{let{data:t,loading:l,deleteLoading:a,onEdit:n,onDelete:d}=e;const o=(0,i.useMemo)((()=>[{title:"Label",dataIndex:"label",key:"label",sorter:(e,t)=>e.label.localeCompare(t.label)},{title:"Field Name",dataIndex:"field_name",key:"field_name",render:e=>(0,F.jsx)(H.A,{color:"blue",children:e})},{title:"Type",dataIndex:"field_type",key:"field_type",render:e=>(0,F.jsx)(H.A,{color:"cyan",children:e}),filters:V.map((e=>({text:e.label,value:e.value}))),onFilter:(e,t)=>t.field_type===e},{title:"Required",dataIndex:"is_required",key:"is_required",render:e=>(0,F.jsx)(H.A,{color:e?"red":"default",children:e?"Yes":"No"}),filters:[{text:"Required",value:!0},{text:"Optional",value:!1}],onFilter:(e,t)=>t.is_required===e},{title:"Active",dataIndex:"is_active",key:"is_active",render:e=>(0,F.jsx)(H.A,{color:e?"green":"default",children:e?"Yes":"No"}),filters:[{text:"Active",value:!0},{text:"Inactive",value:!1}],onFilter:(e,t)=>t.is_active===e},{title:"Order",dataIndex:"display_order",key:"display_order",sorter:(e,t)=>e.display_order-t.display_order,width:80},{title:"Actions",key:"actions",width:120,fixed:"right",render:(e,t)=>(0,F.jsxs)(z.A,{children:[(0,F.jsx)(m.Ay,{type:"link",size:"small",icon:(0,F.jsx)(p.A,{}),onClick:()=>n(t)}),(0,F.jsx)(s.A,{title:"Delete this field?",description:"This action cannot be undone.",onConfirm:()=>d(t._id),okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},children:(0,F.jsx)(m.Ay,{type:"link",size:"small",danger:!0,icon:(0,F.jsx)(h.A,{}),loading:a})})]})}]),[n,d,a]);return(0,F.jsx)(X.A,{dataSource:t,columns:o,loading:l,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0},size:"middle",scroll:{x:900}})},J=i.memo(Z),Q=e=>{let{entityName:t,businessType:l,tenantId:a,organisationId:n,onFieldsUpdated:s}=e;const d=(0,g.wA)(),o=(0,i.useMemo)((()=>(0,q._V)("FieldMetadata")),[]),{items:r,loading:c}=(0,y.Sm)(o.get.identifier),{items:u,loading:m}=(0,y.Sm)(o.create.identifier),{items:p,loading:h}=(0,y.Sm)(o.update.identifier),{items:x,loading:f}=(0,y.Sm)(o.delete.identifier),A=(0,i.useCallback)((()=>{d((0,y.s7)({method:o.get.method,endpoint:o.get.endpoint,data:{entity_name:t,is_active:void 0}},o.get.identifier))}),[d,t,o.get]);(0,i.useEffect)((()=>{const e=(e,t,l)=>{200===(null===e||void 0===e?void 0:e.statusCode)&&((0,v.P0)("success","Field ".concat(t," successfully")),A(),d((0,y.Ki)(l)))};e(u,"created",o.create.identifier),e(p,"updated",o.update.identifier),e(x,"deleted",o.delete.identifier)}),[u,p,x,A,d,o.create.identifier,o.update.identifier,o.delete.identifier]);const b=(0,i.useCallback)((async(e,t,i)=>{const s={},r=e.field_type;if(["select","multiselect","radio"].includes(r)){const e=t.split("\n").map((e=>e.trim())).filter((e=>e.length>0));if(0===e.length)return void(0,v.P0)("error","Please provide at least one option");s.options=e}void 0!==e.min&&null!==e.min&&(s.min=e.min),void 0!==e.max&&null!==e.max&&(s.max=e.max);const c={entity_name:e.entity_name,field_name:e.field_name,business_type:e.business_type||l,field_type:e.field_type,label:e.label,placeholder:e.placeholder,is_required:e.is_required||!1,validation_rules:s,display_order:e.display_order||0,is_active:!1!==e.is_active,is_global:e.is_global||!1};a&&(c.tenant_id=a),n&&(c.organisation_id=n);const u=(e=>{var t,l,a,i;const n=[];if(null!==(t=e.entity_name)&&void 0!==t&&t.trim()||n.push("Entity name is required"),null!==(l=e.field_name)&&void 0!==l&&l.trim()?/^[a-z_][a-z0-9_]*$/i.test(e.field_name)||n.push("Field name must start with a letter and contain only letters, numbers, and underscores"):n.push("Field name is required"),null!==(a=e.field_type)&&void 0!==a&&a.trim()||n.push("Field type is required"),null!==(i=e.label)&&void 0!==i&&i.trim()||n.push("Label is required"),["select","multiselect","radio"].includes(e.field_type||"")){var s;const t=null===(s=e.validation_rules)||void 0===s?void 0:s.options;t&&Array.isArray(t)&&0!==t.length||n.push("".concat(e.field_type," fields must have at least one option"))}if(["number","integer","decimal","float"].includes(e.field_type||"")&&e.validation_rules){const{min:t,max:l}=e.validation_rules;void 0!==t&&void 0!==l&&t>l&&n.push("Minimum value cannot be greater than maximum value")}return n})(c);if(u.length>0)return void(0,v.P0)("error",u[0]);const m=i?{method:o.update.method,endpoint:"".concat(o.update.endpoint,"/").concat(i._id),data:c}:{method:o.create.method,endpoint:o.create.endpoint,data:c};d((0,y.s7)(m,i?o.update.identifier:o.create.identifier))}),[l,a,n,o,d]),j=(0,i.useCallback)((e=>{d((0,y.s7)({method:o.delete.method,endpoint:"".concat(o.delete.endpoint,"/").concat(e),data:{_id:e}},o.delete.identifier))}),[d,o.delete]);return{fieldsData:(0,i.useMemo)((()=>(null===r||void 0===r?void 0:r.result)||[]),[null===r||void 0===r?void 0:r.result]),fieldsLoading:c,createLoading:m,updateLoading:h,deleteLoading:f,fetchFields:A,handleSubmitField:b,handleDeleteField:j}},ee=e=>{let{entityName:t,businessType:l="",tenantId:n,organisationId:s,onFieldsUpdated:d}=e;const[o]=x.A.useForm(),[r,c]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),[h,g]=(0,i.useState)(null),[y,v]=(0,i.useState)(""),[f,A]=(0,i.useState)(!1),{fieldsData:b,fieldsLoading:j,createLoading:_,updateLoading:C,deleteLoading:w,fetchFields:S,handleSubmitField:I,handleDeleteField:L}=Q({entityName:t,businessType:l,tenantId:n,organisationId:s,onFieldsUpdated:d});(0,i.useEffect)((()=>{r&&S()}),[r,S]);const N=(0,i.useCallback)((e=>{if(e){var i,n,s;g(e);const t=(null===(i=e.validation_rules)||void 0===i?void 0:i.options)||[];v(t.join("\n")),o.setFieldsValue((0,a.A)((0,a.A)({},e),{},{min:null===(n=e.validation_rules)||void 0===n?void 0:n.min,max:null===(s=e.validation_rules)||void 0===s?void 0:s.max}))}else g(null),v(""),o.resetFields(),o.setFieldsValue({entity_name:t,business_type:l,is_required:!1,is_active:!0,is_global:!1,display_order:(b.length||0)+1});p(!0)}),[o,t,l,b.length]),O=(0,i.useCallback)((async()=>{try{const e=await o.validateFields();await I(e,y,h),A(!0),p(!1),g(null),o.resetFields(),v("")}catch(e){console.error("Form validation failed:",e)}}),[o,y,h,I]),T=_||C,M=(0,i.useCallback)((()=>{c(!1),f&&d&&(d(),A(!1))}),[f,d]),P=(0,i.useCallback)((e=>{L(e),A(!0)}),[L]);return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(m.Ay,{icon:(0,F.jsx)(Y.A,{}),onClick:()=>c(!0),type:"default",children:"Manage Fields"}),(0,F.jsx)(B.A,{title:"Manage Fields - ".concat(t),open:r,onCancel:M,width:1e3,footer:[(0,F.jsx)(m.Ay,{onClick:M,children:"Close"},"close")],destroyOnClose:!0,children:(0,F.jsxs)(z.A,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,F.jsx)(U.A,{message:"Dynamic Fields",description:"Add custom fields to this entity. These fields will be automatically added to the form.",type:"info",showIcon:!0}),(0,F.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,F.jsx)(m.Ay,{type:"primary",icon:(0,F.jsx)(k.A,{}),onClick:()=>N(),children:"Add New Field"})}),(0,F.jsx)(J,{data:b,loading:j,deleteLoading:w,onEdit:N,onDelete:P})]})}),(0,F.jsx)(B.A,{title:h?"Edit Field":"Add New Field",open:u,onOk:O,onCancel:()=>{p(!1),g(null),o.resetFields(),v("")},width:700,confirmLoading:T,destroyOnClose:!0,children:(0,F.jsx)($,{form:o,editingField:h,optionsText:y,onOptionsChange:v})})]})},te=i.memo(ee);function le(e,t,l){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0;return{title:"Actions",key:"actions",render:(o,r)=>{const c=!i||i(r),u=!d||d(r);return(0,F.jsxs)("div",{style:{display:"flex",gap:"16px",justifyContent:"center",alignItems:"center"},children:[(0,F.jsx)(n.A,{title:c?"Edit ".concat(e):"No permission to edit",children:(0,F.jsx)(p.A,{style:{cursor:c?"pointer":"not-allowed",color:c?"#1890ff":"#d9d9d9",opacity:c?1:.5,fontSize:"16px",padding:"4px"},onClick:()=>c&&t(r)})}),(0,F.jsx)(n.A,{title:u?"Delete ".concat(e):"No permission to delete",children:(0,F.jsx)(s.A,{title:"Delete ".concat(e),description:"Are you sure you want to delete this item?",onConfirm:()=>l(r),okText:"Yes",cancelText:"No",disabled:a||!u,children:(0,F.jsx)(h.A,{style:{cursor:a||!u?"not-allowed":"pointer",color:a||!u?"#d9d9d9":"#ff4d4f",opacity:a||!u?.5:1,fontSize:"16px",padding:"4px"}})})})]})}}}const ae=e=>{let{config:t,filters:s=[],onFilterChange:p,customButtons:h=[],onValuesChange:f,enableSuperAdminFilters:j=!0,enableDynamicFields:_=!1,showDynamicColumnsInTable:C=!1,entityName:k}=e;const w=(()=>{const[e,t]=(0,i.useState)("all"),[l,a]=(0,i.useState)("all"),[n,s]=(0,i.useState)("all"),d=(0,i.useMemo)((()=>(0,N.HW)()),[]),o=O.A.getItem("scope"),r=(null===o||void 0===o?void 0:o.userType)||(null===d||void 0===d?void 0:d.user_type)||(null===d||void 0===d?void 0:d.usertype)||(null===d||void 0===d?void 0:d.user_role)||"",c="superadmin"===r.toLowerCase(),u="tenant"===r.toLowerCase(),m="organisationuser"===r.toLowerCase(),p="branchuser"===r.toLowerCase(),{getEntityApi:h}=(0,L.p)(),g=h("Tenant"),x=h("Organisations"),v=h("Braches"),{items:f,loading:A}=(0,y.Sm)(g.getIdentifier("GetAll")),{items:b,loading:j}=(0,y.Sm)(x.getIdentifier("GetAll")),{items:_,loading:C}=(0,y.Sm)(v.getIdentifier("GetAll"));(0,i.useEffect)((()=>{c?g("GetAll"):u?x("GetAll"):m&&v("GetAll")}),[c,u,m,p]);const k=(0,i.useMemo)((()=>{var e;return(null===f||void 0===f||null===(e=f.result)||void 0===e?void 0:e.map((e=>({label:e.organization_name||e.contact_name||e.username,value:e._id}))))||[]}),[f]),F=(0,i.useMemo)((()=>{let t=(null===b||void 0===b?void 0:b.result)||[];return c&&"all"!==e&&(t=t.filter((t=>t.tenant_id===e))),t.map((e=>({label:e.org_name||e.name,value:e._id})))}),[b,e,c]),w=(0,i.useMemo)((()=>{let e=(null===_||void 0===_?void 0:_.result)||[];return"all"!==l&&(e=e.filter((e=>e.organisation_id===l||e.org_id===l))),e.map((e=>({label:e.branch_name||e.name,value:e._id})))}),[_,l]),S=(0,i.useCallback)((e=>{t(e),a("all"),s("all"),"all"!==e&&x("GetAll",{tenant_id:e})}),[]),I=(0,i.useCallback)((e=>{a(e),s("all"),"all"!==e&&v("GetAll",{organisation_id:e})}),[]),T=(0,i.useCallback)((e=>{s(e)}),[]),M=(0,i.useCallback)((()=>{const t={};return c&&e&&"all"!==e&&(t.tenant_id=e),(c||u)&&l&&"all"!==l&&(t.organisation_id=l,t.org_id=l),(c||u||m)&&n&&"all"!==n&&(t.branch_id=n),t}),[c,u,m,e,l,n]);return{isSuperAdmin:c,isTenant:u,isOrganisationUser:m,isBranchUser:p,selectedTenant:e,selectedOrganisation:l,selectedBranch:n,tenantOptions:k,organisationOptions:F,branchOptions:w,handleTenantChange:S,handleOrganisationChange:I,handleBranchChange:T,tenantsLoading:A,organisationsLoading:j,branchesLoading:C,getApiFilters:M}})(),T=(0,i.useRef)(!0),{formItems:M,loading:P,refresh:R,dynamicFields:D}=(e=>{let{entityName:t,staticFormItems:l,enabled:a=!0,businessType:n}=e;const s=(0,g.wA)(),d=(0,i.useMemo)((()=>(0,q._V)("FieldMetadata")),[]),o=(0,i.useMemo)((()=>"".concat(d.get.identifier,"_").concat(t)),[d.get.identifier,t]),{items:r,loading:c}=(0,y.Sm)(o),u=(0,i.useCallback)((()=>{if(!a)return;const e={entity_name:t,is_active:!0};n&&(e.business_type=n),s((0,y.s7)({method:d.get.method,endpoint:d.get.endpoint,data:e},o))}),[s,t,n,a,d.get,o]),m=(0,i.useMemo)((()=>null!==r&&void 0!==r&&r.result?r.result.filter((e=>e.is_active)).sort(((e,t)=>e.display_order-t.display_order)):[]),[null===r||void 0===r?void 0:r.result]),p=(0,i.useMemo)((()=>m.map((e=>E(e)))),[m]),h=(0,i.useMemo)((()=>0===p.length?l:[...l,...p]),[l,p]);return(0,i.useEffect)((()=>{a&&u()}),[a,u]),{formItems:h,loading:c,refresh:u,dynamicFields:m,dynamicFormItems:p,staticFormItems:l}})({entityName:k||t.title.toLowerCase(),staticFormItems:t.formItems,enabled:_}),V=(0,i.useMemo)((()=>_&&D?D.map((e=>e.field_name)):[]),[D,_]),B=(0,i.useMemo)((()=>(0,a.A)((0,a.A)({},t),{},{dynamicFieldNames:V.length>0?V:void 0})),[t,V]),{loading:z,createLoading:U,updateLoading:Y,deleteLoading:G,items:K,pagination:W,drawerVisible:$,initialValues:H,form:X,handleEdit:Z,handleDelete:J,handleDrawerOpen:Q,resetForm:ee,handleSubmit:ae,handlePaginationChange:ie,columns:ne,formItems:se,formColumns:de=2,drawerWidth:oe,filterValues:re,setFilterValues:ce}=(e=>{const t=(0,g.wA)(),[l]=x.A.useForm(),[n,s]=(0,i.useState)(!1),[d,o]=(0,i.useState)({}),[r,c]=(0,i.useState)({}),[u,m]=(0,i.useState)({current:1,pageSize:10}),{loading:p,items:h}=(0,y.Sm)(e.apiRoutes.get.identifier),{loading:f,items:b,error:j}=(0,y.Sm)(e.apiRoutes.create.identifier),{loading:_,items:C,error:k}=(0,y.Sm)(e.apiRoutes.update.identifier),{loading:F,items:w,error:S}=(0,y.Sm)(e.apiRoutes.delete.identifier),I=(0,i.useCallback)(((e,l,a,i)=>{t((0,y.s7)({method:e,endpoint:l,data:a},i))}),[t]),L=(0,i.useCallback)((()=>{const t=(0,a.A)((0,a.A)({},r),{},{pageNumber:u.current,pageLimit:u.pageSize});I(e.apiRoutes.get.method,e.apiRoutes.get.endpoint,t,e.apiRoutes.get.identifier)}),[I,e.apiRoutes.get,r,u]),N=(0,i.useCallback)((t=>{I(e.apiRoutes.create.method,e.apiRoutes.create.endpoint,t,e.apiRoutes.create.identifier)}),[I,e.apiRoutes.create]),O=(0,i.useCallback)(((t,l)=>{I(e.apiRoutes.update.method,"".concat(e.apiRoutes.update.endpoint,"/").concat(t),l,e.apiRoutes.update.identifier)}),[I,e.apiRoutes.update]),T=(0,i.useCallback)((t=>{I(e.apiRoutes.delete.method,"".concat(e.apiRoutes.delete.endpoint,"/").concat(t),{_id:t},e.apiRoutes.delete.identifier)}),[I,e.apiRoutes.delete]),M=(0,i.useCallback)(((e,t)=>{m({current:e,pageSize:t})}),[]);function P(e){return/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})?)?$/.test(e)}const R=(0,i.useCallback)((t=>{const l={},a=e.metadataFieldName||"meta_data_values";for(const e in t){if(!t.hasOwnProperty(e))continue;const i=t[e];e!==a&&"meta_data_values"!==e&&"custom_data"!==e&&("string"===typeof i&&P(i)&&A()(i,void 0,!0).isValid()?l[e]=A()(i):l[e]=i)}const i=t[a];if(i&&"object"===typeof i)for(const e in i){if(!i.hasOwnProperty(e))continue;const t=i[e];null!==t&&void 0!==t&&("string"===typeof t&&P(t)&&A()(t,void 0,!0).isValid()?l[e]=A()(t):l[e]=t)}o(l),s(!0)}),[e.metadataFieldName]),D=(0,i.useCallback)((e=>{T(e._id)}),[T]),V=(0,i.useCallback)((()=>{s(!0)}),[]),E=(0,i.useCallback)((()=>{s(!1),o({}),l.resetFields()}),[l]),q=(0,i.useCallback)((t=>{let l=(0,a.A)({},t);if(e.dynamicFieldNames&&e.dynamicFieldNames.length>0){const i={},n={},s=e.metadataFieldName||"meta_data_values";Object.keys(t).forEach((l=>{var a;const s=t[l];null!==(a=e.dynamicFieldNames)&&void 0!==a&&a.includes(l)?void 0!==s&&(n[l]=s):i[l]=s})),l=Object.keys(n).length>0?e.skipMetadataWrapping?(0,a.A)((0,a.A)({},i),{},{[s]:n}):(0,a.A)((0,a.A)({},i),{},{[s]:n}):i}d._id?O(d._id,l):N(l)}),[d._id,N,O,e.dynamicFieldNames,e.metadataFieldName,e.skipMetadataWrapping]);return(0,i.useEffect)((()=>{if(200===(null===b||void 0===b?void 0:b.statusCode))(0,v.P0)("success","".concat(e.title," created successfully")),L(),E(),t((0,y.Ki)(e.apiRoutes.create.identifier));else if(j){const t=j.message||"Failed to create ".concat(e.title);(0,v.P0)("error",t)}}),[b,j,e.title,L,E,t,e.apiRoutes.create.identifier]),(0,i.useEffect)((()=>{if(200===(null===C||void 0===C?void 0:C.statusCode))(0,v.P0)("success","".concat(e.title," updated successfully")),L(),E(),t((0,y.Ki)(e.apiRoutes.update.identifier));else if(k){const t=k.message||"Failed to update ".concat(e.title);(0,v.P0)("error",t)}}),[C,k,e.title,L,E,t,e.apiRoutes.update.identifier]),(0,i.useEffect)((()=>{if(200===(null===w||void 0===w?void 0:w.statusCode))(0,v.P0)("success","".concat(e.title," deleted successfully")),L(),t((0,y.Ki)(e.apiRoutes.delete.identifier));else if(S){const t=S.message||"Failed to delete ".concat(e.title);(0,v.P0)("error",t)}}),[w,S,e.title,L,t,e.apiRoutes.delete.identifier]),(0,i.useEffect)((()=>{L()}),[L]),(0,a.A)({loading:p,createLoading:f,updateLoading:_,deleteLoading:F,items:null===h||void 0===h?void 0:h.result,pagination:null===h||void 0===h?void 0:h.pagination,drawerVisible:n,initialValues:d,form:l,filterValues:r,setFilterValues:c,handleEdit:R,handleDelete:D,handleDrawerOpen:V,resetForm:E,handleSubmit:q,handlePaginationChange:M},e)})(B),ue=_?M:se,me=(0,i.useMemo)((()=>{if(!C||!_||!D||0===D.length)return ne;const{generateColumnsFromMetadata:e}=l(88725),t=ne.length<=3&&ne.every((e=>["_id","createdAt","updatedAt"].includes(e.key)));if(t){const t=D.map((e=>e.field_name));return e(D,t)}{const t=D.map((e=>e.field_name)),l=e(D,t),a=ne.map((e=>e.key)),i=l.filter((e=>!a.includes(e.key)));return[...ne,...i]}}),[ne,C,_,D]),pe=(0,i.useCallback)(((e,t)=>{const l=(0,a.A)((0,a.A)({},re),{},{[e]:t}),i=j?(0,a.A)((0,a.A)({},l),w.getApiFilters()):l;ce(i),p&&p(i)}),[re,ce,p,j,w]);(0,i.useEffect)((()=>{if(T.current)T.current=!1;else if(j){const e=w.getApiFilters(),t=(0,a.A)((0,a.A)({},re),e);ce(t)}}),[w.selectedTenant,w.selectedOrganisation,w.selectedBranch,j]);const he=(0,i.useMemo)((()=>[...me,le(t.title,Z,J,G,t.canEdit,t.canDelete)]),[me,t.title,Z,J,G,t.canEdit,t.canDelete]);return(0,F.jsxs)("div",{children:[(0,F.jsxs)(d.A,{justify:"end",align:"bottom",gutter:[16,16],style:{marginBottom:16},children:[(0,F.jsx)(o.A,{flex:"auto",children:(0,F.jsx)("h1",{style:{margin:0},children:t.title})}),(0,F.jsx)(o.A,{children:(0,F.jsxs)(d.A,{gutter:[12,12],align:"bottom",justify:"end",wrap:!0,children:[j&&w.isSuperAdmin&&(0,F.jsx)(o.A,{children:(0,F.jsxs)(r.A,{placeholder:"Select Tenant",value:w.selectedTenant,onChange:e=>{w.handleTenantChange(e),pe("tenant_id","all"===e?void 0:e)},allowClear:!0,style:{width:200},loading:w.tenantsLoading,disabled:U||Y||G,children:[(0,F.jsx)(r.A.Option,{value:"all",children:"All Tenants"}),w.tenantOptions.map((e=>(0,F.jsx)(r.A.Option,{value:e.value,children:e.label},e.value)))]})}),j&&(w.isSuperAdmin||w.isTenant)&&!w.isOrganisationUser&&!w.isBranchUser&&(0,F.jsx)(o.A,{children:(0,F.jsxs)(r.A,{placeholder:w.isSuperAdmin&&"all"===w.selectedTenant?"Select tenant first":"Select Organisation",value:w.selectedOrganisation,onChange:e=>{w.handleOrganisationChange(e),pe("organisation_id","all"===e?void 0:e)},allowClear:!0,style:{width:200},loading:w.organisationsLoading,disabled:w.isSuperAdmin&&"all"===w.selectedTenant||U||Y||G,children:[(0,F.jsx)(r.A.Option,{value:"all",children:"All Organisations"}),w.organisationOptions.map((e=>(0,F.jsx)(r.A.Option,{value:e.value,children:e.label},e.value)))]})}),j&&(w.isSuperAdmin||w.isTenant||w.isOrganisationUser)&&!w.isBranchUser&&(0,F.jsx)(o.A,{children:(0,F.jsxs)(r.A,{placeholder:(w.isSuperAdmin||w.isTenant)&&"all"===w.selectedOrganisation?"Select organisation first":"Select Branch",value:w.selectedBranch,onChange:e=>{w.handleBranchChange(e),pe("branch_id","all"===e?void 0:e)},allowClear:!0,style:{width:200},loading:w.branchesLoading,disabled:(w.isSuperAdmin||w.isTenant)&&"all"===w.selectedOrganisation||U||Y||G,children:[(0,F.jsx)(r.A.Option,{value:"all",children:"All Branches"}),w.branchOptions.map((e=>(0,F.jsx)(r.A.Option,{value:e.value,children:e.label},e.value)))]})}),s.map((e=>{var t;return(0,F.jsxs)(o.A,{children:["input"===e.type&&(0,F.jsx)(c.A,{placeholder:e.placeholder||e.label,value:re[e.key]||"",onChange:t=>pe(e.key,t.target.value),style:{width:e.width||200},disabled:U||Y||G}),"select"===e.type&&(0,F.jsx)(r.A,{placeholder:e.placeholder||e.label,value:re[e.key],onChange:t=>{pe(e.key,t),e.onChange&&e.onChange(t)},allowClear:!0,style:{width:e.width||200},disabled:e.disabled||U||Y||G,children:null===(t=e.options)||void 0===t?void 0:t.map((e=>(0,F.jsx)(r.A.Option,{value:e.value,children:e.label},e.value)))}),"date"===e.type&&(0,F.jsx)(u.A,{placeholder:e.placeholder||e.label,value:re[e.key],onChange:t=>pe(e.key,t),style:{width:e.width||200},disabled:U||Y||G})]},e.key)})),(0,F.jsx)(o.A,{children:(0,F.jsx)(c.A,{placeholder:"Search ".concat(t.title),value:re.searchString||"",onChange:e=>pe("searchString",e.target.value),style:{width:200},disabled:U||Y||G})}),h.map((e=>(0,F.jsx)(o.A,{children:(0,F.jsx)(m.Ay,{type:e.type||"default",onClick:e.onClick,icon:e.icon,disabled:U||Y||G,children:e.label})},e.key))),_&&(0,F.jsx)(o.A,{children:(0,F.jsx)(te,{entityName:k||t.title.toLowerCase(),onFieldsUpdated:R})}),(()=>{const e=!t.canCreate||t.canCreate();return e?(0,F.jsx)(o.A,{children:(0,F.jsx)(n.A,{title:e?"":"No permission to create",children:(0,F.jsxs)(m.Ay,{type:"primary",onClick:Q,loading:U,disabled:U||!e,children:["Add ",t.title]})})}):null})()]})})]}),(0,F.jsx)(I.A,{columns:he,data:K,loading:z||G,rowKeyField:"_id",totalCount:(null===W||void 0===W?void 0:W.totalCount)||0,pageLimit:(null===W||void 0===W?void 0:W.pageLimit)||10,onPaginationChange:ie}),(0,F.jsx)(b.A,{title:"".concat(H._id?"Edit":"Add"," ").concat(t.title),open:$,onClose:U||Y?()=>{}:ee,width:oe,children:(0,F.jsx)(S,{form:X,formItems:ue,formColumns:de,initialValues:H,onSubmit:ae,onCancel:ee,onValuesChange:f,loading:U||Y})})]})},ie=i.memo(ae)},88725:(e,t,l)=>{l.r(t),l.d(t,{generateColumnsFromMetadata:()=>n,getAvailableColumns:()=>s,getDefaultVisibleColumns:()=>d});l(65043);var a=l(76399),i=l(70579);const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e&&0!==e.length?e.filter((e=>t.includes(e.field_name))).map((e=>({title:e.label,dataIndex:["custom_data",e.field_name],key:e.field_name,render:(t,l)=>{var n;const s=null===l||void 0===l||null===(n=l.custom_data)||void 0===n?void 0:n[e.field_name];if(null===s||void 0===s||""===s)return(0,i.jsx)("span",{style:{color:"#999"},children:"-"});switch(e.field_type){case"select":case"radio":return(0,i.jsx)(a.A,{color:"blue",children:String(s)});case"checkbox":return(0,i.jsx)(a.A,{color:s?"green":"red",children:s?"Yes":"No"});case"date":try{const e=new Date(s);return(0,i.jsx)("span",{style:{fontSize:"13px",color:"#666"},children:e.toLocaleDateString()})}catch(d){return(0,i.jsx)("span",{children:String(s)})}case"number":case"currency":return(0,i.jsx)("span",{style:{fontFamily:"monospace",fontWeight:500,color:"currency"===e.field_type?"#52c41a":"#1890ff"},children:"currency"===e.field_type?"$".concat(Number(s).toFixed(2)):Number(s).toLocaleString()});default:const t=String(s);return t.length>50?(0,i.jsxs)("span",{title:t,children:[t.substring(0,50),"..."]}):(0,i.jsx)("span",{children:t})}}}))):[]},s=e=>e.map((e=>({key:e.field_name,label:e.label,fieldType:e.field_type}))),d=e=>e.slice(0,5).map((e=>e.field_name))}}]);
//# sourceMappingURL=883.91f45dd3.chunk.js.map