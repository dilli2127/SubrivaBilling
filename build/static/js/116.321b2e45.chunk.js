/*! For license information please see 116.321b2e45.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[116],{73847:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(65043),s=r(78500),a=r(66381);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o.apply(this,arguments)}const c=(e,t)=>n.createElement(a.A,o({},e,{ref:t,icon:s.A}));const i=n.forwardRef(c)},83116:(e,t,r)=>{r.r(t),r.d(t,{default:()=>z});var n=r(65043),s=r(89379),a=r(62305),o=r(16569),c=r(62751),i=r(33359),l=r(9316),d=r(73847),u=r(4413),p=r(22671),g=r(83833),m=r(36621),y=r(26553),h=r(8354),x=r(6051),A=r(76399),f=r(89073),_=r(47419),b=r(11645),j=r(32513);const k=[{resource:"dashboard",label:"Dashboard",category:"Core",description:"Main dashboard view",menus:["dashboard"]},{resource:"sales_record",label:"Sales Records",category:"Sales",description:"Controls: SalesRecords menu, Create Sales, Sales List",menus:["SalesRecords","create-sales-record","sales-records-list"]},{resource:"customer",label:"Customers",category:"Sales",description:"Customer management",menus:["add-customer"]},{resource:"vendor",label:"Vendors",category:"Sales",description:"Vendor management",menus:["vendor"]},{resource:"product",label:"Products",category:"Inventory",description:"Product management",menus:["add-product"]},{resource:"unit",label:"Units",category:"Inventory",description:"Unit management",menus:["unit"]},{resource:"category",label:"Categories",category:"Inventory",description:"Category management",menus:["category"]},{resource:"variant",label:"Variants",category:"Inventory",description:"Variant management",menus:["variant"]},{resource:"warehouse",label:"Warehouses",category:"Inventory",description:"Warehouse management",menus:["warehouse"]},{resource:"rack",label:"Racks",category:"Inventory",description:"Rack management",menus:["rack"]},{resource:"stock_audit",label:"Stock In / Org Stock",category:"Stock",description:"Controls: Stock In, Organisation Stock Available",menus:["stock-in","organisation-stock-available"]},{resource:"stock_out",label:"Stock Out",category:"Stock",description:"Stock out management",menus:["stock-out"]},{resource:"branch_stock",label:"Branch Stock",category:"Stock",description:"Controls: Branch Stock, Branch Stock Available",menus:["branch-stock","branch-stock-available"]},{resource:"storage_stock",label:"Storage Stock",category:"Stock",description:"Storage stock list",menus:["storage-stock-list"]},{resource:"payment_history",label:"Payment History",category:"Financial",description:"Payment history management",menus:["payment-history"]},{resource:"expense",label:"Expenses",category:"Financial",description:"Expense management",menus:["expenses"]},{resource:"reports",label:"Reports",category:"Reports",description:"All reports",menus:["reports","report"]},{resource:"custom_entities",label:"Custom Forms",category:"Advanced",description:"Custom entity management",menus:["custom_forms"]},{resource:"settings",label:"Settings",category:"Settings",description:"Application settings",menus:["settings"]},{resource:"organisation",label:"Organisation",category:"Master Settings",description:"Organisation management",menus:["organisation"]},{resource:"branch",label:"Branches",category:"Master Settings",description:"Branch management",menus:["braches"]},{resource:"billing_user",label:"Users",category:"Master Settings",description:"User management",menus:["users"]},{resource:"role",label:"Roles",category:"Master Settings",description:"Role management",menus:["roles"]},{resource:"permission",label:"Permissions",category:"Master Settings",description:"Permission management",menus:["permissions"]},{resource:"tenant_account",label:"Tenant Accounts",category:"Tenant Management",description:"Tenant account management",menus:["tenant_account_list"]},{resource:"entity_definition",label:"Entity Definitions",category:"Tenant Management",description:"Entity definition management",menus:["entity_definitions"]}];let S=null;new Map;var v=r(70579);const{Title:C,Text:w}=g.A,{TextArea:R}=m.A,E=e=>{let{form:t,initialPermissions:r={},onPermissionsChange:o}=e;const[c,i]=(0,n.useState)(r),l=S||(S=k.reduce(((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e)),{}),S);(0,n.useEffect)((()=>{Object.keys(r).length>0&&i(r)}),[r]),(0,n.useEffect)((()=>{o&&o(c)}),[c,o]);const d=(e,t,r)=>{i((n=>(0,s.A)((0,s.A)({},n),{},{[e]:(0,s.A)((0,s.A)({},n[e]||{can_create:!1,can_read:!1,can_update:!1,can_delete:!1}),{},{[t]:r})})))},u=(e,t)=>{const r=(0,s.A)({},c);k.forEach((n=>{r[n.resource]||(r[n.resource]={can_create:!1,can_read:!1,can_update:!1,can_delete:!1}),r[n.resource][e]=t})),i(r)},p=()=>Object.entries(c).filter((e=>{let[t,r]=e;return r.can_create||r.can_read||r.can_update||r.can_delete})).map((e=>{let[t,r]=e;return{resource:t,can_create:r.can_create||!1,can_read:r.can_read||!1,can_update:r.can_update||!1,can_delete:r.can_delete||!1}}));return(0,n.useEffect)((()=>{t&&(t.getPermissionsArray=p)}),[c,t]),(0,v.jsxs)("div",{style:{width:"100%"},children:[(0,v.jsx)(a.A.Item,{label:"Role Name",name:"name",rules:[{required:!0,message:"Please enter role name!"}],children:(0,v.jsx)(m.A,{placeholder:"Enter role name"})}),(0,v.jsx)(a.A.Item,{label:"Role Type",name:"roles_type",rules:[{required:!0,message:"Please select role type!"}],children:(0,v.jsxs)(y.A,{placeholder:"Select role type",allowClear:!0,children:[(0,v.jsx)(y.A.Option,{value:"Admin",children:"Admin"}),(0,v.jsx)(y.A.Option,{value:"Manager",children:"Manager"}),(0,v.jsx)(y.A.Option,{value:"Employee",children:"Employee"}),(0,v.jsx)(y.A.Option,{value:"Salesman",children:"Salesman"})]})}),(0,v.jsx)(a.A.Item,{label:"Description",name:"description",children:(0,v.jsx)(R,{rows:3,placeholder:"Enter role description (optional)"})}),(0,v.jsx)(h.A,{orientation:"left",children:(0,v.jsxs)(x.A,{children:[(0,v.jsx)(C,{level:5,style:{margin:0},children:"Permissions (CRUD)"}),(0,v.jsx)(A.A,{color:"blue",children:"Select permissions for each resource"})]})}),(0,v.jsx)(f.A,{size:"small",style:{marginBottom:16,background:"#f0f2f5"},children:(0,v.jsxs)(_.A,{gutter:16,align:"middle",children:[(0,v.jsx)(b.A,{span:8,children:(0,v.jsx)(w,{strong:!0,children:"Select All:"})}),(0,v.jsx)(b.A,{span:4,style:{textAlign:"center"},children:(0,v.jsx)(j.A,{onChange:e=>u("can_create",e.target.checked),children:(0,v.jsx)(w,{strong:!0,children:"Create"})})}),(0,v.jsx)(b.A,{span:4,style:{textAlign:"center"},children:(0,v.jsx)(j.A,{onChange:e=>u("can_read",e.target.checked),children:(0,v.jsx)(w,{strong:!0,children:"Read"})})}),(0,v.jsx)(b.A,{span:4,style:{textAlign:"center"},children:(0,v.jsx)(j.A,{onChange:e=>u("can_update",e.target.checked),children:(0,v.jsx)(w,{strong:!0,children:"Update"})})}),(0,v.jsx)(b.A,{span:4,style:{textAlign:"center"},children:(0,v.jsx)(j.A,{onChange:e=>u("can_delete",e.target.checked),children:(0,v.jsx)(w,{strong:!0,children:"Delete"})})})]})}),(0,v.jsx)("div",{style:{maxHeight:"500px",overflowY:"auto",paddingRight:8},children:Object.entries(l).map((e=>{let[t,r]=e;return(0,v.jsx)(f.A,{title:(0,v.jsx)(w,{strong:!0,children:t}),size:"small",style:{marginBottom:16},children:r.map((e=>{const t=c[e.resource]||{can_create:!1,can_read:!1,can_update:!1,can_delete:!1},r=t.can_create&&t.can_read&&t.can_update&&t.can_delete;return(0,v.jsxs)(_.A,{gutter:16,align:"middle",style:{marginBottom:12,padding:8,borderBottom:"1px solid #f0f0f0"},children:[(0,v.jsx)(b.A,{span:8,children:(0,v.jsxs)(x.A,{direction:"vertical",size:0,children:[(0,v.jsxs)(x.A,{children:[(0,v.jsx)(w,{strong:!0,children:e.label}),(0,v.jsx)(j.A,{checked:r,onChange:t=>{return r=e.resource,n=t.target.checked,void i((e=>(0,s.A)((0,s.A)({},e),{},{[r]:{can_create:n,can_read:n,can_update:n,can_delete:n}})));var r,n},style:{fontSize:11},children:(0,v.jsx)(w,{type:"secondary",style:{fontSize:11},children:"All"})})]}),(0,v.jsx)(w,{type:"secondary",style:{fontSize:11},children:e.description})]})}),(0,v.jsx)(b.A,{span:4,style:{textAlign:"center"},children:(0,v.jsx)(j.A,{checked:t.can_create,onChange:t=>d(e.resource,"can_create",t.target.checked)})}),(0,v.jsx)(b.A,{span:4,style:{textAlign:"center"},children:(0,v.jsx)(j.A,{checked:t.can_read,onChange:t=>d(e.resource,"can_read",t.target.checked)})}),(0,v.jsx)(b.A,{span:4,style:{textAlign:"center"},children:(0,v.jsx)(j.A,{checked:t.can_update,onChange:t=>d(e.resource,"can_update",t.target.checked)})}),(0,v.jsx)(b.A,{span:4,style:{textAlign:"center"},children:(0,v.jsx)(j.A,{checked:t.can_delete,onChange:t=>d(e.resource,"can_delete",t.target.checked)})})]},e.resource)}))},t)}))}),(0,v.jsx)(a.A.Item,{name:"permissions",hidden:!0,children:(0,v.jsx)(m.A,{type:"hidden"})})]})},I=[{title:"Role Name",dataIndex:"name",key:"name",render:e=>(0,v.jsx)("strong",{children:e})},{title:"Role Type",dataIndex:"roles_type",key:"roles_type",render:e=>(0,v.jsx)("span",{style:{padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"500",backgroundColor:"Admin"===e?"#f6ffed":"#fff7e6",color:"Admin"===e?"#52c41a":"#fa8c16",border:"1px solid ".concat("Admin"===e?"#b7eb8f":"#ffd591")},children:e})},{title:"Description",dataIndex:"description",key:"description",ellipsis:!0}];var P=r(93259);const O=()=>{const[e]=a.A.useForm(),[t,r]=(0,n.useState)([]),[g,m]=(0,n.useState)(!1),[y,h]=(0,n.useState)(!1),[x,A]=(0,n.useState)(null),[f,_]=(0,n.useState)({}),[b,j]=(0,n.useState)(!1),[k,S]=(0,n.useState)({current:1,pageSize:10,total:0});(0,n.useEffect)((()=>{C()}),[k.current,k.pageSize]);const C=async()=>{m(!0);try{const e=await(0,P.A)({method:"GET",endpoint:"/roles",data:{pageNumber:k.current,pageLimit:k.pageSize}});if(200===e.statusCode){r(e.result||[]);const t=e.pagination;S((r=>{var n;return(0,s.A)((0,s.A)({},r),{},{total:(null===t||void 0===t?void 0:t.total)||(null===(n=e.result)||void 0===n?void 0:n.length)||0})}))}else o.Ay.error("Failed to fetch roles: ".concat(e.message||"Unknown error"))}catch(e){console.error("Error fetching roles:",e),o.Ay.error("Error fetching roles")}finally{m(!1)}},w=()=>{h(!1),e.resetFields(),_({}),A(null)},R=[...I,{title:"Actions",key:"actions",render:(t,r)=>(0,v.jsxs)("div",{style:{display:"flex",gap:"16px",justifyContent:"center"},children:[(0,v.jsx)(i.A,{style:{cursor:"pointer",color:"#1890ff",fontSize:"16px"},onClick:()=>(async t=>{A(t),e.setFieldsValue({name:t.name,description:t.description,roles_type:t.roles_type});try{const e=await(0,P.A)({method:"GET",endpoint:"/permissions/role/".concat(t._id)});if(200===e.statusCode){var r;const t=(null===(r=e.result)||void 0===r?void 0:r.resources)||[],n={};t.forEach((e=>{n[e.resource]={can_create:e.can_create,can_read:e.can_read,can_update:e.can_update,can_delete:e.can_delete}})),_(n)}}catch(n){console.error("Error fetching role permissions:",n),o.Ay.warning("Could not load permissions for this role")}h(!0)})(r)}),(0,v.jsx)(l.A,{style:{cursor:"pointer",color:"#ff4d4f",fontSize:"16px"},onClick:()=>(async e=>{c.A.confirm({title:"Delete Role",content:'Are you sure you want to delete role "'.concat(e.name,'"?'),okText:"Yes",okType:"danger",cancelText:"No",onOk:async()=>{try{const t=await(0,P.A)({method:"DELETE",endpoint:"/roles/".concat(e._id)});200===t.statusCode?(o.Ay.success("Role deleted successfully"),C()):o.Ay.error("Failed to delete role: ".concat(t.message||"Unknown error"))}catch(t){console.error("Error deleting role:",t),o.Ay.error("Error deleting role")}}})})(r)})]})}];return(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,v.jsx)("h1",{style:{margin:0},children:"Roles"}),(0,v.jsxs)("button",{onClick:()=>{A(null),_({}),e.resetFields(),h(!0)},style:{padding:"8px 16px",background:"#1890ff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[(0,v.jsx)(d.A,{})," Add Role"]})]}),(0,v.jsx)(u.A,{columns:R,data:t,loading:g,totalCount:k.total,pageLimit:k.pageSize,onPaginationChange:(e,t)=>{S((r=>(0,s.A)((0,s.A)({},r),{},{current:e,pageSize:t})))},rowKeyField:"_id"}),(0,v.jsx)(p.A,{title:x?"Edit Role":"Create Role",open:y,onClose:w,width:900,children:(0,v.jsxs)(a.A,{form:e,layout:"vertical",onFinish:async()=>{try{const t=await e.validateFields(),r=Object.entries(f).filter((e=>{let[t,r]=e;return r.can_create||r.can_read||r.can_update||r.can_delete})).map((e=>{let[t,r]=e;return{resource:t,can_create:r.can_create||!1,can_read:r.can_read||!1,can_update:r.can_update||!1,can_delete:r.can_delete||!1}}));if(0===r.length)return void o.Ay.warning("Please select at least one permission");const n={name:t.name,description:t.description,roles_type:t.roles_type,permissions:r};if(j(!0),x){const t=await(0,P.A)({method:"PATCH",endpoint:"/roles/".concat(x._id),data:n});200===t.statusCode?(o.Ay.success("Role updated successfully"),h(!1),e.resetFields(),_({}),C()):o.Ay.error("Failed to update role: ".concat(t.message||"Unknown error"))}else{const t=await(0,P.A)({method:"POST",endpoint:"/roles",data:n});201===t.statusCode||200===t.statusCode?(o.Ay.success("Role created successfully"),h(!1),e.resetFields(),_({}),C()):o.Ay.error("Failed to create role: ".concat(t.message||"Unknown error"))}}catch(t){console.error("Error submitting role:",t),t.errorFields?o.Ay.error("Please fill in all required fields"):o.Ay.error("Error submitting role")}finally{j(!1)}},children:[(0,v.jsx)(E,{form:e,initialPermissions:f,onPermissionsChange:_}),(0,v.jsxs)("div",{style:{marginTop:24,display:"flex",justifyContent:"flex-end",gap:12},children:[(0,v.jsx)("button",{type:"button",onClick:w,style:{padding:"8px 24px",background:"#fff",color:"#000",border:"1px solid #d9d9d9",borderRadius:"4px",cursor:"pointer"},children:"Cancel"}),(0,v.jsx)("button",{type:"submit",disabled:b,style:{padding:"8px 24px",background:b?"#d9d9d9":"#1890ff",color:"white",border:"none",borderRadius:"4px",cursor:b?"not-allowed":"pointer"},children:b?"Submitting...":"Submit"})]})]})})]})},T=(0,n.memo)(O),F=()=>(0,v.jsx)(T,{}),z=(0,n.memo)(F)}}]);
//# sourceMappingURL=116.321b2e45.chunk.js.map