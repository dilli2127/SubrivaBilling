/*! For license information please see 832.f4043992.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[832],{6881:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(65043),a=n(51762),l=n(66381);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s.apply(this,arguments)}const c=(e,t)=>i.createElement(l.A,s({},e,{ref:t,icon:a.A}));const r=i.forwardRef(c)},37421:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var i=n(89379),a=n(65043),l=n(89472),s=n(83833),c=n(16569),r=n(95206),o=n(7866),d=n(60446),u=n.n(d),h=n(21448),v=n(38963),m=n(93310),p=n(36091),y=n(94834),b=n(88143),g=n(18796),x=n(73469),A=n(87768),_=n(61345),f=n(43281),j=n(70224),C=n(28665),w=n(70579);const{Title:k,Text:S}=s.A,O=e=>{let{billdata:t,onSuccess:n}=e;const s=(0,a.useMemo)((()=>(0,l.HW)()),[]),{data:d,isLoading:O}=(0,C.Kc)({pageLimit:1e3}),{data:T,isLoading:B}=(0,C.nK)({pageLimit:1e3}),{data:I,isLoading:H}=(0,C.fC)({pageLimit:1e3}),{data:N,isLoading:E}=(0,C.E0)({pageLimit:1e3}),[V,{isLoading:L}]=(0,C.E$)(),M=(null===d||void 0===d?void 0:d.result)||[],q=(null===T||void 0===T||T.result,null===I||void 0===I||I.result,(null===N||void 0===N?void 0:N.result)||[]),[z,P]=(0,a.useState)({invoice_no:"AUTO-GENERATED",date:u()().format("YYYY-MM-DD"),customer_id:"",customer_name:"",billed_by_id:(null===s||void 0===s?void 0:s._id)||"",billed_by_name:(null===s||void 0===s?void 0:s.name)||(null===s||void 0===s?void 0:s.username)||"",payment_mode:"Cash",items:[]}),[D,R]=(0,a.useState)(!1),[G,Y]=(0,a.useState)(!1),[F,U]=(0,a.useState)(!1),[Q,K]=(0,a.useState)(""),[W,$]=(0,a.useState)(!1),[J,X]=(0,a.useState)(!1),[Z,ee]=(0,a.useState)(null);(0,a.useEffect)((()=>{t&&P(t)}),[t]);const te=(0,a.useCallback)((e=>{P((t=>(0,i.A)((0,i.A)({},t),e)))}),[]),ne=(0,a.useCallback)((()=>{const e={key:Date.now().toString(),product_id:"",product_name:"",variant_name:"",stock_id:"",qty:1,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0,quantity:1,rate:0};P((t=>(0,i.A)((0,i.A)({},t),{},{items:[...t.items,e]}))),ee({row:z.items.length,col:0})}),[z.items.length]),ie=(0,a.useCallback)((e=>{ee({row:e,col:0})}),[]),ae=(0,a.useCallback)(((e,t,n)=>{P((a=>{const l=[...a.items];return l[e]=(0,i.A)((0,i.A)({},l[e]),{},{[t]:n}),(0,i.A)((0,i.A)({},a),{},{items:l})}))}),[]),le=(0,a.useCallback)((e=>{P((t=>(0,i.A)((0,i.A)({},t),{},{items:t.items.filter(((t,n)=>n!==e))})))}),[]),se=(0,a.useCallback)((()=>{P({invoice_no:"AUTO-GENERATED",date:u()().format("YYYY-MM-DD"),customer_id:"",customer_name:"",billed_by_id:(null===s||void 0===s?void 0:s._id)||"",billed_by_name:(null===s||void 0===s?void 0:s.name)||(null===s||void 0===s?void 0:s.username)||"",payment_mode:"Cash",items:[]}),c.Ay.info("Bill cleared!")}),[s]),ce=(0,a.useCallback)((async()=>{if(0!==z.items.length)try{const e=(0,i.A)((0,i.A)({},z),{},{items:z.items.map((e=>(0,i.A)((0,i.A)({},e),{},{amount:(e.qty||0)*(e.price||0)}))),created_at:(new Date).toISOString()}),t=await V(e).unwrap();200===t.statusCode?(c.Ay.success("Bill saved successfully!"),null===n||void 0===n||n(t.data||t.result),se()):c.Ay.error(t.message||"Failed to save bill")}catch(t){var e;c.Ay.error((null===(e=t.data)||void 0===e?void 0:e.message)||t.message||"Network error")}else c.Ay.error("Please add at least one item to the bill")}),[z,V,n,se]),re=(0,a.useCallback)((()=>{c.Ay.info("Print functionality coming soon!")}),[]),oe=(0,a.useCallback)((()=>{Y(!0)}),[]),de=(0,a.useCallback)((e=>{te({customer_id:e._id,customer_name:e.full_name}),$(!1)}),[te]),ue=(0,a.useCallback)((e=>{te({billed_by_id:e._id,billed_by_name:e.name}),X(!1)}),[te]),he=O||B||H||E,ve=(0,a.useMemo)((()=>(0,v.l)({items:z.items,productList:[],isGstIncluded:!0,discount:0,discountType:"percentage"})),[z.items]),me=(0,a.useMemo)((()=>[{title:"Product",dataIndex:"product_id",key:"product_id",width:250,editable:!0,inputType:"select",options:M.map((e=>({value:e._id,label:e.name}))),onCellChange:(e,t,n)=>{const i=M.find((t=>t._id===e));var a;i&&(ae(n,"product_id",i._id),ae(n,"product_name",i.name),ae(n,"price",i.price),ae(n,"mrp",i.mrp),ae(n,"tax_percentage",(null===(a=i.CategoryItem)||void 0===a?void 0:a.tax_percentage)||0),ae(n,"stock_id",""),ae(n,"batch_no",""))},render:(e,t)=>t.product_name||"Select Product"},{title:"Batch No / Stock",dataIndex:"stock_id",key:"stock_id",width:200,editable:!0,inputType:"select",options:e=>q.filter((t=>t.product_id===e.product_id)).map((e=>({value:e._id,label:"".concat(e.batch_no||"N/A"," (Qty: ").concat(e.available_quantity,", Loose: ").concat(e.available_loose_quantity,")")}))),onCellChange:(e,t,n)=>{const i=q.find((t=>t._id===e));i&&(ae(n,"stock_id",i._id),ae(n,"batch_no",i.batch_no))},render:(e,t)=>{const n=q.find((t=>t._id===e));return n?"".concat(n.batch_no||"N/A"," (Qty: ").concat(n.available_quantity,")"):"Select Stock"}},{title:"Qty",dataIndex:"qty",key:"qty",width:100,editable:!0,inputType:"number",onCellChange:(e,t,n)=>ae(n,"qty",e),render:e=>e},{title:"Loose Qty",dataIndex:"loose_qty",key:"loose_qty",width:120,editable:!0,inputType:"number",onCellChange:(e,t,n)=>ae(n,"loose_qty",e),render:e=>e},{title:"Price",dataIndex:"price",key:"price",width:120,editable:!0,inputType:"number",onCellChange:(e,t,n)=>ae(n,"price",e),render:e=>"\u20b9".concat(e.toFixed(2))},{title:"MRP",dataIndex:"mrp",key:"mrp",width:120,editable:!0,inputType:"number",onCellChange:(e,t,n)=>ae(n,"mrp",e),render:e=>"\u20b9".concat(e.toFixed(2))},{title:"Tax %",dataIndex:"tax_percentage",key:"tax_percentage",width:100,editable:!0,inputType:"number",onCellChange:(e,t,n)=>ae(n,"tax_percentage",e),render:e=>"".concat(e,"%")},{title:"Amount",dataIndex:"amount",key:"amount",width:150,render:(e,t)=>{const n=(t.qty||0)*(t.price||0);return"\u20b9".concat(n.toFixed(2))}},{title:"Actions",dataIndex:"actions",key:"actions",width:100,render:(e,t,n)=>(0,w.jsxs)("div",{children:[(0,w.jsx)(r.Ay,{type:"text",onClick:()=>ie(n||0),size:"small",children:"Edit"}),(0,w.jsx)(r.Ay,{type:"text",danger:!0,onClick:()=>le(n||0),size:"small",children:"Delete"})]})}]),[M,q,ae,ie,le]);return(0,w.jsxs)("div",{className:j.A.billDataGrid,children:[(0,w.jsxs)("div",{className:j.A.billHeader,children:[(0,w.jsx)(k,{level:3,children:"New Retail Bill"}),(0,w.jsxs)("div",{className:j.A.billDetails,children:[(0,w.jsxs)("div",{children:[(0,w.jsx)(S,{strong:!0,children:"Invoice No:"}),(0,w.jsx)(o.A,{value:z.invoice_no,readOnly:!0,style:{marginTop:4,width:"100%"}})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)(S,{strong:!0,children:"Date:"}),(0,w.jsx)(o.A,{value:z.date,readOnly:!0,style:{marginTop:4,width:"100%"}})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)(S,{strong:!0,children:"Customer:"}),(0,w.jsx)(r.Ay,{onClick:()=>$(!0),style:{marginTop:4,width:"100%"},children:z.customer_name||"Select Customer"})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)(S,{strong:!0,children:"Billed By:"}),(0,w.jsx)(r.Ay,{onClick:()=>X(!0),style:{marginTop:4,width:"100%"},children:z.billed_by_name||"Select User"})]})]}),(0,w.jsxs)("div",{className:j.A.actionButtons,children:[(0,w.jsx)(r.Ay,{icon:(0,w.jsx)(m.A,{}),onClick:se,children:"Clear Bill"}),(0,w.jsx)(r.Ay,{icon:(0,w.jsx)(p.A,{}),onClick:oe,children:"View Bills"}),(0,w.jsx)(r.Ay,{icon:(0,w.jsx)(y.A,{}),onClick:re,children:"Print Bill"}),(0,w.jsx)(r.Ay,{type:"primary",icon:(0,w.jsx)(b.A,{}),onClick:ce,loading:L,children:"Save Bill"})]})]}),(0,w.jsxs)("div",{className:j.A.itemsTable,children:[(0,w.jsx)(h.A,{dataSource:z.items,columns:me,loading:he,rowKey:"key",externalEditingCell:Z,onSave:()=>{}}),(0,w.jsx)(r.Ay,{onClick:ne,type:"dashed",style:{width:"100%",marginTop:16},children:"Add Item"})]}),(0,w.jsxs)("div",{className:j.A.billTotals,children:[(0,w.jsx)(k,{level:4,children:"Bill Totals"}),(0,w.jsxs)("div",{className:j.A.totalsGrid,children:[(0,w.jsxs)("div",{children:[(0,w.jsx)(S,{strong:!0,children:"Subtotal:"}),(0,w.jsx)("div",{children:(0,w.jsxs)(S,{strong:!0,children:["\u20b9",ve.sub_total.toFixed(2)]})})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)(S,{strong:!0,children:"GST:"}),(0,w.jsx)("div",{children:(0,w.jsxs)(S,{strong:!0,children:["\u20b9",ve.total_gst.toFixed(2)]})})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)(S,{strong:!0,children:"Total:"}),(0,w.jsx)("div",{children:(0,w.jsxs)(S,{strong:!0,style:{fontSize:18,color:"#1890ff"},children:["\u20b9",ve.total_amount.toFixed(2)]})})]})]})]}),(0,w.jsx)(g.A,{visible:W,onSelect:de,onCancel:()=>$(!1)}),(0,w.jsx)(x.A,{visible:J,onSelect:ue,onCancel:()=>X(!1)}),(0,w.jsx)(A.A,{visible:D,onCancel:()=>R(!1),onNewBill:()=>R(!1),onContinueBill:()=>R(!1)}),(0,w.jsx)(_.A,{visible:G,onClose:()=>Y(!1),onViewBill:()=>{},onNewBill:()=>{}}),(0,w.jsx)(f.A,{visible:F,productId:Q,onCancel:()=>{U(!1),K("")}})]})}},61118:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(65043),a=n(82211),l=n(66381);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s.apply(this,arguments)}const c=(e,t)=>i.createElement(l.A,s({},e,{ref:t,icon:a.A}));const r=i.forwardRef(c)},67177:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(65043);const a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"};var l=n(66381);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s.apply(this,arguments)}const c=(e,t)=>i.createElement(l.A,s({},e,{ref:t,icon:a}));const r=i.forwardRef(c)},73847:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(65043),a=n(78500),l=n(66381);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s.apply(this,arguments)}const c=(e,t)=>i.createElement(l.A,s({},e,{ref:t,icon:a.A}));const r=i.forwardRef(c)},93310:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(65043);const a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"};var l=n(66381);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s.apply(this,arguments)}const c=(e,t)=>i.createElement(l.A,s({},e,{ref:t,icon:a}));const r=i.forwardRef(c)},94834:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(65043);const a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M820 436h-40c-4.4 0-8 3.6-8 8v40c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-40c0-4.4-3.6-8-8-8zm32-104H732V120c0-4.4-3.6-8-8-8H300c-4.4 0-8 3.6-8 8v212H172c-44.2 0-80 35.8-80 80v328c0 17.7 14.3 32 32 32h168v132c0 4.4 3.6 8 8 8h424c4.4 0 8-3.6 8-8V772h168c17.7 0 32-14.3 32-32V412c0-44.2-35.8-80-80-80zM360 180h304v152H360V180zm304 664H360V568h304v276zm200-140H732V500H292v204H160V412c0-6.6 5.4-12 12-12h680c6.6 0 12 5.4 12 12v292z"}}]},name:"printer",theme:"outlined"};var l=n(66381);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},s.apply(this,arguments)}const c=(e,t)=>i.createElement(l.A,s({},e,{ref:t,icon:a}));const r=i.forwardRef(c)}}]);
//# sourceMappingURL=832.f4043992.chunk.js.map