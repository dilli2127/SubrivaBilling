{"version":3,"file":"static/js/468.3a74e833.chunk.js","mappings":"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","sources":["pages/RetaillBill/components/ProductSelectionModal.tsx","pages/RetaillBill/components/StockSelectionModal.tsx","components/common/AntdEditableTable.tsx","pages/RetaillBill/components/CustomerSelectionModal.tsx","pages/RetaillBill/components/UserSelectionModal.tsx","pages/RetaillBill/components/BillSaveConfirmationModal.tsx","pages/RetaillBill/components/BillListDrawer.tsx","pages/RetaillBill/components/ProductDetailsModal.tsx","webpack://FOCUZ-BILLING/./src/pages/RetaillBill/components/BillDataGrid.module.css?232c","pages/RetaillBill/components/BillDataGrid.tsx","helpers/amount_calculations.ts"],"sourcesContent":["import React, { useEffect, useState, FC, KeyboardEvent, useRef } from 'react';\r\nimport { Modal, Table, Input } from 'antd';\r\nimport type { InputRef } from 'antd/es/input';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport type { ColumnType } from 'antd/es/table';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\n\r\nconst { Search } = Input;\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name?: string;\r\n  sku?: string;\r\n  selling_price?: number;\r\n  VariantItem?: {\r\n    variant_name?: string;\r\n    variant_code?: string;\r\n  };\r\n}\r\n\r\ninterface ProductSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (product: Product) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst ProductSelectionModal: FC<ProductSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const ProductsApi = getEntityApi('Product');\r\n  const { items: products, loading } = useDynamicSelector(\r\n    ProductsApi.getIdentifier('GetAll')\r\n  );\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedRowKey, setSelectedRowKey] = useState<React.Key | null>(null);\r\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\r\n  const searchInputRef = useRef<InputRef>(null);\r\n\r\n  const filteredProducts: Product[] =\r\n    products?.result?.filter((p: Product) => {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      return (\r\n        (p.name?.toLowerCase() || '').includes(searchLower) ||\r\n        (p.sku?.toLowerCase() || '').includes(searchLower) ||\r\n        p.VariantItem?.variant_name?.toLowerCase().includes(searchLower) ||\r\n        p.VariantItem?.variant_code?.toLowerCase().includes(searchLower) ||\r\n        (p.selling_price?.toString() || '').includes(searchLower)\r\n      );\r\n    }).sort((a: Product, b: Product) => {\r\n      // Prioritize exact matches and matches at the beginning\r\n      const searchLower = searchTerm.toLowerCase();\r\n      \r\n      // Check for exact matches first\r\n      const aExactMatch = (a.name?.toLowerCase() || '') === searchLower || \r\n                          a.VariantItem?.variant_name?.toLowerCase() === searchLower ||\r\n                          (a.sku?.toLowerCase() || '') === searchLower;\r\n      const bExactMatch = (b.name?.toLowerCase() || '') === searchLower || \r\n                          b.VariantItem?.variant_name?.toLowerCase() === searchLower ||\r\n                          (b.sku?.toLowerCase() || '') === searchLower;\r\n      \r\n      if (aExactMatch && !bExactMatch) return -1;\r\n      if (!aExactMatch && bExactMatch) return 1;\r\n      \r\n      // Then check for matches at the beginning\r\n      const aStartsWith = (a.name?.toLowerCase() || '').startsWith(searchLower) || \r\n                          a.VariantItem?.variant_name?.toLowerCase().startsWith(searchLower) ||\r\n                          (a.sku?.toLowerCase() || '').startsWith(searchLower);\r\n      const bStartsWith = (b.name?.toLowerCase() || '').startsWith(searchLower) || \r\n                          b.VariantItem?.variant_name?.toLowerCase().startsWith(searchLower) ||\r\n                          (b.sku?.toLowerCase() || '').startsWith(searchLower);\r\n      \r\n      if (aStartsWith && !bStartsWith) return -1;\r\n      if (!aStartsWith && bStartsWith) return 1;\r\n      \r\n      return 0;\r\n    }) || [];\r\n\r\n  useEffect(() => {\r\n    setHighlightedIndex(0);\r\n    if (filteredProducts.length > 0) {\r\n              setSelectedRowKey(filteredProducts[0]._id);\r\n    } else {\r\n      setSelectedRowKey(null);\r\n    }\r\n  }, [searchTerm, visible, products]);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n      }, 100);\r\n    }\r\n  }, [visible]);\r\n\r\n  const columns: ColumnType<Product>[] = [\r\n    { \r\n      title: 'Product & Variant', \r\n      dataIndex: 'name', \r\n      key: 'name', \r\n      width: 250,\r\n      render: (name, record) => (\r\n        <div>\r\n          <div style={{ fontWeight: 600, color: '#1890ff' }}>{name}</div>\r\n          {record.VariantItem?.variant_name && (\r\n            <div style={{ fontSize: '12px', color: '#52c41a', marginTop: '2px' }}>\r\n              Variant: {record.VariantItem.variant_name}\r\n              {record.VariantItem?.variant_code && (\r\n                <span style={{ marginLeft: '8px', color: '#fa8c16', fontSize: '11px' }}>\r\n                  ({record.VariantItem.variant_code})\r\n                </span>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    { title: 'Variant', dataIndex: 'VariantItem', key: 'variant', width: 120, \r\n      render: (variant) => variant?.variant_name ? (\r\n        <span style={{ color: '#52c41a', fontWeight: 500 }}>{variant.variant_name}</span>\r\n      ) : (\r\n        <span style={{ color: '#bfbfbf', fontStyle: 'italic' }}>No variant</span>\r\n      ) },\r\n    { title: 'SKU', dataIndex: 'sku', key: 'sku', width: 120 },\r\n    { title: 'Price', dataIndex: 'selling_price', key: 'selling_price', width: 100,\r\n      render: (price) => (\r\n        <span style={{ \r\n          color: '#52c41a', \r\n          fontWeight: 600, \r\n          fontSize: '14px' \r\n        }}>\r\n          {price?.toFixed(2) || '0.00'}\r\n        </span>\r\n      ) },\r\n  ];\r\n\r\n  const handleSelectRow = (product: Product) => {\r\n    onSelect(product);\r\n  };\r\n\r\n  const handleSearchKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!filteredProducts.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        const next = Math.min(prev + 1, filteredProducts.length - 1);\r\n        setSelectedRowKey(filteredProducts[next]._id);\r\n        return next;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        const prevIndex = Math.max(prev - 1, 0);\r\n        setSelectedRowKey(filteredProducts[prevIndex]._id);\r\n        return prevIndex;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedProduct = filteredProducts[highlightedIndex];\r\n      if (selectedProduct) {\r\n        handleSelectRow(selectedProduct);\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      onCancel();\r\n    }\r\n  };\r\n\r\n  // Auto-focus back to search input when clicking outside\r\n  const handleModalClick = () => {\r\n    searchInputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select Product & Variant (F5 to reopen anytime)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      width={900}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div onClick={handleModalClick}>\r\n        <Search\r\n          ref={searchInputRef}\r\n          placeholder=\"Search by product name, variant, SKU, or price (use  arrows to navigate, Enter to select)\"\r\n          onChange={e => setSearchTerm(e.target.value)}\r\n          style={{ marginBottom: 16 }}\r\n          autoFocus\r\n          onKeyDown={handleSearchKeyDown}\r\n          onBlur={() => {\r\n            // Re-focus after a short delay to ensure it stays focused\r\n            setTimeout(() => {\r\n              if (visible) {\r\n                searchInputRef.current?.focus();\r\n              }\r\n            }, 10);\r\n          }}\r\n        />\r\n        <Table\r\n          dataSource={filteredProducts}\r\n          columns={columns}\r\n          loading={loading}\r\n          rowKey=\"_id\"\r\n          size=\"small\"\r\n          pagination={false}\r\n          onRow={(record, idx) => ({\r\n            onClick: () => {\r\n              handleSelectRow(record);\r\n              // Keep focus on search input after selection\r\n              setTimeout(() => {\r\n                searchInputRef.current?.focus();\r\n              }, 10);\r\n            },\r\n            onDoubleClick: () => handleSelectRow(record),\r\n            className:\r\n              idx === highlightedIndex\r\n                ? 'ant-table-row ant-table-row-selected'\r\n                : 'ant-table-row',\r\n            style: {\r\n              backgroundColor: idx === highlightedIndex ? '#e6f7ff' : undefined,\r\n              border: idx === highlightedIndex ? '2px solid #1890ff' : undefined,\r\n            },\r\n          })}\r\n          rowSelection={{\r\n            type: 'radio',\r\n            selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n            onChange: keys => {\r\n              setSelectedRowKey(keys[0]);\r\n              const idx = filteredProducts.findIndex(p => p._id === keys[0]);\r\n              if (idx !== -1) setHighlightedIndex(idx);\r\n            },\r\n          }}\r\n          scroll={{ y: 300 }}\r\n        />\r\n              <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n        <strong>Keyboard Shortcuts:</strong>  Navigate products | Enter Select | Escape Cancel\r\n        <br />\r\n        <strong>Search:</strong> Product name, variant name, SKU, or price\r\n        <br />\r\n        <strong>Tip:</strong> Press F5 anytime to reopen this modal for product changes\r\n      </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProductSelectionModal;\r\n","import React, { useEffect, useState, FC, KeyboardEvent, useRef } from 'react';\r\nimport { Modal, Table, Input, Tag, Tooltip, message } from 'antd';\r\nimport type { InputRef } from 'antd/es/input';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport type { ColumnType } from 'antd/es/table';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\nimport dayjs from 'dayjs';\r\nimport {\r\n  ExclamationCircleOutlined,\r\n  CheckCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport type { Stock } from '../../../types/entities';\r\n\r\nconst { Search } = Input;\r\n\r\ninterface StockSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (stock: {\r\n    id: string;\r\n    _id: string;\r\n    batch_no: string;\r\n    name: string;\r\n    code?: string;\r\n    available_quantity: number;\r\n    sell_price: number;\r\n  }) => void;\r\n  onCancel: () => void;\r\n  productId: string;\r\n}\r\n\r\nconst StockSelectionModal: FC<StockSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n  productId, // <-- Destructure\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const StockApi = getEntityApi('StockAudit');\r\n  const { items: stocks, loading } = useDynamicSelector(\r\n    StockApi.getIdentifier('GetAll')\r\n  );\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedRowKey, setSelectedRowKey] = useState<React.Key | null>(null);\r\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\r\n  const [errorMessage, setErrorMessage] = useState<string>('');\r\n  const tableBodyRef = useRef<HTMLDivElement>(null);\r\n  const searchInputRef = useRef<InputRef>(null);\r\n\r\n  // Helper function to check if stock is expired\r\n  const isStockExpired = (stock: Stock): boolean => {\r\n    return !!(stock.expiry_date && dayjs(stock.expiry_date).isBefore(dayjs()));\r\n  };\r\n\r\n  // Helper function to check if stock has zero quantity\r\n  const isStockOutOfStock = (stock: Stock): boolean => {\r\n    return stock.available_quantity <= 0;\r\n  };\r\n\r\n  // Helper function to show expired stock error message\r\n  const showExpiredStockError = (stock: Stock) => {\r\n    const expiryDate = dayjs(stock.expiry_date).format('DD/MM/YYYY');\r\n    const errorMsg = `Cannot select expired stock! This item expired on ${expiryDate}. Please select a valid stock item.`;\r\n    setErrorMessage(errorMsg);\r\n    message.error(errorMsg);\r\n\r\n    // Clear error message after 5 seconds\r\n    setTimeout(() => {\r\n      setErrorMessage('');\r\n    }, 5000);\r\n  };\r\n\r\n  // Helper function to show out of stock error message\r\n  const showOutOfStockError = (stock: Stock) => {\r\n    const errorMsg = `Cannot select out of stock item! This item has 0 available quantity. Please select a stock item with available quantity.`;\r\n    setErrorMessage(errorMsg);\r\n    message.error(errorMsg);\r\n\r\n    // Clear error message after 5 seconds\r\n    setTimeout(() => {\r\n      setErrorMessage('');\r\n    }, 5000);\r\n  };\r\n\r\n  const filteredStocks: Stock[] =\r\n    stocks?.result?.filter((s: Stock) => {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      return (\r\n        s.batch_no?.toLowerCase().includes(searchLower) ||\r\n        s.ProductItem?.name?.toLowerCase().includes(searchLower) ||\r\n        s.ProductItem?.VariantItem?.variant_name\r\n          ?.toLowerCase()\r\n          .includes(searchLower) ||\r\n        s.available_quantity?.toString().includes(searchLower) ||\r\n        s.sell_price?.toString().includes(searchLower)\r\n      );\r\n    }) || [];\r\n\r\n  // Show all stocks including expired ones, but disable selection of expired items\r\n  const allStocks = filteredStocks;\r\n\r\n  useEffect(() => {\r\n    setHighlightedIndex(0);\r\n    setErrorMessage(''); // Clear any existing error messages\r\n    if (allStocks.length > 0) {\r\n      // Find the first valid stock (not expired and not out of stock)\r\n      let firstValidIndex = 0;\r\n      while (\r\n        firstValidIndex < allStocks.length &&\r\n        ((allStocks[firstValidIndex].expiry_date &&\r\n          dayjs(allStocks[firstValidIndex].expiry_date).isBefore(dayjs())) ||\r\n          allStocks[firstValidIndex].available_quantity <= 0)\r\n      ) {\r\n        firstValidIndex++;\r\n      }\r\n      if (firstValidIndex < allStocks.length) {\r\n        setSelectedRowKey(allStocks[firstValidIndex]._id);\r\n        setHighlightedIndex(firstValidIndex);\r\n      } else {\r\n        setSelectedRowKey(null);\r\n      }\r\n    } else {\r\n      setSelectedRowKey(null);\r\n    }\r\n  }, [searchTerm, visible, stocks]);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setErrorMessage(''); // Clear error messages when modal opens\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n      }, 0);\r\n    }\r\n  }, [visible]);\r\n\r\n  useEffect(() => {\r\n    if (tableBodyRef.current) {\r\n      const row = tableBodyRef.current.querySelector(\r\n        `.ant-table-row[data-row-key='${allStocks[highlightedIndex]?._id}']`\r\n      ) as HTMLElement;\r\n      row?.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  }, [highlightedIndex, allStocks]);\r\n\r\n  useEffect(() => {\r\n    if (visible && productId) {\r\n      StockApi('GetAll', { product: productId });\r\n    }\r\n  }, [visible, productId, StockApi]);\r\n\r\n  const columns: ColumnType<Stock>[] = [\r\n    {\r\n      title: 'Product',\r\n      dataIndex: 'ProductItem',\r\n      key: 'product',\r\n      render: (ProductItem: any) => ProductItem?.name || 'N/A',\r\n    },\r\n    {\r\n      title: 'Variant',\r\n      dataIndex: 'ProductItem',\r\n      key: 'variant',\r\n      render: (ProductItem: any) =>\r\n        ProductItem?.VariantItem?.variant_name || 'N/A',\r\n    },\r\n    { title: 'Batch No', dataIndex: 'batch_no', key: 'batch_no' },\r\n    {\r\n      title: 'Available',\r\n      dataIndex: 'available_quantity',\r\n      key: 'available_quantity',\r\n      render: (available_quantity: number, record: Stock) => {\r\n        const isOutOfStock = available_quantity <= 0;\r\n        return (\r\n          <span\r\n            style={{\r\n              color: isOutOfStock ? '#ff4d4f' : '#52c41a',\r\n              fontWeight: isOutOfStock ? 'bold' : 'normal',\r\n            }}\r\n          >\r\n            {available_quantity}\r\n            {isOutOfStock && (\r\n              <ExclamationCircleOutlined\r\n                style={{ marginLeft: 4, color: '#ff4d4f' }}\r\n              />\r\n            )}\r\n          </span>\r\n        );\r\n      },\r\n    },\r\n    { title: 'Price', dataIndex: 'sell_price', key: 'sell_price' },\r\n    {\r\n      title: 'Expiry Date',\r\n      dataIndex: 'expiry_date',\r\n      key: 'expiry_date',\r\n      render: (expiry_date: string, record: Stock) => {\r\n        if (!expiry_date)\r\n          return <span style={{ color: '#999' }}>No Expiry</span>;\r\n\r\n        const expiryDate = dayjs(expiry_date);\r\n        const today = dayjs();\r\n        const isExpired = expiryDate.isBefore(today);\r\n        const daysUntilExpiry = expiryDate.diff(today, 'days');\r\n\r\n        let color = 'green';\r\n        let icon = <CheckCircleOutlined />;\r\n        let status = 'Valid';\r\n\r\n        if (isExpired) {\r\n          color = 'red';\r\n          icon = <ExclamationCircleOutlined />;\r\n          status = 'Expired';\r\n        } else if (daysUntilExpiry <= 30) {\r\n          color = 'orange';\r\n          icon = <ExclamationCircleOutlined />;\r\n          status = `Expires in ${daysUntilExpiry} days`;\r\n        }\r\n\r\n        return (\r\n          <Tooltip title={status}>\r\n            <Tag color={color} icon={icon}>\r\n              {expiryDate.format('DD/MM/YYYY')}\r\n            </Tag>\r\n          </Tooltip>\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  const handleSelectRow = (stock: Stock) => {\r\n    // Check if stock is expired and show error message\r\n    if (isStockExpired(stock)) {\r\n      showExpiredStockError(stock);\r\n      return;\r\n    }\r\n\r\n    // Check if stock is out of stock and show error message\r\n    if (isStockOutOfStock(stock)) {\r\n      showOutOfStockError(stock);\r\n      return;\r\n    }\r\n\r\n    // Clear any existing error message\r\n    setErrorMessage('');\r\n\r\n    onSelect({\r\n      id: stock._id,\r\n      _id: stock._id,\r\n      batch_no: stock.batch_no,\r\n      name: stock.ProductItem?.name || stock.name || '',\r\n      code: stock.code,\r\n      available_quantity: stock.available_quantity,\r\n      sell_price: stock.sell_price,\r\n    });\r\n  };\r\n\r\n  const handleSearchKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!allStocks.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        let next = prev + 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          next < allStocks.length &&\r\n          ((allStocks[next].expiry_date &&\r\n            dayjs(allStocks[next].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[next].available_quantity <= 0)\r\n        ) {\r\n          next++;\r\n        }\r\n        const finalNext = Math.min(next, allStocks.length - 1);\r\n        setSelectedRowKey(allStocks[finalNext]._id);\r\n        return finalNext;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        let prevIndex = prev - 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          prevIndex >= 0 &&\r\n          ((allStocks[prevIndex].expiry_date &&\r\n            dayjs(allStocks[prevIndex].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[prevIndex].available_quantity <= 0)\r\n        ) {\r\n          prevIndex--;\r\n        }\r\n        const finalPrev = Math.max(prevIndex, 0);\r\n        setSelectedRowKey(allStocks[finalPrev]._id);\r\n        return finalPrev;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedStock = allStocks[highlightedIndex];\r\n      if (selectedStock) {\r\n        handleSelectRow(selectedStock);\r\n        // Only close modal if selection was successful (not expired and not out of stock)\r\n        if (\r\n          !isStockExpired(selectedStock) &&\r\n          !isStockOutOfStock(selectedStock)\r\n        ) {\r\n          onCancel(); // Close the modal after selection\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleTableKeyDown = (e: KeyboardEvent<HTMLDivElement>) => {\r\n    if (!allStocks.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(i => {\r\n        let next = i + 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          next < allStocks.length &&\r\n          ((allStocks[next].expiry_date &&\r\n            dayjs(allStocks[next].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[next].available_quantity <= 0)\r\n        ) {\r\n          next++;\r\n        }\r\n        const finalNext = Math.min(next, allStocks.length - 1);\r\n        setSelectedRowKey(allStocks[finalNext]._id);\r\n        return finalNext;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(i => {\r\n        let prev = i - 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          prev >= 0 &&\r\n          ((allStocks[prev].expiry_date &&\r\n            dayjs(allStocks[prev].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[prev].available_quantity <= 0)\r\n        ) {\r\n          prev--;\r\n        }\r\n        const finalPrev = Math.max(prev, 0);\r\n        setSelectedRowKey(allStocks[finalPrev]._id);\r\n        return finalPrev;\r\n      });\r\n      // Keep focus on search input\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedStock = allStocks[highlightedIndex];\r\n      if (selectedStock) {\r\n        handleSelectRow(selectedStock);\r\n        // Only close modal if selection was successful (not expired and not out of stock)\r\n        if (\r\n          !isStockExpired(selectedStock) &&\r\n          !isStockOutOfStock(selectedStock)\r\n        ) {\r\n          onCancel(); // Close the modal after selection\r\n        }\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Tab' && e.shiftKey) {\r\n      e.preventDefault();\r\n      searchInputRef.current?.focus();\r\n    }\r\n  };\r\n\r\n  // Auto-focus back to search input when clicking outside\r\n  const handleModalClick = () => {\r\n    searchInputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select Stock (F7 to reopen anytime)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      width={800}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div onClick={handleModalClick}>\r\n        <Search\r\n          ref={searchInputRef}\r\n          placeholder=\"Search stocks (use  arrows to navigate, Enter to select)\"\r\n          onChange={e => setSearchTerm(e.target.value)}\r\n          style={{ marginBottom: 16 }}\r\n          autoFocus\r\n          onKeyDown={handleSearchKeyDown}\r\n          onBlur={() => {\r\n            // Re-focus after a short delay to ensure it stays focused\r\n            setTimeout(() => {\r\n              if (visible) {\r\n                searchInputRef.current?.focus();\r\n              }\r\n            }, 10);\r\n          }}\r\n        />\r\n\r\n        {/* Error Message Display */}\r\n        {errorMessage && (\r\n          <div\r\n            style={{\r\n              marginBottom: 16,\r\n              padding: '12px 16px',\r\n              backgroundColor: '#fff2f0',\r\n              border: '1px solid #ffccc7',\r\n              borderRadius: '6px',\r\n              color: '#cf1322',\r\n              fontSize: '14px',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '8px',\r\n            }}\r\n          >\r\n            <ExclamationCircleOutlined style={{ color: '#cf1322' }} />\r\n            {errorMessage}\r\n          </div>\r\n        )}\r\n\r\n        <div\r\n          onKeyDown={handleTableKeyDown}\r\n          tabIndex={0}\r\n          ref={tableBodyRef}\r\n          style={{ outline: 'none' }}\r\n        >\r\n          <Table\r\n            dataSource={allStocks}\r\n            columns={columns}\r\n            loading={loading}\r\n            rowKey=\"_id\"\r\n            size=\"small\"\r\n            pagination={false}\r\n            title={() => (\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  justifyContent: 'space-between',\r\n                  alignItems: 'center',\r\n                  padding: '8px 0',\r\n                }}\r\n              >\r\n                <span>Stock Items</span>\r\n                <div style={{ fontSize: '12px', color: '#666' }}>\r\n                  <span style={{ color: '#52c41a' }}> Valid</span>\r\n                  <span style={{ margin: '0 8px', color: '#faad14' }}>\r\n                     Near Expiry\r\n                  </span>\r\n                  <span style={{ color: '#ff4d4f' }}>\r\n                     Expired/Out of Stock (Disabled)\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            )}\r\n            onRow={(record, idx) => {\r\n              const isExpired = isStockExpired(record);\r\n              const isOutOfStock = isStockOutOfStock(record);\r\n              return {\r\n                onClick: () => {\r\n                  if (!isExpired && !isOutOfStock) {\r\n                    handleSelectRow(record);\r\n                    // Keep focus on search input after selection\r\n                    setTimeout(() => {\r\n                      searchInputRef.current?.focus();\r\n                    }, 10);\r\n                  } else if (isExpired) {\r\n                    showExpiredStockError(record);\r\n                  } else if (isOutOfStock) {\r\n                    showOutOfStockError(record);\r\n                  }\r\n                },\r\n                onDoubleClick: () => {\r\n                  if (!isExpired && !isOutOfStock) {\r\n                    handleSelectRow(record);\r\n                  } else if (isExpired) {\r\n                    showExpiredStockError(record);\r\n                  } else if (isOutOfStock) {\r\n                    showOutOfStockError(record);\r\n                  }\r\n                },\r\n                className:\r\n                  idx === highlightedIndex\r\n                    ? 'ant-table-row ant-table-row-selected'\r\n                    : 'ant-table-row',\r\n                'data-row-key': record._id,\r\n                style: {\r\n                  opacity: isExpired || isOutOfStock ? 0.6 : 1,\r\n                  cursor: isExpired || isOutOfStock ? 'not-allowed' : 'pointer',\r\n                  backgroundColor:\r\n                    isExpired || isOutOfStock ? '#f5f5f5' : undefined,\r\n                },\r\n              };\r\n            }}\r\n            rowSelection={{\r\n              type: 'radio',\r\n              selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n              onChange: (keys: React.Key[]) => {\r\n                setSelectedRowKey(keys[0]);\r\n                const idx = allStocks.findIndex(s => s._id === keys[0]);\r\n                if (idx !== -1) setHighlightedIndex(idx);\r\n              },\r\n              getCheckboxProps: (record: Stock) => ({\r\n                disabled: isStockExpired(record) || isStockOutOfStock(record),\r\n              }),\r\n            }}\r\n          />\r\n          <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n            <strong>Keyboard Shortcuts:</strong>  Navigate stocks | Enter\r\n            Select | Escape Cancel\r\n            <br />\r\n            <strong>Tip:</strong> Press F7 anytime to reopen this modal for\r\n            stock changes\r\n            <br />\r\n            <strong>Note:</strong> Expired items () and out of stock items\r\n            () are shown but cannot be selected. Navigation automatically\r\n            skips expired and out of stock items.\r\n            <br />\r\n            <strong>Error Handling:</strong> Attempting to select expired or out\r\n            of stock items will show an error message and prevent selection.\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default StockSelectionModal;\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Table,\r\n  Input,\r\n  InputNumber,\r\n  Select,\r\n  DatePicker,\r\n  Button,\r\n  Space,\r\n  Modal,\r\n  Typography,\r\n  message,\r\n  TableProps,\r\n} from 'antd';\r\nimport type { SizeType } from 'antd/es/config-provider/SizeContext';\r\nimport { PlusOutlined, DeleteOutlined, SaveOutlined } from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport './AntdEditableTable.css';\r\nimport ProductSelectionModal from '../../pages/RetaillBill/components/ProductSelectionModal';\r\nimport StockSelectionModal from '../../pages/RetaillBill/components/StockSelectionModal';\r\n\r\nconst { Text } = Typography;\r\n\r\nexport interface AntdEditableColumn {\r\n  title: string;\r\n  dataIndex: string;\r\n  key?: string;\r\n  defaultValue?: any;\r\n  type?: 'text' | 'number' | 'select' | 'date' | 'product' | 'stock';\r\n  options?: { label: string; value: any }[];\r\n  required?: boolean;\r\n  width?: number;\r\n  editable?: boolean;\r\n  validation?: (value: any) => string | undefined;\r\n  render?: (value: any, record?: any, rowIndex?: number) => React.ReactNode;\r\n}\r\n\r\nexport interface AntdEditableTableProps {\r\n  columns: AntdEditableColumn[];\r\n  dataSource: any[];\r\n  onSave: (data: any[]) => void;\r\n  onAdd?: () => void;\r\n  onDelete?: (indices: number[]) => void;\r\n  onProductSelect?: (product: any, rowIndex: number) => void;\r\n  allowAdd?: boolean;\r\n  allowDelete?: boolean;\r\n  rowKey?: string;\r\n  loading?: boolean;\r\n  compact?: boolean;\r\n  enableKeyboardNav?: boolean;\r\n  size?: SizeType;\r\n  className?: string;\r\n  externalEditingCell?: { row: number; col: number } | null;\r\n}\r\n\r\nconst AntdEditableTable: React.FC<AntdEditableTableProps> = ({\r\n  columns,\r\n  dataSource,\r\n  onSave,\r\n  onAdd,\r\n  onDelete,\r\n  allowAdd = true,\r\n  allowDelete = true,\r\n  rowKey = 'key',\r\n  loading = false,\r\n  compact = false,\r\n  enableKeyboardNav = true,\r\n  size = 'middle',\r\n  className,\r\n  onProductSelect,\r\n  externalEditingCell,\r\n}) => {\r\n  const [data, setData] = useState<any[]>([]);\r\n  const [selectedRows, setSelectedRows] = useState<any[]>([]);\r\n  const [editingCell, setEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n  const firstLoadRef = useRef(true);\r\n\r\n  useEffect(() => {\r\n    setData(dataSource);\r\n\r\n    const firstProductColIndex = columns.findIndex(\r\n      col => col.dataIndex === 'product_id'\r\n    );\r\n\r\n    //  Auto-focus only if table is empty on first load\r\n    if (\r\n      firstLoadRef.current &&\r\n      dataSource.length === 0 &&\r\n      firstProductColIndex >= 0\r\n    ) {\r\n      setEditingCell({ row: 0, col: firstProductColIndex });\r\n      firstLoadRef.current = false; // Prevent repeat auto-focus\r\n    }else{\r\n      setSelectedRows(dataSource.length>0?[String(dataSource.length-1)]:[])\r\n    }\r\n  }, [dataSource, columns]);\r\n\r\n  // Sync editingCell with externalEditingCell prop\r\n  useEffect(() => {\r\n    if (externalEditingCell) {\r\n      setEditingCell(externalEditingCell);\r\n    }\r\n  }, [externalEditingCell]);\r\n\r\n  const handleAddRow = () => {\r\n    onAdd?.();\r\n    // Set focus to the first editable cell of the new row (after parent updates data)\r\n    const firstEditableCol = columns.findIndex(col => col.editable !== false);\r\n    if (firstEditableCol >= 0) {\r\n      setEditingCell({ row: data.length, col: firstEditableCol });\r\n    }\r\n  };\r\n\r\n  const handleDeleteRow = () => {\r\n    if (data.length === 0) {\r\n      message.warning('No rows to delete');\r\n      return;\r\n    }\r\n    Modal.confirm({\r\n      title: 'Are you sure you want to delete the selected Bill Items?',\r\n      onOk: () => {\r\n        const newData = data.slice(0, -1);\r\n        setData(newData);\r\n        onSave(newData);\r\n        onDelete?.(selectedRows);\r\n      },\r\n    });\r\n  };\r\n\r\n  const saveCell = (row: number, col: number, value: any): boolean => {\r\n    const column = columns[col];\r\n\r\n    // Basic validation\r\n    if (column.required && (!value || value === '')) {\r\n      message.error(`${column.title} is required`);\r\n      return false;\r\n    }\r\n\r\n    // Custom validation\r\n    if (column.validation) {\r\n      const error = column.validation(value);\r\n      if (error) {\r\n        message.error(error);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const newData = [...data];\r\n    newData[row][columns[col].dataIndex] = value;\r\n    setData(newData);\r\n    onSave(newData);\r\n    return true;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.ctrlKey && e.key === 's') {\r\n        e.preventDefault();\r\n        onSave(data);\r\n      }\r\n      if (e.shiftKey && e.key.toLowerCase() === 'a' && allowAdd) {\r\n        e.preventDefault();\r\n        handleAddRow();\r\n      }\r\n    };\r\n    if (enableKeyboardNav) {\r\n      document.addEventListener('keydown', handleKeyDown);\r\n      return () => document.removeEventListener('keydown', handleKeyDown);\r\n    }\r\n  }, [data, allowAdd, onSave, enableKeyboardNav, handleAddRow]);\r\n\r\n  const rowSelection: TableProps<any>['rowSelection'] = {\r\n    onChange: (selectedRowKeys: React.Key[], selectedRows:any[]) => {\r\n      setSelectedRows([...selectedRowKeys]);\r\n    },\r\n  };\r\n  \r\n  // Helper to find the next editable column index\r\n  function getNextEditableCol(startCol: number, direction: 1 | -1, columns: AntdEditableColumn[]): number {\r\n    let col = startCol + direction;\r\n    while (col >= 0 && col < columns.length) {\r\n      if (columns[col].editable !== false) return col;\r\n      col += direction;\r\n    }\r\n    return -1; // No editable column found\r\n  }\r\n\r\n  const EditableCell = ({\r\n    row,\r\n    col,\r\n    value,\r\n  }: {\r\n    row: number;\r\n    col: number;\r\n    value: any;\r\n  }) => {\r\n    const [cellValue, setCellValue] = useState(value);\r\n    const inputRef = useRef<any>(null);\r\n    const column = columns[col];\r\n    const [isProductModalVisible, setIsProductModalVisible] = useState(false);\r\n    const [isStockModalVisible, setIsStockModalVisible] = useState(false);\r\n\r\n    useEffect(() => {\r\n      setCellValue(value);\r\n      //  Focus input/select when cell enters edit mode\r\n      setTimeout(() => {\r\n        inputRef.current?.focus();\r\n      }, 50);\r\n    }, [value]);\r\n\r\n    const handleChange = (val: any) => {\r\n      setCellValue(val);\r\n      saveCell(row, col, val);\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n      if (column.type === 'product' && e.key === 'Enter') {\r\n        e.stopPropagation();\r\n        setIsProductModalVisible(true);\r\n        return; // Do not validate or move cell yet!\r\n      }\r\n      if (column.type === 'stock' && e.key === 'Enter') {\r\n        e.stopPropagation();\r\n        setIsStockModalVisible(true);\r\n        return;\r\n      }\r\n      if (e.key === 'Tab') {\r\n        e.preventDefault();\r\n        // Only validate on Tab\r\n        if (column.required && (!cellValue || cellValue === '')) {\r\n          message.error(`${column.title} is required`);\r\n          return;\r\n        }\r\n        const nextCol = e.shiftKey ? col - 1 : col + 1;\r\n        const nextRow = row + (nextCol >= columns.length ? 1 : 0);\r\n        const colIndex = (nextCol + columns.length) % columns.length;\r\n        if (nextRow < data.length) {\r\n          setEditingCell({ row: nextRow, col: colIndex });\r\n        } else if (allowAdd) {\r\n          handleAddRow();\r\n          setEditingCell({ row: data.length, col: colIndex });\r\n        }\r\n      } else if (e.key === 'Escape') {\r\n        setEditingCell(null);\r\n      }\r\n    };\r\n\r\n    const handleProductSelect = (product: any) => {\r\n      if (onProductSelect) {\r\n        onProductSelect(product, row);\r\n      }\r\n      setIsProductModalVisible(false);\r\n      setEditingCell(null);\r\n    };\r\n\r\n    const handleStockSelect = (stock: any) => {\r\n      // Set stock_id and batch_no in the row\r\n      const newData = [...data];\r\n      newData[row].stock_id = stock.id || stock._id || '';\r\n      newData[row].batch_no = stock.batch_no || '';\r\n      setData(newData);\r\n      onSave(newData);\r\n      setIsStockModalVisible(false);\r\n      setEditingCell(null);\r\n    };\r\n\r\n    switch (column.type) {\r\n      case 'product':\r\n        return (\r\n          <>\r\n            <div onClick={e => e.stopPropagation()}>\r\n              <Input\r\n                ref={inputRef}\r\n                value={cellValue}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder=\"Press Enter to select product\"\r\n              />\r\n            </div>\r\n            {isProductModalVisible && (\r\n              <ProductSelectionModal\r\n                visible={isProductModalVisible}\r\n                onSelect={handleProductSelect}\r\n                onCancel={() => setIsProductModalVisible(false)}\r\n              />\r\n            )}\r\n          </>\r\n        );\r\n      case 'stock':\r\n        return (\r\n          <>\r\n            <div onClick={e => e.stopPropagation()}>\r\n              <Input\r\n                ref={inputRef}\r\n                value={data[row]?.batch_no || cellValue}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder=\"Press Enter to select stock\"\r\n                readOnly\r\n              />\r\n            </div>\r\n            {isStockModalVisible && (\r\n              <StockSelectionModal\r\n                visible={isStockModalVisible}\r\n                onSelect={handleStockSelect}\r\n                onCancel={() => setIsStockModalVisible(false)}\r\n                productId={data[row]?.product_id || ''}\r\n              />\r\n            )}\r\n          </>\r\n        );\r\n      case 'number':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <InputNumber\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              onChange={handleChange}\r\n              onBlur={() => setEditingCell(null)}\r\n              controls={false}\r\n              onKeyDown={e => {\r\n                // Allow Enter/Tab to move to next editable cell\r\n                if (e.key === 'Tab' || e.key === 'Enter') {\r\n                  e.preventDefault();\r\n                  // Only validate on Tab or Enter\r\n                  if (column.required && (!cellValue || cellValue === '')) {\r\n                    message.error(`${column.title} is required`);\r\n                    return;\r\n                  }\r\n                  const direction = e.shiftKey ? -1 : 1;\r\n                  const nextCol = getNextEditableCol(col, direction, columns);\r\n                  if (nextCol !== -1) {\r\n                    setEditingCell({ row, col: nextCol });\r\n                  } else {\r\n                    // Move to next/previous row's first editable cell\r\n                    const nextRow = direction > 0 ? row + 1 : row - 1;\r\n                    if (nextRow >= 0 && nextRow < data.length) {\r\n                      const firstEditableCol = getNextEditableCol(-1, 1, columns);\r\n                      if (firstEditableCol !== -1) {\r\n                        setEditingCell({ row: nextRow, col: firstEditableCol });\r\n                      }\r\n                    } else if (direction > 0 && allowAdd) {\r\n                      // Add new row if moving forward and at the end\r\n                      handleAddRow();\r\n                      const firstEditableCol = getNextEditableCol(-1, 1, columns);\r\n                      if (firstEditableCol !== -1) {\r\n                        setEditingCell({ row: data.length, col: firstEditableCol });\r\n                      }\r\n                    } else {\r\n                      // Exit edit mode if no more rows\r\n                      setEditingCell(null);\r\n                    }\r\n                  }\r\n                } else if (e.key === 'Escape') {\r\n                  setEditingCell(null);\r\n                }\r\n              }}\r\n              style={{ width: '100%' }}\r\n            />\r\n          </div>\r\n        );\r\n      case 'select':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <Select\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              options={column.options}\r\n              onChange={val => {\r\n                const success = saveCell(row, col, val);\r\n                if (success) {\r\n                  // Move to next editable cell\r\n                  const nextCol = col + 1;\r\n                  const nextRow = row + (nextCol >= columns.length ? 1 : 0);\r\n                  const colIndex = (nextCol + columns.length) % columns.length;\r\n\r\n                  if (nextRow < data.length) {\r\n                    setEditingCell({ row: nextRow, col: colIndex });\r\n                  } else if (allowAdd) {\r\n                    handleAddRow();\r\n                    setEditingCell({ row: data.length, col: colIndex });\r\n                  }\r\n                }else {\r\n                  // Validation failed; keep focus\r\n                  setTimeout(() => {\r\n                    inputRef.current?.focus();\r\n                  }, 50);\r\n                }\r\n              }}\r\n              style={{ width: '100%' }}\r\n              onKeyDown={e => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  e.preventDefault(); // Block default key behavior\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n        );\r\n\r\n      case 'date':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <DatePicker\r\n              ref={inputRef}\r\n              value={cellValue ? dayjs(cellValue) : null}\r\n              onChange={date => {\r\n                handleChange(date ? date.format('YYYY-MM-DD') : null);\r\n                setEditingCell(null);\r\n              }}\r\n              onBlur={() => setEditingCell(null)}\r\n              onKeyDown={handleKeyDown}\r\n              style={{ width: '100%' }}\r\n            />\r\n          </div>\r\n        );\r\n      default:\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <Input\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              onChange={e => handleChange(e.target.value)}\r\n              onBlur={() => setEditingCell(null)}\r\n              onKeyDown={handleKeyDown}\r\n            />\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  const mergedColumns = columns.map((col, colIndex) => ({\r\n    ...col,\r\n    onCell: (_record: any, rowIndex?: number) => ({\r\n      onClick: () => {\r\n        if (typeof rowIndex === 'number') {\r\n          setEditingCell({ row: rowIndex, col: colIndex });\r\n        }\r\n      },\r\n      onContextMenu: (e: React.MouseEvent) => {\r\n        e.preventDefault(); //  Prevent default context menu\r\n        if (typeof rowIndex === 'number') {\r\n          setEditingCell({ row: rowIndex, col: colIndex });\r\n        }\r\n      },\r\n    }),\r\n    render: (val: any, record: any, rowIndex: number) => {\r\n      if (\r\n        editingCell &&\r\n        editingCell.row === rowIndex &&\r\n        editingCell.col === colIndex\r\n      ) {\r\n        return (\r\n          <EditableCell\r\n            key={`${rowIndex}-${colIndex}`}\r\n            row={rowIndex}\r\n            col={colIndex}\r\n            value={record[col.dataIndex]}\r\n          />\r\n        );\r\n      }\r\n      // Use custom render if provided and not editing\r\n      if (typeof col.render === 'function') {\r\n        return col.render(val, record, rowIndex);\r\n      }\r\n      // Show batch_no for stock_id column when not editing\r\n      if (col.dataIndex === 'batch_no') {\r\n        return record.batch_no || record[col.dataIndex];\r\n      }\r\n      // Show product_name for product_id column when not editing\r\n      if (col.dataIndex === 'product_id') {\r\n        return record.product_name || record[col.dataIndex];\r\n      }\r\n      if (col.type === 'select' && col.options) {\r\n        const option = col.options.find(\r\n          opt => opt.value === record[col.dataIndex]\r\n        );\r\n        return option ? option.label : record[col.dataIndex];\r\n      }\r\n      return record[col.dataIndex];\r\n    },\r\n  }));\r\n\r\n  return (\r\n    <div\r\n      className={`antd-editable-table ${compact ? 'compact' : ''} ${\r\n        className || ''\r\n      }`}\r\n    >\r\n      <div className=\"table-toolbar\">\r\n        <Space>\r\n          {allowAdd && (\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<PlusOutlined />}\r\n              onClick={handleAddRow}\r\n            >\r\n              Add Row (Shift+A)\r\n            </Button>\r\n          )}\r\n          {allowDelete && (\r\n            <Button danger icon={<DeleteOutlined />} onClick={handleDeleteRow}>\r\n              Delete Row\r\n            </Button>\r\n          )}\r\n          <Button\r\n            type=\"primary\"\r\n            icon={<SaveOutlined />}\r\n            onClick={() => onSave(data)}\r\n          >\r\n            Save (Ctrl+S)\r\n          </Button>\r\n        </Space>\r\n        <Text type=\"secondary\" className=\"table-info\">\r\n          Use Tab / Shift+Tab to navigate cells\r\n        </Text>\r\n      </div>\r\n      <Table\r\n        bordered\r\n        dataSource={data}\r\n        columns={mergedColumns}\r\n        rowKey={rowKey}\r\n        loading={loading}\r\n        pagination={false}\r\n        size={size}\r\n        scroll={{ y: 400 }}\r\n        rowSelection={{...rowSelection,type:\"checkbox\",selectedRowKeys:selectedRows}}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AntdEditableTable;\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Button,\r\n  Typography,\r\n  message,\r\n  Form,\r\n  Select,\r\n  Space,\r\n  Divider,\r\n  Tag,\r\n  Table,\r\n  Row,\r\n  Col,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  UserAddOutlined,\r\n  UserOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n  HomeOutlined,\r\n  PlusOutlined,\r\n  SaveOutlined,\r\n  CloseOutlined,\r\n} from '@ant-design/icons';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\nimport { useHandleApiResponse } from '../../../components/common/useHandleApiResponse';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Option } = Select;\r\n\r\ninterface Customer {\r\n  _id: string;\r\n  full_name: string;\r\n  email: string;\r\n  mobile: string;\r\n  address: string;\r\n  customer_type: 'regular' | 'vip' | 'wholesale';\r\n}\r\n\r\ninterface NewCustomerData {\r\n  full_name: string;\r\n  email: string;\r\n  mobile: string;\r\n  address: string;\r\n  customer_type: 'regular' | 'vip' | 'wholesale';\r\n}\r\n\r\ninterface CustomerSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (customer: Customer) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst CustomerSelectionModal: React.FC<CustomerSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const CustomerApi = getEntityApi('Customer');\r\n\r\n  const { items: customerList, loading: customerLoading } = useDynamicSelector(\r\n    CustomerApi.getIdentifier('GetAll')\r\n  );\r\n  const { loading: createLoading } = useDynamicSelector(\r\n    CustomerApi.getIdentifier('Create')\r\n  );\r\n\r\n  // Extract items from customerList if it exists\r\n  const customers = customerList?.items || customerList?.result || [];\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [showAddForm, setShowAddForm] = useState(false);\r\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(\r\n    null\r\n  );\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n  const [showCreateGrid, setShowCreateGrid] = useState(false);\r\n  const [newCustomerData, setNewCustomerData] = useState<NewCustomerData>({\r\n    full_name: '',\r\n    email: '',\r\n    mobile: '',\r\n    address: '',\r\n    customer_type: 'regular',\r\n  });\r\n\r\n  const [form] = Form.useForm();\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const createGridRef = useRef<HTMLDivElement>(null);\r\n  const firstFormInputRef = useRef<any>(null);\r\n\r\n  // Memoized filtered customers\r\n  const filteredCustomers = useMemo(() => customers, [customers]);\r\n\r\n  // Check if search has no results and should show create grid\r\n  const shouldShowCreateGrid = useMemo(() => {\r\n    return (\r\n      searchTerm.trim() && !customerLoading && filteredCustomers.length === 0\r\n    );\r\n  }, [searchTerm, customerLoading, filteredCustomers.length]);\r\n\r\n  // Memoized customer type color function\r\n  const getCustomerTypeColor = useCallback((type: string) => {\r\n    const colorMap: Record<string, string> = {\r\n      vip: 'gold',\r\n      wholesale: 'blue',\r\n      regular: 'green',\r\n    };\r\n    return colorMap[type] || 'green';\r\n  }, []);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToCustomer = useCallback(\r\n    (direction: 'up' | 'down' | 'home' | 'end') => {\r\n      if (filteredCustomers.length === 0) return;\r\n\r\n      let newIndex: number;\r\n      switch (direction) {\r\n        case 'up':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? filteredCustomers.length - 1\r\n              : Math.max(selectedRowIndex - 1, 0);\r\n          break;\r\n        case 'down':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? 0\r\n              : Math.min(selectedRowIndex + 1, filteredCustomers.length - 1);\r\n          break;\r\n        case 'home':\r\n          newIndex = 0;\r\n          break;\r\n        case 'end':\r\n          newIndex = filteredCustomers.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedCustomer(filteredCustomers[newIndex]);\r\n\r\n      // Scroll to the selected row\r\n      setTimeout(() => {\r\n        const rowElement = document.querySelector(\r\n          `[data-row-key=\"${filteredCustomers[newIndex]._id}\"]`\r\n        ) as HTMLElement;\r\n        if (rowElement) {\r\n          const scrollBehavior =\r\n            direction === 'home'\r\n              ? 'start'\r\n              : direction === 'end'\r\n                ? 'end'\r\n                : 'nearest';\r\n          rowElement.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: scrollBehavior,\r\n          });\r\n        }\r\n      }, 100);\r\n    },\r\n    [filteredCustomers, selectedRowIndex]\r\n  );\r\n\r\n  // Debounced search function\r\n  const handleSearch = useCallback(\r\n    (value: string) => {\r\n      setSearchTerm(value);\r\n\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n\r\n      searchTimeoutRef.current = setTimeout(() => {\r\n        if (value.trim()) {\r\n          CustomerApi('GetAll', { searchString: value.trim() });\r\n        } else {\r\n          CustomerApi('GetAll');\r\n        }\r\n      }, 500);\r\n    },\r\n    [CustomerApi]\r\n  );\r\n\r\n  // Handle customer selection\r\n  const handleCustomerSelect = useCallback(\r\n    (customer: Customer) => {\r\n      setSelectedCustomer(customer);\r\n      onSelect(customer);\r\n      setTimeout(() => onCancel(), 100);\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Handle new customer creation from unified form\r\n  const handleCreateCustomerFromForm = useCallback(async () => {\r\n    try {\r\n      // Validate required fields - only Full Name and Mobile are mandatory\r\n      if (!newCustomerData.full_name.trim()) {\r\n        message.error('Full name is required');\r\n        return;\r\n      }\r\n      if (!newCustomerData.mobile.trim()) {\r\n        message.error('Mobile number is required');\r\n        return;\r\n      }\r\n\r\n      // Call the API - the response will be handled by the useEffect watching createResult\r\n      await CustomerApi('Create', newCustomerData);\r\n\r\n      // Note: The modal will be automatically closed by the useEffect when the API response comes back\r\n    } catch (error) {\r\n      message.error('Failed to create customer');\r\n      // Clear form data on error\r\n      clearFormData();\r\n    }\r\n  }, [newCustomerData, CustomerApi]);\r\n\r\n  // Function to clear form data\r\n  const clearFormData = useCallback(() => {\r\n    setNewCustomerData({\r\n      full_name: '',\r\n      email: '',\r\n      mobile: '',\r\n      address: '',\r\n      customer_type: 'regular',\r\n    });\r\n    form.resetFields();\r\n  }, [form]);\r\n\r\n  // Handle form field changes\r\n  const handleFormFieldChange = useCallback(\r\n    (field: keyof NewCustomerData, value: string) => {\r\n      setNewCustomerData(prev => ({\r\n        ...prev,\r\n        [field]: value,\r\n      }));\r\n    },\r\n    []\r\n  );\r\n\r\n  // Remove the navigateToNextField function as it's no longer needed\r\n\r\n  // Handle keyboard events (excluding Enter key which is handled by input field)\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onCancel();\r\n      } else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToCustomer(directionMap[e.key]);\r\n      }\r\n    },\r\n    [navigateToCustomer, onCancel]\r\n  );\r\n\r\n  // Global keyboard event handler\r\n  const handleGlobalKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (!visible) return;\r\n\r\n      // Don't interfere if user is typing in form inputs\r\n      const target = e.target as HTMLElement;\r\n      if (\r\n        target.tagName === 'INPUT' ||\r\n        target.tagName === 'TEXTAREA' ||\r\n        target.classList.contains('ant-select-selector') ||\r\n        target.closest('.ant-select-dropdown')\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === 'f') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Handle Ctrl+N for new customer creation\r\n      if (e.ctrlKey && e.key === 'n') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (shouldShowCreateGrid) {\r\n          setShowCreateGrid(true);\r\n          setTimeout(() => {\r\n            if (createGridRef.current) {\r\n              const firstInput = createGridRef.current.querySelector(\r\n                'input'\r\n              ) as HTMLInputElement;\r\n              if (firstInput) {\r\n                firstInput.focus();\r\n                firstInput.select();\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Only handle navigation keys globally when not in form inputs\r\n      if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToCustomer(directionMap[e.key]);\r\n      }\r\n    },\r\n    [visible, navigateToCustomer, shouldShowCreateGrid]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: Customer) => (\r\n          <div\r\n            style={{\r\n              cursor: 'pointer',\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n            }}\r\n            onClick={() => {\r\n              setSelectedCustomer(record);\r\n              const index = filteredCustomers.findIndex(\r\n                (c: Customer) => c._id === record._id\r\n              );\r\n              setSelectedRowIndex(index);\r\n              // Don't auto-select here, let user click the row or press Enter\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                borderRadius: '50%',\r\n                border:\r\n                  selectedCustomer?._id === record._id\r\n                    ? '2px solid #1890ff'\r\n                    : '2px solid #d9d9d9',\r\n                backgroundColor:\r\n                  selectedCustomer?._id === record._id ? '#1890ff' : 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedCustomer?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Customer Name',\r\n        dataIndex: 'full_name',\r\n        key: 'full_name',\r\n        render: (text: string, record: Customer) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <Text strong>{text}</Text>\r\n            <Tag color={getCustomerTypeColor(record.customer_type)}>\r\n              {record.customer_type.toUpperCase()}\r\n            </Tag>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Mobile',\r\n        dataIndex: 'mobile',\r\n        key: 'mobile',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Address',\r\n        dataIndex: 'address',\r\n        key: 'address',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'flex-start', gap: 8 }}>\r\n            <HomeOutlined style={{ color: '#666', marginTop: '2px' }} />\r\n            <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n              {text || '-'}\r\n            </Text>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedCustomer, filteredCustomers, getCustomerTypeColor]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: Customer, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedCustomer(record);\r\n        setSelectedRowIndex(index ?? 0);\r\n        // Don't auto-select on row click, let user press Enter to confirm\r\n      },\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedCustomer?._id === record._id ? '#f0f8ff' : 'white',\r\n        border:\r\n          selectedCustomer?._id === record._id\r\n            ? '2px solid #1890ff'\r\n            : '1px solid #f0f0f0',\r\n        borderRadius: '4px',\r\n        transition: 'all 0.2s ease',\r\n      },\r\n      onMouseEnter: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedCustomer?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = '#f5f5f5';\r\n        }\r\n      },\r\n      onMouseLeave: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedCustomer?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = 'white';\r\n        }\r\n      },\r\n    }),\r\n    [selectedCustomer]\r\n  );\r\n\r\n  // Load customers on mount and handle modal close\r\n  useEffect(() => {\r\n    if (visible) {\r\n      CustomerApi('GetAll');\r\n      setSelectedCustomer(null);\r\n      setSelectedRowIndex(-1);\r\n      setShowCreateGrid(false);\r\n    } else {\r\n      setSearchTerm('');\r\n      setSelectedCustomer(null);\r\n      setSelectedRowIndex(-1);\r\n      setShowCreateGrid(false);\r\n      setShowAddForm(false);\r\n      clearFormData();\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = null;\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [visible, CustomerApi, clearFormData]);\r\n\r\n  // Auto-show create form when search has no results\r\n  useEffect(() => {\r\n    if (shouldShowCreateGrid && !showCreateGrid && !showAddForm) {\r\n      setShowCreateGrid(true);\r\n    }\r\n  }, [shouldShowCreateGrid, showCreateGrid, showAddForm]);\r\n\r\n  // Focus search input when modal becomes visible (but not when create form is shown)\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current && !showAddForm && !showCreateGrid) {\r\n      const focusSearch = () => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n      };\r\n\r\n      focusSearch();\r\n      const timer = setTimeout(focusSearch, 100);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [visible, showAddForm, showCreateGrid]);\r\n\r\n  // Focus on first form field when create form is shown\r\n  useEffect(() => {\r\n    if ((showAddForm || showCreateGrid) && visible) {\r\n      const timer = setTimeout(() => {\r\n        if (firstFormInputRef.current) {\r\n          firstFormInputRef.current.focus();\r\n          firstFormInputRef.current.select();\r\n        }\r\n      }, 100);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [showAddForm, showCreateGrid, visible]); // Depend on all three to trigger when form is shown\r\n\r\n  // Remove the useLayoutEffect that was causing focus to reset\r\n\r\n  // Global keyboard event listener\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('keydown', handleGlobalKeyDown, true);\r\n      return () =>\r\n        document.removeEventListener('keydown', handleGlobalKeyDown, true);\r\n    }\r\n  }, [visible, handleGlobalKeyDown]);\r\n\r\n  // Handle API responses using the standard pattern\r\n  useHandleApiResponse({\r\n    action: 'create',\r\n    title: 'Customer',\r\n    identifier: CustomerApi.getIdentifier('Create'),\r\n    entityApi: CustomerApi,\r\n  });\r\n\r\n  // Watch for successful customer creation and select the new customer\r\n  const { items: createResult } = useDynamicSelector(\r\n    CustomerApi.getIdentifier('Create')\r\n  );\r\n\r\n  // Watch createLoading state to show/hide loading message\r\n  useEffect(() => {\r\n    if (createLoading) {\r\n      // Show loading message when API call starts\r\n      message.loading({\r\n        content: 'Creating customer...',\r\n        key: 'customer-creation',\r\n        duration: 0,\r\n      });\r\n    } else {\r\n      // Hide loading message when API call completes\r\n      message.destroy('customer-creation');\r\n    }\r\n  }, [createLoading]);\r\n\r\n  useEffect(() => {\r\n    if (createResult) {\r\n      if (createResult.statusCode === 200) {\r\n        // Customer created successfully, get the new customer data\r\n        const newCustomer = createResult.data || createResult.result;\r\n\r\n        if (newCustomer) {\r\n          // message.success(\r\n          //   `Customer \"${newCustomer.full_name}\" created and selected successfully!`\r\n          // );\r\n\r\n          // Clear form data on success\r\n          clearFormData();\r\n          setShowAddForm(false);\r\n          setShowCreateGrid(false);\r\n\r\n          // Refresh the customer list to include the new customer\r\n          CustomerApi('GetAll');\r\n\r\n          // Auto-select the newly created customer\r\n          setTimeout(() => {\r\n            onSelect(newCustomer);\r\n            onCancel();\r\n          }, 100);\r\n        }\r\n      } else if (createResult.statusCode && createResult.statusCode !== 200) {\r\n        // Handle error case\r\n        message.error(createResult.message || 'Failed to create customer');\r\n        // Clear form data on error\r\n        clearFormData();\r\n      }\r\n    }\r\n  }, [createResult, onSelect, onCancel, CustomerApi, clearFormData]);\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedCustomer(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n  return (\r\n    <Modal\r\n      title=\"Select Customer\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={1000}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current && !showAddForm && !showCreateGrid) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Space.Compact style={{ width: '100%' }}>\r\n          <Input\r\n            ref={searchInputRef}\r\n            placeholder=\"Search customers... (Ctrl+N: New customer, : Navigate, Enter: Select, Esc: Close)\"\r\n            value={searchTerm}\r\n            onChange={e => handleSearch(e.target.value)}\r\n            prefix={<SearchOutlined />}\r\n            style={{ flex: 1 }}\r\n            onKeyDown={e => {\r\n              // Only handle Enter key in search input, let other keys bubble up\r\n              if (e.key === 'Enter' && selectedCustomer) {\r\n                handleCustomerSelect(selectedCustomer);\r\n              }\r\n            }}\r\n            onFocus={handleSearchFocus}\r\n            autoFocus={!showAddForm && !showCreateGrid}\r\n            onBlur={\r\n              !showAddForm && !showCreateGrid\r\n                ? () => {\r\n                    // Only auto-focus back to search if no forms are shown\r\n                    if (visible && searchInputRef.current) {\r\n                      setTimeout(() => {\r\n                        if (\r\n                          visible &&\r\n                          searchInputRef.current &&\r\n                          !showAddForm &&\r\n                          !showCreateGrid\r\n                        ) {\r\n                          searchInputRef.current.focus();\r\n                        }\r\n                      }, 10);\r\n                    }\r\n                  }\r\n                : undefined\r\n            }\r\n            suffix={\r\n              searchTerm && customerLoading ? (\r\n                <div style={{ fontSize: '12px', color: '#999' }}>\r\n                  Searching...\r\n                </div>\r\n              ) : null\r\n            }\r\n          />\r\n          <Button\r\n            type={showAddForm ? 'default' : 'primary'}\r\n            icon={<UserAddOutlined />}\r\n            onClick={() => {\r\n              const newState = !showAddForm;\r\n              setShowAddForm(newState);\r\n              if (!newState) {\r\n                // Clear form data when switching back to search mode\r\n                clearFormData();\r\n              }\r\n              // Focus will be handled by the useEffect when visible changes\r\n            }}\r\n            style={{ minWidth: 120 }}\r\n          >\r\n            {showAddForm ? 'Cancel' : 'Add New'}\r\n          </Button>\r\n        </Space.Compact>\r\n      </div>\r\n\r\n      {/* Unified Create Form - Shows when search has no results or when Add New is clicked */}\r\n      {(showCreateGrid || showAddForm) && (\r\n        <div\r\n          ref={createGridRef}\r\n          style={{\r\n            marginBottom: 20,\r\n            padding: 24,\r\n            border: '2px solid #6366f1',\r\n            borderRadius: 16,\r\n            backgroundColor:\r\n              'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\r\n            background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\r\n            boxShadow:\r\n              '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',\r\n            position: 'relative',\r\n            overflow: 'hidden',\r\n          }}\r\n          tabIndex={-1}\r\n        >\r\n          {/* Decorative background elements */}\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              top: -20,\r\n              right: -20,\r\n              width: 100,\r\n              height: 100,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n              opacity: 0.1,\r\n              zIndex: 0,\r\n            }}\r\n          />\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              bottom: -30,\r\n              left: -30,\r\n              width: 80,\r\n              height: 80,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)',\r\n              opacity: 0.1,\r\n              zIndex: 0,\r\n            }}\r\n          />\r\n\r\n          <Row\r\n            justify=\"space-between\"\r\n            align=\"middle\"\r\n            style={{ marginBottom: 24, position: 'relative', zIndex: 1 }}\r\n          >\r\n            <Col>\r\n              <Title\r\n                level={4}\r\n                style={{\r\n                  margin: 0,\r\n                  background:\r\n                    'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n                  WebkitBackgroundClip: 'text',\r\n                  WebkitTextFillColor: 'transparent',\r\n                  backgroundClip: 'text',\r\n                  fontWeight: 700,\r\n                  fontSize: '20px',\r\n                }}\r\n              >\r\n                <PlusOutlined style={{ marginRight: 8, color: '#6366f1' }} />\r\n                Create New Customer\r\n              </Title>\r\n              <Text\r\n                style={{\r\n                  fontSize: '14px',\r\n                  color: '#64748b',\r\n                  fontWeight: 500,\r\n                  display: 'block',\r\n                  marginTop: 4,\r\n                }}\r\n              >\r\n                 Fill in the details below to create a new customer\r\n              </Text>\r\n            </Col>\r\n            <Col>\r\n              <Space size=\"middle\">\r\n                <Button\r\n                  size=\"middle\"\r\n                  icon={<CloseOutlined />}\r\n                  onClick={() => {\r\n                    setShowCreateGrid(false);\r\n                    setShowAddForm(false);\r\n                    CustomerApi('GetAll');\r\n                    clearFormData();\r\n                  }}\r\n                  style={{\r\n                    border: '2px solid #e2e8f0',\r\n                    borderRadius: 8,\r\n                    fontWeight: 600,\r\n                    color: '#64748b',\r\n                    background: 'white',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    height: 40,\r\n                    padding: '0 20px',\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </Button>\r\n                <Button\r\n                  type=\"primary\"\r\n                  size=\"middle\"\r\n                  icon={<SaveOutlined />}\r\n                  onClick={handleCreateCustomerFromForm}\r\n                  loading={createLoading}\r\n                  style={{\r\n                    background:\r\n                      'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n                    border: 'none',\r\n                    borderRadius: 8,\r\n                    fontWeight: 600,\r\n                    height: 40,\r\n                    padding: '0 24px',\r\n                    boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)',\r\n                    transition: 'all 0.3s ease',\r\n                  }}\r\n                >\r\n                  Create & Select\r\n                </Button>\r\n              </Space>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form\r\n            form={form}\r\n            layout=\"vertical\"\r\n            size=\"middle\"\r\n            style={{ position: 'relative', zIndex: 1 }}\r\n          >\r\n            <div\r\n              style={{\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 1fr',\r\n                gap: 20,\r\n                marginBottom: 20,\r\n              }}\r\n            >\r\n              <Form.Item\r\n                name=\"full_name\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <UserOutlined style={{ color: '#6366f1' }} />\r\n                    Full Name\r\n                  </span>\r\n                }\r\n                rules={[{ required: true, message: 'Please enter full name' }]}\r\n              >\r\n                <Input\r\n                  ref={firstFormInputRef}\r\n                  name=\"full_name\"\r\n                  placeholder=\"Enter full name\"\r\n                  prefix={<UserOutlined style={{ color: '#9ca3af' }} />}\r\n                  autoFocus={showAddForm || showCreateGrid}\r\n                  value={newCustomerData.full_name}\r\n                  onChange={e =>\r\n                    handleFormFieldChange('full_name', e.target.value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"mobile\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <PhoneOutlined style={{ color: '#10b981' }} />\r\n                    Mobile Number\r\n                  </span>\r\n                }\r\n                rules={[\r\n                  { required: true, message: 'Please enter mobile number' },\r\n                  {\r\n                    pattern: /^[0-9]{10}$/,\r\n                    message: 'Mobile must be 10 digits',\r\n                  },\r\n                ]}\r\n              >\r\n                <Input\r\n                  name=\"mobile\"\r\n                  placeholder=\"Enter mobile number\"\r\n                  prefix={<PhoneOutlined style={{ color: '#9ca3af' }} />}\r\n                  value={newCustomerData.mobile}\r\n                  onChange={e =>\r\n                    handleFormFieldChange('mobile', e.target.value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"email\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <MailOutlined style={{ color: '#f59e0b' }} />\r\n                    Email\r\n                  </span>\r\n                }\r\n                rules={[{ type: 'email', message: 'Please enter valid email' }]}\r\n              >\r\n                <Input\r\n                  name=\"email\"\r\n                  placeholder=\"Enter email\"\r\n                  prefix={<MailOutlined style={{ color: '#9ca3af' }} />}\r\n                  value={newCustomerData.email}\r\n                  onChange={e => handleFormFieldChange('email', e.target.value)}\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              {/* <Form.Item\r\n                name=\"customer_type\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <Tag\r\n                      style={{\r\n                        background:\r\n                          'linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)',\r\n                        color: 'white',\r\n                        border: 'none',\r\n                        borderRadius: 6,\r\n                        padding: '2px 8px',\r\n                        fontSize: '10px',\r\n                        fontWeight: 600,\r\n                      }}\r\n                    >\r\n                      TYPE\r\n                    </Tag>\r\n                    Customer Type\r\n                  </span>\r\n                }\r\n                initialValue=\"regular\"\r\n              >\r\n                <Select\r\n                  value={newCustomerData.customer_type}\r\n                  onChange={value =>\r\n                    handleFormFieldChange('customer_type', value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                >\r\n                  <Option value=\"regular\">Regular</Option>\r\n                  <Option value=\"vip\">VIP</Option>\r\n                  <Option value=\"wholesale\">Wholesale</Option>\r\n                </Select>\r\n              </Form.Item> */}\r\n            </div>\r\n\r\n            <Form.Item\r\n              name=\"address\"\r\n              label={\r\n                <span\r\n                  style={{\r\n                    fontWeight: 600,\r\n                    color: '#374151',\r\n                    fontSize: '14px',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: 6,\r\n                  }}\r\n                >\r\n                  <HomeOutlined style={{ color: '#ef4444' }} />\r\n                  Address\r\n                </span>\r\n              }\r\n            >\r\n              <Input.TextArea\r\n                name=\"address\"\r\n                placeholder=\"Enter address\"\r\n                rows={3}\r\n                value={newCustomerData.address}\r\n                onChange={e => handleFormFieldChange('address', e.target.value)}\r\n                onKeyDown={e => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    // If it's the last field, create the customer\r\n                    handleCreateCustomerFromForm();\r\n                  }\r\n                }}\r\n                style={{\r\n                  borderRadius: 10,\r\n                  border: '2px solid #e5e7eb',\r\n                  padding: '12px 16px',\r\n                  fontSize: '14px',\r\n                  transition: 'all 0.3s ease',\r\n                  boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                  background: 'white',\r\n                  resize: 'none',\r\n                }}\r\n              />\r\n            </Form.Item>\r\n          </Form>\r\n        </div>\r\n      )}\r\n\r\n      <Divider style={{ margin: '16px 0' }} />\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {customerLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading customers...</Text>\r\n          </div>\r\n        ) : filteredCustomers.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No customers found matching your search.'\r\n                : 'No customers available.'}\r\n            </Text>\r\n            {searchTerm && (\r\n              <div style={{ marginTop: 16 }}>\r\n                <Text type=\"secondary\">\r\n                  Press Ctrl+N to create a new customer instantly\r\n                </Text>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredCustomers}\r\n            rowKey=\"_id\"\r\n            pagination={false}\r\n            size=\"small\"\r\n            scroll={{ y: 300 }}\r\n            onRow={getRowProps}\r\n          />\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default CustomerSelectionModal;\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Typography,\r\n  Table,\r\n  Tag,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  UserOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n} from '@ant-design/icons';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface User {\r\n  _id: string;\r\n  name: string;\r\n  email: string;\r\n  mobile: string;\r\n  user_name: string;\r\n  roleItems?: {\r\n    name: string;\r\n  };\r\n  branchItems?: {\r\n    branch_name: string;\r\n  };\r\n  organisationItems?: {\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface UserSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (user: User) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst UserSelectionModal: React.FC<UserSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const BillingUsersApi = getEntityApi('BillingUsers');\r\n\r\n  const { items: userList, loading: userLoading } = useDynamicSelector(\r\n    BillingUsersApi.getIdentifier('GetAll')\r\n  );\r\n\r\n  // Extract items from userList if it exists\r\n  const users = userList?.items || userList?.result || [];\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n  \r\n  // Get current user from session storage\r\n  const currentUser = useMemo(() => {\r\n    try {\r\n      return JSON.parse(sessionStorage.getItem('user') || '{}');\r\n    } catch {\r\n      return {};\r\n    }\r\n  }, []);\r\n\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Memoized filtered users\r\n  const filteredUsers = useMemo(() => {\r\n    if (!searchTerm.trim()) {\r\n      return users;\r\n    }\r\n    \r\n    const searchLower = searchTerm.toLowerCase();\r\n    return users.filter((user: User) =>\r\n      user.name?.toLowerCase().includes(searchLower) ||\r\n      user.email?.toLowerCase().includes(searchLower) ||\r\n      user.mobile?.toLowerCase().includes(searchLower) ||\r\n      user.user_name?.toLowerCase().includes(searchLower) ||\r\n      user.roleItems?.name?.toLowerCase().includes(searchLower)\r\n    );\r\n  }, [users, searchTerm]);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToUser = useCallback(\r\n    (direction: 'up' | 'down' | 'home' | 'end') => {\r\n      if (filteredUsers.length === 0) return;\r\n\r\n      let newIndex: number;\r\n      switch (direction) {\r\n        case 'up':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? filteredUsers.length - 1\r\n              : Math.max(selectedRowIndex - 1, 0);\r\n          break;\r\n        case 'down':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? 0\r\n              : Math.min(selectedRowIndex + 1, filteredUsers.length - 1);\r\n          break;\r\n        case 'home':\r\n          newIndex = 0;\r\n          break;\r\n        case 'end':\r\n          newIndex = filteredUsers.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedUser(filteredUsers[newIndex]);\r\n\r\n      // Scroll to the selected row\r\n      setTimeout(() => {\r\n        const rowElement = document.querySelector(\r\n          `[data-row-key=\"${filteredUsers[newIndex]._id}\"]`\r\n        ) as HTMLElement;\r\n        if (rowElement) {\r\n          const scrollBehavior =\r\n            direction === 'home'\r\n              ? 'start'\r\n              : direction === 'end'\r\n                ? 'end'\r\n                : 'nearest';\r\n          rowElement.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: scrollBehavior,\r\n          });\r\n        }\r\n      }, 100);\r\n    },\r\n    [filteredUsers, selectedRowIndex]\r\n  );\r\n\r\n  // Debounced search function\r\n  const handleSearch = useCallback(\r\n    (value: string) => {\r\n      setSearchTerm(value);\r\n\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n\r\n      searchTimeoutRef.current = setTimeout(() => {\r\n        if (value.trim()) {\r\n          BillingUsersApi('GetAll', { searchString: value.trim() });\r\n        } else {\r\n          BillingUsersApi('GetAll');\r\n        }\r\n      }, 300);\r\n    },\r\n    [BillingUsersApi]\r\n  );\r\n\r\n  // Handle user selection\r\n  const handleUserSelect = useCallback(\r\n    (user: User) => {\r\n      setSelectedUser(user);\r\n      onSelect(user);\r\n      setTimeout(() => onCancel(), 100);\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Handle keyboard events\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onCancel();\r\n      } else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToUser(directionMap[e.key]);\r\n      }\r\n    },\r\n    [navigateToUser, onCancel]\r\n  );\r\n\r\n  // Global keyboard event handler\r\n  const handleGlobalKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (!visible) return;\r\n\r\n      // Don't interfere if user is typing in form inputs\r\n      const target = e.target as HTMLElement;\r\n      if (\r\n        target.tagName === 'INPUT' ||\r\n        target.tagName === 'TEXTAREA' ||\r\n        target.classList.contains('ant-select-selector') ||\r\n        target.closest('.ant-select-dropdown')\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === 'f') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Only handle navigation keys globally when not in form inputs\r\n      if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToUser(directionMap[e.key]);\r\n      }\r\n    },\r\n    [visible, navigateToUser]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: User) => (\r\n          <div\r\n            style={{\r\n              cursor: 'pointer',\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n            }}\r\n            onClick={() => {\r\n              setSelectedUser(record);\r\n              const index = filteredUsers.findIndex(\r\n                (u: User) => u._id === record._id\r\n              );\r\n              setSelectedRowIndex(index);\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                borderRadius: '50%',\r\n                border:\r\n                  selectedUser?._id === record._id\r\n                    ? '2px solid #1890ff'\r\n                    : '2px solid #d9d9d9',\r\n                backgroundColor:\r\n                  selectedUser?._id === record._id ? '#1890ff' : 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedUser?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Name',\r\n        dataIndex: 'name',\r\n        key: 'name',\r\n        render: (text: string, record: User) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <UserOutlined style={{ color: '#1890ff' }} />\r\n            <div>\r\n              <Text strong>{text}</Text>\r\n              <br />\r\n              <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n                @{record.user_name}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Role',\r\n        key: 'role',\r\n        render: (text: string, record: User) => (\r\n          <Tag color=\"blue\">\r\n            {record.roleItems?.name || 'No Role'}\r\n          </Tag>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Mobile',\r\n        dataIndex: 'mobile',\r\n        key: 'mobile',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Branch',\r\n        key: 'branch',\r\n        render: (text: string, record: User) => (\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            {record.branchItems?.branch_name || '-'}\r\n          </Text>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedUser, filteredUsers]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: User, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedUser(record);\r\n        setSelectedRowIndex(index ?? 0);\r\n      },\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedUser?._id === record._id ? '#f0f8ff' : 'white',\r\n        border:\r\n          selectedUser?._id === record._id\r\n            ? '2px solid #1890ff'\r\n            : '1px solid #f0f0f0',\r\n        borderRadius: '4px',\r\n        transition: 'all 0.2s ease',\r\n      },\r\n      onMouseEnter: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedUser?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = '#f5f5f5';\r\n        }\r\n      },\r\n      onMouseLeave: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedUser?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = 'white';\r\n        }\r\n      },\r\n    }),\r\n    [selectedUser]\r\n  );\r\n\r\n  // Load users on mount and handle modal close\r\n  useEffect(() => {\r\n    if (visible) {\r\n      BillingUsersApi('GetAll');\r\n      setSelectedUser(null);\r\n      setSelectedRowIndex(-1);\r\n    } else {\r\n      setSearchTerm('');\r\n      setSelectedUser(null);\r\n      setSelectedRowIndex(-1);\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = null;\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [visible, BillingUsersApi]);\r\n\r\n  // Auto-select current user when users are loaded\r\n  useEffect(() => {\r\n    if (visible && users.length > 0 && currentUser._id && !selectedUser) {\r\n      const currentUserInList = users.find((user: User) => user._id === currentUser._id);\r\n      if (currentUserInList) {\r\n        setSelectedUser(currentUserInList);\r\n        const index = users.findIndex((user: User) => user._id === currentUser._id);\r\n        setSelectedRowIndex(index);\r\n        \r\n        // Scroll to the selected user after a short delay\r\n        setTimeout(() => {\r\n          const rowElement = document.querySelector(\r\n            `[data-row-key=\"${currentUserInList._id}\"]`\r\n          ) as HTMLElement;\r\n          if (rowElement) {\r\n            rowElement.scrollIntoView({\r\n              behavior: 'smooth',\r\n              block: 'center',\r\n            });\r\n          }\r\n        }, 200);\r\n      }\r\n    }\r\n  }, [visible, users, currentUser._id, selectedUser]);\r\n\r\n  // Focus search input when modal becomes visible\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current) {\r\n      const focusSearch = () => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n      };\r\n\r\n      focusSearch();\r\n      const timer = setTimeout(focusSearch, 100);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [visible]);\r\n\r\n  // Global keyboard event listener\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('keydown', handleGlobalKeyDown, true);\r\n      return () =>\r\n        document.removeEventListener('keydown', handleGlobalKeyDown, true);\r\n    }\r\n  }, [visible, handleGlobalKeyDown]);\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedUser(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select User (Billed By)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={900}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Input\r\n          ref={searchInputRef}\r\n          placeholder=\"Search users... (: Navigate, Enter: Select, Esc: Close)\"\r\n          value={searchTerm}\r\n          onChange={e => handleSearch(e.target.value)}\r\n          prefix={<SearchOutlined />}\r\n          style={{ width: '100%' }}\r\n          onKeyDown={e => {\r\n            // Only handle Enter key in search input, let other keys bubble up\r\n            if (e.key === 'Enter' && selectedUser) {\r\n              handleUserSelect(selectedUser);\r\n            }\r\n          }}\r\n          onFocus={handleSearchFocus}\r\n          autoFocus\r\n          onBlur={() => {\r\n            // Auto-focus back to search if modal is still visible\r\n            if (visible && searchInputRef.current) {\r\n              setTimeout(() => {\r\n                if (visible && searchInputRef.current) {\r\n                  searchInputRef.current.focus();\r\n                }\r\n              }, 10);\r\n            }\r\n          }}\r\n          suffix={\r\n            searchTerm && userLoading ? (\r\n              <div style={{ fontSize: '12px', color: '#999' }}>\r\n                Searching...\r\n              </div>\r\n            ) : null\r\n          }\r\n        />\r\n      </div>\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {userLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading users...</Text>\r\n          </div>\r\n        ) : filteredUsers.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No users found matching your search.'\r\n                : 'No users available.'}\r\n            </Text>\r\n          </div>\r\n        ) : (\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredUsers}\r\n            rowKey=\"_id\"\r\n            pagination={false}\r\n            size=\"small\"\r\n            scroll={{ y: 300 }}\r\n            onRow={getRowProps}\r\n          />\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default UserSelectionModal;\r\n","import React from 'react';\r\nimport { Modal, Button, Typography, Space, Divider } from 'antd';\r\nimport { \r\n  FileTextOutlined, \r\n  PlusOutlined, \r\n  CheckCircleOutlined,\r\n  DollarOutlined,\r\n  UserOutlined,\r\n  CalendarOutlined\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillSaveConfirmationModalProps {\r\n  visible: boolean;\r\n  onNewBill: () => void;\r\n  onContinueBill: () => void;\r\n  onCancel: () => void;\r\n  savedBillData?: any;\r\n}\r\n\r\nconst BillSaveConfirmationModal: React.FC<BillSaveConfirmationModalProps> = ({\r\n  visible,\r\n  onNewBill,\r\n  onContinueBill,\r\n  onCancel,\r\n  savedBillData\r\n}) => {\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ textAlign: 'center' }}>\r\n          <CheckCircleOutlined \r\n            style={{ \r\n              color: '#52c41a', \r\n              fontSize: '24px', \r\n              marginRight: '8px' \r\n            }} \r\n          />\r\n          <span style={{ color: '#52c41a', fontWeight: 600 }}>\r\n            Bill Saved Successfully!\r\n          </span>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={500}\r\n      centered\r\n      maskClosable={false}\r\n      closable={false}\r\n    >\r\n      <div style={{ textAlign: 'center', marginBottom: '24px' }}>\r\n        <Text type=\"secondary\">\r\n          Your bill has been saved successfully. What would you like to do next?\r\n        </Text>\r\n      </div>\r\n\r\n      {savedBillData && (\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)',\r\n            border: '1px solid #0ea5e9',\r\n            borderRadius: '8px',\r\n            padding: '16px',\r\n            marginBottom: '24px',\r\n          }}\r\n        >\r\n          <Title level={5} style={{ marginBottom: '12px', color: '#0369a1' }}>\r\n             Bill Summary\r\n          </Title>\r\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <FileTextOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>Invoice: {savedBillData.invoice_no}</Text>\r\n            </div>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <UserOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>{savedBillData.customer_name || 'N/A'}</Text>\r\n            </div>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <CalendarOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>{dayjs(savedBillData.date).format('DD/MM/YYYY')}</Text>\r\n            </div>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <DollarOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>{(typeof savedBillData.total_amount === 'number' ? savedBillData.total_amount : parseFloat(savedBillData.total_amount) || 0).toFixed(2)}</Text>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <Divider style={{ margin: '20px 0' }} />\r\n\r\n      <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n        <Button\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          icon={<PlusOutlined />}\r\n          onClick={onNewBill}\r\n          style={{\r\n            width: '100%',\r\n            height: '48px',\r\n            background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n            border: 'none',\r\n            fontWeight: 600,\r\n            fontSize: '16px',\r\n            borderRadius: '8px',\r\n          }}\r\n        >\r\n           Create New Bill\r\n        </Button>\r\n        \r\n        <Button\r\n          size=\"large\"\r\n          icon={<FileTextOutlined />}\r\n          onClick={onContinueBill}\r\n          style={{\r\n            width: '100%',\r\n            height: '48px',\r\n            background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\r\n            color: 'white',\r\n            border: 'none',\r\n            fontWeight: 600,\r\n            fontSize: '16px',\r\n            borderRadius: '8px',\r\n          }}\r\n        >\r\n           Continue with Current Bill\r\n        </Button>\r\n      </Space>\r\n\r\n      <div style={{ textAlign: 'center', marginTop: '16px' }}>\r\n        <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n           Tip: Use \"New Bill\" to start fresh or \"Continue Bill\" to add more items\r\n        </Text>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default BillSaveConfirmationModal;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Drawer, \r\n  List, \r\n  Typography, \r\n  Button, \r\n  Input, \r\n  Space, \r\n  Tag, \r\n  Avatar, \r\n  Badge,\r\n  Tooltip,\r\n  Divider,\r\n  Empty,\r\n  Spin\r\n} from 'antd';\r\nimport { \r\n  SearchOutlined, \r\n  FileTextOutlined, \r\n  UserOutlined, \r\n  CalendarOutlined,\r\n  DollarOutlined,\r\n  EyeOutlined,\r\n  PrinterOutlined,\r\n  PlusOutlined,\r\n  CloseOutlined\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Search } = Input;\r\n\r\ninterface BillListDrawerProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onViewBill: (bill: any) => void;\r\n  onNewBill: () => void;\r\n}\r\n\r\nconst BillListDrawer: React.FC<BillListDrawerProps> = ({\r\n  visible,\r\n  onClose,\r\n  onViewBill,\r\n  onNewBill\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const SalesRecord = getEntityApi('SalesRecord');\r\n  \r\n  const { items: billList, loading } = useDynamicSelector(\r\n    SalesRecord.getIdentifier('GetAll')\r\n  );\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filteredBills, setFilteredBills] = useState<any[]>([]);\r\n\r\n  // Load bills when drawer opens\r\n  useEffect(() => {\r\n    if (visible) {\r\n      SalesRecord('GetAll');\r\n    }\r\n  }, [visible]);\r\n\r\n  // Filter bills based on search term\r\n  useEffect(() => {\r\n    if (billList?.result) {\r\n      const filtered = billList.result.filter((bill: any) => {\r\n        if (!searchTerm) return true;\r\n        const searchLower = searchTerm.toLowerCase();\r\n        \r\n        // Safely handle bill properties\r\n        const invoiceNo = bill.invoice_no || '';\r\n        const customerName = bill.customerDetails?.full_name || '';\r\n        const date = bill.date || '';\r\n        const totalAmount = typeof bill.total_amount === 'number' ? bill.total_amount.toString() : String(bill.total_amount || '');\r\n        \r\n        return (\r\n          invoiceNo.toLowerCase().includes(searchLower) ||\r\n          customerName.toLowerCase().includes(searchLower) ||\r\n          date.includes(searchTerm) ||\r\n          totalAmount.includes(searchTerm)\r\n        );\r\n      });\r\n      setFilteredBills(filtered);\r\n    }\r\n  }, [billList, searchTerm]);\r\n\r\n  const getPaymentStatusColor = (isPaid: boolean, isPartiallyPaid: boolean) => {\r\n    if (isPaid && !isPartiallyPaid) return 'success';\r\n    if (isPartiallyPaid) return 'warning';\r\n    return 'error';\r\n  };\r\n\r\n  const getPaymentStatusText = (isPaid: boolean, isPartiallyPaid: boolean) => {\r\n    if (isPaid && !isPartiallyPaid) return 'Paid';\r\n    if (isPartiallyPaid) return 'Partial';\r\n    return 'Unpaid';\r\n  };\r\n\r\n  const handleViewBill = (bill: any) => {\r\n\r\n    onViewBill(bill);\r\n    onClose();\r\n  };\r\n\r\n  const handleNewBill = () => {\r\n    onNewBill();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n          <Title level={4} style={{ margin: 0, color: '#1f2937' }}>\r\n             Bill List\r\n          </Title>\r\n          <Button\r\n            type=\"text\"\r\n            icon={<CloseOutlined />}\r\n            onClick={onClose}\r\n            size=\"small\"\r\n          />\r\n        </div>\r\n      }\r\n      placement=\"left\"\r\n      open={visible}\r\n      onClose={onClose}\r\n      width={400}\r\n      bodyStyle={{ padding: '16px' }}\r\n      headerStyle={{ \r\n        borderBottom: '1px solid #e5e7eb',\r\n        padding: '16px 16px 12px 16px'\r\n      }}\r\n    >\r\n      {/* Search and New Bill Section */}\r\n      <div style={{ marginBottom: '16px' }}>\r\n        <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n          <Search\r\n            placeholder=\"Search bills by invoice, customer, date...\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n            prefix={<SearchOutlined />}\r\n            allowClear\r\n            size=\"large\"\r\n          />\r\n          \r\n          <Button\r\n            type=\"primary\"\r\n            icon={<PlusOutlined />}\r\n            onClick={handleNewBill}\r\n            style={{\r\n              width: '100%',\r\n              height: '40px',\r\n              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n              border: 'none',\r\n              fontWeight: 600,\r\n              borderRadius: '8px',\r\n            }}\r\n          >\r\n             Create New Bill\r\n          </Button>\r\n        </Space>\r\n      </div>\r\n\r\n      <Divider style={{ margin: '16px 0' }} />\r\n\r\n      {/* Bill List */}\r\n      <div style={{ height: 'calc(100vh - 250px)', overflow: 'auto' }}>\r\n        {loading ? (\r\n          <div style={{ textAlign: 'center', padding: '40px' }}>\r\n            <Spin size=\"large\" />\r\n            <div style={{ marginTop: '16px' }}>\r\n              <Text type=\"secondary\">Loading bills...</Text>\r\n            </div>\r\n          </div>\r\n        ) : filteredBills.length === 0 ? (\r\n          <Empty\r\n            description={\r\n              <div>\r\n                <Text type=\"secondary\">\r\n                  {searchTerm ? 'No bills found matching your search.' : 'No bills available.'}\r\n                </Text>\r\n                {!searchTerm && (\r\n                  <div style={{ marginTop: '8px' }}>\r\n                    <Button type=\"link\" onClick={handleNewBill}>\r\n                      Create your first bill\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            }\r\n            style={{ marginTop: '40px' }}\r\n          />\r\n        ) : (\r\n          <List\r\n            dataSource={filteredBills}\r\n            renderItem={(bill) => (\r\n              <List.Item\r\n                style={{\r\n                  padding: '16px',\r\n                  border: '1px solid #e5e7eb',\r\n                  borderRadius: '8px',\r\n                  marginBottom: '12px',\r\n                  background: 'white',\r\n                  cursor: 'pointer',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onMouseEnter={(e) => {\r\n                  e.currentTarget.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';\r\n                  e.currentTarget.style.transform = 'translateY(-2px)';\r\n                }}\r\n                onMouseLeave={(e) => {\r\n                  e.currentTarget.style.boxShadow = 'none';\r\n                  e.currentTarget.style.transform = 'translateY(0)';\r\n                }}\r\n                onClick={() => handleViewBill(bill)}\r\n              >\r\n                <div style={{ width: '100%' }}>\r\n                  {/* Header with Invoice and Status */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center',\r\n                    marginBottom: '8px'\r\n                  }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <Avatar \r\n                        icon={<FileTextOutlined />} \r\n                        style={{ \r\n                          background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\r\n                          color: 'white'\r\n                        }} \r\n                      />\r\n                      <Text strong style={{ fontSize: '14px' }}>\r\n                        {bill.invoice_no}\r\n                      </Text>\r\n                    </div>\r\n                    <Tag color={getPaymentStatusColor(bill.is_paid, bill.is_partially_paid)}>\r\n                      {getPaymentStatusText(bill.is_paid, bill.is_partially_paid)}\r\n                    </Tag>\r\n                  </div>\r\n\r\n                  {/* Customer Info */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    alignItems: 'center', \r\n                    gap: '8px',\r\n                    marginBottom: '6px'\r\n                  }}>\r\n                    <UserOutlined style={{ color: '#6b7280', fontSize: '12px' }} />\r\n                    <Text style={{ fontSize: '12px', color: '#374151' }}>\r\n                      {bill.customerDetails?.full_name || bill.customer_name || 'N/A'}\r\n                    </Text>\r\n                  </div>\r\n\r\n                  {/* Date and Amount */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center'\r\n                  }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <CalendarOutlined style={{ color: '#6b7280', fontSize: '12px' }} />\r\n                      <Text style={{ fontSize: '12px', color: '#6b7280' }}>\r\n                        {bill.date ? dayjs(bill.date).format('DD/MM/YYYY') : 'N/A'}\r\n                      </Text>\r\n                    </div>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <DollarOutlined style={{ color: '#10b981', fontSize: '12px' }} />\r\n                      <Text strong style={{ fontSize: '14px', color: '#10b981' }}>\r\n                        {(typeof bill.total_amount === 'number' ? bill.total_amount : parseFloat(bill.total_amount) || 0).toFixed(2)}\r\n                      </Text>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Action Buttons */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    gap: '8px', \r\n                    marginTop: '12px',\r\n                    justifyContent: 'flex-end'\r\n                  }}>\r\n                    <Tooltip title=\"View Bill\">\r\n                      <Button\r\n                        type=\"text\"\r\n                        icon={<EyeOutlined />}\r\n                        size=\"small\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          handleViewBill(bill);\r\n                        }}\r\n                        style={{ color: '#3b82f6' }}\r\n                      />\r\n                    </Tooltip>\r\n                    <Tooltip title=\"Print Bill\">\r\n                      <Button\r\n                        type=\"text\"\r\n                        icon={<PrinterOutlined />}\r\n                        size=\"small\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          // Handle print functionality\r\n                        }}\r\n                        style={{ color: '#10b981' }}\r\n                      />\r\n                    </Tooltip>\r\n                  </div>\r\n                </div>\r\n              </List.Item>\r\n            )}\r\n            pagination={false}\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      {/* Footer Stats */}\r\n      <div style={{ \r\n        position: 'absolute', \r\n        bottom: 0, \r\n        left: 0, \r\n        right: 0, \r\n        padding: '16px',\r\n        background: 'white',\r\n        borderTop: '1px solid #e5e7eb'\r\n      }}>\r\n        <div style={{ \r\n          display: 'flex', \r\n          justifyContent: 'space-between', \r\n          alignItems: 'center'\r\n        }}>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            Total Bills: {filteredBills.length}\r\n          </Text>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n             Click on any bill to view details\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Drawer>\r\n  );\r\n};\r\n\r\nexport default BillListDrawer;\r\n","import React, { FC, useEffect, useState } from 'react';\r\nimport { Modal, Descriptions, Typography, Tag, Divider } from 'antd';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface ProductDetailsModalProps {\r\n  visible: boolean;\r\n  onCancel: () => void;\r\n  productId: string;\r\n}\r\n\r\ninterface ProductDetails {\r\n  _id: string;\r\n  name: string;\r\n  sku: string;\r\n  description?: string;\r\n  selling_price: number;\r\n  mrp: number;\r\n  VariantItem?: {\r\n    variant_name: string;\r\n    variant_code?: string;\r\n  };\r\n  CategoryItem?: {\r\n    name: string;\r\n    tax_percentage: number;\r\n  };\r\n  brand?: string;\r\n  unit?: string;\r\n  min_stock?: number;\r\n  max_stock?: number;\r\n}\r\n\r\nconst ProductDetailsModal: FC<ProductDetailsModalProps> = ({\r\n  visible,\r\n  onCancel,\r\n  productId,\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const ProductsApi = getEntityApi('Product');\r\n  \r\n  const { items: products, loading } = useDynamicSelector(\r\n    ProductsApi.getIdentifier('GetAll')\r\n  );\r\n\r\n  const [productDetails, setProductDetails] = useState<ProductDetails | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (visible && productId && products?.result) {\r\n      const product = products.result.find((p: any) => p._id === productId);\r\n      if (product) {\r\n        setProductDetails(product);\r\n      }\r\n    }\r\n  }, [visible, productId, products]);\r\n\r\n  useEffect(() => {\r\n    if (visible && productId && !products?.result) {\r\n      // Load products if not already loaded\r\n      ProductsApi('GetAll');\r\n    }\r\n  }, [visible, productId, products, ProductsApi]);\r\n\r\n  const handleCancel = () => {\r\n    setProductDetails(null);\r\n    onCancel();\r\n  };\r\n\r\n  if (!productDetails) {\r\n    return (\r\n      <Modal\r\n        title=\"Product Details\"\r\n        open={visible}\r\n        onCancel={handleCancel}\r\n        footer={null}\r\n        width={600}\r\n        destroyOnClose\r\n      >\r\n        <div style={{ textAlign: 'center', padding: '40px 20px' }}>\r\n          {loading ? (\r\n            <Text>Loading product details...</Text>\r\n          ) : (\r\n            <Text type=\"secondary\">Product not found</Text>\r\n          )}\r\n        </div>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n          <span> Product Details</span>\r\n          <Tag color=\"blue\" style={{ margin: 0 }}>\r\n            {productDetails.sku}\r\n          </Tag>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={handleCancel}\r\n      footer={null}\r\n      width={700}\r\n      destroyOnClose\r\n    >\r\n      <div style={{ padding: '16px 0' }}>\r\n        {/* Product Name and Variant */}\r\n        <div style={{ marginBottom: '24px' }}>\r\n          <Title level={4} style={{ margin: '0 0 8px 0', color: '#1890ff' }}>\r\n            {productDetails.name}\r\n          </Title>\r\n          {productDetails.VariantItem?.variant_name && (\r\n            <Tag color=\"green\" style={{ fontSize: '12px' }}>\r\n              Variant: {productDetails.VariantItem.variant_name}\r\n            </Tag>\r\n          )}\r\n        </div>\r\n\r\n        <Divider style={{ margin: '16px 0' }} />\r\n\r\n        {/* Product Information */}\r\n        <Descriptions\r\n          title=\"Product Information\"\r\n          column={2}\r\n          size=\"small\"\r\n          bordered\r\n          style={{ marginBottom: '24px' }}\r\n        >\r\n          <Descriptions.Item label=\"Product Name\" span={2}>\r\n            <Text strong>{productDetails.name}</Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.VariantItem?.variant_name && (\r\n            <Descriptions.Item label=\"Variant Name\">\r\n              <Text>{productDetails.VariantItem.variant_name}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.VariantItem?.variant_code && (\r\n            <Descriptions.Item label=\"Variant Code\">\r\n              <Text code>{productDetails.VariantItem.variant_code}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          <Descriptions.Item label=\"SKU\">\r\n            <Text code>{productDetails.sku}</Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.brand && (\r\n            <Descriptions.Item label=\"Brand\">\r\n              <Text>{productDetails.brand}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.unit && (\r\n            <Descriptions.Item label=\"Unit\">\r\n              <Text>{productDetails.unit}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.description && (\r\n            <Descriptions.Item label=\"Description\" span={2}>\r\n              <Text>{productDetails.description}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n        </Descriptions>\r\n\r\n        {/* Pricing Information */}\r\n        <Descriptions\r\n          title=\"Pricing & Tax\"\r\n          column={2}\r\n          size=\"small\"\r\n          bordered\r\n          style={{ marginBottom: '24px' }}\r\n        >\r\n          <Descriptions.Item label=\"Selling Price\">\r\n            <Text strong style={{ color: '#52c41a', fontSize: '16px' }}>\r\n              {productDetails.selling_price?.toFixed(2) || '0.00'}\r\n            </Text>\r\n          </Descriptions.Item>\r\n          \r\n          <Descriptions.Item label=\"MRP\">\r\n            <Text style={{ color: '#fa8c16' }}>\r\n              {productDetails.mrp?.toFixed(2) || '0.00'}\r\n            </Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.CategoryItem?.name && (\r\n            <Descriptions.Item label=\"Category\">\r\n              <Text>{productDetails.CategoryItem.name}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.CategoryItem?.tax_percentage !== undefined && (\r\n            <Descriptions.Item label=\"Tax Rate\">\r\n              <Tag color=\"orange\">\r\n                {productDetails.CategoryItem.tax_percentage}%\r\n              </Tag>\r\n            </Descriptions.Item>\r\n          )}\r\n        </Descriptions>\r\n\r\n        {/* Stock Information */}\r\n        {(productDetails.min_stock !== undefined || productDetails.max_stock !== undefined) && (\r\n          <Descriptions\r\n            title=\"Stock Information\"\r\n            column={2}\r\n            size=\"small\"\r\n            bordered\r\n          >\r\n            {productDetails.min_stock !== undefined && (\r\n              <Descriptions.Item label=\"Minimum Stock\">\r\n                <Text>{productDetails.min_stock}</Text>\r\n              </Descriptions.Item>\r\n            )}\r\n            \r\n            {productDetails.max_stock !== undefined && (\r\n              <Descriptions.Item label=\"Maximum Stock\">\r\n                <Text>{productDetails.max_stock}</Text>\r\n              </Descriptions.Item>\r\n            )}\r\n          </Descriptions>\r\n        )}\r\n\r\n        {/* Footer Information */}\r\n        <div style={{ \r\n          marginTop: '24px', \r\n          padding: '16px', \r\n          backgroundColor: '#f6f8fa', \r\n          borderRadius: '8px',\r\n          textAlign: 'center'\r\n        }}>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            Right-click on product field to view details  Press ESC to close\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProductDetailsModal;\r\n","// extracted by mini-css-extract-plugin\nexport default {\"mainContainer\":\"BillDataGrid_mainContainer__Jnuo1\",\"gradientShift\":\"BillDataGrid_gradientShift__hhIW9\",\"backgroundCircle1\":\"BillDataGrid_backgroundCircle1__5PBPG\",\"float\":\"BillDataGrid_float__1VyT0\",\"backgroundCircle2\":\"BillDataGrid_backgroundCircle2__J+xMs\",\"backgroundCircle3\":\"BillDataGrid_backgroundCircle3__AgoEw\",\"backgroundCircle4\":\"BillDataGrid_backgroundCircle4__86Xfd\",\"backgroundCircle5\":\"BillDataGrid_backgroundCircle5__qpbiT\",\"headerContainer\":\"BillDataGrid_headerContainer__wfojf\",\"slideInDown\":\"BillDataGrid_slideInDown__l3LU5\",\"headerCircle1\":\"BillDataGrid_headerCircle1__8+aPI\",\"headerCircle2\":\"BillDataGrid_headerCircle2__Z9w17\",\"headerCircle3\":\"BillDataGrid_headerCircle3__3eMNm\",\"pulse\":\"BillDataGrid_pulse__EVfnw\",\"headerCircle4\":\"BillDataGrid_headerCircle4__fVITr\",\"headerCircle5\":\"BillDataGrid_headerCircle5__0E6vl\",\"headerContent\":\"BillDataGrid_headerContent__6Rnkr\",\"titleSection\":\"BillDataGrid_titleSection__LBuxT\",\"fadeInLeft\":\"BillDataGrid_fadeInLeft__YHJna\",\"titleIcon\":\"BillDataGrid_titleIcon__qffZU\",\"bounce\":\"BillDataGrid_bounce__fYaGs\",\"titleText\":\"BillDataGrid_titleText__XlvSS\",\"slideInRight\":\"BillDataGrid_slideInRight__+-bkg\",\"subtitleText\":\"BillDataGrid_subtitleText__Hgyav\",\"fadeInUp\":\"BillDataGrid_fadeInUp__Y00FE\",\"controlsSection\":\"BillDataGrid_controlsSection__PSC3w\",\"fadeInRight\":\"BillDataGrid_fadeInRight__eA5Bm\",\"controlGroup\":\"BillDataGrid_controlGroup__AFGBT\",\"saleTypeControl\":\"BillDataGrid_saleTypeControl__hzHpa\",\"slideInUp\":\"BillDataGrid_slideInUp__ZuvW2\",\"gstControl\":\"BillDataGrid_gstControl__AiGdY\",\"paymentControl\":\"BillDataGrid_paymentControl__BD0r9\",\"partialPaymentControl\":\"BillDataGrid_partialPaymentControl__unngo\",\"controlLabel\":\"BillDataGrid_controlLabel__QP4fP\",\"badgesContainer\":\"BillDataGrid_badgesContainer__bqqSt\",\"itemsBadge\":\"BillDataGrid_itemsBadge__o0Uro\",\"amountBadge\":\"BillDataGrid_amountBadge__IPSqT\",\"badgeText\":\"BillDataGrid_badgeText__9cTal\",\"invoiceDetailsGrid\":\"BillDataGrid_invoiceDetailsGrid__QPpaj\",\"itemsSection\":\"BillDataGrid_itemsSection__vJE1b\",\"itemsCircle1\":\"BillDataGrid_itemsCircle1__PQoMB\",\"rotate\":\"BillDataGrid_rotate__l3nA9\",\"itemsCircle2\":\"BillDataGrid_itemsCircle2__0lWcR\",\"scaleIn\":\"BillDataGrid_scaleIn__xFZvA\",\"billItemsGrid\":\"BillDataGrid_billItemsGrid__jpWQo\",\"billItemsHeader\":\"BillDataGrid_billItemsHeader__hxL0O\",\"billItemsTitle\":\"BillDataGrid_billItemsTitle__MQduV\",\"billItemsBadge\":\"BillDataGrid_billItemsBadge__vdJMk\",\"billSummary\":\"BillDataGrid_billSummary__yA4j-\",\"summaryCircle1\":\"BillDataGrid_summaryCircle1__PuveY\",\"summaryCircle2\":\"BillDataGrid_summaryCircle2__fdcks\",\"summaryHeader\":\"BillDataGrid_summaryHeader__h1BtQ\",\"summaryTitle\":\"BillDataGrid_summaryTitle__dSOoP\",\"summaryRow\":\"BillDataGrid_summaryRow__yUShR\",\"summaryLabel\":\"BillDataGrid_summaryLabel__cLnHd\",\"summaryValue\":\"BillDataGrid_summaryValue__LUh-6\",\"summaryTotal\":\"BillDataGrid_summaryTotal__ujvAB\",\"summaryTable\":\"BillDataGrid_summaryTable__ZpVlt\",\"totalAmountRow\":\"BillDataGrid_totalAmountRow__JXMuL\",\"totalAmountLabel\":\"BillDataGrid_totalAmountLabel__IVRMe\",\"totalAmountValue\":\"BillDataGrid_totalAmountValue__5W5mL\",\"discountValue\":\"BillDataGrid_discountValue__QjPij\",\"partialPaymentInfo\":\"BillDataGrid_partialPaymentInfo__OpO+-\",\"partialPaymentRow\":\"BillDataGrid_partialPaymentRow__Qy-Ni\",\"partialPaymentLabel\":\"BillDataGrid_partialPaymentLabel__yEvTO\",\"partialPaymentValue\":\"BillDataGrid_partialPaymentValue__SLg8d\",\"controlsContainer\":\"BillDataGrid_controlsContainer__2jCRg\",\"discountControl\":\"BillDataGrid_discountControl__n0WOI\",\"discountControlLabel\":\"BillDataGrid_discountControlLabel__0iwJ9\",\"discountControlInputs\":\"BillDataGrid_discountControlInputs__TbgUU\",\"partialPaymentControlLabel\":\"BillDataGrid_partialPaymentControlLabel__lxP98\",\"summaryTotalLabel\":\"BillDataGrid_summaryTotalLabel__u+656\",\"summaryTotalValue\":\"BillDataGrid_summaryTotalValue__sKz9B\",\"partialPaymentBalance\":\"BillDataGrid_partialPaymentBalance__lFxZE\",\"discountLabel\":\"BillDataGrid_discountLabel__906vd\",\"discountInputs\":\"BillDataGrid_discountInputs__9BUMD\",\"actionHub\":\"BillDataGrid_actionHub__SlPSg\",\"actionButtonsContainer\":\"BillDataGrid_actionButtonsContainer__BcfKu\",\"actionHubCircle1\":\"BillDataGrid_actionHubCircle1__ggNzA\",\"actionHubCircle2\":\"BillDataGrid_actionHubCircle2__Nb-oj\",\"actionHubCircle3\":\"BillDataGrid_actionHubCircle3__D2pna\",\"actionHubCircle4\":\"BillDataGrid_actionHubCircle4__ayVXK\",\"actionButtons\":\"BillDataGrid_actionButtons__tQbXu\",\"saveButton\":\"BillDataGrid_saveButton__vWggk\",\"billListButton\":\"BillDataGrid_billListButton__ahHFc\",\"refreshButton\":\"BillDataGrid_refreshButton__XnoTE\",\"printButton\":\"BillDataGrid_printButton__nkIDd\",\"clearButton\":\"BillDataGrid_clearButton__518xA\",\"shortcutsInfo\":\"BillDataGrid_shortcutsInfo__kN1Ka\",\"shortcutsText\":\"BillDataGrid_shortcutsText__qGuNn\",\"customerField\":\"BillDataGrid_customerField__+4wOA\",\"customerFieldEndKey\":\"BillDataGrid_customerFieldEndKey__HaMh6\",\"stockField\":\"BillDataGrid_stockField__BQirP\",\"stockFieldSelected\":\"BillDataGrid_stockFieldSelected__x7NU5\",\"stockFieldIcon\":\"BillDataGrid_stockFieldIcon__WeVkj\",\"stockFieldWarning\":\"BillDataGrid_stockFieldWarning__7Lv+C\",\"saleTypeSwitch\":\"BillDataGrid_saleTypeSwitch__Xa4gR\",\"ant-switch-checked\":\"BillDataGrid_ant-switch-checked__rQynk\",\"gstSwitch\":\"BillDataGrid_gstSwitch__ZQG0t\",\"paymentSwitch\":\"BillDataGrid_paymentSwitch__KxB-J\",\"partialPaymentSwitch\":\"BillDataGrid_partialPaymentSwitch__5nNFs\",\"keyboardShortcuts\":\"BillDataGrid_keyboardShortcuts__2e-4z\",\"keyboardShortcutsContent\":\"BillDataGrid_keyboardShortcutsContent__5FpEl\",\"keyboardShortcutsText\":\"BillDataGrid_keyboardShortcutsText__A58I9\",\"slideInLeft\":\"BillDataGrid_slideInLeft__TTFPm\"};","import React, { useEffect, useState, useMemo, useCallback } from 'react';\r\nimport {\r\n  Button,\r\n  Typography,\r\n  message,\r\n  Switch,\r\n  InputNumber,\r\n  Badge,\r\n  Tooltip,\r\n} from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport AntdEditableTable, {\r\n  AntdEditableColumn,\r\n} from '../../../components/common/AntdEditableTable';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\nimport { calculateBillTotals } from '../../../helpers/amount_calculations';\r\nimport { useHandleApiResponse } from '../../../components/common/useHandleApiResponse';\r\nimport { BillItem, BillFormData } from '../../../types/entities';\r\nimport {\r\n  SaveOutlined,\r\n  PrinterOutlined,\r\n  FileTextOutlined,\r\n  ClearOutlined,\r\n} from '@ant-design/icons';\r\nimport StockSelectionModal from './StockSelectionModal';\r\nimport CustomerSelectionModal from './CustomerSelectionModal';\r\nimport UserSelectionModal from './UserSelectionModal';\r\nimport BillSaveConfirmationModal from './BillSaveConfirmationModal';\r\nimport BillListDrawer from './BillListDrawer';\r\nimport ProductDetailsModal from './ProductDetailsModal';\r\nimport ProductSelectionModal from './ProductSelectionModal';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillDataGridProps {\r\n  billdata?: any;\r\n  onSuccess?: (formattedBill?: any) => void;\r\n}\r\n\r\nconst BillDataGrid: React.FC<BillDataGridProps> = ({ billdata, onSuccess }) => {\r\n  const { getEntityApi } = useApiActions();\r\n\r\n  // Utility function to validate stock quantities based on pack size\r\n  const validateStockQuantities = useCallback(\r\n    (stock: any, productItem: any) => {\r\n      if (!stock || !productItem?.VariantItem?.pack_size)\r\n        return { isValid: true, expectedLoose: 0, totalAvailable: 0 };\r\n\r\n      const packSize = parseInt(productItem.VariantItem.pack_size);\r\n      const availablePackQty = stock.available_quantity || 0;\r\n      const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n      // Stock quantities are valid as they are - no need to enforce a specific relationship\r\n      // The validation happens during quantity entry, not during stock data validation\r\n      const isValid = true; // Always valid - let the quantity validation handle limits\r\n      const totalAvailable = availablePackQty * packSize + availableLooseQty;\r\n\r\n      return { isValid, expectedLoose: availableLooseQty, totalAvailable };\r\n    },\r\n    []\r\n  );\r\n\r\n  // API hooks\r\n  const ProductsApi = getEntityApi('Product');\r\n  const CustomerApi = getEntityApi('Customer');\r\n  const BillingUsersApi = getEntityApi('BillingUsers');\r\n  const StockAuditApi = getEntityApi('StockAudit');\r\n  const BranchStock = getEntityApi('BranchStock');\r\n  const SalesRecord = getEntityApi('SalesRecord');\r\n  const InvoiceNumberApi = getEntityApi('InvoiceNumber');\r\n\r\n  // Redux selectors\r\n  const { items: productList, loading: productLoading } = useDynamicSelector(\r\n    ProductsApi.getIdentifier('GetAll')\r\n  );\r\n  const { items: customerList, loading: customerLoading } = useDynamicSelector(\r\n    CustomerApi.getIdentifier('GetAll')\r\n  );\r\n  const { items: userList, loading: userLoading } = useDynamicSelector(\r\n    BillingUsersApi.getIdentifier('GetAll')\r\n  );\r\n  const { items: stockAuditList, loading: stockLoading } = useDynamicSelector(\r\n    StockAuditApi.getIdentifier('GetAll')\r\n  );\r\n  const { items: branchStockList, loading: branchStockLoading } =\r\n    useDynamicSelector(BranchStock.getIdentifier('GetAll'));\r\n  const { items: invoice_no_item } = useDynamicSelector(\r\n    InvoiceNumberApi.getIdentifier('GetAll')\r\n  );\r\n  const { items: invoice_no_create_item, loading: invoice_no_create_loading } =\r\n    useDynamicSelector(InvoiceNumberApi.getIdentifier('Create'));\r\n  const { loading: saleCreateLoading } = useDynamicSelector(\r\n    SalesRecord.getIdentifier('Create')\r\n  );\r\n\r\n  // State\r\n  const [billFormData, setBillFormData] = useState<BillFormData>({\r\n    invoice_no: '',\r\n    date: dayjs().format('YYYY-MM-DD'),\r\n    customer_id: '',\r\n    customer_name: '',\r\n    billed_by_id: '',\r\n    billed_by_name: '',\r\n    payment_mode: 'cash',\r\n    items: [],\r\n  });\r\n\r\n  const [billSettings, setBillSettings] = useState({\r\n    isPaid: true,\r\n    isPartiallyPaid: false,\r\n    isRetail: true,\r\n    isGstIncluded: true,\r\n    discount: 0,\r\n    discountType: 'percentage' as 'percentage' | 'amount',\r\n    paidAmount: 0,\r\n  });\r\n\r\n  const [stockModalRowIndex, setStockModalRowIndex] = useState<number | null>(\r\n    null\r\n  );\r\n  const [externalEditingCell, setExternalEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n  const [customerModalVisible, setCustomerModalVisible] = useState(false);\r\n  const [userModalVisible, setUserModalVisible] = useState(false);\r\n  const [saveConfirmationVisible, setSaveConfirmationVisible] = useState(false);\r\n  const [billListDrawerVisible, setBillListDrawerVisible] = useState(false);\r\n  const [savedBillData, setSavedBillData] = useState<any>(null);\r\n  const [productDetailsModalVisible, setProductDetailsModalVisible] =\r\n    useState(false);\r\n  const [selectedProductId, setSelectedProductId] = useState<string>('');\r\n  const [productSelectionModalVisible, setProductSelectionModalVisible] =\r\n    useState(false);\r\n  const [productSelectionRowIndex, setProductSelectionRowIndex] = useState<\r\n    number | null\r\n  >(null);\r\n  const [lastInteractedRowIndex, setLastInteractedRowIndex] =\r\n    useState<number>(0);\r\n\r\n  // User info - memoized to prevent re-parsing on every render\r\n  const user = useMemo(\r\n    () => JSON.parse(sessionStorage.getItem('user') || '{}'),\r\n    []\r\n  );\r\n  const branchId = user?.branch_id;\r\n\r\n  // Helper function to validate stock quantities\r\n  const validateStockQuantity = (\r\n    stockId: string,\r\n    qty: number,\r\n    looseQty: number\r\n  ): {\r\n    isValid: boolean;\r\n    availablePackQty: number;\r\n    maxLooseQty: number;\r\n    message: string;\r\n  } => {\r\n    const stockList = branchId ? branchStockList : stockAuditList;\r\n    const stock = stockList?.result?.find((s: any) => s._id === stockId);\r\n\r\n    if (!stock) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty: 0,\r\n        maxLooseQty: 0,\r\n        message: 'Stock not found',\r\n      };\r\n    }\r\n\r\n    // Get pack size from stock data\r\n    const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n    const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n    // Available pack quantity (number of complete packs/boxes)\r\n    const availablePackQty = stock.available_quantity || 0;\r\n\r\n    // Available loose quantity (actual loose items in stock, not calculated)\r\n    const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n    // Validate pack quantity (QTY field)\r\n    if (qty > availablePackQty) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty,\r\n        maxLooseQty: 0,\r\n        message: `Pack quantity (${qty}) exceeds available packs (${availablePackQty})`,\r\n      };\r\n    }\r\n\r\n    // Calculate max loose quantity based on remaining packs after QTY selection\r\n    // Formula: (available_packs - selected_qty)  pack_size + available_loose_qty\r\n    const remainingPacks = availablePackQty - qty;\r\n    const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n    const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n    // Validate loose quantity (LOOSE QTY field)\r\n    if (looseQty > maxLooseQty) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty,\r\n        maxLooseQty,\r\n        message: `Loose quantity (${looseQty}) exceeds available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`,\r\n      };\r\n    }\r\n\r\n    return {\r\n      isValid: true,\r\n      availablePackQty,\r\n      maxLooseQty,\r\n      message: '',\r\n    };\r\n  };\r\n\r\n  // Handle quantity change with validation - memoized to prevent column recreation\r\n  const handleQuantityChange = useCallback(\r\n    (rowIndex: number, field: 'qty' | 'loose_qty', value: number) => {\r\n      const newItems = [...billFormData.items];\r\n      const item = newItems[rowIndex];\r\n\r\n      if (!item.stock_id) {\r\n        // If no stock selected, just update the value\r\n        newItems[rowIndex] = { ...item, [field]: value };\r\n        setBillFormData(prev => ({ ...prev, items: newItems }));\r\n        return;\r\n      }\r\n\r\n      // Validate the new quantity\r\n      const newQty = field === 'qty' ? value : item.qty || 0;\r\n      const newLooseQty = field === 'loose_qty' ? value : item.loose_qty || 0;\r\n\r\n      const validation = validateStockQuantity(\r\n        item.stock_id,\r\n        newQty,\r\n        newLooseQty\r\n      );\r\n\r\n      if (!validation.isValid) {\r\n        message.error(validation.message);\r\n\r\n        // Auto-correct the quantity if it exceeds available stock\r\n        if (field === 'qty' && newQty > validation.availablePackQty) {\r\n          newItems[rowIndex] = {\r\n            ...item,\r\n            qty: validation.availablePackQty,\r\n          };\r\n        } else if (\r\n          field === 'loose_qty' &&\r\n          newLooseQty > validation.maxLooseQty\r\n        ) {\r\n          newItems[rowIndex] = { ...item, loose_qty: validation.maxLooseQty };\r\n        }\r\n      } else {\r\n        // Update the quantity\r\n        newItems[rowIndex] = { ...item, [field]: value };\r\n      }\r\n\r\n      setBillFormData(prev => ({ ...prev, items: newItems }));\r\n    },\r\n    [billFormData.items, validateStockQuantity]\r\n  );\r\n\r\n  // Initialize data\r\n  useEffect(() => {\r\n    ProductsApi('GetAll');\r\n    CustomerApi('GetAll');\r\n    BillingUsersApi('GetAll');\r\n    // Only get invoice number for new bills, not when editing existing bills\r\n    if (!billdata && !invoice_no_create_loading) {\r\n      InvoiceNumberApi('GetAll');\r\n    }\r\n\r\n    if (billdata) {\r\n      setBillFormData({\r\n        invoice_no: billdata.invoice_no,\r\n        date: dayjs(billdata.date).format('YYYY-MM-DD'),\r\n        customer_id: billdata.customer_id,\r\n        customer_name: billdata.customerDetails?.full_name || '',\r\n        billed_by_id: billdata.billed_by_id || '',\r\n        billed_by_name: billdata.billedByDetails?.name || '',\r\n        payment_mode: billdata.payment_mode,\r\n        items:\r\n          billdata.Items?.map((item: any) => ({\r\n            _id: item._id,\r\n            product_id: item.product_id,\r\n            product_name: item.productItems?.name || '',\r\n            variant_name: item.productItems?.VariantItem?.variant_name || '',\r\n            stock_id: branchId ? item.branch_stock_id : item.stock_id,\r\n            qty: item.qty || 0,\r\n            loose_qty: item.loose_qty || 0,\r\n            price: item.price,\r\n            mrp: item.mrp || item.price,\r\n            amount: item.amount,\r\n            tax_percentage: item.tax_percentage || 0,\r\n          })) || [],\r\n      });\r\n\r\n      setBillSettings({\r\n        isPaid: billdata.is_paid ?? true,\r\n        isPartiallyPaid: billdata.is_partially_paid ?? false,\r\n        isRetail: billdata.sale_type === 'retail',\r\n        isGstIncluded: billdata.is_gst_included ?? true,\r\n        discount: billdata.discount ?? 0,\r\n        discountType: billdata.discount_type ?? 'percentage',\r\n        paidAmount: billdata.paid_amount ?? 0,\r\n      });\r\n    }\r\n  }, [billdata]);\r\n\r\n  // Set auto-generated invoice number\r\n  useEffect(() => {\r\n    if (invoice_no_item?.result?.invoice_no && !billdata) {\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        invoice_no: invoice_no_item.result.invoice_no,\r\n      }));\r\n    }\r\n  }, [invoice_no_item, billdata]);\r\n\r\n  // Initialize with 5 default empty items if no existing data\r\n  useEffect(() => {\r\n    if (!billdata && billFormData.items.length === 0) {\r\n      const defaultItems = Array(1)\r\n        .fill(null)\r\n        .map((_, index) => ({\r\n          product_id: '',\r\n          product_name: '',\r\n          variant_name: '',\r\n          stock_id: '',\r\n          batch_no: '',\r\n          qty: 0,\r\n          loose_qty: 0,\r\n          price: 0,\r\n          mrp: 0,\r\n          amount: 0,\r\n          tax_percentage: 0,\r\n        }));\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        items: defaultItems,\r\n      }));\r\n    }\r\n  }, [billdata, billFormData.items.length]);\r\n\r\n  // Auto-set current user as billed_by for new bills\r\n  useEffect(() => {\r\n    if (\r\n      !billdata &&\r\n      userList?.result &&\r\n      user?._id &&\r\n      !billFormData.billed_by_id\r\n    ) {\r\n      const currentUserInList = userList.result.find(\r\n        (u: any) => u._id === user._id\r\n      );\r\n      if (currentUserInList) {\r\n        setBillFormData(prev => ({\r\n          ...prev,\r\n          billed_by_id: user._id,\r\n          billed_by_name: currentUserInList.name || user.name || '',\r\n        }));\r\n      }\r\n    }\r\n  }, [userList, user._id, billdata, billFormData.billed_by_id]);\r\n\r\n  // Product and stock options\r\n  const productOptions = useMemo(\r\n    () =>\r\n      productList?.result?.map((product: any) => ({\r\n        label:\r\n          `${product.name} ${product?.VariantItem?.variant_name || ''}`.trim(),\r\n        value: product._id,\r\n      })) || [],\r\n    [productList]\r\n  );\r\n\r\n  const customerOptions = useMemo(() => {\r\n    const options =\r\n      customerList?.result?.map((customer: any) => ({\r\n        label: `${customer.full_name} - ${customer.mobile}`,\r\n        value: customer._id,\r\n      })) || [];\r\n    return options;\r\n  }, [customerList]);\r\n\r\n  const userOptions = useMemo(() => {\r\n    const options =\r\n      userList?.result?.map((user: any) => ({\r\n        label: `${user.name} (${user.roleItems?.name || 'No Role'})`,\r\n        value: user._id,\r\n      })) || [];\r\n    return options;\r\n  }, [userList]);\r\n\r\n  // Column definitions for bill header - memoized to prevent recreation\r\n  const headerColumns: AntdEditableColumn[] = useMemo(\r\n    () => [\r\n      {\r\n        key: 'invoice_no',\r\n        title: ' INVOICE #',\r\n        dataIndex: 'invoice_no',\r\n        type: 'text',\r\n        required: true,\r\n        width: 180,\r\n      },\r\n      {\r\n        key: 'date',\r\n        title: ' DATE',\r\n        dataIndex: 'date',\r\n        type: 'date',\r\n        required: true,\r\n        width: 150,\r\n      },\r\n      {\r\n        key: 'customer_id',\r\n        title: ' CUSTOMER',\r\n        dataIndex: 'customer_id',\r\n        type: 'select',\r\n        options: customerOptions,\r\n        required: true,\r\n        width: 250,\r\n        render: (value: any, record: any) => {\r\n          const selectedCustomer = customerOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          return (\r\n            <Tooltip title=\"Click to open customer selection modal (or press End key)\">\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={() => setCustomerModalVisible(true)}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#fafafa';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>\r\n                  {selectedCustomer\r\n                    ? selectedCustomer.label\r\n                    : 'Select customer'}\r\n                </span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#f0f8ff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  End\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'billed_by_id',\r\n        title: ' BILLED BY',\r\n        dataIndex: 'billed_by_id',\r\n        type: 'select',\r\n        options: userOptions,\r\n        required: false,\r\n        width: 250,\r\n        render: (value: any, record: any) => {\r\n          const selectedUser = userOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          return (\r\n            <Tooltip title=\"Click to open user selection modal (or press Ctrl+U key)\">\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#f0f8ff',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={() => setUserModalVisible(true)}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#e6f7ff';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f8ff';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>{selectedUser ? selectedUser.label : 'Select user'}</span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#ffffff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  Ctrl+U\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'payment_mode',\r\n        title: ' PAYMENT',\r\n        dataIndex: 'payment_mode',\r\n        type: 'select',\r\n        options: [\r\n          { label: ' Cash', value: 'cash' },\r\n          { label: ' UPI', value: 'upi' },\r\n          { label: ' Card', value: 'card' },\r\n        ],\r\n        required: true,\r\n        width: 150,\r\n      },\r\n    ],\r\n    [customerOptions, userOptions]\r\n  );\r\n\r\n  const headerData = useMemo(\r\n    () => [\r\n      {\r\n        invoice_no: billFormData.invoice_no,\r\n        date: billFormData.date,\r\n        customer_id: billFormData.customer_id,\r\n        billed_by_id: billFormData.billed_by_id,\r\n        payment_mode: billFormData.payment_mode,\r\n      },\r\n    ],\r\n    [\r\n      billFormData.invoice_no,\r\n      billFormData.date,\r\n      billFormData.customer_id,\r\n      billFormData.billed_by_id,\r\n      billFormData.payment_mode,\r\n    ]\r\n  );\r\n\r\n  // Column definitions for bill items - memoized to prevent recreation\r\n  const itemColumns: AntdEditableColumn[] = useMemo(\r\n    () => [\r\n      {\r\n        key: 'product_id',\r\n        title: ' PRODUCT',\r\n        dataIndex: 'product_id',\r\n        type: 'product', // triggers modal\r\n        required: true,\r\n        width: 280,\r\n        render: (value, record, index) => {\r\n          const selectedProduct = productOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          return (\r\n            <Tooltip\r\n              title={\r\n                value\r\n                  ? `Product: ${selectedProduct?.label || 'Unknown'} - Click to change  F5 to reopen`\r\n                  : 'Click to select product from inventory  F5 to open'\r\n              }\r\n              placement=\"top\"\r\n            >\r\n              <div\r\n                style={{\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: value ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                  backgroundColor: value ? '#f6ffed' : '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                  minHeight: '32px',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                }}\r\n                onClick={() => {\r\n                  // Open product selection modal\r\n                  if (typeof index === 'number') {\r\n                    setProductSelectionRowIndex(index);\r\n                    setLastInteractedRowIndex(index); // Track this row for F5\r\n                    setProductSelectionModalVisible(true);\r\n                  }\r\n                }}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = value\r\n                    ? '#f6ffed'\r\n                    : '#fafafa';\r\n                  e.currentTarget.style.borderColor = value\r\n                    ? '#52c41a'\r\n                    : '#d9d9d9';\r\n                }}\r\n              >\r\n                <span\r\n                  style={{\r\n                    color: value ? '#52c41a' : '#1890ff',\r\n                    fontWeight: value ? 600 : 400,\r\n                  }}\r\n                >\r\n                  {value\r\n                    ? selectedProduct?.label || 'Unknown Product'\r\n                    : 'Select product'}\r\n                </span>\r\n                {value && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '12px', color: '#52c41a' }}>\r\n                      \r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#52c41a',\r\n                        backgroundColor: '#f6ffed',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Selected\r\n                    </span>\r\n                  </div>\r\n                )}\r\n                {!value && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                      marginTop: '2px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '10px', color: '#ff4d4f' }}>\r\n                       Product required\r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#1890ff',\r\n                        backgroundColor: '#f0f8ff',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Click\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'stock_id',\r\n        title: ' STOCK',\r\n        dataIndex: 'batch_no',\r\n        type: 'stock',\r\n        required: true,\r\n        width: 280,\r\n        editable: true, // allow editing to open modal\r\n        render: (value, record, index) => {\r\n          // Get stock info for display\r\n          const stockList = branchId ? branchStockList : stockAuditList;\r\n          const stock = stockList?.result?.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n\r\n          // Get pack size from stock data\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n          // Calculate available quantities\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const availableLooseQty = stock?.available_loose_quantity || 0;\r\n\r\n          const isLowStock = availablePackQty > 0 && availablePackQty <= 10;\r\n          const isOutOfStock = availablePackQty === 0;\r\n\r\n          return (\r\n            <Tooltip\r\n              title={\r\n                record.product_id\r\n                  ? value\r\n                    ? `Stock: ${value} - Packs Available: ${availablePackQty}  Loose Available: ${availableLooseQty}  Pack Size: ${packSizeNum}  Click to change  F7 to reopen`\r\n                    : 'Click to select stock from available inventory  F7 to open'\r\n                  : 'Please select a product first to choose stock  F7 to open after product selection'\r\n              }\r\n              placement=\"top\"\r\n            >\r\n              <div\r\n                style={{\r\n                  cursor: 'pointer',\r\n                  padding: '6px 10px',\r\n                  borderRadius: '6px',\r\n                  border: value ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                  backgroundColor: value ? '#f6ffed' : '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                  minHeight: '32px',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  width: '100%',\r\n                  gap: '10px',\r\n                }}\r\n                onClick={() => {\r\n                  if (record.product_id && typeof index === 'number') {\r\n                    setStockModalRowIndex(index);\r\n                  } else if (!record.product_id) {\r\n                    message.warning('Please select a product first');\r\n                  }\r\n                }}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = value\r\n                    ? '#f6ffed'\r\n                    : '#fafafa';\r\n                  e.currentTarget.style.borderColor = value\r\n                    ? '#52c41a'\r\n                    : '#d9d9d9';\r\n                }}\r\n              >\r\n                {/* Left Section */}\r\n                <div\r\n                  style={{\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: '8px',\r\n                    flex: 1,\r\n                  }}\r\n                >\r\n                  <span\r\n                    style={{\r\n                      color: value\r\n                        ? '#52c41a'\r\n                        : record.product_id\r\n                          ? '#1890ff'\r\n                          : '#bfbfbf',\r\n                      fontWeight: value ? 600 : 400,\r\n                      fontSize: '13px',\r\n                      whiteSpace: 'nowrap',\r\n                    }}\r\n                  >\r\n                    {value || 'Select Stock'}\r\n                  </span>\r\n\r\n                  {/* Stock Badges (inline) */}\r\n                  {stock && (\r\n                    <>\r\n                      <span\r\n                        style={{\r\n                          color: isOutOfStock\r\n                            ? '#ff4d4f'\r\n                            : isLowStock\r\n                              ? '#faad14'\r\n                              : '#52c41a',\r\n                          fontWeight: 'bold',\r\n                          backgroundColor: isOutOfStock\r\n                            ? '#fff2f0'\r\n                            : isLowStock\r\n                              ? '#fffbe6'\r\n                              : '#f6ffed',\r\n                          padding: '2px 6px',\r\n                          borderRadius: '4px',\r\n                          border: `1px solid ${\r\n                            isOutOfStock\r\n                              ? '#ffccc7'\r\n                              : isLowStock\r\n                                ? '#ffe58f'\r\n                                : '#b7eb8f'\r\n                          }`,\r\n                          fontSize: '12px',\r\n                        }}\r\n                      >\r\n                         {availablePackQty}\r\n                      </span>\r\n                      <span\r\n                        style={{\r\n                          color: '#722ed1',\r\n                          fontWeight: 'bold',\r\n                          backgroundColor: '#f9f0ff',\r\n                          padding: '2px 6px',\r\n                          borderRadius: '4px',\r\n                          border: '1px solid #d3adf7',\r\n                          fontSize: '12px',\r\n                        }}\r\n                      >\r\n                         {availableLooseQty}\r\n                      </span>\r\n                    </>\r\n                  )}\r\n\r\n                  {/* Warning (inline, not breaking row) */}\r\n                  {record.product_id && !value && (\r\n                    <span\r\n                      style={{\r\n                        fontSize: '11px',\r\n                        color: '#ff4d4f',\r\n                        whiteSpace: 'nowrap',\r\n                      }}\r\n                    >\r\n                       Stock required\r\n                    </span>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Right Side \"Click\" Indicator */}\r\n                {record.product_id && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '12px', color: '#1890ff' }}>\r\n                      \r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#52c41a',\r\n                        backgroundColor: '#f6ffed',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Click\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'qty',\r\n        title: ' QTY',\r\n        dataIndex: 'qty',\r\n        type: 'number',\r\n        width: 90,\r\n        render: (value: number, record: any, index?: number) => {\r\n          // Get stock info for validation\r\n          const stockList = branchId ? branchStockList : stockAuditList;\r\n          const stock = stockList?.result?.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const isExceedingStock = value > availablePackQty;\r\n\r\n          return (\r\n            <div style={{ position: 'relative' }}>\r\n              <InputNumber\r\n                value={value}\r\n                min={0}\r\n                max={availablePackQty}\r\n                style={{\r\n                  width: '100%',\r\n                  borderColor: isExceedingStock ? '#ff4d4f' : undefined,\r\n                  backgroundColor: isExceedingStock ? '#fff2f0' : undefined,\r\n                }}\r\n                onPressEnter={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'qty', newValue);\r\n                  }\r\n                }}\r\n                onBlur={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'qty', newValue);\r\n                  }\r\n                }}\r\n                onChange={newValue => {\r\n                  if (newValue !== null && newValue > availablePackQty) {\r\n                    message.error(\r\n                      `Pack quantity cannot exceed available packs (${availablePackQty})`\r\n                    );\r\n                    return;\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'loose_qty',\r\n        title: ' LOOSE',\r\n        dataIndex: 'loose_qty',\r\n        type: 'number',\r\n        width: 90,\r\n        render: (value: number, record: any, index?: number) => {\r\n          // Get stock info for validation\r\n          const stockList = branchId ? branchStockList : stockAuditList;\r\n          const stock = stockList?.result?.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n\r\n          if (!stock) {\r\n            return (\r\n              <div style={{ position: 'relative' }}>\r\n                <InputNumber\r\n                  value={value}\r\n                  min={0}\r\n                  style={{ width: '100%' }}\r\n                  disabled\r\n                />\r\n              </div>\r\n            );\r\n          }\r\n\r\n          // Calculate dynamic max loose quantity based on current QTY selection\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const availableLooseQty = stock?.available_loose_quantity || 0;\r\n\r\n          // Current QTY selection affects max loose quantity\r\n          const currentQty = record.qty || 0;\r\n          const remainingPacks = availablePackQty - currentQty;\r\n          const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n          const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n          const isExceedingStock = value > maxLooseQty;\r\n\r\n          return (\r\n            <div style={{ position: 'relative' }}>\r\n              <InputNumber\r\n                value={value}\r\n                min={0}\r\n                max={maxLooseQty}\r\n                style={{\r\n                  width: '100%',\r\n                  borderColor: isExceedingStock ? '#ff4d4f' : undefined,\r\n                  backgroundColor: isExceedingStock ? '#fff2f0' : undefined,\r\n                }}\r\n                onPressEnter={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'loose_qty', newValue);\r\n                  }\r\n                }}\r\n                onBlur={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'loose_qty', newValue);\r\n                  }\r\n                }}\r\n                onChange={newValue => {\r\n                  if (newValue !== null && newValue > maxLooseQty) {\r\n                    message.error(\r\n                      `Loose quantity cannot exceed available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`\r\n                    );\r\n                    return;\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'price',\r\n        title: ' RATE',\r\n        dataIndex: 'price',\r\n        type: 'number',\r\n        required: true,\r\n        width: 120,\r\n        editable: false, // Make rate not editable\r\n        render: value => (\r\n          <InputNumber value={value} disabled style={{ width: '100%' }} />\r\n        ),\r\n      },\r\n      {\r\n        key: 'amount',\r\n        title: ' AMOUNT',\r\n        dataIndex: 'amount',\r\n        type: 'number',\r\n        editable: false, // Make amount not editable\r\n        width: 130,\r\n        render: value => (\r\n          <InputNumber value={value} disabled style={{ width: '100%' }} />\r\n        ),\r\n      },\r\n    ],\r\n    [\r\n      productOptions,\r\n      branchId,\r\n      branchStockList,\r\n      stockAuditList,\r\n      handleQuantityChange,\r\n    ]\r\n  );\r\n\r\n  // Find the column index for qty\r\n  const qtyColIndex = itemColumns.findIndex(\r\n    col => col.key === 'qty' || col.dataIndex === 'qty'\r\n  );\r\n\r\n  // Calculate bill totals\r\n  const billCalculations = useMemo(() => {\r\n    if (!billFormData.items.length)\r\n      return {\r\n        sub_total: 0,\r\n        value_of_goods: 0,\r\n        total_gst: 0,\r\n        cgst: 0,\r\n        sgst: 0,\r\n        total_amount: 0,\r\n        discountValue: 0,\r\n      };\r\n\r\n    return calculateBillTotals({\r\n      items: billFormData.items,\r\n      productList: productList?.result || [],\r\n      isGstIncluded: billSettings.isGstIncluded,\r\n      discount: billSettings.discount,\r\n      discountType: billSettings.discountType,\r\n    });\r\n  }, [billFormData.items, productList, billSettings]);\r\n\r\n  // Handle header changes - memoized to prevent unnecessary re-renders\r\n  const handleHeaderChange = useCallback(\r\n    (headerRows: any[]) => {\r\n      const updatedHeader = headerRows[0];\r\n      if (updatedHeader) {\r\n        // Find customer name for display\r\n        const customer = customerList?.result?.find(\r\n          (c: any) => c._id === updatedHeader.customer_id\r\n        );\r\n        // Find user name for display\r\n        const user = userList?.result?.find(\r\n          (u: any) => u._id === updatedHeader.billed_by_id\r\n        );\r\n        setBillFormData(prev => ({\r\n          ...prev,\r\n          invoice_no: updatedHeader.invoice_no || '',\r\n          date: updatedHeader.date || dayjs().format('YYYY-MM-DD'),\r\n          customer_id: updatedHeader.customer_id || '',\r\n          customer_name: customer?.full_name || '',\r\n          billed_by_id: updatedHeader.billed_by_id || '',\r\n          billed_by_name: user?.name || '',\r\n          payment_mode: updatedHeader.payment_mode || 'cash',\r\n        }));\r\n      }\r\n    },\r\n    [customerList, userList]\r\n  );\r\n\r\n  // Handle item changes - memoized to prevent unnecessary re-renders\r\n  const handleItemsChange = useCallback(\r\n    (items: any[]) => {\r\n      // Convert back to BillItem format and auto-populate stock\r\n      const billItems: BillItem[] = items.map(item => {\r\n        const billItem: BillItem = {\r\n          product_id: item.product_id || '',\r\n          product_name:\r\n            productOptions.find(\r\n              (opt: { label: string; value: string }) =>\r\n                opt.value === item.product_id\r\n            )?.label || '',\r\n          variant_name: item.variant_name || '',\r\n          stock_id: item.stock_id || '',\r\n          batch_no: item.batch_no || '', //  Preserve batch_no from input\r\n          qty: item.qty || 0,\r\n          loose_qty: item.loose_qty || 0,\r\n          price: item.price || 0,\r\n          mrp: item.mrp || 0,\r\n          amount: item.amount || 0,\r\n          tax_percentage: item.tax_percentage || 0,\r\n        };\r\n\r\n        // Stock validation for pack and loose quantities\r\n        if (item.stock_id && (item.qty || item.loose_qty)) {\r\n          const stockList = branchId ? branchStockList : stockAuditList;\r\n          const stock = stockList?.result?.find(\r\n            (s: any) => s._id === item.stock_id\r\n          );\r\n\r\n          if (stock) {\r\n            // Get pack size from stock data\r\n            const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n            const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n            // Available pack quantity and actual loose quantity\r\n            const availablePackQty = stock.available_quantity || 0;\r\n            const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n            // Validate pack quantity (QTY field)\r\n            if (item.qty && item.qty > availablePackQty) {\r\n              message.error(\r\n                `Pack quantity (${item.qty}) exceeds available packs (${availablePackQty})`\r\n              );\r\n              billItem.qty = availablePackQty;\r\n            }\r\n\r\n            // Calculate max loose quantity based on remaining packs after QTY selection\r\n            const remainingPacks = availablePackQty - (item.qty || 0);\r\n            const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n            const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n            // Validate loose quantity (LOOSE QTY field)\r\n            if (item.loose_qty && item.loose_qty > maxLooseQty) {\r\n              message.error(\r\n                `Loose quantity (${item.loose_qty}) exceeds available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`\r\n              );\r\n              billItem.loose_qty = maxLooseQty;\r\n            }\r\n          }\r\n        }\r\n\r\n        // Auto-populate stock if product is selected but stock is not\r\n        if (item.product_id && !item.stock_id) {\r\n          const stockList = branchId ? branchStockList : stockAuditList;\r\n          const availableStocks =\r\n            stockList?.result?.filter(\r\n              (stock: any) =>\r\n                stock.product === item.product_id ||\r\n                stock.ProductItem?._id === item.product_id\r\n            ) || [];\r\n\r\n          if (availableStocks.length > 0) {\r\n            const firstStock = availableStocks[0];\r\n            billItem.stock_id = firstStock._id;\r\n            billItem.batch_no = firstStock.batch_no || '';\r\n\r\n            // Auto-focus quantity field after auto-selecting stock\r\n            setTimeout(() => {\r\n              const qtyCell = document.querySelector(\r\n                `td[data-row-key=\"${item.key}\"][data-column-key=\"qty\"]`\r\n              ) as HTMLElement;\r\n              if (qtyCell) {\r\n                qtyCell.focus();\r\n              }\r\n            }, 300);\r\n          }\r\n        }\r\n\r\n        return billItem;\r\n      });\r\n      // Update items with calculated amounts\r\n      const updatedItems = billItems.map(item => {\r\n        if (!item.product_id || !item.stock_id) return item;\r\n\r\n        // Get stock info\r\n        const stockList = branchId ? branchStockList : stockAuditList;\r\n        const stock = stockList?.result?.find(\r\n          (s: any) => s._id === item.stock_id\r\n        );\r\n\r\n        if (stock) {\r\n          const sellPrice = stock.sell_price || 0;\r\n          // Get pack size from stock data\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n          // Calculate loose item rate: sell_price / pack_size (since sell_price is per pack)\r\n          const looseRate = sellPrice / packSizeNum;\r\n\r\n          const baseAmount =\r\n            (item.qty || 0) * sellPrice + (item.loose_qty || 0) * looseRate;\r\n\r\n          // Get product for tax calculation\r\n          const product = productList?.result?.find(\r\n            (p: any) => p._id === item.product_id\r\n          );\r\n          const taxPercentage = product?.CategoryItem?.tax_percentage || 0;\r\n\r\n          let amount = baseAmount;\r\n          if (!billSettings.isGstIncluded) {\r\n            amount = baseAmount + (baseAmount * taxPercentage) / 100;\r\n          }\r\n\r\n          return {\r\n            ...item,\r\n            price: item.price || sellPrice,\r\n            mrp: stock.mrp || sellPrice,\r\n            amount: amount,\r\n            tax_percentage: taxPercentage,\r\n            product_name: product?.name || '',\r\n            variant_name: product?.VariantItem?.variant_name || '',\r\n            batch_no: stock.batch_no || '',\r\n          };\r\n        }\r\n\r\n        return item;\r\n      });\r\n\r\n      setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n    },\r\n    [\r\n      productOptions,\r\n      branchId,\r\n      branchStockList,\r\n      stockAuditList,\r\n      productList,\r\n      billSettings,\r\n    ]\r\n  );\r\n\r\n  const handleProductSelect = useCallback(\r\n    (product: any, rowIndex: number) => {\r\n      // Validate rowIndex bounds\r\n      if (rowIndex < 0 || rowIndex >= billFormData.items.length) {\r\n        console.error(`Invalid rowIndex: ${rowIndex}. Items length: ${billFormData.items.length}`);\r\n        message.error(`Invalid row index: ${rowIndex}. Please try again.`);\r\n        return;\r\n      }\r\n\r\n      const newItems = [...billFormData.items];\r\n      \r\n      // Double-check the item exists before modifying\r\n      if (!newItems[rowIndex]) {\r\n        console.error(`Item at index ${rowIndex} is undefined. Items length: ${newItems.length}`);\r\n        message.error('Selected row is no longer valid. Please try again.');\r\n        return;\r\n      }\r\n\r\n      // Robustly set product_id from product.id or product._id\r\n      newItems[rowIndex].product_id = product.id || product._id || '';\r\n      newItems[rowIndex].product_name = product.name || '';\r\n      newItems[rowIndex].price = product.selling_price || 0;\r\n      handleItemsChange(newItems);\r\n      setStockModalRowIndex(rowIndex); // Open stock modal for this row\r\n    },\r\n    [handleItemsChange, billFormData.items.length]\r\n  );\r\n\r\n  const handleF5ProductSelection = () => {\r\n    // First, check if stock modal is open and close it\r\n    if (stockModalRowIndex !== null) {\r\n      setStockModalRowIndex(null);\r\n      message.info('Stock modal closed. Opening product selection...');\r\n\r\n      // Wait a bit for the stock modal to close before opening product modal\r\n      setTimeout(() => {\r\n        openProductModalForRow();\r\n      }, 100);\r\n      return;\r\n    }\r\n\r\n    // If stock modal is not open, proceed with normal F5 behavior\r\n    openProductModalForRow();\r\n  };\r\n\r\n  const openProductModalForRow = () => {\r\n    let targetRowIndex = -1;\r\n\r\n    // Check what element is currently focused\r\n    const activeElement = document.activeElement as HTMLElement;\r\n\r\n    // First, check if there's a currently focused row in the table\r\n    const focusedRow = activeElement?.closest('tr');\r\n\r\n    if (focusedRow) {\r\n      const rowIndex = focusedRow.getAttribute('data-row-key');\r\n\r\n      if (rowIndex !== null) {\r\n        targetRowIndex = parseInt(rowIndex);\r\n      }\r\n    } else {\r\n      // Try alternative method: look for any focused cell in the table\r\n      const focusedCell = activeElement?.closest('td');\r\n      if (focusedCell) {\r\n        const row = focusedCell.closest('tr');\r\n        if (row) {\r\n          const rowIndex = row.getAttribute('data-row-key');\r\n          if (rowIndex !== null) {\r\n            targetRowIndex = parseInt(rowIndex);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // If no focused row found, try using the externally editing cell row\r\n    if (targetRowIndex === -1 && externalEditingCell) {\r\n      targetRowIndex = externalEditingCell.row;\r\n    }\r\n\r\n    // If still no target, try using the last interacted row\r\n    if (targetRowIndex === -1) {\r\n      if (lastInteractedRowIndex < billFormData.items.length) {\r\n        targetRowIndex = lastInteractedRowIndex;\r\n      }\r\n    }\r\n\r\n    // If still no target, find the first row without a product\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(item => !item.product_id);\r\n    }\r\n\r\n    // If still no target row, add a new item and target that\r\n    if (targetRowIndex === -1) {\r\n      handleAddItem();\r\n      targetRowIndex = billFormData.items.length;\r\n    }\r\n\r\n    // Set the target row for product selection\r\n    setProductSelectionRowIndex(targetRowIndex);\r\n    setProductSelectionModalVisible(true);\r\n\r\n    message.info(`Opening product selection for row ${targetRowIndex + 1}`);\r\n  };\r\n\r\n  // Helper function to auto-open product modal (used after bill creation)\r\n  const autoOpenProductModal = useCallback(() => {\r\n    setProductSelectionRowIndex(0); // Target the first row\r\n    setProductSelectionModalVisible(true);\r\n    message.success(\r\n      ' Bill saved! Ready for next bill - Select product to continue.',\r\n      4\r\n    );\r\n  }, []);\r\n\r\n  const handleF7StockSelection = () => {\r\n    // Find the first row that has a product but needs stock or the currently focused row\r\n    let targetRowIndex = -1;\r\n\r\n    // First, check if there's a currently focused row in the table\r\n    const activeElement = document.activeElement as HTMLElement;\r\n    const focusedRow = activeElement?.closest('tr');\r\n    if (focusedRow) {\r\n      const rowIndex = focusedRow.getAttribute('data-row-key');\r\n      if (rowIndex !== null) {\r\n        const rowIndexNum = parseInt(rowIndex);\r\n        // Check if the focused row has a product\r\n        if (billFormData.items[rowIndexNum]?.product_id) {\r\n          targetRowIndex = rowIndexNum;\r\n        }\r\n      }\r\n    }\r\n\r\n    // If no focused row with product found, find the first row with product but without stock\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(\r\n        item => item.product_id && !item.stock_id\r\n      );\r\n    }\r\n\r\n    // If still no target row, find the first row with product (even if it has stock)\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(item => item.product_id);\r\n    }\r\n\r\n    // If no row with product found, show message\r\n    if (targetRowIndex === -1) {\r\n      message.warning('Please select a product first before selecting stock');\r\n      return;\r\n    }\r\n\r\n    // Set the target row for stock selection\r\n    setStockModalRowIndex(targetRowIndex);\r\n\r\n    message.info(`Opening stock selection for row ${targetRowIndex + 1}`);\r\n  };\r\n\r\n  const handleProductSelectionModalSelect = (product: any) => {\r\n    if (productSelectionRowIndex === null) return;\r\n\r\n    // Validate productSelectionRowIndex bounds\r\n    if (productSelectionRowIndex < 0 || productSelectionRowIndex >= billFormData.items.length) {\r\n      console.error(`Invalid productSelectionRowIndex: ${productSelectionRowIndex}. Items length: ${billFormData.items.length}`);\r\n      message.error(`Invalid row index: ${productSelectionRowIndex}. Please try again.`);\r\n      setProductSelectionRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    const newItems = [...billFormData.items];\r\n    \r\n    // Double-check the item exists before modifying\r\n    if (!newItems[productSelectionRowIndex]) {\r\n      console.error(`Item at index ${productSelectionRowIndex} is undefined. Items length: ${newItems.length}`);\r\n      message.error('Selected row is no longer valid. Please try again.');\r\n      setProductSelectionRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    newItems[productSelectionRowIndex].product_id = product._id || '';\r\n    newItems[productSelectionRowIndex].product_name = product.name || '';\r\n    newItems[productSelectionRowIndex].variant_name =\r\n      product.VariantItem?.variant_name || '';\r\n    newItems[productSelectionRowIndex].price = product.selling_price || 0;\r\n\r\n    handleItemsChange(newItems);\r\n\r\n    // Close the product selection modal\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n\r\n    // Open stock selection modal for this row\r\n    setStockModalRowIndex(productSelectionRowIndex);\r\n\r\n    message.success(`Product \"${product.name}\" selected successfully!`);\r\n  };\r\n\r\n  const handleStockSelect = (stock: any) => {\r\n    if (stockModalRowIndex === null) return;\r\n    \r\n    // Validate stockModalRowIndex bounds\r\n    if (stockModalRowIndex < 0 || stockModalRowIndex >= billFormData.items.length) {\r\n      console.error(`Invalid stockModalRowIndex: ${stockModalRowIndex}. Items length: ${billFormData.items.length}`);\r\n      message.error(`Invalid row index: ${stockModalRowIndex}. Please try again.`);\r\n      setStockModalRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    const newItems = [...billFormData.items];\r\n    \r\n    // Double-check the item exists before modifying\r\n    if (!newItems[stockModalRowIndex]) {\r\n      console.error(`Item at index ${stockModalRowIndex} is undefined. Items length: ${newItems.length}`);\r\n      message.error('Selected row is no longer valid. Please try again.');\r\n      setStockModalRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    newItems[stockModalRowIndex].stock_id =\r\n      stock.id || stock._id || stock.invoice_id || '';\r\n    newItems[stockModalRowIndex].batch_no = stock.batch_no || '';\r\n    handleItemsChange(newItems);\r\n    setStockModalRowIndex(null); // Close stock modal\r\n\r\n    // Set external editing cell to qty cell in the same row\r\n    if (qtyColIndex !== -1) {\r\n      setExternalEditingCell({ row: stockModalRowIndex, col: qtyColIndex });\r\n    }\r\n  };\r\n\r\n  // Handle customer selection from modal\r\n  const handleCustomerSelect = useCallback(\r\n    (customer: any) => {\r\n      // Prevent duplicate calls\r\n      if (billFormData.customer_id === customer._id) {\r\n        return;\r\n      }\r\n\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        customer_id: customer._id,\r\n        customer_name: customer.full_name,\r\n      }));\r\n\r\n      // Ensure modal closes\r\n      setTimeout(() => {\r\n        setCustomerModalVisible(false);\r\n        // Auto-open user selection modal after customer is selected\r\n        setTimeout(() => {\r\n          setUserModalVisible(true);\r\n        }, 100);\r\n      }, 50);\r\n\r\n      message.success(\r\n        `Customer \"${customer.full_name}\" selected successfully!`\r\n      );\r\n    },\r\n    [billFormData.customer_id]\r\n  );\r\n\r\n  // Handle user selection from modal\r\n  const handleUserSelect = useCallback(\r\n    (user: any) => {\r\n      // Prevent duplicate calls\r\n      if (billFormData.billed_by_id === user._id) {\r\n        return;\r\n      }\r\n\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        billed_by_id: user._id,\r\n        billed_by_name: user.name,\r\n      }));\r\n\r\n      // Ensure modal closes\r\n      setTimeout(() => {\r\n        setUserModalVisible(false);\r\n      }, 50);\r\n\r\n      message.success(\r\n        `User \"${user.name}\" selected as billed by successfully!`\r\n      );\r\n    },\r\n    [billFormData.billed_by_id]\r\n  );\r\n\r\n  // Handle new bill creation\r\n  const handleNewBill = () => {\r\n    resetBill(false); // Don't show resetBill message\r\n    setSaveConfirmationVisible(false);\r\n    setSavedBillData(null);\r\n    message.success('New bill form cleared successfully!');\r\n  };\r\n\r\n  // Reset bill function - comprehensive reset for after successful save\r\n  const resetBill = useCallback((showMessage = true) => {\r\n    // Clear all form data for new bill\r\n    setBillFormData({\r\n      invoice_no: '',\r\n      date: dayjs().format('YYYY-MM-DD'),\r\n      customer_id: '',\r\n      customer_name: '',\r\n      payment_mode: 'cash',\r\n      items: [\r\n        {\r\n          product_id: '',\r\n          product_name: '',\r\n          variant_name: '',\r\n          stock_id: '',\r\n          batch_no: '',\r\n          qty: 0,\r\n          loose_qty: 0,\r\n          price: 0,\r\n          mrp: 0,\r\n          amount: 0,\r\n          tax_percentage: 0,\r\n        },\r\n      ],\r\n    });\r\n\r\n    // Reset bill settings to defaults\r\n    setBillSettings({\r\n      isPaid: true,\r\n      isPartiallyPaid: false,\r\n      isRetail: true,\r\n      isGstIncluded: true,\r\n      discount: 0,\r\n      discountType: 'percentage',\r\n      paidAmount: 0,\r\n    });\r\n\r\n    // Reset all modal states\r\n    setStockModalRowIndex(null);\r\n    setExternalEditingCell(null);\r\n    setCustomerModalVisible(false);\r\n    setSaveConfirmationVisible(false);\r\n    setBillListDrawerVisible(false);\r\n    setSavedBillData(null);\r\n    setProductDetailsModalVisible(false);\r\n    setSelectedProductId('');\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n    InvoiceNumberApi('GetAll');\r\n    // Only show message if explicitly requested (not during auto-reset after bill creation)\r\n    if (showMessage) {\r\n      message.success('Ready for next bill!', 2);\r\n    }\r\n  }, []);\r\n\r\n  // Handle continue with current bill\r\n  const handleContinueBill = () => {\r\n    setSaveConfirmationVisible(false);\r\n    setSavedBillData(null);\r\n  };\r\n\r\n  // Handle clear bill form\r\n  const handleClearBill = () => {\r\n    resetBill(false); // Don't show resetBill message\r\n    message.success('Bill form cleared successfully!');\r\n  };\r\n\r\n  // Handle view bill from drawer\r\n  const handleViewBill = (bill: any) => {\r\n    if (!bill) {\r\n      message.error('No bill data received');\r\n      return;\r\n    }\r\n\r\n    // Ensure we have the latest data loaded\r\n    ProductsApi('GetAll');\r\n    CustomerApi('GetAll');\r\n    if (branchId) {\r\n      BranchStock('GetAll');\r\n    } else {\r\n      StockAuditApi('GetAll');\r\n    }\r\n\r\n    // Force immediate data loading if not already loaded\r\n    if (!productList?.result) {\r\n      ProductsApi('GetAll');\r\n    }\r\n\r\n    if (!customerList?.result) {\r\n      CustomerApi('GetAll');\r\n    }\r\n\r\n    const currentStockList = branchId ? branchStockList : stockAuditList;\r\n    if (!currentStockList?.result) {\r\n      if (branchId) {\r\n        BranchStock('GetAll');\r\n      } else {\r\n        StockAuditApi('GetAll');\r\n      }\r\n    }\r\n\r\n    // Handle different possible data structures for items\r\n    let items = [];\r\n    if (bill.Items && Array.isArray(bill.Items)) {\r\n      items = bill.Items;\r\n    } else if (bill.items && Array.isArray(bill.items)) {\r\n      items = bill.items;\r\n    } else if (bill.sales_items && Array.isArray(bill.sales_items)) {\r\n      items = bill.sales_items;\r\n    } else if (\r\n      bill.result &&\r\n      bill.result.Items &&\r\n      Array.isArray(bill.result.Items)\r\n    ) {\r\n      items = bill.result.Items;\r\n    } else if (\r\n      bill.result &&\r\n      bill.result.items &&\r\n      Array.isArray(bill.result.items)\r\n    ) {\r\n      items = bill.result.items;\r\n    }\r\n\r\n    // Map items with proper fallbacks and enhanced product name resolution\r\n    const mappedItems = items.map((item: any, index: number) => {\r\n      // Try to get the best product name from various sources\r\n      let productName = '';\r\n      let variantName = '';\r\n\r\n      if (item.productItems?.name) {\r\n        productName = item.productItems.name;\r\n        variantName = item.productItems.VariantItem?.variant_name || '';\r\n      } else if (item.product_name) {\r\n        productName = item.product_name;\r\n        variantName = item.variant_name || '';\r\n      } else if (item.product?.name) {\r\n        productName = item.product.name;\r\n        variantName = item.product.VariantItem?.variant_name || '';\r\n      } else if (item.product_id) {\r\n        // Try to find product name from productList if available\r\n        const product = productList?.result?.find(\r\n          (p: any) => p._id === item.product_id\r\n        );\r\n        if (product) {\r\n          productName = product.name;\r\n          variantName = product.VariantItem?.variant_name || '';\r\n        } else {\r\n          // If product list is not loaded yet, try to load it and mark for later update\r\n          if (!productList?.result) {\r\n            ProductsApi('GetAll');\r\n          }\r\n          // Use a more descriptive placeholder that will be updated later\r\n          productName = `Loading... (ID: ${item.product_id})`;\r\n\r\n          // Try to force load and resolve immediately\r\n          setTimeout(() => {\r\n            if (productList?.result) {\r\n              const foundProduct = productList.result.find(\r\n                (p: any) => p._id === item.product_id\r\n              );\r\n              if (foundProduct) {\r\n                // Update the item directly\r\n                const updatedItems = [...billFormData.items];\r\n                const itemIndex = updatedItems.findIndex(\r\n                  i => i.product_id === item.product_id\r\n                );\r\n                if (itemIndex !== -1) {\r\n                  updatedItems[itemIndex].product_name = foundProduct.name;\r\n                  updatedItems[itemIndex].variant_name =\r\n                    foundProduct.VariantItem?.variant_name || '';\r\n                  setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n                }\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n      }\r\n\r\n      // Handle stock information with proper fallbacks\r\n      let stockId = '';\r\n      let batchNo = '';\r\n\r\n      if (item.stock_id) {\r\n        stockId = item.stock_id;\r\n        batchNo = item.batch_no || '';\r\n      } else if (item.branch_stock_id) {\r\n        stockId = item.branch_stock_id;\r\n        batchNo = item.batch_no || '';\r\n      } else if (item.stock) {\r\n        stockId = item.stock;\r\n        batchNo = item.batch_no || '';\r\n      }\r\n\r\n      // If we have stock_id but no batch_no, try to find it from stock list\r\n      if (stockId && !batchNo) {\r\n        const stockList = branchId ? branchStockList : stockAuditList;\r\n        const stock = stockList?.result?.find((s: any) => s._id === stockId);\r\n        if (stock) {\r\n          batchNo = stock.batch_no || '';\r\n        } else {\r\n          // If stock list is not loaded yet, mark for later update\r\n          if (!stockList?.result) {\r\n            if (branchId) {\r\n              BranchStock('GetAll');\r\n            } else {\r\n              StockAuditApi('GetAll');\r\n            }\r\n          }\r\n          batchNo = `Loading... (Stock: ${stockId})`;\r\n\r\n          // Try to force load and resolve immediately\r\n          setTimeout(() => {\r\n            const currentStockList = branchId\r\n              ? branchStockList\r\n              : stockAuditList;\r\n            if (currentStockList?.result) {\r\n              const foundStock = currentStockList.result.find(\r\n                (s: any) => s._id === stockId\r\n              );\r\n              if (foundStock) {\r\n                // Update the item directly\r\n                const updatedItems = [...billFormData.items];\r\n                const itemIndex = updatedItems.findIndex(\r\n                  i => i.stock_id === stockId\r\n                );\r\n                if (itemIndex !== -1) {\r\n                  updatedItems[itemIndex].batch_no = foundStock.batch_no || '';\r\n                  setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n                }\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n      }\r\n\r\n      const mappedItem = {\r\n        _id: item._id || '',\r\n        product_id: item.product_id || item.product || '',\r\n        product_name: productName,\r\n        variant_name: variantName,\r\n        stock_id: stockId,\r\n        batch_no: batchNo,\r\n        qty: item.qty || 0,\r\n        loose_qty: item.loose_qty || 0,\r\n        price: item.price || 0,\r\n        mrp: item.mrp || item.price || 0,\r\n        amount: item.amount || 0,\r\n        tax_percentage: item.tax_percentage || 0,\r\n      };\r\n\r\n      return mappedItem;\r\n    });\r\n\r\n    // Handle customer information with fallbacks\r\n    const customerId = bill.customer_id || '';\r\n    let customerName = '';\r\n\r\n    if (bill.customerDetails?.full_name) {\r\n      customerName = bill.customerDetails.full_name;\r\n    } else if (bill.customer_name) {\r\n      customerName = bill.customer_name;\r\n    } else if (bill.customer?.full_name) {\r\n      customerName = bill.customer.full_name;\r\n    } else if (bill.customer_id) {\r\n      // Try to find customer name from customerList if available\r\n      const customer = customerList?.result?.find(\r\n        (c: any) => c._id === bill.customer_id\r\n      );\r\n      customerName = customer?.full_name || `Customer ID: ${bill.customer_id}`;\r\n    }\r\n\r\n    // Handle date with fallback\r\n    let formattedDate = dayjs().format('YYYY-MM-DD'); // Default to today\r\n    if (bill.date) {\r\n      try {\r\n        formattedDate = dayjs(bill.date).format('YYYY-MM-DD');\r\n      } catch (error) {\r\n        formattedDate = dayjs().format('YYYY-MM-DD');\r\n      }\r\n    }\r\n\r\n    // Immediately resolve any available product names and stock info if data is already loaded\r\n    let finalMappedItems = [...mappedItems];\r\n\r\n    // If product list is already loaded, resolve product names immediately\r\n    if (productList?.result) {\r\n      finalMappedItems = finalMappedItems.map(item => {\r\n        if (\r\n          item.product_id &&\r\n          (item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:'))\r\n        ) {\r\n          const product = productList.result.find(\r\n            (p: any) => p._id === item.product_id\r\n          );\r\n          if (product) {\r\n            return {\r\n              ...item,\r\n              product_name: product.name,\r\n              variant_name: product.VariantItem?.variant_name || '',\r\n            };\r\n          }\r\n        }\r\n        return item;\r\n      });\r\n    }\r\n\r\n    // If stock list is already loaded, resolve batch numbers immediately\r\n    const stockList = branchId ? branchStockList : stockAuditList;\r\n    if (stockList?.result) {\r\n      finalMappedItems = finalMappedItems.map(item => {\r\n        if (\r\n          item.stock_id &&\r\n          (item.batch_no.includes('Loading...') || !item.batch_no)\r\n        ) {\r\n          const stock = stockList.result.find(\r\n            (s: any) => s._id === item.stock_id\r\n          );\r\n          if (stock) {\r\n            return {\r\n              ...item,\r\n              batch_no: stock.batch_no || '',\r\n            };\r\n          }\r\n        }\r\n        return item;\r\n      });\r\n    }\r\n\r\n    // Load bill data into form with resolved items\r\n    setBillFormData({\r\n      invoice_no: bill.invoice_no || '',\r\n      date: formattedDate,\r\n      customer_id: customerId,\r\n      customer_name: customerName,\r\n      payment_mode: bill.payment_mode || 'cash',\r\n      items: finalMappedItems,\r\n    });\r\n\r\n    // Load bill settings with proper fallbacks\r\n    setBillSettings({\r\n      isPaid: bill.is_paid ?? true,\r\n      isPartiallyPaid: bill.is_partially_paid ?? false,\r\n      isRetail: bill.sale_type === 'retail' || bill.sale_type === undefined,\r\n      isGstIncluded: bill.is_gst_included ?? true,\r\n      discount: bill.discount || 0,\r\n      discountType: bill.discount_type || 'percentage',\r\n      paidAmount: bill.paid_amount || 0,\r\n    });\r\n\r\n    // Show success message\r\n    message.success(`Bill \"${bill.invoice_no}\" loaded successfully!`);\r\n\r\n    // Force immediate resolution after a short delay to catch any data that loads asynchronously\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 100);\r\n\r\n    // Add a more aggressive resolution approach\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 500);\r\n\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 1000);\r\n  };\r\n\r\n  // Force resolve product names and stock information\r\n  const forceResolveProductNamesAndStock = () => {\r\n    if (billFormData.items.length === 0) return;\r\n\r\n    let hasChanges = false;\r\n    const updatedItems = billFormData.items.map(item => {\r\n      let updated = false;\r\n\r\n      // Resolve product names\r\n      if (item.product_id && productList?.result) {\r\n        const product = productList.result.find(\r\n          (p: any) => p._id === item.product_id\r\n        );\r\n        if (\r\n          product &&\r\n          (item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:') ||\r\n            !item.product_name)\r\n        ) {\r\n          item.product_name = product.name;\r\n          item.variant_name = product.VariantItem?.variant_name || '';\r\n          updated = true;\r\n        }\r\n      }\r\n\r\n      // Resolve stock batch numbers\r\n      if (item.stock_id) {\r\n        const stockList = branchId ? branchStockList : stockAuditList;\r\n        if (stockList?.result) {\r\n          const stock = stockList.result.find(\r\n            (s: any) => s._id === item.stock_id\r\n          );\r\n          if (\r\n            stock &&\r\n            (item.batch_no?.includes('Loading...') || !item.batch_no)\r\n          ) {\r\n            item.batch_no = stock.batch_no || '';\r\n            updated = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (updated) hasChanges = true;\r\n      return item;\r\n    });\r\n\r\n    if (hasChanges) {\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        items: updatedItems,\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Handle item addition\r\n  const handleAddItem = () => {\r\n    const newItem: BillItem = {\r\n      product_id: '',\r\n      product_name: '',\r\n      variant_name: '',\r\n      stock_id: '',\r\n      batch_no: '',\r\n      qty: 0,\r\n      loose_qty: 0,\r\n      price: 0,\r\n      mrp: 0,\r\n      amount: 0,\r\n      tax_percentage: 0,\r\n    };\r\n\r\n    setBillFormData(prev => ({\r\n      ...prev,\r\n      items: [...prev.items, newItem],\r\n    }));\r\n  };\r\n\r\n  // Handle item deletion\r\n  const handleDeleteItems = (indices: number[]) => {\r\n    setBillFormData(prev => {\r\n      const newItems = prev.items.filter(\r\n        (_, index: any) => !indices.includes(index?.toString())\r\n      );\r\n      return {\r\n        ...prev,\r\n        items: newItems,\r\n      };\r\n    });\r\n  };\r\n\r\n  // Handle final save\r\n  const handleSaveBill = async () => {\r\n    // Validation\r\n    if (\r\n      !billFormData.invoice_no ||\r\n      !billFormData.customer_id ||\r\n      !billFormData.items.length\r\n    ) {\r\n      message.error('Please fill all required fields');\r\n      return;\r\n    }\r\n\r\n    // Check for incomplete items\r\n    const incompleteItems = billFormData.items.some(\r\n      item =>\r\n        !item.product_id ||\r\n        !item.stock_id ||\r\n        (!item.qty && !item.loose_qty) ||\r\n        !item.price\r\n    );\r\n\r\n    if (incompleteItems) {\r\n      message.error('Please complete all item details');\r\n      return;\r\n    }\r\n\r\n    // Validate that entered quantities don't exceed available stock\r\n    const stockValidationErrors: string[] = [];\r\n    billFormData.items.forEach((item, index) => {\r\n      if (item.stock_id && (item.qty || item.loose_qty)) {\r\n        const validation = validateStockQuantity(\r\n          item.stock_id,\r\n          item.qty || 0,\r\n          item.loose_qty || 0\r\n        );\r\n\r\n        if (!validation.isValid) {\r\n          stockValidationErrors.push(`Row ${index + 1}: ${validation.message}`);\r\n        }\r\n      }\r\n    });\r\n\r\n    if (stockValidationErrors.length > 0) {\r\n      message.error(\r\n        `Stock validation errors:\\n${stockValidationErrors.join('\\n')}`\r\n      );\r\n      return;\r\n    }\r\n    if (!billFormData.customer_id) {\r\n      message.error('Please select a customer');\r\n      return;\r\n    }\r\n    if (!billFormData.payment_mode) {\r\n      message.error('Please select a payment mode');\r\n      return;\r\n    }\r\n\r\n    const payload = {\r\n      invoice_no: billFormData.invoice_no,\r\n      date: billFormData.date,\r\n      customer_id: billFormData.customer_id,\r\n      billed_by_id: billFormData.billed_by_id,\r\n      payment_mode: billFormData.payment_mode,\r\n      items: billFormData.items.map(item => ({\r\n        product_id: item.product_id,\r\n        stock_id: item.stock_id,\r\n        ...(branchId && { branch_stock_id: item.stock_id }),\r\n        qty: item.qty,\r\n        loose_qty: item.loose_qty,\r\n        price: item.price,\r\n        mrp: item.mrp,\r\n        amount: item.amount,\r\n        tax_percentage: item.tax_percentage,\r\n        _id: item._id,\r\n      })),\r\n      ...billCalculations,\r\n      discount: billSettings.discount,\r\n      discount_type: billSettings.discountType,\r\n      is_paid: billSettings.isPaid,\r\n      is_partially_paid: billSettings.isPartiallyPaid,\r\n      sale_type: billSettings.isRetail ? 'retail' : 'wholesale',\r\n      is_gst_included: billSettings.isGstIncluded,\r\n      paid_amount: billSettings.isPartiallyPaid\r\n        ? billSettings.paidAmount\r\n        : billSettings.isPaid\r\n          ? billCalculations.total_amount\r\n          : 0,\r\n    };\r\n\r\n    try {\r\n      let response: any;\r\n      if (billdata) {\r\n        response = await SalesRecord('Update', payload, billdata._id);\r\n      } else {\r\n        response = await SalesRecord('Create', payload);\r\n      }\r\n\r\n      // Show confirmation modal after successful save (only for updates, not new bills)\r\n      if (response?.statusCode === 200) {\r\n        const savedData = {\r\n          ...payload,\r\n          customer_name: billFormData.customer_name,\r\n          total_amount: billCalculations.total_amount,\r\n          invoice_no: payload.invoice_no,\r\n          date: payload.date,\r\n        };\r\n        setSavedBillData(savedData);\r\n\r\n        // Only show confirmation modal for bill updates, not new bills (they auto-reset)\r\n        if (billdata) {\r\n          setSaveConfirmationVisible(true);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      // Handle error silently or show user-friendly message\r\n      message.error('Failed to save bill. Please try again.');\r\n    }\r\n  };\r\n\r\n  // Handle API responses\r\n  const { items: createItems, error: createError } = useDynamicSelector(\r\n    SalesRecord.getIdentifier('Create')\r\n  );\r\n  const { items: updateItems } = useDynamicSelector(\r\n    SalesRecord.getIdentifier('Update')\r\n  );\r\n\r\n  // Note: Removed useHandleApiResponse for 'create' to avoid duplicate success messages\r\n  // Bill creation success is handled manually in useEffect below\r\n\r\n  useHandleApiResponse({\r\n    action: 'update',\r\n    title: 'Bill',\r\n    identifier: SalesRecord.getIdentifier('Update'),\r\n    entityApi: SalesRecord,\r\n  });\r\n\r\n  // Handle create success\r\n  useEffect(() => {\r\n    if (createItems?.statusCode === 200) {\r\n      onSuccess?.();\r\n      InvoiceNumberApi('Create');\r\n      // Auto-reset the bill after successful creation (only for new bills, not updates)\r\n      if (!billdata) {\r\n        // Close confirmation modal first, then reset immediately\r\n        setSaveConfirmationVisible(false);\r\n        setTimeout(() => {\r\n          resetBill(false); // Don't show \"Ready for next bill!\" message\r\n\r\n          // Auto-open product selection modal for the first row after reset\r\n          setTimeout(() => {\r\n            autoOpenProductModal();\r\n          }, 200); // Wait for reset to complete\r\n        }, 100); // Minimal delay just to close modal smoothly\r\n      }\r\n    }\r\n  }, [createItems, billdata, resetBill, onSuccess, autoOpenProductModal]);\r\n\r\n  // Handle create errors\r\n  useEffect(() => {\r\n    if (createError) {\r\n      message.error(createError?.message);\r\n    }\r\n  }, [createError]);\r\n\r\n  // Handle update success\r\n  useEffect(() => {\r\n    if (updateItems?.statusCode === 200) {\r\n      onSuccess?.();\r\n    }\r\n  }, [updateItems]);\r\n\r\n  // Update product names when product list is loaded (for bill viewing)\r\n  useEffect(() => {\r\n    if (productList?.result && billFormData.items.length > 0) {\r\n      // Check if any items have product_id but no product_name or have placeholder text\r\n      const needsUpdate = billFormData.items.some(\r\n        item =>\r\n          item.product_id &&\r\n          (!item.product_name ||\r\n            item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:'))\r\n      );\r\n\r\n      if (needsUpdate) {\r\n        const updatedItems = billFormData.items.map(item => {\r\n          if (\r\n            item.product_id &&\r\n            (!item.product_name ||\r\n              item.product_name.includes('Loading...') ||\r\n              item.product_name.includes('Product ID:'))\r\n          ) {\r\n            const product = productList.result.find(\r\n              (p: any) => p._id === item.product_id\r\n            );\r\n            if (product) {\r\n              return {\r\n                ...item,\r\n                product_name: product.name,\r\n                variant_name: product.VariantItem?.variant_name || '',\r\n              };\r\n            }\r\n          }\r\n          return item;\r\n        });\r\n\r\n        // Only update if we actually made changes\r\n        const hasChanges = updatedItems.some(\r\n          (item, index) =>\r\n            item.product_name !== billFormData.items[index].product_name\r\n        );\r\n\r\n        if (hasChanges) {\r\n          setBillFormData(prev => ({\r\n            ...prev,\r\n            items: updatedItems,\r\n          }));\r\n        }\r\n      }\r\n    }\r\n  }, [productList, billFormData.items]);\r\n\r\n  // Force resolve product names when product list changes\r\n  useEffect(() => {\r\n    if (productList?.result && billFormData.items.length > 0) {\r\n      // Force resolve any remaining unresolved product names\r\n      setTimeout(() => {\r\n        forceResolveProductNamesAndStock();\r\n      }, 200);\r\n    }\r\n  }, [productList]);\r\n\r\n  // Update stock information when stock list is loaded (for bill viewing)\r\n  useEffect(() => {\r\n    const stockList = branchId ? branchStockList : stockAuditList;\r\n    if (stockList?.result && billFormData.items.length > 0) {\r\n      // Check if any items have stock_id but no batch_no or have placeholder text\r\n      const needsUpdate = billFormData.items.some(\r\n        item =>\r\n          item.stock_id &&\r\n          (!item.batch_no || item.batch_no.includes('Loading...'))\r\n      );\r\n\r\n      if (needsUpdate) {\r\n        const updatedItems = billFormData.items.map(item => {\r\n          if (\r\n            item.stock_id &&\r\n            (!item.batch_no || item.batch_no.includes('Loading...'))\r\n          ) {\r\n            const stock = stockList.result.find(\r\n              (s: any) => s._id === item.stock_id\r\n            );\r\n            if (stock) {\r\n              return {\r\n                ...item,\r\n                batch_no: stock.batch_no || '',\r\n              };\r\n            }\r\n          }\r\n          return item;\r\n        });\r\n\r\n        // Only update if we actually made changes\r\n        const hasChanges = updatedItems.some(\r\n          (item, index) => item.batch_no !== billFormData.items[index].batch_no\r\n        );\r\n\r\n        if (hasChanges) {\r\n          setBillFormData(prev => ({\r\n            ...prev,\r\n            items: updatedItems,\r\n          }));\r\n        }\r\n      }\r\n    }\r\n  }, [branchStockList, stockAuditList, billFormData.items, branchId]);\r\n\r\n  // Force resolve stock information when stock list changes\r\n  useEffect(() => {\r\n    const stockList = branchId ? branchStockList : stockAuditList;\r\n    if (stockList?.result && billFormData.items.length > 0) {\r\n      // Force resolve any remaining unresolved stock information\r\n      setTimeout(() => {\r\n        forceResolveProductNamesAndStock();\r\n      }, 200);\r\n    }\r\n  }, [branchStockList, stockAuditList, branchId]);\r\n\r\n  // Periodic check to resolve any remaining unresolved data\r\n  useEffect(() => {\r\n    if (billFormData.items.length > 0) {\r\n      const interval = setInterval(() => {\r\n        const hasUnresolvedItems = billFormData.items.some(\r\n          item =>\r\n            (item.product_id &&\r\n              (!item.product_name ||\r\n                item.product_name.includes('Loading...') ||\r\n                item.product_name.includes('Product ID:'))) ||\r\n            (item.stock_id &&\r\n              (!item.batch_no || item.batch_no.includes('Loading...')))\r\n        );\r\n\r\n        if (\r\n          hasUnresolvedItems &&\r\n          (productList?.result ||\r\n            (branchId ? branchStockList?.result : stockAuditList?.result))\r\n        ) {\r\n          forceResolveProductNamesAndStock();\r\n        }\r\n      }, 1000); // Check every second\r\n\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [\r\n    billFormData.items,\r\n    productList,\r\n    branchStockList,\r\n    stockAuditList,\r\n    branchId,\r\n  ]);\r\n\r\n  // Ultra-Fast Billing Keyboard Shortcuts\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // F1: Add item and focus first product field\r\n      if (e.key === 'F1') {\r\n        e.preventDefault();\r\n        handleAddItem();\r\n        setTimeout(() => {\r\n          const productCell = document.querySelector(\r\n            '.ant-table-tbody tr:last-child td[data-column-key=\"product_id\"]'\r\n          ) as HTMLElement;\r\n          productCell?.focus();\r\n        }, 200);\r\n      }\r\n      // F2: Save bill\r\n      else if (e.key === 'F2') {\r\n        e.preventDefault();\r\n        handleSaveBill();\r\n      }\r\n      // F3: Print bill\r\n      else if (e.key === 'F3') {\r\n        e.preventDefault();\r\n        // TODO: Implement print functionality\r\n        message.info('Print functionality coming soon!');\r\n      }\r\n      // F4: Clear bill form\r\n      else if (e.key === 'F4') {\r\n        e.preventDefault();\r\n        handleClearBill();\r\n      }\r\n      // F5: Open product selection modal for current row or first empty row\r\n      else if (e.key === 'F5') {\r\n        e.preventDefault();\r\n        handleF5ProductSelection();\r\n      }\r\n      // End: Open customer selection modal\r\n      else if (e.key === 'End') {\r\n        e.preventDefault();\r\n        setCustomerModalVisible(true);\r\n      }\r\n      // F6: Open bill list drawer\r\n      else if (e.key === 'F6') {\r\n        e.preventDefault();\r\n        setBillListDrawerVisible(true);\r\n      }\r\n      // F7: Open stock selection modal for current row or first row with product\r\n      else if (e.key === 'F7') {\r\n        e.preventDefault();\r\n        handleF7StockSelection();\r\n      }\r\n\r\n      // Ctrl shortcuts\r\n      else if (e.ctrlKey) {\r\n        switch (e.key) {\r\n          case 's':\r\n            e.preventDefault();\r\n            handleSaveBill();\r\n            break;\r\n          case 'n':\r\n            e.preventDefault();\r\n            handleAddItem();\r\n            setTimeout(() => {\r\n              const productCell = document.querySelector(\r\n                '.ant-table-tbody tr:last-child td[data-column-key=\"product_id\"]'\r\n              ) as HTMLElement;\r\n              productCell?.focus();\r\n            }, 200);\r\n            break;\r\n          case 'p':\r\n            e.preventDefault();\r\n            // TODO: Implement print functionality\r\n            message.info('Print functionality coming soon!');\r\n            break;\r\n          case 'r':\r\n            e.preventDefault();\r\n            // Reset form completely\r\n            resetBill(); // Show message for manual reset via keyboard\r\n            break;\r\n          case 'u':\r\n            e.preventDefault();\r\n            setUserModalVisible(true);\r\n            break;\r\n        }\r\n      }\r\n      // Quick quantity entry (Ctrl + 0-9)\r\n      else if (e.ctrlKey && /^[0-9]$/.test(e.key)) {\r\n        e.preventDefault();\r\n        const activeElement = document.activeElement as HTMLElement;\r\n        if (activeElement?.closest('td[data-column-key=\"qty\"]')) {\r\n          const input = activeElement.querySelector(\r\n            'input'\r\n          ) as HTMLInputElement;\r\n          if (input) {\r\n            input.value = e.key;\r\n            input.dispatchEvent(new Event('change', { bubbles: true }));\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, [\r\n    billFormData,\r\n    billSettings,\r\n    handleF5ProductSelection,\r\n    handleF7StockSelection,\r\n    stockModalRowIndex,\r\n  ]);\r\n\r\n  return (\r\n    <div className={styles.mainContainer}>\r\n      {/* Background Half Circles */}\r\n      <div className={styles.backgroundCircle1} />\r\n      <div className={styles.backgroundCircle2} />\r\n      <div className={styles.backgroundCircle3} />\r\n      <div className={styles.backgroundCircle4} />\r\n      <div className={styles.backgroundCircle5} />\r\n      {/* Ultra-Fast Billing Header */}\r\n      <div className={styles.headerContainer}>\r\n        {/* Animated decorative background elements */}\r\n        <div className={styles.headerCircle1} />\r\n        <div className={styles.headerCircle2} />\r\n        <div className={styles.headerCircle3} />\r\n        <div className={styles.headerCircle4} />\r\n        <div className={styles.headerCircle5} />\r\n\r\n        <div className={styles.headerContent}>\r\n          {/* Title Section */}\r\n          <div className={styles.titleSection}>\r\n            <div className={styles.titleIcon}>\r\n              <FileTextOutlined style={{ fontSize: '24px', color: 'white' }} />\r\n            </div>\r\n            <div>\r\n              <Title level={4} className={styles.titleText}>\r\n                {billdata ? ' EDIT INVOICE' : ' NEW INVOICE'}\r\n              </Title>\r\n              <Text className={styles.subtitleText}>\r\n                Lightning Fast  {dayjs().format('DD MMM YYYY, dddd')}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Controls Section */}\r\n          <div className={styles.controlsSection}>\r\n            <div className={`${styles.controlGroup} ${styles.saleTypeControl}`}>\r\n              <Text className={styles.controlLabel}> SALE TYPE</Text>\r\n              <Switch\r\n                checkedChildren=\"RETAIL\"\r\n                unCheckedChildren=\"WHOLESALE\"\r\n                checked={billSettings.isRetail}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({ ...prev, isRetail: checked }))\r\n                }\r\n                className={styles.saleTypeSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            <div className={`${styles.controlGroup} ${styles.gstControl}`}>\r\n              <Text className={styles.controlLabel}> GST</Text>\r\n              <Switch\r\n                checkedChildren=\"INCL\"\r\n                unCheckedChildren=\"EXCL\"\r\n                checked={billSettings.isGstIncluded}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({ ...prev, isGstIncluded: checked }))\r\n                }\r\n                className={styles.gstSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            <div className={`${styles.controlGroup} ${styles.paymentControl}`}>\r\n              <Text className={styles.controlLabel}> PAYMENT</Text>\r\n              <Switch\r\n                checkedChildren=\"PAID\"\r\n                unCheckedChildren=\"UNPAID\"\r\n                checked={billSettings.isPaid}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({\r\n                    ...prev,\r\n                    isPaid: checked,\r\n                    isPartiallyPaid: checked ? false : prev.isPartiallyPaid,\r\n                  }))\r\n                }\r\n                className={styles.paymentSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            {!billSettings.isPaid && (\r\n              <div\r\n                className={`${styles.controlGroup} ${styles.partialPaymentControl}`}\r\n              >\r\n                <Text className={styles.controlLabel}> PARTIAL</Text>\r\n                <Switch\r\n                  checkedChildren=\"YES\"\r\n                  unCheckedChildren=\"NO\"\r\n                  checked={billSettings.isPartiallyPaid}\r\n                  onChange={checked =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      isPartiallyPaid: checked,\r\n                    }))\r\n                  }\r\n                  className={styles.partialPaymentSwitch}\r\n                  size=\"small\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* Items and Amount Badges - Moved to the end */}\r\n            <div className={styles.badgesContainer}>\r\n              <div className={styles.itemsBadge}>\r\n                <Text className={styles.badgeText}>\r\n                   ITEMS: {billFormData.items.length}\r\n                </Text>\r\n              </div>\r\n              <div className={styles.amountBadge}>\r\n                <Text className={styles.badgeText}>\r\n                   {billCalculations.total_amount.toFixed(2)}\r\n                </Text>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Invoice Details Data Grid */}\r\n      <div className={styles.invoiceDetailsGrid}>\r\n        <AntdEditableTable\r\n          columns={headerColumns}\r\n          dataSource={headerData}\r\n          onSave={handleHeaderChange}\r\n          allowAdd={false}\r\n          allowDelete={false}\r\n          loading={customerLoading}\r\n          className=\"compact-header-grid\"\r\n          size=\"small\"\r\n          rowKey=\"invoice_no\"\r\n        />\r\n      </div>\r\n\r\n      {/* Items Section with Summary */}\r\n      <div className={styles.itemsSection}>\r\n        {/* Decorative half circles for items section */}\r\n        <div className={styles.itemsCircle1} />\r\n        <div className={styles.itemsCircle2} />\r\n        {/* Bill Items Grid */}\r\n        <div className={styles.billItemsGrid}>\r\n          <div className={styles.billItemsHeader}>\r\n            <Text className={styles.billItemsTitle}> BILL ITEMS</Text>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <Badge\r\n                count={billFormData.items.length}\r\n                showZero\r\n                size=\"small\"\r\n                style={{ backgroundColor: 'rgba(255,255,255,0.2)' }}\r\n              >\r\n                <Text className={styles.billItemsBadge}>Items</Text>\r\n              </Badge>\r\n              <Text\r\n                style={{\r\n                  fontSize: '10px',\r\n                  color: '#666',\r\n                  backgroundColor: '#f0f0f0',\r\n                  padding: '2px 6px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                }}\r\n              ></Text>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Stock Validation Summary */}\r\n          {/* {(() => {\r\n            const stockValidationSummary = billFormData.items\r\n              .filter(item => item.stock_id && (item.qty || item.loose_qty))\r\n              .map(item => {\r\n                const stockList = branchId ? branchStockList : stockAuditList;\r\n                const stock = stockList?.result?.find((s: any) => s._id === item.stock_id);\r\n                const availableQty = stock?.available_quantity || 0;\r\n                const totalEnteredQty = (item.qty || 0) + (item.loose_qty || 0);\r\n                const isValid = totalEnteredQty <= availableQty;\r\n                const remainingQty = Math.max(0, availableQty - totalEnteredQty);\r\n                \r\n                return {\r\n                  productName: item.product_name || 'Unknown Product',\r\n                  batchNo: item.batch_no || 'No Batch',\r\n                  availableQty,\r\n                  enteredQty: totalEnteredQty,\r\n                  remainingQty,\r\n                  isValid,\r\n                  isLowStock: remainingQty > 0 && remainingQty <= 5\r\n                };\r\n              });\r\n\r\n            const hasValidationIssues = stockValidationSummary.some(item => !item.isValid);\r\n            const hasLowStock = stockValidationSummary.some(item => item.isLowStock);\r\n\r\n            if (stockValidationSummary.length === 0) return null;\r\n\r\n            return (\r\n              <div style={{\r\n                marginBottom: '16px',\r\n                padding: '12px',\r\n                borderRadius: '8px',\r\n                backgroundColor: hasValidationIssues ? '#fff2f0' : hasLowStock ? '#fffbe6' : '#f6ffed',\r\n                border: `1px solid ${hasValidationIssues ? '#ffccc7' : hasLowStock ? '#ffe58f' : '#b7eb8f'}`,\r\n                fontSize: '12px'\r\n              }}>\r\n                <div style={{ \r\n                  fontWeight: 'bold', \r\n                  marginBottom: '8px',\r\n                  color: hasValidationIssues ? '#cf1322' : hasLowStock ? '#d48806' : '#389e0d'\r\n                }}>\r\n                   Stock Validation Summary\r\n                </div>\r\n                {stockValidationSummary.map((item, index) => (\r\n                  <div key={index} style={{\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center',\r\n                    padding: '4px 0',\r\n                    borderBottom: index < stockValidationSummary.length - 1 ? '1px solid #f0f0f0' : 'none'\r\n                  }}>\r\n                    <span style={{ fontWeight: '500' }}>\r\n                      {item.productName} ({item.batchNo})\r\n                    </span>\r\n                    <div style={{ display: 'flex', gap: '16px', alignItems: 'center' }}>\r\n                      <span>Available: {item.availableQty}</span>\r\n                      <span>Entered: {item.enteredQty}</span>\r\n                      <span>Remaining: {item.remainingQty}</span>\r\n                      <span style={{\r\n                        color: item.isValid ? '#52c41a' : '#ff4d4f',\r\n                        fontWeight: 'bold'\r\n                      }}>\r\n                        {item.isValid ? ' Valid' : ' Exceeds Stock'}\r\n                      </span>\r\n                      {item.isLowStock && (\r\n                        <span style={{ color: '#faad14', fontWeight: 'bold' }}>\r\n                           Low Stock\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            );\r\n          })()} */}\r\n\r\n          <AntdEditableTable\r\n            columns={itemColumns}\r\n            dataSource={billFormData.items.map((item, index) => ({\r\n              ...item,\r\n              key: index.toString(),\r\n            }))}\r\n            onSave={handleItemsChange}\r\n            onAdd={handleAddItem}\r\n            onDelete={handleDeleteItems}\r\n            onProductSelect={handleProductSelect}\r\n            loading={productLoading || stockLoading || branchStockLoading}\r\n            className=\"modern-bill-grid\"\r\n            size=\"small\"\r\n            rowKey=\"key\"\r\n            externalEditingCell={externalEditingCell}\r\n          />\r\n        </div>\r\n\r\n        {/* Bill Summary - Right Side */}\r\n        <div className={styles.billSummary}>\r\n          {/* Decorative half circles for summary */}\r\n          <div className={styles.summaryCircle1} />\r\n          <div className={styles.summaryCircle2} />\r\n          {/* Header */}\r\n          <div className={styles.summaryHeader}>\r\n            <Text className={styles.summaryTitle}> BILL SUMMARY</Text>\r\n          </div>\r\n\r\n          {/* Summary Table */}\r\n          <div className={styles.summaryTable}>\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Sub Total:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.sub_total.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Value of Goods:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.value_of_goods.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Total GST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.total_gst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>CGST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.cgst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>SGST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.sgst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            {billSettings.discount > 0 && (\r\n              <div className={styles.summaryRow}>\r\n                <Text className={styles.summaryLabel}>DISCOUNT:</Text>\r\n                <Text className={styles.discountValue}>\r\n                  -\r\n                  {billSettings.discountType === 'percentage'\r\n                    ? (\r\n                        ((billCalculations.sub_total +\r\n                          billCalculations.total_gst) *\r\n                          (typeof billSettings.discount === 'number'\r\n                            ? billSettings.discount\r\n                            : 0)) /\r\n                        100\r\n                      ).toFixed(2)\r\n                    : (typeof billSettings.discount === 'number'\r\n                        ? billSettings.discount\r\n                        : 0\r\n                      ).toFixed(2)}\r\n                </Text>\r\n              </div>\r\n            )}\r\n\r\n            <div className={styles.totalAmountRow}>\r\n              <Text className={styles.totalAmountLabel}>NET/EXC/REPL:</Text>\r\n              <Text className={styles.totalAmountValue}>\r\n                {billCalculations.total_amount.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            {billSettings.isPartiallyPaid && (\r\n              <div className={styles.partialPaymentInfo}>\r\n                <div className={styles.partialPaymentRow}>\r\n                  <Text className={styles.partialPaymentLabel}>\r\n                    Paid Amount:\r\n                  </Text>\r\n                  <Text className={styles.partialPaymentValue}>\r\n                    \r\n                    {(typeof billSettings.paidAmount === 'number'\r\n                      ? billSettings.paidAmount\r\n                      : 0\r\n                    ).toFixed(2)}\r\n                  </Text>\r\n                </div>\r\n                <div className={styles.partialPaymentRow}>\r\n                  <Text className={styles.partialPaymentLabel}>Balance:</Text>\r\n                  <Text className={styles.partialPaymentValue}>\r\n                    \r\n                    {(\r\n                      billCalculations.total_amount -\r\n                      (typeof billSettings.paidAmount === 'number'\r\n                        ? billSettings.paidAmount\r\n                        : 0)\r\n                    ).toFixed(2)}\r\n                  </Text>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Discount & Payment Controls */}\r\n          <div className={styles.controlsContainer}>\r\n            {/* Discount Controls */}\r\n            <div className={styles.discountControl}>\r\n              <Text className={styles.discountControlLabel}> DISCOUNT</Text>\r\n              <div className={styles.discountControlInputs}>\r\n                <InputNumber\r\n                  min={0}\r\n                  value={billSettings.discount}\r\n                  onChange={value =>\r\n                    setBillSettings(prev => ({ ...prev, discount: value || 0 }))\r\n                  }\r\n                  style={{ width: 70 }}\r\n                  size=\"small\"\r\n                />\r\n                <Switch\r\n                  checkedChildren=\"%\"\r\n                  unCheckedChildren=\"\"\r\n                  checked={billSettings.discountType === 'percentage'}\r\n                  onChange={checked =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      discountType: checked ? 'percentage' : 'amount',\r\n                    }))\r\n                  }\r\n                  size=\"small\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Partial Payment Controls */}\r\n            {billSettings.isPartiallyPaid && (\r\n              <div className={styles.partialPaymentControl}>\r\n                <Text className={styles.partialPaymentControlLabel}>\r\n                   PARTIAL PAY\r\n                </Text>\r\n                <InputNumber\r\n                  min={0}\r\n                  max={billCalculations.total_amount}\r\n                  value={billSettings.paidAmount}\r\n                  onChange={value =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      paidAmount: value || 0,\r\n                    }))\r\n                  }\r\n                  style={{ width: 90 }}\r\n                  size=\"small\"\r\n                  formatter={value =>\r\n                    `${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\r\n                  }\r\n                  parser={value => Number(value!.replace(/\\s?|(,*)/g, ''))}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Ultra-Fast Action Hub */}\r\n      <div className={styles.actionHub}>\r\n        {/* Background decoration */}\r\n        <div className={styles.actionHubCircle1} />\r\n        <div className={styles.actionHubCircle2} />\r\n        <div className={styles.actionHubCircle3} />\r\n        <div className={styles.actionHubCircle4} />\r\n\r\n        <div className={styles.actionButtonsContainer}>\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            icon={<SaveOutlined />}\r\n            onClick={handleSaveBill}\r\n            loading={saleCreateLoading}\r\n            className={styles.saveButton}\r\n          >\r\n             {billdata ? 'UPDATE' : 'SAVE BILL'} (F2)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<FileTextOutlined />}\r\n            onClick={() => setBillListDrawerVisible(true)}\r\n            className={styles.billListButton}\r\n          >\r\n             BILL LIST (F6)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<ClearOutlined />}\r\n            onClick={handleClearBill}\r\n            className={styles.clearButton}\r\n          >\r\n             CLEAR (F4 / Ctrl+R)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<PrinterOutlined />}\r\n            className={styles.printButton}\r\n          >\r\n             PRINT (F3)\r\n          </Button>\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)',\r\n            padding: '14px 18px',\r\n            borderRadius: '10px',\r\n            border: '1px solid #cbd5e1',\r\n            position: 'relative',\r\n            zIndex: 1,\r\n            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.05)',\r\n          }}\r\n        >\r\n          <div style={{ textAlign: 'right' }}>\r\n            <Text\r\n              style={{\r\n                color: '#475569',\r\n                fontSize: '12px',\r\n                display: 'block',\r\n                fontWeight: 600,\r\n                lineHeight: '18px',\r\n              }}\r\n            >\r\n               <strong>Keyboard Shortcuts:</strong> Ctrl+S (Save)  Ctrl+N\r\n              (Add)  F4/Ctrl+R (Clear)  Tab/Shift+Tab (Navigate)  Enter\r\n              (Edit)  Esc (Cancel)  End (Customer)  Ctrl+U (User)  F5\r\n              (Product)  F6 (Bill List)  F7 (Stock)\r\n            </Text>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {stockModalRowIndex !== null && (\r\n        <StockSelectionModal\r\n          visible={true}\r\n          onSelect={handleStockSelect}\r\n          onCancel={() => setStockModalRowIndex(null)}\r\n          productId={billFormData.items[stockModalRowIndex]?.product_id || ''}\r\n        />\r\n      )}\r\n\r\n      {/* Customer Selection Modal */}\r\n      <CustomerSelectionModal\r\n        visible={customerModalVisible}\r\n        onSelect={handleCustomerSelect}\r\n        onCancel={() => setCustomerModalVisible(false)}\r\n      />\r\n\r\n      {/* User Selection Modal */}\r\n      <UserSelectionModal\r\n        visible={userModalVisible}\r\n        onSelect={handleUserSelect}\r\n        onCancel={() => setUserModalVisible(false)}\r\n      />\r\n\r\n      {/* Bill Save Confirmation Modal */}\r\n      <BillSaveConfirmationModal\r\n        visible={saveConfirmationVisible}\r\n        onNewBill={handleNewBill}\r\n        onContinueBill={handleContinueBill}\r\n        onCancel={() => setSaveConfirmationVisible(false)}\r\n        savedBillData={savedBillData}\r\n      />\r\n\r\n      {/* Product Details Modal */}\r\n      <ProductDetailsModal\r\n        visible={productDetailsModalVisible}\r\n        onCancel={() => setProductDetailsModalVisible(false)}\r\n        productId={selectedProductId}\r\n      />\r\n\r\n      {/* Product Selection Modal */}\r\n      <ProductSelectionModal\r\n        visible={productSelectionModalVisible}\r\n        onSelect={handleProductSelectionModalSelect}\r\n        onCancel={() => {\r\n          setProductSelectionModalVisible(false);\r\n          setProductSelectionRowIndex(null);\r\n        }}\r\n      />\r\n\r\n      {/* Bill List Drawer */}\r\n      <BillListDrawer\r\n        visible={billListDrawerVisible}\r\n        onClose={() => setBillListDrawerVisible(false)}\r\n        onViewBill={handleViewBill}\r\n        onNewBill={handleNewBill}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillDataGrid;\r\n","/**\r\n * Centralized bill calculation utility\r\n * @param items - array of bill items\r\n * @param productList - product list (for tax/category lookup)\r\n * @param isGstIncluded - whether GST is included in price\r\n * @param discount - discount value\r\n * @param discountType - 'percentage' or 'amount'\r\n * @returns { totalAmount, totalGST, cgst, sgst, valueOfGoods, subtotal, itemsWithTax }\r\n */\r\nexport function calculateBillTotals({\r\n  items,\r\n  productList,\r\n  isGstIncluded,\r\n  discount,\r\n  discountType,\r\n}: {\r\n  items: any[];\r\n  productList: any[];\r\n  isGstIncluded: boolean;\r\n  discount: number;\r\n  discountType: \"percentage\" | \"amount\";\r\n}) {\r\n  // Calculate item base amounts\r\n  const itemsWithTax = items.map((item) => {\r\n    const product = productList?.find((p: any) => p._id === item.product_id);\r\n    // Use item's tax_percentage if available, otherwise get from product category, or default to 18%\r\n    let taxPercentage = item.tax_percentage || product?.CategoryItem?.tax_percentage || 18;\r\n    \r\n    // If still no tax percentage, use a default based on common GST rates\r\n    if (!taxPercentage || taxPercentage === 0) {\r\n      // Default to 18% GST for most goods\r\n      taxPercentage = 18;\r\n    }\r\n    \r\n\r\n    // Calculate base amount (before GST)\r\n    const baseAmount =\r\n      Number(item.qty || 0) * Number(item.price || 0) +\r\n      Number(item.loose_qty || 0) *\r\n        (Number(item.price || 0) / (product?.VariantItem?.pack_size || 1) || 0);\r\n    \r\n    // Calculate amount (with GST if applicable)\r\n    let amount = baseAmount;\r\n    if (!isGstIncluded && taxPercentage > 0) {\r\n      amount = baseAmount + (baseAmount * taxPercentage / 100);\r\n    }\r\n    return {\r\n      ...item,\r\n      tax_percentage: taxPercentage,\r\n      baseAmount,\r\n      amount,\r\n    };\r\n  });\r\n\r\n  // sub_total: sum of all item.amount values (table total before discount/GST)\r\n  const sub_total = itemsWithTax.reduce(\r\n    (sum, item) => sum + Number(item.amount),\r\n    0\r\n  );\r\n\r\n  // base_sub_total: sum of all item base amounts (before GST and discount)\r\n  const base_sub_total = itemsWithTax.reduce(\r\n    (sum, item) => sum + Number(item.baseAmount),\r\n    0\r\n  );\r\n\r\n  // Discount\r\n  let discountValue = 0;\r\n  if (discount > 0) {\r\n    if (discountType === \"percentage\") {\r\n      discountValue = base_sub_total * (discount / 100);\r\n    } else {\r\n      discountValue = discount;\r\n    }\r\n  }\r\n\r\n  // Discounted value of goods\r\n  const discounted_value_of_goods = base_sub_total - discountValue;\r\n\r\n  let total_gst = 0;\r\n  let value_of_goods = 0;\r\n  let total_amount = 0;\r\n  // Calculate GST and totals for each item\r\n  itemsWithTax.forEach(item => {\r\n    let discountedBase = item.baseAmount;\r\n    if (discount > 0) {\r\n      if (discountType === \"percentage\") {\r\n        discountedBase = item.baseAmount - (item.baseAmount * (discount / 100));\r\n      } else {\r\n        discountedBase = item.baseAmount - ((discount/base_sub_total)*item.baseAmount);\r\n      }\r\n    }\r\n    \r\n    let gstAmount = 0;\r\n    if (!isGstIncluded) {\r\n      // GST Excluded: GST is added on top\r\n      if (item.tax_percentage > 0) {\r\n        gstAmount = discountedBase * (item.tax_percentage / 100);\r\n        value_of_goods += discountedBase;\r\n        total_gst += gstAmount;\r\n        total_amount += discountedBase + gstAmount;\r\n      } else {\r\n        // No tax\r\n        value_of_goods += discountedBase;\r\n        total_amount += discountedBase;\r\n      }\r\n    } else {\r\n      // GST Included: GST is part of the price, extract it\r\n      if (item.tax_percentage > 0) {\r\n        gstAmount = discountedBase * (item.tax_percentage / (100 + item.tax_percentage));\r\n        value_of_goods += discountedBase - gstAmount;\r\n        total_gst += gstAmount;\r\n        total_amount += discountedBase;\r\n      } else {\r\n        // No tax\r\n        value_of_goods += discountedBase;\r\n        total_amount += discountedBase;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Calculate CGST and SGST (each is total_gst / 2)\r\n  const cgst = total_gst / 2;\r\n  const sgst = total_gst / 2;\r\n\r\n  return {\r\n    sub_total,\r\n    value_of_goods,\r\n    total_gst,\r\n    cgst,\r\n    sgst,\r\n    total_amount,\r\n    discountValue,\r\n  };\r\n}\r\n"],"names":["Search","Input","_ref","_products$result","visible","onSelect","onCancel","getEntityApi","useApiActions","ProductsApi","items","products","loading","useDynamicSelector","getIdentifier","searchTerm","setSearchTerm","useState","selectedRowKey","setSelectedRowKey","highlightedIndex","setHighlightedIndex","searchInputRef","useRef","filteredProducts","result","filter","p","_p$name","_p$sku","_p$VariantItem","_p$VariantItem$varian","_p$VariantItem2","_p$VariantItem2$varia","_p$selling_price","searchLower","toLowerCase","name","includes","sku","VariantItem","variant_name","variant_code","selling_price","toString","sort","a","b","_a$name","_a$VariantItem","_a$VariantItem$varian","_a$sku","_b$name","_b$VariantItem","_b$VariantItem$varian","_b$sku","_a$name2","_a$VariantItem2","_a$VariantItem2$varia","_a$sku2","_b$name2","_b$VariantItem2","_b$VariantItem2$varia","_b$sku2","aExactMatch","bExactMatch","aStartsWith","startsWith","bStartsWith","useEffect","length","_id","setTimeout","_searchInputRef$curre","current","focus","columns","title","dataIndex","key","width","render","record","_record$VariantItem","_record$VariantItem2","_jsxs","children","_jsx","style","fontWeight","color","fontSize","marginTop","marginLeft","variant","fontStyle","price","toFixed","handleSelectRow","product","Modal","open","footer","destroyOnClose","onClick","handleModalClick","_searchInputRef$curre4","ref","placeholder","onChange","e","target","value","marginBottom","autoFocus","onKeyDown","_searchInputRef$curre2","preventDefault","prev","next","Math","min","_searchInputRef$curre3","prevIndex","max","selectedProduct","onBlur","_searchInputRef$curre5","Table","dataSource","rowKey","size","pagination","onRow","idx","_searchInputRef$curre6","onDoubleClick","className","backgroundColor","undefined","border","rowSelection","type","selectedRowKeys","keys","findIndex","scroll","y","_stocks$result","productId","StockApi","stocks","errorMessage","setErrorMessage","tableBodyRef","isStockExpired","stock","expiry_date","dayjs","isBefore","isStockOutOfStock","available_quantity","showExpiredStockError","expiryDate","format","errorMsg","concat","message","error","showOutOfStockError","allStocks","s","_s$batch_no","_s$ProductItem","_s$ProductItem$name","_s$ProductItem2","_s$ProductItem2$Varia","_s$ProductItem2$Varia2","_s$available_quantity","_s$sell_price","batch_no","ProductItem","sell_price","firstValidIndex","_allStocks$highlighte","row","querySelector","scrollIntoView","block","_ProductItem$VariantI","isOutOfStock","ExclamationCircleOutlined","today","isExpired","daysUntilExpiry","diff","icon","CheckCircleOutlined","status","Tooltip","Tag","_stock$ProductItem","id","code","_searchInputRef$curre7","finalNext","finalPrev","selectedStock","_searchInputRef$curre8","padding","borderRadius","display","alignItems","gap","i","shiftKey","tabIndex","outline","justifyContent","margin","_searchInputRef$curre9","opacity","cursor","getCheckboxProps","disabled","Text","Typography","onSave","onAdd","onDelete","allowAdd","allowDelete","compact","enableKeyboardNav","onProductSelect","externalEditingCell","data","setData","selectedRows","setSelectedRows","editingCell","setEditingCell","firstLoadRef","firstProductColIndex","col","String","handleAddRow","firstEditableCol","editable","saveCell","column","required","validation","newData","handleKeyDown","ctrlKey","document","addEventListener","removeEventListener","getNextEditableCol","startCol","direction","EditableCell","_ref2","_data$row","_data$row2","cellValue","setCellValue","inputRef","isProductModalVisible","setIsProductModalVisible","isStockModalVisible","setIsStockModalVisible","_inputRef$current","handleChange","val","stopPropagation","nextCol","nextRow","colIndex","handleProductSelect","handleStockSelect","stock_id","_Fragment","ProductSelectionModal","readOnly","StockSelectionModal","product_id","InputNumber","controls","Select","options","_inputRef$current2","DatePicker","date","mergedColumns","map","_objectSpread","onCell","_record","rowIndex","onContextMenu","product_name","option","find","opt","label","Space","Button","PlusOutlined","danger","DeleteOutlined","handleDeleteRow","confirm","onOk","slice","warning","SaveOutlined","bordered","Title","Option","CustomerApi","customerList","customerLoading","createLoading","customers","showAddForm","setShowAddForm","selectedCustomer","setSelectedCustomer","selectedRowIndex","setSelectedRowIndex","showCreateGrid","setShowCreateGrid","newCustomerData","setNewCustomerData","full_name","email","mobile","address","customer_type","form","Form","useForm","modalRef","searchTimeoutRef","createGridRef","firstFormInputRef","filteredCustomers","useMemo","shouldShowCreateGrid","trim","getCustomerTypeColor","useCallback","vip","wholesale","regular","navigateToCustomer","newIndex","rowElement","scrollBehavior","behavior","handleSearch","clearTimeout","searchString","handleCustomerSelect","customer","handleCreateCustomerFromForm","async","clearFormData","resetFields","handleFormFieldChange","field","ArrowDown","ArrowUp","Home","End","handleGlobalKeyDown","tagName","classList","contains","closest","select","firstInput","text","index","c","height","transition","strong","toUpperCase","PhoneOutlined","MailOutlined","HomeOutlined","getRowProps","onMouseEnter","currentTarget","onMouseLeave","focusSearch","timer","useHandleApiResponse","action","identifier","entityApi","createResult","content","duration","destroy","statusCode","newCustomer","handleSearchFocus","top","afterOpenChange","Compact","prefix","SearchOutlined","flex","onFocus","suffix","UserAddOutlined","newState","minWidth","background","boxShadow","position","overflow","right","zIndex","bottom","left","Row","justify","align","Col","level","WebkitBackgroundClip","WebkitTextFillColor","backgroundClip","marginRight","CloseOutlined","layout","gridTemplateColumns","Item","UserOutlined","rules","pattern","TextArea","rows","resize","Divider","maxHeight","textAlign","BillingUsersApi","userList","userLoading","users","selectedUser","setSelectedUser","currentUser","JSON","parse","sessionStorage","getItem","_unused","filteredUsers","user","_user$name","_user$email","_user$mobile","_user$user_name","_user$roleItems","_user$roleItems$name","user_name","roleItems","navigateToUser","handleUserSelect","u","_record$roleItems","_record$branchItems","branchItems","branch_name","currentUserInList","onNewBill","onContinueBill","savedBillData","centered","maskClosable","closable","FileTextOutlined","invoice_no","customer_name","CalendarOutlined","DollarOutlined","total_amount","parseFloat","onClose","onViewBill","SalesRecord","billList","filteredBills","setFilteredBills","filtered","bill","_bill$customerDetails","invoiceNo","customerName","customerDetails","totalAmount","getPaymentStatusText","isPaid","isPartiallyPaid","handleViewBill","handleNewBill","Drawer","placement","bodyStyle","headerStyle","borderBottom","allowClear","Spin","Empty","description","List","renderItem","_bill$customerDetails2","transform","Avatar","is_paid","is_partially_paid","EyeOutlined","PrinterOutlined","borderTop","_productDetails$Varia","_productDetails$Varia2","_productDetails$Varia3","_productDetails$selli","_productDetails$mrp","_productDetails$Categ","_productDetails$Categ2","productDetails","setProductDetails","handleCancel","Descriptions","span","brand","unit","mrp","CategoryItem","tax_percentage","min_stock","max_stock","_billFormData$items$s","billdata","onSuccess","productItem","_productItem$VariantI","pack_size","isValid","expectedLoose","totalAvailable","packSize","parseInt","availablePackQty","availableLooseQty","available_loose_quantity","StockAuditApi","BranchStock","InvoiceNumberApi","productList","productLoading","stockAuditList","stockLoading","branchStockList","branchStockLoading","invoice_no_item","invoice_no_create_item","invoice_no_create_loading","saleCreateLoading","billFormData","setBillFormData","customer_id","billed_by_id","billed_by_name","payment_mode","billSettings","setBillSettings","isRetail","isGstIncluded","discount","discountType","paidAmount","stockModalRowIndex","setStockModalRowIndex","setExternalEditingCell","customerModalVisible","setCustomerModalVisible","userModalVisible","setUserModalVisible","saveConfirmationVisible","setSaveConfirmationVisible","billListDrawerVisible","setBillListDrawerVisible","setSavedBillData","productDetailsModalVisible","setProductDetailsModalVisible","selectedProductId","setSelectedProductId","productSelectionModalVisible","setProductSelectionModalVisible","productSelectionRowIndex","setProductSelectionRowIndex","lastInteractedRowIndex","setLastInteractedRowIndex","branchId","branch_id","validateStockQuantity","stockId","qty","looseQty","_stockList$result","_stock$ProductItem$Va","stockList","maxLooseQty","packSizeNum","remainingPacks","handleQuantityChange","newItems","item","newQty","newLooseQty","loose_qty","_billdata$customerDet","_billdata$billedByDet","_billdata$Items","_billdata$is_paid","_billdata$is_partiall","_billdata$is_gst_incl","_billdata$discount","_billdata$discount_ty","_billdata$paid_amount","billedByDetails","Items","_item$productItems","_item$productItems2","_item$productItems2$V","productItems","branch_stock_id","amount","sale_type","is_gst_included","discount_type","paid_amount","_invoice_no_item$resu","defaultItems","Array","fill","_","productOptions","_productList$result","_product$VariantItem","customerOptions","_customerList$result","userOptions","_userList$result","headerColumns","borderColor","headerData","itemColumns","minHeight","_stockList$result2","_stock$ProductItem2","_stock$ProductItem2$V","isLowStock","whiteSpace","_stockList$result3","isExceedingStock","onPressEnter","newValue","_stockList$result4","_stock$ProductItem3","_stock$ProductItem3$V","qtyColIndex","billCalculations","itemsWithTax","_product$CategoryItem","taxPercentage","baseAmount","Number","sub_total","reduce","sum","base_sub_total","discountValue","total_gst","value_of_goods","forEach","discountedBase","gstAmount","cgst","sgst","calculateBillTotals","handleHeaderChange","headerRows","updatedHeader","_customerList$result2","_userList$result2","handleItemsChange","updatedItems","_productOptions$find","billItem","_stockList$result5","_stock$ProductItem4","_stock$ProductItem4$V","_stockList$result6","availableStocks","_stock$ProductItem5","firstStock","qtyCell","_stockList$result7","_stock$ProductItem6","_stock$ProductItem6$V","_productList$result2","_product$VariantItem2","sellPrice","looseRate","console","handleF5ProductSelection","info","openProductModalForRow","targetRowIndex","activeElement","focusedRow","getAttribute","focusedCell","handleAddItem","autoOpenProductModal","success","handleF7StockSelection","_billFormData$items$r","rowIndexNum","resetBill","showMessage","arguments","handleClearBill","forceResolveProductNamesAndStock","hasChanges","updated","_product$VariantItem6","_item$batch_no","newItem","handleSaveBill","some","stockValidationErrors","push","join","payload","_response","response","savedData","createItems","createError","updateItems","_product$VariantItem7","interval","setInterval","clearInterval","productCell","test","input","dispatchEvent","Event","bubbles","styles","Switch","checkedChildren","unCheckedChildren","checked","AntdEditableTable","Badge","count","showZero","indices","formatter","replace","parser","ClearOutlined","lineHeight","invoice_id","CustomerSelectionModal","UserSelectionModal","BillSaveConfirmationModal","handleContinueBill","ProductDetailsModal","_product$VariantItem3","BillListDrawer","_bill$customer","_bill$is_paid","_bill$is_partially_pa","_bill$is_gst_included","currentStockList","isArray","sales_items","mappedItems","_item$productItems3","_item$product","productName","variantName","_item$productItems$Va","_item$product$Variant","_productList$result3","_product$VariantItem4","foundProduct","itemIndex","_foundProduct$Variant","batchNo","_stockList$result8","foundStock","customerId","_customerList$result3","formattedDate","finalMappedItems","_product$VariantItem5"],"sourceRoot":""}