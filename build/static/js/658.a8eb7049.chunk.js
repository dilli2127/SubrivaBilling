"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[658],{13658:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Xt});var l=i(89379),n=i(65043),o=i(89472),a=i(83833),r=i(16569),s=i(96651),d=i(7866),c=i(12624),u=i(37490),m=i(95206),p=i(60446),f=i.n(p),x=i(62751),y=i(36621),v=i(26553),_=i(93504),h=i(6051),g=i(39249),b=i(73847),j=i(9316),A=i(88143),k=i(47615),C=i(83537),w=i(97031),I=i(35708),S=i(70579);const{Search:D}=y.A,N=e=>{var t;let{visible:i,onSelect:l,onCancel:o}=e;const{getEntityApi:a}=(0,C.p)(),s=a("Product"),{items:d,loading:c}=(0,w.Sm)(s.getIdentifier("GetAll")),[u,p]=(0,n.useState)(""),[f,y]=(0,n.useState)(null),[v,_]=(0,n.useState)(0),[b,j]=(0,n.useState)(!1),A=(0,n.useRef)(null),N=(null===d||void 0===d||null===(t=d.result)||void 0===t?void 0:t.filter((e=>{var t,i,l,n,o,a,r;const s=u.toLowerCase();return((null===(t=e.name)||void 0===t?void 0:t.toLowerCase())||"").includes(s)||((null===(i=e.sku)||void 0===i?void 0:i.toLowerCase())||"").includes(s)||(null===(l=e.VariantItem)||void 0===l||null===(n=l.variant_name)||void 0===n?void 0:n.toLowerCase().includes(s))||(null===(o=e.VariantItem)||void 0===o||null===(a=o.variant_code)||void 0===a?void 0:a.toLowerCase().includes(s))||((null===(r=e.selling_price)||void 0===r?void 0:r.toString())||"").includes(s)})).sort(((e,t)=>{var i,l,n,o,a,r,s,d,c,m,p,f,x,y,v,_;const h=u.toLowerCase(),g=((null===(i=e.name)||void 0===i?void 0:i.toLowerCase())||"")===h||(null===(l=e.VariantItem)||void 0===l||null===(n=l.variant_name)||void 0===n?void 0:n.toLowerCase())===h||((null===(o=e.sku)||void 0===o?void 0:o.toLowerCase())||"")===h,b=((null===(a=t.name)||void 0===a?void 0:a.toLowerCase())||"")===h||(null===(r=t.VariantItem)||void 0===r||null===(s=r.variant_name)||void 0===s?void 0:s.toLowerCase())===h||((null===(d=t.sku)||void 0===d?void 0:d.toLowerCase())||"")===h;if(g&&!b)return-1;if(!g&&b)return 1;const j=((null===(c=e.name)||void 0===c?void 0:c.toLowerCase())||"").startsWith(h)||(null===(m=e.VariantItem)||void 0===m||null===(p=m.variant_name)||void 0===p?void 0:p.toLowerCase().startsWith(h))||((null===(f=e.sku)||void 0===f?void 0:f.toLowerCase())||"").startsWith(h),A=((null===(x=t.name)||void 0===x?void 0:x.toLowerCase())||"").startsWith(h)||(null===(y=t.VariantItem)||void 0===y||null===(v=y.variant_name)||void 0===v?void 0:v.toLowerCase().startsWith(h))||((null===(_=t.sku)||void 0===_?void 0:_.toLowerCase())||"").startsWith(h);return j&&!A?-1:!j&&A?1:0})))||[];(0,n.useEffect)((()=>{_(0),N.length>0?y(N[0]._id):y(null)}),[u,i,d]),(0,n.useEffect)((()=>{i&&setTimeout((()=>{var e;null===(e=A.current)||void 0===e||e.focus()}),100)}),[i]);const T=[{title:"Product & Variant",dataIndex:"name",key:"name",width:250,render:(e,t)=>{var i,l;return(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{style:{fontWeight:600,color:"#1890ff"},children:e}),(null===(i=t.VariantItem)||void 0===i?void 0:i.variant_name)&&(0,S.jsxs)("div",{style:{fontSize:"12px",color:"#52c41a",marginTop:"2px"},children:["Variant: ",t.VariantItem.variant_name,(null===(l=t.VariantItem)||void 0===l?void 0:l.variant_code)&&(0,S.jsxs)("span",{style:{marginLeft:"8px",color:"#fa8c16",fontSize:"11px"},children:["(",t.VariantItem.variant_code,")"]})]})]})}},{title:"Variant",dataIndex:"VariantItem",key:"variant",width:120,render:e=>null!==e&&void 0!==e&&e.variant_name?(0,S.jsx)("span",{style:{color:"#52c41a",fontWeight:500},children:e.variant_name}):(0,S.jsx)("span",{style:{color:"#bfbfbf",fontStyle:"italic"},children:"No variant"})},{title:"SKU",dataIndex:"sku",key:"sku",width:120},{title:"Price",dataIndex:"selling_price",key:"selling_price",width:100,render:e=>(0,S.jsxs)("span",{style:{color:"#52c41a",fontWeight:600,fontSize:"14px"},children:["\u20b9",(null===e||void 0===e?void 0:e.toFixed(2))||"0.00"]})}],B=e=>{l(e)};return(0,S.jsxs)(x.A,{title:"Select Product & Variant (F5 to reopen anytime)",open:i,onCancel:o,width:900,footer:null,destroyOnClose:!0,children:[(0,S.jsxs)("div",{onClick:()=>{var e;null===(e=A.current)||void 0===e||e.focus()},children:[(0,S.jsxs)(h.A.Compact,{style:{marginBottom:16,width:"100%"},children:[(0,S.jsx)(D,{ref:A,placeholder:"Search by product name, variant, SKU, or price (use \u2191\u2193 arrows to navigate, Enter to select)",onChange:e=>p(e.target.value),style:{flex:1},autoFocus:!0,onKeyDown:e=>{var t;if(N.length)if("ArrowDown"===e.key)e.preventDefault(),_((e=>{const t=Math.min(e+1,N.length-1);return y(N[t]._id),t})),null===(t=A.current)||void 0===t||t.focus();else if("ArrowUp"===e.key){var i;e.preventDefault(),_((e=>{const t=Math.max(e-1,0);return y(N[t]._id),t})),null===(i=A.current)||void 0===i||i.focus()}else if("Enter"===e.key){e.preventDefault();const t=N[v];t&&B(t)}else"Escape"===e.key&&(e.preventDefault(),o())},onBlur:()=>{setTimeout((()=>{var e;i&&(null===(e=A.current)||void 0===e||e.focus())}),10)},value:u}),(0,S.jsx)(m.Ay,{type:"primary",icon:(0,S.jsx)(k.A,{}),onClick:()=>j(!0),style:{minWidth:100},children:"Scan"})]}),(0,S.jsx)(g.A,{dataSource:N,columns:T,loading:c,rowKey:"_id",size:"small",pagination:!1,onRow:(e,t)=>({onClick:()=>{B(e),setTimeout((()=>{var e;null===(e=A.current)||void 0===e||e.focus()}),10)},onDoubleClick:()=>B(e),className:t===v?"ant-table-row ant-table-row-selected":"ant-table-row",style:{backgroundColor:t===v?"#e6f7ff":void 0,border:t===v?"2px solid #1890ff":void 0}}),rowSelection:{type:"radio",selectedRowKeys:f?[f]:[],onChange:e=>{y(e[0]);const t=N.findIndex((t=>t._id===e[0]));-1!==t&&_(t)}},scroll:{y:300}}),(0,S.jsxs)("div",{style:{marginTop:16,fontSize:"12px",color:"#666"},children:[(0,S.jsx)("strong",{children:"Keyboard Shortcuts:"})," \u2191\u2193 Navigate products | Enter Select | Escape Cancel",(0,S.jsx)("br",{}),(0,S.jsx)("strong",{children:"Search:"})," Product name, variant name, SKU, or price",(0,S.jsx)("br",{}),(0,S.jsx)("strong",{children:"Barcode Scanner:"}),' Click "Scan" button or use USB barcode scanner',(0,S.jsx)("br",{}),(0,S.jsx)("strong",{children:"Tip:"})," Press F5 anytime to reopen this modal for product changes"]})]}),(0,S.jsx)(I.A,{visible:b,onClose:()=>j(!1),onScan:e=>{var t;p(e),j(!1);const i=null===d||void 0===d||null===(t=d.result)||void 0===t?void 0:t.find((t=>{var i,l,n,o;const a=e.toLowerCase();return((null===(i=t.sku)||void 0===i?void 0:i.toLowerCase())||"").includes(a)||((null===(l=t.name)||void 0===l?void 0:l.toLowerCase())||"").includes(a)||(null===(n=t.VariantItem)||void 0===n||null===(o=n.variant_code)||void 0===o?void 0:o.toLowerCase().includes(a))}));i?(setTimeout((()=>{l(i)}),500),r.Ay.success("Product found: ".concat(i.name))):r.Ay.warning("No product found with barcode: ".concat(e))},title:"Scan Product Barcode",description:"Scan barcode to find product automatically"})]})};var T=i(76399),B=i(39470),P=i(46237);const{Search:E}=y.A,L=e=>{var t;let{visible:i,onSelect:l,onCancel:o,productId:a}=e;const{getEntityApi:d}=(0,C.p)(),c=d("StockAudit"),{items:u,loading:m}=(0,w.Sm)(c.getIdentifier("GetAll")),[p,y]=(0,n.useState)(""),[v,_]=(0,n.useState)(null),[h,b]=(0,n.useState)(0),[j,A]=(0,n.useState)(""),k=(0,n.useRef)(null),I=(0,n.useRef)(null),D=e=>!(!e.expiry_date||!f()(e.expiry_date).isBefore(f()())),N=e=>e.available_quantity<=0,L=e=>{const t=f()(e.expiry_date).format("DD/MM/YYYY"),i="Cannot select expired stock! This item expired on ".concat(t,". Please select a valid stock item.");A(i),r.Ay.error(i),setTimeout((()=>{A("")}),5e3)},q=e=>{const t="Cannot select out of stock item! This item has 0 available quantity. Please select a stock item with available quantity.";A(t),r.Ay.error(t),setTimeout((()=>{A("")}),5e3)},G=(null===u||void 0===u||null===(t=u.result)||void 0===t?void 0:t.filter((e=>{var t,i,l,n,o,a,r,s;const d=p.toLowerCase();return(null===(t=e.batch_no)||void 0===t?void 0:t.toLowerCase().includes(d))||(null===(i=e.ProductItem)||void 0===i||null===(l=i.name)||void 0===l?void 0:l.toLowerCase().includes(d))||(null===(n=e.ProductItem)||void 0===n||null===(o=n.VariantItem)||void 0===o||null===(a=o.variant_name)||void 0===a?void 0:a.toLowerCase().includes(d))||(null===(r=e.available_quantity)||void 0===r?void 0:r.toString().includes(d))||(null===(s=e.sell_price)||void 0===s?void 0:s.toString().includes(d))})))||[];(0,n.useEffect)((()=>{if(b(0),A(""),G.length>0){let e=0;for(;e<G.length&&(G[e].expiry_date&&f()(G[e].expiry_date).isBefore(f()())||G[e].available_quantity<=0);)e++;e<G.length?(_(G[e]._id),b(e)):_(null)}else _(null)}),[p,i,u]),(0,n.useEffect)((()=>{i&&(A(""),setTimeout((()=>{var e;null===(e=I.current)||void 0===e||e.focus()}),0))}),[i]),(0,n.useEffect)((()=>{if(k.current){var e;const t=k.current.querySelector(".ant-table-row[data-row-key='".concat(null===(e=G[h])||void 0===e?void 0:e._id,"']"));null===t||void 0===t||t.scrollIntoView({block:"nearest"})}}),[h,G]),(0,n.useEffect)((()=>{i&&a&&c("GetAll",{product:a})}),[i,a,c]);const R=[{title:"Product",dataIndex:"ProductItem",key:"product",render:e=>(null===e||void 0===e?void 0:e.name)||"N/A"},{title:"Variant",dataIndex:"ProductItem",key:"variant",render:e=>{var t;return(null===e||void 0===e||null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)||"N/A"}},{title:"Batch No",dataIndex:"batch_no",key:"batch_no"},{title:"Available",dataIndex:"available_quantity",key:"available_quantity",render:(e,t)=>{const i=e<=0;return(0,S.jsxs)("span",{style:{color:i?"#ff4d4f":"#52c41a",fontWeight:i?"bold":"normal"},children:[e,i&&(0,S.jsx)(B.A,{style:{marginLeft:4,color:"#ff4d4f"}})]})}},{title:"Price",dataIndex:"sell_price",key:"sell_price"},{title:"Expiry Date",dataIndex:"expiry_date",key:"expiry_date",render:(e,t)=>{if(!e)return(0,S.jsx)("span",{style:{color:"#999"},children:"No Expiry"});const i=f()(e),l=f()(),n=i.isBefore(l),o=i.diff(l,"days");let a="green",r=(0,S.jsx)(P.A,{}),d="Valid";return n?(a="red",r=(0,S.jsx)(B.A,{}),d="Expired"):o<=30&&(a="orange",r=(0,S.jsx)(B.A,{}),d="Expires in ".concat(o," days")),(0,S.jsx)(s.A,{title:d,children:(0,S.jsx)(T.A,{color:a,icon:r,children:i.format("DD/MM/YYYY")})})}}],z=e=>{var t;D(e)?L(e):N(e)?q():(A(""),l({id:e._id,_id:e._id,batch_no:e.batch_no,name:(null===(t=e.ProductItem)||void 0===t?void 0:t.name)||e.name||"",code:e.code,available_quantity:e.available_quantity,sell_price:e.sell_price}))};return(0,S.jsx)(x.A,{title:"Select Stock (F7 to reopen anytime)",open:i,onCancel:o,width:800,footer:null,destroyOnClose:!0,children:(0,S.jsxs)("div",{onClick:()=>{var e;null===(e=I.current)||void 0===e||e.focus()},children:[(0,S.jsx)(E,{ref:I,placeholder:"Search stocks (use \u2191\u2193 arrows to navigate, Enter to select)",onChange:e=>y(e.target.value),style:{marginBottom:16},autoFocus:!0,onKeyDown:e=>{var t;if(G.length)if("ArrowDown"===e.key)e.preventDefault(),b((e=>{let t=e+1;for(;t<G.length&&(G[t].expiry_date&&f()(G[t].expiry_date).isBefore(f()())||G[t].available_quantity<=0);)t++;const i=Math.min(t,G.length-1);return _(G[i]._id),i})),null===(t=I.current)||void 0===t||t.focus();else if("ArrowUp"===e.key){var i;e.preventDefault(),b((e=>{let t=e-1;for(;t>=0&&(G[t].expiry_date&&f()(G[t].expiry_date).isBefore(f()())||G[t].available_quantity<=0);)t--;const i=Math.max(t,0);return _(G[i]._id),i})),null===(i=I.current)||void 0===i||i.focus()}else if("Enter"===e.key){e.preventDefault();const t=G[h];t&&(z(t),D(t)||N(t)||o())}},onBlur:()=>{setTimeout((()=>{var e;i&&(null===(e=I.current)||void 0===e||e.focus())}),10)}}),j&&(0,S.jsxs)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#cf1322",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsx)(B.A,{style:{color:"#cf1322"}}),j]}),(0,S.jsxs)("div",{onKeyDown:e=>{var t;if(G.length)if("ArrowDown"===e.key)e.preventDefault(),b((e=>{let t=e+1;for(;t<G.length&&(G[t].expiry_date&&f()(G[t].expiry_date).isBefore(f()())||G[t].available_quantity<=0);)t++;const i=Math.min(t,G.length-1);return _(G[i]._id),i})),null===(t=I.current)||void 0===t||t.focus();else if("ArrowUp"===e.key)e.preventDefault(),b((e=>{let t=e-1;for(;t>=0&&(G[t].expiry_date&&f()(G[t].expiry_date).isBefore(f()())||G[t].available_quantity<=0);)t--;const i=Math.max(t,0);return _(G[i]._id),i}));else if("Enter"===e.key){e.preventDefault();const t=G[h];t&&(z(t),D(t)||N(t)||o())}else if("Escape"===e.key){var i;e.preventDefault(),null===(i=I.current)||void 0===i||i.focus()}else if("Tab"===e.key&&e.shiftKey){var l;e.preventDefault(),null===(l=I.current)||void 0===l||l.focus()}},tabIndex:0,ref:k,style:{outline:"none"},children:[(0,S.jsx)(g.A,{dataSource:G,columns:R,loading:m,rowKey:"_id",size:"small",pagination:!1,title:()=>(0,S.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0"},children:[(0,S.jsx)("span",{children:"Stock Items"}),(0,S.jsxs)("div",{style:{fontSize:"12px",color:"#666"},children:[(0,S.jsx)("span",{style:{color:"#52c41a"},children:"\ud83d\udfe2 Valid"}),(0,S.jsx)("span",{style:{margin:"0 8px",color:"#faad14"},children:"\ud83d\udfe0 Near Expiry"}),(0,S.jsx)("span",{style:{color:"#ff4d4f"},children:"\ud83d\udd34 Expired/Out of Stock (Disabled)"})]})]}),onRow:(e,t)=>{const i=D(e),l=N(e);return{onClick:()=>{i||l?i?L(e):l&&q():(z(e),setTimeout((()=>{var e;null===(e=I.current)||void 0===e||e.focus()}),10))},onDoubleClick:()=>{i||l?i?L(e):l&&q():z(e)},className:t===h?"ant-table-row ant-table-row-selected":"ant-table-row","data-row-key":e._id,style:{opacity:i||l?.6:1,cursor:i||l?"not-allowed":"pointer",backgroundColor:i||l?"#f5f5f5":void 0}}},rowSelection:{type:"radio",selectedRowKeys:v?[v]:[],onChange:e=>{_(e[0]);const t=G.findIndex((t=>t._id===e[0]));-1!==t&&b(t)},getCheckboxProps:e=>({disabled:D(e)||N(e)})}}),(0,S.jsxs)("div",{style:{marginTop:16,fontSize:"12px",color:"#666"},children:[(0,S.jsx)("strong",{children:"Keyboard Shortcuts:"})," \u2191\u2193 Navigate stocks | Enter Select | Escape Cancel",(0,S.jsx)("br",{}),(0,S.jsx)("strong",{children:"Tip:"})," Press F7 anytime to reopen this modal for stock changes",(0,S.jsx)("br",{}),(0,S.jsx)("strong",{children:"Note:"})," Expired items (\ud83d\udd34) and out of stock items (\ud83d\udd34) are shown but cannot be selected. Navigation automatically skips expired and out of stock items.",(0,S.jsx)("br",{}),(0,S.jsx)("strong",{children:"Error Handling:"})," Attempting to select expired or out of stock items will show an error message and prevent selection."]})]})]})})},{Text:q}=a.A,G=e=>{let{columns:t,dataSource:i,onSave:o,onAdd:a,onDelete:s,allowAdd:c=!0,allowDelete:u=!0,rowKey:p="key",loading:k=!1,compact:C=!1,enableKeyboardNav:w=!0,size:I="middle",className:D,onProductSelect:T,externalEditingCell:B}=e;const[P,E]=(0,n.useState)([]),[G,R]=(0,n.useState)([]),[z,M]=(0,n.useState)(null),V=(0,n.useRef)(!0);(0,n.useEffect)((()=>{E(i);const e=t.findIndex((e=>"product_id"===e.dataIndex));V.current&&0===i.length&&e>=0?(M({row:0,col:e}),V.current=!1):R(i.length>0?[String(i.length-1)]:[])}),[i,t]),(0,n.useEffect)((()=>{B&&M(B)}),[B]);const F=()=>{null===a||void 0===a||a();const e=t.findIndex((e=>!1!==e.editable));e>=0&&M({row:P.length,col:e})},Y=(e,i,l)=>{const n=t[i];if(n.required&&(!l||""===l))return r.Ay.error("".concat(n.title," is required")),!1;if(n.validation){const e=n.validation(l);if(e)return r.Ay.error(e),!1}const a=[...P];return a[e][t[i].dataIndex]=l,E(a),o(a),!0};(0,n.useEffect)((()=>{const e=e=>{e.ctrlKey&&"s"===e.key&&(e.preventDefault(),o(P)),e.shiftKey&&"a"===e.key.toLowerCase()&&c&&(e.preventDefault(),F())};if(w)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[P,c,o,w,F]);const U={onChange:(e,t)=>{R([...e])}};function K(e,t,i){let l=e+t;for(;l>=0&&l<i.length;){if(!1!==i[l].editable)return l;l+=t}return-1}const W=e=>{var i,l;let{row:a,col:s,value:u}=e;const[m,p]=(0,n.useState)(u),x=(0,n.useRef)(null),h=t[s],[g,b]=(0,n.useState)(!1),[j,A]=(0,n.useState)(!1);(0,n.useEffect)((()=>{p(u),setTimeout((()=>{var e;null===(e=x.current)||void 0===e||e.focus()}),50)}),[u]);const k=e=>{p(e),Y(a,s,e)},C=e=>{if("product"===h.type&&"Enter"===e.key)return e.stopPropagation(),void b(!0);if("stock"===h.type&&"Enter"===e.key)return e.stopPropagation(),void A(!0);if("Tab"===e.key){if(e.preventDefault(),h.required&&(!m||""===m))return void r.Ay.error("".concat(h.title," is required"));const i=e.shiftKey?s-1:s+1,l=a+(i>=t.length?1:0),n=(i+t.length)%t.length;l<P.length?M({row:l,col:n}):c&&(F(),M({row:P.length,col:n}))}else"Escape"===e.key&&M(null)},w=e=>{T&&T(e,a),b(!1),M(null)},I=e=>{const t=[...P];t[a].stock_id=e.id||e._id||"",t[a].batch_no=e.batch_no||"",E(t),o(t),A(!1),M(null)};switch(h.type){case"product":return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,S.jsx)(y.A,{ref:x,value:m,onKeyDown:C,placeholder:"Press Enter to select product"})}),g&&(0,S.jsx)(N,{visible:g,onSelect:w,onCancel:()=>b(!1)})]});case"stock":return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,S.jsx)(y.A,{ref:x,value:(null===(i=P[a])||void 0===i?void 0:i.batch_no)||m,onKeyDown:C,placeholder:"Press Enter to select stock",readOnly:!0})}),j&&(0,S.jsx)(L,{visible:j,onSelect:I,onCancel:()=>A(!1),productId:(null===(l=P[a])||void 0===l?void 0:l.product_id)||""})]});case"number":return(0,S.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,S.jsx)(d.A,{ref:x,value:m,onChange:k,onBlur:()=>M(null),controls:!1,onKeyDown:e=>{if("Tab"===e.key||"Enter"===e.key){if(e.preventDefault(),h.required&&(!m||""===m))return void r.Ay.error("".concat(h.title," is required"));const i=e.shiftKey?-1:1,l=K(s,i,t);if(-1!==l)M({row:a,col:l});else{const e=i>0?a+1:a-1;if(e>=0&&e<P.length){const i=K(-1,1,t);-1!==i&&M({row:e,col:i})}else if(i>0&&c){F();const e=K(-1,1,t);-1!==e&&M({row:P.length,col:e})}else M(null)}}else"Escape"===e.key&&M(null)},style:{width:"100%"}})});case"select":return(0,S.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,S.jsx)(v.A,{ref:x,value:m,options:h.options,onChange:e=>{if(Y(a,s,e)){const e=s+1,i=a+(e>=t.length?1:0),l=(e+t.length)%t.length;i<P.length?M({row:i,col:l}):c&&(F(),M({row:P.length,col:l}))}else setTimeout((()=>{var e;null===(e=x.current)||void 0===e||e.focus()}),50)},style:{width:"100%"},onKeyDown:e=>{"Enter"!==e.key&&"Tab"!==e.key||e.preventDefault()}})});case"date":return(0,S.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,S.jsx)(_.A,{ref:x,value:m?f()(m):null,onChange:e=>{k(e?e.format("YYYY-MM-DD"):null),M(null)},onBlur:()=>M(null),onKeyDown:C,style:{width:"100%"}})});default:return(0,S.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,S.jsx)(y.A,{ref:x,value:m,onChange:e=>k(e.target.value),onBlur:()=>M(null),onKeyDown:C})})}},O=t.map(((e,t)=>(0,l.A)((0,l.A)({},e),{},{onCell:(e,i)=>({onClick:()=>{"number"===typeof i&&M({row:i,col:t})},onContextMenu:e=>{e.preventDefault(),"number"===typeof i&&M({row:i,col:t})}}),render:(i,l,n)=>{if(z&&z.row===n&&z.col===t)return(0,S.jsx)(W,{row:n,col:t,value:l[e.dataIndex]},"".concat(n,"-").concat(t));if("function"===typeof e.render)return e.render(i,l,n);if("batch_no"===e.dataIndex)return l.batch_no||l[e.dataIndex];if("product_id"===e.dataIndex)return l.product_name||l[e.dataIndex];if("select"===e.type&&e.options){const t=e.options.find((t=>t.value===l[e.dataIndex]));return t?t.label:l[e.dataIndex]}return l[e.dataIndex]}})));return(0,S.jsxs)("div",{className:"antd-editable-table ".concat(C?"compact":""," ").concat(D||""),children:[(0,S.jsxs)("div",{className:"table-toolbar",children:[(0,S.jsxs)(h.A,{children:[c&&(0,S.jsx)(m.Ay,{type:"primary",icon:(0,S.jsx)(b.A,{}),onClick:F,children:"Add Row (Shift+A)"}),u&&(0,S.jsx)(m.Ay,{danger:!0,icon:(0,S.jsx)(j.A,{}),onClick:()=>{0!==P.length?x.A.confirm({title:"Are you sure you want to delete the selected Bill Items?",onOk:()=>{const e=P.slice(0,-1);E(e),o(e),null===s||void 0===s||s(G)}}):r.Ay.warning("No rows to delete")},children:"Delete Row"}),(0,S.jsx)(m.Ay,{type:"primary",icon:(0,S.jsx)(A.A,{}),onClick:()=>o(P),children:"Save (Ctrl+S)"})]}),(0,S.jsx)(q,{type:"secondary",className:"table-info",children:"Use Tab / Shift+Tab to navigate cells"})]}),(0,S.jsx)(g.A,{bordered:!0,dataSource:P,columns:O,rowKey:p,loading:k,pagination:!1,size:I,scroll:{y:400},rowSelection:(0,l.A)((0,l.A)({},U),{},{type:"checkbox",selectedRowKeys:G})})]})};var R=i(83003),z=i(28665),M=i(94265);const V=e=>{(0,R.wA)();const t=(0,n.useMemo)((()=>(0,z.yo)(e)),[e]),i=(0,n.useMemo)((()=>{const t=M.QQ[e];if(!t||"object"!==typeof t||!("GetAll"in t))throw new Error("Entity ".concat(e," not found in API_ROUTES or doesn't follow CRUD pattern"));return t}),[e]);return{useGetAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=t.useGetQuery(e);return(0,l.A)((0,l.A)({},i),{},{refetch:i.refetch})},useGetById:function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t.useGetByIdQuery((0,l.A)({id:e},i));return(0,l.A)((0,l.A)({},n),{},{refetch:n.refetch})},useCreate:()=>{const[e,i]=t.useCreateMutation(),o=(0,n.useCallback)((async t=>{try{return{data:await e(t).unwrap(),error:null}}catch(i){return{data:null,error:i}}}),[e]);return(0,l.A)({create:o},i)},useUpdate:()=>{const[e,i]=t.useUpdateMutation(),o=(0,n.useCallback)((async(t,i)=>{try{return{data:await e({id:t,data:i}).unwrap(),error:null}}catch(l){return{data:null,error:l}}}),[e]);return(0,l.A)({update:o},i)},useDelete:()=>{const[e,i]=t.useDeleteMutation(),o=(0,n.useCallback)((async t=>{try{return{data:await e(t).unwrap(),error:null}}catch(i){return{data:null,error:i}}}),[e]);return(0,l.A)({delete:o,remove:o},i)},getRoutes:(0,n.useCallback)((()=>({getAll:i.GetAll,get:i.Get,create:i.Create,update:i.Update,delete:i.Delete})),[i]),entityName:e,entityRoutes:i}};var F=i(36091),Y=i(93310),U=i(94834),K=i(62305),W=i(47419),O=i(11645),H=i(8354),Q=i(87534),X=i(75388),J=i(46011),Z=i(72411),$=i(67177),ee=i(15615),te=i(53722),ie=i(94211);const{Title:le,Text:ne}=a.A,{Option:oe}=v.A,ae=e=>{let{visible:t,onSelect:i,onCancel:o}=e;const{getEntityApi:a}=(0,C.p)(),s=a("Customer"),{items:d,loading:c}=(0,w.Sm)(s.getIdentifier("GetAll")),{loading:u}=(0,w.Sm)(s.getIdentifier("Create")),p=(null===d||void 0===d?void 0:d.items)||(null===d||void 0===d?void 0:d.result)||[],[f,v]=(0,n.useState)(""),[_,j]=(0,n.useState)(!1),[k,I]=(0,n.useState)(null),[D,N]=(0,n.useState)(-1),[B,P]=(0,n.useState)(!1),[E,L]=(0,n.useState)({full_name:"",email:"",mobile:"",address:"",customer_type:"regular"}),[q]=K.A.useForm(),G=(0,n.useRef)(null),R=(0,n.useRef)(null),z=(0,n.useRef)(null),M=(0,n.useRef)(null),V=(0,n.useRef)(null),F=(0,n.useMemo)((()=>p),[p]),Y=(0,n.useMemo)((()=>f.trim()&&!c&&0===F.length),[f,c,F.length]),U=(0,n.useCallback)((e=>({vip:"gold",wholesale:"blue",regular:"green"}[e]||"green")),[]),oe=(0,n.useCallback)((e=>{if(0===F.length)return;let t;switch(e){case"up":t=-1===D?F.length-1:Math.max(D-1,0);break;case"down":t=-1===D?0:Math.min(D+1,F.length-1);break;case"home":t=0;break;case"end":t=F.length-1;break;default:return}N(t),I(F[t]),setTimeout((()=>{const i=document.querySelector('[data-row-key="'.concat(F[t]._id,'"]'));if(i){const t="home"===e?"start":"end"===e?"end":"nearest";i.scrollIntoView({behavior:"smooth",block:t})}}),100)}),[F,D]),ae=(0,n.useCallback)((e=>{v(e),z.current&&clearTimeout(z.current),z.current=setTimeout((()=>{e.trim()?s("GetAll",{searchString:e.trim()}):s("GetAll")}),500)}),[s]),re=(0,n.useCallback)((e=>{I(e),i(e),setTimeout((()=>o()),100)}),[i,o]),se=(0,n.useCallback)((async()=>{try{if(!E.full_name.trim())return void r.Ay.error("Full name is required");if(!E.mobile.trim())return void r.Ay.error("Mobile number is required");await s("Create",E)}catch(e){r.Ay.error("Failed to create customer"),de()}}),[E,s]),de=(0,n.useCallback)((()=>{L({full_name:"",email:"",mobile:"",address:"",customer_type:"regular"}),q.resetFields()}),[q]),ce=(0,n.useCallback)(((e,t)=>{L((i=>(0,l.A)((0,l.A)({},i),{},{[e]:t})))}),[]),ue=(0,n.useCallback)((e=>{if("Escape"===e.key)o();else if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();oe({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}),[oe,o]),me=(0,n.useCallback)((e=>{if(!t)return;const i=e.target;if("INPUT"!==i.tagName&&"TEXTAREA"!==i.tagName&&!i.classList.contains("ant-select-selector")&&!i.closest(".ant-select-dropdown")){if(e.ctrlKey&&"f"===e.key)return e.preventDefault(),e.stopPropagation(),void(G.current&&(G.current.focus(),G.current.select()));if(e.ctrlKey&&"n"===e.key)return e.preventDefault(),e.stopPropagation(),void(Y&&(P(!0),setTimeout((()=>{if(M.current){const e=M.current.querySelector("input");e&&(e.focus(),e.select())}}),100)));if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();oe({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}}),[t,oe,Y]),pe=(0,n.useMemo)((()=>[{title:"",key:"select",width:60,render:(e,t)=>(0,S.jsx)("div",{style:{cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>{I(t);const e=F.findIndex((e=>e._id===t._id));N(e)},children:(0,S.jsx)("div",{style:{width:"18px",height:"18px",borderRadius:"50%",border:(null===k||void 0===k?void 0:k._id)===t._id?"2px solid #1890ff":"2px solid #d9d9d9",backgroundColor:(null===k||void 0===k?void 0:k._id)===t._id?"#1890ff":"white",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:(null===k||void 0===k?void 0:k._id)===t._id&&(0,S.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"white"}})})})},{title:"Customer Name",dataIndex:"full_name",key:"full_name",render:(e,t)=>(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,S.jsx)(ne,{strong:!0,children:e}),(0,S.jsx)(T.A,{color:U(t.customer_type),children:t.customer_type.toUpperCase()})]})},{title:"Mobile",dataIndex:"mobile",key:"mobile",render:e=>(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,S.jsx)(Q.A,{style:{color:"#666"}}),(0,S.jsx)(ne,{children:e})]})},{title:"Email",dataIndex:"email",key:"email",render:e=>(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,S.jsx)(X.A,{style:{color:"#666"}}),(0,S.jsx)(ne,{children:e||"-"})]})},{title:"Address",dataIndex:"address",key:"address",render:e=>(0,S.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[(0,S.jsx)(J.A,{style:{color:"#666",marginTop:"2px"}}),(0,S.jsx)(ne,{type:"secondary",style:{fontSize:"12px"},children:e||"-"})]})}]),[k,F,U]),fe=(0,n.useCallback)(((e,t)=>({onClick:()=>{I(e),N(null!==t&&void 0!==t?t:0)},style:{cursor:"pointer",backgroundColor:(null===k||void 0===k?void 0:k._id)===e._id?"#f0f8ff":"white",border:(null===k||void 0===k?void 0:k._id)===e._id?"2px solid #1890ff":"1px solid #f0f0f0",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:t=>{(null===k||void 0===k?void 0:k._id)!==e._id&&(t.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:t=>{(null===k||void 0===k?void 0:k._id)!==e._id&&(t.currentTarget.style.backgroundColor="white")}})),[k]);(0,n.useEffect)((()=>(t?(s("GetAll"),I(null),N(-1),P(!1)):(v(""),I(null),N(-1),P(!1),j(!1),de(),z.current&&(clearTimeout(z.current),z.current=null)),()=>{z.current&&clearTimeout(z.current)})),[t,s,de]),(0,n.useEffect)((()=>{!Y||B||_||P(!0)}),[Y,B,_]),(0,n.useEffect)((()=>{if(t&&G.current&&!_&&!B){const e=()=>{G.current&&(G.current.focus(),G.current.select())};e();const t=setTimeout(e,100);return()=>clearTimeout(t)}}),[t,_,B]),(0,n.useEffect)((()=>{if((_||B)&&t){const e=setTimeout((()=>{V.current&&(V.current.focus(),V.current.select())}),100);return()=>clearTimeout(e)}}),[_,B,t]),(0,n.useEffect)((()=>{if(t)return document.addEventListener("keydown",me,!0),()=>document.removeEventListener("keydown",me,!0)}),[t,me]),(0,ie.z)({action:"create",title:"Customer",identifier:s.getIdentifier("Create"),entityApi:s});const{items:xe}=(0,w.Sm)(s.getIdentifier("Create"));(0,n.useEffect)((()=>{u?r.Ay.loading({content:"Creating customer...",key:"customer-creation",duration:0}):r.Ay.destroy("customer-creation")}),[u]),(0,n.useEffect)((()=>{if(xe)if(200===xe.statusCode){const e=xe.data||xe.result;e&&(de(),j(!1),P(!1),s("GetAll"),setTimeout((()=>{i(e),o()}),100))}else xe.statusCode&&200!==xe.statusCode&&(r.Ay.error(xe.message||"Failed to create customer"),de())}),[xe,i,o,s,de]);const ye=(0,n.useCallback)((()=>{I(null),N(-1)}),[]);return(0,S.jsxs)(x.A,{title:"Select Customer",open:t,onCancel:o,footer:null,width:1e3,style:{top:20},afterOpenChange:e=>{e&&G.current&&!_&&!B&&setTimeout((()=>{var e,t;null===(e=G.current)||void 0===e||e.focus(),null===(t=G.current)||void 0===t||t.select()}),100)},children:[(0,S.jsx)("div",{ref:R,style:{marginBottom:16},onKeyDown:ue,tabIndex:0,children:(0,S.jsxs)(h.A.Compact,{style:{width:"100%"},children:[(0,S.jsx)(y.A,{ref:G,placeholder:"Search customers... (Ctrl+N: New customer, \u2191\u2193: Navigate, Enter: Select, Esc: Close)",value:f,onChange:e=>ae(e.target.value),prefix:(0,S.jsx)(Z.A,{}),style:{flex:1},onKeyDown:e=>{"Enter"===e.key&&k&&re(k)},onFocus:ye,autoFocus:!_&&!B,onBlur:_||B?void 0:()=>{t&&G.current&&setTimeout((()=>{t&&G.current&&!_&&!B&&G.current.focus()}),10)},suffix:f&&c?(0,S.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:"Searching..."}):null}),(0,S.jsx)(m.Ay,{type:_?"default":"primary",icon:(0,S.jsx)($.A,{}),onClick:()=>{const e=!_;j(e),e||de()},style:{minWidth:120},children:_?"Cancel":"Add New"})]})}),(B||_)&&(0,S.jsxs)("div",{ref:M,style:{marginBottom:20,padding:24,border:"2px solid #6366f1",borderRadius:16,backgroundColor:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",overflow:"hidden"},tabIndex:-1,children:[(0,S.jsx)("div",{style:{position:"absolute",top:-20,right:-20,width:100,height:100,borderRadius:"50%",background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",opacity:.1,zIndex:0}}),(0,S.jsx)("div",{style:{position:"absolute",bottom:-30,left:-30,width:80,height:80,borderRadius:"50%",background:"linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)",opacity:.1,zIndex:0}}),(0,S.jsxs)(W.A,{justify:"space-between",align:"middle",style:{marginBottom:24,position:"relative",zIndex:1},children:[(0,S.jsxs)(O.A,{children:[(0,S.jsxs)(le,{level:4,style:{margin:0,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",fontWeight:700,fontSize:"20px"},children:[(0,S.jsx)(b.A,{style:{marginRight:8,color:"#6366f1"}}),"Create New Customer"]}),(0,S.jsx)(ne,{style:{fontSize:"14px",color:"#64748b",fontWeight:500,display:"block",marginTop:4},children:"\u2728 Fill in the details below to create a new customer"})]}),(0,S.jsx)(O.A,{children:(0,S.jsxs)(h.A,{size:"middle",children:[(0,S.jsx)(m.Ay,{size:"middle",icon:(0,S.jsx)(ee.A,{}),onClick:()=>{P(!1),j(!1),s("GetAll"),de()},style:{border:"2px solid #e2e8f0",borderRadius:8,fontWeight:600,color:"#64748b",background:"white",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",height:40,padding:"0 20px"},children:"Cancel"}),(0,S.jsx)(m.Ay,{type:"primary",size:"middle",icon:(0,S.jsx)(A.A,{}),onClick:se,loading:u,style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none",borderRadius:8,fontWeight:600,height:40,padding:"0 24px",boxShadow:"0 4px 12px rgba(99, 102, 241, 0.3)",transition:"all 0.3s ease"},children:"Create & Select"})]})})]}),(0,S.jsxs)(K.A,{form:q,layout:"vertical",size:"middle",style:{position:"relative",zIndex:1},children:[(0,S.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginBottom:20},children:[(0,S.jsx)(K.A.Item,{name:"full_name",label:(0,S.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,S.jsx)(te.A,{style:{color:"#6366f1"}}),"Full Name"]}),rules:[{required:!0,message:"Please enter full name"}],children:(0,S.jsx)(y.A,{ref:V,name:"full_name",placeholder:"Enter full name",prefix:(0,S.jsx)(te.A,{style:{color:"#9ca3af"}}),autoFocus:_||B,value:E.full_name,onChange:e=>ce("full_name",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),se())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white"}})}),(0,S.jsx)(K.A.Item,{name:"mobile",label:(0,S.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,S.jsx)(Q.A,{style:{color:"#10b981"}}),"Mobile Number"]}),rules:[{required:!0,message:"Please enter mobile number"},{pattern:/^[0-9]{10}$/,message:"Mobile must be 10 digits"}],children:(0,S.jsx)(y.A,{name:"mobile",placeholder:"Enter mobile number",prefix:(0,S.jsx)(Q.A,{style:{color:"#9ca3af"}}),value:E.mobile,onChange:e=>ce("mobile",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),se())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white"}})}),(0,S.jsx)(K.A.Item,{name:"email",label:(0,S.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,S.jsx)(X.A,{style:{color:"#f59e0b"}}),"Email"]}),rules:[{type:"email",message:"Please enter valid email"}],children:(0,S.jsx)(y.A,{name:"email",placeholder:"Enter email",prefix:(0,S.jsx)(X.A,{style:{color:"#9ca3af"}}),value:E.email,onChange:e=>ce("email",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),se())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white"}})})]}),(0,S.jsx)(K.A.Item,{name:"address",label:(0,S.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,S.jsx)(J.A,{style:{color:"#ef4444"}}),"Address"]}),children:(0,S.jsx)(y.A.TextArea,{name:"address",placeholder:"Enter address",rows:3,value:E.address,onChange:e=>ce("address",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),se())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white",resize:"none"}})})]})]}),(0,S.jsx)(H.A,{style:{margin:"16px 0"}}),(0,S.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:c?(0,S.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,S.jsx)(ne,{children:"Loading customers..."})}):0===F.length?(0,S.jsxs)("div",{style:{textAlign:"center",padding:40},children:[(0,S.jsx)(ne,{type:"secondary",children:f?"No customers found matching your search.":"No customers available."}),f&&(0,S.jsx)("div",{style:{marginTop:16},children:(0,S.jsx)(ne,{type:"secondary",children:"Press Ctrl+N to create a new customer instantly"})})]}):(0,S.jsx)(g.A,{columns:pe,dataSource:F,rowKey:"_id",pagination:!1,size:"small",scroll:{y:300},onRow:fe})})]})},re=n.memo(ae),{Title:se,Text:de}=a.A,ce=e=>{let{visible:t,onSelect:i,onCancel:l}=e;const{getEntityApi:a}=(0,C.p)(),r=a("BillingUsers"),{items:s,loading:d}=(0,w.Sm)(r.getIdentifier("GetAll")),c=(null===s||void 0===s?void 0:s.items)||(null===s||void 0===s?void 0:s.result)||[],[u,m]=(0,n.useState)(""),[p,f]=(0,n.useState)(null),[v,_]=(0,n.useState)(-1),h=(0,n.useMemo)((()=>(0,o.HW)()),[]),b=(0,n.useRef)(null),j=(0,n.useRef)(null),A=(0,n.useRef)(null),k=(0,n.useMemo)((()=>{if(!u.trim())return c;const e=u.toLowerCase();return c.filter((t=>{var i,l,n,o,a,r;return(null===(i=t.name)||void 0===i?void 0:i.toLowerCase().includes(e))||(null===(l=t.email)||void 0===l?void 0:l.toLowerCase().includes(e))||(null===(n=t.mobile)||void 0===n?void 0:n.toLowerCase().includes(e))||(null===(o=t.user_name)||void 0===o?void 0:o.toLowerCase().includes(e))||(null===(a=t.roleItems)||void 0===a||null===(r=a.name)||void 0===r?void 0:r.toLowerCase().includes(e))}))}),[c,u]),I=(0,n.useCallback)((e=>{if(0===k.length)return;let t;switch(e){case"up":t=-1===v?k.length-1:Math.max(v-1,0);break;case"down":t=-1===v?0:Math.min(v+1,k.length-1);break;case"home":t=0;break;case"end":t=k.length-1;break;default:return}_(t),f(k[t]),setTimeout((()=>{const i=document.querySelector('[data-row-key="'.concat(k[t]._id,'"]'));if(i){const t="home"===e?"start":"end"===e?"end":"nearest";i.scrollIntoView({behavior:"smooth",block:t})}}),100)}),[k,v]),D=(0,n.useCallback)((e=>{m(e),A.current&&clearTimeout(A.current),A.current=setTimeout((()=>{e.trim()?r("GetAll",{searchString:e.trim()}):r("GetAll")}),300)}),[r]),N=(0,n.useCallback)((e=>{f(e),i(e),setTimeout((()=>l()),100)}),[i,l]),B=(0,n.useCallback)((e=>{if("Escape"===e.key)l();else if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();I({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}),[I,l]),P=(0,n.useCallback)((e=>{if(!t)return;const i=e.target;if("INPUT"!==i.tagName&&"TEXTAREA"!==i.tagName&&!i.classList.contains("ant-select-selector")&&!i.closest(".ant-select-dropdown")){if(e.ctrlKey&&"f"===e.key)return e.preventDefault(),e.stopPropagation(),void(b.current&&(b.current.focus(),b.current.select()));if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();I({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}}),[t,I]),E=(0,n.useMemo)((()=>[{title:"",key:"select",width:60,render:(e,t)=>(0,S.jsx)("div",{style:{cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>{f(t);const e=k.findIndex((e=>e._id===t._id));_(e)},children:(0,S.jsx)("div",{style:{width:"18px",height:"18px",borderRadius:"50%",border:(null===p||void 0===p?void 0:p._id)===t._id?"2px solid #1890ff":"2px solid #d9d9d9",backgroundColor:(null===p||void 0===p?void 0:p._id)===t._id?"#1890ff":"white",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:(null===p||void 0===p?void 0:p._id)===t._id&&(0,S.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"white"}})})})},{title:"Name",dataIndex:"name",key:"name",render:(e,t)=>(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,S.jsx)(te.A,{style:{color:"#1890ff"}}),(0,S.jsxs)("div",{children:[(0,S.jsx)(de,{strong:!0,children:e}),(0,S.jsx)("br",{}),(0,S.jsxs)(de,{type:"secondary",style:{fontSize:"12px"},children:["@",t.user_name]})]})]})},{title:"Role",key:"role",render:(e,t)=>{var i;return(0,S.jsx)(T.A,{color:"blue",children:(null===(i=t.roleItems)||void 0===i?void 0:i.name)||"No Role"})}},{title:"Mobile",dataIndex:"mobile",key:"mobile",render:e=>(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,S.jsx)(Q.A,{style:{color:"#666"}}),(0,S.jsx)(de,{children:e})]})},{title:"Email",dataIndex:"email",key:"email",render:e=>(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,S.jsx)(X.A,{style:{color:"#666"}}),(0,S.jsx)(de,{children:e||"-"})]})},{title:"Branch",key:"branch",render:(e,t)=>{var i;return(0,S.jsx)(de,{type:"secondary",style:{fontSize:"12px"},children:(null===(i=t.branchItems)||void 0===i?void 0:i.branch_name)||"-"})}}]),[p,k]),L=(0,n.useCallback)(((e,t)=>({onClick:()=>{f(e),_(null!==t&&void 0!==t?t:0)},style:{cursor:"pointer",backgroundColor:(null===p||void 0===p?void 0:p._id)===e._id?"#f0f8ff":"white",border:(null===p||void 0===p?void 0:p._id)===e._id?"2px solid #1890ff":"1px solid #f0f0f0",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:t=>{(null===p||void 0===p?void 0:p._id)!==e._id&&(t.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:t=>{(null===p||void 0===p?void 0:p._id)!==e._id&&(t.currentTarget.style.backgroundColor="white")}})),[p]);(0,n.useEffect)((()=>(t?(r("GetAll"),f(null),_(-1)):(m(""),f(null),_(-1),A.current&&(clearTimeout(A.current),A.current=null)),()=>{A.current&&clearTimeout(A.current)})),[t,r]),(0,n.useEffect)((()=>{if(t&&c.length>0&&null!==h&&void 0!==h&&h._id&&!p){const e=c.find((e=>e._id===h._id));if(e){f(e);const t=c.findIndex((e=>e._id===h._id));_(t),setTimeout((()=>{const t=document.querySelector('[data-row-key="'.concat(e._id,'"]'));t&&t.scrollIntoView({behavior:"smooth",block:"center"})}),200)}}}),[t,c,null===h||void 0===h?void 0:h._id,p]),(0,n.useEffect)((()=>{if(t&&b.current){const e=()=>{b.current&&(b.current.focus(),b.current.select())};e();const t=setTimeout(e,100);return()=>clearTimeout(t)}}),[t]),(0,n.useEffect)((()=>{if(t)return document.addEventListener("keydown",P,!0),()=>document.removeEventListener("keydown",P,!0)}),[t,P]);const q=(0,n.useCallback)((()=>{f(null),_(-1)}),[]);return(0,S.jsxs)(x.A,{title:"Select User (Billed By)",open:t,onCancel:l,footer:null,width:900,style:{top:20},afterOpenChange:e=>{e&&b.current&&setTimeout((()=>{var e,t;null===(e=b.current)||void 0===e||e.focus(),null===(t=b.current)||void 0===t||t.select()}),100)},children:[(0,S.jsx)("div",{ref:j,style:{marginBottom:16},onKeyDown:B,tabIndex:0,children:(0,S.jsx)(y.A,{ref:b,placeholder:"Search users... (\u2191\u2193: Navigate, Enter: Select, Esc: Close)",value:u,onChange:e=>D(e.target.value),prefix:(0,S.jsx)(Z.A,{}),style:{width:"100%"},onKeyDown:e=>{"Enter"===e.key&&p&&N(p)},onFocus:q,autoFocus:!0,onBlur:()=>{t&&b.current&&setTimeout((()=>{t&&b.current&&b.current.focus()}),10)},suffix:u&&d?(0,S.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:"Searching..."}):null})}),(0,S.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:d?(0,S.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,S.jsx)(de,{children:"Loading users..."})}):0===k.length?(0,S.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,S.jsx)(de,{type:"secondary",children:u?"No users found matching your search.":"No users available."})}):(0,S.jsx)(g.A,{columns:E,dataSource:k,rowKey:"_id",pagination:!1,size:"small",scroll:{y:300},onRow:L})})]})};var ue=i(6881),me=i(76401);const{Title:pe,Text:fe}=a.A,xe=e=>{let{visible:t,onNewBill:i,onContinueBill:l,onCancel:n,savedBillData:o}=e;return(0,S.jsxs)(x.A,{title:(0,S.jsxs)("div",{style:{textAlign:"center"},children:[(0,S.jsx)(P.A,{style:{color:"#52c41a",fontSize:"24px",marginRight:"8px"}}),(0,S.jsx)("span",{style:{color:"#52c41a",fontWeight:600},children:"Bill Saved Successfully!"})]}),open:t,onCancel:n,footer:null,width:500,centered:!0,maskClosable:!1,closable:!1,children:[(0,S.jsx)("div",{style:{textAlign:"center",marginBottom:"24px"},children:(0,S.jsx)(fe,{type:"secondary",children:"Your bill has been saved successfully. What would you like to do next?"})}),o&&(0,S.jsxs)("div",{style:{background:"linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)",border:"1px solid #0ea5e9",borderRadius:"8px",padding:"16px",marginBottom:"24px"},children:[(0,S.jsx)(pe,{level:5,style:{marginBottom:"12px",color:"#0369a1"},children:"\ud83d\udccb Bill Summary"}),(0,S.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsx)(F.A,{style:{color:"#0ea5e9"}}),(0,S.jsxs)(fe,{strong:!0,children:["Invoice: ",o.invoice_no]})]}),(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsx)(te.A,{style:{color:"#0ea5e9"}}),(0,S.jsx)(fe,{strong:!0,children:o.customer_name||"N/A"})]}),(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsx)(ue.A,{style:{color:"#0ea5e9"}}),(0,S.jsx)(fe,{strong:!0,children:f()(o.date).format("DD/MM/YYYY")})]}),(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsx)(me.A,{style:{color:"#0ea5e9"}}),(0,S.jsxs)(fe,{strong:!0,children:["\u20b9",("number"===typeof o.total_amount?o.total_amount:parseFloat(o.total_amount)||0).toFixed(2)]})]})]})]}),(0,S.jsx)(H.A,{style:{margin:"20px 0"}}),(0,S.jsxs)(h.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,S.jsx)(m.Ay,{type:"primary",size:"large",icon:(0,S.jsx)(b.A,{}),onClick:i,style:{width:"100%",height:"48px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",fontWeight:600,fontSize:"16px",borderRadius:"8px"},children:"\ud83c\udd95 Create New Bill"}),(0,S.jsx)(m.Ay,{size:"large",icon:(0,S.jsx)(F.A,{}),onClick:l,style:{width:"100%",height:"48px",background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",border:"none",fontWeight:600,fontSize:"16px",borderRadius:"8px"},children:"\ud83d\udcdd Continue with Current Bill"})]}),(0,S.jsx)("div",{style:{textAlign:"center",marginTop:"16px"},children:(0,S.jsx)(fe,{type:"secondary",style:{fontSize:"12px"},children:'\ud83d\udca1 Tip: Use "New Bill" to start fresh or "Continue Bill" to add more items'})})]})};var ye=i(48677),ve=i(91686),_e=i(99472),he=i(54522),ge=i(45964),be=i(61118);const{Title:je,Text:Ae}=a.A,{Search:ke}=y.A,Ce=e=>{let{visible:t,onClose:i,onViewBill:l,onNewBill:o}=e;const{getEntityApi:a}=(0,C.p)(),r=a("SalesRecord"),{items:d,loading:c}=(0,w.Sm)(r.getIdentifier("GetAll")),[u,p]=(0,n.useState)(""),[x,y]=(0,n.useState)([]);(0,n.useEffect)((()=>{t&&r("GetAll")}),[t]),(0,n.useEffect)((()=>{if(null!==d&&void 0!==d&&d.result){const e=d.result.filter((e=>{var t;if(!u)return!0;const i=u.toLowerCase(),l=e.invoice_no||"",n=(null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||"",o=e.date||"",a="number"===typeof e.total_amount?e.total_amount.toString():String(e.total_amount||"");return l.toLowerCase().includes(i)||n.toLowerCase().includes(i)||o.includes(u)||a.includes(u)}));y(e)}}),[d,u]);const v=(e,t)=>e&&!t?"Paid":t?"Partial":"Unpaid",_=e=>{l(e),i()},g=()=>{o(),i()};return(0,S.jsxs)(ye.A,{title:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,S.jsx)(je,{level:4,style:{margin:0,color:"#1f2937"},children:"\ud83d\udccb Bill List"}),(0,S.jsx)(m.Ay,{type:"text",icon:(0,S.jsx)(ee.A,{}),onClick:i,size:"small"})]}),placement:"left",open:t,onClose:i,width:400,bodyStyle:{padding:"16px"},headerStyle:{borderBottom:"1px solid #e5e7eb",padding:"16px 16px 12px 16px"},children:[(0,S.jsx)("div",{style:{marginBottom:"16px"},children:(0,S.jsxs)(h.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,S.jsx)(ke,{placeholder:"Search bills by invoice, customer, date...",value:u,onChange:e=>p(e.target.value),prefix:(0,S.jsx)(Z.A,{}),allowClear:!0,size:"large"}),(0,S.jsx)(m.Ay,{type:"primary",icon:(0,S.jsx)(b.A,{}),onClick:g,style:{width:"100%",height:"40px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",fontWeight:600,borderRadius:"8px"},children:"\ud83c\udd95 Create New Bill"})]})}),(0,S.jsx)(H.A,{style:{margin:"16px 0"}}),(0,S.jsx)("div",{style:{height:"calc(100vh - 250px)",overflow:"auto"},children:c?(0,S.jsxs)("div",{style:{textAlign:"center",padding:"40px"},children:[(0,S.jsx)(ve.A,{size:"large"}),(0,S.jsx)("div",{style:{marginTop:"16px"},children:(0,S.jsx)(Ae,{type:"secondary",children:"Loading bills..."})})]}):0===x.length?(0,S.jsx)(_e.A,{description:(0,S.jsxs)("div",{children:[(0,S.jsx)(Ae,{type:"secondary",children:u?"No bills found matching your search.":"No bills available."}),!u&&(0,S.jsx)("div",{style:{marginTop:"8px"},children:(0,S.jsx)(m.Ay,{type:"link",onClick:g,children:"Create your first bill"})})]}),style:{marginTop:"40px"}}):(0,S.jsx)(he.A,{dataSource:x,renderItem:e=>{var t,i,l;return(0,S.jsx)(he.A.Item,{style:{padding:"16px",border:"1px solid #e5e7eb",borderRadius:"8px",marginBottom:"12px",background:"white",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)",e.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="none",e.currentTarget.style.transform="translateY(0)"},onClick:()=>_(e),children:(0,S.jsxs)("div",{style:{width:"100%"},children:[(0,S.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsx)(ge.A,{icon:(0,S.jsx)(F.A,{}),style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white"}}),(0,S.jsx)(Ae,{strong:!0,style:{fontSize:"14px"},children:e.invoice_no})]}),(0,S.jsx)(T.A,{color:(i=e.is_paid,l=e.is_partially_paid,i&&!l?"success":l?"warning":"error"),children:v(e.is_paid,e.is_partially_paid)})]}),(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px"},children:[(0,S.jsx)(te.A,{style:{color:"#6b7280",fontSize:"12px"}}),(0,S.jsx)(Ae,{style:{fontSize:"12px",color:"#374151"},children:(null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||e.customer_name||"N/A"})]}),(0,S.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsx)(ue.A,{style:{color:"#6b7280",fontSize:"12px"}}),(0,S.jsx)(Ae,{style:{fontSize:"12px",color:"#6b7280"},children:e.date?f()(e.date).format("DD/MM/YYYY"):"N/A"})]}),(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsx)(me.A,{style:{color:"#10b981",fontSize:"12px"}}),(0,S.jsxs)(Ae,{strong:!0,style:{fontSize:"14px",color:"#10b981"},children:["\u20b9",("number"===typeof e.total_amount?e.total_amount:parseFloat(e.total_amount)||0).toFixed(2)]})]})]}),(0,S.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"12px",justifyContent:"flex-end"},children:[(0,S.jsx)(s.A,{title:"View Bill",children:(0,S.jsx)(m.Ay,{type:"text",icon:(0,S.jsx)(be.A,{}),size:"small",onClick:t=>{t.stopPropagation(),_(e)},style:{color:"#3b82f6"}})}),(0,S.jsx)(s.A,{title:"Print Bill",children:(0,S.jsx)(m.Ay,{type:"text",icon:(0,S.jsx)(U.A,{}),size:"small",onClick:e=>{e.stopPropagation()},style:{color:"#10b981"}})})]})]})})},pagination:!1})}),(0,S.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:"16px",background:"white",borderTop:"1px solid #e5e7eb"},children:(0,S.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,S.jsxs)(Ae,{type:"secondary",style:{fontSize:"12px"},children:["Total Bills: ",x.length]}),(0,S.jsx)(Ae,{type:"secondary",style:{fontSize:"12px"},children:"\ud83d\udca1 Click on any bill to view details"})]})})]})};var we=i(20691);const{Title:Ie,Text:Se}=a.A,De=e=>{var t,i,l,o,a,r,s;let{visible:d,onCancel:c,productId:u}=e;const{getEntityApi:m}=(0,C.p)(),p=m("Product"),{items:f,loading:y}=(0,w.Sm)(p.getIdentifier("GetAll")),[v,_]=(0,n.useState)(null);(0,n.useEffect)((()=>{if(d&&u&&null!==f&&void 0!==f&&f.result){const e=f.result.find((e=>e._id===u));e&&_(e)}}),[d,u,f]),(0,n.useEffect)((()=>{!d||!u||null!==f&&void 0!==f&&f.result||p("GetAll")}),[d,u,f,p]);const h=()=>{_(null),c()};return v?(0,S.jsx)(x.A,{title:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsx)("span",{children:"\ud83d\udce6 Product Details"}),(0,S.jsx)(T.A,{color:"blue",style:{margin:0},children:v.sku})]}),open:d,onCancel:h,footer:null,width:700,destroyOnClose:!0,children:(0,S.jsxs)("div",{style:{padding:"16px 0"},children:[(0,S.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,S.jsx)(Ie,{level:4,style:{margin:"0 0 8px 0",color:"#1890ff"},children:v.name}),(null===(t=v.VariantItem)||void 0===t?void 0:t.variant_name)&&(0,S.jsxs)(T.A,{color:"green",style:{fontSize:"12px"},children:["Variant: ",v.VariantItem.variant_name]})]}),(0,S.jsx)(H.A,{style:{margin:"16px 0"}}),(0,S.jsxs)(we.A,{title:"Product Information",column:2,size:"small",bordered:!0,style:{marginBottom:"24px"},children:[(0,S.jsx)(we.A.Item,{label:"Product Name",span:2,children:(0,S.jsx)(Se,{strong:!0,children:v.name})}),(null===(i=v.VariantItem)||void 0===i?void 0:i.variant_name)&&(0,S.jsx)(we.A.Item,{label:"Variant Name",children:(0,S.jsx)(Se,{children:v.VariantItem.variant_name})}),(null===(l=v.VariantItem)||void 0===l?void 0:l.variant_code)&&(0,S.jsx)(we.A.Item,{label:"Variant Code",children:(0,S.jsx)(Se,{code:!0,children:v.VariantItem.variant_code})}),(0,S.jsx)(we.A.Item,{label:"SKU",children:(0,S.jsx)(Se,{code:!0,children:v.sku})}),v.brand&&(0,S.jsx)(we.A.Item,{label:"Brand",children:(0,S.jsx)(Se,{children:v.brand})}),v.unit&&(0,S.jsx)(we.A.Item,{label:"Unit",children:(0,S.jsx)(Se,{children:v.unit})}),v.description&&(0,S.jsx)(we.A.Item,{label:"Description",span:2,children:(0,S.jsx)(Se,{children:v.description})})]}),(0,S.jsxs)(we.A,{title:"Pricing & Tax",column:2,size:"small",bordered:!0,style:{marginBottom:"24px"},children:[(0,S.jsx)(we.A.Item,{label:"Selling Price",children:(0,S.jsxs)(Se,{strong:!0,style:{color:"#52c41a",fontSize:"16px"},children:["\u20b9",(null===(o=v.selling_price)||void 0===o?void 0:o.toFixed(2))||"0.00"]})}),(0,S.jsx)(we.A.Item,{label:"MRP",children:(0,S.jsxs)(Se,{style:{color:"#fa8c16"},children:["\u20b9",(null===(a=v.mrp)||void 0===a?void 0:a.toFixed(2))||"0.00"]})}),(null===(r=v.CategoryItem)||void 0===r?void 0:r.name)&&(0,S.jsx)(we.A.Item,{label:"Category",children:(0,S.jsx)(Se,{children:v.CategoryItem.name})}),void 0!==(null===(s=v.CategoryItem)||void 0===s?void 0:s.tax_percentage)&&(0,S.jsx)(we.A.Item,{label:"Tax Rate",children:(0,S.jsxs)(T.A,{color:"orange",children:[v.CategoryItem.tax_percentage,"%"]})})]}),(void 0!==v.min_stock||void 0!==v.max_stock)&&(0,S.jsxs)(we.A,{title:"Stock Information",column:2,size:"small",bordered:!0,children:[void 0!==v.min_stock&&(0,S.jsx)(we.A.Item,{label:"Minimum Stock",children:(0,S.jsx)(Se,{children:v.min_stock})}),void 0!==v.max_stock&&(0,S.jsx)(we.A.Item,{label:"Maximum Stock",children:(0,S.jsx)(Se,{children:v.max_stock})})]}),(0,S.jsx)("div",{style:{marginTop:"24px",padding:"16px",backgroundColor:"#f6f8fa",borderRadius:"8px",textAlign:"center"},children:(0,S.jsx)(Se,{type:"secondary",style:{fontSize:"12px"},children:"Right-click on product field to view details \u2022 Press ESC to close"})})]})}):(0,S.jsx)(x.A,{title:"Product Details",open:d,onCancel:h,footer:null,width:600,destroyOnClose:!0,children:(0,S.jsx)("div",{style:{textAlign:"center",padding:"40px 20px"},children:y?(0,S.jsx)(Se,{children:"Loading product details..."}):(0,S.jsx)(Se,{type:"secondary",children:"Product not found"})})})},Ne="BillDataGrid_mainContainer__Jnuo1",Te="BillDataGrid_backgroundCircle1__5PBPG",Be="BillDataGrid_backgroundCircle2__J+xMs",Pe="BillDataGrid_backgroundCircle3__AgoEw",Ee="BillDataGrid_backgroundCircle4__86Xfd",Le="BillDataGrid_backgroundCircle5__qpbiT",qe="BillDataGrid_headerContainer__wfojf",Ge="BillDataGrid_headerCircle1__8+aPI",Re="BillDataGrid_headerCircle2__Z9w17",ze="BillDataGrid_headerCircle3__3eMNm",Me="BillDataGrid_headerCircle4__fVITr",Ve="BillDataGrid_headerCircle5__0E6vl",Fe="BillDataGrid_headerContent__6Rnkr",Ye="BillDataGrid_titleSection__LBuxT",Ue="BillDataGrid_titleIcon__qffZU",Ke="BillDataGrid_titleText__XlvSS",We="BillDataGrid_subtitleText__Hgyav",Oe="BillDataGrid_controlsSection__PSC3w",He="BillDataGrid_controlGroup__AFGBT",Qe="BillDataGrid_saleTypeControl__hzHpa",Xe="BillDataGrid_gstControl__AiGdY",Je="BillDataGrid_paymentControl__BD0r9",Ze="BillDataGrid_partialPaymentControl__unngo",$e="BillDataGrid_controlLabel__QP4fP",et="BillDataGrid_badgesContainer__bqqSt",tt="BillDataGrid_itemsBadge__o0Uro",it="BillDataGrid_amountBadge__IPSqT",lt="BillDataGrid_badgeText__9cTal",nt="BillDataGrid_invoiceDetailsGrid__QPpaj",ot="BillDataGrid_itemsSection__vJE1b",at="BillDataGrid_itemsCircle1__PQoMB",rt="BillDataGrid_itemsCircle2__0lWcR",st="BillDataGrid_billItemsGrid__jpWQo",dt="BillDataGrid_billItemsHeader__hxL0O",ct="BillDataGrid_billItemsTitle__MQduV",ut="BillDataGrid_billItemsBadge__vdJMk",mt="BillDataGrid_billSummary__yA4j-",pt="BillDataGrid_summaryCircle1__PuveY",ft="BillDataGrid_summaryCircle2__fdcks",xt="BillDataGrid_summaryHeader__h1BtQ",yt="BillDataGrid_summaryTitle__dSOoP",vt="BillDataGrid_summaryRow__yUShR",_t="BillDataGrid_summaryLabel__cLnHd",ht="BillDataGrid_summaryValue__LUh-6",gt="BillDataGrid_summaryTable__ZpVlt",bt="BillDataGrid_totalAmountRow__JXMuL",jt="BillDataGrid_totalAmountLabel__IVRMe",At="BillDataGrid_totalAmountValue__5W5mL",kt="BillDataGrid_discountValue__QjPij",Ct="BillDataGrid_partialPaymentInfo__OpO+-",wt="BillDataGrid_partialPaymentRow__Qy-Ni",It="BillDataGrid_partialPaymentLabel__yEvTO",St="BillDataGrid_partialPaymentValue__SLg8d",Dt="BillDataGrid_controlsContainer__2jCRg",Nt="BillDataGrid_discountControl__n0WOI",Tt="BillDataGrid_discountControlLabel__0iwJ9",Bt="BillDataGrid_discountControlInputs__TbgUU",Pt="BillDataGrid_partialPaymentControlLabel__lxP98",Et="BillDataGrid_actionHub__SlPSg",Lt="BillDataGrid_actionButtonsContainer__BcfKu",qt="BillDataGrid_actionHubCircle1__ggNzA",Gt="BillDataGrid_actionHubCircle2__Nb-oj",Rt="BillDataGrid_actionHubCircle3__D2pna",zt="BillDataGrid_actionHubCircle4__ayVXK",Mt="BillDataGrid_saveButton__vWggk",Vt="BillDataGrid_billListButton__ahHFc",Ft="BillDataGrid_printButton__nkIDd",Yt="BillDataGrid_clearButton__518xA",Ut="BillDataGrid_saleTypeSwitch__Xa4gR",Kt="BillDataGrid_gstSwitch__ZQG0t",Wt="BillDataGrid_paymentSwitch__KxB-J",Ot="BillDataGrid_partialPaymentSwitch__5nNFs",{Title:Ht,Text:Qt}=a.A,Xt=e=>{var t;let{billdata:i,onSuccess:a}=e;const p=V("Product"),x=V("Customer"),y=V("BillingUsers"),v=V("StockAudit"),_=V("BranchStock"),h=V("SalesRecord"),g=V("InvoiceNumber"),{data:b,isLoading:j,refetch:k}=p.useGetAll(),{data:C,isLoading:w,refetch:I}=x.useGetAll(),{data:D,isLoading:T,refetch:B}=y.useGetAll(),{data:P,isLoading:E,refetch:q}=v.useGetAll(),{data:R,isLoading:z,refetch:M}=_.useGetAll(),{data:K,refetch:W}=g.useGetAll(),O=b||{},H=C||{},Q=D||{},X=P||{},J=R||{},Z=K||{},$=Array.isArray(O.result)?O.result:[],ee=Array.isArray(H.result)?H.result:[],te=Array.isArray(Q.result)?Q.result:[],ie=Array.isArray(X.result)?X.result:[],le=Array.isArray(J.result)?J.result:[],{create:ne,isLoading:oe}=h.useCreate(),{update:ae,isLoading:se}=h.useUpdate(),{create:de,isLoading:ue}=g.useCreate(),[me,pe]=(0,n.useState)(null),[fe,ye]=(0,n.useState)(null),[ve,_e]=((0,n.useCallback)(((e,t)=>{var i;if(!e||null===t||void 0===t||null===(i=t.VariantItem)||void 0===i||!i.pack_size)return{isValid:!0,expectedLoose:0,totalAvailable:0};const l=parseInt(t.VariantItem.pack_size),n=e.available_quantity||0,o=e.available_loose_quantity||0;return{isValid:!0,expectedLoose:o,totalAvailable:n*l+o}}),[]),(0,n.useState)({invoice_no:"",date:f()().format("YYYY-MM-DD"),customer_id:"",customer_name:"",billed_by_id:"",billed_by_name:"",payment_mode:"cash",items:[]})),[he,ge]=(0,n.useState)({isPaid:!0,isPartiallyPaid:!1,isRetail:!0,isGstIncluded:!0,discount:0,discountType:"percentage",paidAmount:0}),[be,je]=(0,n.useState)(null),[Ae,ke]=(0,n.useState)(null),[we,Ie]=(0,n.useState)(!1),[Se,Xt]=(0,n.useState)(!1),[Jt,Zt]=(0,n.useState)(!1),[$t,ei]=(0,n.useState)(!1),[ti,ii]=(0,n.useState)(null),[li,ni]=(0,n.useState)(!1),[oi,ai]=(0,n.useState)(""),[ri,si]=(0,n.useState)(!1),[di,ci]=(0,n.useState)(null),[ui,mi]=(0,n.useState)(0),pi=(0,n.useMemo)((()=>(0,o.HW)()),[]),fi=null===pi||void 0===pi?void 0:pi.branch_id,xi=(e,t,i)=>{var l,n;const o=(fi?le:ie).find((t=>t._id===e));if(!o)return{isValid:!1,availablePackQty:0,maxLooseQty:0,message:"Stock not found"};const a=null===o||void 0===o||null===(l=o.ProductItem)||void 0===l||null===(n=l.VariantItem)||void 0===n?void 0:n.pack_size,r=a?parseInt(a):1,s=o.available_quantity||0,d=o.available_loose_quantity||0;if(t>s)return{isValid:!1,availablePackQty:s,maxLooseQty:0,message:"Pack quantity (".concat(t,") exceeds available packs (").concat(s,")")};const c=s-t,u=c*r+d;return i>u?{isValid:!1,availablePackQty:s,maxLooseQty:u,message:"Loose quantity (".concat(i,") exceeds available loose items (").concat(u," = ").concat(c," remaining packs \xd7 ").concat(r," + ").concat(d," loose)")}:{isValid:!0,availablePackQty:s,maxLooseQty:u,message:""}},yi=(0,n.useCallback)(((e,t,i)=>{const n=[...ve.items],o=n[e];if(!o.stock_id)return n[e]=(0,l.A)((0,l.A)({},o),{},{[t]:i}),void _e((e=>(0,l.A)((0,l.A)({},e),{},{items:n})));const a="qty"===t?i:o.qty||0,s="loose_qty"===t?i:o.loose_qty||0,d=xi(o.stock_id,a,s);d.isValid?n[e]=(0,l.A)((0,l.A)({},o),{},{[t]:i}):(r.Ay.error(d.message),"qty"===t&&a>d.availablePackQty?n[e]=(0,l.A)((0,l.A)({},o),{},{qty:d.availablePackQty}):"loose_qty"===t&&s>d.maxLooseQty&&(n[e]=(0,l.A)((0,l.A)({},o),{},{loose_qty:d.maxLooseQty}))),_e((e=>(0,l.A)((0,l.A)({},e),{},{items:n})))}),[ve.items,xi]);(0,n.useEffect)((()=>{var e,t,l,n,o,a,r,s,d;(k(),I(),B(),i||ue||W(),i)&&(_e({invoice_no:i.invoice_no,date:f()(i.date).format("YYYY-MM-DD"),customer_id:i.customer_id,customer_name:(null===(e=i.customerDetails)||void 0===e?void 0:e.full_name)||"",billed_by_id:i.billed_by_id||"",billed_by_name:(null===(t=i.billedByDetails)||void 0===t?void 0:t.name)||"",payment_mode:i.payment_mode,items:(null===(l=i.Items)||void 0===l?void 0:l.map((e=>{var t,i,l;return{_id:e._id,product_id:e.product_id,product_name:(null===(t=e.productItems)||void 0===t?void 0:t.name)||"",variant_name:(null===(i=e.productItems)||void 0===i||null===(l=i.VariantItem)||void 0===l?void 0:l.variant_name)||"",stock_id:fi?e.branch_stock_id:e.stock_id,qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price,mrp:e.mrp||e.price,amount:e.amount,tax_percentage:e.tax_percentage||0}})))||[]}),ge({isPaid:null===(n=i.is_paid)||void 0===n||n,isPartiallyPaid:null!==(o=i.is_partially_paid)&&void 0!==o&&o,isRetail:"retail"===i.sale_type,isGstIncluded:null===(a=i.is_gst_included)||void 0===a||a,discount:null!==(r=i.discount)&&void 0!==r?r:0,discountType:null!==(s=i.discount_type)&&void 0!==s?s:"percentage",paidAmount:null!==(d=i.paid_amount)&&void 0!==d?d:0}))}),[i]),(0,n.useEffect)((()=>{var e;null!==Z&&void 0!==Z&&null!==(e=Z.result)&&void 0!==e&&e.invoice_no&&!i&&_e((e=>(0,l.A)((0,l.A)({},e),{},{invoice_no:Z.result.invoice_no})))}),[Z,i]),(0,n.useEffect)((()=>{if(!i&&0===ve.items.length){const e=Array(1).fill(null).map(((e,t)=>({product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0})));_e((t=>(0,l.A)((0,l.A)({},t),{},{items:e})))}}),[i,ve.items.length]),(0,n.useEffect)((()=>{if(!i&&te&&null!==pi&&void 0!==pi&&pi._id&&!ve.billed_by_id){const e=te.find((e=>e._id===pi._id));e&&_e((t=>(0,l.A)((0,l.A)({},t),{},{billed_by_id:pi._id,billed_by_name:e.name||pi.name||""})))}}),[te,null===pi||void 0===pi?void 0:pi._id,i,ve.billed_by_id]);const vi=(0,n.useMemo)((()=>$.map((e=>{var t;return{label:"".concat(e.name," ").concat((null===e||void 0===e||null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)||"").trim(),value:e._id}}))),[$]),_i=(0,n.useMemo)((()=>ee.map((e=>({label:"".concat(e.full_name," - ").concat(e.mobile),value:e._id})))),[ee]),hi=(0,n.useMemo)((()=>{const e=te.map((e=>{var t;return{label:"".concat(e.name," (").concat((null===(t=e.roleItems)||void 0===t?void 0:t.name)||"No Role",")"),value:e._id}}));return e}),[te]),gi=(0,n.useMemo)((()=>[{key:"invoice_no",title:"\ud83d\udcc4 INVOICE #",dataIndex:"invoice_no",type:"text",required:!0,width:180},{key:"date",title:"\ud83d\udcc5 DATE",dataIndex:"date",type:"date",required:!0,width:150},{key:"customer_id",title:"\ud83d\udc64 CUSTOMER",dataIndex:"customer_id",type:"select",options:_i,required:!0,width:250,render:(e,t)=>{const i=_i.find((t=>t.value===e));return(0,S.jsx)(s.A,{title:"Click to open customer selection modal (or press End key)",children:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:"1px solid #d9d9d9",backgroundColor:"#fafafa",transition:"all 0.2s ease"},onClick:()=>Ie(!0),onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#fafafa",e.currentTarget.style.borderColor="#d9d9d9"},children:[(0,S.jsx)("span",{children:i?i.label:"Select customer"}),(0,S.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#f0f8ff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d6e4ff"},children:"End"})]})})}},{key:"billed_by_id",title:"\ud83d\udc68\u200d\ud83d\udcbc BILLED BY",dataIndex:"billed_by_id",type:"select",options:hi,required:!1,width:250,render:(e,t)=>{const i=hi.find((t=>t.value===e));return(0,S.jsx)(s.A,{title:"Click to open user selection modal (or press Ctrl+U key)",children:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:"1px solid #d9d9d9",backgroundColor:"#f0f8ff",transition:"all 0.2s ease"},onClick:()=>Xt(!0),onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#e6f7ff",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#f0f8ff",e.currentTarget.style.borderColor="#d9d9d9"},children:[(0,S.jsx)("span",{children:i?i.label:"Select user"}),(0,S.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#ffffff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d6e4ff"},children:"Ctrl+U"})]})})}},{key:"payment_mode",title:"\ud83d\udcb3 PAYMENT",dataIndex:"payment_mode",type:"select",options:[{label:"\ud83d\udcb5 Cash",value:"cash"},{label:"\ud83d\udcf1 UPI",value:"upi"},{label:"\ud83d\udcb3 Card",value:"card"}],required:!0,width:150}]),[_i,hi]),bi=(0,n.useMemo)((()=>[{invoice_no:ve.invoice_no,date:ve.date,customer_id:ve.customer_id,billed_by_id:ve.billed_by_id,payment_mode:ve.payment_mode}]),[ve.invoice_no,ve.date,ve.customer_id,ve.billed_by_id,ve.payment_mode]),ji=(0,n.useMemo)((()=>[{key:"product_id",title:"\ud83d\uded2 PRODUCT",dataIndex:"product_id",type:"product",required:!0,width:280,render:(e,t,i)=>{const l=vi.find((t=>t.value===e));return(0,S.jsx)(s.A,{title:e?"Product: ".concat((null===l||void 0===l?void 0:l.label)||"Unknown"," - Click to change \u2022 F5 to reopen"):"Click to select product from inventory \u2022 F5 to open",placement:"top",children:(0,S.jsxs)("div",{style:{cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:e?"1px solid #52c41a":"1px solid #d9d9d9",backgroundColor:e?"#f6ffed":"#fafafa",transition:"all 0.2s ease",minHeight:"32px",display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>{"number"===typeof i&&(ci(i),mi(i),si(!0))},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=e?"#f6ffed":"#fafafa",t.currentTarget.style.borderColor=e?"#52c41a":"#d9d9d9"},children:[(0,S.jsx)("span",{style:{color:e?"#52c41a":"#1890ff",fontWeight:e?600:400},children:e?(null===l||void 0===l?void 0:l.label)||"Unknown Product":"Select product"}),e&&(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,S.jsx)("span",{style:{fontSize:"12px",color:"#52c41a"},children:"\u2705"}),(0,S.jsx)("span",{style:{fontSize:"10px",color:"#52c41a",backgroundColor:"#f6ffed",padding:"2px 4px",borderRadius:"3px"},children:"Selected"})]}),!e&&(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginTop:"2px"},children:[(0,S.jsx)("span",{style:{fontSize:"10px",color:"#ff4d4f"},children:"\u26a0\ufe0f Product required"}),(0,S.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#f0f8ff",padding:"2px 4px",borderRadius:"3px"},children:"Click"})]})]})})}},{key:"stock_id",title:"\ud83d\udce6 STOCK",dataIndex:"batch_no",type:"stock",required:!0,width:280,editable:!0,render:(e,t,i)=>{var l,n;const o=(fi?le:ie).find((e=>e._id===t.stock_id)),a=null===o||void 0===o||null===(l=o.ProductItem)||void 0===l||null===(n=l.VariantItem)||void 0===n?void 0:n.pack_size,d=a?parseInt(a):1,c=(null===o||void 0===o?void 0:o.available_quantity)||0,u=(null===o||void 0===o?void 0:o.available_loose_quantity)||0,m=c>0&&c<=10,p=0===c;return(0,S.jsx)(s.A,{title:t.product_id?e?"Stock: ".concat(e," - Packs Available: ").concat(c," \u2022 Loose Available: ").concat(u," \u2022 Pack Size: ").concat(d," \u2022 Click to change \u2022 F7 to reopen"):"Click to select stock from available inventory \u2022 F7 to open":"Please select a product first to choose stock \u2022 F7 to open after product selection",placement:"top",children:(0,S.jsxs)("div",{style:{cursor:"pointer",padding:"6px 10px",borderRadius:"6px",border:e?"1px solid #52c41a":"1px solid #d9d9d9",backgroundColor:e?"#f6ffed":"#fafafa",transition:"all 0.2s ease",minHeight:"32px",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",gap:"10px"},onClick:()=>{t.product_id&&"number"===typeof i?je(i):t.product_id||r.Ay.warning("Please select a product first")},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=e?"#f6ffed":"#fafafa",t.currentTarget.style.borderColor=e?"#52c41a":"#d9d9d9"},children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",flex:1},children:[(0,S.jsx)("span",{style:{color:e?"#52c41a":t.product_id?"#1890ff":"#bfbfbf",fontWeight:e?600:400,fontSize:"13px",whiteSpace:"nowrap"},children:e||"Select Stock"}),o&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("span",{style:{color:p?"#ff4d4f":m?"#faad14":"#52c41a",fontWeight:"bold",backgroundColor:p?"#fff2f0":m?"#fffbe6":"#f6ffed",padding:"2px 6px",borderRadius:"4px",border:"1px solid ".concat(p?"#ffccc7":m?"#ffe58f":"#b7eb8f"),fontSize:"12px"},children:["\ud83d\udce6 ",c]}),(0,S.jsxs)("span",{style:{color:"#722ed1",fontWeight:"bold",backgroundColor:"#f9f0ff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d3adf7",fontSize:"12px"},children:["\ud83d\udccb ",u]})]}),t.product_id&&!e&&(0,S.jsx)("span",{style:{fontSize:"11px",color:"#ff4d4f",whiteSpace:"nowrap"},children:"\u26a0\ufe0f Stock required"})]}),t.product_id&&(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,S.jsx)("span",{style:{fontSize:"12px",color:"#1890ff"},children:"\ud83d\udccb"}),(0,S.jsx)("span",{style:{fontSize:"10px",color:"#52c41a",backgroundColor:"#f6ffed",padding:"2px 4px",borderRadius:"3px"},children:"Click"})]})]})})}},{key:"qty",title:"\ud83d\udcca QTY",dataIndex:"qty",type:"number",width:90,render:(e,t,i)=>{const l=(fi?le:ie).find((e=>e._id===t.stock_id)),n=(null===l||void 0===l?void 0:l.available_quantity)||0,o=e>n;return(0,S.jsx)("div",{style:{position:"relative"},children:(0,S.jsx)(d.A,{value:e,min:0,max:n,style:{width:"100%",borderColor:o?"#ff4d4f":void 0,backgroundColor:o?"#fff2f0":void 0},onPressEnter:e=>{if(void 0!==i){const t=e.target,l=parseInt(t.value)||0;yi(i,"qty",l)}},onBlur:e=>{if(void 0!==i){const t=e.target,l=parseInt(t.value)||0;yi(i,"qty",l)}},onChange:e=>{null!==e&&e>n&&r.Ay.error("Pack quantity cannot exceed available packs (".concat(n,")"))}})})}},{key:"loose_qty",title:"\ud83d\udccb LOOSE",dataIndex:"loose_qty",type:"number",width:90,render:(e,t,i)=>{var l,n;const o=(fi?le:ie).find((e=>e._id===t.stock_id));if(!o)return(0,S.jsx)("div",{style:{position:"relative"},children:(0,S.jsx)(d.A,{value:e,min:0,style:{width:"100%"},disabled:!0})});const a=null===o||void 0===o||null===(l=o.ProductItem)||void 0===l||null===(n=l.VariantItem)||void 0===n?void 0:n.pack_size,s=a?parseInt(a):1,c=(null===o||void 0===o?void 0:o.available_quantity)||0,u=(null===o||void 0===o?void 0:o.available_loose_quantity)||0,m=c-(t.qty||0),p=m*s+u,f=e>p;return(0,S.jsx)("div",{style:{position:"relative"},children:(0,S.jsx)(d.A,{value:e,min:0,max:p,style:{width:"100%",borderColor:f?"#ff4d4f":void 0,backgroundColor:f?"#fff2f0":void 0},onPressEnter:e=>{if(void 0!==i){const t=e.target,l=parseInt(t.value)||0;yi(i,"loose_qty",l)}},onBlur:e=>{if(void 0!==i){const t=e.target,l=parseInt(t.value)||0;yi(i,"loose_qty",l)}},onChange:e=>{null!==e&&e>p&&r.Ay.error("Loose quantity cannot exceed available loose items (".concat(p," = ").concat(m," remaining packs \xd7 ").concat(s," + ").concat(u," loose)"))}})})}},{key:"price",title:"\ud83d\udcb0 RATE",dataIndex:"price",type:"number",required:!0,width:120,editable:!1,render:e=>(0,S.jsx)(d.A,{value:e,disabled:!0,style:{width:"100%"}})},{key:"amount",title:"\ud83d\udcb5 AMOUNT",dataIndex:"amount",type:"number",editable:!1,width:130,render:e=>(0,S.jsx)(d.A,{value:e,disabled:!0,style:{width:"100%"}})}]),[vi,fi,le,ie,yi]),Ai=ji.findIndex((e=>"qty"===e.key||"qty"===e.dataIndex)),ki=(0,n.useMemo)((()=>ve.items.length?function(e){let{items:t,productList:i,isGstIncluded:n,discount:o,discountType:a}=e;const r=t.map((e=>{var t,o;const a=null===i||void 0===i?void 0:i.find((t=>t._id===e.product_id));let r=e.tax_percentage||(null===a||void 0===a||null===(t=a.CategoryItem)||void 0===t?void 0:t.tax_percentage)||18;r&&0!==r||(r=18);const s=Number(e.qty||0)*Number(e.price||0)+Number(e.loose_qty||0)*(Number(e.price||0)/((null===a||void 0===a||null===(o=a.VariantItem)||void 0===o?void 0:o.pack_size)||1)||0);let d=s;return!n&&r>0&&(d=s+s*r/100),(0,l.A)((0,l.A)({},e),{},{tax_percentage:r,baseAmount:s,amount:d})})),s=r.reduce(((e,t)=>e+Number(t.amount)),0),d=r.reduce(((e,t)=>e+Number(t.baseAmount)),0);let c=0;o>0&&(c="percentage"===a?d*(o/100):o);let u=0,m=0,p=0;return r.forEach((e=>{let t=e.baseAmount;o>0&&(t="percentage"===a?e.baseAmount-e.baseAmount*(o/100):e.baseAmount-o/d*e.baseAmount);let i=0;n?e.tax_percentage>0?(i=t*(e.tax_percentage/(100+e.tax_percentage)),m+=t-i,u+=i,p+=t):(m+=t,p+=t):e.tax_percentage>0?(i=t*(e.tax_percentage/100),m+=t,u+=i,p+=t+i):(m+=t,p+=t)})),{sub_total:s,value_of_goods:m,total_gst:u,cgst:u/2,sgst:u/2,total_amount:p,discountValue:c}}({items:ve.items,productList:$,isGstIncluded:he.isGstIncluded,discount:he.discount,discountType:he.discountType}):{sub_total:0,value_of_goods:0,total_gst:0,cgst:0,sgst:0,total_amount:0,discountValue:0}),[ve.items,$,he]),Ci=(0,n.useCallback)((e=>{const t=e[0];if(t){const e=ee.find((e=>e._id===t.customer_id)),i=te.find((e=>e._id===t.billed_by_id));_e((n=>(0,l.A)((0,l.A)({},n),{},{invoice_no:t.invoice_no||"",date:t.date||f()().format("YYYY-MM-DD"),customer_id:t.customer_id||"",customer_name:(null===e||void 0===e?void 0:e.full_name)||"",billed_by_id:t.billed_by_id||"",billed_by_name:(null===i||void 0===i?void 0:i.name)||"",payment_mode:t.payment_mode||"cash"})))}}),[ee,te]),wi=(0,n.useCallback)((e=>{const t=e.map((e=>{var t;const i={product_id:e.product_id||"",product_name:(null===(t=vi.find((t=>t.value===e.product_id)))||void 0===t?void 0:t.label)||"",variant_name:e.variant_name||"",stock_id:e.stock_id||"",batch_no:e.batch_no||"",qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price||0,mrp:e.mrp||0,amount:e.amount||0,tax_percentage:e.tax_percentage||0};if(e.stock_id&&(e.qty||e.loose_qty)){const t=(fi?le:ie).find((t=>t._id===e.stock_id));if(t){var l,n;const o=null===t||void 0===t||null===(l=t.ProductItem)||void 0===l||null===(n=l.VariantItem)||void 0===n?void 0:n.pack_size,a=o?parseInt(o):1,s=t.available_quantity||0,d=t.available_loose_quantity||0;e.qty&&e.qty>s&&(r.Ay.error("Pack quantity (".concat(e.qty,") exceeds available packs (").concat(s,")")),i.qty=s);const c=s-(e.qty||0),u=c*a+d;e.loose_qty&&e.loose_qty>u&&(r.Ay.error("Loose quantity (".concat(e.loose_qty,") exceeds available loose items (").concat(u," = ").concat(c," remaining packs \xd7 ").concat(a," + ").concat(d," loose)")),i.loose_qty=u)}}if(e.product_id&&!e.stock_id){const t=(fi?le:ie).filter((t=>{var i;return t.product===e.product_id||(null===(i=t.ProductItem)||void 0===i?void 0:i._id)===e.product_id}));if(t.length>0){const l=t[0];i.stock_id=l._id,i.batch_no=l.batch_no||"",setTimeout((()=>{const t=document.querySelector('td[data-row-key="'.concat(e.key,'"][data-column-key="qty"]'));t&&t.focus()}),300)}}return i})).map((e=>{if(!e.product_id||!e.stock_id)return e;const t=(fi?le:ie).find((t=>t._id===e.stock_id));if(t){var i,n,o,a;const r=t.sell_price||0,s=null===t||void 0===t||null===(i=t.ProductItem)||void 0===i||null===(n=i.VariantItem)||void 0===n?void 0:n.pack_size,d=r/(s?parseInt(s):1),c=(e.qty||0)*r+(e.loose_qty||0)*d,u=$.find((t=>t._id===e.product_id)),m=(null===u||void 0===u||null===(o=u.CategoryItem)||void 0===o?void 0:o.tax_percentage)||0;let p=c;return he.isGstIncluded||(p=c+c*m/100),(0,l.A)((0,l.A)({},e),{},{price:e.price||r,mrp:t.mrp||r,amount:p,tax_percentage:m,product_name:(null===u||void 0===u?void 0:u.name)||"",variant_name:(null===u||void 0===u||null===(a=u.VariantItem)||void 0===a?void 0:a.variant_name)||"",batch_no:t.batch_no||""})}return e}));_e((e=>(0,l.A)((0,l.A)({},e),{},{items:t})))}),[vi,fi,le,ie,$,he]),Ii=(0,n.useCallback)(((e,t)=>{if(t<0||t>=ve.items.length)return console.error("Invalid rowIndex: ".concat(t,". Items length: ").concat(ve.items.length)),void r.Ay.error("Invalid row index: ".concat(t,". Please try again."));const i=[...ve.items];if(!i[t])return console.error("Item at index ".concat(t," is undefined. Items length: ").concat(i.length)),void r.Ay.error("Selected row is no longer valid. Please try again.");i[t].product_id=e.id||e._id||"",i[t].product_name=e.name||"",i[t].price=e.selling_price||0,wi(i),je(t)}),[wi,ve.items.length]),Si=()=>{if(null!==be)return je(null),r.Ay.info("Stock modal closed. Opening product selection..."),void setTimeout((()=>{Di()}),100);Di()},Di=()=>{let e=-1;const t=document.activeElement,i=null===t||void 0===t?void 0:t.closest("tr");if(i){const t=i.getAttribute("data-row-key");null!==t&&(e=parseInt(t))}else{const i=null===t||void 0===t?void 0:t.closest("td");if(i){const t=i.closest("tr");if(t){const i=t.getAttribute("data-row-key");null!==i&&(e=parseInt(i))}}}-1===e&&Ae&&(e=Ae.row),-1===e&&ui<ve.items.length&&(e=ui),-1===e&&(e=ve.items.findIndex((e=>!e.product_id))),-1===e&&(Ri(),e=ve.items.length),ci(e),si(!0),r.Ay.info("Opening product selection for row ".concat(e+1))},Ni=(0,n.useCallback)((()=>{ci(0),si(!0),r.Ay.success("\ud83c\udf89 Bill saved! Ready for next bill - Select product to continue.",4)}),[]),Ti=()=>{let e=-1;const t=document.activeElement,i=null===t||void 0===t?void 0:t.closest("tr");if(i){const t=i.getAttribute("data-row-key");if(null!==t){var l;const i=parseInt(t);null!==(l=ve.items[i])&&void 0!==l&&l.product_id&&(e=i)}}-1===e&&(e=ve.items.findIndex((e=>e.product_id&&!e.stock_id))),-1===e&&(e=ve.items.findIndex((e=>e.product_id))),-1!==e?(je(e),r.Ay.info("Opening stock selection for row ".concat(e+1))):r.Ay.warning("Please select a product first before selecting stock")},Bi=(0,n.useCallback)((e=>{ve.customer_id!==e._id&&(_e((t=>(0,l.A)((0,l.A)({},t),{},{customer_id:e._id,customer_name:e.full_name}))),setTimeout((()=>{Ie(!1),setTimeout((()=>{Xt(!0)}),100)}),50),r.Ay.success('Customer "'.concat(e.full_name,'" selected successfully!')))}),[ve.customer_id]),Pi=(0,n.useCallback)((e=>{ve.billed_by_id!==e._id&&(_e((t=>(0,l.A)((0,l.A)({},t),{},{billed_by_id:e._id,billed_by_name:e.name}))),setTimeout((()=>{Xt(!1)}),50),r.Ay.success('User "'.concat(e.name,'" selected as billed by successfully!')))}),[ve.billed_by_id]),Ei=()=>{Li(!1),Zt(!1),ii(null),r.Ay.success("New bill form cleared successfully!")},Li=(0,n.useCallback)((function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];_e({invoice_no:"",date:f()().format("YYYY-MM-DD"),customer_id:"",customer_name:"",payment_mode:"cash",items:[{product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0}]}),ge({isPaid:!0,isPartiallyPaid:!1,isRetail:!0,isGstIncluded:!0,discount:0,discountType:"percentage",paidAmount:0}),je(null),ke(null),Ie(!1),Zt(!1),ei(!1),ii(null),ni(!1),ai(""),si(!1),ci(null),W(),e&&r.Ay.success("Ready for next bill!",2)}),[]),qi=()=>{Li(!1),r.Ay.success("Bill form cleared successfully!")},Gi=()=>{if(0===ve.items.length)return;let e=!1;const t=ve.items.map((t=>{let i=!1;if(t.product_id&&$.length>0){const e=$.find((e=>e._id===t.product_id));var l;if(e&&(t.product_name.includes("Loading...")||t.product_name.includes("Product ID:")||!t.product_name))t.product_name=e.name,t.variant_name=(null===(l=e.VariantItem)||void 0===l?void 0:l.variant_name)||"",i=!0}if(t.stock_id){const e=fi?le:ie;if(e.length>0){var n;const l=e.find((e=>e._id===t.stock_id));l&&(null!==(n=t.batch_no)&&void 0!==n&&n.includes("Loading...")||!t.batch_no)&&(t.batch_no=l.batch_no||"",i=!0)}}return i&&(e=!0),t}));e&&_e((e=>(0,l.A)((0,l.A)({},e),{},{items:t})))},Ri=()=>{const e={product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0};_e((t=>(0,l.A)((0,l.A)({},t),{},{items:[...t.items,e]})))},zi=async()=>{if(!ve.invoice_no||!ve.customer_id||!ve.items.length)return void r.Ay.error("Please fill all required fields");if(ve.items.some((e=>!e.product_id||!e.stock_id||!e.qty&&!e.loose_qty||!e.price)))return void r.Ay.error("Please complete all item details");const e=[];if(ve.items.forEach(((t,i)=>{if(t.stock_id&&(t.qty||t.loose_qty)){const l=xi(t.stock_id,t.qty||0,t.loose_qty||0);l.isValid||e.push("Row ".concat(i+1,": ").concat(l.message))}})),e.length>0)return void r.Ay.error("Stock validation errors:\n".concat(e.join("\n")));if(!ve.customer_id)return void r.Ay.error("Please select a customer");if(!ve.payment_mode)return void r.Ay.error("Please select a payment mode");const t=(0,l.A)((0,l.A)({invoice_no:ve.invoice_no,date:ve.date,customer_id:ve.customer_id,billed_by_id:ve.billed_by_id,payment_mode:ve.payment_mode,items:ve.items.map((e=>(0,l.A)((0,l.A)({product_id:e.product_id,stock_id:e.stock_id},fi&&{branch_stock_id:e.stock_id}),{},{qty:e.qty,loose_qty:e.loose_qty,price:e.price,mrp:e.mrp,amount:e.amount,tax_percentage:e.tax_percentage,_id:e._id})))},ki),{},{discount:he.discount,discount_type:he.discountType,is_paid:he.isPaid,is_partially_paid:he.isPartiallyPaid,sale_type:he.isRetail?"retail":"wholesale",is_gst_included:he.isGstIncluded,paid_amount:he.isPartiallyPaid?he.paidAmount:he.isPaid?ki.total_amount:0});try{var n;let e;if(i){const l=await ae(i._id,t);if(!l.data)throw l.error;e=l.data,ye(e)}else{const i=await ne(t);if(!i.data)throw i.error;e=i.data,pe(e)}if(200===(null===(n=e)||void 0===n?void 0:n.statusCode)){const e=(0,l.A)((0,l.A)({},t),{},{customer_name:ve.customer_name,total_amount:ki.total_amount,invoice_no:t.invoice_no,date:t.date});ii(e),i&&Zt(!0)}}catch(o){r.Ay.error("Failed to save bill. Please try again.")}};return(0,n.useEffect)((()=>{200===(null===me||void 0===me?void 0:me.statusCode)&&(null===a||void 0===a||a(),de({}),i||(Zt(!1),setTimeout((()=>{Li(!1),setTimeout((()=>{Ni()}),200)}),100)),pe(null))}),[me,i,Li,a,Ni,de]),(0,n.useEffect)((()=>{200===(null===fe||void 0===fe?void 0:fe.statusCode)&&(null===a||void 0===a||a(),ye(null))}),[fe,a]),(0,n.useEffect)((()=>{if($.length>0&&ve.items.length>0){if(ve.items.some((e=>e.product_id&&(!e.product_name||e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))))){const e=ve.items.map((e=>{if(e.product_id&&(!e.product_name||e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))){const i=$.find((t=>t._id===e.product_id));var t;if(i)return(0,l.A)((0,l.A)({},e),{},{product_name:i.name,variant_name:(null===(t=i.VariantItem)||void 0===t?void 0:t.variant_name)||""})}return e}));e.some(((e,t)=>e.product_name!==ve.items[t].product_name))&&_e((t=>(0,l.A)((0,l.A)({},t),{},{items:e})))}}}),[$,ve.items]),(0,n.useEffect)((()=>{$.length>0&&ve.items.length>0&&setTimeout((()=>{Gi()}),200)}),[$,ve.items]),(0,n.useEffect)((()=>{const e=fi?le:ie;if(e.length>0&&ve.items.length>0){if(ve.items.some((e=>e.stock_id&&(!e.batch_no||e.batch_no.includes("Loading..."))))){const t=ve.items.map((t=>{if(t.stock_id&&(!t.batch_no||t.batch_no.includes("Loading..."))){const i=e.find((e=>e._id===t.stock_id));if(i)return(0,l.A)((0,l.A)({},t),{},{batch_no:i.batch_no||""})}return t}));t.some(((e,t)=>e.batch_no!==ve.items[t].batch_no))&&_e((e=>(0,l.A)((0,l.A)({},e),{},{items:t})))}}}),[le,ie,ve.items,fi]),(0,n.useEffect)((()=>{(fi?le:ie).length>0&&ve.items.length>0&&setTimeout((()=>{Gi()}),200)}),[le,ie,ve.items,fi]),(0,n.useEffect)((()=>{if(ve.items.length>0){const e=setInterval((()=>{ve.items.some((e=>e.product_id&&(!e.product_name||e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))||e.stock_id&&(!e.batch_no||e.batch_no.includes("Loading..."))))&&($.length>0||(fi?le.length>0:ie.length>0))&&Gi()}),1e3);return()=>clearInterval(e)}}),[ve.items,$,le,ie,fi]),(0,n.useEffect)((()=>{const e=e=>{if("F1"===e.key)e.preventDefault(),Ri(),setTimeout((()=>{const e=document.querySelector('.ant-table-tbody tr:last-child td[data-column-key="product_id"]');null===e||void 0===e||e.focus()}),200);else if("F2"===e.key)e.preventDefault(),zi();else if("F3"===e.key)e.preventDefault(),r.Ay.info("Print functionality coming soon!");else if("F4"===e.key)e.preventDefault(),qi();else if("F5"===e.key)e.preventDefault(),Si();else if("End"===e.key)e.preventDefault(),Ie(!0);else if("F6"===e.key)e.preventDefault(),ei(!0);else if("F7"===e.key)e.preventDefault(),Ti();else if(e.ctrlKey)switch(e.key){case"s":e.preventDefault(),zi();break;case"n":e.preventDefault(),Ri(),setTimeout((()=>{const e=document.querySelector('.ant-table-tbody tr:last-child td[data-column-key="product_id"]');null===e||void 0===e||e.focus()}),200);break;case"p":e.preventDefault(),r.Ay.info("Print functionality coming soon!");break;case"r":e.preventDefault(),Li();break;case"u":e.preventDefault(),Xt(!0)}else if(e.ctrlKey&&/^[0-9]$/.test(e.key)){e.preventDefault();const t=document.activeElement;if(null!==t&&void 0!==t&&t.closest('td[data-column-key="qty"]')){const i=t.querySelector("input");i&&(i.value=e.key,i.dispatchEvent(new Event("change",{bubbles:!0})))}}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[ve,he,Si,Ti,be]),(0,S.jsxs)("div",{className:Ne,children:[(0,S.jsx)("div",{className:Te}),(0,S.jsx)("div",{className:Be}),(0,S.jsx)("div",{className:Pe}),(0,S.jsx)("div",{className:Ee}),(0,S.jsx)("div",{className:Le}),(0,S.jsxs)("div",{className:qe,children:[(0,S.jsx)("div",{className:Ge}),(0,S.jsx)("div",{className:Re}),(0,S.jsx)("div",{className:ze}),(0,S.jsx)("div",{className:Me}),(0,S.jsx)("div",{className:Ve}),(0,S.jsxs)("div",{className:Fe,children:[(0,S.jsxs)("div",{className:Ye,children:[(0,S.jsx)("div",{className:Ue,children:(0,S.jsx)(F.A,{style:{fontSize:"24px",color:"white"}})}),(0,S.jsxs)("div",{children:[(0,S.jsx)(Ht,{level:4,className:Ke,children:i?"\u26a1 EDIT INVOICE":"\ud83d\ude80 NEW INVOICE"}),(0,S.jsxs)(Qt,{className:We,children:["\u26a1Lightning Fast \u2022 ",f()().format("DD MMM YYYY, dddd")]})]})]}),(0,S.jsxs)("div",{className:Oe,children:[(0,S.jsxs)("div",{className:"".concat(He," ").concat(Qe),children:[(0,S.jsx)(Qt,{className:$e,children:"\ud83c\udfea SALE TYPE"}),(0,S.jsx)(c.A,{checkedChildren:"RETAIL",unCheckedChildren:"WHOLESALE",checked:he.isRetail,onChange:e=>ge((t=>(0,l.A)((0,l.A)({},t),{},{isRetail:e}))),className:Ut,size:"small"})]}),(0,S.jsxs)("div",{className:"".concat(He," ").concat(Xe),children:[(0,S.jsx)(Qt,{className:$e,children:"\ud83d\udcca GST"}),(0,S.jsx)(c.A,{checkedChildren:"INCL",unCheckedChildren:"EXCL",checked:he.isGstIncluded,onChange:e=>ge((t=>(0,l.A)((0,l.A)({},t),{},{isGstIncluded:e}))),className:Kt,size:"small"})]}),(0,S.jsxs)("div",{className:"".concat(He," ").concat(Je),children:[(0,S.jsx)(Qt,{className:$e,children:"\ud83d\udcb3 PAYMENT"}),(0,S.jsx)(c.A,{checkedChildren:"PAID",unCheckedChildren:"UNPAID",checked:he.isPaid,onChange:e=>ge((t=>(0,l.A)((0,l.A)({},t),{},{isPaid:e,isPartiallyPaid:!e&&t.isPartiallyPaid}))),className:Wt,size:"small"})]}),!he.isPaid&&(0,S.jsxs)("div",{className:"".concat(He," ").concat(Ze),children:[(0,S.jsx)(Qt,{className:$e,children:"\ud83d\udcb0 PARTIAL"}),(0,S.jsx)(c.A,{checkedChildren:"YES",unCheckedChildren:"NO",checked:he.isPartiallyPaid,onChange:e=>ge((t=>(0,l.A)((0,l.A)({},t),{},{isPartiallyPaid:e}))),className:Ot,size:"small"})]}),(0,S.jsxs)("div",{className:et,children:[(0,S.jsx)("div",{className:tt,children:(0,S.jsxs)(Qt,{className:lt,children:["\ud83c\udfaf ITEMS: ",ve.items.length]})}),(0,S.jsx)("div",{className:it,children:(0,S.jsxs)(Qt,{className:lt,children:["\ud83d\udcb0 \u20b9",ki.total_amount.toFixed(2)]})})]})]})]})]}),(0,S.jsx)("div",{className:nt,children:(0,S.jsx)(G,{columns:gi,dataSource:bi,onSave:Ci,allowAdd:!1,allowDelete:!1,loading:w,className:"compact-header-grid",size:"small",rowKey:"invoice_no"})}),(0,S.jsxs)("div",{className:ot,children:[(0,S.jsx)("div",{className:at}),(0,S.jsx)("div",{className:rt}),(0,S.jsxs)("div",{className:st,children:[(0,S.jsxs)("div",{className:dt,children:[(0,S.jsx)(Qt,{className:ct,children:"\ud83d\uded2 BILL ITEMS"}),(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,S.jsx)(u.A,{count:ve.items.length,showZero:!0,size:"small",style:{backgroundColor:"rgba(255,255,255,0.2)"},children:(0,S.jsx)(Qt,{className:ut,children:"Items"})}),(0,S.jsx)(Qt,{style:{fontSize:"10px",color:"#666",backgroundColor:"#f0f0f0",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d9d9d9"}})]})]}),(0,S.jsx)(G,{columns:ji,dataSource:ve.items.map(((e,t)=>(0,l.A)((0,l.A)({},e),{},{key:t.toString()}))),onSave:wi,onAdd:Ri,onDelete:e=>{_e((t=>{const i=t.items.filter(((t,i)=>!e.includes(null===i||void 0===i?void 0:i.toString())));return(0,l.A)((0,l.A)({},t),{},{items:i})}))},onProductSelect:Ii,loading:j||E||z,className:"modern-bill-grid",size:"small",rowKey:"key",externalEditingCell:Ae})]}),(0,S.jsxs)("div",{className:mt,children:[(0,S.jsx)("div",{className:pt}),(0,S.jsx)("div",{className:ft}),(0,S.jsx)("div",{className:xt,children:(0,S.jsx)(Qt,{className:yt,children:"\ud83d\udcb0 BILL SUMMARY"})}),(0,S.jsxs)("div",{className:gt,children:[(0,S.jsxs)("div",{className:vt,children:[(0,S.jsx)(Qt,{className:_t,children:"Sub Total:"}),(0,S.jsxs)(Qt,{className:ht,children:["\u20b9",ki.sub_total.toFixed(2)]})]}),(0,S.jsxs)("div",{className:vt,children:[(0,S.jsx)(Qt,{className:_t,children:"Value of Goods:"}),(0,S.jsxs)(Qt,{className:ht,children:["\u20b9",ki.value_of_goods.toFixed(2)]})]}),(0,S.jsxs)("div",{className:vt,children:[(0,S.jsx)(Qt,{className:_t,children:"Total GST:"}),(0,S.jsxs)(Qt,{className:ht,children:["\u20b9",ki.total_gst.toFixed(2)]})]}),(0,S.jsxs)("div",{className:vt,children:[(0,S.jsx)(Qt,{className:_t,children:"CGST:"}),(0,S.jsxs)(Qt,{className:ht,children:["\u20b9",ki.cgst.toFixed(2)]})]}),(0,S.jsxs)("div",{className:vt,children:[(0,S.jsx)(Qt,{className:_t,children:"SGST:"}),(0,S.jsxs)(Qt,{className:ht,children:["\u20b9",ki.sgst.toFixed(2)]})]}),he.discount>0&&(0,S.jsxs)("div",{className:vt,children:[(0,S.jsx)(Qt,{className:_t,children:"DISCOUNT:"}),(0,S.jsxs)(Qt,{className:kt,children:["-\u20b9","percentage"===he.discountType?((ki.sub_total+ki.total_gst)*("number"===typeof he.discount?he.discount:0)/100).toFixed(2):("number"===typeof he.discount?he.discount:0).toFixed(2)]})]}),(0,S.jsxs)("div",{className:bt,children:[(0,S.jsx)(Qt,{className:jt,children:"NET/EXC/REPL:"}),(0,S.jsxs)(Qt,{className:At,children:["\u20b9",ki.total_amount.toFixed(2)]})]}),he.isPartiallyPaid&&(0,S.jsxs)("div",{className:Ct,children:[(0,S.jsxs)("div",{className:wt,children:[(0,S.jsx)(Qt,{className:It,children:"Paid Amount:"}),(0,S.jsxs)(Qt,{className:St,children:["\u20b9",("number"===typeof he.paidAmount?he.paidAmount:0).toFixed(2)]})]}),(0,S.jsxs)("div",{className:wt,children:[(0,S.jsx)(Qt,{className:It,children:"Balance:"}),(0,S.jsxs)(Qt,{className:St,children:["\u20b9",(ki.total_amount-("number"===typeof he.paidAmount?he.paidAmount:0)).toFixed(2)]})]})]})]}),(0,S.jsxs)("div",{className:Dt,children:[(0,S.jsxs)("div",{className:Nt,children:[(0,S.jsx)(Qt,{className:Tt,children:"\ud83d\udcb8 DISCOUNT"}),(0,S.jsxs)("div",{className:Bt,children:[(0,S.jsx)(d.A,{min:0,value:he.discount,onChange:e=>ge((t=>(0,l.A)((0,l.A)({},t),{},{discount:e||0}))),style:{width:70},size:"small"}),(0,S.jsx)(c.A,{checkedChildren:"%",unCheckedChildren:"\u20b9",checked:"percentage"===he.discountType,onChange:e=>ge((t=>(0,l.A)((0,l.A)({},t),{},{discountType:e?"percentage":"amount"}))),size:"small"})]})]}),he.isPartiallyPaid&&(0,S.jsxs)("div",{className:Ze,children:[(0,S.jsx)(Qt,{className:Pt,children:"\ud83d\udcb0 PARTIAL PAY"}),(0,S.jsx)(d.A,{min:0,max:ki.total_amount,value:he.paidAmount,onChange:e=>ge((t=>(0,l.A)((0,l.A)({},t),{},{paidAmount:e||0}))),style:{width:90},size:"small",formatter:e=>"\u20b9".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>Number(e.replace(/\u20b9\s?|(,*)/g,""))})]})]})]})]}),(0,S.jsxs)("div",{className:Et,children:[(0,S.jsx)("div",{className:qt}),(0,S.jsx)("div",{className:Gt}),(0,S.jsx)("div",{className:Rt}),(0,S.jsx)("div",{className:zt}),(0,S.jsxs)("div",{className:Lt,children:[(0,S.jsxs)(m.Ay,{type:"primary",size:"large",icon:(0,S.jsx)(A.A,{}),onClick:zi,loading:oe,className:Mt,children:["\ud83d\ude80 ",i?"UPDATE":"SAVE BILL"," (F2)"]}),(0,S.jsx)(m.Ay,{size:"large",icon:(0,S.jsx)(F.A,{}),onClick:()=>ei(!0),className:Vt,children:"\ud83d\udccb BILL LIST (F6)"}),(0,S.jsx)(m.Ay,{size:"large",icon:(0,S.jsx)(Y.A,{}),onClick:qi,className:Yt,children:"\ud83e\uddf9 CLEAR (F4 / Ctrl+R)"}),(0,S.jsx)(m.Ay,{size:"large",icon:(0,S.jsx)(U.A,{}),className:Ft,children:"\ud83d\udda8\ufe0f PRINT (F3)"})]}),(0,S.jsx)("div",{style:{background:"linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)",padding:"14px 18px",borderRadius:"10px",border:"1px solid #cbd5e1",position:"relative",zIndex:1,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.05)"},children:(0,S.jsx)("div",{style:{textAlign:"right"},children:(0,S.jsxs)(Qt,{style:{color:"#475569",fontSize:"12px",display:"block",fontWeight:600,lineHeight:"18px"},children:["\u26a1 ",(0,S.jsx)("strong",{children:"Keyboard Shortcuts:"})," Ctrl+S (Save) \u2022 Ctrl+N (Add) \u2022 F4/Ctrl+R (Clear) \u2022 Tab/Shift+Tab (Navigate) \u2022 Enter (Edit) \u2022 Esc (Cancel) \u2022 End (Customer) \u2022 Ctrl+U (User) \u2022 F5 (Product) \u2022 F6 (Bill List) \u2022 F7 (Stock)"]})})})]}),null!==be&&(0,S.jsx)(L,{visible:!0,onSelect:e=>{if(null===be)return;if(be<0||be>=ve.items.length)return console.error("Invalid stockModalRowIndex: ".concat(be,". Items length: ").concat(ve.items.length)),r.Ay.error("Invalid row index: ".concat(be,". Please try again.")),void je(null);const t=[...ve.items];if(!t[be])return console.error("Item at index ".concat(be," is undefined. Items length: ").concat(t.length)),r.Ay.error("Selected row is no longer valid. Please try again."),void je(null);t[be].stock_id=e.id||e._id||e.invoice_id||"",t[be].batch_no=e.batch_no||"",wi(t),je(null),-1!==Ai&&ke({row:be,col:Ai})},onCancel:()=>je(null),productId:(null===(t=ve.items[be])||void 0===t?void 0:t.product_id)||""}),(0,S.jsx)(re,{visible:we,onSelect:Bi,onCancel:()=>Ie(!1)}),(0,S.jsx)(ce,{visible:Se,onSelect:Pi,onCancel:()=>Xt(!1)}),(0,S.jsx)(xe,{visible:Jt,onNewBill:Ei,onContinueBill:()=>{Zt(!1),ii(null)},onCancel:()=>Zt(!1),savedBillData:ti}),(0,S.jsx)(De,{visible:li,onCancel:()=>ni(!1),productId:oi}),(0,S.jsx)(N,{visible:ri,onSelect:e=>{var t;if(null===di)return;if(di<0||di>=ve.items.length)return console.error("Invalid productSelectionRowIndex: ".concat(di,". Items length: ").concat(ve.items.length)),r.Ay.error("Invalid row index: ".concat(di,". Please try again.")),void ci(null);const i=[...ve.items];if(!i[di])return console.error("Item at index ".concat(di," is undefined. Items length: ").concat(i.length)),r.Ay.error("Selected row is no longer valid. Please try again."),void ci(null);i[di].product_id=e._id||"",i[di].product_name=e.name||"",i[di].variant_name=(null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)||"",i[di].price=e.selling_price||0,wi(i),si(!1),ci(null),je(di),r.Ay.success('Product "'.concat(e.name,'" selected successfully!'))},onCancel:()=>{si(!1),ci(null)}}),(0,S.jsx)(Ce,{visible:$t,onClose:()=>ei(!1),onViewBill:e=>{var t,i,n,o,a;if(!e)return void r.Ay.error("No bill data received");k(),I(),fi?M():q(),0===$.length&&k(),0===ee.length&&I();0===(fi?le:ie).length&&(fi?M():q());let s=[];e.Items&&Array.isArray(e.Items)?s=e.Items:e.items&&Array.isArray(e.items)?s=e.items:e.sales_items&&Array.isArray(e.sales_items)?s=e.sales_items:e.result&&e.result.Items&&Array.isArray(e.result.Items)?s=e.result.Items:e.result&&e.result.items&&Array.isArray(e.result.items)&&(s=e.result.items);const d=s.map(((e,t)=>{var i,n;let o="",a="";var r;if(null!==(i=e.productItems)&&void 0!==i&&i.name)o=e.productItems.name,a=(null===(r=e.productItems.VariantItem)||void 0===r?void 0:r.variant_name)||"";else if(e.product_name)o=e.product_name,a=e.variant_name||"";else if(null!==(n=e.product)&&void 0!==n&&n.name){var s;o=e.product.name,a=(null===(s=e.product.VariantItem)||void 0===s?void 0:s.variant_name)||""}else if(e.product_id){const t=$.find((t=>t._id===e.product_id));var d;if(t)o=t.name,a=(null===(d=t.VariantItem)||void 0===d?void 0:d.variant_name)||"";else 0===$.length&&k(),o="Loading... (ID: ".concat(e.product_id,")"),setTimeout((()=>{if($.length>0){const i=$.find((t=>t._id===e.product_id));if(i){const n=[...ve.items],o=n.findIndex((t=>t.product_id===e.product_id));var t;if(-1!==o)n[o].product_name=i.name,n[o].variant_name=(null===(t=i.VariantItem)||void 0===t?void 0:t.variant_name)||"",_e((e=>(0,l.A)((0,l.A)({},e),{},{items:n})))}}}),100)}let c="",u="";if(e.stock_id?(c=e.stock_id,u=e.batch_no||""):e.branch_stock_id?(c=e.branch_stock_id,u=e.batch_no||""):e.stock&&(c=e.stock,u=e.batch_no||""),c&&!u){var m;const e=fi?J:X,t=null===e||void 0===e||null===(m=e.result)||void 0===m?void 0:m.find((e=>e._id===c));t?u=t.batch_no||"":(null!==e&&void 0!==e&&e.result||(fi?M():q()),u="Loading... (Stock: ".concat(c,")"),setTimeout((()=>{const e=fi?J:X;if(null!==e&&void 0!==e&&e.result){const t=e.result.find((e=>e._id===c));if(t){const e=[...ve.items],i=e.findIndex((e=>e.stock_id===c));-1!==i&&(e[i].batch_no=t.batch_no||"",_e((t=>(0,l.A)((0,l.A)({},t),{},{items:e}))))}}}),100))}return{_id:e._id||"",product_id:e.product_id||e.product||"",product_name:o,variant_name:a,stock_id:c,batch_no:u,qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price||0,mrp:e.mrp||e.price||0,amount:e.amount||0,tax_percentage:e.tax_percentage||0}})),c=e.customer_id||"";let u="";if(null!==(t=e.customerDetails)&&void 0!==t&&t.full_name)u=e.customerDetails.full_name;else if(e.customer_name)u=e.customer_name;else if(null!==(i=e.customer)&&void 0!==i&&i.full_name)u=e.customer.full_name;else if(e.customer_id){var m;const t=null===H||void 0===H||null===(m=H.result)||void 0===m?void 0:m.find((t=>t._id===e.customer_id));u=(null===t||void 0===t?void 0:t.full_name)||"Customer ID: ".concat(e.customer_id)}let p=f()().format("YYYY-MM-DD");if(e.date)try{p=f()(e.date).format("YYYY-MM-DD")}catch(v){p=f()().format("YYYY-MM-DD")}let x=[...d];$.length>0&&(x=x.map((e=>{if(e.product_id&&(e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))){const i=$.find((t=>t._id===e.product_id));var t;if(i)return(0,l.A)((0,l.A)({},e),{},{product_name:i.name,variant_name:(null===(t=i.VariantItem)||void 0===t?void 0:t.variant_name)||""})}return e})));const y=fi?le:ie;y.length>0&&(x=x.map((e=>{if(e.stock_id&&(e.batch_no.includes("Loading...")||!e.batch_no)){const t=y.find((t=>t._id===e.stock_id));if(t)return(0,l.A)((0,l.A)({},e),{},{batch_no:t.batch_no||""})}return e}))),_e({invoice_no:e.invoice_no||"",date:p,customer_id:c,customer_name:u,payment_mode:e.payment_mode||"cash",items:x}),ge({isPaid:null===(n=e.is_paid)||void 0===n||n,isPartiallyPaid:null!==(o=e.is_partially_paid)&&void 0!==o&&o,isRetail:"retail"===e.sale_type||void 0===e.sale_type,isGstIncluded:null===(a=e.is_gst_included)||void 0===a||a,discount:e.discount||0,discountType:e.discount_type||"percentage",paidAmount:e.paid_amount||0}),r.Ay.success('Bill "'.concat(e.invoice_no,'" loaded successfully!')),setTimeout((()=>{Gi()}),100),setTimeout((()=>{Gi()}),500),setTimeout((()=>{Gi()}),1e3)},onNewBill:Ei})]})}}}]);
//# sourceMappingURL=658.a8eb7049.chunk.js.map