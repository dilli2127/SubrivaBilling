/*! For license information please see 5148.6de8a75e.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[5148],{5148:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ie});var i=n(89379),r=n(65043),a=n(36621),o=n(26553),d=n(93504),l=n(16569),s=n(62751),c=n(98105),u=n(83038),m=n(36091),x=n(73146),p=n(76399),h=n(37490),y=n(96651),v=n(79126),j=n(6051),_=n(30326),g=n(95206),A=n(60446),f=n.n(A),b=n(33359),w=n(45229),k=n(46237),I=n(89967),N=n(4394),S=n(80132),C=n(80599),D=n(95240),P=n(53722),q=n(6881),R=n(76401),Y=n(61118),F=n(94733),O=n(31219),M=n(92003),z=n(11951),T=n(18758),L=n(58209),E=n(70579);const V={draft:{color:"default",icon:(0,E.jsx)(b.A,{}),label:"Draft"},pending_approval:{color:"warning",icon:(0,E.jsx)(w.A,{}),label:"Pending Approval"},approved:{color:"success",icon:(0,E.jsx)(k.A,{}),label:"Approved"},rejected:{color:"error",icon:(0,E.jsx)(I.A,{}),label:"Rejected"},sent:{color:"processing",icon:(0,E.jsx)(N.A,{}),label:"Sent"},confirmed:{color:"cyan",icon:(0,E.jsx)(k.A,{}),label:"Confirmed"},partially_received:{color:"purple",icon:(0,E.jsx)(S.A,{}),label:"Partially Received"},fully_received:{color:"green",icon:(0,E.jsx)(k.A,{}),label:"Fully Received"},cancelled:{color:"red",icon:(0,E.jsx)(C.A,{}),label:"Cancelled"},closed:{color:"default",icon:(0,E.jsx)(k.A,{}),label:"Closed"}};var B=n(98350),G=n(97679),U=n(7866),W=n(60647),Q=n(91065),H=n(9316),K=n(73847),Z=n(51333);const $=e=>{let{value:t=[],onChange:n,disabled:l=!1}=e;const s=(0,r.useMemo)((()=>({pageNumber:1,pageLimit:100})),[]),{data:c,isLoading:u}=B.lh.useGetProductQuery(s),m=(0,r.useMemo)((()=>(null===c||void 0===c?void 0:c.result)||[]),[c]),x=(0,r.useCallback)((()=>{null===n||void 0===n||n([...t,{product_id:"",product_name:"",variant_name:"",description:"",quantity:1,unit_price:0,tax_percentage:0,discount:0,discount_type:"percentage",line_total:0,received_quantity:0,pending_quantity:1}])}),[t,n]),p=(0,r.useCallback)((e=>{const i=t.filter(((t,n)=>n!==e));null===n||void 0===n||n(i)}),[t,n]),h=(0,r.useCallback)((e=>{const t=Number(e.quantity)||0,n=Number(e.unit_price)||0,i=Number(e.tax_percentage)||0,r=Number(e.discount)||0;let a=t*n;a-="percentage"===(e.discount_type||"percentage")?a*r/100:r;return{line_total:Number((a+a*(i/100)).toFixed(2)),pending_quantity:t-(e.received_quantity||0)}}),[]),v=(0,r.useCallback)(((e,r,a)=>{const o=[...t],d=(0,i.A)((0,i.A)({},o[e]),{},{[r]:a});if(["quantity","unit_price","tax_percentage","discount","discount_type"].includes(r)){const e=h(d);Object.assign(d,e)}o[e]=d,null===n||void 0===n||n(o)}),[t,n,h]),_=(0,r.useCallback)(((e,r)=>{var a;const o=m.find((e=>e._id===r));if(!o)return;const d=[...t],l=(0,i.A)((0,i.A)({},d[e]),{},{product_id:r,product_name:o.name,variant_name:(null===(a=o.VariantItem)||void 0===a?void 0:a.variant_name)||"",description:o.description||"",tax_percentage:0,unit_price:0}),s=h(l);d[e]=(0,i.A)((0,i.A)({},l),s),null===n||void 0===n||n(d)}),[t,n,m,h]),A=(0,r.useMemo)((()=>{const e=t.reduce(((e,t)=>{const n=Number(t.quantity)||0,i=Number(t.unit_price)||0,r=Number(t.discount)||0;let a=n*i;return a-="percentage"===(t.discount_type||"percentage")?a*r/100:r,e+a}),0),n=t.reduce(((e,t)=>{const n=Number(t.quantity)||0,i=Number(t.unit_price)||0,r=Number(t.tax_percentage)||0,a=Number(t.discount)||0;let o=n*i;return o-="percentage"===(t.discount_type||"percentage")?o*a/100:a,e+o*r/100}),0),i=e+n;return{subtotal:Number(e.toFixed(2)),taxAmount:Number(n.toFixed(2)),total:Number(i.toFixed(2))}}),[t]),b=[{title:"#",key:"index",width:40,render:(e,t,n)=>n+1},{title:(0,E.jsx)("span",{style:{color:"red"},children:"* Product"}),key:"product",width:200,render:(e,t,n)=>(0,E.jsx)(o.A,{showSearch:!0,allowClear:!0,placeholder:"Select product",style:{width:"100%"},value:t.product_id||void 0,onChange:e=>_(n,e),disabled:l,loading:u,filterOption:(e,t)=>String((null===t||void 0===t?void 0:t.children)||"").toLowerCase().includes(e.toLowerCase()),notFoundContent:u?"Loading products...":"No products found",children:m.map((e=>{var t;return(0,E.jsxs)(o.A.Option,{value:e._id,children:[e.name," ",null!==(t=e.VariantItem)&&void 0!==t&&t.variant_name?"- ".concat(e.VariantItem.variant_name):""]},e._id)}))})},{title:"Description",key:"description",width:150,render:(e,t,n)=>(0,E.jsx)(a.A,{placeholder:"Description",value:t.description,onChange:e=>v(n,"description",e.target.value),disabled:l})},{title:(0,E.jsx)("span",{style:{color:"red"},children:"* Quantity"}),key:"quantity",width:100,render:(e,t,n)=>(0,E.jsx)(U.A,{min:1,precision:0,placeholder:"Qty",style:{width:"100%"},value:t.quantity,onChange:e=>v(n,"quantity",e),disabled:l})},{title:"Unit Price",key:"unit_price",width:110,render:(e,t,n)=>(0,E.jsx)(U.A,{min:0,precision:2,placeholder:"Enter at receipt",prefix:"\u20b9",style:{width:"100%"},value:t.unit_price,onChange:e=>v(n,"unit_price",e),disabled:!0})},{title:"Tax %",key:"tax_percentage",width:80,render:(e,t,n)=>(0,E.jsx)(U.A,{min:0,max:100,precision:2,placeholder:"Enter at receipt",suffix:"%",style:{width:"100%"},value:t.tax_percentage,onChange:e=>v(n,"tax_percentage",e),disabled:!0})},{title:"Discount",key:"discount",width:130,render:(e,t,n)=>(0,E.jsxs)(j.A.Compact,{style:{width:"100%"},children:[(0,E.jsx)(U.A,{min:0,precision:2,placeholder:"Enter at receipt",style:{width:"70%"},value:t.discount,onChange:e=>v(n,"discount",e),disabled:!0}),(0,E.jsxs)(o.A,{style:{width:"30%"},value:t.discount_type,onChange:e=>v(n,"discount_type",e),disabled:!0,children:[(0,E.jsx)(o.A.Option,{value:"percentage",children:"%"}),(0,E.jsx)(o.A.Option,{value:"amount",children:"\u20b9"})]})]})},{title:"Line Total",key:"line_total",width:110,render:(e,t)=>(0,E.jsx)(y.A,{title:t.unit_price>0?"Qty: ".concat(t.quantity," \xd7 \u20b9").concat(t.unit_price):"Price will be set at receipt",children:(0,E.jsx)("strong",{style:{color:t.unit_price>0?"#52c41a":"#999"},children:t.unit_price>0?"\u20b9".concat((t.line_total||0).toLocaleString("en-IN",{minimumFractionDigits:2})):"TBD"})})},{title:"Expected Date",key:"expected_delivery_date",width:120,render:(e,t,n)=>(0,E.jsx)(d.A,{format:"YYYY-MM-DD",style:{width:"100%"},value:t.expected_delivery_date?f()(t.expected_delivery_date):void 0,onChange:e=>v(n,"expected_delivery_date",null===e||void 0===e?void 0:e.format("YYYY-MM-DD")),disabled:l})},{title:"Actions",key:"actions",width:70,render:(e,n,i)=>(0,E.jsx)(W.A,{title:"Delete this line item?",onConfirm:()=>p(i),disabled:l||1===t.length,children:(0,E.jsx)(g.Ay,{type:"link",danger:!0,size:"small",icon:(0,E.jsx)(H.A,{}),disabled:l||1===t.length})})}];return(0,E.jsxs)("div",{style:{width:"100%"},children:[(0,E.jsxs)("div",{style:{marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,E.jsx)("strong",{style:{fontSize:"14px"},children:"Line Items"}),(0,E.jsx)(g.Ay,{type:"dashed",icon:(0,E.jsx)(K.A,{}),onClick:x,disabled:l,children:"Add Item"})]}),(0,E.jsx)(Q.A,{columns:b,dataSource:t,pagination:!1,size:"small",scroll:{x:"max-content"},rowKey:(e,t)=>"item-".concat(t),bordered:!0,footer:()=>(0,E.jsx)("div",{style:{textAlign:"right"},children:(0,E.jsxs)(j.A,{direction:"vertical",size:"small",style:{width:"100%"},children:[(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:[(0,E.jsx)("span",{children:"Subtotal:"}),(0,E.jsxs)("strong",{children:["\u20b9",A.subtotal.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"20px"},children:[(0,E.jsx)("span",{children:"Tax Amount:"}),(0,E.jsxs)("strong",{children:["\u20b9",A.taxAmount.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"20px",fontSize:"16px",color:"#52c41a"},children:[(0,E.jsxs)("span",{children:[(0,E.jsx)(Z.A,{})," Total:"]}),(0,E.jsxs)("strong",{children:["\u20b9",A.total.toLocaleString("en-IN",{minimumFractionDigits:2})]})]})]})})}),0===t.length&&(0,E.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#999"},children:'No items added. Click "Add Item" to get started.'})]})};var J=n(62305),X=n(42261),ee=n(47419),te=n(11645),ne=n(8354),ie=n(26612),re=n(32513);const ae=e=>{let{open:t,onClose:n,purchaseOrder:c}=e;const[u]=J.A.useForm(),[m,x]=(0,r.useState)([]),[h,y]=(0,r.useState)(!0),[v,_]=(0,r.useState)(0),[A,{isLoading:b}]=(0,G.dN)();(0,r.useEffect)((()=>{if(null!==c&&void 0!==c&&c.items){const e=c.items.map((e=>(0,i.A)((0,i.A)({},e),{},{po_line_item_id:e._id,ordered_quantity:e.quantity,received_quantity:e.pending_quantity||e.quantity-(e.received_quantity||0),rejected_quantity:0,accepted_quantity:e.pending_quantity||e.quantity-(e.received_quantity||0),batch_no:"",mfg_date:void 0,expiry_date:void 0,notes:"",unit_price:e.unit_price||0,tax_percentage:e.tax_percentage||0,discount:e.discount||0,discount_type:e.discount_type||"percentage"})));x(e)}null!==c&&void 0!==c&&c.shipping_cost?_(c.shipping_cost):_(0)}),[c]);const w=(0,r.useCallback)(((e,t,n)=>{const i=[...m];i[e][t]=n,"received_quantity"!==t&&"rejected_quantity"!==t||(i[e].accepted_quantity=(i[e].received_quantity||0)-(i[e].rejected_quantity||0)),x(i)}),[m]),I=(0,r.useCallback)(((e,t,n)=>{const i=[...m];i[e][t]=n,x(i)}),[m]),N={ordered:m.reduce(((e,t)=>e+(t.ordered_quantity||0)),0),received:m.reduce(((e,t)=>e+(t.received_quantity||0)),0),rejected:m.reduce(((e,t)=>e+(t.rejected_quantity||0)),0),accepted:m.reduce(((e,t)=>e+(t.accepted_quantity||0)),0)},C=(0,r.useMemo)((()=>{const e=m.filter((e=>e.received_quantity>0));let t=0,n=0,i=0;e.forEach((e=>{const r=e.accepted_quantity||0,a=Number(e.unit_price)||0,o=Number(e.tax_percentage)||0,d=Number(e.discount)||0,l=e.discount_type||"percentage";if(a>0){let e=r*a,s=0;s="percentage"===l?e*(d/100):d,e-=s,t+=e,n+=s,i+=e*(o/100)}}));const r=Number(v)||0,a=t+i+r;return{subtotal:Number(t.toFixed(2)),discountAmount:Number(n.toFixed(2)),taxAmount:Number(i.toFixed(2)),shippingCost:Number(r.toFixed(2)),total:Number(a.toFixed(2))}}),[m,v]),D=[{title:"Product",key:"product",width:200,render:e=>(0,E.jsxs)("div",{children:[(0,E.jsx)("strong",{children:e.product_name}),e.variant_name&&(0,E.jsx)("div",{style:{fontSize:"11px",color:"#888"},children:e.variant_name})]})},{title:"Ordered Qty",dataIndex:"ordered_quantity",key:"ordered_quantity",width:100,render:e=>(0,E.jsx)(p.A,{color:"blue",children:e})},{title:"Already Received",dataIndex:"received_quantity",key:"already_received",width:120,render:(e,t)=>{const n=t.ordered_quantity-t.pending_quantity;return n>0?(0,E.jsx)(p.A,{color:"green",children:n}):(0,E.jsx)("span",{style:{color:"#999"},children:"-"})}},{title:"Pending",key:"pending",width:100,render:e=>(0,E.jsx)(p.A,{color:"orange",children:e.pending_quantity||0})},{title:(0,E.jsx)("span",{style:{color:"red"},children:"* Receive Now"}),key:"receive_now",width:120,render:(e,t,n)=>(0,E.jsx)(U.A,{min:0,max:e.pending_quantity||e.ordered_quantity,value:e.received_quantity,onChange:e=>w(n,"received_quantity",e||0),style:{width:"100%"}})},{title:"Rejected",key:"rejected",width:100,render:(e,t,n)=>(0,E.jsx)(U.A,{min:0,max:e.received_quantity,value:e.rejected_quantity,onChange:e=>w(n,"rejected_quantity",e||0),style:{width:"100%"}})},{title:"Accepted",dataIndex:"accepted_quantity",key:"accepted_quantity",width:100,render:e=>(0,E.jsx)("strong",{style:{color:"#52c41a"},children:e})},{title:(0,E.jsxs)("span",{children:["Unit Price ",(0,E.jsx)("span",{style:{color:"red"},children:"*"})]}),key:"unit_price",width:120,render:(e,t,n)=>{const i=e.received_quantity>0&&(!e.unit_price||e.unit_price<=0);return(0,E.jsx)(U.A,{min:0,precision:2,placeholder:"\u20b90.00",prefix:"\u20b9",style:{width:"100%",borderColor:i?"#ff4d4f":void 0},value:e.unit_price,onChange:e=>I(n,"unit_price",e||0),disabled:0===e.received_quantity,className:i?"ant-input-number-error":""})}},{title:(0,E.jsxs)("span",{children:["GST % ",(0,E.jsx)("span",{style:{color:"red"},children:"*"})]}),key:"tax_percentage",width:100,render:(e,t,n)=>{const i=e.received_quantity>0&&(void 0===e.tax_percentage||null===e.tax_percentage);return(0,E.jsx)(U.A,{min:0,max:100,precision:2,placeholder:"18%",suffix:"%",style:{width:"100%",borderColor:i?"#ff4d4f":void 0},value:e.tax_percentage,onChange:e=>I(n,"tax_percentage",e||0),disabled:0===e.received_quantity,className:i?"ant-input-number-error":""})}},{title:"Discount",key:"discount",width:150,render:(e,t,n)=>(0,E.jsxs)(j.A.Compact,{style:{width:"100%"},children:[(0,E.jsx)(U.A,{min:0,precision:2,placeholder:"0",style:{width:"70%"},value:e.discount,onChange:e=>I(n,"discount",e||0),disabled:0===e.received_quantity}),(0,E.jsxs)(o.A,{style:{width:"30%"},value:e.discount_type,onChange:e=>I(n,"discount_type",e),disabled:0===e.received_quantity,children:[(0,E.jsx)(o.A.Option,{value:"percentage",children:"%"}),(0,E.jsx)(o.A.Option,{value:"amount",children:"\u20b9"})]})]})},{title:"Batch No",key:"batch_no",width:130,render:(e,t,n)=>(0,E.jsx)(a.A,{placeholder:"Batch",value:e.batch_no,onChange:e=>I(n,"batch_no",e.target.value)})},{title:"MFG Date",key:"mfg_date",width:140,render:(e,t,n)=>(0,E.jsx)(d.A,{format:"YYYY-MM-DD",value:e.mfg_date?f()(e.mfg_date):void 0,onChange:e=>I(n,"mfg_date",e),style:{width:"100%"},disabledDate:e=>e&&e>f()().endOf("day")})},{title:(0,E.jsxs)("span",{children:["Expiry Date ",(0,E.jsx)("span",{style:{color:"red"},children:"*"})]}),key:"expiry_date",width:140,render:(e,t,n)=>{const i=e.received_quantity>0,r=i&&!e.expiry_date;return(0,E.jsx)(d.A,{format:"YYYY-MM-DD",value:e.expiry_date?f()(e.expiry_date):void 0,onChange:e=>I(n,"expiry_date",e),style:{width:"100%",borderColor:r?"#ff4d4f":void 0},disabledDate:e=>e&&e<f()().endOf("day"),placeholder:i?"Required *":"Select date",className:r?"ant-picker-error":""})}}];return(0,E.jsxs)(s.A,{title:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(S.A,{style:{color:"#1890ff"}}),(0,E.jsxs)("span",{children:["Receive Goods - PO #",null===c||void 0===c?void 0:c.po_number]})]}),open:t,onCancel:n,width:1400,footer:[(0,E.jsx)(g.Ay,{onClick:n,children:"Cancel"},"cancel"),(0,E.jsx)(g.Ay,{type:"primary",icon:(0,E.jsx)(k.A,{}),loading:b,onClick:async()=>{try{const e=await u.validateFields();if(!m.some((e=>e.accepted_quantity>0)))return void l.Ay.error("Please receive at least one item");const t=m.filter((e=>e.received_quantity>0));if(t.filter((e=>!e.expiry_date)).length>0)return void l.Ay.error("Expiry date is required for all received items");if(t.filter((e=>!e.unit_price||e.unit_price<=0)).length>0)return void l.Ay.error("Unit price is required for all received items");if(t.filter((e=>void 0===e.tax_percentage||null===e.tax_percentage)).length>0)return void l.Ay.error("Tax percentage is required for all received items");const i=m.filter((e=>e.received_quantity>0)).map((e=>({po_line_item_id:e.po_line_item_id,received_quantity:e.received_quantity,rejected_quantity:e.rejected_quantity||0,batch_no:e.batch_no,mfg_date:e.mfg_date?f()(e.mfg_date).format("YYYY-MM-DD"):void 0,expiry_date:e.expiry_date?f()(e.expiry_date).format("YYYY-MM-DD"):void 0,notes:e.notes,unit_price:e.unit_price,tax_percentage:e.tax_percentage,discount:e.discount||0,discount_type:e.discount_type||"percentage"}))),r={id:c._id,items:i,vendor_invoice_no:e.vendor_invoice_no,vendor_invoice_date:e.vendor_invoice_date?f()(e.vendor_invoice_date).format("YYYY-MM-DD"):void 0,notes:e.notes,shipping_cost:v||0,create_stock_entries:h};await A(r).unwrap(),l.Ay.success("Goods received successfully!"),u.resetFields(),n()}catch(t){var e;l.Ay.error((null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to receive goods")}},children:"Receive Goods & Create GRN"},"submit")],children:[(0,E.jsx)(X.A,{message:"Goods Receipt Note (GRN)",description:"Record the actual quantities received from the vendor. Enter the unit price, GST percentage, and discount (if any) for each item, plus the total shipping cost as provided by the vendor. This will update inventory and PO status.",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,E.jsxs)(J.A,{form:u,layout:"vertical",children:[(0,E.jsxs)(ee.A,{gutter:16,children:[(0,E.jsx)(te.A,{span:8,children:(0,E.jsx)(J.A.Item,{name:"vendor_invoice_no",label:(0,E.jsxs)("span",{children:["Vendor Invoice Number ",(0,E.jsx)("span",{style:{color:"red"},children:"*"})]}),rules:[{required:!0,message:"Please enter vendor invoice number"},{whitespace:!0,message:"Vendor invoice number cannot be empty"}],children:(0,E.jsx)(a.A,{placeholder:"Enter vendor's invoice number"})})}),(0,E.jsx)(te.A,{span:8,children:(0,E.jsx)(J.A.Item,{name:"vendor_invoice_date",label:"Vendor Invoice Date",children:(0,E.jsx)(d.A,{style:{width:"100%"},format:"YYYY-MM-DD"})})}),(0,E.jsx)(te.A,{span:8,children:(0,E.jsx)(J.A.Item,{label:"GRN Date",children:(0,E.jsx)(d.A,{value:f()(),disabled:!0,style:{width:"100%"},format:"YYYY-MM-DD"})})})]}),(0,E.jsx)(ne.A,{children:"Receive Items"}),(0,E.jsxs)(ee.A,{gutter:16,style:{marginBottom:16},children:[(0,E.jsx)(te.A,{span:6,children:(0,E.jsx)(ie.A,{title:"Total Ordered",value:N.ordered})}),(0,E.jsx)(te.A,{span:6,children:(0,E.jsx)(ie.A,{title:"Receiving Now",value:N.received,valueStyle:{color:"#1890ff"}})}),(0,E.jsx)(te.A,{span:6,children:(0,E.jsx)(ie.A,{title:"Rejected",value:N.rejected,valueStyle:{color:"#ff4d4f"}})}),(0,E.jsx)(te.A,{span:6,children:(0,E.jsx)(ie.A,{title:"Accepted",value:N.accepted,valueStyle:{color:"#52c41a"}})})]}),(0,E.jsx)(Q.A,{columns:D,dataSource:m,rowKey:"po_line_item_id",pagination:!1,scroll:{x:1650},size:"small",bordered:!0}),(0,E.jsx)(ne.A,{}),C.total>0&&(0,E.jsxs)(ee.A,{gutter:16,style:{marginBottom:16,padding:"16px",background:"#f5f5f5",borderRadius:"4px"},children:[(0,E.jsx)(te.A,{span:5,children:(0,E.jsx)(ie.A,{title:"Subtotal (After Discount)",value:C.subtotal,prefix:"\u20b9",valueStyle:{fontSize:"16px"}})}),C.discountAmount>0&&(0,E.jsx)(te.A,{span:5,children:(0,E.jsx)(ie.A,{title:"Discount",value:C.discountAmount,prefix:"\u20b9",valueStyle:{fontSize:"16px",color:"#ff4d4f"}})}),(0,E.jsx)(te.A,{span:5,children:(0,E.jsx)(ie.A,{title:"Tax Amount",value:C.taxAmount,prefix:"\u20b9",valueStyle:{fontSize:"16px"}})}),C.shippingCost>0&&(0,E.jsx)(te.A,{span:5,children:(0,E.jsx)(ie.A,{title:"Shipping Cost",value:C.shippingCost,prefix:"\u20b9",valueStyle:{fontSize:"16px"}})}),(0,E.jsx)(te.A,{span:C.shippingCost>0?4:C.discountAmount>0?9:14,children:(0,E.jsx)(ie.A,{title:"Total Amount",value:C.total,prefix:"\u20b9",valueStyle:{fontSize:"18px",color:"#52c41a",fontWeight:"bold"}})})]}),(0,E.jsxs)(ee.A,{gutter:16,children:[(0,E.jsx)(te.A,{span:12,children:(0,E.jsx)(J.A.Item,{name:"notes",label:"Notes",children:(0,E.jsx)(a.A.TextArea,{rows:3,placeholder:"Any notes about the receipt..."})})}),(0,E.jsxs)(te.A,{span:12,children:[(0,E.jsx)(J.A.Item,{label:"Shipping Cost",children:(0,E.jsx)(U.A,{min:0,precision:2,placeholder:"\u20b90.00",prefix:"\u20b9",style:{width:"100%"},value:v,onChange:e=>_(e||0)})}),(0,E.jsxs)(re.A,{checked:h,onChange:e=>y(e.target.checked),style:{marginTop:16},children:[(0,E.jsx)("strong",{children:"Auto-create Stock Entries"}),(0,E.jsx)("div",{style:{fontSize:"11px",color:"#888"},children:"Automatically add received items to Stock Audit"})]})]})]})]})]})};var oe=n(20691);const de=e=>{var t,n,i;let{open:o,onClose:d,purchaseOrder:c}=e;const[u]=J.A.useForm(),[m,x]=(0,r.useState)(!1),[h,y]=(0,r.useState)(""),[v,{isLoading:j}]=(0,G.FA)(),[_,{isLoading:A}]=(0,G.jw)();return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(s.A,{title:"Approve / Reject Purchase Order",open:o,onCancel:d,width:700,footer:[(0,E.jsx)(g.Ay,{danger:!0,icon:(0,E.jsx)(I.A,{}),loading:A,onClick:()=>{x(!0)},children:"Reject"},"reject"),(0,E.jsx)(g.Ay,{type:"primary",icon:(0,E.jsx)(k.A,{}),loading:j,onClick:async()=>{try{const e=await u.validateFields();await v({id:c._id,comments:e.comments}).unwrap(),l.Ay.success("Purchase order approved successfully"),u.resetFields(),d()}catch(t){var e;l.Ay.error((null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to approve PO")}},children:"Approve"},"approve")],children:[(0,E.jsxs)(oe.A,{bordered:!0,column:2,size:"small",children:[(0,E.jsx)(oe.A.Item,{label:"PO Number",span:2,children:(0,E.jsx)(p.A,{color:"blue",children:null===c||void 0===c?void 0:c.po_number})}),(0,E.jsx)(oe.A.Item,{label:"Vendor",span:2,children:null===c||void 0===c||null===(t=c.vendor)||void 0===t?void 0:t.vendor_name}),(0,E.jsx)(oe.A.Item,{label:"Total Amount",span:2,children:(0,E.jsxs)("strong",{style:{color:"#52c41a"},children:["\u20b9",null===c||void 0===c||null===(n=c.total_amount)||void 0===n?void 0:n.toLocaleString("en-IN",{minimumFractionDigits:2})]})}),(0,E.jsxs)(oe.A.Item,{label:"Items",span:2,children:[null===c||void 0===c||null===(i=c.items)||void 0===i?void 0:i.length," items"]}),(0,E.jsx)(oe.A.Item,{label:"Created By",span:2,children:null===c||void 0===c?void 0:c.created_by_name})]}),(0,E.jsx)(ne.A,{}),(0,E.jsx)(J.A,{form:u,layout:"vertical",children:(0,E.jsx)(J.A.Item,{name:"comments",label:"Comments (Optional)",children:(0,E.jsx)(a.A.TextArea,{rows:3,placeholder:"Add any comments..."})})})]}),(0,E.jsx)(s.A,{title:"Reject Purchase Order",open:m,onCancel:()=>x(!1),onOk:async()=>{try{if(!h)return void l.Ay.error("Please provide a rejection reason");await _({id:c._id,reason:h}).unwrap(),l.Ay.success("Purchase order rejected"),u.resetFields(),y(""),x(!1),d()}catch(t){var e;l.Ay.error((null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to reject PO")}},confirmLoading:A,okText:"Reject",okButtonProps:{danger:!0},children:(0,E.jsx)(J.A.Item,{label:"Rejection Reason",required:!0,children:(0,E.jsx)(a.A.TextArea,{rows:4,value:h,onChange:e=>y(e.target.value),placeholder:"Enter the reason for rejecting this purchase order..."})})})]})},le=e=>{var t;let{open:n,onClose:i,purchaseOrder:r}=e;const[o]=J.A.useForm(),[d,{isLoading:c}]=(0,G.aO)();return(0,E.jsxs)(s.A,{title:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(N.A,{style:{color:"#1890ff"}}),(0,E.jsx)("span",{children:"Send Purchase Order to Vendor"})]}),open:n,onCancel:i,onOk:async()=>{try{const e=await o.validateFields();await d({id:r._id,email:e.email,message:e.message}).unwrap(),l.Ay.success("Purchase order sent to vendor successfully"),o.resetFields(),i()}catch(t){var e;l.Ay.error((null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to send PO")}},confirmLoading:c,okText:"Send Email",width:600,children:[(0,E.jsx)(X.A,{message:"Email Purchase Order",description:"This will send PO #".concat(null===r||void 0===r?void 0:r.po_number," as a PDF attachment to the vendor's email address."),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,E.jsxs)(J.A,{form:o,layout:"vertical",initialValues:{email:(null===r||void 0===r?void 0:r.vendor_email)||(null===r||void 0===r||null===(t=r.VendorItem)||void 0===t?void 0:t.email)},children:[(0,E.jsx)(J.A.Item,{name:"email",label:"Vendor Email",rules:[{required:!0,message:"Email is required"},{type:"email",message:"Enter a valid email"}],children:(0,E.jsx)(a.A,{placeholder:"vendor@example.com"})}),(0,E.jsx)(J.A.Item,{name:"message",label:"Message (Optional)",children:(0,E.jsx)(a.A.TextArea,{rows:4,placeholder:"Dear Vendor, Please find the attached purchase order..."})})]})]})};var se=n(71782),ce=n(85192),ue=n(51961);const{Text:me}=se.A,xe=e=>{var t,n;let{open:i,onClose:a,purchaseOrder:o,onPaymentSuccess:d}=e;const l=o&&!o.VendorItem&&o.vendor_id&&i,{data:c}=B.lh.useGetVendorByIdQuery((null===o||void 0===o?void 0:o.vendor_id)||"",{skip:!l}),u=o&&!o.WarehouseItem&&o.warehouse_id&&i,{data:x}=B.lh.useGetWarehouseByIdQuery((null===o||void 0===o?void 0:o.warehouse_id)||"",{skip:!u}),{data:y,refetch:v}=(0,ue.Ts)((null===o||void 0===o?void 0:o._id)||"",{skip:!(null!==o&&void 0!==o&&o._id)||!i}),{data:_}=(0,ue.dL)((null===o||void 0===o?void 0:o._id)||"",{skip:!(null!==o&&void 0!==o&&o._id)||!i}),{data:A}=(0,ue.aL)((null===o||void 0===o?void 0:o._id)||"",{skip:!(null!==o&&void 0!==o&&o._id)||!i}),b=(0,r.useMemo)((()=>{if(!o)return null;if(o.VendorItem&&o.VendorItem.vendor_name)return o.VendorItem;if(l&&c){const e=(null===c||void 0===c?void 0:c.result)||c;if(e&&(e.vendor_name||e.name))return{vendor_name:e.vendor_name||e.name,company_name:e.company_name,email:e.email,phone:e.phone||e.contact_number,address:e.address}}return o.vendor_name?{vendor_name:o.vendor_name,company_name:o.vendor_company_name,email:o.vendor_email,phone:o.vendor_phone,address:o.vendor_address}:null}),[o,null===o||void 0===o?void 0:o.VendorItem,null===o||void 0===o?void 0:o.vendor_name,null===o||void 0===o?void 0:o.vendor_id,c,l]),w=(0,r.useMemo)((()=>{if(!o)return null;if(o.WarehouseItem&&o.WarehouseItem.warehouse_name)return o.WarehouseItem;if(u&&x){const e=(null===x||void 0===x?void 0:x.result)||x;if(e&&(e.warehouse_name||e.name))return{warehouse_name:e.warehouse_name||e.name,warehouse_code:e.warehouse_code||e.code,address:e.address,manager:e.manager}}return o.warehouse_name?{warehouse_name:o.warehouse_name,warehouse_code:o.warehouse_code,address:o.warehouse_address,manager:o.warehouse_manager}:null}),[o,null===o||void 0===o?void 0:o.WarehouseItem,null===o||void 0===o?void 0:o.warehouse_name,null===o||void 0===o?void 0:o.warehouse_id,x,u]);if(!o)return null;const I={draft:{color:"default",label:"Draft"},pending_approval:{color:"warning",label:"Pending Approval"},approved:{color:"success",label:"Approved"},rejected:{color:"error",label:"Rejected"},sent:{color:"processing",label:"Sent"},confirmed:{color:"cyan",label:"Confirmed"},partially_received:{color:"purple",label:"Partially Received"},fully_received:{color:"green",label:"Fully Received"},cancelled:{color:"red",label:"Cancelled"},closed:{color:"default",label:"Closed"}},N=I[o.status]||I.draft,C=[{title:"Product",key:"product",render:e=>(0,E.jsxs)("div",{children:[(0,E.jsx)("strong",{children:e.product_name}),e.variant_name&&(0,E.jsx)("div",{style:{fontSize:"11px",color:"#888"},children:e.variant_name})]})},{title:"Description",dataIndex:"description",key:"description"},{title:"Quantity",dataIndex:"quantity",key:"quantity",render:e=>(0,E.jsx)(p.A,{color:"blue",children:Number(e)||0})},{title:"Unit Price",dataIndex:"unit_price",key:"unit_price",render:e=>"\u20b9".concat((Number(e)||0).toFixed(2))},{title:"Tax %",dataIndex:"tax_percentage",key:"tax_percentage",render:e=>{const t=Number(e);return t?"".concat(t,"%"):"-"}},{title:"Discount",key:"discount",render:e=>{const t=Number(e.discount)||0;return t>0?"".concat(t).concat("percentage"===e.discount_type?"%":"\u20b9"):"-"}},{title:"Line Total",dataIndex:"line_total",key:"line_total",render:e=>{const t=Number(e)||0;return(0,E.jsxs)("strong",{style:{color:"#52c41a"},children:["\u20b9",t.toLocaleString("en-IN",{minimumFractionDigits:2})]})}},{title:"Received",dataIndex:"received_quantity",key:"received_quantity",render:(e,t)=>{const n=Number(e)||0,i=(Number(t.quantity)||0)-n;return(0,E.jsxs)("div",{children:[(0,E.jsx)(p.A,{color:"green",children:n}),i>0&&(0,E.jsxs)(p.A,{color:"orange",children:["Pending: ",i]})]})}}];return(0,E.jsxs)(s.A,{title:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(m.A,{style:{color:"#1890ff"}}),(0,E.jsx)("span",{children:"Purchase Order Details"})]}),open:i,onCancel:a,width:1200,footer:[(0,E.jsx)(g.Ay,{type:"primary",onClick:a,children:"Close"},"close")],children:[(0,E.jsxs)(oe.A,{bordered:!0,column:2,size:"small",children:[(0,E.jsx)(oe.A.Item,{label:"PO Number",span:1,children:(0,E.jsx)(p.A,{color:"blue",icon:(0,E.jsx)(m.A,{}),children:o.po_number})}),(0,E.jsx)(oe.A.Item,{label:"Status",span:1,children:(0,E.jsx)(h.A,{status:N.color,text:(0,E.jsx)(p.A,{color:N.color,children:N.label})})}),(0,E.jsx)(oe.A.Item,{label:"Vendor",span:2,children:b?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(P.A,{style:{marginRight:8}}),(0,E.jsx)("strong",{children:b.vendor_name||"N/A"}),b.company_name&&(0,E.jsx)("div",{style:{fontSize:"12px",color:"#888",marginTop:4},children:b.company_name}),b.email&&(0,E.jsxs)("div",{style:{fontSize:"12px",color:"#888",marginTop:4},children:["\ud83d\udce7 ",b.email]}),b.phone&&(0,E.jsxs)("div",{style:{fontSize:"12px",color:"#888"},children:["\ud83d\udcde ",b.phone]}),b.address&&(0,E.jsxs)("div",{style:{fontSize:"12px",color:"#888",marginTop:4},children:["\ud83d\udccd ",b.address]})]}):(0,E.jsxs)("span",{style:{color:"#999"},children:[(0,E.jsx)(P.A,{style:{marginRight:8}}),"Vendor information not available"]})}),(0,E.jsxs)(oe.A.Item,{label:"PO Date",children:[(0,E.jsx)(q.A,{style:{marginRight:8}}),f()(o.po_date).format("DD/MM/YYYY")]}),(0,E.jsxs)(oe.A.Item,{label:"Expected Delivery",children:[(0,E.jsx)(q.A,{style:{marginRight:8}}),o.expected_delivery_date?f()(o.expected_delivery_date).format("DD/MM/YYYY"):"-"]}),(0,E.jsx)(oe.A.Item,{label:"Warehouse",children:w?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ce.A,{style:{marginRight:8}}),(0,E.jsx)("strong",{children:w.warehouse_name||"N/A"}),w.warehouse_code&&(0,E.jsxs)("div",{style:{fontSize:"12px",color:"#888",marginTop:4},children:["Code: ",w.warehouse_code]}),w.address&&(0,E.jsxs)("div",{style:{fontSize:"12px",color:"#888",marginTop:4},children:["\ud83d\udccd ",w.address]}),w.manager&&(0,E.jsxs)("div",{style:{fontSize:"12px",color:"#888",marginTop:4},children:["\ud83d\udc64 Manager: ",w.manager]})]}):(0,E.jsxs)("span",{style:{color:"#999"},children:[(0,E.jsx)(ce.A,{style:{marginRight:8}}),"Warehouse information not available"]})}),(0,E.jsx)(oe.A.Item,{label:"Payment Terms",children:null===(t=o.payment_terms)||void 0===t?void 0:t.replace("_"," ").toUpperCase()}),(0,E.jsx)(oe.A.Item,{label:"Created By",span:2,children:o.created_by_name})]}),(0,E.jsx)(ne.A,{orientation:"left",children:"Financial Summary"}),(0,E.jsxs)(oe.A,{bordered:!0,column:4,size:"small",children:[(0,E.jsxs)(oe.A.Item,{label:"Subtotal",children:[(0,E.jsx)(R.A,{style:{marginRight:8}}),"\u20b9",(Number(o.subtotal)||0).toLocaleString("en-IN",{minimumFractionDigits:2})]}),(0,E.jsxs)(oe.A.Item,{label:"Tax Amount",children:["\u20b9",(Number(o.tax_amount)||0).toLocaleString("en-IN",{minimumFractionDigits:2})]}),(0,E.jsx)(oe.A.Item,{label:"Total Amount",children:(0,E.jsxs)("strong",{style:{color:"#52c41a",fontSize:"16px"},children:["\u20b9",(Number(o.total_amount)||0).toLocaleString("en-IN",{minimumFractionDigits:2})]})}),(0,E.jsx)(oe.A.Item,{label:"Paid Amount",children:(0,E.jsxs)(me,{strong:!0,style:{color:"#1890ff"},children:["\u20b9",(Number(o.paid_amount)||0).toLocaleString("en-IN",{minimumFractionDigits:2})]})}),(0,E.jsx)(oe.A.Item,{label:"Outstanding",span:4,children:(0,E.jsxs)("strong",{style:{color:"#ff4d4f",fontSize:"18px"},children:["\u20b9",(Number(o.outstanding_amount)||0).toLocaleString("en-IN",{minimumFractionDigits:2})]})})]}),(0,E.jsx)(ne.A,{orientation:"left",children:"Line Items"}),(0,E.jsx)(Q.A,{columns:C,dataSource:o.items||[],rowKey:(e,t)=>"item-".concat(t),pagination:!1,size:"small",bordered:!0,scroll:{x:1e3}}),(()=>{const e=(null===_||void 0===_?void 0:_.result)||_||[],t=Array.isArray(e)?e:[];return t.length>0?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ne.A,{orientation:"left",children:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(S.A,{}),(0,E.jsxs)("span",{children:["GRN Receipts (",t.length,")"]})]})}),(0,E.jsx)(Q.A,{columns:[{title:"GRN Number",dataIndex:"grn_number",key:"grn_number",render:e=>(0,E.jsx)(p.A,{color:"blue",icon:(0,E.jsx)(m.A,{}),children:e})},{title:"GRN Date",dataIndex:"grn_date",key:"grn_date",render:e=>f()(e).format("DD/MM/YYYY")},{title:"Vendor Invoice",key:"vendor_invoice",render:e=>(0,E.jsx)("div",{children:e.vendor_invoice_no?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{children:e.vendor_invoice_no}),e.vendor_invoice_date&&(0,E.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:f()(e.vendor_invoice_date).format("DD/MM/YYYY")})]}):(0,E.jsx)(me,{type:"secondary",children:"-"})})},{title:"Total Amount",dataIndex:"total_amount",key:"total_amount",render:e=>(0,E.jsxs)(me,{strong:!0,children:["\u20b9",(Number(e)||0).toLocaleString("en-IN",{minimumFractionDigits:2})]})},{title:"Received By",dataIndex:"received_by_name",key:"received_by_name",render:e=>e||"-"}],dataSource:t,rowKey:e=>e._id||e.id,pagination:!1,size:"small",bordered:!0})]}):null})(),A&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ne.A,{orientation:"left",children:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(k.A,{}),(0,E.jsx)("span",{children:"Ordered vs Received Comparison"})]})}),(0,E.jsx)(Q.A,{columns:[{title:"Product",key:"product",render:e=>(0,E.jsxs)("div",{children:[(0,E.jsx)(me,{strong:!0,children:e.product_name||"N/A"}),e.variant_name&&(0,E.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:e.variant_name})]})},{title:"Ordered",dataIndex:"ordered_quantity",key:"ordered_quantity",render:e=>(0,E.jsx)(p.A,{color:"blue",children:e||0})},{title:"Received",dataIndex:"received_quantity",key:"received_quantity",render:(e,t)=>{const n=Number(t.ordered_quantity)||0,i=Number(e)||0,r=n-i,a=n>0?(i/n*100).toFixed(1):"0";return(0,E.jsxs)("div",{children:[(0,E.jsx)(p.A,{color:i===n?"green":i>0?"orange":"default",children:i}),r>0&&(0,E.jsxs)("div",{style:{fontSize:"12px",color:"#888",marginTop:4},children:["Pending: ",r," (",a,"% fulfilled)"]})]})}},{title:"Status",key:"fulfillment_status",render:e=>{const t=Number(e.ordered_quantity)||0,n=Number(e.received_quantity)||0;return 0===n?(0,E.jsx)(p.A,{color:"default",children:"Not Received"}):n===t?(0,E.jsx)(p.A,{color:"green",icon:(0,E.jsx)(k.A,{}),children:"Fully Received"}):n<t?(0,E.jsx)(p.A,{color:"orange",children:"Partially Received"}):(0,E.jsx)(p.A,{color:"red",children:"Over Received"})}}],dataSource:(null===A||void 0===A||null===(n=A.result)||void 0===n?void 0:n.items)||(null===A||void 0===A?void 0:A.items)||[],rowKey:(e,t)=>"comparison-".concat(t),pagination:!1,size:"small",bordered:!0})]}),o.notes&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ne.A,{orientation:"left",children:"Notes"}),(0,E.jsx)("div",{style:{padding:"12px",background:"#fafafa",borderRadius:"4px"},children:o.notes})]}),(0,E.jsx)(ne.A,{orientation:"left",children:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(z.A,{}),(0,E.jsx)("span",{children:"Payment History"})]})}),(()=>{let e=[];if(y){const t=y;Array.isArray(t)?e=t:t.result&&(Array.isArray(t.result)?e=t.result:t.result.payments&&Array.isArray(t.result.payments)&&(e=t.result.payments))}const t=e;if(0===t.length)return(0,E.jsxs)("div",{style:{padding:"24px",textAlign:"center",color:"#999"},children:[(0,E.jsx)(z.A,{style:{fontSize:"32px",marginBottom:"8px"}}),(0,E.jsx)("div",{children:"No payments recorded yet"})]});const n=[{title:"Payment Date",dataIndex:"payment_date",key:"payment_date",sorter:(e,t)=>f()(e.payment_date).unix()-f()(t.payment_date).unix(),render:(e,t)=>(0,E.jsxs)(j.A,{children:[(0,E.jsx)(q.A,{}),f()(e).format("DD/MM/YYYY"),"advance"===t.payment_type&&(0,E.jsx)(p.A,{color:"orange",children:"Advance"})]})},{title:"Payment Amount",dataIndex:"payment_amount",key:"payment_amount",render:e=>(0,E.jsxs)(me,{strong:!0,style:{color:"#52c41a",fontSize:"15px"},children:["\u20b9",(Number(e)||0).toLocaleString("en-IN",{minimumFractionDigits:2})]})},{title:"Payment Mode",dataIndex:"payment_mode",key:"payment_mode",render:e=>(0,E.jsx)(p.A,{color:{cash:"green",upi:"blue",card:"purple",bank_transfer:"cyan",cheque:"orange",other:"default"}[e]||"default",children:(null===e||void 0===e?void 0:e.replace("_"," ").toUpperCase())||"N/A"})},{title:"Transaction Details",key:"transaction_details",render:e=>e.cheque_number?(0,E.jsxs)("div",{children:[(0,E.jsxs)("div",{children:["Cheque: ",e.cheque_number]}),e.bank_name&&(0,E.jsxs)("div",{style:{fontSize:"12px",color:"#888"},children:["Bank: ",e.bank_name]})]}):e.transaction_id?(0,E.jsxs)("div",{children:[(0,E.jsxs)("div",{children:["Txn ID: ",e.transaction_id]}),e.bank_name&&(0,E.jsxs)("div",{style:{fontSize:"12px",color:"#888"},children:["Bank: ",e.bank_name]})]}):e.reference_number?(0,E.jsxs)("div",{children:["Ref: ",e.reference_number]}):"-"},{title:"Notes",dataIndex:"notes",key:"notes",render:e=>e||"-"},{title:"Paid By",dataIndex:"paid_by_name",key:"paid_by_name",render:e=>e||"-"}],i=t.reduce(((e,t)=>e+(Number(t.payment_amount)||0)),0),r=t.filter((e=>"advance"===e.payment_type||e.payment_date&&(null===o||void 0===o?void 0:o.actual_delivery_date)&&new Date(e.payment_date)<new Date(o.actual_delivery_date))).reduce(((e,t)=>e+(Number(t.payment_amount)||0)),0),a=i-r,d=Number(null===o||void 0===o?void 0:o.total_amount)||0,l=Number(null===o||void 0===o?void 0:o.outstanding_amount)||0,s=l<=0;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{style:{background:"#f6f8fa",padding:16,borderRadius:8,marginBottom:16,border:"1px solid #e8e8e8"},children:(0,E.jsxs)(j.A,{direction:"vertical",style:{width:"100%"},size:"small",children:[(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,E.jsx)(me,{strong:!0,style:{fontSize:"14px"},children:"Payment Summary"}),s&&(0,E.jsx)(p.A,{color:"green",icon:(0,E.jsx)(k.A,{}),children:"Fully Paid"})]}),(0,E.jsx)(ne.A,{style:{margin:"8px 0"}}),(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,E.jsx)(me,{children:"Total Amount:"}),(0,E.jsxs)(me,{strong:!0,children:["\u20b9",d.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,E.jsx)(me,{children:"Total Paid:"}),(0,E.jsxs)(me,{strong:!0,style:{color:"#52c41a"},children:["\u20b9",i.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),r>0&&(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#666"},children:[(0,E.jsx)(me,{children:" Advance Payments:"}),(0,E.jsxs)(me,{children:["\u20b9",r.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),a>0&&(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#666"},children:[(0,E.jsx)(me,{children:" \u2514 Normal Payments:"}),(0,E.jsxs)(me,{children:["\u20b9",a.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,E.jsx)(me,{strong:!0,children:"Outstanding:"}),(0,E.jsxs)(me,{strong:!0,style:{color:l>0?"#ff4d4f":"#52c41a"},children:["\u20b9",l.toLocaleString("en-IN",{minimumFractionDigits:2})]})]}),(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#666"},children:[(0,E.jsx)(me,{children:"Total Payments:"}),(0,E.jsxs)(me,{children:[t.length," transaction",1!==t.length?"s":""]})]})]})}),(0,E.jsx)(Q.A,{columns:n,dataSource:t,rowKey:e=>e._id||e.id,pagination:!1,size:"small",bordered:!0})]})})(),o.notes&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ne.A,{orientation:"left",children:"Notes"}),(0,E.jsx)("div",{style:{padding:"12px",background:"#fafafa",borderRadius:"4px"},children:o.notes})]}),o.terms_conditions&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ne.A,{orientation:"left",children:"Terms & Conditions"}),(0,E.jsx)("div",{style:{padding:"12px",background:"#fafafa",borderRadius:"4px"},children:o.terms_conditions})]})]})};var pe=n(89472),he=n(66507);const{TextArea:ye}=a.A,{Option:ve}=o.A,{Text:je}=se.A,_e=e=>{let{open:t,onClose:n,purchaseOrder:i,onSuccess:c}=e;const[u]=J.A.useForm(),[m,{isLoading:x}]=(0,ue.Ii)(),[p,h]=(0,r.useState)("cash"),y=(0,pe.getCurrentUser)(),v=Number(null===i||void 0===i?void 0:i.total_amount)||0,_=Number(null===i||void 0===i?void 0:i.paid_amount)||0,A=Math.max(0,v-_),b=void 0!==(null===i||void 0===i?void 0:i.outstanding_amount)&&null!==(null===i||void 0===i?void 0:i.outstanding_amount)?Number(i.outstanding_amount):null,w=null===b||isNaN(b)?A:Math.max(0,b),k=he.A.getItem("scope"),I=(null===i||void 0===i?void 0:i.organisation_id)||(null===y||void 0===y?void 0:y.organisation_id)||(null===k||void 0===k?void 0:k.organisationId),N=(null===i||void 0===i?void 0:i.branch_id)||(null===y||void 0===y?void 0:y.branch_id)||(null===k||void 0===k?void 0:k.branchId),S=(null===i||void 0===i?void 0:i.tenant_id)||(null===k||void 0===k?void 0:k.tenantId);(0,r.useEffect)((()=>{t&&i&&(u.setFieldsValue({payment_date:f()(),payment_amount:void 0,payment_mode:"bank_transfer",transaction_id:void 0,cheque_number:void 0,bank_name:void 0,reference_number:void 0}),h("bank_transfer"))}),[t,i,u]);const C=e=>{const t=w*e/100;u.setFieldsValue({payment_amount:Number(t.toFixed(2))})},D=async()=>{try{const e=await u.validateFields();if(e.payment_amount<=0)return void l.Ay.error("Payment amount must be greater than 0");if(e.payment_amount>w)return void l.Ay.error("Payment amount cannot exceed outstanding amount of \u20b9".concat(w.toFixed(2)));const t=["sent","confirmed","partially_received","fully_received","closed"],r=null===i||void 0===i?void 0:i.status;if(!t.includes(r))return void l.Ay.error('Payments cannot be recorded for PO in "'.concat(r,'" status. PO must be sent to vendor first.'));if(!I||!S)return void l.Ay.error("Organisation and Tenant information is required");const a=["sent","confirmed"].includes(r)&&!(null!==i&&void 0!==i&&i.is_partially_received)&&!(null!==i&&void 0!==i&&i.is_fully_received);if(null===i||void 0===i||!i._id)return void l.Ay.error("Purchase Order ID is missing");const o={purchase_order_id:i._id,payment_date:e.payment_date.format("YYYY-MM-DD"),payment_amount:e.payment_amount,payment_mode:e.payment_mode,organisation_id:I,tenant_id:S,notes:e.notes||void 0,paid_by_id:(null===y||void 0===y?void 0:y._id)||void 0,paid_by_name:(null===y||void 0===y?void 0:y.username)||(null===y||void 0===y?void 0:y.name)||void 0};N&&(o.branch_id=N),"cheque"===e.payment_mode?(e.cheque_number&&(o.cheque_number=e.cheque_number),e.bank_name&&(o.bank_name=e.bank_name)):["upi","card","bank_transfer"].includes(e.payment_mode)&&(e.transaction_id&&(o.transaction_id=e.transaction_id),e.bank_name&&"bank_transfer"===e.payment_mode&&(o.bank_name=e.bank_name)),e.reference_number&&(o.reference_number=e.reference_number),await m(o).unwrap();const d=w-e.payment_amount,s=a?"Advance ":"";d>0?l.Ay.success("".concat(s,"Payment of \u20b9").concat(e.payment_amount.toFixed(2)," recorded successfully! Remaining amount: \u20b9").concat(d.toFixed(2)),5):l.Ay.success("".concat(s,"Payment recorded successfully! Purchase order is now fully paid."),5),u.resetFields(),null===c||void 0===c||c(),n()}catch(r){var e,t;console.error("Payment creation error:",r);const n=(null===r||void 0===r||null===(e=r.data)||void 0===e?void 0:e.message)||(null===r||void 0===r||null===(t=r.data)||void 0===t?void 0:t.error)||(null===r||void 0===r?void 0:r.message)||"Failed to record payment";l.Ay.error(n)}},P=()=>{u.resetFields(),n()};return(0,E.jsxs)(s.A,{title:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(R.A,{style:{color:"#52c41a"}}),(0,E.jsx)("span",{children:"Record Payment"})]}),open:t,onCancel:P,width:800,footer:[(0,E.jsxs)(j.A,{style:{width:"100%",justifyContent:"flex-end"},children:[(0,E.jsx)(g.Ay,{onClick:P,children:"Cancel"}),(0,E.jsx)(g.Ay,{type:"primary",onClick:D,loading:x,style:{backgroundColor:"#52c41a",borderColor:"#52c41a"},children:"Record Payment"})]},"footer")],children:[(0,E.jsx)(X.A,{message:"Payment Information",description:(0,E.jsxs)("div",{children:[(0,E.jsxs)("div",{children:[(0,E.jsx)("strong",{children:"PO Number:"})," ",(null===i||void 0===i?void 0:i.po_number)||"N/A"]}),w>0&&(0,E.jsx)("div",{style:{marginTop:8,fontSize:"12px",color:"#666"},children:"\ud83d\udca1 You can record partial payments. Multiple payments can be made until the full amount is paid."})]}),type:"info",showIcon:!0,style:{marginBottom:16}}),(0,E.jsx)("div",{style:{background:"#f6f8fa",padding:16,borderRadius:8,marginBottom:16},children:(0,E.jsxs)(j.A,{direction:"vertical",style:{width:"100%"},size:"small",children:[(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,E.jsx)(je,{strong:!0,children:"Total Amount:"}),(0,E.jsxs)(je,{strong:!0,children:["\u20b9",(Number(v)||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,E.jsx)(je,{children:"Paid Amount:"}),(0,E.jsxs)(je,{style:{color:"#52c41a"},children:["\u20b9",(Number(_)||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),_>0&&(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#666"},children:[(0,E.jsx)(je,{children:"Payment Progress:"}),(0,E.jsxs)(je,{children:[(Number(_)/Number(v)*100).toFixed(1),"%"]})]}),(0,E.jsx)(ne.A,{style:{margin:"8px 0"}}),(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,E.jsx)(je,{strong:!0,children:"Outstanding Amount:"}),(0,E.jsxs)(je,{strong:!0,style:{color:"#ff4d4f",fontSize:"16px"},children:["\u20b9",w.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})}),(0,E.jsxs)(J.A,{form:u,layout:"vertical",onFinish:D,children:[(0,E.jsxs)(ee.A,{gutter:16,children:[(0,E.jsx)(te.A,{xs:24,sm:12,children:(0,E.jsx)(J.A.Item,{name:"payment_date",label:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(q.A,{}),(0,E.jsx)("span",{children:"Payment Date"})]}),rules:[{required:!0,message:"Please select payment date"}],children:(0,E.jsx)(d.A,{style:{width:"100%"},format:"YYYY-MM-DD",disabledDate:e=>e&&e>f()().endOf("day")})})}),(0,E.jsx)(te.A,{xs:24,sm:12,children:(0,E.jsx)(J.A.Item,{name:"payment_amount",label:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(R.A,{}),(0,E.jsx)("span",{children:"Payment Amount"}),(0,E.jsx)("span",{style:{color:"red"},children:"*"})]}),extra:w>0?(0,E.jsxs)("div",{style:{marginTop:8},children:[(0,E.jsx)(je,{type:"secondary",style:{fontSize:"12px",display:"block",marginBottom:8},children:"Quick amount selection (partial payments allowed):"}),(0,E.jsxs)(j.A,{size:"small",wrap:!0,children:[(0,E.jsx)(g.Ay,{size:"small",type:"link",onClick:()=>C(25),style:{padding:"0 8px",fontSize:"12px"},children:"25%"}),(0,E.jsx)(g.Ay,{size:"small",type:"link",onClick:()=>C(50),style:{padding:"0 8px",fontSize:"12px"},children:"50%"}),(0,E.jsx)(g.Ay,{size:"small",type:"link",onClick:()=>C(75),style:{padding:"0 8px",fontSize:"12px"},children:"75%"}),(0,E.jsxs)(g.Ay,{size:"small",type:"link",onClick:()=>C(100),style:{padding:"0 8px",fontSize:"12px",color:"#52c41a"},children:["Full (\u20b9",w.toFixed(2),")"]})]})]}):(0,E.jsxs)(je,{type:"secondary",style:{fontSize:"12px"},children:["Enter payment amount (max: \u20b9",w.toFixed(2),")"]}),rules:[{required:!0,message:"Please enter payment amount"},{type:"number",min:.01,message:"Amount must be greater than 0"},{validator:(e,t)=>t&&t>w?Promise.reject(new Error("Amount cannot exceed outstanding amount of \u20b9".concat(w.toFixed(2)))):Promise.resolve()}],children:(0,E.jsx)(U.A,{style:{width:"100%"},prefix:"\u20b9",placeholder:"Enter amount (max: \u20b9".concat(w.toFixed(2),")"),min:.01,max:w,step:.01,precision:2,formatter:e=>"".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>{const t=(null===e||void 0===e?void 0:e.replace(/\$\s?|(,*)/g,""))||"0";return Number(t)||0}})})})]}),(0,E.jsxs)(ee.A,{gutter:16,children:[(0,E.jsx)(te.A,{xs:24,sm:12,children:(0,E.jsx)(J.A.Item,{name:"payment_mode",label:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(z.A,{}),(0,E.jsx)("span",{children:"Payment Mode"}),(0,E.jsx)("span",{style:{color:"red"},children:"*"})]}),rules:[{required:!0,message:"Please select payment mode"}],children:(0,E.jsxs)(o.A,{placeholder:"Select payment mode",onChange:e=>h(e),children:[(0,E.jsx)(ve,{value:"cash",children:"Cash"}),(0,E.jsx)(ve,{value:"upi",children:"UPI"}),(0,E.jsx)(ve,{value:"card",children:"Card"}),(0,E.jsx)(ve,{value:"bank_transfer",children:"Bank Transfer"}),(0,E.jsx)(ve,{value:"cheque",children:"Cheque"}),(0,E.jsx)(ve,{value:"other",children:"Other"})]})})}),"other"!==p&&(0,E.jsx)(te.A,{xs:24,sm:12,children:(0,E.jsx)(J.A.Item,{name:"reference_number",label:"Reference Number (Optional)",extra:"Additional reference number if needed",children:(0,E.jsx)(a.A,{placeholder:"Optional: Enter reference number"})})})]}),"cheque"===p&&(0,E.jsxs)(ee.A,{gutter:16,children:[(0,E.jsx)(te.A,{xs:24,sm:12,children:(0,E.jsx)(J.A.Item,{name:"cheque_number",label:"Cheque Number",children:(0,E.jsx)(a.A,{placeholder:"Enter cheque number"})})}),(0,E.jsx)(te.A,{xs:24,sm:12,children:(0,E.jsx)(J.A.Item,{name:"bank_name",label:"Bank Name",children:(0,E.jsx)(a.A,{placeholder:"Enter bank name"})})})]}),["upi","card"].includes(p)&&(0,E.jsx)(ee.A,{gutter:16,children:(0,E.jsx)(te.A,{xs:24,sm:12,children:(0,E.jsx)(J.A.Item,{name:"transaction_id",label:"Transaction ID",children:(0,E.jsx)(a.A,{placeholder:"Enter transaction ID"})})})}),"bank_transfer"===p&&(0,E.jsxs)(ee.A,{gutter:16,children:[(0,E.jsx)(te.A,{xs:24,sm:12,children:(0,E.jsx)(J.A.Item,{name:"transaction_id",label:"Transaction ID",children:(0,E.jsx)(a.A,{placeholder:"Enter transaction ID or reference number"})})}),(0,E.jsx)(te.A,{xs:24,sm:12,children:(0,E.jsx)(J.A.Item,{name:"bank_name",label:"Bank Name",children:(0,E.jsx)(a.A,{placeholder:"Enter bank name"})})})]}),"other"===p&&(0,E.jsx)(ee.A,{gutter:16,children:(0,E.jsx)(te.A,{xs:24,sm:12,children:(0,E.jsx)(J.A.Item,{name:"reference_number",label:"Reference Number",children:(0,E.jsx)(a.A,{placeholder:"Enter reference number"})})})}),(0,E.jsx)(ee.A,{gutter:16,children:(0,E.jsx)(te.A,{xs:24,children:(0,E.jsx)(J.A.Item,{name:"notes",label:"Notes",children:(0,E.jsx)(ye,{rows:3,placeholder:"Optional: Add notes about this payment"})})})})]})]})};var ge=n(72411),Ae=n(4413);const fe=e=>{var t,n,i;let{open:r,onClose:a,grnId:o,grnData:d}=e;const{data:l,isLoading:c}=(0,G.dm)(o||"",{skip:!r||!o||!!d}),u=d||(null===l||void 0===l?void 0:l.result)||{},x=[{title:"Product",key:"product",width:200,render:e=>{var t;return(0,E.jsxs)("div",{children:[(0,E.jsx)("strong",{children:e.product_name||(null===(t=e.ProductItem)||void 0===t?void 0:t.name)||"-"}),e.variant_name&&(0,E.jsx)("div",{style:{fontSize:"11px",color:"#888"},children:e.variant_name})]})}},{title:"Ordered Qty",key:"ordered_quantity",width:100,render:e=>(0,E.jsx)(p.A,{color:"blue",children:e.ordered_quantity||0})},{title:"Received Qty",key:"received_quantity",width:100,render:e=>(0,E.jsx)(p.A,{color:"green",children:e.received_quantity||0})},{title:"Rejected Qty",key:"rejected_quantity",width:100,render:e=>e.rejected_quantity>0?(0,E.jsx)(p.A,{color:"red",children:e.rejected_quantity}):(0,E.jsx)("span",{style:{color:"#999"},children:"-"})},{title:"Accepted Qty",key:"accepted_quantity",width:100,render:e=>(0,E.jsx)("strong",{style:{color:"#52c41a"},children:e.accepted_quantity||0})},{title:"Unit Price",key:"unit_price",width:120,render:e=>(0,E.jsxs)("span",{children:["\u20b9",(Number(e.unit_price)||0).toFixed(2)]})},{title:"GST %",key:"tax_percentage",width:80,render:e=>(0,E.jsxs)("span",{children:[e.tax_percentage||0,"%"]})},{title:"Batch No",key:"batch_no",width:120,render:e=>e.batch_no||"-"},{title:"Expiry Date",key:"expiry_date",width:120,render:e=>e.expiry_date?f()(e.expiry_date).format("DD/MM/YYYY"):"-"}];return(0,E.jsxs)(s.A,{title:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(m.A,{style:{color:"#1890ff"}}),(0,E.jsxs)("span",{children:["GRN Details - ",u.grn_number]})]}),open:r,onCancel:a,width:1400,footer:null,children:[(0,E.jsx)(X.A,{message:"Goods Receipt Note (GRN)",description:"Complete details of the goods receipt note including all received items and financial information.",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,E.jsxs)(oe.A,{bordered:!0,column:2,size:"small",style:{marginBottom:24},children:[(0,E.jsx)(oe.A.Item,{label:"GRN Number",children:(0,E.jsx)(p.A,{color:"purple",style:{fontSize:"13px"},children:u.grn_number})}),(0,E.jsx)(oe.A.Item,{label:"GRN Date",children:(0,E.jsxs)(j.A,{children:[(0,E.jsx)(q.A,{}),u.grn_date?f()(u.grn_date).format("DD/MM/YYYY"):"-"]})}),(0,E.jsx)(oe.A.Item,{label:"PO Number",children:(0,E.jsx)(p.A,{color:"blue",children:u.po_number||(null===(t=u.PurchaseOrderItem)||void 0===t?void 0:t.po_number)||"-"})}),(0,E.jsx)(oe.A.Item,{label:"Vendor",children:(null===(n=u.vendor)||void 0===n?void 0:n.vendor_name)||u.vendor_name||"-"}),(0,E.jsx)(oe.A.Item,{label:"Vendor Invoice Number",children:u.vendor_invoice_no?(0,E.jsx)(p.A,{color:"green",children:u.vendor_invoice_no}):"-"}),(0,E.jsx)(oe.A.Item,{label:"Vendor Invoice Date",children:u.vendor_invoice_date?f()(u.vendor_invoice_date).format("DD/MM/YYYY"):"-"}),(0,E.jsx)(oe.A.Item,{label:"Received By",children:u.received_by_name||"-"}),(0,E.jsx)(oe.A.Item,{label:"Warehouse",children:(null===(i=u.warehouse)||void 0===i?void 0:i.warehouse_name)||u.warehouse_name||"-"})]}),(0,E.jsx)(ne.A,{children:"Received Items"}),(0,E.jsx)(Q.A,{columns:x,dataSource:u.items||[],rowKey:(e,t)=>"item-".concat(t),loading:c,pagination:!1,size:"small",bordered:!0,scroll:{x:1200}}),(0,E.jsx)(ne.A,{children:"Financial Summary"}),(0,E.jsxs)(ee.A,{gutter:16,style:{marginBottom:16},children:[(0,E.jsx)(te.A,{span:6,children:(0,E.jsx)(ie.A,{title:"Subtotal",value:Number(u.subtotal)||0,prefix:"\u20b9",precision:2})}),(0,E.jsx)(te.A,{span:6,children:(0,E.jsx)(ie.A,{title:"Tax Amount",value:Number(u.tax_amount)||0,prefix:"\u20b9",precision:2,valueStyle:{color:"#1890ff"}})}),(0,E.jsx)(te.A,{span:6,children:(0,E.jsx)(ie.A,{title:"Shipping Cost",value:Number(u.shipping_cost)||0,prefix:"\u20b9",precision:2})}),(0,E.jsx)(te.A,{span:6,children:(0,E.jsx)(ie.A,{title:"Total Amount",value:Number(u.total_amount)||0,prefix:"\u20b9",precision:2,valueStyle:{color:"#52c41a",fontSize:"20px",fontWeight:"bold"}})})]}),u.notes&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ne.A,{children:"Notes"}),(0,E.jsx)(X.A,{message:u.notes,type:"info",showIcon:!1,style:{marginBottom:16}})]})]})},be=()=>{const[e,t]=(0,r.useState)(""),[n,o]=(0,r.useState)({current:1,pageSize:10}),[d,l]=(0,r.useState)(null),[s,c]=(0,r.useState)(!1),{data:u,isLoading:m}=(0,G.aU)({pageNumber:n.current,pageLimit:n.pageSize,searchString:e.length>2||0===e.length?e:void 0}),x=(0,r.useMemo)((()=>(null===u||void 0===u?void 0:u.result)||[]),[u]),h=(0,r.useMemo)((()=>(null===u||void 0===u?void 0:u.pagination)||{}),[u]),v=(0,r.useCallback)((e=>{t(e),o((0,i.A)((0,i.A)({},n),{},{current:1}))}),[n]),_=[{title:"GRN Number",key:"grn_number",width:150,render:e=>(0,E.jsx)(p.A,{color:"purple",style:{fontSize:"13px",padding:"4px 12px"},children:e.grn_number})},{title:"GRN Date",key:"grn_date",width:120,render:e=>(0,E.jsxs)(j.A,{children:[(0,E.jsx)(q.A,{}),f()(e.grn_date).format("DD/MM/YYYY")]})},{title:"PO Number",key:"po_number",width:150,render:e=>{var t;return(0,E.jsx)(p.A,{color:"blue",children:e.po_number||(null===(t=e.PurchaseOrderItem)||void 0===t?void 0:t.po_number)||"-"})}},{title:"Vendor",key:"vendor",width:200,render:e=>{var t,n;return(0,E.jsxs)("div",{children:[(0,E.jsx)("strong",{children:(null===(t=e.vendor)||void 0===t?void 0:t.vendor_name)||e.vendor_name||"-"}),(null===(n=e.VendorItem)||void 0===n?void 0:n.company_name)&&(0,E.jsx)("div",{style:{fontSize:"11px",color:"#888"},children:e.VendorItem.company_name})]})}},{title:"Vendor Invoice",key:"vendor_invoice",width:180,render:e=>(0,E.jsx)("div",{children:e.vendor_invoice_no?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(p.A,{color:"green",children:e.vendor_invoice_no}),e.vendor_invoice_date&&(0,E.jsx)("div",{style:{fontSize:"11px",color:"#888",marginTop:"4px"},children:f()(e.vendor_invoice_date).format("DD/MM/YYYY")})]}):(0,E.jsx)("span",{style:{color:"#999"},children:"-"})})},{title:"Items",key:"items_count",width:100,render:e=>{var t;return(0,E.jsxs)(p.A,{children:[(null===(t=e.items)||void 0===t?void 0:t.length)||0," items"]})}},{title:"Received By",key:"received_by",width:150,render:e=>e.received_by_name||"-"},{title:"Subtotal",key:"subtotal",width:120,render:e=>(0,E.jsxs)("span",{style:{fontWeight:500},children:["\u20b9",(Number(e.subtotal)||0).toLocaleString("en-IN",{minimumFractionDigits:2})]})},{title:"Tax Amount",key:"tax_amount",width:120,render:e=>(0,E.jsxs)("span",{style:{color:"#1890ff"},children:["\u20b9",(Number(e.tax_amount)||0).toLocaleString("en-IN",{minimumFractionDigits:2})]})},{title:"Total Amount",key:"total_amount",width:130,render:e=>(0,E.jsxs)("strong",{style:{color:"#52c41a",fontSize:"14px"},children:["\u20b9",(Number(e.total_amount)||0).toLocaleString("en-IN",{minimumFractionDigits:2})]})},{title:"Actions",key:"actions",width:100,fixed:"right",render:(e,t)=>(0,E.jsx)(j.A,{children:(0,E.jsx)(y.A,{title:"View GRN Details",children:(0,E.jsx)(g.Ay,{type:"link",icon:(0,E.jsx)(Y.A,{}),onClick:()=>(e=>{l(e),c(!0)})(t),children:"View"})})})}];return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(ee.A,{justify:"space-between",align:"middle",style:{marginBottom:16},children:[(0,E.jsxs)("div",{children:[(0,E.jsx)("h2",{style:{margin:0,fontSize:"20px",fontWeight:600},children:"Goods Receipt Notes (GRN)"}),(0,E.jsx)("p",{style:{margin:"4px 0 0 0",color:"#888",fontSize:"14px"},children:"View and manage all goods receipt notes"})]}),(0,E.jsx)("div",{style:{display:"flex",gap:"16px",alignItems:"center"},children:(0,E.jsx)(a.A,{placeholder:"Search by GRN number, PO number, or vendor...",prefix:(0,E.jsx)(ge.A,{}),value:e,onChange:e=>v(e.target.value),style:{width:300},allowClear:!0})})]}),(0,E.jsx)(Ae.A,{columns:_,data:x,rowKey:"_id",loading:m,totalCount:h.totalCount||0,pageLimit:h.pageLimit||10,onPaginationChange:(e,t)=>{o({current:e,pageSize:t})}}),(0,E.jsx)(fe,{open:s,onClose:()=>{c(!1),l(null)},grnId:null===d||void 0===d?void 0:d._id,grnData:d})]})},{TextArea:we}=a.A,{Option:ke}=o.A,Ie=()=>{const e=(0,pe.getCurrentUser)(),[t,n]=(0,r.useState)("purchase-orders"),[A,b]=(0,r.useState)(!1),[U,W]=(0,r.useState)(!1),[Q,H]=(0,r.useState)(!1),[K,Z]=(0,r.useState)(!1),[J,X]=(0,r.useState)(!1),[ee,te]=(0,r.useState)(null),ne=(0,r.useMemo)((()=>({pageNumber:1,pageLimit:100})),[]),{data:ie,isLoading:re}=B.lh.useGetVendorQuery(ne),{data:oe,isLoading:se}=B.lh.useGetWarehouseQuery(ne),ce=(0,r.useMemo)((()=>(null===ie||void 0===ie?void 0:ie.result)||[]),[ie]),ue=(0,r.useMemo)((()=>(null===oe||void 0===oe?void 0:oe.result)||[]),[oe]),[me]=(0,G.Ek)(),[he]=(0,G.jw)(),[ye]=(0,G.Gg)(),ve=(0,r.useCallback)((e=>{const t=Number(e.quantity)||0,n=Number(e.unit_price)||0,i=Number(e.discount)||0;let r=t*n;return r-="percentage"===(e.discount_type||"percentage")?r*i/100:i,r}),[]),je=(0,r.useCallback)((function(){let e=0,t=0,n=0;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((i=>{const r=Number(i.quantity)||0,a=Number(i.unit_price)||0;if(a>0){const o=r*a,d=ve(i),l=Number(i.tax_percentage)||0;e+=d,t+=d*(l/100),n+=o-d}}));const i=e+t;return{subtotal:Number(e.toFixed(2)),tax_amount:Number(t.toFixed(2)),discount_amount:Number(n.toFixed(2)),total_amount:Number(i.toFixed(2)),outstanding_amount:Number(i.toFixed(2))}}),[ve]),ge=(0,r.useMemo)((()=>[{name:"po_number",label:"PO Number",rules:[{required:!1,message:"PO number is required"}],component:(0,E.jsx)(a.A,{placeholder:"Auto-generated or enter manually"})},{name:"po_date",label:"PO Date",initialValue:f()(),rules:[{required:!0,message:"PO date is required"}],component:(0,E.jsx)(d.A,{style:{width:"100%"},format:"YYYY-MM-DD"})},{name:"vendor_id",label:"Vendor",rules:[{required:!0,message:"Vendor is required"}],component:(0,E.jsx)(o.A,{showSearch:!0,placeholder:"Select vendor",loading:re,filterOption:(e,t)=>String((null===t||void 0===t?void 0:t.children)||"").toLowerCase().includes(e.toLowerCase()),children:ce.map((e=>(0,E.jsx)(ke,{value:e._id,children:e.vendor_name},e._id)))})},{name:"expected_delivery_date",label:"Expected Delivery Date",component:(0,E.jsx)(d.A,{style:{width:"100%"},format:"YYYY-MM-DD"})},{name:"warehouse_id",label:"Delivery Warehouse",rules:[{required:!0,message:"Warehouse is required"}],component:(0,E.jsx)(o.A,{showSearch:!0,placeholder:"Select warehouse",loading:se,filterOption:(e,t)=>String((null===t||void 0===t?void 0:t.children)||"").toLowerCase().includes(e.toLowerCase()),children:ue.map((e=>(0,E.jsx)(ke,{value:e._id,children:e.warehouse_name},e._id)))})},{name:"payment_terms",label:"Payment Terms",initialValue:"net_30",component:(0,E.jsxs)(o.A,{children:[(0,E.jsx)(ke,{value:"immediate",children:"Immediate"}),(0,E.jsx)(ke,{value:"net_7",children:"Net 7 Days"}),(0,E.jsx)(ke,{value:"net_15",children:"Net 15 Days"}),(0,E.jsx)(ke,{value:"net_30",children:"Net 30 Days"}),(0,E.jsx)(ke,{value:"net_60",children:"Net 60 Days"}),(0,E.jsx)(ke,{value:"net_90",children:"Net 90 Days"})]})},{name:"shipping_address",label:"Shipping Address",component:(0,E.jsx)(we,{rows:2,placeholder:"Delivery address"})},{name:"shipping_method",label:"Shipping Method",component:(0,E.jsx)(a.A,{placeholder:"e.g., Road Transport, Air Cargo"})},{name:"notes",label:"Notes",component:(0,E.jsx)(we,{rows:3,placeholder:"Additional notes or instructions"})},{name:"terms_conditions",label:"Terms & Conditions",component:(0,E.jsx)(we,{rows:3,placeholder:"Terms and conditions for this PO"})},{name:"items",label:"Line Items",rules:[{required:!0,message:"At least one item is required"},{validator:async(e,t)=>{if(!t||0===t.length)throw new Error("At least one item is required");if(t.some((e=>!e.product_id||!e.quantity)))throw new Error("All items must have product and quantity")}}],component:(0,E.jsx)($,{}),colSpan:3}]),[ce,ue,re,se]),Ae=(0,r.useMemo)((()=>({onView:e=>{te(e),Z(!0)},onEdit:()=>{},onDelete:async e=>l.Ay.info("Delete handled by GenericCrudPage"),onSubmit:async e=>{s.A.confirm({title:"Submit Purchase Order for Approval?",content:"Once submitted, the PO will be sent for approval and cannot be edited.",onOk:async()=>{try{await me({id:e._id}).unwrap(),l.Ay.success("Purchase order submitted for approval")}catch(n){var t;l.Ay.error((null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||"Failed to submit PO")}}})},onApprove:e=>{te(e),W(!0)},onReject:async e=>{s.A.confirm({title:"Reject Purchase Order?",content:(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:"Please provide a reason for rejection:"}),(0,E.jsx)(a.A.TextArea,{rows:3,id:"rejection-reason",placeholder:"Enter reason..."})]}),onOk:async()=>{var t;const n=null===(t=document.getElementById("rejection-reason"))||void 0===t?void 0:t.value;if(!n)return l.Ay.error("Rejection reason is required"),Promise.reject();try{await he({id:e._id,reason:n}).unwrap(),l.Ay.success("Purchase order rejected")}catch(r){var i;l.Ay.error((null===r||void 0===r||null===(i=r.data)||void 0===i?void 0:i.message)||"Failed to reject PO")}}})},onSend:e=>{te(e),H(!0)},onReceive:e=>{te(e),b(!0)},onPay:e=>{te(e),X(!0)},onCancel:async e=>{s.A.confirm({title:"Cancel Purchase Order?",content:"Are you sure you want to cancel this PO?",onOk:async()=>{try{await ye({id:e._id}).unwrap(),l.Ay.success("Purchase order cancelled")}catch(n){var t;l.Ay.error((null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||"Failed to cancel PO")}}})},onPrint:()=>l.Ay.info("Print functionality coming soon")})),[me,he,ye]),fe=(0,r.useCallback)((t=>{const n=je(t.items||[]);return(0,i.A)((0,i.A)((0,i.A)({},t),n),{},{po_date:t.po_date?f()(t.po_date).format("YYYY-MM-DD"):f()().format("YYYY-MM-DD"),expected_delivery_date:t.expected_delivery_date?f()(t.expected_delivery_date).format("YYYY-MM-DD"):void 0,status:t._id?t.status:"draft",created_by_id:null===e||void 0===e?void 0:e._id,created_by_name:null===e||void 0===e?void 0:e.username,paid_amount:t.paid_amount||0})}),[je,e]),Ie=(0,r.useMemo)((()=>{return{title:"Purchase Orders",entityName:"PurchaseOrder",columns:(e=Ae,[{title:"PO Number",dataIndex:"po_number",key:"po_number",fixed:"left",width:140,render:(e,t)=>(0,E.jsxs)("div",{children:[(0,E.jsx)(p.A,{icon:(0,E.jsx)(m.A,{}),color:"blue",style:{fontSize:"12px"},children:e}),t.is_urgent&&(0,E.jsx)(p.A,{color:"red",style:{marginTop:4},children:"URGENT"})]})},{title:"Status",dataIndex:"status",key:"status",width:160,filters:Object.keys(V).map((e=>({text:V[e].label,value:e}))),onFilter:(e,t)=>t.status===e,render:(e,t)=>{const n=V[e]||V.draft,i=t.expected_delivery_date&&f()(t.expected_delivery_date).isBefore(f()())&&!["fully_received","cancelled","closed"].includes(e);return(0,E.jsxs)("div",{children:[(0,E.jsx)(h.A,{status:n.color,text:(0,E.jsx)(p.A,{color:n.color,icon:n.icon,children:n.label})}),i&&(0,E.jsx)(p.A,{color:"red",icon:(0,E.jsx)(D.A,{}),style:{marginTop:4},children:"OVERDUE"})]})}},{title:"Vendor",dataIndex:"VendorItem",key:"vendor",width:180,render:(e,t)=>{const n=e||{vendor_name:t.vendor_name,company_name:""};return(0,E.jsx)(y.A,{title:n.company_name||"No company name",children:(0,E.jsxs)("div",{children:[(0,E.jsx)(P.A,{style:{marginRight:4,color:"#1890ff"}}),(0,E.jsx)("strong",{children:n.vendor_name||"-"}),n.company_name&&(0,E.jsx)("div",{style:{fontSize:"11px",color:"#888"},children:n.company_name})]})})}},{title:"PO Date",dataIndex:"po_date",key:"po_date",width:120,sorter:(e,t)=>f()(e.po_date).unix()-f()(t.po_date).unix(),render:e=>(0,E.jsxs)("span",{children:[(0,E.jsx)(q.A,{style:{marginRight:4}}),f()(e).format("DD/MM/YYYY")]})},{title:"Expected Delivery",dataIndex:"expected_delivery_date",key:"expected_delivery_date",width:140,sorter:(e,t)=>f()(e.expected_delivery_date||0).unix()-f()(t.expected_delivery_date||0).unix(),render:(e,t)=>{if(!e)return(0,E.jsx)("span",{style:{color:"#999"},children:"-"});const n=f()(e).isBefore(f()())&&!["fully_received","cancelled","closed"].includes(t.status),i=f()(e).diff(f()(),"days");return(0,E.jsx)(y.A,{title:n?"Overdue!":"".concat(i," days left"),children:(0,E.jsxs)("span",{style:{color:n?"#ff4d4f":i<=3?"#faad14":"inherit"},children:[(0,E.jsx)(q.A,{style:{marginRight:4}}),f()(e).format("DD/MM/YYYY")]})})}},{title:"Items",dataIndex:"items",key:"items_count",width:80,align:"center",render:e=>(0,E.jsxs)(p.A,{color:"geekblue",children:[(null===e||void 0===e?void 0:e.length)||0," items"]})},{title:"Total Amount",dataIndex:"total_amount",key:"total_amount",width:130,sorter:(e,t)=>(e.total_amount||0)-(t.total_amount||0),render:e=>(0,E.jsxs)("span",{style:{fontWeight:"bold",color:"#52c41a"},children:[(0,E.jsx)(R.A,{style:{marginRight:4}}),"\u20b9",null===e||void 0===e?void 0:e.toLocaleString("en-IN",{minimumFractionDigits:2})]})},{title:"Paid Amount",dataIndex:"paid_amount",key:"paid_amount",width:130,render:(e,t)=>{const n=t.total_amount||0,i=n>0?(e||0)/n*100:0;return(0,E.jsx)(y.A,{title:"".concat(i.toFixed(0),"% paid"),children:(0,E.jsxs)("div",{children:[(0,E.jsxs)("span",{style:{color:100===i?"#52c41a":"#faad14"},children:["\u20b9",(e||0).toLocaleString("en-IN",{minimumFractionDigits:2})]}),i>0&&i<100&&(0,E.jsxs)("div",{style:{fontSize:"11px",color:"#888"},children:["(",i.toFixed(0),"%)"]})]})})}},{title:"Outstanding",dataIndex:"outstanding_amount",key:"outstanding_amount",width:130,render:e=>(0,E.jsxs)("span",{style:{color:e>0?"#ff4d4f":"#52c41a"},children:["\u20b9",(e||0).toLocaleString("en-IN",{minimumFractionDigits:2})]})},{title:"Receipt Status",key:"receipt_status",width:140,render:e=>{var t,n;const i=(null===(t=e.items)||void 0===t?void 0:t.length)||0,r=(null===(n=e.items)||void 0===n?void 0:n.filter((e=>e.received_quantity>=e.quantity)).length)||0;return 0===r?(0,E.jsx)(p.A,{color:"default",children:"Not Received"}):r===i?(0,E.jsx)(p.A,{color:"green",icon:(0,E.jsx)(k.A,{}),children:"Complete"}):(0,E.jsxs)(p.A,{color:"orange",icon:(0,E.jsx)(w.A,{}),children:[r,"/",i]})}},{title:"Created By",dataIndex:"CreatedByUser",key:"created_by",width:130,render:e=>(0,E.jsx)(y.A,{title:null===e||void 0===e?void 0:e.email,children:(0,E.jsx)("span",{style:{fontSize:"12px"},children:(null===e||void 0===e?void 0:e.username)||"-"})})},{title:"Actions",key:"actions",fixed:"right",width:120,render:t=>{const n=(0,L.Tt)(L.eZ.PURCHASE_ORDER),i=(0,L.Ev)(L.eZ.PURCHASE_ORDER),r=(0,L.W9)(L.eZ.PURCHASE_ORDER),a=(["draft","rejected"].includes(t.status),t.status,(0,E.jsxs)(v.A,{children:[n&&(0,E.jsx)(v.A.Item,{icon:(0,E.jsx)(Y.A,{}),onClick:()=>e.onView(t),children:"View Details"},"view"),i&&(0,E.jsx)(v.A.Item,{icon:(0,E.jsx)(F.A,{}),onClick:()=>e.onSubmit(t),style:{color:"#1890ff"},disabled:"draft"!==t.status,children:"Submit for Approval"},"submit"),i&&(0,E.jsx)(v.A.Item,{icon:(0,E.jsx)(O.A,{}),onClick:()=>e.onApprove(t),style:{color:"#52c41a"},disabled:"pending_approval"!==t.status,children:"Approve PO"},"approve"),i&&(0,E.jsx)(v.A.Item,{icon:(0,E.jsx)(I.A,{}),onClick:()=>e.onReject(t),danger:!0,disabled:!["pending_approval","approved"].includes(t.status),children:"Reject PO"},"reject"),i&&(0,E.jsx)(v.A.Item,{icon:(0,E.jsx)(N.A,{}),onClick:()=>e.onSend(t),disabled:"approved"!==t.status,children:"Send to Vendor"},"send"),i&&(0,E.jsx)(v.A.Item,{icon:(0,E.jsx)(S.A,{}),onClick:()=>e.onReceive(t),style:{color:"#1890ff"},disabled:!["sent","confirmed","partially_received"].includes(t.status),children:"Receive Goods"},"receive"),n&&(0,E.jsx)(v.A.Item,{icon:(0,E.jsx)(M.A,{}),onClick:()=>e.onPrint(t),children:"Print / Download"},"print"),i&&t.outstanding_amount>0&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(v.A.Divider,{}),(0,E.jsx)(v.A.Item,{icon:(0,E.jsx)(z.A,{}),onClick:()=>e.onPay(t),style:{color:"#52c41a"},disabled:!["sent","confirmed","partially_received","fully_received","closed"].includes(t.status),children:"Record Payment"},"pay")]}),i&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(v.A.Divider,{}),(0,E.jsx)(v.A.Item,{icon:(0,E.jsx)(C.A,{}),onClick:()=>{window.confirm("Cancel this Purchase Order?")&&e.onCancel(t)},danger:!0,disabled:["cancelled","closed","fully_received"].includes(t.status),children:"Cancel PO"},"cancel")]})]}));return n||i||r?(0,E.jsx)(j.A,{size:"small",children:(n||i)&&(0,E.jsx)(_.A,{overlay:a,trigger:["click"],placement:"bottomRight",children:(0,E.jsx)(y.A,{title:"P/O Actions",children:(0,E.jsx)(g.Ay,{type:"primary",size:"small",icon:(0,E.jsx)(T.A,{}),children:"Actions"})})})}):null}}]),formItems:ge,formColumns:3,drawerWidth:1400,beforeSave:fe,canCreate:()=>(0,L.BA)(L.eZ.PURCHASE_ORDER),canEdit:e=>{const t=(0,L.Ev)(L.eZ.PURCHASE_ORDER),n=["draft","rejected"].includes(null===e||void 0===e?void 0:e.status);return t&&n},canDelete:e=>{const t=(0,L.W9)(L.eZ.PURCHASE_ORDER),n="draft"===(null===e||void 0===e?void 0:e.status);return t&&n}};var e}),[Ae,ge,fe]);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(c.A,{activeKey:t,onChange:n,type:"card",size:"large",items:[{key:"purchase-orders",label:(0,E.jsxs)("span",{children:[(0,E.jsx)(u.A,{})," Purchase Orders"]}),children:(0,E.jsx)(x.r,{config:Ie})},{key:"grn",label:(0,E.jsxs)("span",{children:[(0,E.jsx)(m.A,{})," GRN"]}),children:(0,E.jsx)(be,{})}]}),(0,E.jsx)(ae,{open:A,onClose:()=>{b(!1),te(null)},purchaseOrder:ee}),(0,E.jsx)(de,{open:U,onClose:()=>{W(!1),te(null)},purchaseOrder:ee}),(0,E.jsx)(le,{open:Q,onClose:()=>{H(!1),te(null)},purchaseOrder:ee}),(0,E.jsx)(xe,{open:K,onClose:()=>{Z(!1),te(null)},purchaseOrder:ee}),(0,E.jsx)(_e,{open:J,onClose:()=>{X(!1),te(null)},purchaseOrder:ee,onSuccess:()=>{X(!1)}})]})}},31219:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(65043),r=n(26666),a=n(66381);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(this,arguments)}const d=(e,t)=>i.createElement(a.A,o({},e,{ref:t,icon:r.A}));const l=i.forwardRef(d)},94733:(e,t,n)=>{n.d(t,{A:()=>l});var i=n(65043);const r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};var a=n(66381);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(this,arguments)}const d=(e,t)=>i.createElement(a.A,o({},e,{ref:t,icon:r}));const l=i.forwardRef(d)}}]);
//# sourceMappingURL=5148.6de8a75e.chunk.js.map