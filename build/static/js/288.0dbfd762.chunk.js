"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[288],{47288:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ge});var o=n(89379),i=n(53986),l=n(65043),a=n(71782),s=n(62305),d=n(76399),r=n(96651),c=n(6051),u=n(95206),m=n(60647),p=n(36621),v=n(98105),h=n(36091),x=n(6881),g=n(53722),y=n(11951),_=n(76401),j=n(61118),f=n(75388),b=n(94834),A=n(92003),S=n(9316),I=n(72411),w=n(73847),C=n(60446),D=n.n(C),k=n(66885),T=n(22671),P=n(45007),E=n(62751),N=n(39249),M=n(16569),B=n(8354),L=n(42261),F=n(46237),V=n(4394),Y=n(87977);const q="EmailSendModal_emailSendModal__BfdYk",z="EmailSendModal_emailSendHeader__C2GeM",G="EmailSendModal_emailSendContent__18hO-",R="EmailSendModal_emailForm__Dz-ws",O="EmailSendModal_formSection__XePkG",U="EmailSendModal_formActions__0+vVX",Q="EmailSendModal_emailPreview__z0YAf",W="EmailSendModal_previewContent__i+Cpp",H="EmailSendModal_previewHeader__Y+2Wh",K="EmailSendModal_previewBody__wL6Yl",X="EmailSendModal_htmlPreview__Lr4X+",J="EmailSendModal_previewActions__l-Y3Y",Z="EmailSendModal_billInfo__1yHvY",$="EmailSendModal_successState__gVP0P",ee="EmailSendModal_successIcon__levgm";var te=n(70579);const{Title:ne,Text:oe}=a.A,{TextArea:ie}=p.A,le=e=>{var t;let{visible:n,onClose:o,billData:i,customerEmail:a,customerName:d}=e;const[r]=s.A.useForm(),[m,v]=(0,l.useState)(!1),[h,x]=(0,l.useState)(!1),[g,y]=(0,l.useState)(null),[_,b]=(0,l.useState)(!1),[A,S]=(0,l.useState)(!1);(0,l.useEffect)((()=>{n&&a&&r.setFieldsValue({to:a,subject:"Invoice #".concat((null===i||void 0===i?void 0:i.invoice_no)||""," - ").concat(d||"")})}),[n,a,d,i,r]);const I=e=>{var t,n;return"\nDear ".concat((null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||"Valued Customer",",\n\nThank you for your business! Please find your invoice details below:\n\nInvoice Number: ").concat(e.invoice_no,"\nDate: ").concat(new Date(e.date).toLocaleDateString(),"\nTotal Amount: \u20b9").concat(e.total_amount||0,"\n\nItems:\n").concat((null===(n=e.Items)||void 0===n?void 0:n.map((e=>{var t;return"- ".concat(null===(t=e.productItems)||void 0===t?void 0:t.name," (").concat(e.qty," x \u20b9").concat(e.price,") = \u20b9").concat(e.amount)})).join("\n"))||"No items","\n\nPayment Status: ").concat(e.is_paid?"Paid":"Pending","\n\nThank you for choosing us!\n\nBest regards,\nSubriva Billing Team\n    ").trim()},w=e=>{var t,n,o;return'\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset="UTF-8">\n        <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .header { background: #f8f9fa; padding: 20px; text-align: center; }\n            .content { padding: 20px; }\n            .invoice-table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n            .invoice-table th, .invoice-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n            .invoice-table th { background-color: #f8f9fa; }\n            .total { font-weight: bold; font-size: 18px; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; margin-top: 20px; }\n        </style>\n    </head>\n    <body>\n        <div class="header">\n            <h1>Subriva Billing</h1>\n            <h2>Invoice #'.concat(e.invoice_no,'</h2>\n        </div>\n        \n        <div class="content">\n            <p>Dear <strong>').concat((null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||"Valued Customer",'</strong>,</p>\n            \n            <p>Thank you for your business! Please find your invoice details below:</p>\n            \n            <table class="invoice-table">\n                <tr>\n                    <th>Invoice Number</th>\n                    <td>').concat(e.invoice_no,"</td>\n                </tr>\n                <tr>\n                    <th>Date</th>\n                    <td>").concat(new Date(e.date).toLocaleDateString(),"</td>\n                </tr>\n                <tr>\n                    <th>Customer</th>\n                    <td>").concat((null===(n=e.customerDetails)||void 0===n?void 0:n.full_name)||"N/A",'</td>\n                </tr>\n            </table>\n            \n            <h3>Items:</h3>\n            <table class="invoice-table">\n                <thead>\n                    <tr>\n                        <th>Product</th>\n                        <th>Quantity</th>\n                        <th>Price</th>\n                        <th>Amount</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ').concat((null===(o=e.Items)||void 0===o?void 0:o.map((e=>{var t;return"\n                        <tr>\n                            <td>".concat((null===(t=e.productItems)||void 0===t?void 0:t.name)||"N/A","</td>\n                            <td>").concat(e.qty||0,"</td>\n                            <td>\u20b9").concat(e.price||0,"</td>\n                            <td>\u20b9").concat(e.amount||0,"</td>\n                        </tr>\n                    ")})).join(""))||'<tr><td colspan="4">No items</td></tr>','\n                </tbody>\n                <tfoot>\n                    <tr class="total">\n                        <td colspan="3">Total Amount</td>\n                        <td>\u20b9').concat(e.total_amount||0,"</td>\n                    </tr>\n                </tfoot>\n            </table>\n            \n            <p><strong>Payment Status:</strong> ").concat(e.is_paid?"Paid":"Pending",'</p>\n        </div>\n        \n        <div class="footer">\n            <p>Thank you for choosing us!</p>\n            <p><strong>Best regards,<br>Subriva Billing Team</strong></p>\n        </div>\n    </body>\n    </html>\n    ')},C=async e=>{if(i){b(!0);try{const t=sessionStorage.getItem("token"),n=sessionStorage.getItem("csrf-token"),l=await fetch("".concat("http://localhost:8249/","/email/send-invoice"),{method:"POST",headers:{"Content-Type":"application/json",token:t||"","x-csrf-token":n||""},body:JSON.stringify({customerEmail:e.to,invoiceData:i,subject:e.subject,customMessage:e.message||""})}),a=await l.json();a.success?(S(!0),M.Ay.success("Invoice sent successfully to ".concat(e.to)),setTimeout((()=>{o()}),2e3)):M.Ay.error(a.error||"Failed to send email")}catch(t){console.error("Error sending email:",t),M.Ay.error("Failed to send email. Please try again.")}finally{b(!1)}}else M.Ay.error("No bill data available")},D=()=>{r.validateFields().then(C)},k=()=>{r.resetFields(),x(!1),y(null),S(!1),o()};return(0,te.jsx)(E.A,{title:(0,te.jsxs)("div",{className:z,children:[(0,te.jsx)(f.A,{}),(0,te.jsx)("span",{children:"Send Invoice via Email"})]}),open:n,onCancel:k,width:900,className:q,footer:null,destroyOnClose:!0,children:(0,te.jsx)("div",{className:G,children:A?(0,te.jsxs)("div",{className:$,children:[(0,te.jsx)(F.A,{className:ee}),(0,te.jsx)(ne,{level:3,children:"Email Sent Successfully!"}),(0,te.jsxs)(oe,{type:"secondary",children:["The invoice has been sent to ",r.getFieldValue("to")]})]}):(0,te.jsxs)(te.Fragment,{children:[(0,te.jsxs)(s.A,{form:r,layout:"vertical",onFinish:D,className:R,children:[(0,te.jsxs)("div",{className:O,children:[(0,te.jsx)(ne,{level:4,children:"Email Details"}),(0,te.jsx)(s.A.Item,{label:"To",name:"to",rules:[{required:!0,message:"Please enter recipient email"},{type:"email",message:"Please enter valid email address"}],children:(0,te.jsx)(p.A,{prefix:(0,te.jsx)(f.A,{}),placeholder:"customer@example.com",size:"large"})}),(0,te.jsx)(s.A.Item,{label:"Subject",name:"subject",rules:[{required:!0,message:"Please enter email subject"}],children:(0,te.jsx)(p.A,{placeholder:"Invoice subject",size:"large"})}),(0,te.jsx)(s.A.Item,{label:"Custom Message (Optional)",name:"message",children:(0,te.jsx)(ie,{rows:3,placeholder:"Add a personal message to the customer..."})})]}),(0,te.jsx)(B.A,{}),(0,te.jsx)("div",{className:U,children:(0,te.jsxs)(c.A,{children:[(0,te.jsx)(u.Ay,{icon:(0,te.jsx)(j.A,{}),onClick:async()=>{if(i){v(!0);try{var e;const t={subject:"Invoice #".concat(i.invoice_no," - ").concat((null===(e=i.customerDetails)||void 0===e?void 0:e.full_name)||"Customer"),text:I(i),html:w(i)};y(t),x(!0),r.setFieldsValue({subject:t.subject})}catch(t){M.Ay.error("Failed to generate email preview")}finally{v(!1)}}},loading:m,disabled:!i,children:"Preview Email"}),(0,te.jsx)(u.Ay,{type:"primary",icon:(0,te.jsx)(V.A,{}),htmlType:"submit",loading:_,disabled:!i,children:"Send Email"}),(0,te.jsx)(u.Ay,{onClick:k,children:"Cancel"})]})})]}),h&&g&&(0,te.jsxs)("div",{className:Q,children:[(0,te.jsx)(B.A,{children:"Email Preview"}),(0,te.jsxs)("div",{className:W,children:[(0,te.jsx)("div",{className:H,children:(0,te.jsxs)(ne,{level:5,children:["Subject: ",g.subject]})}),(0,te.jsx)("div",{className:K,children:(0,te.jsx)("div",{className:X,dangerouslySetInnerHTML:{__html:(T=g.html,Y.default.sanitize(T,{ALLOWED_TAGS:["b","i","em","strong","u","s","a","p","br","ul","ol","li","h1","h2","h3","h4","h5","h6","blockquote","code","pre","span","div","hr","table","thead","tbody","tr","th","td"],ALLOWED_ATTR:["href","title","target","class","id"],ALLOW_DATA_ATTR:!1}))}})}),(0,te.jsxs)("div",{className:J,children:[(0,te.jsx)(u.Ay,{type:"primary",icon:(0,te.jsx)(V.A,{}),onClick:D,loading:_,children:"Send This Email"}),(0,te.jsx)(u.Ay,{onClick:()=>x(!1),children:"Back to Edit"})]})]})]}),i&&(0,te.jsx)("div",{className:Z,children:(0,te.jsx)(L.A,{message:"Invoice Information",description:(0,te.jsxs)("div",{children:[(0,te.jsx)(oe,{strong:!0,children:"Invoice #:"})," ",i.invoice_no,(0,te.jsx)("br",{}),(0,te.jsx)(oe,{strong:!0,children:"Customer:"})," ",(null===(t=i.customerDetails)||void 0===t?void 0:t.full_name)||"N/A",(0,te.jsx)("br",{}),(0,te.jsx)(oe,{strong:!0,children:"Amount:"})," \u20b9",i.total_amount||0]}),type:"info",showIcon:!0})})]})})});var T},{Title:ae,Text:se}=a.A,de=e=>{var t,n,o;let{visible:i,onClose:a,billData:s}=e;const d=(0,l.useRef)(null),[r,c]=(0,l.useState)(!1),m=e=>(Number(e)||0).toFixed(2),p="Focuz Medicals",v="123 MG Road, Bangalore, Karnataka - 560001",h="29ABCDE1234F1Z5",x=[{title:"Item",dataIndex:"productItems",key:"name",render:(e,t)=>{var n;const o=t.productItems;if(!o)return"";const i=null===(n=o.VariantItem)||void 0===n?void 0:n.variant_name;return i?"".concat(o.name," - ").concat(i):o.name}},{title:"Qty",dataIndex:"qty",key:"qty",width:100,render:e=>e||0},{title:"Loose Qty",dataIndex:"loose_qty",key:"loose_qty",width:100,render:e=>e||0},{title:"Price",dataIndex:"price",key:"price",width:120,render:e=>"\u20b9 ".concat(m(e))},{title:"Amount",dataIndex:"amount",key:"amount",width:120,render:e=>"\u20b9 ".concat(m(e))}];return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsxs)(E.A,{title:(0,te.jsx)(ae,{level:4,style:{margin:0,color:"#1890ff"},children:"Sale Details"}),open:i,onCancel:a,width:800,footer:[(0,te.jsx)(u.Ay,{type:"primary",icon:(0,te.jsx)(f.A,{}),onClick:()=>c(!0),children:"Send via Email"},"email"),(0,te.jsx)(u.Ay,{icon:(0,te.jsx)(b.A,{}),onClick:()=>{var e;const t="\n      <html>\n        <head>\n          <title>Sale - ".concat(s.invoice_no,'</title>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; color: #222; }\n            .shop-info { text-align: center; margin-bottom: 20px; }\n            .shop-info h2 { margin-bottom: 0; color: #1890ff; }\n            .info-flex { display: flex; justify-content: space-between; margin-bottom: 10px; }\n            table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n            th { background-color: #f5f5f5; }\n            .total { text-align: right; font-weight: bold; margin-top: 10px; }\n            .thank-you { text-align: center; margin-top: 40px; font-size: 16px; color: #1890ff; font-weight: bold; }\n            @media print {\n              .no-print { display: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="shop-info">\n            <h2>').concat(p,"</h2>\n            <p>").concat(v,"</p>\n            <p><strong>GST No:</strong> ").concat(h,'</p>\n          </div>\n\n          <div class="info-flex">\n            <div>\n              <p><strong>Invoice No:</strong> ').concat(s.invoice_no,"</p>\n              <p><strong>Date:</strong> ").concat(new Date(s.date).toLocaleDateString(),'</p>\n            </div>\n            <div style="text-align: right;">\n              <p><strong>Customer:</strong> ').concat((null===(e=s.customerDetails)||void 0===e?void 0:e.full_name)||"","</p>\n              <p><strong>Payment Mode:</strong> ").concat(s.payment_mode||"","</p>\n            </div>\n          </div>\n\n          <table>\n            <thead>\n              <tr>\n                <th>Item</th>\n                <th>Qty</th>\n                <th>Loose Qty</th>\n                <th>Price</th>\n                <th>Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              ").concat(s.Items.map((e=>{var t;const n=e.productItems,o=n?"".concat(n.name).concat(null!==(t=n.VariantItem)&&void 0!==t&&t.variant_name?" - ".concat(n.VariantItem.variant_name):""):"";return"\n                  <tr>\n                    <td>".concat(o,"</td>\n                    <td>").concat(e.qty||0,"</td>\n                    <td>").concat(e.loose_qty||0,"</td>\n                    <td>\u20b9 ").concat(m(e.price),"</td>\n                    <td>\u20b9 ").concat(m(e.amount),"</td>\n                  </tr>\n                ")})).join(""),'\n            </tbody>\n          </table>\n\n          <div class="total">\n            <p>Value of Goods: \u20b9 ').concat(m(s.value_of_goods),"</p>\n            ").concat(s.discount>0?"\n              <p>Discount: ".concat("percentage"===s.discount_type?s.discount+"%":"\u20b9 "+m(s.discount),"</p>\n            "):"","\n            <p>Total GST: \u20b9 ").concat(m(s.total_gst),"</p>\n            <p>CGST: \u20b9 ").concat(m(s.cgst||s.total_gst/2),"</p>\n            <p>SGST: \u20b9 ").concat(m(s.sgst||s.total_gst/2),"</p>\n            <p><strong>").concat("retail"===s.sale_type?"Bill Value":"Invoice Value",": \u20b9 ").concat(m(s.total_amount),"</strong></p>\n            ").concat(s.is_partially_paid?"\n              <p>Paid Amount: \u20b9 ".concat(m(s.paid_amount),"</p>\n              <p>Remaining Amount: \u20b9 ").concat(m(Number(s.total_amount)-Number(s.paid_amount)),"</p>\n            "):"","\n            <p><strong>Payment Status:</strong> ").concat(s.is_paid?"Fully Paid":s.is_partially_paid?"Partially Paid":"Unpaid","</p>\n          </div>\n\n          <div class=\"thank-you\">\n            Thank you for shopping with us!\n          </div>\n\n          <script>\n            window.onload = function() {\n              window.print();\n              window.onafterprint = function() {\n                window.parent.postMessage('printComplete', '*');\n              };\n            };\n          <\/script>\n        </body>\n      </html>\n    "),n=d.current;n.contentWindow.document.open(),n.contentWindow.document.write(t),n.contentWindow.document.close();const o=e=>{"printComplete"===e.data&&(window.removeEventListener("message",o),clearTimeout(i),a())};window.addEventListener("message",o);const i=setTimeout((()=>{window.removeEventListener("message",o)}),1e4)},children:"Print Sale"},"print"),(0,te.jsx)(u.Ay,{onClick:a,children:"Close"},"close")],children:[(0,te.jsxs)("div",{style:{textAlign:"center",marginBottom:16},children:[(0,te.jsx)(ae,{level:4,style:{marginBottom:0,color:"#1890ff"},children:p}),(0,te.jsx)(se,{children:v}),(0,te.jsx)("br",{}),(0,te.jsxs)(se,{children:[(0,te.jsx)("strong",{children:"GST No:"})," ",(0,te.jsx)(se,{code:!0,children:h})]})]}),(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:20},children:[(0,te.jsxs)("div",{children:[(0,te.jsx)(se,{strong:!0,children:"Invoice No:"})," ",s.invoice_no,(0,te.jsx)("br",{}),(0,te.jsx)(se,{strong:!0,children:"Date:"})," ",new Date(s.date).toLocaleDateString()]}),(0,te.jsxs)("div",{style:{textAlign:"right"},children:[(0,te.jsx)(se,{strong:!0,children:"Customer:"})," ",null===(t=s.customerDetails)||void 0===t?void 0:t.full_name,(0,te.jsx)("br",{}),(0,te.jsx)(se,{strong:!0,children:"Payment Mode:"})," ",s.payment_mode]})]}),(0,te.jsx)(N.A,{dataSource:s.Items,columns:x,pagination:!1,bordered:!0,summary:()=>(0,te.jsxs)(N.A.Summary.Row,{children:[(0,te.jsx)(N.A.Summary.Cell,{index:0,colSpan:4,children:(0,te.jsx)(se,{strong:!0,children:"Total Amount:"})}),(0,te.jsx)(N.A.Summary.Cell,{index:1,children:(0,te.jsxs)(se,{strong:!0,children:["\u20b9 ",m(s.sub_total)]})})]})}),(0,te.jsxs)("div",{style:{marginTop:20,textAlign:"right"},children:[(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsx)(se,{strong:!0,children:"Value of Goods:"}),(0,te.jsxs)(se,{children:["\u20b9 ",m(s.value_of_goods)]})]}),s.discount>0&&(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsx)(se,{strong:!0,children:"Discount:"}),(0,te.jsx)(se,{children:"percentage"===s.discount_type?"".concat(s.discount,"%"):"\u20b9 ".concat(m(s.discount))})]}),(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsx)(se,{strong:!0,children:"Total GST:"}),(0,te.jsxs)(se,{children:["\u20b9 ",m(s.total_gst)]})]}),(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsx)(se,{strong:!0,children:"CGST:"}),(0,te.jsxs)(se,{children:["\u20b9 ",m(s.cgst||s.total_gst/2)]})]}),(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsx)(se,{strong:!0,children:"SGST:"}),(0,te.jsxs)(se,{children:["\u20b9 ",m(s.sgst||s.total_gst/2)]})]}),(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsxs)(se,{strong:!0,children:["retail"===s.sale_type?"Bill Value":"Invoice Value",":"]}),(0,te.jsxs)(se,{children:["\u20b9 ",m(s.total_amount)]})]}),(0,te.jsx)(se,{strong:!0,children:"Payment Status: "}),s.is_paid?(0,te.jsx)(se,{type:"success",children:"Fully Paid"}):s.is_partially_paid?(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(se,{type:"warning",children:"Partially Paid"}),(0,te.jsx)("br",{}),(0,te.jsxs)(se,{children:["Paid Amount: \u20b9 ",m(s.paid_amount)]}),(0,te.jsx)("br",{}),(0,te.jsxs)(se,{children:["Remaining Amount: \u20b9"," ",m(Number(s.total_amount)-Number(s.paid_amount))]})]}):(0,te.jsx)(se,{type:"danger",children:"Unpaid"})]}),(0,te.jsx)("div",{style:{textAlign:"center",marginTop:40},children:(0,te.jsx)(se,{style:{color:"#1890ff",fontWeight:500},children:"Thank you for shopping with us!"})})]}),(0,te.jsx)("iframe",{ref:d,style:{display:"none"},title:"print-frame"}),(0,te.jsx)(le,{visible:r,onClose:()=>c(!1),billData:s,customerEmail:null===s||void 0===s||null===(n=s.customerDetails)||void 0===n?void 0:n.email,customerName:null===s||void 0===s||null===(o=s.customerDetails)||void 0===o?void 0:o.full_name})]})};var re=n(4413),ce=n(71281),ue=n(47246),me=n(39177),pe=n(89472),ve=n(98350);const he=["delete"],{Title:xe}=a.A,ge=()=>{var e,t,a,C,E,N,M;const{BillTemplateComponent:B,InvoiceTemplateComponent:L,settings:F}=(0,me.V)(),V=(0,l.useMemo)((()=>(0,pe.HW)()),[]),Y=(null===V||void 0===V?void 0:V.organisation_id)||(null===V||void 0===V||null===(e=V.organisationItems)||void 0===e?void 0:e._id),{data:q}=ve.lh.useGetOrganisationsQuery({organisation_id:Y},{skip:!Y}),z=(0,l.useMemo)((()=>{const e=null===q||void 0===q?void 0:q.result;return Array.isArray(e)?e[0]:e||(null===V||void 0===V?void 0:V.organisationItems)||{}}),[q,V]),[G,R]=(0,l.useState)(null),[O,U]=(0,l.useState)(!1),[Q,W]=(0,l.useState)(!1),[H]=s.A.useForm(),[K,X]=(0,l.useState)(""),[J,Z]=(0,l.useState)({current:1,pageSize:10}),[$,ee]=(0,l.useState)(!1),[ne,oe]=(0,l.useState)(null),[ie,ae]=(0,l.useState)("completed"),se=(0,ue.Ib)("SalesRecord"),{data:ge,isLoading:ye,refetch:_e}=se.useGetAll({pageNumber:J.current,pageLimit:J.pageSize,searchString:K,status:"drafts"===ie?"draft":"completed"}),je=ge||{result:[],pagination:null},fe=se.useDelete(),{delete:be}=fe,Ae=(0,i.A)(fe,he);(0,ce.z)({action:"delete",title:"Sale",mutationResult:Ae,refetch:_e});const Se=e=>{var t,n;const o="invoice"===e.document_type,i=o?e.vendorDetails:e.customerDetails;return i||console.warn("\u26a0\ufe0f Data mismatch: ".concat(o?"Invoice":"Bill"," missing ").concat(o?"vendorDetails":"customerDetails"),e),{customerName:(null===i||void 0===i?void 0:i.vendor_name)||(null===i||void 0===i?void 0:i.full_name)||(null===i||void 0===i?void 0:i.name)||"",customerAddress:(null===i||void 0===i?void 0:i.address)||(null===i||void 0===i?void 0:i.address1)||"",customerCity:(null===i||void 0===i?void 0:i.city)||"",customerState:(null===i||void 0===i?void 0:i.state)||"",customerPincode:(null===i||void 0===i?void 0:i.pincode)||"",customerPhone:(null===i||void 0===i?void 0:i.phone)||(null===i||void 0===i?void 0:i.mobile)||"",customerEmail:(null===i||void 0===i?void 0:i.email)||"",customer_gstin:(null===i||void 0===i?void 0:i.gst_no)||(null===i||void 0===i?void 0:i.gst_number)||(null===i||void 0===i?void 0:i.gstin)||"",customer_pan:(null===i||void 0===i?void 0:i.pan_no)||(null===i||void 0===i?void 0:i.pan_number)||"",date:e.date,invoice_no:e.invoice_no,items:(e.Items||[]).map((e=>{var t,n,o,i,l,a,s,d,r,c,u;return{name:[(null===(t=e.productItems)||void 0===t?void 0:t.name)||e.product_name||"",(null===(n=e.productItems)||void 0===n||null===(o=n.VariantItem)||void 0===o?void 0:o.variant_name)||""].filter(Boolean).join(" "),product_name:(null===(i=e.productItems)||void 0===i?void 0:i.name)||e.product_name||"",qty:e.qty,quantity:e.quantity||e.qty,price:e.price,mrp:e.mrp,amount:e.amount,hsn_code:e.hsn_code||(null===(l=e.productItems)||void 0===l?void 0:l.hsn_code)||(null===(a=e.productItems)||void 0===a||null===(s=a.VariantItem)||void 0===s?void 0:s.hsn_code)||"",hsn_sac:e.hsn_sac||(null===(d=e.productItems)||void 0===d?void 0:d.hsn_sac)||"",tax_percentage:e.tax_percentage||(null===(r=e.productItems)||void 0===r||null===(c=r.CategoryItem)||void 0===c?void 0:c.tax_percentage)||(null===(u=e.productItems)||void 0===u?void 0:u.tax_percentage)||0,discount:e.discount||0,description:e.description||""}})),total:e.total_amount||0,total_amount:e.total_amount||0,value_of_goods:e.value_of_goods||0,sub_total:e.sub_total||0,total_gst:e.total_gst||0,cgst:e.cgst||(e.total_gst||0)/2,sgst:e.sgst||(e.total_gst||0)/2,discountValue:e.discountValue||0,discount:e.discount||0,discount_type:e.discount_type||"",is_gst_included:null===(t=e.is_gst_included)||void 0===t||t,gst_number:e.gst_number||(null===(n=e.organisationItems)||void 0===n?void 0:n.gst_number)||(null===z||void 0===z?void 0:z.gst_number)||"",is_paid:e.is_paid||!1,is_partially_paid:e.is_partially_paid||!1,paid_amount:e.paid_amount||0,payment_mode:e.payment_mode||"Cash",organisationItems:e.organisationItems||z||(null===V||void 0===V?void 0:V.organisationItems)||{},branchItems:e.branchItems||(null===V||void 0===V?void 0:V.branchItems)||{}}},Ie=[{title:"Status",dataIndex:"status",key:"status",width:100,render:e=>"draft"===e?(0,te.jsx)(d.A,{color:"orange",children:"DRAFT"}):(0,te.jsx)(d.A,{color:"green",children:"COMPLETED"})},{title:"Invoice",dataIndex:"invoice_no",key:"invoice_no",render:e=>(0,te.jsx)(d.A,{icon:(0,te.jsx)(h.A,{}),color:"blue",children:e})},{title:"Type",dataIndex:"document_type",key:"document_type",width:100,render:e=>{const t=!e||"bill"===e;return(0,te.jsx)(d.A,{color:t?"cyan":"purple",children:t?"BILL":"INVOICE"})}},{title:"Date",dataIndex:"date",key:"date",render:e=>(0,te.jsx)(r.A,{title:D()(e).format("MMMM D, YYYY"),children:(0,te.jsx)(d.A,{icon:(0,te.jsx)(x.A,{}),color:"purple",children:D()(e).format("DD MMM YY")})})},{title:"Customer/Vendor",dataIndex:"customerDetails",key:"customerDetails",render:(e,t)=>{const n="invoice"===t.document_type?t.vendorDetails:e,o=(null===n||void 0===n?void 0:n.vendor_name)||(null===n||void 0===n?void 0:n.full_name)||(null===n||void 0===n?void 0:n.name)||"N/A",i=(null===n||void 0===n?void 0:n.phone)||(null===n||void 0===n?void 0:n.mobile)||"";return(0,te.jsxs)(c.A,{children:[(0,te.jsx)(g.A,{}),(0,te.jsxs)("span",{children:[(0,te.jsx)("strong",{children:o}),(0,te.jsx)("br",{}),(0,te.jsx)("small",{style:{color:"#999"},children:i})]})]})}},{title:"Payment Mode",dataIndex:"payment_mode",key:"payment_mode",render:e=>{const t="cash"===e?"green":"upi"===e?"geekblue":"orange";return(0,te.jsx)(d.A,{icon:(0,te.jsx)(y.A,{}),color:t,children:e.toUpperCase()})}},{title:"Total",dataIndex:"total_amount",key:"total_amount",render:e=>(0,te.jsxs)(d.A,{icon:(0,te.jsx)(_.A,{}),color:"gold",children:["\u20b9 ",Number(e).toFixed(2)]})},{title:"Actions",key:"actions",render:(e,t)=>{const i="draft"===t.status;return(0,te.jsxs)(c.A,{size:"middle",children:[(0,te.jsx)(r.A,{title:"View Bill",children:(0,te.jsx)(u.Ay,{type:"link",icon:(0,te.jsx)(j.A,{}),onClick:()=>(e=>{R(e),H.setFieldsValue((0,o.A)((0,o.A)({},e),{},{date:D()(e.date)})),U(!0)})(t)})}),!i&&(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(r.A,{title:"Send via Email",children:(0,te.jsx)(u.Ay,{type:"link",icon:(0,te.jsx)(f.A,{}),onClick:()=>(e=>{oe(e),ee(!0)})(t)})}),(0,te.jsx)(r.A,{title:"Print",children:(0,te.jsx)(u.Ay,{type:"link",icon:(0,te.jsx)(b.A,{}),onClick:()=>(async e=>{const t=Se(e),i=e.document_type||"bill";let a="";if(null!==F&&void 0!==F&&F.enable_payment_qr&&null!==F&&void 0!==F&&F.upi_id)try{const{generateUPIQRCode:e,formatBillToUPIParams:o}=await Promise.resolve().then(n.bind(n,356)),i=o(t,F);i&&(a=await e(i,{width:(null===F||void 0===F?void 0:F.qr_size)||150}))}catch(p){console.error("Error pre-generating QR code for print:",p)}const s=(0,o.A)((0,o.A)({},F),{},{qrCodeDataUrl:a}),d="bill"===i?B:L,r=l.createElement(d,{billData:t,settings:s}),c=k.renderToString(r),{printAsPDF:u}=await Promise.all([n.e(828),n.e(90)]).then(n.bind(n,48090)),m="".concat(i,"_").concat(t.invoice_no,"_").concat(D()().format("YYYYMMDD"));await u(c,m,i)})(t)})}),(0,te.jsx)(r.A,{title:"Download PDF",children:(0,te.jsx)(u.Ay,{type:"link",icon:(0,te.jsx)(A.A,{}),onClick:()=>(async e=>{const t=Se(e),i=e.document_type||"bill";let a="";if(null!==F&&void 0!==F&&F.enable_payment_qr&&null!==F&&void 0!==F&&F.upi_id)try{const{generateUPIQRCode:e,formatBillToUPIParams:o}=await Promise.resolve().then(n.bind(n,356)),i=o(t,F);i&&(a=await e(i,{width:(null===F||void 0===F?void 0:F.qr_size)||150}))}catch(p){console.error("Error pre-generating QR code for download:",p)}const s=(0,o.A)((0,o.A)({},F),{},{qrCodeDataUrl:a}),d="bill"===i?B:L,r=l.createElement(d,{billData:t,settings:s}),c=k.renderToString(r),{downloadAsPDF:u}=await Promise.all([n.e(828),n.e(90)]).then(n.bind(n,48090)),m="".concat(i,"_").concat(t.invoice_no,"_").concat(D()().format("YYYYMMDD"));await u(c,m,i)})(t)})})]}),(0,te.jsx)(m.A,{title:"Are you sure to delete this bill?",onConfirm:()=>(async e=>{try{await be(e)}catch(t){}})(t._id),okText:"Yes",cancelText:"No",children:(0,te.jsx)(r.A,{title:"Delete",children:(0,te.jsx)(u.Ay,{type:"link",icon:(0,te.jsx)(S.A,{}),danger:!0})})})]})}}];return(0,te.jsxs)("div",{style:{padding:24},children:[(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,te.jsx)(xe,{level:3,style:{color:"#1890ff",margin:0},children:"Sales List"}),(0,te.jsxs)(c.A,{children:[(0,te.jsx)(p.A,{placeholder:"Search by invoice no, customer name or mobile",prefix:(0,te.jsx)(I.A,{}),allowClear:!0,style:{width:300},onChange:e=>{return t=e.target.value,X(t),void Z((0,o.A)((0,o.A)({},J),{},{current:1}));var t}}),(0,te.jsx)(u.Ay,{type:"primary",icon:(0,te.jsx)(w.A,{}),onClick:()=>{R(null),U(!0)},children:"Create New Sale"})]})]}),(0,te.jsx)(v.A,{activeKey:ie,onChange:e=>{ae(e),Z({current:1,pageSize:J.pageSize})},items:[{key:"completed",label:(0,te.jsxs)("span",{children:["\u2705 Completed Bills (","completed"===ie?(null===je||void 0===je||null===(t=je.result)||void 0===t?void 0:t.length)||0:"-",")"]})},{key:"drafts",label:(0,te.jsxs)("span",{children:["\ud83d\udcdd Drafts (","drafts"===ie?(null===je||void 0===je||null===(a=je.result)||void 0===a?void 0:a.length)||0:"-",")"]})}],style:{marginBottom:16}}),(0,te.jsx)(re.A,{data:(null===je||void 0===je?void 0:je.result)||[],columns:Ie,loading:ye,bordered:!0,rowKey:"_id",totalCount:(null===je||void 0===je||null===(C=je.pagination)||void 0===C?void 0:C.totalCount)||(null===je||void 0===je||null===(E=je.result)||void 0===E?void 0:E.length)||0,pageLimit:J.pageSize,onPaginationChange:(e,t)=>{Z({current:e,pageSize:t})}}),(0,te.jsx)(T.A,{title:G?"Edit Sale":"Create New Sale",onClose:()=>U(!1),open:O,width:"100%",children:(0,te.jsx)(P.default,{billdata:G,onSuccess:()=>{U(!1),_e()}})}),G&&(0,te.jsx)(de,{visible:Q,onClose:()=>W(!1),billData:G}),(0,te.jsx)(le,{visible:$,onClose:()=>{ee(!1),oe(null)},billData:ne,customerEmail:null===ne||void 0===ne||null===(N=ne.customerDetails)||void 0===N?void 0:N.email,customerName:null===ne||void 0===ne||null===(M=ne.customerDetails)||void 0===M?void 0:M.full_name})]})}}}]);
//# sourceMappingURL=288.0dbfd762.chunk.js.map