"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[288],{47288:(e,n,t)=>{t.r(n),t.d(n,{default:()=>ye});var o=t(89379),i=t(53986),l=t(65043),a=t(83833),s=t(62305),r=t(76399),d=t(96651),c=t(6051),m=t(95206),u=t(60647),p=t(36621),v=t(98105),h=t(36091),x=t(6881),g=t(53722),y=t(11951),j=t(76401),_=t(61118),f=t(75388),b=t(94834),A=t(92003),S=t(9316),I=t(72411),w=t(73847),C=t(60446),D=t.n(C),k=t(66885),T=t(22671),P=t(46331),E=t(62751),N=t(39249),M=t(16569),B=t(8354),L=t(42261),F=t(46237),V=t(4394),R=t(87977);const Y="EmailSendModal_emailSendModal__BfdYk",q="EmailSendModal_emailSendHeader__C2GeM",z="EmailSendModal_emailSendContent__18hO-",G="EmailSendModal_emailForm__Dz-ws",U="EmailSendModal_formSection__XePkG",O="EmailSendModal_formActions__0+vVX",Q="EmailSendModal_emailPreview__z0YAf",W="EmailSendModal_previewContent__i+Cpp",H="EmailSendModal_previewHeader__Y+2Wh",K="EmailSendModal_previewBody__wL6Yl",X="EmailSendModal_htmlPreview__Lr4X+",J="EmailSendModal_previewActions__l-Y3Y",Z="EmailSendModal_billInfo__1yHvY",$="EmailSendModal_successState__gVP0P",ee="EmailSendModal_successIcon__levgm";var ne=t(70579);const{Title:te,Text:oe}=a.A,{TextArea:ie}=p.A,le=e=>{var n;let{visible:t,onClose:o,billData:i,customerEmail:a,customerName:r}=e;const[d]=s.A.useForm(),[u,v]=(0,l.useState)(!1),[h,x]=(0,l.useState)(!1),[g,y]=(0,l.useState)(null),[j,b]=(0,l.useState)(!1),[A,S]=(0,l.useState)(!1);(0,l.useEffect)((()=>{t&&a&&d.setFieldsValue({to:a,subject:"Invoice #".concat((null===i||void 0===i?void 0:i.invoice_no)||""," - ").concat(r||"")})}),[t,a,r,i,d]);const I=e=>{var n,t;return"\nDear ".concat((null===(n=e.customerDetails)||void 0===n?void 0:n.full_name)||"Valued Customer",",\n\nThank you for your business! Please find your invoice details below:\n\nInvoice Number: ").concat(e.invoice_no,"\nDate: ").concat(new Date(e.date).toLocaleDateString(),"\nTotal Amount: \u20b9").concat(e.total_amount||0,"\n\nItems:\n").concat((null===(t=e.Items)||void 0===t?void 0:t.map((e=>{var n;return"- ".concat(null===(n=e.productItems)||void 0===n?void 0:n.name," (").concat(e.qty," x \u20b9").concat(e.price,") = \u20b9").concat(e.amount)})).join("\n"))||"No items","\n\nPayment Status: ").concat(e.is_paid?"Paid":"Pending","\n\nThank you for choosing us!\n\nBest regards,\nSubriva Billing Team\n    ").trim()},w=e=>{var n,t,o;return'\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset="UTF-8">\n        <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .header { background: #f8f9fa; padding: 20px; text-align: center; }\n            .content { padding: 20px; }\n            .invoice-table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n            .invoice-table th, .invoice-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n            .invoice-table th { background-color: #f8f9fa; }\n            .total { font-weight: bold; font-size: 18px; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; margin-top: 20px; }\n        </style>\n    </head>\n    <body>\n        <div class="header">\n            <h1>Subriva Billing</h1>\n            <h2>Invoice #'.concat(e.invoice_no,'</h2>\n        </div>\n        \n        <div class="content">\n            <p>Dear <strong>').concat((null===(n=e.customerDetails)||void 0===n?void 0:n.full_name)||"Valued Customer",'</strong>,</p>\n            \n            <p>Thank you for your business! Please find your invoice details below:</p>\n            \n            <table class="invoice-table">\n                <tr>\n                    <th>Invoice Number</th>\n                    <td>').concat(e.invoice_no,"</td>\n                </tr>\n                <tr>\n                    <th>Date</th>\n                    <td>").concat(new Date(e.date).toLocaleDateString(),"</td>\n                </tr>\n                <tr>\n                    <th>Customer</th>\n                    <td>").concat((null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||"N/A",'</td>\n                </tr>\n            </table>\n            \n            <h3>Items:</h3>\n            <table class="invoice-table">\n                <thead>\n                    <tr>\n                        <th>Product</th>\n                        <th>Quantity</th>\n                        <th>Price</th>\n                        <th>Amount</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ').concat((null===(o=e.Items)||void 0===o?void 0:o.map((e=>{var n;return"\n                        <tr>\n                            <td>".concat((null===(n=e.productItems)||void 0===n?void 0:n.name)||"N/A","</td>\n                            <td>").concat(e.qty||0,"</td>\n                            <td>\u20b9").concat(e.price||0,"</td>\n                            <td>\u20b9").concat(e.amount||0,"</td>\n                        </tr>\n                    ")})).join(""))||'<tr><td colspan="4">No items</td></tr>','\n                </tbody>\n                <tfoot>\n                    <tr class="total">\n                        <td colspan="3">Total Amount</td>\n                        <td>\u20b9').concat(e.total_amount||0,"</td>\n                    </tr>\n                </tfoot>\n            </table>\n            \n            <p><strong>Payment Status:</strong> ").concat(e.is_paid?"Paid":"Pending",'</p>\n        </div>\n        \n        <div class="footer">\n            <p>Thank you for choosing us!</p>\n            <p><strong>Best regards,<br>Subriva Billing Team</strong></p>\n        </div>\n    </body>\n    </html>\n    ')},C=async e=>{if(i){b(!0);try{const n=sessionStorage.getItem("token"),t=sessionStorage.getItem("csrf-token"),l=await fetch("".concat("http://localhost:8249/","/email/send-invoice"),{method:"POST",headers:{"Content-Type":"application/json",token:n||"","x-csrf-token":t||""},body:JSON.stringify({customerEmail:e.to,invoiceData:i,subject:e.subject,customMessage:e.message||""})}),a=await l.json();a.success?(S(!0),M.Ay.success("Invoice sent successfully to ".concat(e.to)),setTimeout((()=>{o()}),2e3)):M.Ay.error(a.error||"Failed to send email")}catch(n){console.error("Error sending email:",n),M.Ay.error("Failed to send email. Please try again.")}finally{b(!1)}}else M.Ay.error("No bill data available")},D=()=>{d.validateFields().then(C)},k=()=>{d.resetFields(),x(!1),y(null),S(!1),o()};return(0,ne.jsx)(E.A,{title:(0,ne.jsxs)("div",{className:q,children:[(0,ne.jsx)(f.A,{}),(0,ne.jsx)("span",{children:"Send Invoice via Email"})]}),open:t,onCancel:k,width:900,className:Y,footer:null,destroyOnClose:!0,children:(0,ne.jsx)("div",{className:z,children:A?(0,ne.jsxs)("div",{className:$,children:[(0,ne.jsx)(F.A,{className:ee}),(0,ne.jsx)(te,{level:3,children:"Email Sent Successfully!"}),(0,ne.jsxs)(oe,{type:"secondary",children:["The invoice has been sent to ",d.getFieldValue("to")]})]}):(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsxs)(s.A,{form:d,layout:"vertical",onFinish:D,className:G,children:[(0,ne.jsxs)("div",{className:U,children:[(0,ne.jsx)(te,{level:4,children:"Email Details"}),(0,ne.jsx)(s.A.Item,{label:"To",name:"to",rules:[{required:!0,message:"Please enter recipient email"},{type:"email",message:"Please enter valid email address"}],children:(0,ne.jsx)(p.A,{prefix:(0,ne.jsx)(f.A,{}),placeholder:"customer@example.com",size:"large"})}),(0,ne.jsx)(s.A.Item,{label:"Subject",name:"subject",rules:[{required:!0,message:"Please enter email subject"}],children:(0,ne.jsx)(p.A,{placeholder:"Invoice subject",size:"large"})}),(0,ne.jsx)(s.A.Item,{label:"Custom Message (Optional)",name:"message",children:(0,ne.jsx)(ie,{rows:3,placeholder:"Add a personal message to the customer..."})})]}),(0,ne.jsx)(B.A,{}),(0,ne.jsx)("div",{className:O,children:(0,ne.jsxs)(c.A,{children:[(0,ne.jsx)(m.Ay,{icon:(0,ne.jsx)(_.A,{}),onClick:async()=>{if(i){v(!0);try{var e;const n={subject:"Invoice #".concat(i.invoice_no," - ").concat((null===(e=i.customerDetails)||void 0===e?void 0:e.full_name)||"Customer"),text:I(i),html:w(i)};y(n),x(!0),d.setFieldsValue({subject:n.subject})}catch(n){M.Ay.error("Failed to generate email preview")}finally{v(!1)}}},loading:u,disabled:!i,children:"Preview Email"}),(0,ne.jsx)(m.Ay,{type:"primary",icon:(0,ne.jsx)(V.A,{}),htmlType:"submit",loading:j,disabled:!i,children:"Send Email"}),(0,ne.jsx)(m.Ay,{onClick:k,children:"Cancel"})]})})]}),h&&g&&(0,ne.jsxs)("div",{className:Q,children:[(0,ne.jsx)(B.A,{children:"Email Preview"}),(0,ne.jsxs)("div",{className:W,children:[(0,ne.jsx)("div",{className:H,children:(0,ne.jsxs)(te,{level:5,children:["Subject: ",g.subject]})}),(0,ne.jsx)("div",{className:K,children:(0,ne.jsx)("div",{className:X,dangerouslySetInnerHTML:{__html:(T=g.html,R.A.sanitize(T,{ALLOWED_TAGS:["b","i","em","strong","u","s","a","p","br","ul","ol","li","h1","h2","h3","h4","h5","h6","blockquote","code","pre","span","div","hr","table","thead","tbody","tr","th","td"],ALLOWED_ATTR:["href","title","target","class","id"],ALLOW_DATA_ATTR:!1}))}})}),(0,ne.jsxs)("div",{className:J,children:[(0,ne.jsx)(m.Ay,{type:"primary",icon:(0,ne.jsx)(V.A,{}),onClick:D,loading:j,children:"Send This Email"}),(0,ne.jsx)(m.Ay,{onClick:()=>x(!1),children:"Back to Edit"})]})]})]}),i&&(0,ne.jsx)("div",{className:Z,children:(0,ne.jsx)(L.A,{message:"Invoice Information",description:(0,ne.jsxs)("div",{children:[(0,ne.jsx)(oe,{strong:!0,children:"Invoice #:"})," ",i.invoice_no,(0,ne.jsx)("br",{}),(0,ne.jsx)(oe,{strong:!0,children:"Customer:"})," ",(null===(n=i.customerDetails)||void 0===n?void 0:n.full_name)||"N/A",(0,ne.jsx)("br",{}),(0,ne.jsx)(oe,{strong:!0,children:"Amount:"})," \u20b9",i.total_amount||0]}),type:"info",showIcon:!0})})]})})});var T},{Title:ae,Text:se}=a.A,re=e=>{var n,t,o;let{visible:i,onClose:a,billData:s}=e;const r=(0,l.useRef)(null),[d,c]=(0,l.useState)(!1),u=e=>(Number(e)||0).toFixed(2),p="Focuz Medicals",v="123 MG Road, Bangalore, Karnataka - 560001",h="29ABCDE1234F1Z5",x=[{title:"Item",dataIndex:"productItems",key:"name",render:(e,n)=>{var t;const o=n.productItems;if(!o)return"";const i=null===(t=o.VariantItem)||void 0===t?void 0:t.variant_name;return i?"".concat(o.name," - ").concat(i):o.name}},{title:"Qty",dataIndex:"qty",key:"qty",width:100,render:e=>e||0},{title:"Loose Qty",dataIndex:"loose_qty",key:"loose_qty",width:100,render:e=>e||0},{title:"Price",dataIndex:"price",key:"price",width:120,render:e=>"\u20b9 ".concat(u(e))},{title:"Amount",dataIndex:"amount",key:"amount",width:120,render:e=>"\u20b9 ".concat(u(e))}];return(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsxs)(E.A,{title:(0,ne.jsx)(ae,{level:4,style:{margin:0,color:"#1890ff"},children:"Sale Details"}),open:i,onCancel:a,width:800,footer:[(0,ne.jsx)(m.Ay,{type:"primary",icon:(0,ne.jsx)(f.A,{}),onClick:()=>c(!0),children:"Send via Email"},"email"),(0,ne.jsx)(m.Ay,{icon:(0,ne.jsx)(b.A,{}),onClick:()=>{var e;const n="\n      <html>\n        <head>\n          <title>Sale - ".concat(s.invoice_no,'</title>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; color: #222; }\n            .shop-info { text-align: center; margin-bottom: 20px; }\n            .shop-info h2 { margin-bottom: 0; color: #1890ff; }\n            .info-flex { display: flex; justify-content: space-between; margin-bottom: 10px; }\n            table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n            th { background-color: #f5f5f5; }\n            .total { text-align: right; font-weight: bold; margin-top: 10px; }\n            .thank-you { text-align: center; margin-top: 40px; font-size: 16px; color: #1890ff; font-weight: bold; }\n            @media print {\n              .no-print { display: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="shop-info">\n            <h2>').concat(p,"</h2>\n            <p>").concat(v,"</p>\n            <p><strong>GST No:</strong> ").concat(h,'</p>\n          </div>\n\n          <div class="info-flex">\n            <div>\n              <p><strong>Invoice No:</strong> ').concat(s.invoice_no,"</p>\n              <p><strong>Date:</strong> ").concat(new Date(s.date).toLocaleDateString(),'</p>\n            </div>\n            <div style="text-align: right;">\n              <p><strong>Customer:</strong> ').concat((null===(e=s.customerDetails)||void 0===e?void 0:e.full_name)||"","</p>\n              <p><strong>Payment Mode:</strong> ").concat(s.payment_mode||"","</p>\n            </div>\n          </div>\n\n          <table>\n            <thead>\n              <tr>\n                <th>Item</th>\n                <th>Qty</th>\n                <th>Loose Qty</th>\n                <th>Price</th>\n                <th>Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              ").concat(s.Items.map((e=>{var n;const t=e.productItems,o=t?"".concat(t.name).concat(null!==(n=t.VariantItem)&&void 0!==n&&n.variant_name?" - ".concat(t.VariantItem.variant_name):""):"";return"\n                  <tr>\n                    <td>".concat(o,"</td>\n                    <td>").concat(e.qty||0,"</td>\n                    <td>").concat(e.loose_qty||0,"</td>\n                    <td>\u20b9 ").concat(u(e.price),"</td>\n                    <td>\u20b9 ").concat(u(e.amount),"</td>\n                  </tr>\n                ")})).join(""),'\n            </tbody>\n          </table>\n\n          <div class="total">\n            <p>Value of Goods: \u20b9 ').concat(u(s.value_of_goods),"</p>\n            ").concat(s.discount>0?"\n              <p>Discount: ".concat("percentage"===s.discount_type?s.discount+"%":"\u20b9 "+u(s.discount),"</p>\n            "):"","\n            <p>Total GST: \u20b9 ").concat(u(s.total_gst),"</p>\n            <p>CGST: \u20b9 ").concat(u(s.cgst||s.total_gst/2),"</p>\n            <p>SGST: \u20b9 ").concat(u(s.sgst||s.total_gst/2),"</p>\n            <p><strong>").concat("retail"===s.sale_type?"Bill Value":"Invoice Value",": \u20b9 ").concat(u(s.total_amount),"</strong></p>\n            ").concat(s.is_partially_paid?"\n              <p>Paid Amount: \u20b9 ".concat(u(s.paid_amount),"</p>\n              <p>Remaining Amount: \u20b9 ").concat(u(Number(s.total_amount)-Number(s.paid_amount)),"</p>\n            "):"","\n            <p><strong>Payment Status:</strong> ").concat(s.is_paid?"Fully Paid":s.is_partially_paid?"Partially Paid":"Unpaid","</p>\n          </div>\n\n          <div class=\"thank-you\">\n            Thank you for shopping with us!\n          </div>\n\n          <script>\n            window.onload = function() {\n              window.print();\n              window.onafterprint = function() {\n                window.parent.postMessage('printComplete', '*');\n              };\n            };\n          <\/script>\n        </body>\n      </html>\n    "),t=r.current;t.contentWindow.document.open(),t.contentWindow.document.write(n),t.contentWindow.document.close();const o=e=>{"printComplete"===e.data&&(window.removeEventListener("message",o),clearTimeout(i),a())};window.addEventListener("message",o);const i=setTimeout((()=>{window.removeEventListener("message",o)}),1e4)},children:"Print Sale"},"print"),(0,ne.jsx)(m.Ay,{onClick:a,children:"Close"},"close")],children:[(0,ne.jsxs)("div",{style:{textAlign:"center",marginBottom:16},children:[(0,ne.jsx)(ae,{level:4,style:{marginBottom:0,color:"#1890ff"},children:p}),(0,ne.jsx)(se,{children:v}),(0,ne.jsx)("br",{}),(0,ne.jsxs)(se,{children:[(0,ne.jsx)("strong",{children:"GST No:"})," ",(0,ne.jsx)(se,{code:!0,children:h})]})]}),(0,ne.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:20},children:[(0,ne.jsxs)("div",{children:[(0,ne.jsx)(se,{strong:!0,children:"Invoice No:"})," ",s.invoice_no,(0,ne.jsx)("br",{}),(0,ne.jsx)(se,{strong:!0,children:"Date:"})," ",new Date(s.date).toLocaleDateString()]}),(0,ne.jsxs)("div",{style:{textAlign:"right"},children:[(0,ne.jsx)(se,{strong:!0,children:"Customer:"})," ",null===(n=s.customerDetails)||void 0===n?void 0:n.full_name,(0,ne.jsx)("br",{}),(0,ne.jsx)(se,{strong:!0,children:"Payment Mode:"})," ",s.payment_mode]})]}),(0,ne.jsx)(N.A,{dataSource:s.Items,columns:x,pagination:!1,bordered:!0,summary:()=>(0,ne.jsxs)(N.A.Summary.Row,{children:[(0,ne.jsx)(N.A.Summary.Cell,{index:0,colSpan:4,children:(0,ne.jsx)(se,{strong:!0,children:"Total Amount:"})}),(0,ne.jsx)(N.A.Summary.Cell,{index:1,children:(0,ne.jsxs)(se,{strong:!0,children:["\u20b9 ",u(s.sub_total)]})})]})}),(0,ne.jsxs)("div",{style:{marginTop:20,textAlign:"right"},children:[(0,ne.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,ne.jsx)(se,{strong:!0,children:"Value of Goods:"}),(0,ne.jsxs)(se,{children:["\u20b9 ",u(s.value_of_goods)]})]}),s.discount>0&&(0,ne.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,ne.jsx)(se,{strong:!0,children:"Discount:"}),(0,ne.jsx)(se,{children:"percentage"===s.discount_type?"".concat(s.discount,"%"):"\u20b9 ".concat(u(s.discount))})]}),(0,ne.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,ne.jsx)(se,{strong:!0,children:"Total GST:"}),(0,ne.jsxs)(se,{children:["\u20b9 ",u(s.total_gst)]})]}),(0,ne.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,ne.jsx)(se,{strong:!0,children:"CGST:"}),(0,ne.jsxs)(se,{children:["\u20b9 ",u(s.cgst||s.total_gst/2)]})]}),(0,ne.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,ne.jsx)(se,{strong:!0,children:"SGST:"}),(0,ne.jsxs)(se,{children:["\u20b9 ",u(s.sgst||s.total_gst/2)]})]}),(0,ne.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,ne.jsxs)(se,{strong:!0,children:["retail"===s.sale_type?"Bill Value":"Invoice Value",":"]}),(0,ne.jsxs)(se,{children:["\u20b9 ",u(s.total_amount)]})]}),(0,ne.jsx)(se,{strong:!0,children:"Payment Status: "}),s.is_paid?(0,ne.jsx)(se,{type:"success",children:"Fully Paid"}):s.is_partially_paid?(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(se,{type:"warning",children:"Partially Paid"}),(0,ne.jsx)("br",{}),(0,ne.jsxs)(se,{children:["Paid Amount: \u20b9 ",u(s.paid_amount)]}),(0,ne.jsx)("br",{}),(0,ne.jsxs)(se,{children:["Remaining Amount: \u20b9"," ",u(Number(s.total_amount)-Number(s.paid_amount))]})]}):(0,ne.jsx)(se,{type:"danger",children:"Unpaid"})]}),(0,ne.jsx)("div",{style:{textAlign:"center",marginTop:40},children:(0,ne.jsx)(se,{style:{color:"#1890ff",fontWeight:500},children:"Thank you for shopping with us!"})})]}),(0,ne.jsx)("iframe",{ref:r,style:{display:"none"},title:"print-frame"}),(0,ne.jsx)(le,{visible:d,onClose:()=>c(!1),billData:s,customerEmail:null===s||void 0===s||null===(t=s.customerDetails)||void 0===t?void 0:t.email,customerName:null===s||void 0===s||null===(o=s.customerDetails)||void 0===o?void 0:o.full_name})]})};var de=t(4413),ce=t(71281),me=t(47246),ue=t(39177),pe=t(30746),ve=t(89472),he=t(98350);const xe=["delete"],{Title:ge}=a.A,ye=()=>{var e,n,a,C,E;const{BillTemplateComponent:N,InvoiceTemplateComponent:M,settings:B}=(0,ue.V)(),{printDocument:L}=(0,pe.y)(),F=(0,l.useMemo)((()=>(0,ve.HW)()),[]),V=(null===F||void 0===F?void 0:F.organisation_id)||(null===F||void 0===F||null===(e=F.organisationItems)||void 0===e?void 0:e._id),{data:R}=he.lh.useGetOrganisationsQuery({organisation_id:V},{skip:!V}),Y=(0,l.useMemo)((()=>{const e=null===R||void 0===R?void 0:R.result;return Array.isArray(e)?e[0]:e||(null===F||void 0===F?void 0:F.organisationItems)||{}}),[R,F]),[q,z]=(0,l.useState)(null),[G,U]=(0,l.useState)(!1),[O,Q]=(0,l.useState)(!1),[W]=s.A.useForm(),[H,K]=(0,l.useState)(""),[X,J]=(0,l.useState)({current:1,pageSize:10}),[Z,$]=(0,l.useState)(!1),[ee,te]=(0,l.useState)(null),[oe,ie]=(0,l.useState)("completed"),ae=(0,me.Ib)("SalesRecord"),{data:se,isLoading:ye,refetch:je}=ae.useGetAll({pageNumber:X.current,pageLimit:X.pageSize,searchString:H}),_e=se||{result:[],pagination:null},fe=(0,l.useMemo)((()=>null!==_e&&void 0!==_e&&_e.result?"drafts"===oe?_e.result.filter((e=>"draft"===e.status)):_e.result.filter((e=>!e.status||"completed"===e.status)):[]),[null===_e||void 0===_e?void 0:_e.result,oe]),be=ae.useDelete(),{delete:Ae}=be,Se=(0,i.A)(be,xe);(0,ce.z)({action:"delete",title:"Sale",mutationResult:Se,refetch:je});const Ie=e=>{var n;const t="invoice"===e.document_type,o=t?e.vendorDetails:e.customerDetails;return o||console.warn("\u26a0\ufe0f Data mismatch: ".concat(t?"Invoice":"Bill"," missing ").concat(t?"vendorDetails":"customerDetails"),e),{customerName:(null===o||void 0===o?void 0:o.vendor_name)||(null===o||void 0===o?void 0:o.full_name)||(null===o||void 0===o?void 0:o.name)||"",customerAddress:(null===o||void 0===o?void 0:o.address)||(null===o||void 0===o?void 0:o.address1)||"",customerCity:(null===o||void 0===o?void 0:o.city)||"",customerState:(null===o||void 0===o?void 0:o.state)||"",customerPincode:(null===o||void 0===o?void 0:o.pincode)||"",customerPhone:(null===o||void 0===o?void 0:o.phone)||(null===o||void 0===o?void 0:o.mobile)||"",customerEmail:(null===o||void 0===o?void 0:o.email)||"",customer_gstin:(null===o||void 0===o?void 0:o.gst_no)||(null===o||void 0===o?void 0:o.gst_number)||(null===o||void 0===o?void 0:o.gstin)||"",customer_pan:(null===o||void 0===o?void 0:o.pan_no)||(null===o||void 0===o?void 0:o.pan_number)||"",date:e.date,invoice_no:e.invoice_no,items:(e.Items||[]).map((e=>{var n,t,o;return{name:[(null===(n=e.productItems)||void 0===n?void 0:n.name)||e.product_name||"",(null===(t=e.productItems)||void 0===t||null===(o=t.VariantItem)||void 0===o?void 0:o.variant_name)||""].filter(Boolean).join(" "),qty:e.qty,price:e.price,mrp:e.mrp,amount:e.amount}})),total:e.total_amount||0,total_gst:e.total_gst||0,discount:e.discount||0,discount_type:e.discount_type||"",gst_number:e.gst_number||(null===(n=e.organisationItems)||void 0===n?void 0:n.gst_number)||(null===Y||void 0===Y?void 0:Y.gst_number)||"",organisationItems:e.organisationItems||Y||(null===F||void 0===F?void 0:F.organisationItems)||{},branchItems:e.branchItems||(null===F||void 0===F?void 0:F.branchItems)||{}}},we=[{title:"Status",dataIndex:"status",key:"status",width:100,render:e=>"draft"===e?(0,ne.jsx)(r.A,{color:"orange",children:"DRAFT"}):(0,ne.jsx)(r.A,{color:"green",children:"COMPLETED"})},{title:"Invoice",dataIndex:"invoice_no",key:"invoice_no",render:e=>(0,ne.jsx)(r.A,{icon:(0,ne.jsx)(h.A,{}),color:"blue",children:e})},{title:"Type",dataIndex:"document_type",key:"document_type",width:100,render:e=>{const n=!e||"bill"===e;return(0,ne.jsx)(r.A,{color:n?"cyan":"purple",children:n?"BILL":"INVOICE"})}},{title:"Date",dataIndex:"date",key:"date",render:e=>(0,ne.jsx)(d.A,{title:D()(e).format("MMMM D, YYYY"),children:(0,ne.jsx)(r.A,{icon:(0,ne.jsx)(x.A,{}),color:"purple",children:D()(e).format("DD MMM YY")})})},{title:"Customer/Vendor",dataIndex:"customerDetails",key:"customerDetails",render:(e,n)=>{const t="invoice"===n.document_type?n.vendorDetails:e,o=(null===t||void 0===t?void 0:t.vendor_name)||(null===t||void 0===t?void 0:t.full_name)||(null===t||void 0===t?void 0:t.name)||"N/A",i=(null===t||void 0===t?void 0:t.phone)||(null===t||void 0===t?void 0:t.mobile)||"";return(0,ne.jsxs)(c.A,{children:[(0,ne.jsx)(g.A,{}),(0,ne.jsxs)("span",{children:[(0,ne.jsx)("strong",{children:o}),(0,ne.jsx)("br",{}),(0,ne.jsx)("small",{style:{color:"#999"},children:i})]})]})}},{title:"Payment Mode",dataIndex:"payment_mode",key:"payment_mode",render:e=>{const n="cash"===e?"green":"upi"===e?"geekblue":"orange";return(0,ne.jsx)(r.A,{icon:(0,ne.jsx)(y.A,{}),color:n,children:e.toUpperCase()})}},{title:"Total",dataIndex:"total_amount",key:"total_amount",render:e=>(0,ne.jsxs)(r.A,{icon:(0,ne.jsx)(j.A,{}),color:"gold",children:["\u20b9 ",Number(e).toFixed(2)]})},{title:"Actions",key:"actions",render:(e,n)=>{const i="draft"===n.status;return(0,ne.jsxs)(c.A,{size:"middle",children:[(0,ne.jsx)(d.A,{title:"View Bill",children:(0,ne.jsx)(m.Ay,{type:"link",icon:(0,ne.jsx)(_.A,{}),onClick:()=>(e=>{z(e),W.setFieldsValue((0,o.A)((0,o.A)({},e),{},{date:D()(e.date)})),U(!0)})(n)})}),!i&&(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(d.A,{title:"Send via Email",children:(0,ne.jsx)(m.Ay,{type:"link",icon:(0,ne.jsx)(f.A,{}),onClick:()=>(e=>{te(e),$(!0)})(n)})}),(0,ne.jsx)(d.A,{title:"Print",children:(0,ne.jsx)(m.Ay,{type:"link",icon:(0,ne.jsx)(b.A,{}),onClick:()=>(async e=>{const n=Ie(e),i=e.document_type||"bill";let l=B;if(null!==B&&void 0!==B&&B.enable_payment_qr&&null!==B&&void 0!==B&&B.upi_id)try{const{generateUPIQRCode:e,formatBillToUPIParams:i}=await Promise.resolve().then(t.bind(t,356)),a=i(n,B);if(a){const n=await e(a,{width:(null===B||void 0===B?void 0:B.qr_size)||150});l=(0,o.A)((0,o.A)({},B),{},{qrCodeDataUrl:n})}}catch(a){console.error("Error pre-generating QR code for print:",a)}L(n,i,l)})(n)})}),(0,ne.jsx)(d.A,{title:"Download",children:(0,ne.jsx)(m.Ay,{type:"link",icon:(0,ne.jsx)(A.A,{}),onClick:()=>(async e=>{const n=Ie(e),i=e.document_type||"bill";let a="";if(null!==B&&void 0!==B&&B.enable_payment_qr&&null!==B&&void 0!==B&&B.upi_id)try{const{generateUPIQRCode:e,formatBillToUPIParams:o}=await Promise.resolve().then(t.bind(t,356)),i=o(n,B);i&&(a=await e(i,{width:(null===B||void 0===B?void 0:B.qr_size)||150}))}catch(h){console.error("Error pre-generating QR code for download:",h)}const s=(0,o.A)((0,o.A)({},B),{},{qrCodeDataUrl:a}),r="bill"===i?N:M,d=l.createElement(r,{billData:n,settings:s}),c=k.renderToString(d),m='\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset="UTF-8">\n          <title>'.concat("bill"===i?"Bill":"Invoice"," - ").concat(n.invoice_no,"</title>\n          <style>\n            * {\n              margin: 0;\n              padding: 0;\n              box-sizing: border-box;\n            }\n            body {\n              margin: 0;\n              padding: 20px;\n              font-family: Arial, sans-serif;\n            }\n            @media print {\n              @page {\n                margin: 0;\n                size: auto;\n              }\n              body {\n                margin: 0;\n                padding: 0;\n              }\n            }\n          </style>\n        </head>\n        <body>\n          ").concat(c,"\n        </body>\n      </html>\n    "),u=new Blob([m],{type:"text/html"}),p=URL.createObjectURL(u),v=document.createElement("a");v.href=p,v.download="".concat(i,"_").concat(n.invoice_no,"_").concat(D()().format("YYYYMMDD"),".html"),document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(p)})(n)})})]}),(0,ne.jsx)(u.A,{title:"Are you sure to delete this bill?",onConfirm:()=>(async e=>{try{await Ae(e)}catch(n){}})(n._id),okText:"Yes",cancelText:"No",children:(0,ne.jsx)(d.A,{title:"Delete",children:(0,ne.jsx)(m.Ay,{type:"link",icon:(0,ne.jsx)(S.A,{}),danger:!0})})})]})}}];return(0,ne.jsxs)("div",{style:{padding:24},children:[(0,ne.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,ne.jsx)(ge,{level:3,style:{color:"#1890ff",margin:0},children:"Sales List"}),(0,ne.jsxs)(c.A,{children:[(0,ne.jsx)(p.A,{placeholder:"Search by invoice no, customer name or mobile",prefix:(0,ne.jsx)(I.A,{}),allowClear:!0,style:{width:300},onChange:e=>{return n=e.target.value,K(n),void J((0,o.A)((0,o.A)({},X),{},{current:1}));var n}}),(0,ne.jsx)(m.Ay,{type:"primary",icon:(0,ne.jsx)(w.A,{}),onClick:()=>{z(null),U(!0)},children:"Create New Sale"})]})]}),(0,ne.jsx)(v.A,{activeKey:oe,onChange:ie,items:[{key:"completed",label:(0,ne.jsxs)("span",{children:["\u2705 Completed Bills (",(null===_e||void 0===_e||null===(n=_e.result)||void 0===n?void 0:n.filter((e=>!e.status||"completed"===e.status)).length)||0,")"]})},{key:"drafts",label:(0,ne.jsxs)("span",{children:["\ud83d\udcdd Drafts (",(null===_e||void 0===_e||null===(a=_e.result)||void 0===a?void 0:a.filter((e=>"draft"===e.status)).length)||0,")"]})}],style:{marginBottom:16}}),(0,ne.jsx)(de.A,{data:fe,columns:we,loading:ye,bordered:!0,rowKey:"_id",totalCount:fe.length,pageLimit:X.pageSize,onPaginationChange:(e,n)=>{J({current:e,pageSize:n})}}),(0,ne.jsx)(T.A,{title:q?"Edit Sale":"Create New Sale",onClose:()=>U(!1),open:G,width:"100%",children:(0,ne.jsx)(P.default,{billdata:q,onSuccess:()=>{U(!1),je()}})}),q&&(0,ne.jsx)(re,{visible:O,onClose:()=>Q(!1),billData:q}),(0,ne.jsx)(le,{visible:Z,onClose:()=>{$(!1),te(null)},billData:ee,customerEmail:null===ee||void 0===ee||null===(C=ee.customerDetails)||void 0===C?void 0:C.email,customerName:null===ee||void 0===ee||null===(E=ee.customerDetails)||void 0===E?void 0:E.full_name})]})}}}]);
//# sourceMappingURL=288.a3ebf018.chunk.js.map