{"version":3,"file":"static/js/288.a3ebf018.chunk.js","mappings":"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","sources":["helpers/sanitize.ts","webpack://SUBRIVA-BILLING/./src/components/common/EmailSendModal.module.css?97c3","components/common/EmailSendModal.tsx","pages/RetaillBill/components/BillViewModal.tsx","pages/RetaillBill/BillListPage.tsx"],"sourcesContent":["// HTML sanitization utilities to prevent XSS attacks\r\nimport DOMPurify from 'dompurify';\r\n\r\n/**\r\n * Sanitize HTML content to prevent XSS\r\n * Use before rendering any user-generated HTML\r\n */\r\nexport const sanitizeHTML = (dirty: string): string => {\r\n  return DOMPurify.sanitize(dirty, {\r\n    ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a', 'p', 'br', 'ul', 'ol', 'li', 'span'],\r\n    ALLOWED_ATTR: ['href', 'title', 'target', 'class'],\r\n    ALLOW_DATA_ATTR: false,\r\n  });\r\n};\r\n\r\n/**\r\n * Sanitize HTML for rich text editors\r\n * More permissive tag set for formatted content\r\n */\r\nexport const sanitizeRichText = (dirty: string): string => {\r\n  return DOMPurify.sanitize(dirty, {\r\n    ALLOWED_TAGS: [\r\n      'b', 'i', 'em', 'strong', 'u', 's', 'a', 'p', 'br', \r\n      'ul', 'ol', 'li', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',\r\n      'blockquote', 'code', 'pre', 'span', 'div', 'hr', 'table',\r\n      'thead', 'tbody', 'tr', 'th', 'td'\r\n    ],\r\n    ALLOWED_ATTR: ['href', 'title', 'target', 'class', 'id'],\r\n    // Note: style attribute removed for security - inline styles can be risky\r\n    ALLOW_DATA_ATTR: false,\r\n  });\r\n};\r\n\r\n/**\r\n * Strip all HTML tags - use for plain text fields\r\n */\r\nexport const stripHTML = (dirty: string): string => {\r\n  return DOMPurify.sanitize(dirty, {\r\n    ALLOWED_TAGS: [],\r\n    ALLOWED_ATTR: [],\r\n  });\r\n};\r\n\r\n/**\r\n * Sanitize URL to prevent javascript: and data: URLs\r\n */\r\nexport const sanitizeURL = (url: string): string => {\r\n  const sanitized = DOMPurify.sanitize(url, {\r\n    ALLOWED_TAGS: [],\r\n    ALLOWED_ATTR: [],\r\n  });\r\n  \r\n  // Check for dangerous protocols\r\n  const lowerURL = sanitized.toLowerCase().trim();\r\n  if (\r\n    lowerURL.startsWith('javascript:') ||\r\n    lowerURL.startsWith('data:') ||\r\n    lowerURL.startsWith('vbscript:')\r\n  ) {\r\n    return '#';\r\n  }\r\n  \r\n  return sanitized;\r\n};\r\n\r\n/**\r\n * Safe component for rendering sanitized HTML\r\n * Usage: <div {...createSafeHTML(userContent)} />\r\n */\r\nexport const createSafeHTML = (dirty: string): { dangerouslySetInnerHTML: { __html: string } } => {\r\n  return {\r\n    dangerouslySetInnerHTML: {\r\n      __html: sanitizeHTML(dirty)\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * Sanitize form input to prevent XSS in text fields\r\n */\r\nexport const sanitizeInput = (value: string): string => {\r\n  // Remove any HTML tags and encode special characters\r\n  return stripHTML(value)\r\n    .replace(/[<>]/g, '')\r\n    .trim();\r\n};\r\n\r\n","// extracted by mini-css-extract-plugin\nexport default {\"emailSendModal\":\"EmailSendModal_emailSendModal__BfdYk\",\"ant-modal-header\":\"EmailSendModal_ant-modal-header__8M-dy\",\"ant-modal-title\":\"EmailSendModal_ant-modal-title__UKq46\",\"emailSendHeader\":\"EmailSendModal_emailSendHeader__C2GeM\",\"anticon\":\"EmailSendModal_anticon__M+hfh\",\"ant-modal-body\":\"EmailSendModal_ant-modal-body__FQTZE\",\"emailSendContent\":\"EmailSendModal_emailSendContent__18hO-\",\"emailForm\":\"EmailSendModal_emailForm__Dz-ws\",\"formSection\":\"EmailSendModal_formSection__XePkG\",\"ant-typography\":\"EmailSendModal_ant-typography__Rf4oP\",\"ant-form-item-label\":\"EmailSendModal_ant-form-item-label__utKPG\",\"ant-input\":\"EmailSendModal_ant-input__nTmCv\",\"ant-input-affix-wrapper\":\"EmailSendModal_ant-input-affix-wrapper__uN9GE\",\"ant-input-prefix\":\"EmailSendModal_ant-input-prefix__n2R1a\",\"formActions\":\"EmailSendModal_formActions__0+vVX\",\"ant-btn\":\"EmailSendModal_ant-btn__NienV\",\"ant-btn-primary\":\"EmailSendModal_ant-btn-primary__0FF0H\",\"emailPreview\":\"EmailSendModal_emailPreview__z0YAf\",\"previewContent\":\"EmailSendModal_previewContent__i+Cpp\",\"previewHeader\":\"EmailSendModal_previewHeader__Y+2Wh\",\"previewBody\":\"EmailSendModal_previewBody__wL6Yl\",\"htmlPreview\":\"EmailSendModal_htmlPreview__Lr4X+\",\"total\":\"EmailSendModal_total__HXP29\",\"previewActions\":\"EmailSendModal_previewActions__l-Y3Y\",\"billInfo\":\"EmailSendModal_billInfo__1yHvY\",\"ant-alert\":\"EmailSendModal_ant-alert__V1924\",\"ant-alert-message\":\"EmailSendModal_ant-alert-message__a7i8z\",\"ant-alert-description\":\"EmailSendModal_ant-alert-description__2m7uE\",\"successState\":\"EmailSendModal_successState__gVP0P\",\"successIcon\":\"EmailSendModal_successIcon__levgm\",\"ant-typography-caption\":\"EmailSendModal_ant-typography-caption__bjmAF\",\"ant-spin\":\"EmailSendModal_ant-spin__m4HeQ\",\"ant-spin-dot\":\"EmailSendModal_ant-spin-dot__2ADDo\",\"slideInUp\":\"EmailSendModal_slideInUp__Mt1P+\"};","import React, { useState, useEffect } from 'react';\r\nimport { Modal, Form, Input, Button, Space, Typography, Divider, Alert, Spin, message } from 'antd';\r\nimport { \r\n  MailOutlined, \r\n  SendOutlined, \r\n  EyeOutlined, \r\n  CloseOutlined,\r\n  CheckCircleOutlined,\r\n  ExclamationCircleOutlined\r\n} from '@ant-design/icons';\r\nimport { sanitizeRichText } from '../../helpers/sanitize';\r\nimport styles from './EmailSendModal.module.css';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { TextArea } = Input;\r\n\r\ninterface EmailSendModalProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  billData?: any;\r\n  customerEmail?: string;\r\n  customerName?: string;\r\n}\r\n\r\ninterface EmailPreview {\r\n  subject: string;\r\n  text: string;\r\n  html: string;\r\n}\r\n\r\nconst EmailSendModal: React.FC<EmailSendModalProps> = ({\r\n  visible,\r\n  onClose,\r\n  billData,\r\n  customerEmail,\r\n  customerName\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [loading, setLoading] = useState(false);\r\n  const [previewMode, setPreviewMode] = useState(false);\r\n  const [emailPreview, setEmailPreview] = useState<EmailPreview | null>(null);\r\n  const [sending, setSending] = useState(false);\r\n  const [sendSuccess, setSendSuccess] = useState(false);\r\n\r\n  // Initialize form with customer email\r\n  useEffect(() => {\r\n    if (visible && customerEmail) {\r\n      form.setFieldsValue({\r\n        to: customerEmail,\r\n        subject: `Invoice #${billData?.invoice_no || ''} - ${customerName || ''}`\r\n      });\r\n    }\r\n  }, [visible, customerEmail, customerName, billData, form]);\r\n\r\n  // Generate email preview\r\n  const generatePreview = async () => {\r\n    if (!billData) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      // Simulate generating email preview (you can replace this with actual API call)\r\n      const preview: EmailPreview = {\r\n        subject: `Invoice #${billData.invoice_no} - ${billData.customerDetails?.full_name || 'Customer'}`,\r\n        text: generateInvoiceText(billData),\r\n        html: generateInvoiceHTML(billData)\r\n      };\r\n      \r\n      setEmailPreview(preview);\r\n      setPreviewMode(true);\r\n      form.setFieldsValue({ subject: preview.subject });\r\n    } catch (error) {\r\n      message.error('Failed to generate email preview');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Generate invoice text content\r\n  const generateInvoiceText = (invoiceData: any) => {\r\n    return `\r\nDear ${invoiceData.customerDetails?.full_name || 'Valued Customer'},\r\n\r\nThank you for your business! Please find your invoice details below:\r\n\r\nInvoice Number: ${invoiceData.invoice_no}\r\nDate: ${new Date(invoiceData.date).toLocaleDateString()}\r\nTotal Amount: ₹${invoiceData.total_amount || 0}\r\n\r\nItems:\r\n${invoiceData.Items?.map((item: any) => \r\n  `- ${item.productItems?.name} (${item.qty} x ₹${item.price}) = ₹${item.amount}`\r\n).join('\\n') || 'No items'}\r\n\r\nPayment Status: ${invoiceData.is_paid ? 'Paid' : 'Pending'}\r\n\r\nThank you for choosing us!\r\n\r\nBest regards,\r\nSubriva Billing Team\r\n    `.trim();\r\n  };\r\n\r\n  // Generate invoice HTML content\r\n  const generateInvoiceHTML = (invoiceData: any) => {\r\n    return `\r\n    <!DOCTYPE html>\r\n    <html>\r\n    <head>\r\n        <meta charset=\"UTF-8\">\r\n        <style>\r\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\r\n            .header { background: #f8f9fa; padding: 20px; text-align: center; }\r\n            .content { padding: 20px; }\r\n            .invoice-table { width: 100%; border-collapse: collapse; margin: 20px 0; }\r\n            .invoice-table th, .invoice-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }\r\n            .invoice-table th { background-color: #f8f9fa; }\r\n            .total { font-weight: bold; font-size: 18px; }\r\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; margin-top: 20px; }\r\n        </style>\r\n    </head>\r\n    <body>\r\n        <div class=\"header\">\r\n            <h1>Subriva Billing</h1>\r\n            <h2>Invoice #${invoiceData.invoice_no}</h2>\r\n        </div>\r\n        \r\n        <div class=\"content\">\r\n            <p>Dear <strong>${invoiceData.customerDetails?.full_name || 'Valued Customer'}</strong>,</p>\r\n            \r\n            <p>Thank you for your business! Please find your invoice details below:</p>\r\n            \r\n            <table class=\"invoice-table\">\r\n                <tr>\r\n                    <th>Invoice Number</th>\r\n                    <td>${invoiceData.invoice_no}</td>\r\n                </tr>\r\n                <tr>\r\n                    <th>Date</th>\r\n                    <td>${new Date(invoiceData.date).toLocaleDateString()}</td>\r\n                </tr>\r\n                <tr>\r\n                    <th>Customer</th>\r\n                    <td>${invoiceData.customerDetails?.full_name || 'N/A'}</td>\r\n                </tr>\r\n            </table>\r\n            \r\n            <h3>Items:</h3>\r\n            <table class=\"invoice-table\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Product</th>\r\n                        <th>Quantity</th>\r\n                        <th>Price</th>\r\n                        <th>Amount</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    ${invoiceData.Items?.map((item: any) => `\r\n                        <tr>\r\n                            <td>${item.productItems?.name || 'N/A'}</td>\r\n                            <td>${item.qty || 0}</td>\r\n                            <td>₹${item.price || 0}</td>\r\n                            <td>₹${item.amount || 0}</td>\r\n                        </tr>\r\n                    `).join('') || '<tr><td colspan=\"4\">No items</td></tr>'}\r\n                </tbody>\r\n                <tfoot>\r\n                    <tr class=\"total\">\r\n                        <td colspan=\"3\">Total Amount</td>\r\n                        <td>₹${invoiceData.total_amount || 0}</td>\r\n                    </tr>\r\n                </tfoot>\r\n            </table>\r\n            \r\n            <p><strong>Payment Status:</strong> ${invoiceData.is_paid ? 'Paid' : 'Pending'}</p>\r\n        </div>\r\n        \r\n        <div class=\"footer\">\r\n            <p>Thank you for choosing us!</p>\r\n            <p><strong>Best regards,<br>Subriva Billing Team</strong></p>\r\n        </div>\r\n    </body>\r\n    </html>\r\n    `;\r\n  };\r\n\r\n  // Handle email sending\r\n  const handleSendEmail = async (values: any) => {\r\n    if (!billData) {\r\n      message.error('No bill data available');\r\n      return;\r\n    }\r\n\r\n    setSending(true);\r\n    try {\r\n      // Call backend email API\r\n      const token = sessionStorage.getItem('token');\r\n      const csrfToken = sessionStorage.getItem('csrf-token');\r\n      \r\n      const response = await fetch(`${process.env.REACT_APP_API_URL || ''}/email/send-invoice`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'token': token || '',\r\n          'x-csrf-token': csrfToken || ''\r\n        },\r\n        body: JSON.stringify({\r\n          customerEmail: values.to,\r\n          invoiceData: billData,\r\n          subject: values.subject,\r\n          customMessage: values.message || ''\r\n        })\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        setSendSuccess(true);\r\n        message.success(`Invoice sent successfully to ${values.to}`);\r\n        setTimeout(() => {\r\n          onClose();\r\n        }, 2000);\r\n      } else {\r\n        message.error(result.error || 'Failed to send email');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sending email:', error);\r\n      message.error('Failed to send email. Please try again.');\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  // Handle form submission\r\n  const handleSubmit = () => {\r\n    form.validateFields().then(handleSendEmail);\r\n  };\r\n\r\n  // Reset modal state when closing\r\n  const handleClose = () => {\r\n    form.resetFields();\r\n    setPreviewMode(false);\r\n    setEmailPreview(null);\r\n    setSendSuccess(false);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div className={styles.emailSendHeader}>\r\n          <MailOutlined />\r\n          <span>Send Invoice via Email</span>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={handleClose}\r\n      width={900}\r\n      className={styles.emailSendModal}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div className={styles.emailSendContent}>\r\n        {sendSuccess ? (\r\n          // Success State\r\n          <div className={styles.successState}>\r\n            <CheckCircleOutlined className={styles.successIcon} />\r\n            <Title level={3}>Email Sent Successfully!</Title>\r\n            <Text type=\"secondary\">\r\n              The invoice has been sent to {form.getFieldValue('to')}\r\n            </Text>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {/* Email Form */}\r\n            <Form\r\n              form={form}\r\n              layout=\"vertical\"\r\n              onFinish={handleSubmit}\r\n              className={styles.emailForm}\r\n            >\r\n                <div className={styles.formSection}>\r\n                <Title level={4}>Email Details</Title>\r\n                \r\n                <Form.Item\r\n                  label=\"To\"\r\n                  name=\"to\"\r\n                  rules={[\r\n                    { required: true, message: 'Please enter recipient email' },\r\n                    { type: 'email', message: 'Please enter valid email address' }\r\n                  ]}\r\n                >\r\n                  <Input\r\n                    prefix={<MailOutlined />}\r\n                    placeholder=\"customer@example.com\"\r\n                    size=\"large\"\r\n                  />\r\n                </Form.Item>\r\n\r\n                <Form.Item\r\n                  label=\"Subject\"\r\n                  name=\"subject\"\r\n                  rules={[{ required: true, message: 'Please enter email subject' }]}\r\n                >\r\n                  <Input\r\n                    placeholder=\"Invoice subject\"\r\n                    size=\"large\"\r\n                  />\r\n                </Form.Item>\r\n\r\n                <Form.Item\r\n                  label=\"Custom Message (Optional)\"\r\n                  name=\"message\"\r\n                >\r\n                  <TextArea\r\n                    rows={3}\r\n                    placeholder=\"Add a personal message to the customer...\"\r\n                  />\r\n                </Form.Item>\r\n              </div>\r\n\r\n              <Divider />\r\n\r\n              {/* Actions */}\r\n              <div className={styles.formActions}>\r\n                <Space>\r\n                  <Button\r\n                    icon={<EyeOutlined />}\r\n                    onClick={generatePreview}\r\n                    loading={loading}\r\n                    disabled={!billData}\r\n                  >\r\n                    Preview Email\r\n                  </Button>\r\n                  \r\n                  <Button\r\n                    type=\"primary\"\r\n                    icon={<SendOutlined />}\r\n                    htmlType=\"submit\"\r\n                    loading={sending}\r\n                    disabled={!billData}\r\n                  >\r\n                    Send Email\r\n                  </Button>\r\n                  \r\n                  <Button onClick={handleClose}>\r\n                    Cancel\r\n                  </Button>\r\n                </Space>\r\n              </div>\r\n            </Form>\r\n\r\n            {/* Email Preview */}\r\n            {previewMode && emailPreview && (\r\n              <div className={styles.emailPreview}>\r\n                <Divider>Email Preview</Divider>\r\n                <div className={styles.previewContent}>\r\n                  <div className={styles.previewHeader}>\r\n                    <Title level={5}>Subject: {emailPreview.subject}</Title>\r\n                  </div>\r\n                  \r\n                  <div className={styles.previewBody}>\r\n                    <div \r\n                      className={styles.htmlPreview}\r\n                      dangerouslySetInnerHTML={{ __html: sanitizeRichText(emailPreview.html) }}\r\n                    />\r\n                  </div>\r\n                  \r\n                  <div className={styles.previewActions}>\r\n                    <Button\r\n                      type=\"primary\"\r\n                      icon={<SendOutlined />}\r\n                      onClick={handleSubmit}\r\n                      loading={sending}\r\n                    >\r\n                      Send This Email\r\n                    </Button>\r\n                    <Button onClick={() => setPreviewMode(false)}>\r\n                      Back to Edit\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Bill Info */}\r\n            {billData && (\r\n              <div className={styles.billInfo}>\r\n                <Alert\r\n                  message=\"Invoice Information\"\r\n                  description={\r\n                    <div>\r\n                      <Text strong>Invoice #:</Text> {billData.invoice_no}<br />\r\n                      <Text strong>Customer:</Text> {billData.customerDetails?.full_name || 'N/A'}<br />\r\n                      <Text strong>Amount:</Text> ₹{billData.total_amount || 0}\r\n                    </div>\r\n                  }\r\n                  type=\"info\"\r\n                  showIcon\r\n                />\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default EmailSendModal;\r\n","import React, { useRef, useState } from \"react\";\r\nimport { Modal, Button, Table, Typography } from \"antd\";\r\nimport { PrinterOutlined, MailOutlined } from \"@ant-design/icons\";\r\nimport EmailSendModal from '../../../components/common/EmailSendModal';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillViewModalProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  billData: {\r\n    invoice_no: string;\r\n    date: string;\r\n    sub_total: number;\r\n    customerDetails: any;\r\n    payment_mode: string;\r\n    Items: any[];\r\n    total_gst: number;\r\n    cgst: number;\r\n    sgst: number;\r\n    total_amount: number;\r\n    is_paid: boolean;\r\n    is_partially_paid: boolean;\r\n    paid_amount: number;\r\n    discount: number;\r\n    discount_type: string;\r\n    is_gst_included: boolean;\r\n    sale_type: \"retail\" | \"wholesale\";\r\n    value_of_goods: number;\r\n  };\r\n}\r\n\r\nconst BillViewModal: React.FC<BillViewModalProps> = ({\r\n  visible,\r\n  onClose,\r\n  billData,\r\n}) => {\r\n  const printFrameRef = useRef<HTMLIFrameElement>(null);\r\n  const [emailModalVisible, setEmailModalVisible] = useState(false);\r\n  const formatAmount = (amount: any) => {\r\n    const numAmount = Number(amount) || 0;\r\n    return numAmount.toFixed(2);\r\n  };\r\n  const shopDetails = {\r\n    name: \"Focuz Medicals\",\r\n    address: \"123 MG Road, Bangalore, Karnataka - 560001\",\r\n    gst: \"29ABCDE1234F1Z5\",\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      title: \"Item\",\r\n      dataIndex: \"productItems\",\r\n      key: \"name\",\r\n      render: (_: any, record: any) => {\r\n        const product = record.productItems;\r\n        if (!product) return \"\";\r\n        const variantName = product.VariantItem?.variant_name;\r\n        return variantName ? `${product.name} - ${variantName}` : product.name;\r\n      },\r\n    },\r\n    {\r\n      title: \"Qty\",\r\n      dataIndex: \"qty\",\r\n      key: \"qty\",\r\n      width: 100,\r\n      render: (qty: any) => qty || 0,\r\n    },\r\n    {\r\n      title: \"Loose Qty\",\r\n      dataIndex: \"loose_qty\",\r\n      key: \"loose_qty\",\r\n      width: 100,\r\n      render: (loose_qty: any) => loose_qty || 0,\r\n    },\r\n    {\r\n      title: \"Price\",\r\n      dataIndex: \"price\",\r\n      key: \"price\",\r\n      width: 120,\r\n      render: (price: any) => `₹ ${formatAmount(price)}`,\r\n    },\r\n    {\r\n      title: \"Amount\",\r\n      dataIndex: \"amount\",\r\n      key: \"amount\",\r\n      width: 120,\r\n      render: (amount: any) => `₹ ${formatAmount(amount)}`,\r\n    },\r\n  ];\r\n\r\n  const handlePrint = () => {\r\n    const content = `\r\n      <html>\r\n        <head>\r\n          <title>Sale - ${billData.invoice_no}</title>\r\n          <style>\r\n            body { font-family: Arial, sans-serif; padding: 20px; color: #222; }\r\n            .shop-info { text-align: center; margin-bottom: 20px; }\r\n            .shop-info h2 { margin-bottom: 0; color: #1890ff; }\r\n            .info-flex { display: flex; justify-content: space-between; margin-bottom: 10px; }\r\n            table { width: 100%; border-collapse: collapse; margin-top: 20px; }\r\n            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\r\n            th { background-color: #f5f5f5; }\r\n            .total { text-align: right; font-weight: bold; margin-top: 10px; }\r\n            .thank-you { text-align: center; margin-top: 40px; font-size: 16px; color: #1890ff; font-weight: bold; }\r\n            @media print {\r\n              .no-print { display: none; }\r\n            }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"shop-info\">\r\n            <h2>${shopDetails.name}</h2>\r\n            <p>${shopDetails.address}</p>\r\n            <p><strong>GST No:</strong> ${shopDetails.gst}</p>\r\n          </div>\r\n\r\n          <div class=\"info-flex\">\r\n            <div>\r\n              <p><strong>Invoice No:</strong> ${billData.invoice_no}</p>\r\n              <p><strong>Date:</strong> ${new Date(\r\n                billData.date\r\n              ).toLocaleDateString()}</p>\r\n            </div>\r\n            <div style=\"text-align: right;\">\r\n              <p><strong>Customer:</strong> ${\r\n                billData.customerDetails?.full_name || \"\"\r\n              }</p>\r\n              <p><strong>Payment Mode:</strong> ${\r\n                billData.payment_mode || \"\"\r\n              }</p>\r\n            </div>\r\n          </div>\r\n\r\n          <table>\r\n            <thead>\r\n              <tr>\r\n                <th>Item</th>\r\n                <th>Qty</th>\r\n                <th>Loose Qty</th>\r\n                <th>Price</th>\r\n                <th>Amount</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              ${billData.Items.map((item) => {\r\n                const product = item.productItems;\r\n                const itemName = product\r\n                  ? `${product.name}${\r\n                      product.VariantItem?.variant_name\r\n                        ? ` - ${product.VariantItem.variant_name}`\r\n                        : \"\"\r\n                    }`\r\n                  : \"\";\r\n                return `\r\n                  <tr>\r\n                    <td>${itemName}</td>\r\n                    <td>${item.qty || 0}</td>\r\n                    <td>${item.loose_qty || 0}</td>\r\n                    <td>₹ ${formatAmount(item.price)}</td>\r\n                    <td>₹ ${formatAmount(item.amount)}</td>\r\n                  </tr>\r\n                `;\r\n              }).join(\"\")}\r\n            </tbody>\r\n          </table>\r\n\r\n          <div class=\"total\">\r\n            <p>Value of Goods: ₹ ${formatAmount(billData.value_of_goods)}</p>\r\n            ${\r\n              billData.discount > 0\r\n                ? `\r\n              <p>Discount: ${\r\n                billData.discount_type === \"percentage\"\r\n                  ? billData.discount + \"%\"\r\n                  : \"₹ \" + formatAmount(billData.discount)\r\n              }</p>\r\n            `\r\n                : \"\"\r\n            }\r\n            <p>Total GST: ₹ ${formatAmount(billData.total_gst)}</p>\r\n            <p>CGST: ₹ ${formatAmount(billData.cgst || billData.total_gst / 2)}</p>\r\n            <p>SGST: ₹ ${formatAmount(billData.sgst || billData.total_gst / 2)}</p>\r\n            <p><strong>${\r\n              billData.sale_type === \"retail\" ? \"Bill Value\" : \"Invoice Value\"\r\n            }: ₹ ${formatAmount(billData.total_amount)}</strong></p>\r\n            ${\r\n              billData.is_partially_paid\r\n                ? `\r\n              <p>Paid Amount: ₹ ${formatAmount(billData.paid_amount)}</p>\r\n              <p>Remaining Amount: ₹ ${formatAmount(\r\n                Number(billData.total_amount) - Number(billData.paid_amount)\r\n              )}</p>\r\n            `\r\n                : \"\"\r\n            }\r\n            <p><strong>Payment Status:</strong> ${\r\n              billData.is_paid\r\n                ? \"Fully Paid\"\r\n                : billData.is_partially_paid\r\n                ? \"Partially Paid\"\r\n                : \"Unpaid\"\r\n            }</p>\r\n          </div>\r\n\r\n          <div class=\"thank-you\">\r\n            Thank you for shopping with us!\r\n          </div>\r\n\r\n          <script>\r\n            window.onload = function() {\r\n              window.print();\r\n              window.onafterprint = function() {\r\n                window.parent.postMessage('printComplete', '*');\r\n              };\r\n            };\r\n          </script>\r\n        </body>\r\n      </html>\r\n    `;\r\n\r\n    const iframe = printFrameRef.current;\r\n    iframe!.contentWindow!.document.open();\r\n    iframe!.contentWindow!.document.write(content);\r\n    iframe!.contentWindow!.document.close();\r\n\r\n    const handleMessage = (event: MessageEvent) => {\r\n      if (event.data === \"printComplete\") {\r\n        window.removeEventListener(\"message\", handleMessage);\r\n        clearTimeout(cleanupTimer);\r\n        onClose();\r\n      }\r\n    };\r\n    window.addEventListener(\"message\", handleMessage);\r\n\r\n    // Cleanup listener after a timeout in case print doesn't respond\r\n    const cleanupTimer = setTimeout(() => {\r\n      window.removeEventListener(\"message\", handleMessage);\r\n    }, 10000);\r\n  };\r\n\r\n  \r\n\r\n  return (\r\n    <>\r\n      <Modal\r\n        title={\r\n          <Title level={4} style={{ margin: 0, color: \"#1890ff\" }}>\r\n            Sale Details\r\n          </Title>\r\n        }\r\n        open={visible}\r\n        onCancel={onClose}\r\n        width={800}\r\n        footer={[\r\n          <Button\r\n            key=\"email\"\r\n            type=\"primary\"\r\n            icon={<MailOutlined />}\r\n            onClick={() => setEmailModalVisible(true)}\r\n          >\r\n            Send via Email\r\n          </Button>,\r\n          <Button\r\n            key=\"print\"\r\n            icon={<PrinterOutlined />}\r\n            onClick={handlePrint}\r\n          >\r\n            Print Sale\r\n          </Button>,\r\n          <Button key=\"close\" onClick={onClose}>\r\n            Close\r\n          </Button>,\r\n        ]}\r\n      >\r\n        <div style={{ textAlign: \"center\", marginBottom: 16 }}>\r\n          <Title level={4} style={{ marginBottom: 0, color: \"#1890ff\" }}>\r\n            {shopDetails.name}\r\n          </Title>\r\n          <Text>{shopDetails.address}</Text>\r\n          <br />\r\n          <Text>\r\n            <strong>GST No:</strong> <Text code>{shopDetails.gst}</Text>\r\n          </Text>\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            display: \"flex\",\r\n            justifyContent: \"space-between\",\r\n            marginBottom: 20,\r\n          }}\r\n        >\r\n          <div>\r\n            <Text strong>Invoice No:</Text> {billData.invoice_no}\r\n            <br />\r\n            <Text strong>Date:</Text>{\" \"}\r\n            {new Date(billData.date).toLocaleDateString()}\r\n          </div>\r\n          <div style={{ textAlign: \"right\" }}>\r\n            <Text strong>Customer:</Text> {billData.customerDetails?.full_name}\r\n            <br />\r\n            <Text strong>Payment Mode:</Text> {billData.payment_mode}\r\n          </div>\r\n        </div>\r\n        <Table\r\n          dataSource={billData.Items}\r\n          columns={columns}\r\n          pagination={false}\r\n          bordered\r\n          summary={() => (\r\n            <Table.Summary.Row>\r\n              <Table.Summary.Cell index={0} colSpan={4}>\r\n                <Text strong>Total Amount:</Text>\r\n              </Table.Summary.Cell>\r\n              <Table.Summary.Cell index={1}>\r\n                <Text strong>₹ {formatAmount(billData.sub_total)}</Text>\r\n              </Table.Summary.Cell>\r\n            </Table.Summary.Row>\r\n          )}\r\n        />\r\n\r\n        <div style={{ marginTop: 20, textAlign: \"right\" }}>\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: \"8px\",\r\n              marginBottom: \"8px\",\r\n            }}\r\n          >\r\n            <Text strong>Value of Goods:</Text>\r\n            <Text>₹ {formatAmount(billData.value_of_goods)}</Text>\r\n          </div>\r\n          {billData.discount > 0 && (\r\n            <div\r\n              style={{\r\n                display: \"flex\",\r\n                justifyContent: \"flex-end\",\r\n                gap: \"8px\",\r\n                marginBottom: \"8px\",\r\n              }}\r\n            >\r\n              <Text strong>Discount:</Text>\r\n              <Text>\r\n                {billData.discount_type === \"percentage\"\r\n                  ? `${billData.discount}%`\r\n                  : `₹ ${formatAmount(billData.discount)}`}\r\n              </Text>\r\n            </div>\r\n          )}\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: \"8px\",\r\n              marginBottom: \"8px\",\r\n            }}\r\n          >\r\n            <Text strong>Total GST:</Text>\r\n            <Text>₹ {formatAmount(billData.total_gst)}</Text>\r\n          </div>\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: \"8px\",\r\n              marginBottom: \"8px\",\r\n            }}\r\n          >\r\n            <Text strong>CGST:</Text>\r\n            <Text>₹ {formatAmount(billData.cgst || billData.total_gst / 2)}</Text>\r\n          </div>\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: \"8px\",\r\n              marginBottom: \"8px\",\r\n            }}\r\n          >\r\n            <Text strong>SGST:</Text>\r\n            <Text>₹ {formatAmount(billData.sgst || billData.total_gst / 2)}</Text>\r\n          </div>\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: \"8px\",\r\n              marginBottom: \"8px\",\r\n            }}\r\n          >\r\n            <Text strong>\r\n              {billData.sale_type === \"retail\" ? \"Bill Value\" : \"Invoice Value\"}\r\n              :\r\n            </Text>\r\n            <Text>₹ {formatAmount(billData.total_amount)}</Text>\r\n          </div>\r\n          <Text strong>Payment Status: </Text>\r\n          {billData.is_paid ? (\r\n            <Text type=\"success\">Fully Paid</Text>\r\n          ) : billData.is_partially_paid ? (\r\n            <>\r\n              <Text type=\"warning\">Partially Paid</Text>\r\n              <br />\r\n              <Text>Paid Amount: ₹ {formatAmount(billData.paid_amount)}</Text>\r\n              <br />\r\n              <Text>\r\n                Remaining Amount: ₹{\" \"}\r\n                {formatAmount(\r\n                  Number(billData.total_amount) - Number(billData.paid_amount)\r\n                )}\r\n              </Text>\r\n            </>\r\n          ) : (\r\n            <Text type=\"danger\">Unpaid</Text>\r\n          )}\r\n        </div>\r\n\r\n        <div style={{ textAlign: \"center\", marginTop: 40 }}>\r\n          <Text style={{ color: \"#1890ff\", fontWeight: 500 }}>\r\n            Thank you for shopping with us!\r\n          </Text>\r\n        </div>\r\n      </Modal>\r\n\r\n      <iframe\r\n        ref={printFrameRef}\r\n        style={{ display: \"none\" }}\r\n        title=\"print-frame\"\r\n      />\r\n\r\n      {/* Email Send Modal */}\r\n      <EmailSendModal\r\n        visible={emailModalVisible}\r\n        onClose={() => setEmailModalVisible(false)}\r\n        billData={billData}\r\n        customerEmail={billData?.customerDetails?.email}\r\n        customerName={billData?.customerDetails?.full_name}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default BillViewModal;\r\n","import React, { useEffect, useState, useMemo } from \"react\";\r\nimport {\r\n  Button,\r\n  Space,\r\n  Popconfirm,\r\n  Tag,\r\n  Typography,\r\n  Form,\r\n  Input,\r\n  Tooltip,\r\n  Modal,\r\n  Tabs,\r\n} from \"antd\";\r\nimport {\r\n  EyeOutlined,\r\n  DeleteOutlined,\r\n  PrinterOutlined,\r\n  PlusOutlined,\r\n  SearchOutlined,\r\n  DollarOutlined,\r\n  CreditCardOutlined,\r\n  UserOutlined,\r\n  CalendarOutlined,\r\n  FileTextOutlined,\r\n  MailOutlined,\r\n  DownloadOutlined,\r\n} from \"@ant-design/icons\";\r\nimport dayjs from \"dayjs\";\r\nimport ReactDOMServer from 'react-dom/server';\r\nimport GlobalDrawer from \"../../components/antd/GlobalDrawer\";\r\nimport BillDataGrid from \"./components/BillDataGrid\";\r\nimport BillViewModal from \"./components/BillViewModal\";\r\nimport GlobalTable from \"../../components/antd/GlobalTable\";\r\nimport { useHandleApiResponse } from \"../../components/common/useHandleApiResponse\";\r\nimport { useGenericCrudRTK } from \"../../hooks/useGenericCrudRTK\";\r\nimport EmailSendModal from \"../../components/common/EmailSendModal\";\r\nimport { useTemplateSettings } from '../../hooks/useTemplateSettings';\r\nimport { usePrintDocument } from '../../hooks/usePrintDocument';\r\nimport { getCurrentUser } from \"../../helpers/auth\";\r\nimport { apiSlice } from \"../../services/redux/api/apiSlice\";\r\n\r\nconst { Title } = Typography;\r\n\r\nconst BillListPage = () => {\r\n  // Get template settings and print hook\r\n  const { BillTemplateComponent, InvoiceTemplateComponent, settings } = useTemplateSettings();\r\n  const { printDocument } = usePrintDocument();\r\n  \r\n  // Get current user data for organization details\r\n  const userItem = useMemo(() => {\r\n    const user = getCurrentUser();\r\n    return user;\r\n  }, []);\r\n\r\n  // Fetch organization data from API\r\n  const organisationId = userItem?.organisation_id || userItem?.organisationItems?._id;\r\n  const { data: organisationsData } = apiSlice.useGetOrganisationsQuery(\r\n    { organisation_id: organisationId },\r\n    { skip: !organisationId }\r\n  );\r\n\r\n  // Get organization details from API response\r\n  const organisationDetails = useMemo(() => {\r\n    const result = (organisationsData as any)?.result;\r\n    if (Array.isArray(result)) {\r\n      return result[0];\r\n    }\r\n    return result || userItem?.organisationItems || {};\r\n  }, [organisationsData, userItem]);\r\n  \r\n  const [selectedBill, setSelectedBill] = useState<any>(null);\r\n  const [isDrawerOpen, setIsDrawerOpen] = useState(false);\r\n  const [billViewVisible, setBillViewVisible] = useState(false);\r\n  const [form] = Form.useForm();\r\n  const [searchText, setSearchText] = useState(\"\");\r\n  const [pagination, setPagination] = useState({\r\n    current: 1,\r\n    pageSize: 10,\r\n  });\r\n  const [emailModalVisible, setEmailModalVisible] = useState(false);\r\n  const [selectedBillForEmail, setSelectedBillForEmail] = useState<any>(null);\r\n  const [activeTab, setActiveTab] = useState<string>(\"completed\");\r\n\r\n  // RTK Query hooks for SalesRecord\r\n  const salesRecordRTK = useGenericCrudRTK(\"SalesRecord\");\r\n  const { data: SalesRecordData, isLoading: loading, refetch: refetchSalesList } = salesRecordRTK.useGetAll({\r\n    pageNumber: pagination.current,\r\n    pageLimit: pagination.pageSize,\r\n    searchString: searchText,\r\n  });\r\n  const SalesRecordList = SalesRecordData || { result: [], pagination: null };\r\n\r\n  // Filter bills by status\r\n  const filteredBills = useMemo(() => {\r\n    if (!SalesRecordList?.result) return [];\r\n    \r\n    if (activeTab === \"drafts\") {\r\n      return SalesRecordList.result.filter((bill: any) => bill.status === \"draft\");\r\n    } else {\r\n      // Show completed bills and bills without status (backward compatibility)\r\n      return SalesRecordList.result.filter((bill: any) => \r\n        !bill.status || bill.status === \"completed\"\r\n      );\r\n    }\r\n  }, [SalesRecordList?.result, activeTab]);\r\n  const { delete: deleteSale, ...deleteResult } = salesRecordRTK.useDelete();\r\n\r\n  useHandleApiResponse({\r\n    action: \"delete\",\r\n    title: \"Sale\",\r\n    mutationResult: deleteResult,\r\n    refetch: refetchSalesList,\r\n  });\r\n\r\n  const handleDelete = async (id: string) => {\r\n    try {\r\n      await deleteSale(id);\r\n      // You can add extra logic here if needed (e.g., refresh list, close modal)\r\n    } catch (error) {\r\n      // Optionally handle error here if needed, but notification is handled by the hook\r\n    }\r\n  };\r\n\r\n  const handleView = (record: any) => {\r\n    setSelectedBill(record);\r\n    form.setFieldsValue({\r\n      ...record,\r\n      date: dayjs(record.date),\r\n    });\r\n    setIsDrawerOpen(true);\r\n  };\r\n\r\n  const handleEmail = (record: any) => {\r\n    setSelectedBillForEmail(record);\r\n    setEmailModalVisible(true);\r\n  };\r\n\r\n  // Format bill data for templates\r\n  const formatBillData = (record: any) => {\r\n    // Bills use customerDetails, Invoices use vendorDetails\r\n    const isInvoice = record.document_type === 'invoice';\r\n    const partyDetails = isInvoice ? record.vendorDetails : record.customerDetails;\r\n    \r\n    // If no party details found, log warning and use fallback\r\n    if (!partyDetails) {\r\n      console.warn(`⚠️ Data mismatch: ${isInvoice ? 'Invoice' : 'Bill'} missing ${isInvoice ? 'vendorDetails' : 'customerDetails'}`, record);\r\n    }\r\n    \r\n    return {\r\n      customerName: partyDetails?.vendor_name || partyDetails?.full_name || partyDetails?.name || '',\r\n      customerAddress: partyDetails?.address || partyDetails?.address1 || '',\r\n      customerCity: partyDetails?.city || '',\r\n      customerState: partyDetails?.state || '',\r\n      customerPincode: partyDetails?.pincode || '',\r\n      customerPhone: partyDetails?.phone || partyDetails?.mobile || '',\r\n      customerEmail: partyDetails?.email || '',\r\n      customer_gstin: partyDetails?.gst_no || partyDetails?.gst_number || partyDetails?.gstin || '',\r\n      customer_pan: partyDetails?.pan_no || partyDetails?.pan_number || '',\r\n      date: record.date,\r\n      invoice_no: record.invoice_no,\r\n      items: (record.Items || []).map((item: any) => ({\r\n        name: [\r\n          item.productItems?.name || item.product_name || '',\r\n          item.productItems?.VariantItem?.variant_name || '',\r\n        ].filter(Boolean).join(' '),\r\n        qty: item.qty,\r\n        price: item.price,\r\n        mrp: item.mrp,\r\n        amount: item.amount,\r\n      })),\r\n      total: record.total_amount || 0,\r\n      total_gst: record.total_gst || 0,\r\n      discount: record.discount || 0,\r\n      discount_type: record.discount_type || '',\r\n      gst_number: record.gst_number || record.organisationItems?.gst_number || organisationDetails?.gst_number || '',\r\n      // Add organization details - use record data or fallback to API fetched organization data\r\n      organisationItems: record.organisationItems || organisationDetails || userItem?.organisationItems || {},\r\n      branchItems: record.branchItems || userItem?.branchItems || {},\r\n    };\r\n  };\r\n\r\n  const handlePrint = async (record: any) => {\r\n    const billData = formatBillData(record);\r\n    \r\n    // Use document_type to determine template (default to 'bill' if not specified)\r\n    const documentType = (record.document_type || 'bill') as 'bill' | 'invoice';\r\n    \r\n    // Generate QR code BEFORE printing if enabled\r\n    let enhancedSettings = settings;\r\n    if (settings?.enable_payment_qr && settings?.upi_id) {\r\n      try {\r\n        const { generateUPIQRCode, formatBillToUPIParams } = await import('../../helpers/upiPayment');\r\n        const upiParams = formatBillToUPIParams(billData, settings);\r\n        if (upiParams) {\r\n          const qrCodeDataUrl = await generateUPIQRCode(upiParams, { width: settings?.qr_size || 150 });\r\n          enhancedSettings = { ...settings, qrCodeDataUrl };\r\n        }\r\n      } catch (error) {\r\n        console.error('Error pre-generating QR code for print:', error);\r\n      }\r\n    }\r\n    \r\n    printDocument(billData, documentType, enhancedSettings);\r\n  };\r\n\r\n  const handleDownload = async (record: any) => {\r\n    const billData = formatBillData(record);\r\n    // Use document_type to determine template (default to 'bill' if not specified)\r\n    const documentType = (record.document_type || 'bill') as 'bill' | 'invoice';\r\n    \r\n    // Generate QR code BEFORE rendering if enabled\r\n    let qrCodeDataUrl = '';\r\n    if (settings?.enable_payment_qr && settings?.upi_id) {\r\n      try {\r\n        const { generateUPIQRCode, formatBillToUPIParams } = await import('../../helpers/upiPayment');\r\n        const upiParams = formatBillToUPIParams(billData, settings);\r\n        if (upiParams) {\r\n          qrCodeDataUrl = await generateUPIQRCode(upiParams, { width: settings?.qr_size || 150 });\r\n        }\r\n      } catch (error) {\r\n        console.error('Error pre-generating QR code for download:', error);\r\n      }\r\n    }\r\n    \r\n    // Add QR code to settings\r\n    const enhancedSettings = {\r\n      ...settings,\r\n      qrCodeDataUrl, // Pass pre-generated QR code\r\n    };\r\n    \r\n    // Select appropriate template based on document type\r\n    const TemplateComponent = documentType === 'bill' \r\n      ? BillTemplateComponent \r\n      : InvoiceTemplateComponent;\r\n\r\n    // Create element and render to HTML\r\n    const element = React.createElement(TemplateComponent, { billData, settings: enhancedSettings });\r\n    const templateHtml = ReactDOMServer.renderToString(element);\r\n\r\n    // Create full HTML document\r\n    const fullHtml = `\r\n      <!DOCTYPE html>\r\n      <html>\r\n        <head>\r\n          <meta charset=\"UTF-8\">\r\n          <title>${documentType === 'bill' ? 'Bill' : 'Invoice'} - ${billData.invoice_no}</title>\r\n          <style>\r\n            * {\r\n              margin: 0;\r\n              padding: 0;\r\n              box-sizing: border-box;\r\n            }\r\n            body {\r\n              margin: 0;\r\n              padding: 20px;\r\n              font-family: Arial, sans-serif;\r\n            }\r\n            @media print {\r\n              @page {\r\n                margin: 0;\r\n                size: auto;\r\n              }\r\n              body {\r\n                margin: 0;\r\n                padding: 0;\r\n              }\r\n            }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          ${templateHtml}\r\n        </body>\r\n      </html>\r\n    `;\r\n\r\n    // Create blob and download\r\n    const blob = new Blob([fullHtml], { type: 'text/html' });\r\n    const url = URL.createObjectURL(blob);\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `${documentType}_${billData.invoice_no}_${dayjs().format('YYYYMMDD')}.html`;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n  };\r\n\r\n  const handleSearch = (value: string) => {\r\n    setSearchText(value);\r\n    setPagination({ ...pagination, current: 1 }); // Reset to first page on search\r\n    // RTK Query will automatically refetch with new params\r\n  };\r\n\r\n  const handlePaginationChange = (pageNumber: number, pageLimit: number) => {\r\n    setPagination({ current: pageNumber, pageSize: pageLimit });\r\n    // RTK Query will automatically refetch with new params\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      title: \"Status\",\r\n      dataIndex: \"status\",\r\n      key: \"status\",\r\n      width: 100,\r\n      render: (status: string) => {\r\n        if (status === \"draft\") {\r\n          return <Tag color=\"orange\">DRAFT</Tag>;\r\n        }\r\n        return <Tag color=\"green\">COMPLETED</Tag>;\r\n      },\r\n    },\r\n    {\r\n      title: \"Invoice\",\r\n      dataIndex: \"invoice_no\",\r\n      key: \"invoice_no\",\r\n      render: (text: string) => (\r\n        <Tag icon={<FileTextOutlined />} color=\"blue\">\r\n          {text}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: \"Type\",\r\n      dataIndex: \"document_type\",\r\n      key: \"document_type\",\r\n      width: 100,\r\n      render: (type: string) => {\r\n        const isBill = !type || type === 'bill';\r\n        return (\r\n          <Tag color={isBill ? 'cyan' : 'purple'}>\r\n            {isBill ? 'BILL' : 'INVOICE'}\r\n          </Tag>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      title: \"Date\",\r\n      dataIndex: \"date\",\r\n      key: \"date\",\r\n      render: (text: string) => (\r\n        <Tooltip title={dayjs(text).format(\"MMMM D, YYYY\")}>\r\n          <Tag icon={<CalendarOutlined />} color=\"purple\">\r\n            {dayjs(text).format(\"DD MMM YY\")}\r\n          </Tag>\r\n        </Tooltip>\r\n      ),\r\n    },\r\n    {\r\n      title: \"Customer/Vendor\",\r\n      dataIndex: \"customerDetails\",\r\n      key: \"customerDetails\",\r\n      render: (customerDetails: any, record: any) => {\r\n        // Show vendor for invoices, customer for bills\r\n        const isInvoice = record.document_type === 'invoice';\r\n        const partyDetails = isInvoice ? record.vendorDetails : customerDetails;\r\n        const name = partyDetails?.vendor_name || partyDetails?.full_name || partyDetails?.name || 'N/A';\r\n        const contact = partyDetails?.phone || partyDetails?.mobile || '';\r\n        \r\n        return (\r\n          <Space>\r\n            <UserOutlined />\r\n            <span>\r\n              <strong>{name}</strong>\r\n              <br />\r\n              <small style={{ color: \"#999\" }}>{contact}</small>\r\n            </span>\r\n          </Space>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      title: \"Payment Mode\",\r\n      dataIndex: \"payment_mode\",\r\n      key: \"payment_mode\",\r\n      render: (mode: string) => {\r\n        const color =\r\n          mode === \"cash\" ? \"green\" : mode === \"upi\" ? \"geekblue\" : \"orange\";\r\n        return (\r\n          <Tag icon={<CreditCardOutlined />} color={color}>\r\n            {mode.toUpperCase()}\r\n          </Tag>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      title: \"Total\",\r\n      dataIndex: \"total_amount\",\r\n      key: \"total_amount\",\r\n      render: (amount: number) => (\r\n        <Tag icon={<DollarOutlined />} color=\"gold\">\r\n          ₹ {Number(amount).toFixed(2)}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: \"Actions\",\r\n      key: \"actions\",\r\n      render: (_: any, record: any) => {\r\n        const isDraft = record.status === \"draft\";\r\n        return (\r\n          <Space size=\"middle\">\r\n            <Tooltip title=\"View Bill\">\r\n              <Button\r\n                type=\"link\"\r\n                icon={<EyeOutlined />}\r\n                onClick={() => handleView(record)}\r\n              />\r\n            </Tooltip>\r\n            {!isDraft && (\r\n              <>\r\n                <Tooltip title=\"Send via Email\">\r\n                  <Button\r\n                    type=\"link\"\r\n                    icon={<MailOutlined />}\r\n                    onClick={() => handleEmail(record)}\r\n                  />\r\n                </Tooltip>\r\n                <Tooltip title=\"Print\">\r\n                  <Button\r\n                    type=\"link\"\r\n                    icon={<PrinterOutlined />}\r\n                    onClick={() => handlePrint(record)}\r\n                  />\r\n                </Tooltip>\r\n                <Tooltip title=\"Download\">\r\n                  <Button\r\n                    type=\"link\"\r\n                    icon={<DownloadOutlined />}\r\n                    onClick={() => handleDownload(record)}\r\n                  />\r\n                </Tooltip>\r\n              </>\r\n            )}\r\n            <Popconfirm\r\n              title=\"Are you sure to delete this bill?\"\r\n              onConfirm={() => handleDelete(record._id)}\r\n              okText=\"Yes\"\r\n              cancelText=\"No\"\r\n            >\r\n              <Tooltip title=\"Delete\">\r\n                <Button type=\"link\" icon={<DeleteOutlined />} danger />\r\n              </Tooltip>\r\n            </Popconfirm>\r\n          </Space>\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  // RTK Query handles fetching automatically with params, no useEffect needed\r\n\r\n  return (\r\n    <div style={{ padding: 24 }}>\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          justifyContent: \"space-between\",\r\n          alignItems: \"center\",\r\n          marginBottom: 16,\r\n        }}\r\n      >\r\n        <Title level={3} style={{ color: \"#1890ff\", margin: 0 }}>\r\n          Sales List\r\n        </Title>\r\n        <Space>\r\n          <Input\r\n            placeholder=\"Search by invoice no, customer name or mobile\"\r\n            prefix={<SearchOutlined />}\r\n            allowClear\r\n            style={{ width: 300 }}\r\n            onChange={(e) => handleSearch(e.target.value)}\r\n          />\r\n          <Button\r\n            type=\"primary\"\r\n            icon={<PlusOutlined />}\r\n            onClick={() => {\r\n              setSelectedBill(null);\r\n              setIsDrawerOpen(true);\r\n            }}\r\n          >\r\n            Create New Sale\r\n          </Button>\r\n        </Space>\r\n      </div>\r\n\r\n      <Tabs\r\n        activeKey={activeTab}\r\n        onChange={setActiveTab}\r\n        items={[\r\n          {\r\n            key: \"completed\",\r\n            label: (\r\n              <span>\r\n                ✅ Completed Bills ({SalesRecordList?.result?.filter((b: any) => !b.status || b.status === \"completed\").length || 0})\r\n              </span>\r\n            ),\r\n          },\r\n          {\r\n            key: \"drafts\",\r\n            label: (\r\n              <span>\r\n                📝 Drafts ({SalesRecordList?.result?.filter((b: any) => b.status === \"draft\").length || 0})\r\n              </span>\r\n            ),\r\n          },\r\n        ]}\r\n        style={{ marginBottom: 16 }}\r\n      />\r\n\r\n      <GlobalTable\r\n        data={filteredBills}\r\n        columns={columns}\r\n        loading={loading}\r\n        bordered\r\n        rowKey=\"_id\"\r\n        totalCount={filteredBills.length}\r\n        pageLimit={pagination.pageSize}\r\n        onPaginationChange={handlePaginationChange}\r\n      />\r\n\r\n      <GlobalDrawer\r\n        title={selectedBill ? \"Edit Sale\" : \"Create New Sale\"}\r\n        onClose={() => setIsDrawerOpen(false)}\r\n        open={isDrawerOpen}\r\n        width=\"100%\"\r\n      >\r\n        <BillDataGrid\r\n          billdata={selectedBill}\r\n          onSuccess={() => {\r\n            setIsDrawerOpen(false);\r\n            refetchSalesList();\r\n          }}\r\n        />\r\n      </GlobalDrawer>\r\n\r\n      {selectedBill && (\r\n        <BillViewModal\r\n          visible={billViewVisible}\r\n          onClose={() => setBillViewVisible(false)}\r\n          billData={selectedBill}\r\n        />\r\n      )}\r\n\r\n      {/* Email Send Modal */}\r\n      <EmailSendModal\r\n        visible={emailModalVisible}\r\n        onClose={() => {\r\n          setEmailModalVisible(false);\r\n          setSelectedBillForEmail(null);\r\n        }}\r\n        billData={selectedBillForEmail}\r\n        customerEmail={selectedBillForEmail?.customerDetails?.email}\r\n        customerName={selectedBillForEmail?.customerDetails?.full_name}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillListPage;"],"names":["Title","Text","Typography","TextArea","Input","_ref","_billData$customerDet2","visible","onClose","billData","customerEmail","customerName","form","Form","useForm","loading","setLoading","useState","previewMode","setPreviewMode","emailPreview","setEmailPreview","sending","setSending","sendSuccess","setSendSuccess","useEffect","setFieldsValue","to","subject","concat","invoice_no","generateInvoiceText","invoiceData","_invoiceData$customer","_invoiceData$Items","customerDetails","full_name","Date","date","toLocaleDateString","total_amount","Items","map","item","_item$productItems","productItems","name","qty","price","amount","join","is_paid","trim","generateInvoiceHTML","_invoiceData$customer2","_invoiceData$customer3","_invoiceData$Items2","_item$productItems2","handleSendEmail","async","token","sessionStorage","getItem","csrfToken","response","fetch","process","method","headers","body","JSON","stringify","values","customMessage","message","result","json","success","setTimeout","error","console","handleSubmit","validateFields","then","handleClose","resetFields","_jsx","Modal","title","_jsxs","className","styles","children","MailOutlined","open","onCancel","width","footer","destroyOnClose","CheckCircleOutlined","level","type","getFieldValue","_Fragment","layout","onFinish","Item","label","rules","required","prefix","placeholder","size","rows","Divider","Space","Button","icon","EyeOutlined","onClick","_billData$customerDet","preview","text","html","disabled","SendOutlined","htmlType","dangerouslySetInnerHTML","__html","dirty","DOMPurify","sanitize","ALLOWED_TAGS","ALLOWED_ATTR","ALLOW_DATA_ATTR","Alert","description","strong","showIcon","_billData$customerDet3","_billData$customerDet4","printFrameRef","useRef","emailModalVisible","setEmailModalVisible","formatAmount","Number","toFixed","shopDetails","columns","dataIndex","key","render","_","record","_product$VariantItem","product","variantName","VariantItem","variant_name","loose_qty","style","margin","color","PrinterOutlined","handlePrint","content","payment_mode","_product$VariantItem2","itemName","value_of_goods","discount","discount_type","total_gst","cgst","sgst","sale_type","is_partially_paid","paid_amount","iframe","current","contentWindow","document","write","close","handleMessage","event","data","window","removeEventListener","clearTimeout","cleanupTimer","addEventListener","textAlign","marginBottom","code","display","justifyContent","Table","dataSource","pagination","bordered","summary","Summary","Row","Cell","index","colSpan","sub_total","marginTop","gap","fontWeight","ref","EmailSendModal","email","BillListPage","_userItem$organisatio","_SalesRecordList$resu","_SalesRecordList$resu2","_selectedBillForEmail","_selectedBillForEmail2","BillTemplateComponent","InvoiceTemplateComponent","settings","useTemplateSettings","printDocument","usePrintDocument","userItem","useMemo","getCurrentUser","organisationId","organisation_id","organisationItems","_id","organisationsData","apiSlice","useGetOrganisationsQuery","skip","organisationDetails","Array","isArray","selectedBill","setSelectedBill","isDrawerOpen","setIsDrawerOpen","billViewVisible","setBillViewVisible","searchText","setSearchText","setPagination","pageSize","selectedBillForEmail","setSelectedBillForEmail","activeTab","setActiveTab","salesRecordRTK","useGenericCrudRTK","SalesRecordData","isLoading","refetch","refetchSalesList","useGetAll","pageNumber","pageLimit","searchString","SalesRecordList","filteredBills","filter","bill","status","_salesRecordRTK$useDe","useDelete","delete","deleteSale","deleteResult","_objectWithoutProperties","_excluded","useHandleApiResponse","action","mutationResult","formatBillData","_record$organisationI","isInvoice","document_type","partyDetails","vendorDetails","warn","vendor_name","customerAddress","address","address1","customerCity","city","customerState","state","customerPincode","pincode","customerPhone","phone","mobile","customer_gstin","gst_no","gst_number","gstin","customer_pan","pan_no","pan_number","items","_item$productItems2$V","product_name","Boolean","mrp","total","branchItems","Tag","FileTextOutlined","isBill","Tooltip","dayjs","format","CalendarOutlined","contact","UserOutlined","mode","CreditCardOutlined","toUpperCase","DollarOutlined","isDraft","_objectSpread","handleView","handleEmail","documentType","enhancedSettings","enable_payment_qr","upi_id","generateUPIQRCode","formatBillToUPIParams","upiParams","qrCodeDataUrl","qr_size","DownloadOutlined","TemplateComponent","element","React","templateHtml","ReactDOMServer","fullHtml","blob","Blob","url","URL","createObjectURL","link","createElement","href","download","appendChild","click","removeChild","revokeObjectURL","handleDownload","Popconfirm","onConfirm","id","handleDelete","okText","cancelText","DeleteOutlined","danger","padding","alignItems","SearchOutlined","allowClear","onChange","e","handleSearch","value","target","PlusOutlined","Tabs","activeKey","b","length","GlobalTable","rowKey","totalCount","onPaginationChange","handlePaginationChange","GlobalDrawer","BillDataGrid","billdata","onSuccess","BillViewModal"],"sourceRoot":""}