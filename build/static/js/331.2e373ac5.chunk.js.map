{"version":3,"file":"static/js/331.2e373ac5.chunk.js","mappings":"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","sources":["components/common/handleApiResponse.ts","hooks/usePrintDocument.ts","hooks/useTemplateSettings.ts","pages/RetaillBill/components/ProductSelectionModal.tsx","pages/RetaillBill/components/StockSelectionModal.tsx","components/common/AntdEditableTable.tsx","pages/RetaillBill/components/CustomerSelectionModal.tsx","pages/RetaillBill/components/VendorSelectionModal.tsx","pages/RetaillBill/components/UserSelectionModal.tsx","pages/RetaillBill/components/BillSaveConfirmationModal.tsx","pages/RetaillBill/components/BillListDrawer.tsx","pages/RetaillBill/components/ProductDetailsModal.tsx","pages/RetaillBill/components/DocumentTypeToggle.tsx","webpack://SUBRIVA-BILLING/./src/pages/RetaillBill/components/BillDataGrid.module.css?232c","pages/RetaillBill/components/BillDataGrid.tsx","helpers/amount_calculations.ts","hooks/useGenericCrudRTK.ts","components/common/useHandleApiResponse.ts","helpers/Common_functions.ts"],"sourcesContent":["import { showToast } from \"../../helpers/Common_functions\";\r\n\r\ntype ActionType = \"create\" | \"update\" | \"delete\";\r\n\r\ninterface ApiResponseHandlerParams {\r\n  action: ActionType;\r\n  success: boolean;\r\n  title: string;\r\n  getAllItems?: () => void;\r\n  resetForm?: () => void;\r\n  errorMessage?: string;\r\n}\r\n\r\nexport const handleApiResponse = ({\r\n  action,\r\n  success,\r\n  title,\r\n  getAllItems,\r\n  resetForm,\r\n  errorMessage,\r\n}: ApiResponseHandlerParams) => {\r\n  if (success) {\r\n    showToast(\"success\", `${title} ${action}d successfully`);\r\n    getAllItems?.();\r\n    resetForm?.();\r\n    // RTK Query handles cache invalidation automatically, no need for manual clearing\r\n  } else {\r\n    showToast(\"error\", errorMessage || `Failed to ${action} ${title}`);\r\n  }\r\n};\r\n","import React, { useCallback } from 'react';\r\nimport ReactDOMServer from 'react-dom/server';\r\nimport { useTemplateSettings } from './useTemplateSettings';\r\n\r\n/**\r\n * Hook to handle document printing\r\n * Supports both Bill and Invoice types\r\n */\r\nexport const usePrintDocument = () => {\r\n  const { BillTemplateComponent, InvoiceTemplateComponent, settings } = useTemplateSettings();\r\n\r\n  const printDocument = useCallback((\r\n    billData: any,\r\n    documentType: 'bill' | 'invoice',\r\n    enhancedSettings?: any  // Accept pre-enhanced settings with QR code\r\n  ) => {\r\n    // Use enhanced settings if provided, otherwise use default settings\r\n    const finalSettings = enhancedSettings || settings;\r\n    \r\n    // Select appropriate template based on document type\r\n    const TemplateComponent = documentType === 'bill' \r\n      ? BillTemplateComponent \r\n      : InvoiceTemplateComponent;\r\n\r\n    // Create print window\r\n    const printWindow = window.open('', '', 'width=900,height=700');\r\n    \r\n    if (!printWindow) {\r\n      console.error('Failed to open print window');\r\n      return;\r\n    }\r\n\r\n    // Render template to HTML - Pass settings as props to avoid Redux context issues\r\n    const element = React.createElement(TemplateComponent, { billData, settings: finalSettings });\r\n    const templateHtml = ReactDOMServer.renderToString(element);\r\n\r\n    // Write HTML to print window\r\n    printWindow.document.write(`\r\n      <!DOCTYPE html>\r\n      <html>\r\n        <head>\r\n          <title>${documentType === 'bill' ? 'Bill' : 'Invoice'} - ${billData?.invoice_no || ''}</title>\r\n          <style>\r\n            * {\r\n              margin: 0;\r\n              padding: 0;\r\n              box-sizing: border-box;\r\n            }\r\n            body {\r\n              margin: 0;\r\n              padding: 0;\r\n            }\r\n            @media print {\r\n              @page {\r\n                margin: 0;\r\n                size: auto;\r\n              }\r\n              body {\r\n                margin: 0;\r\n                padding: 0;\r\n              }\r\n            }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          ${templateHtml}\r\n          <script>\r\n            // Auto-print after load\r\n            window.onload = function() {\r\n              setTimeout(function() {\r\n                window.print();\r\n              }, 250);\r\n            };\r\n          </script>\r\n        </body>\r\n      </html>\r\n    `);\r\n\r\n    printWindow.document.close();\r\n  }, [BillTemplateComponent, InvoiceTemplateComponent, settings]);\r\n\r\n  const previewDocument = useCallback((\r\n    billData: any,\r\n    documentType: 'bill' | 'invoice',\r\n    enhancedSettings?: any  // Accept pre-enhanced settings with QR code\r\n  ) => {\r\n    // Use enhanced settings if provided, otherwise use default settings\r\n    const finalSettings = enhancedSettings || settings;\r\n    \r\n    // Same as print but without auto-print\r\n    const TemplateComponent = documentType === 'bill' \r\n      ? BillTemplateComponent \r\n      : InvoiceTemplateComponent;\r\n\r\n    const printWindow = window.open('', '', 'width=900,height=700');\r\n    \r\n    if (!printWindow) {\r\n      console.error('Failed to open preview window');\r\n      return;\r\n    }\r\n\r\n    // Pass settings as props to avoid Redux context issues\r\n    const element = React.createElement(TemplateComponent, { billData, settings: finalSettings });\r\n    const templateHtml = ReactDOMServer.renderToString(element);\r\n\r\n    printWindow.document.write(`\r\n      <!DOCTYPE html>\r\n      <html>\r\n        <head>\r\n          <title>Preview - ${documentType === 'bill' ? 'Bill' : 'Invoice'}</title>\r\n          <style>\r\n            * {\r\n              margin: 0;\r\n              padding: 0;\r\n              box-sizing: border-box;\r\n            }\r\n            body {\r\n              margin: 0;\r\n              padding: 20px;\r\n              background: #f5f5f5;\r\n            }\r\n            @media print {\r\n              @page { margin: 0; }\r\n              body { margin: 0; padding: 0; background: white; }\r\n            }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          ${templateHtml}\r\n        </body>\r\n      </html>\r\n    `);\r\n\r\n    printWindow.document.close();\r\n  }, [BillTemplateComponent, InvoiceTemplateComponent, settings]);\r\n\r\n  return {\r\n    printDocument,\r\n    previewDocument,\r\n  };\r\n};\r\n\r\n","import { useMemo } from 'react';\r\nimport { apiSlice } from '../services/redux/api/apiSlice';\r\nimport { getCurrentUser } from '../helpers/auth';\r\nimport { getBillTemplate, getInvoiceTemplate, BillTemplateKey, InvoiceTemplateKey } from '../pages/RetaillBill/templates/registry';\r\n\r\n/**\r\n * Hook to get selected templates from settings\r\n * Returns the template components based on user's settings\r\n */\r\nexport const useTemplateSettings = () => {\r\n  const userItem = useMemo(() => getCurrentUser(), []);\r\n  const organisationId = userItem?.organisation_id || userItem?.organisationItems?._id;\r\n\r\n  // Fetch settings for current organisation\r\n  const { data: settingsData, isLoading } = apiSlice.useGetSettingsQuery(\r\n    { organisation_id: organisationId, page: 1, limit: 1 },\r\n    { \r\n      skip: !organisationId,\r\n      refetchOnMountOrArgChange: false\r\n    }\r\n  );\r\n\r\n  const settings = useMemo(() => {\r\n    const settingsResult = (settingsData as any)?.result || settingsData || {};\r\n    return Array.isArray(settingsResult) ? settingsResult[0] : settingsResult;\r\n  }, [settingsData]);\r\n\r\n  // Get selected template keys from API (no defaults - use actual API values)\r\n  // getBillTemplate/getInvoiceTemplate have built-in fallbacks to 'classic' if key is invalid\r\n  const billTemplateKey = (settings?.bill_template || 'classic') as BillTemplateKey;\r\n  const invoiceTemplateKey = (settings?.invoice_template || 'classic') as InvoiceTemplateKey;\r\n\r\n  // Get template components (these functions handle invalid keys gracefully)\r\n  const BillTemplateComponent = getBillTemplate(billTemplateKey);\r\n  const InvoiceTemplateComponent = getInvoiceTemplate(invoiceTemplateKey);\r\n\r\n  return {\r\n    // Template components ready to use\r\n    BillTemplateComponent,\r\n    InvoiceTemplateComponent,\r\n    \r\n    // Template keys\r\n    billTemplateKey,\r\n    invoiceTemplateKey,\r\n    \r\n    // Loading state\r\n    isLoading,\r\n    \r\n    // Settings data (if you need other settings)\r\n    settings,\r\n  };\r\n};\r\n\r\n","import React, { useEffect, useState, FC, KeyboardEvent, useRef } from 'react';\r\nimport { Modal, Table, Input, Button, Space, message } from 'antd';\r\nimport type { InputRef } from 'antd/es/input';\r\nimport { BarcodeOutlined, ScanOutlined } from '@ant-design/icons';\r\nimport type { ColumnType } from 'antd/es/table';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\nimport BarcodeScanner from '../../../components/common/BarcodeScanner';\r\n\r\nconst { Search } = Input;\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name?: string;\r\n  sku?: string;\r\n  selling_price?: number;\r\n  VariantItem?: {\r\n    variant_name?: string;\r\n    variant_code?: string;\r\n  };\r\n}\r\n\r\ninterface ProductSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (product: Product) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst ProductSelectionModal: FC<ProductSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  // Use RTK Query for products\r\n  const { data: productsData, isLoading: loading } = apiSlice.useGetProductQuery({});\r\n  const products = (productsData as any)?.result || [];\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedRowKey, setSelectedRowKey] = useState<React.Key | null>(null);\r\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\r\n  const [scannerVisible, setScannerVisible] = useState(false);\r\n  const searchInputRef = useRef<InputRef>(null);\r\n\r\n  const filteredProducts: Product[] =\r\n    products?.filter((p: Product) => {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      return (\r\n        (p.name?.toLowerCase() || '').includes(searchLower) ||\r\n        (p.sku?.toLowerCase() || '').includes(searchLower) ||\r\n        p.VariantItem?.variant_name?.toLowerCase().includes(searchLower) ||\r\n        p.VariantItem?.variant_code?.toLowerCase().includes(searchLower) ||\r\n        (p.selling_price?.toString() || '').includes(searchLower)\r\n      );\r\n    }).sort((a: Product, b: Product) => {\r\n      // Prioritize exact matches and matches at the beginning\r\n      const searchLower = searchTerm.toLowerCase();\r\n      \r\n      // Check for exact matches first\r\n      const aExactMatch = (a.name?.toLowerCase() || '') === searchLower || \r\n                          a.VariantItem?.variant_name?.toLowerCase() === searchLower ||\r\n                          (a.sku?.toLowerCase() || '') === searchLower;\r\n      const bExactMatch = (b.name?.toLowerCase() || '') === searchLower || \r\n                          b.VariantItem?.variant_name?.toLowerCase() === searchLower ||\r\n                          (b.sku?.toLowerCase() || '') === searchLower;\r\n      \r\n      if (aExactMatch && !bExactMatch) return -1;\r\n      if (!aExactMatch && bExactMatch) return 1;\r\n      \r\n      // Then check for matches at the beginning\r\n      const aStartsWith = (a.name?.toLowerCase() || '').startsWith(searchLower) || \r\n                          a.VariantItem?.variant_name?.toLowerCase().startsWith(searchLower) ||\r\n                          (a.sku?.toLowerCase() || '').startsWith(searchLower);\r\n      const bStartsWith = (b.name?.toLowerCase() || '').startsWith(searchLower) || \r\n                          b.VariantItem?.variant_name?.toLowerCase().startsWith(searchLower) ||\r\n                          (b.sku?.toLowerCase() || '').startsWith(searchLower);\r\n      \r\n      if (aStartsWith && !bStartsWith) return -1;\r\n      if (!aStartsWith && bStartsWith) return 1;\r\n      \r\n      return 0;\r\n    }) || [];\r\n\r\n  useEffect(() => {\r\n    setHighlightedIndex(0);\r\n    if (filteredProducts.length > 0) {\r\n              setSelectedRowKey(filteredProducts[0]._id);\r\n    } else {\r\n      setSelectedRowKey(null);\r\n    }\r\n  }, [searchTerm, visible, products]);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n      }, 100);\r\n    }\r\n  }, [visible]);\r\n\r\n  const columns: ColumnType<Product>[] = [\r\n    { \r\n      title: 'Product & Variant', \r\n      dataIndex: 'name', \r\n      key: 'name', \r\n      width: 250,\r\n      render: (name, record) => (\r\n        <div>\r\n          <div style={{ fontWeight: 600, color: '#1890ff' }}>{name}</div>\r\n          {record.VariantItem?.variant_name && (\r\n            <div style={{ fontSize: '12px', color: '#52c41a', marginTop: '2px' }}>\r\n              Variant: {record.VariantItem.variant_name}\r\n              {record.VariantItem?.variant_code && (\r\n                <span style={{ marginLeft: '8px', color: '#fa8c16', fontSize: '11px' }}>\r\n                  ({record.VariantItem.variant_code})\r\n                </span>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    { title: 'Variant', dataIndex: 'VariantItem', key: 'variant', width: 120, \r\n      render: (variant) => variant?.variant_name ? (\r\n        <span style={{ color: '#52c41a', fontWeight: 500 }}>{variant.variant_name}</span>\r\n      ) : (\r\n        <span style={{ color: '#bfbfbf', fontStyle: 'italic' }}>No variant</span>\r\n      ) },\r\n    { title: 'SKU', dataIndex: 'sku', key: 'sku', width: 120 },\r\n    { title: 'Price', dataIndex: 'selling_price', key: 'selling_price', width: 100,\r\n      render: (price) => (\r\n        <span style={{ \r\n          color: '#52c41a', \r\n          fontWeight: 600, \r\n          fontSize: '14px' \r\n        }}>\r\n          {price?.toFixed(2) || '0.00'}\r\n        </span>\r\n      ) },\r\n  ];\r\n\r\n  const handleSelectRow = (product: Product) => {\r\n    onSelect(product);\r\n  };\r\n\r\n  // Handle barcode scan\r\n  const handleBarcodeScan = (barcode: string) => {\r\n    setSearchTerm(barcode);\r\n    setScannerVisible(false);\r\n    \r\n    // Try to find product by barcode/SKU\r\n    const foundProduct = products?.result?.find((p: Product) => {\r\n      const searchLower = barcode.toLowerCase();\r\n      return (\r\n        (p.sku?.toLowerCase() || '').includes(searchLower) ||\r\n        (p.name?.toLowerCase() || '').includes(searchLower) ||\r\n        p.VariantItem?.variant_code?.toLowerCase().includes(searchLower)\r\n      );\r\n    });\r\n\r\n    if (foundProduct) {\r\n      // Auto-select the found product\r\n      setTimeout(() => {\r\n        onSelect(foundProduct);\r\n      }, 500);\r\n      message.success(`Product found: ${foundProduct.name}`);\r\n    } else {\r\n      message.warning(`No product found with barcode: ${barcode}`);\r\n    }\r\n  };\r\n\r\n  const handleSearchKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!filteredProducts.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        const next = Math.min(prev + 1, filteredProducts.length - 1);\r\n        setSelectedRowKey(filteredProducts[next]._id);\r\n        return next;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        const prevIndex = Math.max(prev - 1, 0);\r\n        setSelectedRowKey(filteredProducts[prevIndex]._id);\r\n        return prevIndex;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedProduct = filteredProducts[highlightedIndex];\r\n      if (selectedProduct) {\r\n        handleSelectRow(selectedProduct);\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      onCancel();\r\n    }\r\n  };\r\n\r\n  // Auto-focus back to search input when clicking outside\r\n  const handleModalClick = () => {\r\n    searchInputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select Product & Variant (F5 to reopen anytime)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      width={900}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div onClick={handleModalClick}>\r\n        <Space.Compact style={{ marginBottom: 16, width: '100%' }}>\r\n          <Search\r\n            ref={searchInputRef}\r\n            placeholder=\"Search by product name, variant, SKU, or price (use  arrows to navigate, Enter to select)\"\r\n            onChange={e => setSearchTerm(e.target.value)}\r\n            style={{ flex: 1 }}\r\n            autoFocus\r\n            onKeyDown={handleSearchKeyDown}\r\n            onBlur={() => {\r\n              // Re-focus after a short delay to ensure it stays focused\r\n              setTimeout(() => {\r\n                if (visible) {\r\n                  searchInputRef.current?.focus();\r\n                }\r\n              }, 10);\r\n            }}\r\n            value={searchTerm}\r\n          />\r\n          <Button \r\n            type=\"primary\" \r\n            icon={<ScanOutlined />}\r\n            onClick={() => setScannerVisible(true)}\r\n            style={{ minWidth: 100 }}\r\n          >\r\n            Scan\r\n          </Button>\r\n        </Space.Compact>\r\n        <Table\r\n          dataSource={filteredProducts}\r\n          columns={columns}\r\n          loading={loading}\r\n          rowKey=\"_id\"\r\n          size=\"small\"\r\n          pagination={false}\r\n          onRow={(record, idx) => ({\r\n            onClick: () => {\r\n              handleSelectRow(record);\r\n              // Keep focus on search input after selection\r\n              setTimeout(() => {\r\n                searchInputRef.current?.focus();\r\n              }, 10);\r\n            },\r\n            onDoubleClick: () => handleSelectRow(record),\r\n            className:\r\n              idx === highlightedIndex\r\n                ? 'ant-table-row ant-table-row-selected'\r\n                : 'ant-table-row',\r\n            style: {\r\n              backgroundColor: idx === highlightedIndex ? '#e6f7ff' : undefined,\r\n              border: idx === highlightedIndex ? '2px solid #1890ff' : undefined,\r\n            },\r\n          })}\r\n          rowSelection={{\r\n            type: 'radio',\r\n            selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n            onChange: keys => {\r\n              setSelectedRowKey(keys[0]);\r\n              const idx = filteredProducts.findIndex(p => p._id === keys[0]);\r\n              if (idx !== -1) setHighlightedIndex(idx);\r\n            },\r\n          }}\r\n          scroll={{ y: 300 }}\r\n        />\r\n              <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n        <strong>Keyboard Shortcuts:</strong>  Navigate products | Enter Select | Escape Cancel\r\n        <br />\r\n        <strong>Search:</strong> Product name, variant name, SKU, or price\r\n        <br />\r\n        <strong>Barcode Scanner:</strong> Click \"Scan\" button or use USB barcode scanner\r\n        <br />\r\n        <strong>Tip:</strong> Press F5 anytime to reopen this modal for product changes\r\n      </div>\r\n      </div>\r\n\r\n      {/* Barcode Scanner Modal */}\r\n      <BarcodeScanner\r\n        visible={scannerVisible}\r\n        onClose={() => setScannerVisible(false)}\r\n        onScan={handleBarcodeScan}\r\n        title=\"Scan Product Barcode\"\r\n        description=\"Scan barcode to find product automatically\"\r\n      />\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProductSelectionModal;\r\n","import React, { useEffect, useState, FC, KeyboardEvent, useRef } from 'react';\r\nimport { Modal, Table, Input, Tag, Tooltip, message } from 'antd';\r\nimport type { InputRef } from 'antd/es/input';\r\nimport type { ColumnType } from 'antd/es/table';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport SessionStorageEncryption from '../../../helpers/encryption';\r\nimport dayjs from 'dayjs';\r\nimport {\r\n  ExclamationCircleOutlined,\r\n  CheckCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport type { Stock } from '../../../types/entities';\r\n\r\nconst { Search } = Input;\r\n\r\ninterface StockSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (stock: {\r\n    id: string;\r\n    _id: string;\r\n    batch_no: string;\r\n    name: string;\r\n    code?: string;\r\n    available_quantity: number;\r\n    available_loose_quantity?: number;\r\n    sell_price: number;\r\n    ProductItem?: any;\r\n  }) => void;\r\n  onCancel: () => void;\r\n  productId: string;\r\n}\r\n\r\nconst StockSelectionModal: FC<StockSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n  productId, // <-- Destructure\r\n}) => {\r\n  // Resolve user role to decide which stock API to call\r\n  const userItem = getCurrentUser();\r\n  const scopeData = SessionStorageEncryption.getItem('scope');\r\n  const userRole = (\r\n    scopeData?.userType ||\r\n    userItem?.user_type ||\r\n    userItem?.usertype ||\r\n    userItem?.user_role ||\r\n    ''\r\n  ).toLowerCase();\r\n  const isOrganisationUser = userRole === 'organisationuser';\r\n  const isBranchUser = userRole === 'branchuser';\r\n\r\n  // Only fetch after a product is selected and modal is visible\r\n  const shouldFetch = !!productId && !!visible;\r\n\r\n  // Organisation users -> stock_audit\r\n  const { data: orgStocksData, isLoading: loadingOrg } =\r\n    apiSlice.useGetStockAuditQuery(\r\n      { product_id: productId },\r\n      {\r\n        skip: !shouldFetch || !isOrganisationUser,\r\n        refetchOnMountOrArgChange: true,\r\n        refetchOnFocus: true,\r\n        refetchOnReconnect: true,\r\n      }\r\n    );\r\n\r\n  // Branch users -> branch_stock\r\n  const { data: branchStocksData, isLoading: loadingBranch } =\r\n    apiSlice.useGetBranchStockQuery(\r\n      { product_id: productId },\r\n      {\r\n        skip: !shouldFetch || !isBranchUser,\r\n        refetchOnMountOrArgChange: true,\r\n        refetchOnFocus: true,\r\n        refetchOnReconnect: true,\r\n      }\r\n    );\r\n\r\n  const stocks = (\r\n    (isOrganisationUser\r\n      ? (orgStocksData as any)?.result\r\n      : isBranchUser\r\n      ? (branchStocksData as any)?.result\r\n      : []) || []\r\n  ) as Stock[];\r\n  const loading = loadingOrg || loadingBranch;\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedRowKey, setSelectedRowKey] = useState<React.Key | null>(null);\r\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\r\n  const [errorMessage, setErrorMessage] = useState<string>('');\r\n  const tableBodyRef = useRef<HTMLDivElement>(null);\r\n  const searchInputRef = useRef<InputRef>(null);\r\n\r\n  // Helper function to check if stock is expired\r\n  const isStockExpired = (stock: Stock): boolean => {\r\n    return !!(stock.expiry_date && dayjs(stock.expiry_date).isBefore(dayjs()));\r\n  };\r\n\r\n  // Helper function to check if stock has zero quantity\r\n  const isStockOutOfStock = (stock: Stock): boolean => {\r\n    return stock.available_quantity <= 0;\r\n  };\r\n\r\n  // Helper function to show expired stock error message\r\n  const showExpiredStockError = (stock: Stock) => {\r\n    const expiryDate = dayjs(stock.expiry_date).format('DD/MM/YYYY');\r\n    const errorMsg = `Cannot select expired stock! This item expired on ${expiryDate}. Please select a valid stock item.`;\r\n    setErrorMessage(errorMsg);\r\n    message.error(errorMsg);\r\n\r\n    // Clear error message after 5 seconds\r\n    setTimeout(() => {\r\n      setErrorMessage('');\r\n    }, 5000);\r\n  };\r\n\r\n  // Helper function to show out of stock error message\r\n  const showOutOfStockError = (stock: Stock) => {\r\n    const errorMsg = `Cannot select out of stock item! This item has 0 available quantity. Please select a stock item with available quantity.`;\r\n    setErrorMessage(errorMsg);\r\n    message.error(errorMsg);\r\n\r\n    // Clear error message after 5 seconds\r\n    setTimeout(() => {\r\n      setErrorMessage('');\r\n    }, 5000);\r\n  };\r\n\r\n  const filteredStocks: Stock[] =\r\n    (Array.isArray(stocks) ? stocks : []).filter((s: Stock) => {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      return (\r\n        s.batch_no?.toLowerCase().includes(searchLower) ||\r\n        s.ProductItem?.name?.toLowerCase().includes(searchLower) ||\r\n        s.ProductItem?.VariantItem?.variant_name\r\n          ?.toLowerCase()\r\n          .includes(searchLower) ||\r\n        s.available_quantity?.toString().includes(searchLower) ||\r\n        s.sell_price?.toString().includes(searchLower)\r\n      );\r\n    });\r\n\r\n  // Show all stocks including expired ones, but disable selection of expired items\r\n  const allStocks = filteredStocks;\r\n\r\n  useEffect(() => {\r\n    setHighlightedIndex(0);\r\n    setErrorMessage(''); // Clear any existing error messages\r\n    if (allStocks.length > 0) {\r\n      // Find the first valid stock (not expired and not out of stock)\r\n      let firstValidIndex = 0;\r\n      while (\r\n        firstValidIndex < allStocks.length &&\r\n        ((allStocks[firstValidIndex].expiry_date &&\r\n          dayjs(allStocks[firstValidIndex].expiry_date).isBefore(dayjs())) ||\r\n          allStocks[firstValidIndex].available_quantity <= 0)\r\n      ) {\r\n        firstValidIndex++;\r\n      }\r\n      if (firstValidIndex < allStocks.length) {\r\n        setSelectedRowKey(allStocks[firstValidIndex]._id);\r\n        setHighlightedIndex(firstValidIndex);\r\n      } else {\r\n        setSelectedRowKey(null);\r\n      }\r\n    } else {\r\n      setSelectedRowKey(null);\r\n    }\r\n  }, [searchTerm, visible, stocks]);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setErrorMessage(''); // Clear error messages when modal opens\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n      }, 0);\r\n    }\r\n  }, [visible]);\r\n\r\n  useEffect(() => {\r\n    if (tableBodyRef.current) {\r\n      const row = tableBodyRef.current.querySelector(\r\n        `.ant-table-row[data-row-key='${allStocks[highlightedIndex]?._id}']`\r\n      ) as HTMLElement;\r\n      row?.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  }, [highlightedIndex, allStocks]);\r\n\r\n  // RTK Query automatically loads stocks on mount\r\n  // For product filtering, it's handled client-side from cached data\r\n  // TODO: Implement server-side product filtering with RTK Query if needed\r\n\r\n  const columns: ColumnType<Stock>[] = [\r\n    {\r\n      title: 'Product',\r\n      dataIndex: 'ProductItem',\r\n      key: 'product',\r\n      render: (ProductItem: any) => ProductItem?.name || 'N/A',\r\n    },\r\n    {\r\n      title: 'Variant',\r\n      dataIndex: 'ProductItem',\r\n      key: 'variant',\r\n      render: (ProductItem: any) =>\r\n        ProductItem?.VariantItem?.variant_name || 'N/A',\r\n    },\r\n    { title: 'Batch No', dataIndex: 'batch_no', key: 'batch_no' },\r\n    {\r\n      title: 'Available',\r\n      dataIndex: 'available_quantity',\r\n      key: 'available_quantity',\r\n      render: (available_quantity: number, record: Stock) => {\r\n        const isOutOfStock = available_quantity <= 0;\r\n        return (\r\n          <span\r\n            style={{\r\n              color: isOutOfStock ? '#ff4d4f' : '#52c41a',\r\n              fontWeight: isOutOfStock ? 'bold' : 'normal',\r\n            }}\r\n          >\r\n            {available_quantity}\r\n            {isOutOfStock && (\r\n              <ExclamationCircleOutlined\r\n                style={{ marginLeft: 4, color: '#ff4d4f' }}\r\n              />\r\n            )}\r\n          </span>\r\n        );\r\n      },\r\n    },\r\n    { title: 'Price', dataIndex: 'sell_price', key: 'sell_price' },\r\n    {\r\n      title: 'Expiry Date',\r\n      dataIndex: 'expiry_date',\r\n      key: 'expiry_date',\r\n      render: (expiry_date: string, record: Stock) => {\r\n        if (!expiry_date)\r\n          return <span style={{ color: '#999' }}>No Expiry</span>;\r\n\r\n        const expiryDate = dayjs(expiry_date);\r\n        const today = dayjs();\r\n        const isExpired = expiryDate.isBefore(today);\r\n        const daysUntilExpiry = expiryDate.diff(today, 'days');\r\n\r\n        let color = 'green';\r\n        let icon = <CheckCircleOutlined />;\r\n        let status = 'Valid';\r\n\r\n        if (isExpired) {\r\n          color = 'red';\r\n          icon = <ExclamationCircleOutlined />;\r\n          status = 'Expired';\r\n        } else if (daysUntilExpiry <= 30) {\r\n          color = 'orange';\r\n          icon = <ExclamationCircleOutlined />;\r\n          status = `Expires in ${daysUntilExpiry} days`;\r\n        }\r\n\r\n        return (\r\n          <Tooltip title={status}>\r\n            <Tag color={color} icon={icon}>\r\n              {expiryDate.format('DD/MM/YYYY')}\r\n            </Tag>\r\n          </Tooltip>\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  const handleSelectRow = (stock: Stock) => {\r\n    // Check if stock is expired and show error message\r\n    if (isStockExpired(stock)) {\r\n      showExpiredStockError(stock);\r\n      return;\r\n    }\r\n\r\n    // Check if stock is out of stock and show error message\r\n    if (isStockOutOfStock(stock)) {\r\n      showOutOfStockError(stock);\r\n      return;\r\n    }\r\n\r\n    // Clear any existing error message\r\n    setErrorMessage('');\r\n\r\n    onSelect({\r\n      id: stock._id,\r\n      _id: stock._id,\r\n      batch_no: stock.batch_no,\r\n      name: stock.ProductItem?.name || stock.name || '',\r\n      code: stock.code,\r\n      available_quantity: stock.available_quantity,\r\n      available_loose_quantity: stock.available_loose_quantity,\r\n      sell_price: stock.sell_price,\r\n      ProductItem: stock.ProductItem, // Include ProductItem for pack_size\r\n    });\r\n  };\r\n\r\n  const handleSearchKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!allStocks.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        let next = prev + 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          next < allStocks.length &&\r\n          ((allStocks[next].expiry_date &&\r\n            dayjs(allStocks[next].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[next].available_quantity <= 0)\r\n        ) {\r\n          next++;\r\n        }\r\n        const finalNext = Math.min(next, allStocks.length - 1);\r\n        setSelectedRowKey(allStocks[finalNext]._id);\r\n        return finalNext;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        let prevIndex = prev - 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          prevIndex >= 0 &&\r\n          ((allStocks[prevIndex].expiry_date &&\r\n            dayjs(allStocks[prevIndex].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[prevIndex].available_quantity <= 0)\r\n        ) {\r\n          prevIndex--;\r\n        }\r\n        const finalPrev = Math.max(prevIndex, 0);\r\n        setSelectedRowKey(allStocks[finalPrev]._id);\r\n        return finalPrev;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedStock = allStocks[highlightedIndex];\r\n      if (selectedStock) {\r\n        handleSelectRow(selectedStock);\r\n        // Only close modal if selection was successful (not expired and not out of stock)\r\n        if (\r\n          !isStockExpired(selectedStock) &&\r\n          !isStockOutOfStock(selectedStock)\r\n        ) {\r\n          onCancel(); // Close the modal after selection\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleTableKeyDown = (e: KeyboardEvent<HTMLDivElement>) => {\r\n    if (!allStocks.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(i => {\r\n        let next = i + 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          next < allStocks.length &&\r\n          ((allStocks[next].expiry_date &&\r\n            dayjs(allStocks[next].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[next].available_quantity <= 0)\r\n        ) {\r\n          next++;\r\n        }\r\n        const finalNext = Math.min(next, allStocks.length - 1);\r\n        setSelectedRowKey(allStocks[finalNext]._id);\r\n        return finalNext;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(i => {\r\n        let prev = i - 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          prev >= 0 &&\r\n          ((allStocks[prev].expiry_date &&\r\n            dayjs(allStocks[prev].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[prev].available_quantity <= 0)\r\n        ) {\r\n          prev--;\r\n        }\r\n        const finalPrev = Math.max(prev, 0);\r\n        setSelectedRowKey(allStocks[finalPrev]._id);\r\n        return finalPrev;\r\n      });\r\n      // Keep focus on search input\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedStock = allStocks[highlightedIndex];\r\n      if (selectedStock) {\r\n        handleSelectRow(selectedStock);\r\n        // Only close modal if selection was successful (not expired and not out of stock)\r\n        if (\r\n          !isStockExpired(selectedStock) &&\r\n          !isStockOutOfStock(selectedStock)\r\n        ) {\r\n          onCancel(); // Close the modal after selection\r\n        }\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Tab' && e.shiftKey) {\r\n      e.preventDefault();\r\n      searchInputRef.current?.focus();\r\n    }\r\n  };\r\n\r\n  // Auto-focus back to search input when clicking outside\r\n  const handleModalClick = () => {\r\n    searchInputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select Stock (F7 to reopen anytime)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      width={800}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div onClick={handleModalClick}>\r\n        <Search\r\n          ref={searchInputRef}\r\n          placeholder=\"Search stocks (use  arrows to navigate, Enter to select)\"\r\n          onChange={e => setSearchTerm(e.target.value)}\r\n          style={{ marginBottom: 16 }}\r\n          autoFocus\r\n          onKeyDown={handleSearchKeyDown}\r\n          onBlur={() => {\r\n            // Re-focus after a short delay to ensure it stays focused\r\n            setTimeout(() => {\r\n              if (visible) {\r\n                searchInputRef.current?.focus();\r\n              }\r\n            }, 10);\r\n          }}\r\n        />\r\n\r\n        {/* Error Message Display */}\r\n        {errorMessage && (\r\n          <div\r\n            style={{\r\n              marginBottom: 16,\r\n              padding: '12px 16px',\r\n              backgroundColor: '#fff2f0',\r\n              border: '1px solid #ffccc7',\r\n              borderRadius: '6px',\r\n              color: '#cf1322',\r\n              fontSize: '14px',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '8px',\r\n            }}\r\n          >\r\n            <ExclamationCircleOutlined style={{ color: '#cf1322' }} />\r\n            {errorMessage}\r\n          </div>\r\n        )}\r\n\r\n        <div\r\n          onKeyDown={handleTableKeyDown}\r\n          tabIndex={0}\r\n          ref={tableBodyRef}\r\n          style={{ outline: 'none' }}\r\n        >\r\n          <Table\r\n            dataSource={allStocks}\r\n            columns={columns}\r\n            loading={loading}\r\n            rowKey=\"_id\"\r\n            size=\"small\"\r\n            pagination={false}\r\n            title={() => (\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  justifyContent: 'space-between',\r\n                  alignItems: 'center',\r\n                  padding: '8px 0',\r\n                }}\r\n              >\r\n                <span>Stock Items</span>\r\n                <div style={{ fontSize: '12px', color: '#666' }}>\r\n                  <span style={{ color: '#52c41a' }}> Valid</span>\r\n                  <span style={{ margin: '0 8px', color: '#faad14' }}>\r\n                     Near Expiry\r\n                  </span>\r\n                  <span style={{ color: '#ff4d4f' }}>\r\n                     Expired/Out of Stock (Disabled)\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            )}\r\n            onRow={(record, idx) => {\r\n              const isExpired = isStockExpired(record);\r\n              const isOutOfStock = isStockOutOfStock(record);\r\n              return {\r\n                onClick: () => {\r\n                  if (!isExpired && !isOutOfStock) {\r\n                    handleSelectRow(record);\r\n                    // Keep focus on search input after selection\r\n                    setTimeout(() => {\r\n                      searchInputRef.current?.focus();\r\n                    }, 10);\r\n                  } else if (isExpired) {\r\n                    showExpiredStockError(record);\r\n                  } else if (isOutOfStock) {\r\n                    showOutOfStockError(record);\r\n                  }\r\n                },\r\n                onDoubleClick: () => {\r\n                  if (!isExpired && !isOutOfStock) {\r\n                    handleSelectRow(record);\r\n                  } else if (isExpired) {\r\n                    showExpiredStockError(record);\r\n                  } else if (isOutOfStock) {\r\n                    showOutOfStockError(record);\r\n                  }\r\n                },\r\n                className:\r\n                  idx === highlightedIndex\r\n                    ? 'ant-table-row ant-table-row-selected'\r\n                    : 'ant-table-row',\r\n                'data-row-key': record._id,\r\n                style: {\r\n                  opacity: isExpired || isOutOfStock ? 0.6 : 1,\r\n                  cursor: isExpired || isOutOfStock ? 'not-allowed' : 'pointer',\r\n                  backgroundColor:\r\n                    isExpired || isOutOfStock ? '#f5f5f5' : undefined,\r\n                },\r\n              };\r\n            }}\r\n            rowSelection={{\r\n              type: 'radio',\r\n              selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n              onChange: (keys: React.Key[]) => {\r\n                setSelectedRowKey(keys[0]);\r\n                const idx = allStocks.findIndex(s => s._id === keys[0]);\r\n                if (idx !== -1) setHighlightedIndex(idx);\r\n              },\r\n              getCheckboxProps: (record: Stock) => ({\r\n                disabled: isStockExpired(record) || isStockOutOfStock(record),\r\n              }),\r\n            }}\r\n          />\r\n          <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n            <strong>Keyboard Shortcuts:</strong>  Navigate stocks | Enter\r\n            Select | Escape Cancel\r\n            <br />\r\n            <strong>Tip:</strong> Press F7 anytime to reopen this modal for\r\n            stock changes\r\n            <br />\r\n            <strong>Note:</strong> Expired items () and out of stock items\r\n            () are shown but cannot be selected. Navigation automatically\r\n            skips expired and out of stock items.\r\n            <br />\r\n            <strong>Error Handling:</strong> Attempting to select expired or out\r\n            of stock items will show an error message and prevent selection.\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default StockSelectionModal;\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Table,\r\n  Input,\r\n  InputNumber,\r\n  Select,\r\n  DatePicker,\r\n  Button,\r\n  Space,\r\n  Modal,\r\n  Typography,\r\n  message,\r\n  TableProps,\r\n} from 'antd';\r\nimport type { SizeType } from 'antd/es/config-provider/SizeContext';\r\nimport { PlusOutlined, DeleteOutlined, SaveOutlined } from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport './AntdEditableTable.css';\r\nimport ProductSelectionModal from '../../pages/RetaillBill/components/ProductSelectionModal';\r\nimport StockSelectionModal from '../../pages/RetaillBill/components/StockSelectionModal';\r\n\r\nconst { Text } = Typography;\r\n\r\nexport interface AntdEditableColumn {\r\n  title: string;\r\n  dataIndex: string;\r\n  key?: string;\r\n  defaultValue?: any;\r\n  type?: 'text' | 'number' | 'select' | 'date' | 'product' | 'stock';\r\n  options?: { label: string; value: any }[];\r\n  required?: boolean;\r\n  width?: number;\r\n  editable?: boolean;\r\n  validation?: (value: any) => string | undefined;\r\n  render?: (value: any, record?: any, rowIndex?: number) => React.ReactNode;\r\n}\r\n\r\nexport interface AntdEditableTableProps {\r\n  columns: AntdEditableColumn[];\r\n  dataSource: any[];\r\n  onSave: (data: any[]) => void;\r\n  onAdd?: () => void;\r\n  onDelete?: (indices: number[]) => void;\r\n  onProductSelect?: (product: any, rowIndex: number) => void;\r\n  allowAdd?: boolean;\r\n  allowDelete?: boolean;\r\n  rowKey?: string;\r\n  loading?: boolean;\r\n  compact?: boolean;\r\n  enableKeyboardNav?: boolean;\r\n  size?: SizeType;\r\n  className?: string;\r\n  externalEditingCell?: { row: number; col: number } | null;\r\n}\r\n\r\nconst AntdEditableTable: React.FC<AntdEditableTableProps> = ({\r\n  columns,\r\n  dataSource,\r\n  onSave,\r\n  onAdd,\r\n  onDelete,\r\n  allowAdd = true,\r\n  allowDelete = true,\r\n  rowKey = 'key',\r\n  loading = false,\r\n  compact = false,\r\n  enableKeyboardNav = true,\r\n  size = 'middle',\r\n  className,\r\n  onProductSelect,\r\n  externalEditingCell,\r\n}) => {\r\n  const [data, setData] = useState<any[]>([]);\r\n  const [selectedRows, setSelectedRows] = useState<any[]>([]);\r\n  const [editingCell, setEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n  const firstLoadRef = useRef(true);\r\n\r\n  useEffect(() => {\r\n    setData(dataSource);\r\n\r\n    const firstProductColIndex = columns.findIndex(\r\n      col => col.dataIndex === 'product_id'\r\n    );\r\n\r\n    //  Auto-focus only if table is empty on first load\r\n    if (\r\n      firstLoadRef.current &&\r\n      dataSource.length === 0 &&\r\n      firstProductColIndex >= 0\r\n    ) {\r\n      setEditingCell({ row: 0, col: firstProductColIndex });\r\n      firstLoadRef.current = false; // Prevent repeat auto-focus\r\n    }else{\r\n      setSelectedRows(dataSource.length>0?[String(dataSource.length-1)]:[])\r\n    }\r\n  }, [dataSource, columns]);\r\n\r\n  // Sync editingCell with externalEditingCell prop\r\n  useEffect(() => {\r\n    if (externalEditingCell) {\r\n      setEditingCell(externalEditingCell);\r\n    }\r\n  }, [externalEditingCell]);\r\n\r\n  const handleAddRow = () => {\r\n    onAdd?.();\r\n    // Set focus to the first editable cell of the new row (after parent updates data)\r\n    const firstEditableCol = columns.findIndex(col => col.editable !== false);\r\n    if (firstEditableCol >= 0) {\r\n      setEditingCell({ row: data.length, col: firstEditableCol });\r\n    }\r\n  };\r\n\r\n  const handleDeleteRow = () => {\r\n    if (data.length === 0) {\r\n      message.warning('No rows to delete');\r\n      return;\r\n    }\r\n    Modal.confirm({\r\n      title: 'Are you sure you want to delete the selected Bill Items?',\r\n      onOk: () => {\r\n        const newData = data.slice(0, -1);\r\n        setData(newData);\r\n        onSave(newData);\r\n        onDelete?.(selectedRows);\r\n      },\r\n    });\r\n  };\r\n\r\n  const saveCell = (row: number, col: number, value: any): boolean => {\r\n    const column = columns[col];\r\n\r\n    // Basic validation\r\n    if (column.required && (!value || value === '')) {\r\n      message.error(`${column.title} is required`);\r\n      return false;\r\n    }\r\n\r\n    // Custom validation\r\n    if (column.validation) {\r\n      const error = column.validation(value);\r\n      if (error) {\r\n        message.error(error);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const newData = [...data];\r\n    newData[row][columns[col].dataIndex] = value;\r\n    setData(newData);\r\n    onSave(newData);\r\n    return true;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.ctrlKey && e.key === 's') {\r\n        e.preventDefault();\r\n        onSave(data);\r\n      }\r\n      if (e.shiftKey && e.key.toLowerCase() === 'a' && allowAdd) {\r\n        e.preventDefault();\r\n        handleAddRow();\r\n      }\r\n    };\r\n    if (enableKeyboardNav) {\r\n      document.addEventListener('keydown', handleKeyDown);\r\n      return () => document.removeEventListener('keydown', handleKeyDown);\r\n    }\r\n  }, [data, allowAdd, onSave, enableKeyboardNav, handleAddRow]);\r\n\r\n  const rowSelection: TableProps<any>['rowSelection'] = {\r\n    onChange: (selectedRowKeys: React.Key[], selectedRows:any[]) => {\r\n      setSelectedRows([...selectedRowKeys]);\r\n    },\r\n  };\r\n  \r\n  // Helper to find the next editable column index\r\n  function getNextEditableCol(startCol: number, direction: 1 | -1, columns: AntdEditableColumn[]): number {\r\n    let col = startCol + direction;\r\n    while (col >= 0 && col < columns.length) {\r\n      if (columns[col].editable !== false) return col;\r\n      col += direction;\r\n    }\r\n    return -1; // No editable column found\r\n  }\r\n\r\n  const EditableCell = ({\r\n    row,\r\n    col,\r\n    value,\r\n  }: {\r\n    row: number;\r\n    col: number;\r\n    value: any;\r\n  }) => {\r\n    const [cellValue, setCellValue] = useState(value);\r\n    const inputRef = useRef<any>(null);\r\n    const column = columns[col];\r\n    const [isProductModalVisible, setIsProductModalVisible] = useState(false);\r\n    const [isStockModalVisible, setIsStockModalVisible] = useState(false);\r\n\r\n    useEffect(() => {\r\n      setCellValue(value);\r\n      //  Focus input/select when cell enters edit mode\r\n      setTimeout(() => {\r\n        inputRef.current?.focus();\r\n      }, 50);\r\n    }, [value]);\r\n\r\n    const handleChange = (val: any) => {\r\n      setCellValue(val);\r\n      saveCell(row, col, val);\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n      if (column.type === 'product' && e.key === 'Enter') {\r\n        e.stopPropagation();\r\n        setIsProductModalVisible(true);\r\n        return; // Do not validate or move cell yet!\r\n      }\r\n      if (column.type === 'stock' && e.key === 'Enter') {\r\n        e.stopPropagation();\r\n        setIsStockModalVisible(true);\r\n        return;\r\n      }\r\n      if (e.key === 'Tab') {\r\n        e.preventDefault();\r\n        // Only validate on Tab\r\n        if (column.required && (!cellValue || cellValue === '')) {\r\n          message.error(`${column.title} is required`);\r\n          return;\r\n        }\r\n        const nextCol = e.shiftKey ? col - 1 : col + 1;\r\n        const nextRow = row + (nextCol >= columns.length ? 1 : 0);\r\n        const colIndex = (nextCol + columns.length) % columns.length;\r\n        if (nextRow < data.length) {\r\n          setEditingCell({ row: nextRow, col: colIndex });\r\n        } else if (allowAdd) {\r\n          handleAddRow();\r\n          setEditingCell({ row: data.length, col: colIndex });\r\n        }\r\n      } else if (e.key === 'Escape') {\r\n        setEditingCell(null);\r\n      }\r\n    };\r\n\r\n    const handleProductSelect = (product: any) => {\r\n      if (onProductSelect) {\r\n        onProductSelect(product, row);\r\n      }\r\n      setIsProductModalVisible(false);\r\n      setEditingCell(null);\r\n    };\r\n\r\n    const handleStockSelect = (stock: any) => {\r\n      // Set stock_id and batch_no in the row\r\n      const newData = [...data];\r\n      newData[row].stock_id = stock.id || stock._id || '';\r\n      newData[row].batch_no = stock.batch_no || '';\r\n      setData(newData);\r\n      onSave(newData);\r\n      setIsStockModalVisible(false);\r\n      setEditingCell(null);\r\n    };\r\n\r\n    switch (column.type) {\r\n      case 'product':\r\n        // Display product name instead of product_id when cell is focused\r\n        const productName = data[row]?.product_name\r\n          ? `${data[row].product_name}${data[row]?.variant_name ? ` ${data[row].variant_name}` : ''}`.trim()\r\n          : cellValue; // Fallback to product_id if name not available\r\n        return (\r\n          <>\r\n            <div onClick={e => e.stopPropagation()}>\r\n              <Input\r\n                ref={inputRef}\r\n                value={productName}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder=\"Press Enter to select product\"\r\n                readOnly\r\n                style={{ cursor: 'pointer' }}\r\n              />\r\n            </div>\r\n            {isProductModalVisible && (\r\n              <ProductSelectionModal\r\n                visible={isProductModalVisible}\r\n                onSelect={handleProductSelect}\r\n                onCancel={() => setIsProductModalVisible(false)}\r\n              />\r\n            )}\r\n          </>\r\n        );\r\n      case 'stock':\r\n        return (\r\n          <>\r\n            <div onClick={e => e.stopPropagation()}>\r\n              <Input\r\n                ref={inputRef}\r\n                value={data[row]?.batch_no || cellValue}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder=\"Press Enter to select stock\"\r\n                readOnly\r\n              />\r\n            </div>\r\n            {isStockModalVisible && (\r\n              <StockSelectionModal\r\n                visible={isStockModalVisible}\r\n                onSelect={handleStockSelect}\r\n                onCancel={() => setIsStockModalVisible(false)}\r\n                productId={data[row]?.product_id || ''}\r\n              />\r\n            )}\r\n          </>\r\n        );\r\n      case 'number':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <InputNumber\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              onChange={handleChange}\r\n              onBlur={() => setEditingCell(null)}\r\n              controls={false}\r\n              onKeyDown={e => {\r\n                // Allow Enter/Tab to move to next editable cell\r\n                if (e.key === 'Tab' || e.key === 'Enter') {\r\n                  e.preventDefault();\r\n                  // Only validate on Tab or Enter\r\n                  if (column.required && (!cellValue || cellValue === '')) {\r\n                    message.error(`${column.title} is required`);\r\n                    return;\r\n                  }\r\n                  const direction = e.shiftKey ? -1 : 1;\r\n                  const nextCol = getNextEditableCol(col, direction, columns);\r\n                  if (nextCol !== -1) {\r\n                    setEditingCell({ row, col: nextCol });\r\n                  } else {\r\n                    // Move to next/previous row's first editable cell\r\n                    const nextRow = direction > 0 ? row + 1 : row - 1;\r\n                    if (nextRow >= 0 && nextRow < data.length) {\r\n                      const firstEditableCol = getNextEditableCol(-1, 1, columns);\r\n                      if (firstEditableCol !== -1) {\r\n                        setEditingCell({ row: nextRow, col: firstEditableCol });\r\n                      }\r\n                    } else if (direction > 0 && allowAdd) {\r\n                      // Add new row if moving forward and at the end\r\n                      handleAddRow();\r\n                      const firstEditableCol = getNextEditableCol(-1, 1, columns);\r\n                      if (firstEditableCol !== -1) {\r\n                        setEditingCell({ row: data.length, col: firstEditableCol });\r\n                      }\r\n                    } else {\r\n                      // Exit edit mode if no more rows\r\n                      setEditingCell(null);\r\n                    }\r\n                  }\r\n                } else if (e.key === 'Escape') {\r\n                  setEditingCell(null);\r\n                }\r\n              }}\r\n              style={{ width: '100%' }}\r\n            />\r\n          </div>\r\n        );\r\n      case 'select':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <Select\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              options={column.options}\r\n              onChange={val => {\r\n                const success = saveCell(row, col, val);\r\n                if (success) {\r\n                  // Move to next editable cell\r\n                  const nextCol = col + 1;\r\n                  const nextRow = row + (nextCol >= columns.length ? 1 : 0);\r\n                  const colIndex = (nextCol + columns.length) % columns.length;\r\n\r\n                  if (nextRow < data.length) {\r\n                    setEditingCell({ row: nextRow, col: colIndex });\r\n                  } else if (allowAdd) {\r\n                    handleAddRow();\r\n                    setEditingCell({ row: data.length, col: colIndex });\r\n                  }\r\n                }else {\r\n                  // Validation failed; keep focus\r\n                  setTimeout(() => {\r\n                    inputRef.current?.focus();\r\n                  }, 50);\r\n                }\r\n              }}\r\n              style={{ width: '100%' }}\r\n              onKeyDown={e => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  e.preventDefault(); // Block default key behavior\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n        );\r\n\r\n      case 'date':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <DatePicker\r\n              ref={inputRef}\r\n              value={cellValue ? dayjs(cellValue) : null}\r\n              onChange={date => {\r\n                handleChange(date ? date.format('YYYY-MM-DD') : null);\r\n                setEditingCell(null);\r\n              }}\r\n              onBlur={() => setEditingCell(null)}\r\n              onKeyDown={handleKeyDown}\r\n              style={{ width: '100%' }}\r\n            />\r\n          </div>\r\n        );\r\n      default:\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <Input\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              onChange={e => handleChange(e.target.value)}\r\n              onBlur={() => setEditingCell(null)}\r\n              onKeyDown={handleKeyDown}\r\n            />\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  const mergedColumns = columns.map((col, colIndex) => ({\r\n    ...col,\r\n    onCell: (_record: any, rowIndex?: number) => ({\r\n      onClick: () => {\r\n        if (typeof rowIndex === 'number') {\r\n          setEditingCell({ row: rowIndex, col: colIndex });\r\n        }\r\n      },\r\n      onContextMenu: (e: React.MouseEvent) => {\r\n        e.preventDefault(); //  Prevent default context menu\r\n        if (typeof rowIndex === 'number') {\r\n          setEditingCell({ row: rowIndex, col: colIndex });\r\n        }\r\n      },\r\n    }),\r\n    render: (val: any, record: any, rowIndex: number) => {\r\n      if (\r\n        editingCell &&\r\n        editingCell.row === rowIndex &&\r\n        editingCell.col === colIndex\r\n      ) {\r\n        return (\r\n          <EditableCell\r\n            key={`${rowIndex}-${colIndex}`}\r\n            row={rowIndex}\r\n            col={colIndex}\r\n            value={record[col.dataIndex]}\r\n          />\r\n        );\r\n      }\r\n      // Use custom render if provided and not editing\r\n      if (typeof col.render === 'function') {\r\n        return col.render(val, record, rowIndex);\r\n      }\r\n      // Show batch_no for stock_id column when not editing\r\n      if (col.dataIndex === 'batch_no') {\r\n        return record.batch_no || record[col.dataIndex];\r\n      }\r\n      // Show product_name for product_id column when not editing\r\n      if (col.dataIndex === 'product_id') {\r\n        return record.product_name || record[col.dataIndex];\r\n      }\r\n      if (col.type === 'select' && col.options) {\r\n        const option = col.options.find(\r\n          opt => opt.value === record[col.dataIndex]\r\n        );\r\n        return option ? option.label : record[col.dataIndex];\r\n      }\r\n      return record[col.dataIndex];\r\n    },\r\n  }));\r\n\r\n  return (\r\n    <div\r\n      className={`antd-editable-table ${compact ? 'compact' : ''} ${\r\n        className || ''\r\n      }`}\r\n    >\r\n      <div className=\"table-toolbar\">\r\n        <Space>\r\n          {allowAdd && (\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<PlusOutlined />}\r\n              onClick={handleAddRow}\r\n            >\r\n              Add Row (Shift+A)\r\n            </Button>\r\n          )}\r\n          {allowDelete && (\r\n            <Button danger icon={<DeleteOutlined />} onClick={handleDeleteRow}>\r\n              Delete Row\r\n            </Button>\r\n          )}\r\n          <Button\r\n            type=\"primary\"\r\n            icon={<SaveOutlined />}\r\n            onClick={() => onSave(data)}\r\n          >\r\n            Save (Ctrl+S)\r\n          </Button>\r\n        </Space>\r\n        <Text type=\"secondary\" className=\"table-info\">\r\n          Use Tab / Shift+Tab to navigate cells\r\n        </Text>\r\n      </div>\r\n      <Table\r\n        bordered\r\n        dataSource={data}\r\n        columns={mergedColumns}\r\n        rowKey={rowKey}\r\n        loading={loading}\r\n        pagination={false}\r\n        size={size}\r\n        scroll={{ y: 400 }}\r\n        rowSelection={{...rowSelection,type:\"checkbox\",selectedRowKeys:selectedRows}}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AntdEditableTable;\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Button,\r\n  Typography,\r\n  message,\r\n  Form,\r\n  Select,\r\n  Space,\r\n  Divider,\r\n  Tag,\r\n  Table,\r\n  Row,\r\n  Col,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  UserAddOutlined,\r\n  UserOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n  HomeOutlined,\r\n  PlusOutlined,\r\n  SaveOutlined,\r\n  CloseOutlined,\r\n} from '@ant-design/icons';\r\nimport { useHandleApiResponse } from '../../../components/common/useHandleApiResponse';\r\nimport { useGenericCrudRTK } from '../../../hooks/useGenericCrudRTK';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Option } = Select;\r\n\r\ninterface Customer {\r\n  _id: string;\r\n  full_name: string;\r\n  email: string;\r\n  mobile: string;\r\n  address: string;\r\n  customer_type: 'regular' | 'vip' | 'wholesale';\r\n}\r\n\r\ninterface NewCustomerData {\r\n  full_name: string;\r\n  email: string;\r\n  mobile: string;\r\n  address: string;\r\n  customer_type: 'regular' | 'vip' | 'wholesale';\r\n}\r\n\r\ninterface CustomerSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (customer: Customer) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst CustomerSelectionModalComponent: React.FC<CustomerSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [debouncedSearchTerm, setDebouncedSearchTerm] = useState('');\r\n  const [showAddForm, setShowAddForm] = useState(false);\r\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(\r\n    null\r\n  );\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n  const [showCreateGrid, setShowCreateGrid] = useState(false);\r\n  const [newCustomerData, setNewCustomerData] = useState<NewCustomerData>({\r\n    full_name: '',\r\n    email: '',\r\n    mobile: '',\r\n    address: '',\r\n    customer_type: 'regular',\r\n  });\r\n\r\n  const [form] = Form.useForm();\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const createGridRef = useRef<HTMLDivElement>(null);\r\n  const firstFormInputRef = useRef<any>(null);\r\n\r\n  // RTK Query hooks for Customer - use debouncedSearchTerm for API calls\r\n  // Only fetch when modal is visible to prevent duplicate API calls\r\n  const { data: customerData, isLoading: customerLoading, refetch: refetchCustomerList } = \r\n    apiSlice.useGetCustomerQuery(\r\n      { searchString: debouncedSearchTerm },\r\n      { skip: !visible } // Only fetch when modal is open\r\n    );\r\n  \r\n  const customerRTK = useGenericCrudRTK('Customer');\r\n  const { create: createCustomer, ...createResult } = customerRTK.useCreate();\r\n  const createLoading = createResult.isLoading;\r\n\r\n  // Extract items from customerData\r\n  const customers = useMemo(() => {\r\n    if (!customerData) return [];\r\n    return (customerData as any)?.result || [];\r\n  }, [customerData]);\r\n\r\n  // Memoized filtered customers - filter locally for instant UI feedback\r\n  const filteredCustomers = useMemo(() => {\r\n    if (!searchTerm.trim()) return customers;\r\n    const term = searchTerm.toLowerCase();\r\n    return customers.filter((customer: Customer) =>\r\n      customer.full_name?.toLowerCase().includes(term) ||\r\n      customer.mobile?.includes(term) ||\r\n      customer.email?.toLowerCase().includes(term)\r\n    );\r\n  }, [customers, searchTerm]);\r\n\r\n  // Check if search has no results and should show create grid\r\n  const shouldShowCreateGrid = useMemo(() => {\r\n    return (\r\n      searchTerm.trim() && !customerLoading && filteredCustomers.length === 0\r\n    );\r\n  }, [searchTerm, customerLoading, filteredCustomers.length]);\r\n\r\n  // Memoized customer type color function\r\n  const getCustomerTypeColor = useCallback((type: string) => {\r\n    const colorMap: Record<string, string> = {\r\n      vip: 'gold',\r\n      wholesale: 'blue',\r\n      regular: 'green',\r\n    };\r\n    return colorMap[type] || 'green';\r\n  }, []);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToCustomer = useCallback(\r\n    (direction: 'up' | 'down' | 'home' | 'end') => {\r\n      if (filteredCustomers.length === 0) return;\r\n\r\n      let newIndex: number;\r\n      switch (direction) {\r\n        case 'up':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? filteredCustomers.length - 1\r\n              : Math.max(selectedRowIndex - 1, 0);\r\n          break;\r\n        case 'down':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? 0\r\n              : Math.min(selectedRowIndex + 1, filteredCustomers.length - 1);\r\n          break;\r\n        case 'home':\r\n          newIndex = 0;\r\n          break;\r\n        case 'end':\r\n          newIndex = filteredCustomers.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedCustomer(filteredCustomers[newIndex]);\r\n\r\n      // Scroll to the selected row\r\n      setTimeout(() => {\r\n        const rowElement = document.querySelector(\r\n          `[data-row-key=\"${filteredCustomers[newIndex]._id}\"]`\r\n        ) as HTMLElement;\r\n        if (rowElement) {\r\n          const scrollBehavior =\r\n            direction === 'home'\r\n              ? 'start'\r\n              : direction === 'end'\r\n                ? 'end'\r\n                : 'nearest';\r\n          rowElement.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: scrollBehavior,\r\n          });\r\n        }\r\n      }, 100);\r\n    },\r\n    [filteredCustomers, selectedRowIndex]\r\n  );\r\n\r\n  // Debounced search function\r\n  const handleSearch = useCallback(\r\n    (value: string) => {\r\n      setSearchTerm(value);\r\n\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n\r\n      searchTimeoutRef.current = setTimeout(() => {\r\n        setDebouncedSearchTerm(value.trim());\r\n      }, 500);\r\n    },\r\n    []\r\n  );\r\n\r\n  // Handle customer selection\r\n  const handleCustomerSelect = useCallback(\r\n    (customer: Customer) => {\r\n      setSelectedCustomer(customer);\r\n      onSelect(customer);\r\n      setTimeout(() => onCancel(), 100);\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Function to clear form data\r\n  const clearFormData = useCallback(() => {\r\n    setNewCustomerData({\r\n      full_name: '',\r\n      email: '',\r\n      mobile: '',\r\n      address: '',\r\n      customer_type: 'regular',\r\n    });\r\n    form.resetFields();\r\n  }, [form]);\r\n\r\n  // Handle new customer creation from unified form\r\n  const handleCreateCustomerFromForm = useCallback(async () => {\r\n    try {\r\n      // Validate required fields - only Full Name and Mobile are mandatory\r\n      if (!newCustomerData.full_name.trim()) {\r\n        message.error('Full name is required');\r\n        return;\r\n      }\r\n      if (!newCustomerData.mobile.trim()) {\r\n        message.error('Mobile number is required');\r\n        return;\r\n      }\r\n\r\n      // Call RTK mutation - the response will be handled by useHandleApiResponse\r\n      const result = await createCustomer(newCustomerData);\r\n      if (!result.error && result.data) {\r\n        // Customer created successfully, get the new customer data\r\n        const newCustomer = result.data?.data || result.data?.result || result.data;\r\n        if (newCustomer) {\r\n          // Clear form and hide form UI\r\n          clearFormData();\r\n          setShowAddForm(false);\r\n          setShowCreateGrid(false);\r\n          \r\n          // Refresh customer list\r\n          refetchCustomerList();\r\n          \r\n          // Select the newly created customer\r\n          setTimeout(() => {\r\n            handleCustomerSelect(newCustomer);\r\n          }, 100);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      message.error('Failed to create customer');\r\n      // Clear form data on error\r\n      clearFormData();\r\n    }\r\n  }, [newCustomerData, createCustomer, handleCustomerSelect, clearFormData, refetchCustomerList]);\r\n\r\n  // Handle form field changes\r\n  const handleFormFieldChange = useCallback(\r\n    (field: keyof NewCustomerData, value: string) => {\r\n      setNewCustomerData(prev => ({\r\n        ...prev,\r\n        [field]: value,\r\n      }));\r\n    },\r\n    []\r\n  );\r\n\r\n  // Remove the navigateToNextField function as it's no longer needed\r\n\r\n  // Handle keyboard events (excluding Enter key which is handled by input field)\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onCancel();\r\n      } else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToCustomer(directionMap[e.key]);\r\n      }\r\n    },\r\n    [navigateToCustomer, onCancel]\r\n  );\r\n\r\n  // Global keyboard event handler\r\n  const handleGlobalKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (!visible) return;\r\n\r\n      // Don't interfere if user is typing in form inputs\r\n      const target = e.target as HTMLElement;\r\n      if (\r\n        target.tagName === 'INPUT' ||\r\n        target.tagName === 'TEXTAREA' ||\r\n        target.classList.contains('ant-select-selector') ||\r\n        target.closest('.ant-select-dropdown')\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === 'f') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Handle Ctrl+N for new customer creation\r\n      if (e.ctrlKey && e.key === 'n') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (shouldShowCreateGrid) {\r\n          setShowCreateGrid(true);\r\n          setTimeout(() => {\r\n            if (createGridRef.current) {\r\n              const firstInput = createGridRef.current.querySelector(\r\n                'input'\r\n              ) as HTMLInputElement;\r\n              if (firstInput) {\r\n                firstInput.focus();\r\n                firstInput.select();\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Only handle navigation keys globally when not in form inputs\r\n      if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToCustomer(directionMap[e.key]);\r\n      }\r\n    },\r\n    [visible, navigateToCustomer, shouldShowCreateGrid]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: Customer) => (\r\n          <div\r\n            style={{\r\n              cursor: 'pointer',\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n            }}\r\n            onClick={() => {\r\n              setSelectedCustomer(record);\r\n              const index = filteredCustomers.findIndex(\r\n                (c: Customer) => c._id === record._id\r\n              );\r\n              setSelectedRowIndex(index);\r\n              // Don't auto-select here, let user click the row or press Enter\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                borderRadius: '50%',\r\n                border:\r\n                  selectedCustomer?._id === record._id\r\n                    ? '2px solid #1890ff'\r\n                    : '2px solid #d9d9d9',\r\n                backgroundColor:\r\n                  selectedCustomer?._id === record._id ? '#1890ff' : 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedCustomer?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Customer Name',\r\n        dataIndex: 'full_name',\r\n        key: 'full_name',\r\n        render: (text: string, record: Customer) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <Text strong>{text}</Text>\r\n            <Tag color={getCustomerTypeColor(record.customer_type)}>\r\n              {record.customer_type.toUpperCase()}\r\n            </Tag>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Mobile',\r\n        dataIndex: 'mobile',\r\n        key: 'mobile',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Address',\r\n        dataIndex: 'address',\r\n        key: 'address',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'flex-start', gap: 8 }}>\r\n            <HomeOutlined style={{ color: '#666', marginTop: '2px' }} />\r\n            <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n              {text || '-'}\r\n            </Text>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedCustomer, filteredCustomers, getCustomerTypeColor]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: Customer, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedCustomer(record);\r\n        setSelectedRowIndex(index ?? 0);\r\n        // Don't auto-select on row click, let user press Enter to confirm\r\n      },\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedCustomer?._id === record._id ? '#f0f8ff' : 'white',\r\n        border:\r\n          selectedCustomer?._id === record._id\r\n            ? '2px solid #1890ff'\r\n            : '1px solid #f0f0f0',\r\n        borderRadius: '4px',\r\n        transition: 'all 0.2s ease',\r\n      },\r\n      onMouseEnter: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedCustomer?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = '#f5f5f5';\r\n        }\r\n      },\r\n      onMouseLeave: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedCustomer?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = 'white';\r\n        }\r\n      },\r\n    }),\r\n    [selectedCustomer]\r\n  );\r\n\r\n  // Handle modal close (RTK Query automatically loads customers)\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setSelectedCustomer(null);\r\n      setSelectedRowIndex(-1);\r\n      setShowCreateGrid(false);\r\n    } else {\r\n      setSearchTerm('');\r\n      setSelectedCustomer(null);\r\n      setSelectedRowIndex(-1);\r\n      setShowCreateGrid(false);\r\n      setShowAddForm(false);\r\n      clearFormData();\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = null;\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [visible, clearFormData]);\r\n\r\n  // Auto-show create form when search has no results\r\n  useEffect(() => {\r\n    if (shouldShowCreateGrid && !showCreateGrid && !showAddForm) {\r\n      setShowCreateGrid(true);\r\n    }\r\n  }, [shouldShowCreateGrid, showCreateGrid, showAddForm]);\r\n\r\n  // Focus search input when modal becomes visible (but not when create form is shown)\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current && !showAddForm && !showCreateGrid) {\r\n      const focusSearch = () => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n      };\r\n\r\n      focusSearch();\r\n      const timer = setTimeout(focusSearch, 100);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [visible, showAddForm, showCreateGrid]);\r\n\r\n  // Focus on first form field when create form is shown\r\n  useEffect(() => {\r\n    if ((showAddForm || showCreateGrid) && visible) {\r\n      const timer = setTimeout(() => {\r\n        if (firstFormInputRef.current) {\r\n          firstFormInputRef.current.focus();\r\n          firstFormInputRef.current.select();\r\n        }\r\n      }, 100);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [showAddForm, showCreateGrid, visible]); // Depend on all three to trigger when form is shown\r\n\r\n  // Remove the useLayoutEffect that was causing focus to reset\r\n\r\n  // Global keyboard event listener\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('keydown', handleGlobalKeyDown, true);\r\n      return () =>\r\n        document.removeEventListener('keydown', handleGlobalKeyDown, true);\r\n    }\r\n  }, [visible, handleGlobalKeyDown]);\r\n\r\n  // Handle API responses using RTK mutations\r\n  useHandleApiResponse({\r\n    action: 'create',\r\n    title: 'Customer',\r\n    mutationResult: createResult,\r\n    refetch: refetchCustomerList,\r\n  });\r\n\r\n  // Watch createLoading state to show/hide loading message\r\n  useEffect(() => {\r\n    if (createLoading) {\r\n      // Show loading message when API call starts\r\n      message.loading({\r\n        content: 'Creating customer...',\r\n        key: 'customer-creation',\r\n        duration: 0,\r\n      });\r\n    } else {\r\n      // Hide loading message when API call completes\r\n      message.destroy('customer-creation');\r\n    }\r\n  }, [createLoading]);\r\n\r\n  // Note: Customer creation success is handled in handleCreateCustomerFromForm\r\n  // The useHandleApiResponse hook handles notifications automatically\r\n  // No need for additional useEffect watching createResult\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedCustomer(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n  return (\r\n    <Modal\r\n      title=\"Select Customer\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={1000}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current && !showAddForm && !showCreateGrid) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Space.Compact style={{ width: '100%' }}>\r\n          <Input\r\n            ref={searchInputRef}\r\n            placeholder=\"Search customers... (Ctrl+N: New customer, : Navigate, Enter: Select, Esc: Close)\"\r\n            value={searchTerm}\r\n            onChange={e => handleSearch(e.target.value)}\r\n            prefix={<SearchOutlined />}\r\n            style={{ flex: 1 }}\r\n            onKeyDown={e => {\r\n              // Only handle Enter key in search input, let other keys bubble up\r\n              if (e.key === 'Enter' && selectedCustomer) {\r\n                handleCustomerSelect(selectedCustomer);\r\n              }\r\n            }}\r\n            onFocus={handleSearchFocus}\r\n            autoFocus={!showAddForm && !showCreateGrid}\r\n            onBlur={\r\n              !showAddForm && !showCreateGrid\r\n                ? () => {\r\n                    // Only auto-focus back to search if no forms are shown\r\n                    if (visible && searchInputRef.current) {\r\n                      setTimeout(() => {\r\n                        if (\r\n                          visible &&\r\n                          searchInputRef.current &&\r\n                          !showAddForm &&\r\n                          !showCreateGrid\r\n                        ) {\r\n                          searchInputRef.current.focus();\r\n                        }\r\n                      }, 10);\r\n                    }\r\n                  }\r\n                : undefined\r\n            }\r\n            suffix={\r\n              searchTerm && customerLoading ? (\r\n                <div style={{ fontSize: '12px', color: '#999' }}>\r\n                  Searching...\r\n                </div>\r\n              ) : null\r\n            }\r\n          />\r\n          <Button\r\n            type={showAddForm ? 'default' : 'primary'}\r\n            icon={<UserAddOutlined />}\r\n            onClick={() => {\r\n              const newState = !showAddForm;\r\n              setShowAddForm(newState);\r\n              if (!newState) {\r\n                // Clear form data when switching back to search mode\r\n                clearFormData();\r\n              }\r\n              // Focus will be handled by the useEffect when visible changes\r\n            }}\r\n            style={{ minWidth: 120 }}\r\n          >\r\n            {showAddForm ? 'Cancel' : 'Add New'}\r\n          </Button>\r\n        </Space.Compact>\r\n      </div>\r\n\r\n      {/* Unified Create Form - Shows when search has no results or when Add New is clicked */}\r\n      {(showCreateGrid || showAddForm) && (\r\n        <div\r\n          ref={createGridRef}\r\n          style={{\r\n            marginBottom: 20,\r\n            padding: 24,\r\n            border: '2px solid #6366f1',\r\n            borderRadius: 16,\r\n            backgroundColor:\r\n              'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\r\n            background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\r\n            boxShadow:\r\n              '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',\r\n            position: 'relative',\r\n            overflow: 'hidden',\r\n          }}\r\n          tabIndex={-1}\r\n        >\r\n          {/* Decorative background elements */}\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              top: -20,\r\n              right: -20,\r\n              width: 100,\r\n              height: 100,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n              opacity: 0.1,\r\n              zIndex: 0,\r\n            }}\r\n          />\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              bottom: -30,\r\n              left: -30,\r\n              width: 80,\r\n              height: 80,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)',\r\n              opacity: 0.1,\r\n              zIndex: 0,\r\n            }}\r\n          />\r\n\r\n          <Row\r\n            justify=\"space-between\"\r\n            align=\"middle\"\r\n            style={{ marginBottom: 24, position: 'relative', zIndex: 1 }}\r\n          >\r\n            <Col>\r\n              <Title\r\n                level={4}\r\n                style={{\r\n                  margin: 0,\r\n                  background:\r\n                    'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n                  WebkitBackgroundClip: 'text',\r\n                  WebkitTextFillColor: 'transparent',\r\n                  backgroundClip: 'text',\r\n                  fontWeight: 700,\r\n                  fontSize: '20px',\r\n                }}\r\n              >\r\n                <PlusOutlined style={{ marginRight: 8, color: '#6366f1' }} />\r\n                Create New Customer\r\n              </Title>\r\n              <Text\r\n                style={{\r\n                  fontSize: '14px',\r\n                  color: '#64748b',\r\n                  fontWeight: 500,\r\n                  display: 'block',\r\n                  marginTop: 4,\r\n                }}\r\n              >\r\n                 Fill in the details below to create a new customer\r\n              </Text>\r\n            </Col>\r\n            <Col>\r\n              <Space size=\"middle\">\r\n                <Button\r\n                  size=\"middle\"\r\n                  icon={<CloseOutlined />}\r\n                  onClick={() => {\r\n                    setShowCreateGrid(false);\r\n                    setShowAddForm(false);\r\n                    refetchCustomerList(); // Refresh customer list after cancel\r\n                    clearFormData();\r\n                  }}\r\n                  style={{\r\n                    border: '2px solid #e2e8f0',\r\n                    borderRadius: 8,\r\n                    fontWeight: 600,\r\n                    color: '#64748b',\r\n                    background: 'white',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    height: 40,\r\n                    padding: '0 20px',\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </Button>\r\n                <Button\r\n                  type=\"primary\"\r\n                  size=\"middle\"\r\n                  icon={<SaveOutlined />}\r\n                  onClick={handleCreateCustomerFromForm}\r\n                  loading={createLoading}\r\n                  style={{\r\n                    background:\r\n                      'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n                    border: 'none',\r\n                    borderRadius: 8,\r\n                    fontWeight: 600,\r\n                    height: 40,\r\n                    padding: '0 24px',\r\n                    boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)',\r\n                    transition: 'all 0.3s ease',\r\n                  }}\r\n                >\r\n                  Create & Select\r\n                </Button>\r\n              </Space>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form\r\n            form={form}\r\n            layout=\"vertical\"\r\n            size=\"middle\"\r\n            style={{ position: 'relative', zIndex: 1 }}\r\n          >\r\n            <div\r\n              style={{\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 1fr',\r\n                gap: 20,\r\n                marginBottom: 20,\r\n              }}\r\n            >\r\n              <Form.Item\r\n                name=\"full_name\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <UserOutlined style={{ color: '#6366f1' }} />\r\n                    Full Name\r\n                  </span>\r\n                }\r\n                rules={[{ required: true, message: 'Please enter full name' }]}\r\n              >\r\n                <Input\r\n                  ref={firstFormInputRef}\r\n                  name=\"full_name\"\r\n                  placeholder=\"Enter full name\"\r\n                  prefix={<UserOutlined style={{ color: '#9ca3af' }} />}\r\n                  autoFocus={showAddForm || showCreateGrid}\r\n                  value={newCustomerData.full_name}\r\n                  onChange={e =>\r\n                    handleFormFieldChange('full_name', e.target.value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"mobile\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <PhoneOutlined style={{ color: '#10b981' }} />\r\n                    Mobile Number\r\n                  </span>\r\n                }\r\n                rules={[\r\n                  { required: true, message: 'Please enter mobile number' },\r\n                  {\r\n                    pattern: /^[0-9]{10}$/,\r\n                    message: 'Mobile must be 10 digits',\r\n                  },\r\n                ]}\r\n              >\r\n                <Input\r\n                  name=\"mobile\"\r\n                  placeholder=\"Enter mobile number\"\r\n                  prefix={<PhoneOutlined style={{ color: '#9ca3af' }} />}\r\n                  value={newCustomerData.mobile}\r\n                  onChange={e =>\r\n                    handleFormFieldChange('mobile', e.target.value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"email\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <MailOutlined style={{ color: '#f59e0b' }} />\r\n                    Email\r\n                  </span>\r\n                }\r\n                rules={[{ type: 'email', message: 'Please enter valid email' }]}\r\n              >\r\n                <Input\r\n                  name=\"email\"\r\n                  placeholder=\"Enter email\"\r\n                  prefix={<MailOutlined style={{ color: '#9ca3af' }} />}\r\n                  value={newCustomerData.email}\r\n                  onChange={e => handleFormFieldChange('email', e.target.value)}\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              {/* <Form.Item\r\n                name=\"customer_type\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <Tag\r\n                      style={{\r\n                        background:\r\n                          'linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)',\r\n                        color: 'white',\r\n                        border: 'none',\r\n                        borderRadius: 6,\r\n                        padding: '2px 8px',\r\n                        fontSize: '10px',\r\n                        fontWeight: 600,\r\n                      }}\r\n                    >\r\n                      TYPE\r\n                    </Tag>\r\n                    Customer Type\r\n                  </span>\r\n                }\r\n                initialValue=\"regular\"\r\n              >\r\n                <Select\r\n                  value={newCustomerData.customer_type}\r\n                  onChange={value =>\r\n                    handleFormFieldChange('customer_type', value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                >\r\n                  <Option value=\"regular\">Regular</Option>\r\n                  <Option value=\"vip\">VIP</Option>\r\n                  <Option value=\"wholesale\">Wholesale</Option>\r\n                </Select>\r\n              </Form.Item> */}\r\n            </div>\r\n\r\n            <Form.Item\r\n              name=\"address\"\r\n              label={\r\n                <span\r\n                  style={{\r\n                    fontWeight: 600,\r\n                    color: '#374151',\r\n                    fontSize: '14px',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: 6,\r\n                  }}\r\n                >\r\n                  <HomeOutlined style={{ color: '#ef4444' }} />\r\n                  Address\r\n                </span>\r\n              }\r\n            >\r\n              <Input.TextArea\r\n                name=\"address\"\r\n                placeholder=\"Enter address\"\r\n                rows={3}\r\n                value={newCustomerData.address}\r\n                onChange={e => handleFormFieldChange('address', e.target.value)}\r\n                onKeyDown={e => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    // If it's the last field, create the customer\r\n                    handleCreateCustomerFromForm();\r\n                  }\r\n                }}\r\n                style={{\r\n                  borderRadius: 10,\r\n                  border: '2px solid #e5e7eb',\r\n                  padding: '12px 16px',\r\n                  fontSize: '14px',\r\n                  transition: 'all 0.3s ease',\r\n                  boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                  background: 'white',\r\n                  resize: 'none',\r\n                }}\r\n              />\r\n            </Form.Item>\r\n          </Form>\r\n        </div>\r\n      )}\r\n\r\n      <Divider style={{ margin: '16px 0' }} />\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {customerLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading customers...</Text>\r\n          </div>\r\n        ) : filteredCustomers.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No customers found matching your search.'\r\n                : 'No customers available.'}\r\n            </Text>\r\n            {searchTerm && (\r\n              <div style={{ marginTop: 16 }}>\r\n                <Text type=\"secondary\">\r\n                  Press Ctrl+N to create a new customer instantly\r\n                </Text>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredCustomers}\r\n            rowKey=\"_id\"\r\n            pagination={false}\r\n            size=\"small\"\r\n            scroll={{ y: 300 }}\r\n            onRow={getRowProps}\r\n          />\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\n// Memoize the component to prevent unnecessary re-renders\r\nconst CustomerSelectionModal = React.memo(CustomerSelectionModalComponent);\r\nexport default CustomerSelectionModal;\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Typography,\r\n  Tag,\r\n  Table,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n  HomeOutlined,\r\n  ShopOutlined,\r\n} from '@ant-design/icons';\r\nimport { useGenericCrudRTK } from '../../../hooks/useGenericCrudRTK';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Text } = Typography;\r\n\r\ninterface Vendor {\r\n  _id: string;\r\n  vendor_name: string;\r\n  email: string;\r\n  contact_number: string;\r\n  address: string;\r\n  vendor_type?: string;\r\n}\r\n\r\ninterface VendorSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (vendor: Vendor) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst VendorSelectionModalComponent: React.FC<VendorSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [debouncedSearchTerm, setDebouncedSearchTerm] = useState('');\r\n  const [selectedVendor, setSelectedVendor] = useState<Vendor | null>(null);\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // RTK Query hooks for Vendor\r\n  // Only fetch when modal is visible to prevent duplicate API calls\r\n  const { data: vendorData, isLoading: vendorLoading } = \r\n    apiSlice.useGetVendorQuery(\r\n      { searchString: debouncedSearchTerm },\r\n      { skip: !visible } // Only fetch when modal is open\r\n    );\r\n\r\n  // Extract vendors from vendorData\r\n  const vendors = useMemo(() => {\r\n    if (!vendorData) return [];\r\n    return (vendorData as any)?.result || [];\r\n  }, [vendorData]);\r\n\r\n  // Memoized filtered vendors - filter locally for instant UI feedback\r\n  const filteredVendors = useMemo(() => {\r\n    if (!searchTerm.trim()) return vendors;\r\n    const term = searchTerm.toLowerCase();\r\n    return vendors.filter((vendor: Vendor) =>\r\n      vendor.vendor_name?.toLowerCase().includes(term) ||\r\n      vendor.contact_number?.includes(term) ||\r\n      vendor.email?.toLowerCase().includes(term)\r\n    );\r\n  }, [vendors, searchTerm]);\r\n\r\n  // Memoized vendor type color function\r\n  const getVendorTypeColor = useCallback((type?: string) => {\r\n    const colorMap: Record<string, string> = {\r\n      premium: 'gold',\r\n      wholesale: 'blue',\r\n      regular: 'green',\r\n    };\r\n    return colorMap[type || 'regular'] || 'green';\r\n  }, []);\r\n\r\n  // Debounce search term for API calls\r\n  useEffect(() => {\r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n\r\n    searchTimeoutRef.current = setTimeout(() => {\r\n      setDebouncedSearchTerm(searchTerm);\r\n    }, 300);\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [searchTerm]);\r\n\r\n  // Handle search input change\r\n  const handleSearch = useCallback((value: string) => {\r\n    setSearchTerm(value);\r\n    setSelectedVendor(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n\r\n  // Focus search input when modal opens\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current) {\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n        searchInputRef.current?.select();\r\n      }, 100);\r\n    }\r\n  }, [visible]);\r\n\r\n  // Reset state when modal closes\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setSearchTerm('');\r\n      setDebouncedSearchTerm('');\r\n      setSelectedVendor(null);\r\n      setSelectedRowIndex(-1);\r\n    }\r\n  }, [visible]);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToVendor = useCallback(\r\n    (direction: 'up' | 'down' | 'first' | 'last') => {\r\n      if (filteredVendors.length === 0) return;\r\n\r\n      let newIndex = selectedRowIndex;\r\n      if (direction === 'up') {\r\n        newIndex = selectedRowIndex <= 0 ? filteredVendors.length - 1 : selectedRowIndex - 1;\r\n      } else if (direction === 'down') {\r\n        newIndex = selectedRowIndex >= filteredVendors.length - 1 ? 0 : selectedRowIndex + 1;\r\n      } else if (direction === 'first') {\r\n        newIndex = 0;\r\n      } else if (direction === 'last') {\r\n        newIndex = filteredVendors.length - 1;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedVendor(filteredVendors[newIndex]);\r\n\r\n      // Scroll selected row into view\r\n      setTimeout(() => {\r\n        const selectedRow = document.querySelector(\r\n          '.vendor-selection-table .ant-table-row-selected'\r\n        );\r\n        if (selectedRow) {\r\n          selectedRow.scrollIntoView({ block: 'nearest', behavior: 'smooth' });\r\n        }\r\n      }, 0);\r\n    },\r\n    [filteredVendors, selectedRowIndex]\r\n  );\r\n\r\n  // Handle vendor selection\r\n  const handleVendorSelect = useCallback(\r\n    (vendor: Vendor) => {\r\n      onSelect(vendor);\r\n      onCancel();\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Keyboard shortcuts\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'ArrowDown') {\r\n        e.preventDefault();\r\n        navigateToVendor('down');\r\n      } else if (e.key === 'ArrowUp') {\r\n        e.preventDefault();\r\n        navigateToVendor('up');\r\n      } else if (e.key === 'Home') {\r\n        e.preventDefault();\r\n        navigateToVendor('first');\r\n      } else if (e.key === 'End') {\r\n        e.preventDefault();\r\n        navigateToVendor('last');\r\n      } else if (e.key === 'Enter' && selectedVendor) {\r\n        e.preventDefault();\r\n        handleVendorSelect(selectedVendor);\r\n      } else if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        onCancel();\r\n      }\r\n    },\r\n    [navigateToVendor, selectedVendor, handleVendorSelect, onCancel]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: Vendor) => (\r\n          <div\r\n            style={{\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              width: '100%',\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '24px',\r\n                height: '24px',\r\n                borderRadius: '50%',\r\n                border: '2px solid #6366f1',\r\n                backgroundColor:\r\n                  selectedVendor?._id === record._id ? '#6366f1' : 'transparent',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedVendor?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Vendor Name',\r\n        dataIndex: 'vendor_name',\r\n        key: 'vendor_name',\r\n        render: (text: string, record: Vendor) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <ShopOutlined style={{ color: '#6366f1' }} />\r\n            <Text strong>{text}</Text>\r\n            {record.vendor_type && (\r\n              <Tag color={getVendorTypeColor(record.vendor_type)}>\r\n                {record.vendor_type.toUpperCase()}\r\n              </Tag>\r\n            )}\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Contact Number',\r\n        dataIndex: 'contact_number',\r\n        key: 'contact_number',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Address',\r\n        dataIndex: 'address',\r\n        key: 'address',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'flex-start', gap: 8 }}>\r\n            <HomeOutlined style={{ color: '#666', marginTop: '2px' }} />\r\n            <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n              {text || '-'}\r\n            </Text>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedVendor, getVendorTypeColor]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: Vendor, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedVendor(record);\r\n        setSelectedRowIndex(index ?? -1);\r\n      },\r\n      onDoubleClick: () => handleVendorSelect(record),\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedVendor?._id === record._id ? '#f0f5ff' : 'transparent',\r\n      },\r\n      className:\r\n        selectedVendor?._id === record._id ? 'ant-table-row-selected' : '',\r\n    }),\r\n    [selectedVendor, handleVendorSelect]\r\n  );\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedVendor(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n          <ShopOutlined style={{ color: '#6366f1', fontSize: 18 }} />\r\n          <span>Select Vendor</span>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={1000}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Input\r\n          ref={searchInputRef}\r\n          placeholder=\"Search vendors... (Click to highlight, Double-click or Enter to select)\"\r\n          value={searchTerm}\r\n          onChange={e => handleSearch(e.target.value)}\r\n          prefix={<SearchOutlined />}\r\n          style={{ width: '100%' }}\r\n          onFocus={handleSearchFocus}\r\n          autoFocus\r\n          suffix={\r\n            searchTerm && vendorLoading ? (\r\n              <div style={{ fontSize: '12px', color: '#999' }}>\r\n                Searching...\r\n              </div>\r\n            ) : null\r\n          }\r\n        />\r\n      </div>\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {vendorLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading vendors...</Text>\r\n          </div>\r\n        ) : filteredVendors.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No vendors found matching your search.'\r\n                : 'No vendors available.'}\r\n            </Text>\r\n          </div>\r\n        ) : (\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredVendors}\r\n            rowKey=\"_id\"\r\n            pagination={false}\r\n            size=\"small\"\r\n            scroll={{ y: 300 }}\r\n            onRow={getRowProps}\r\n            className=\"vendor-selection-table\"\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      <div\r\n        style={{\r\n          marginTop: 16,\r\n          padding: 12,\r\n          backgroundColor: '#f0f5ff',\r\n          borderRadius: 8,\r\n          fontSize: '12px',\r\n        }}\r\n      >\r\n        <Text type=\"secondary\">\r\n          <strong>Shortcuts:</strong> Click to highlight  Double-click or Enter to select   Navigate  Esc Close  Home/End First/Last\r\n        </Text>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\n// Memoize the component to prevent unnecessary re-renders\r\nconst VendorSelectionModal = React.memo(VendorSelectionModalComponent);\r\n\r\nexport default VendorSelectionModal;\r\n\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Typography,\r\n  Table,\r\n  Tag,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  UserOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n} from '@ant-design/icons';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface User {\r\n  _id: string;\r\n  name: string;\r\n  email: string;\r\n  mobile: string;\r\n  user_name: string;\r\n  roleItems?: {\r\n    name: string;\r\n  };\r\n  branchItems?: {\r\n    branch_name: string;\r\n  };\r\n  organisationItems?: {\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface UserSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (user: User) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst UserSelectionModal: React.FC<UserSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  // Use RTK Query for billing users\r\n  const { data: userData, isLoading: userLoading } = apiSlice.useGetBillingUsersQuery({});\r\n  const userList = (userData as any)?.result || userData || {};\r\n  const users = userList?.items || userList?.result || Array.isArray(userList) ? userList : [];\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n  \r\n  // Get current user from session storage\r\n  const currentUser = useMemo(() => {\r\n    return getCurrentUser();\r\n  }, []);\r\n\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Memoized filtered users\r\n  const filteredUsers = useMemo(() => {\r\n    if (!searchTerm.trim()) {\r\n      return users;\r\n    }\r\n    \r\n    const searchLower = searchTerm.toLowerCase();\r\n    return users.filter((user: User) =>\r\n      user.name?.toLowerCase().includes(searchLower) ||\r\n      user.email?.toLowerCase().includes(searchLower) ||\r\n      user.mobile?.toLowerCase().includes(searchLower) ||\r\n      user.user_name?.toLowerCase().includes(searchLower) ||\r\n      user.roleItems?.name?.toLowerCase().includes(searchLower)\r\n    );\r\n  }, [users, searchTerm]);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToUser = useCallback(\r\n    (direction: 'up' | 'down' | 'home' | 'end') => {\r\n      if (filteredUsers.length === 0) return;\r\n\r\n      let newIndex: number;\r\n      switch (direction) {\r\n        case 'up':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? filteredUsers.length - 1\r\n              : Math.max(selectedRowIndex - 1, 0);\r\n          break;\r\n        case 'down':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? 0\r\n              : Math.min(selectedRowIndex + 1, filteredUsers.length - 1);\r\n          break;\r\n        case 'home':\r\n          newIndex = 0;\r\n          break;\r\n        case 'end':\r\n          newIndex = filteredUsers.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedUser(filteredUsers[newIndex]);\r\n\r\n      // Scroll to the selected row\r\n      setTimeout(() => {\r\n        const rowElement = document.querySelector(\r\n          `[data-row-key=\"${filteredUsers[newIndex]._id}\"]`\r\n        ) as HTMLElement;\r\n        if (rowElement) {\r\n          const scrollBehavior =\r\n            direction === 'home'\r\n              ? 'start'\r\n              : direction === 'end'\r\n                ? 'end'\r\n                : 'nearest';\r\n          rowElement.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: scrollBehavior,\r\n          });\r\n        }\r\n      }, 100);\r\n    },\r\n    [filteredUsers, selectedRowIndex]\r\n  );\r\n\r\n  // Debounced search function\r\n  const handleSearch = useCallback(\r\n    (value: string) => {\r\n      setSearchTerm(value);\r\n\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n\r\n      // Search will be handled client-side from cached RTK Query data\r\n      // For server-side search, use refetch with query parameters\r\n      // TODO: Implement server-side search with RTK Query if needed\r\n    },\r\n    []\r\n  );\r\n\r\n  // Handle user selection\r\n  const handleUserSelect = useCallback(\r\n    (user: User) => {\r\n      setSelectedUser(user);\r\n      onSelect(user);\r\n      setTimeout(() => onCancel(), 100);\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Handle keyboard events\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onCancel();\r\n      } else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToUser(directionMap[e.key]);\r\n      }\r\n    },\r\n    [navigateToUser, onCancel]\r\n  );\r\n\r\n  // Global keyboard event handler\r\n  const handleGlobalKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (!visible) return;\r\n\r\n      // Don't interfere if user is typing in form inputs\r\n      const target = e.target as HTMLElement;\r\n      if (\r\n        target.tagName === 'INPUT' ||\r\n        target.tagName === 'TEXTAREA' ||\r\n        target.classList.contains('ant-select-selector') ||\r\n        target.closest('.ant-select-dropdown')\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === 'f') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Only handle navigation keys globally when not in form inputs\r\n      if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToUser(directionMap[e.key]);\r\n      }\r\n    },\r\n    [visible, navigateToUser]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: User) => (\r\n          <div\r\n            style={{\r\n              cursor: 'pointer',\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n            }}\r\n            onClick={() => {\r\n              setSelectedUser(record);\r\n              const index = filteredUsers.findIndex(\r\n                (u: User) => u._id === record._id\r\n              );\r\n              setSelectedRowIndex(index);\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                borderRadius: '50%',\r\n                border:\r\n                  selectedUser?._id === record._id\r\n                    ? '2px solid #1890ff'\r\n                    : '2px solid #d9d9d9',\r\n                backgroundColor:\r\n                  selectedUser?._id === record._id ? '#1890ff' : 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedUser?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Name',\r\n        dataIndex: 'name',\r\n        key: 'name',\r\n        render: (text: string, record: User) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <UserOutlined style={{ color: '#1890ff' }} />\r\n            <div>\r\n              <Text strong>{text}</Text>\r\n              <br />\r\n              <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n                @{record.user_name}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Role',\r\n        key: 'role',\r\n        render: (text: string, record: User) => (\r\n          <Tag color=\"blue\">\r\n            {record.roleItems?.name || 'No Role'}\r\n          </Tag>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Mobile',\r\n        dataIndex: 'mobile',\r\n        key: 'mobile',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Branch',\r\n        key: 'branch',\r\n        render: (text: string, record: User) => (\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            {record.branchItems?.branch_name || '-'}\r\n          </Text>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedUser, filteredUsers]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: User, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedUser(record);\r\n        setSelectedRowIndex(index ?? 0);\r\n      },\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedUser?._id === record._id ? '#f0f8ff' : 'white',\r\n        border:\r\n          selectedUser?._id === record._id\r\n            ? '2px solid #1890ff'\r\n            : '1px solid #f0f0f0',\r\n        borderRadius: '4px',\r\n        transition: 'all 0.2s ease',\r\n      },\r\n      onMouseEnter: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedUser?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = '#f5f5f5';\r\n        }\r\n      },\r\n      onMouseLeave: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedUser?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = 'white';\r\n        }\r\n      },\r\n    }),\r\n    [selectedUser]\r\n  );\r\n\r\n  // Handle modal close (RTK Query automatically loads on mount)\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setSelectedUser(null);\r\n      setSelectedRowIndex(-1);\r\n    } else {\r\n      setSearchTerm('');\r\n      setSelectedUser(null);\r\n      setSelectedRowIndex(-1);\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = null;\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [visible]);\r\n\r\n  // Auto-select current user when users are loaded\r\n  useEffect(() => {\r\n    if (visible && users.length > 0 && currentUser?._id && !selectedUser) {\r\n      const currentUserInList = users.find((user: User) => user._id === currentUser._id);\r\n      if (currentUserInList) {\r\n        setSelectedUser(currentUserInList);\r\n        const index = users.findIndex((user: User) => user._id === currentUser._id);\r\n        setSelectedRowIndex(index);\r\n        \r\n        // Scroll to the selected user after a short delay\r\n        setTimeout(() => {\r\n          const rowElement = document.querySelector(\r\n            `[data-row-key=\"${currentUserInList._id}\"]`\r\n          ) as HTMLElement;\r\n          if (rowElement) {\r\n            rowElement.scrollIntoView({\r\n              behavior: 'smooth',\r\n              block: 'center',\r\n            });\r\n          }\r\n        }, 200);\r\n      }\r\n    }\r\n  }, [visible, users, currentUser?._id, selectedUser]);\r\n\r\n  // Focus search input when modal becomes visible\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current) {\r\n      const focusSearch = () => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n      };\r\n\r\n      focusSearch();\r\n      const timer = setTimeout(focusSearch, 100);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [visible]);\r\n\r\n  // Global keyboard event listener\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('keydown', handleGlobalKeyDown, true);\r\n      return () =>\r\n        document.removeEventListener('keydown', handleGlobalKeyDown, true);\r\n    }\r\n  }, [visible, handleGlobalKeyDown]);\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedUser(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select User (Billed By)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={900}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Input\r\n          ref={searchInputRef}\r\n          placeholder=\"Search users... (: Navigate, Enter: Select, Esc: Close)\"\r\n          value={searchTerm}\r\n          onChange={e => handleSearch(e.target.value)}\r\n          prefix={<SearchOutlined />}\r\n          style={{ width: '100%' }}\r\n          onKeyDown={e => {\r\n            // Only handle Enter key in search input, let other keys bubble up\r\n            if (e.key === 'Enter' && selectedUser) {\r\n              handleUserSelect(selectedUser);\r\n            }\r\n          }}\r\n          onFocus={handleSearchFocus}\r\n          autoFocus\r\n          onBlur={() => {\r\n            // Auto-focus back to search if modal is still visible\r\n            if (visible && searchInputRef.current) {\r\n              setTimeout(() => {\r\n                if (visible && searchInputRef.current) {\r\n                  searchInputRef.current.focus();\r\n                }\r\n              }, 10);\r\n            }\r\n          }}\r\n          suffix={\r\n            searchTerm && userLoading ? (\r\n              <div style={{ fontSize: '12px', color: '#999' }}>\r\n                Searching...\r\n              </div>\r\n            ) : null\r\n          }\r\n        />\r\n      </div>\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {userLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading users...</Text>\r\n          </div>\r\n        ) : filteredUsers.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No users found matching your search.'\r\n                : 'No users available.'}\r\n            </Text>\r\n          </div>\r\n        ) : (\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredUsers}\r\n            rowKey=\"_id\"\r\n            pagination={false}\r\n            size=\"small\"\r\n            scroll={{ y: 300 }}\r\n            onRow={getRowProps}\r\n          />\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default UserSelectionModal;\r\n","import React from 'react';\r\nimport { Modal, Button, Typography, Space, Divider } from 'antd';\r\nimport { \r\n  FileTextOutlined, \r\n  PlusOutlined, \r\n  CheckCircleOutlined,\r\n  DollarOutlined,\r\n  UserOutlined,\r\n  CalendarOutlined\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillSaveConfirmationModalProps {\r\n  visible: boolean;\r\n  onNewBill: () => void;\r\n  onContinueBill: () => void;\r\n  onCancel: () => void;\r\n  savedBillData?: any;\r\n}\r\n\r\nconst BillSaveConfirmationModal: React.FC<BillSaveConfirmationModalProps> = ({\r\n  visible,\r\n  onNewBill,\r\n  onContinueBill,\r\n  onCancel,\r\n  savedBillData\r\n}) => {\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ textAlign: 'center' }}>\r\n          <CheckCircleOutlined \r\n            style={{ \r\n              color: '#52c41a', \r\n              fontSize: '24px', \r\n              marginRight: '8px' \r\n            }} \r\n          />\r\n          <span style={{ color: '#52c41a', fontWeight: 600 }}>\r\n            Bill Saved Successfully!\r\n          </span>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={500}\r\n      centered\r\n      maskClosable={false}\r\n      closable={false}\r\n    >\r\n      <div style={{ textAlign: 'center', marginBottom: '24px' }}>\r\n        <Text type=\"secondary\">\r\n          Your bill has been saved successfully. What would you like to do next?\r\n        </Text>\r\n      </div>\r\n\r\n      {savedBillData && (\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)',\r\n            border: '1px solid #0ea5e9',\r\n            borderRadius: '8px',\r\n            padding: '16px',\r\n            marginBottom: '24px',\r\n          }}\r\n        >\r\n          <Title level={5} style={{ marginBottom: '12px', color: '#0369a1' }}>\r\n             Bill Summary\r\n          </Title>\r\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <FileTextOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>Invoice: {savedBillData.invoice_no}</Text>\r\n            </div>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <UserOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>{savedBillData.customer_name || 'N/A'}</Text>\r\n            </div>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <CalendarOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>{dayjs(savedBillData.date).format('DD/MM/YYYY')}</Text>\r\n            </div>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <DollarOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>{(typeof savedBillData.total_amount === 'number' ? savedBillData.total_amount : parseFloat(savedBillData.total_amount) || 0).toFixed(2)}</Text>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <Divider style={{ margin: '20px 0' }} />\r\n\r\n      <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n        <Button\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          icon={<PlusOutlined />}\r\n          onClick={onNewBill}\r\n          style={{\r\n            width: '100%',\r\n            height: '48px',\r\n            background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n            border: 'none',\r\n            fontWeight: 600,\r\n            fontSize: '16px',\r\n            borderRadius: '8px',\r\n          }}\r\n        >\r\n           Create New Bill\r\n        </Button>\r\n        \r\n        <Button\r\n          size=\"large\"\r\n          icon={<FileTextOutlined />}\r\n          onClick={onContinueBill}\r\n          style={{\r\n            width: '100%',\r\n            height: '48px',\r\n            background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\r\n            color: 'white',\r\n            border: 'none',\r\n            fontWeight: 600,\r\n            fontSize: '16px',\r\n            borderRadius: '8px',\r\n          }}\r\n        >\r\n           Continue with Current Bill\r\n        </Button>\r\n      </Space>\r\n\r\n      <div style={{ textAlign: 'center', marginTop: '16px' }}>\r\n        <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n           Tip: Use \"New Bill\" to start fresh or \"Continue Bill\" to add more items\r\n        </Text>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default BillSaveConfirmationModal;\r\n","import React, { useState, useEffect, useMemo } from 'react';\r\nimport { \r\n  Drawer, \r\n  List, \r\n  Typography, \r\n  Button, \r\n  Input, \r\n  Space, \r\n  Tag, \r\n  Avatar, \r\n  Badge,\r\n  Tooltip,\r\n  Divider,\r\n  Empty,\r\n  Spin,\r\n  Tabs\r\n} from 'antd';\r\nimport { \r\n  SearchOutlined, \r\n  FileTextOutlined, \r\n  UserOutlined, \r\n  CalendarOutlined,\r\n  DollarOutlined,\r\n  EyeOutlined,\r\n  PrinterOutlined,\r\n  PlusOutlined,\r\n  CloseOutlined\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Search } = Input;\r\n\r\ninterface BillListDrawerProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onViewBill: (bill: any) => void;\r\n  onNewBill: () => void;\r\n}\r\n\r\nconst BillListDrawer: React.FC<BillListDrawerProps> = ({\r\n  visible,\r\n  onClose,\r\n  onViewBill,\r\n  onNewBill\r\n}) => {\r\n  // Use RTK Query for sales records - Only fetch when drawer is open\r\n  const { data: billListData, isLoading: loading } = apiSlice.useGetSalesRecordQuery(\r\n    {},\r\n    { skip: !visible } //  Only fetch when drawer is visible\r\n  );\r\n  \r\n  // Memoize billList to prevent infinite re-renders\r\n  const billList = useMemo(() => {\r\n    return (billListData as any)?.result || [];\r\n  }, [billListData]);\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [activeTab, setActiveTab] = useState<string>('drafts');\r\n\r\n  // Filter bills based on status and search term\r\n  const filteredBills = useMemo(() => {\r\n    if (!billList || !Array.isArray(billList)) return [];\r\n    \r\n    // First filter by status\r\n    let statusFiltered = billList;\r\n    if (activeTab === 'drafts') {\r\n      statusFiltered = billList.filter((bill: any) => bill.status === 'draft');\r\n    } else {\r\n      statusFiltered = billList.filter((bill: any) => \r\n        !bill.status || bill.status === 'completed'\r\n      );\r\n    }\r\n    \r\n    // Then filter by search term\r\n    if (!searchTerm) return statusFiltered;\r\n    \r\n    const searchLower = searchTerm.toLowerCase();\r\n    return statusFiltered.filter((bill: any) => {\r\n      const invoiceNo = bill.invoice_no || '';\r\n      const customerName = bill.customerDetails?.full_name || '';\r\n      const date = bill.date || '';\r\n      const totalAmount = typeof bill.total_amount === 'number' ? bill.total_amount.toString() : String(bill.total_amount || '');\r\n      \r\n      return (\r\n        invoiceNo.toLowerCase().includes(searchLower) ||\r\n        customerName.toLowerCase().includes(searchLower) ||\r\n        date.includes(searchTerm) ||\r\n        totalAmount.includes(searchTerm)\r\n      );\r\n    });\r\n  }, [billList, searchTerm, activeTab]);\r\n\r\n  const getPaymentStatusColor = (isPaid: boolean, isPartiallyPaid: boolean) => {\r\n    if (isPaid && !isPartiallyPaid) return 'success';\r\n    if (isPartiallyPaid) return 'warning';\r\n    return 'error';\r\n  };\r\n\r\n  const getPaymentStatusText = (isPaid: boolean, isPartiallyPaid: boolean) => {\r\n    if (isPaid && !isPartiallyPaid) return 'Paid';\r\n    if (isPartiallyPaid) return 'Partial';\r\n    return 'Unpaid';\r\n  };\r\n\r\n  const handleViewBill = (bill: any) => {\r\n\r\n    onViewBill(bill);\r\n    onClose();\r\n  };\r\n\r\n  const handleNewBill = () => {\r\n    onNewBill();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n          <Title level={4} style={{ margin: 0, color: '#1f2937' }}>\r\n             Bill List\r\n          </Title>\r\n          <Button\r\n            type=\"text\"\r\n            icon={<CloseOutlined />}\r\n            onClick={onClose}\r\n            size=\"small\"\r\n          />\r\n        </div>\r\n      }\r\n      placement=\"left\"\r\n      open={visible}\r\n      onClose={onClose}\r\n      width={400}\r\n      bodyStyle={{ padding: '16px' }}\r\n      headerStyle={{ \r\n        borderBottom: '1px solid #e5e7eb',\r\n        padding: '16px 16px 12px 16px'\r\n      }}\r\n    >\r\n      {/* Search and New Bill Section */}\r\n      <div style={{ marginBottom: '16px' }}>\r\n        <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n          <Search\r\n            placeholder=\"Search bills by invoice, customer, date...\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n            prefix={<SearchOutlined />}\r\n            allowClear\r\n            size=\"large\"\r\n          />\r\n          \r\n          <Button\r\n            type=\"primary\"\r\n            icon={<PlusOutlined />}\r\n            onClick={handleNewBill}\r\n            style={{\r\n              width: '100%',\r\n              height: '40px',\r\n              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n              border: 'none',\r\n              fontWeight: 600,\r\n              borderRadius: '8px',\r\n            }}\r\n          >\r\n             Create New Bill\r\n          </Button>\r\n        </Space>\r\n      </div>\r\n\r\n      <Divider style={{ margin: '16px 0' }} />\r\n\r\n      {/* Tabs for Drafts and Completed */}\r\n      <Tabs\r\n        activeKey={activeTab}\r\n        onChange={setActiveTab}\r\n        items={[\r\n          {\r\n            key: 'drafts',\r\n            label: (\r\n              <span>\r\n                 Drafts ({billList?.filter((b: any) => b.status === 'draft').length || 0})\r\n              </span>\r\n            ),\r\n          },\r\n          {\r\n            key: 'completed',\r\n            label: (\r\n              <span>\r\n                 Completed ({billList?.filter((b: any) => !b.status || b.status === 'completed').length || 0})\r\n              </span>\r\n            ),\r\n          },\r\n        ]}\r\n        style={{ marginBottom: 16 }}\r\n      />\r\n\r\n      {/* Bill List */}\r\n      <div style={{ height: 'calc(100vh - 250px)', overflow: 'auto' }}>\r\n        {loading ? (\r\n          <div style={{ textAlign: 'center', padding: '40px' }}>\r\n            <Spin size=\"large\" />\r\n            <div style={{ marginTop: '16px' }}>\r\n              <Text type=\"secondary\">Loading bills...</Text>\r\n            </div>\r\n          </div>\r\n        ) : filteredBills.length === 0 ? (\r\n          <Empty\r\n            description={\r\n              <div>\r\n                <Text type=\"secondary\">\r\n                  {searchTerm ? 'No bills found matching your search.' : 'No bills available.'}\r\n                </Text>\r\n                {!searchTerm && (\r\n                  <div style={{ marginTop: '8px' }}>\r\n                    <Button type=\"link\" onClick={handleNewBill}>\r\n                      Create your first bill\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            }\r\n            style={{ marginTop: '40px' }}\r\n          />\r\n        ) : (\r\n          <List\r\n            dataSource={filteredBills}\r\n            renderItem={(bill) => (\r\n              <List.Item\r\n                style={{\r\n                  padding: '16px',\r\n                  border: '1px solid #e5e7eb',\r\n                  borderRadius: '8px',\r\n                  marginBottom: '12px',\r\n                  background: 'white',\r\n                  cursor: 'pointer',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onMouseEnter={(e) => {\r\n                  e.currentTarget.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';\r\n                  e.currentTarget.style.transform = 'translateY(-2px)';\r\n                }}\r\n                onMouseLeave={(e) => {\r\n                  e.currentTarget.style.boxShadow = 'none';\r\n                  e.currentTarget.style.transform = 'translateY(0)';\r\n                }}\r\n                onClick={() => handleViewBill(bill)}\r\n              >\r\n                <div style={{ width: '100%' }}>\r\n                  {/* Header with Invoice and Status */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center',\r\n                    marginBottom: '8px'\r\n                  }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <Avatar \r\n                        icon={<FileTextOutlined />} \r\n                        style={{ \r\n                          background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\r\n                          color: 'white'\r\n                        }} \r\n                      />\r\n                      <Text strong style={{ fontSize: '14px' }}>\r\n                        {bill.invoice_no}\r\n                      </Text>\r\n                    </div>\r\n                    <Space>\r\n                      {bill.status === 'draft' ? (\r\n                        <Tag color=\"orange\">DRAFT</Tag>\r\n                      ) : (\r\n                        <Tag color=\"green\">COMPLETED</Tag>\r\n                      )}\r\n                      <Tag color={getPaymentStatusColor(bill.is_paid, bill.is_partially_paid)}>\r\n                        {getPaymentStatusText(bill.is_paid, bill.is_partially_paid)}\r\n                      </Tag>\r\n                    </Space>\r\n                  </div>\r\n\r\n                  {/* Customer Info */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    alignItems: 'center', \r\n                    gap: '8px',\r\n                    marginBottom: '6px'\r\n                  }}>\r\n                    <UserOutlined style={{ color: '#6b7280', fontSize: '12px' }} />\r\n                    <Text style={{ fontSize: '12px', color: '#374151' }}>\r\n                      {bill.customerDetails?.full_name || bill.customer_name || 'N/A'}\r\n                    </Text>\r\n                  </div>\r\n\r\n                  {/* Date and Amount */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center'\r\n                  }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <CalendarOutlined style={{ color: '#6b7280', fontSize: '12px' }} />\r\n                      <Text style={{ fontSize: '12px', color: '#6b7280' }}>\r\n                        {bill.date ? dayjs(bill.date).format('DD/MM/YYYY') : 'N/A'}\r\n                      </Text>\r\n                    </div>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <DollarOutlined style={{ color: '#10b981', fontSize: '12px' }} />\r\n                      <Text strong style={{ fontSize: '14px', color: '#10b981' }}>\r\n                        {(typeof bill.total_amount === 'number' ? bill.total_amount : parseFloat(bill.total_amount) || 0).toFixed(2)}\r\n                      </Text>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Action Buttons */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    gap: '8px', \r\n                    marginTop: '12px',\r\n                    justifyContent: 'flex-end'\r\n                  }}>\r\n                    <Tooltip title=\"View Bill\">\r\n                      <Button\r\n                        type=\"text\"\r\n                        icon={<EyeOutlined />}\r\n                        size=\"small\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          handleViewBill(bill);\r\n                        }}\r\n                        style={{ color: '#3b82f6' }}\r\n                      />\r\n                    </Tooltip>\r\n                    {bill.status !== 'draft' && (\r\n                      <Tooltip title=\"Print Bill\">\r\n                        <Button\r\n                          type=\"text\"\r\n                          icon={<PrinterOutlined />}\r\n                          size=\"small\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            // Handle print functionality\r\n                          }}\r\n                          style={{ color: '#10b981' }}\r\n                        />\r\n                      </Tooltip>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </List.Item>\r\n            )}\r\n            pagination={false}\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      {/* Footer Stats */}\r\n      <div style={{ \r\n        position: 'absolute', \r\n        bottom: 0, \r\n        left: 0, \r\n        right: 0, \r\n        padding: '16px',\r\n        background: 'white',\r\n        borderTop: '1px solid #e5e7eb'\r\n      }}>\r\n        <div style={{ \r\n          display: 'flex', \r\n          justifyContent: 'space-between', \r\n          alignItems: 'center'\r\n        }}>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            Total Bills: {filteredBills.length}\r\n          </Text>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n             Click on any bill to view details\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Drawer>\r\n  );\r\n};\r\n\r\nexport default BillListDrawer;\r\n","import React, { FC, useEffect, useState } from 'react';\r\nimport { Modal, Descriptions, Typography, Tag, Divider } from 'antd';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface ProductDetailsModalProps {\r\n  visible: boolean;\r\n  onCancel: () => void;\r\n  productId: string;\r\n}\r\n\r\ninterface ProductDetails {\r\n  _id: string;\r\n  name: string;\r\n  sku: string;\r\n  description?: string;\r\n  selling_price: number;\r\n  mrp: number;\r\n  VariantItem?: {\r\n    variant_name: string;\r\n    variant_code?: string;\r\n  };\r\n  CategoryItem?: {\r\n    name: string;\r\n    tax_percentage: number;\r\n  };\r\n  brand?: string;\r\n  unit?: string;\r\n  min_stock?: number;\r\n  max_stock?: number;\r\n}\r\n\r\nconst ProductDetailsModal: FC<ProductDetailsModalProps> = ({\r\n  visible,\r\n  onCancel,\r\n  productId,\r\n}) => {\r\n  // Use RTK Query for products\r\n  const { data: productsData, isLoading: loading } = apiSlice.useGetProductQuery({});\r\n  const products = (productsData as any)?.result || [];\r\n\r\n  const [productDetails, setProductDetails] = useState<ProductDetails | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (visible && productId && products && Array.isArray(products)) {\r\n      const product = products.find((p: any) => p._id === productId);\r\n      if (product) {\r\n        setProductDetails(product);\r\n      }\r\n    }\r\n  }, [visible, productId, products]);\r\n\r\n  // RTK Query automatically loads products on mount\r\n  // No manual fetch needed\r\n\r\n  const handleCancel = () => {\r\n    setProductDetails(null);\r\n    onCancel();\r\n  };\r\n\r\n  if (!productDetails) {\r\n    return (\r\n      <Modal\r\n        title=\"Product Details\"\r\n        open={visible}\r\n        onCancel={handleCancel}\r\n        footer={null}\r\n        width={600}\r\n        destroyOnClose\r\n      >\r\n        <div style={{ textAlign: 'center', padding: '40px 20px' }}>\r\n          {loading ? (\r\n            <Text>Loading product details...</Text>\r\n          ) : (\r\n            <Text type=\"secondary\">Product not found</Text>\r\n          )}\r\n        </div>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n          <span> Product Details</span>\r\n          <Tag color=\"blue\" style={{ margin: 0 }}>\r\n            {productDetails.sku}\r\n          </Tag>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={handleCancel}\r\n      footer={null}\r\n      width={700}\r\n      destroyOnClose\r\n    >\r\n      <div style={{ padding: '16px 0' }}>\r\n        {/* Product Name and Variant */}\r\n        <div style={{ marginBottom: '24px' }}>\r\n          <Title level={4} style={{ margin: '0 0 8px 0', color: '#1890ff' }}>\r\n            {productDetails.name}\r\n          </Title>\r\n          {productDetails.VariantItem?.variant_name && (\r\n            <Tag color=\"green\" style={{ fontSize: '12px' }}>\r\n              Variant: {productDetails.VariantItem.variant_name}\r\n            </Tag>\r\n          )}\r\n        </div>\r\n\r\n        <Divider style={{ margin: '16px 0' }} />\r\n\r\n        {/* Product Information */}\r\n        <Descriptions\r\n          title=\"Product Information\"\r\n          column={2}\r\n          size=\"small\"\r\n          bordered\r\n          style={{ marginBottom: '24px' }}\r\n        >\r\n          <Descriptions.Item label=\"Product Name\" span={2}>\r\n            <Text strong>{productDetails.name}</Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.VariantItem?.variant_name && (\r\n            <Descriptions.Item label=\"Variant Name\">\r\n              <Text>{productDetails.VariantItem.variant_name}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.VariantItem?.variant_code && (\r\n            <Descriptions.Item label=\"Variant Code\">\r\n              <Text code>{productDetails.VariantItem.variant_code}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          <Descriptions.Item label=\"SKU\">\r\n            <Text code>{productDetails.sku}</Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.brand && (\r\n            <Descriptions.Item label=\"Brand\">\r\n              <Text>{productDetails.brand}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.unit && (\r\n            <Descriptions.Item label=\"Unit\">\r\n              <Text>{productDetails.unit}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.description && (\r\n            <Descriptions.Item label=\"Description\" span={2}>\r\n              <Text>{productDetails.description}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n        </Descriptions>\r\n\r\n        {/* Pricing Information */}\r\n        <Descriptions\r\n          title=\"Pricing & Tax\"\r\n          column={2}\r\n          size=\"small\"\r\n          bordered\r\n          style={{ marginBottom: '24px' }}\r\n        >\r\n          <Descriptions.Item label=\"Selling Price\">\r\n            <Text strong style={{ color: '#52c41a', fontSize: '16px' }}>\r\n              {productDetails.selling_price?.toFixed(2) || '0.00'}\r\n            </Text>\r\n          </Descriptions.Item>\r\n          \r\n          <Descriptions.Item label=\"MRP\">\r\n            <Text style={{ color: '#fa8c16' }}>\r\n              {productDetails.mrp?.toFixed(2) || '0.00'}\r\n            </Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.CategoryItem?.name && (\r\n            <Descriptions.Item label=\"Category\">\r\n              <Text>{productDetails.CategoryItem.name}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.CategoryItem?.tax_percentage !== undefined && (\r\n            <Descriptions.Item label=\"Tax Rate\">\r\n              <Tag color=\"orange\">\r\n                {productDetails.CategoryItem.tax_percentage}%\r\n              </Tag>\r\n            </Descriptions.Item>\r\n          )}\r\n        </Descriptions>\r\n\r\n        {/* Stock Information */}\r\n        {(productDetails.min_stock !== undefined || productDetails.max_stock !== undefined) && (\r\n          <Descriptions\r\n            title=\"Stock Information\"\r\n            column={2}\r\n            size=\"small\"\r\n            bordered\r\n          >\r\n            {productDetails.min_stock !== undefined && (\r\n              <Descriptions.Item label=\"Minimum Stock\">\r\n                <Text>{productDetails.min_stock}</Text>\r\n              </Descriptions.Item>\r\n            )}\r\n            \r\n            {productDetails.max_stock !== undefined && (\r\n              <Descriptions.Item label=\"Maximum Stock\">\r\n                <Text>{productDetails.max_stock}</Text>\r\n              </Descriptions.Item>\r\n            )}\r\n          </Descriptions>\r\n        )}\r\n\r\n        {/* Footer Information */}\r\n        <div style={{ \r\n          marginTop: '24px', \r\n          padding: '16px', \r\n          backgroundColor: '#f6f8fa', \r\n          borderRadius: '8px',\r\n          textAlign: 'center'\r\n        }}>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            Right-click on product field to view details  Press ESC to close\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProductDetailsModal;\r\n","import React from 'react';\r\nimport { FileTextOutlined, PrinterOutlined } from '@ant-design/icons';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\ninterface DocumentTypeToggleProps {\r\n  value: 'bill' | 'invoice';\r\n  onChange: (value: 'bill' | 'invoice') => void;\r\n}\r\n\r\n/**\r\n * Compact Document Type Toggle\r\n * Matches the style of SALE TYPE, GST, PAYMENT toggles\r\n */\r\nconst DocumentTypeToggle: React.FC<DocumentTypeToggleProps> = ({\r\n  value,\r\n  onChange,\r\n}) => {\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        gap: 8,\r\n        background: '#fff',\r\n        padding: '6px 12px',\r\n        borderRadius: 10,\r\n        boxShadow: '0 2px 6px rgba(0,0,0,0.08)',\r\n      }}\r\n    >\r\n      {/* Label */}\r\n      <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\r\n        <FileTextOutlined style={{ fontSize: 15, color: '#667eea' }} />\r\n        <span style={{ fontWeight: 600, fontSize: 12, color: '#333' }}>\r\n          PRINT TYPE\r\n        </span>\r\n      </div>\r\n\r\n      {/* Toggle Switch */}\r\n      <div\r\n        onClick={() => onChange(value === 'bill' ? 'invoice' : 'bill')}\r\n        style={{\r\n          position: 'relative',\r\n          width: 100,\r\n          height: 30,\r\n          borderRadius: 16,\r\n          background:\r\n            value === 'bill'\r\n              ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'\r\n              : 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',\r\n          cursor: 'pointer',\r\n          transition: 'all 0.3s ease',\r\n          boxShadow: '0 2px 6px rgba(0,0,0,0.15)',\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: value === 'bill' ? 'flex-start' : 'flex-end',\r\n          padding: '0 3px',\r\n        }}\r\n      >\r\n        {/* Toggle Circle */}\r\n        <div\r\n          style={{\r\n            width: 24,\r\n            height: 24,\r\n            borderRadius: '50%',\r\n            background: '#fff',\r\n            boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\r\n            transition: 'all 0.3s ease',\r\n          }}\r\n        />\r\n\r\n        {/* Label inside toggle */}\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            left: value === 'bill' ? 32 : 'auto',\r\n            right: value === 'invoice' ? 32 : 'auto',\r\n            color: '#fff',\r\n            fontWeight: 'bold',\r\n            fontSize: 10,\r\n            letterSpacing: 0.5,\r\n            userSelect: 'none',\r\n          }}\r\n        >\r\n          {value === 'bill' ? 'BILL' : 'INVOICE'}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DocumentTypeToggle;\r\n","// extracted by mini-css-extract-plugin\nexport default {\"mainContainer\":\"BillDataGrid_mainContainer__Jnuo1\",\"gradientShift\":\"BillDataGrid_gradientShift__hhIW9\",\"backgroundCircle1\":\"BillDataGrid_backgroundCircle1__5PBPG\",\"float\":\"BillDataGrid_float__1VyT0\",\"backgroundCircle2\":\"BillDataGrid_backgroundCircle2__J+xMs\",\"backgroundCircle3\":\"BillDataGrid_backgroundCircle3__AgoEw\",\"backgroundCircle4\":\"BillDataGrid_backgroundCircle4__86Xfd\",\"backgroundCircle5\":\"BillDataGrid_backgroundCircle5__qpbiT\",\"headerContainer\":\"BillDataGrid_headerContainer__wfojf\",\"slideInDown\":\"BillDataGrid_slideInDown__l3LU5\",\"headerCircle1\":\"BillDataGrid_headerCircle1__8+aPI\",\"headerCircle2\":\"BillDataGrid_headerCircle2__Z9w17\",\"headerCircle3\":\"BillDataGrid_headerCircle3__3eMNm\",\"pulse\":\"BillDataGrid_pulse__EVfnw\",\"headerCircle4\":\"BillDataGrid_headerCircle4__fVITr\",\"headerCircle5\":\"BillDataGrid_headerCircle5__0E6vl\",\"headerContent\":\"BillDataGrid_headerContent__6Rnkr\",\"titleSection\":\"BillDataGrid_titleSection__LBuxT\",\"fadeInLeft\":\"BillDataGrid_fadeInLeft__YHJna\",\"titleIcon\":\"BillDataGrid_titleIcon__qffZU\",\"bounce\":\"BillDataGrid_bounce__fYaGs\",\"titleText\":\"BillDataGrid_titleText__XlvSS\",\"slideInRight\":\"BillDataGrid_slideInRight__+-bkg\",\"subtitleText\":\"BillDataGrid_subtitleText__Hgyav\",\"fadeInUp\":\"BillDataGrid_fadeInUp__Y00FE\",\"controlsSection\":\"BillDataGrid_controlsSection__PSC3w\",\"fadeInRight\":\"BillDataGrid_fadeInRight__eA5Bm\",\"controlGroup\":\"BillDataGrid_controlGroup__AFGBT\",\"saleTypeControl\":\"BillDataGrid_saleTypeControl__hzHpa\",\"slideInUp\":\"BillDataGrid_slideInUp__ZuvW2\",\"gstControl\":\"BillDataGrid_gstControl__AiGdY\",\"paymentControl\":\"BillDataGrid_paymentControl__BD0r9\",\"partialPaymentControl\":\"BillDataGrid_partialPaymentControl__unngo\",\"controlLabel\":\"BillDataGrid_controlLabel__QP4fP\",\"badgesContainer\":\"BillDataGrid_badgesContainer__bqqSt\",\"itemsBadge\":\"BillDataGrid_itemsBadge__o0Uro\",\"amountBadge\":\"BillDataGrid_amountBadge__IPSqT\",\"badgeText\":\"BillDataGrid_badgeText__9cTal\",\"invoiceDetailsGrid\":\"BillDataGrid_invoiceDetailsGrid__QPpaj\",\"itemsSection\":\"BillDataGrid_itemsSection__vJE1b\",\"itemsCircle1\":\"BillDataGrid_itemsCircle1__PQoMB\",\"rotate\":\"BillDataGrid_rotate__l3nA9\",\"itemsCircle2\":\"BillDataGrid_itemsCircle2__0lWcR\",\"scaleIn\":\"BillDataGrid_scaleIn__xFZvA\",\"billItemsGrid\":\"BillDataGrid_billItemsGrid__jpWQo\",\"billItemsHeader\":\"BillDataGrid_billItemsHeader__hxL0O\",\"billItemsTitle\":\"BillDataGrid_billItemsTitle__MQduV\",\"billItemsBadge\":\"BillDataGrid_billItemsBadge__vdJMk\",\"billSummary\":\"BillDataGrid_billSummary__yA4j-\",\"summaryCircle1\":\"BillDataGrid_summaryCircle1__PuveY\",\"summaryCircle2\":\"BillDataGrid_summaryCircle2__fdcks\",\"summaryHeader\":\"BillDataGrid_summaryHeader__h1BtQ\",\"summaryTitle\":\"BillDataGrid_summaryTitle__dSOoP\",\"summaryRow\":\"BillDataGrid_summaryRow__yUShR\",\"summaryLabel\":\"BillDataGrid_summaryLabel__cLnHd\",\"summaryValue\":\"BillDataGrid_summaryValue__LUh-6\",\"summaryTotal\":\"BillDataGrid_summaryTotal__ujvAB\",\"summaryTable\":\"BillDataGrid_summaryTable__ZpVlt\",\"totalAmountRow\":\"BillDataGrid_totalAmountRow__JXMuL\",\"totalAmountLabel\":\"BillDataGrid_totalAmountLabel__IVRMe\",\"totalAmountValue\":\"BillDataGrid_totalAmountValue__5W5mL\",\"discountValue\":\"BillDataGrid_discountValue__QjPij\",\"partialPaymentInfo\":\"BillDataGrid_partialPaymentInfo__OpO+-\",\"partialPaymentRow\":\"BillDataGrid_partialPaymentRow__Qy-Ni\",\"partialPaymentLabel\":\"BillDataGrid_partialPaymentLabel__yEvTO\",\"partialPaymentValue\":\"BillDataGrid_partialPaymentValue__SLg8d\",\"controlsContainer\":\"BillDataGrid_controlsContainer__2jCRg\",\"discountControl\":\"BillDataGrid_discountControl__n0WOI\",\"discountControlLabel\":\"BillDataGrid_discountControlLabel__0iwJ9\",\"discountControlInputs\":\"BillDataGrid_discountControlInputs__TbgUU\",\"partialPaymentControlLabel\":\"BillDataGrid_partialPaymentControlLabel__lxP98\",\"summaryTotalLabel\":\"BillDataGrid_summaryTotalLabel__u+656\",\"summaryTotalValue\":\"BillDataGrid_summaryTotalValue__sKz9B\",\"partialPaymentBalance\":\"BillDataGrid_partialPaymentBalance__lFxZE\",\"discountLabel\":\"BillDataGrid_discountLabel__906vd\",\"discountInputs\":\"BillDataGrid_discountInputs__9BUMD\",\"actionHub\":\"BillDataGrid_actionHub__SlPSg\",\"actionButtonsContainer\":\"BillDataGrid_actionButtonsContainer__BcfKu\",\"actionHubCircle1\":\"BillDataGrid_actionHubCircle1__ggNzA\",\"actionHubCircle2\":\"BillDataGrid_actionHubCircle2__Nb-oj\",\"actionHubCircle3\":\"BillDataGrid_actionHubCircle3__D2pna\",\"actionHubCircle4\":\"BillDataGrid_actionHubCircle4__ayVXK\",\"actionButtons\":\"BillDataGrid_actionButtons__tQbXu\",\"saveButton\":\"BillDataGrid_saveButton__vWggk\",\"billListButton\":\"BillDataGrid_billListButton__ahHFc\",\"refreshButton\":\"BillDataGrid_refreshButton__XnoTE\",\"printButton\":\"BillDataGrid_printButton__nkIDd\",\"clearButton\":\"BillDataGrid_clearButton__518xA\",\"shortcutsInfo\":\"BillDataGrid_shortcutsInfo__kN1Ka\",\"shortcutsText\":\"BillDataGrid_shortcutsText__qGuNn\",\"customerField\":\"BillDataGrid_customerField__+4wOA\",\"customerFieldEndKey\":\"BillDataGrid_customerFieldEndKey__HaMh6\",\"stockField\":\"BillDataGrid_stockField__BQirP\",\"stockFieldSelected\":\"BillDataGrid_stockFieldSelected__x7NU5\",\"stockFieldIcon\":\"BillDataGrid_stockFieldIcon__WeVkj\",\"stockFieldWarning\":\"BillDataGrid_stockFieldWarning__7Lv+C\",\"saleTypeSwitch\":\"BillDataGrid_saleTypeSwitch__Xa4gR\",\"ant-switch-checked\":\"BillDataGrid_ant-switch-checked__rQynk\",\"gstSwitch\":\"BillDataGrid_gstSwitch__ZQG0t\",\"paymentSwitch\":\"BillDataGrid_paymentSwitch__KxB-J\",\"partialPaymentSwitch\":\"BillDataGrid_partialPaymentSwitch__5nNFs\",\"keyboardShortcuts\":\"BillDataGrid_keyboardShortcuts__2e-4z\",\"keyboardShortcutsContent\":\"BillDataGrid_keyboardShortcutsContent__5FpEl\",\"keyboardShortcutsText\":\"BillDataGrid_keyboardShortcutsText__A58I9\",\"slideInLeft\":\"BillDataGrid_slideInLeft__TTFPm\"};","import React, { useEffect, useState, useMemo, useCallback } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport {\r\n  Button,\r\n  Typography,\r\n  message,\r\n  Switch,\r\n  InputNumber,\r\n  Badge,\r\n  Tooltip,\r\n} from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport AntdEditableTable, {\r\n  AntdEditableColumn,\r\n} from '../../../components/common/AntdEditableTable';\r\nimport { useGenericCrudRTK } from '../../../hooks/useGenericCrudRTK';\r\nimport { calculateBillTotals } from '../../../helpers/amount_calculations';\r\nimport { useHandleApiResponse } from '../../../components/common/useHandleApiResponse';\r\nimport { BillItem, BillFormData } from '../../../types/entities';\r\nimport {\r\n  SaveOutlined,\r\n  PrinterOutlined,\r\n  FileTextOutlined,\r\n  ClearOutlined,\r\n} from '@ant-design/icons';\r\nimport StockSelectionModal from './StockSelectionModal';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\nimport CustomerSelectionModal from './CustomerSelectionModal';\r\nimport VendorSelectionModal from './VendorSelectionModal';\r\nimport UserSelectionModal from './UserSelectionModal';\r\nimport BillSaveConfirmationModal from './BillSaveConfirmationModal';\r\nimport BillListDrawer from './BillListDrawer';\r\nimport ProductDetailsModal from './ProductDetailsModal';\r\nimport ProductSelectionModal from './ProductSelectionModal';\r\nimport DocumentTypeToggle from './DocumentTypeToggle';\r\nimport { usePrintDocument } from '../../../hooks/usePrintDocument';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillDataGridProps {\r\n  billdata?: any;\r\n  onSuccess?: (formattedBill?: any) => void;\r\n}\r\n\r\nconst BillDataGrid: React.FC<BillDataGridProps> = ({ billdata, onSuccess }) => {\r\n  // RTK Query hooks\r\n  const dispatch = useDispatch();\r\n  const ProductsApi = useGenericCrudRTK('Product');\r\n  const CustomerApi = useGenericCrudRTK('Customer');\r\n  const VendorApi = useGenericCrudRTK('Vendor');\r\n  const BillingUsersApi = useGenericCrudRTK('BillingUsers');\r\n  const SalesRecord = useGenericCrudRTK('SalesRecord');\r\n  const InvoiceNumberApi = useGenericCrudRTK('InvoiceNumber');\r\n\r\n  // Determine user type for conditional stock API calls\r\n  const user = getCurrentUser();\r\n  const branchId = user?.branch_id;\r\n  const isOrganisationUser = !branchId;\r\n\r\n  // Fetch organization data from API\r\n  const organisationId = user?.organisation_id || user?.organisationItems?._id;\r\n  const { data: organisationsData } = apiSlice.useGetOrganisationsQuery(\r\n    { organisation_id: organisationId },\r\n    { skip: !organisationId }\r\n  );\r\n\r\n  // Get organization details from API response\r\n  const organisationDetails = useMemo(() => {\r\n    const result = (organisationsData as any)?.result;\r\n    if (Array.isArray(result)) {\r\n      return result[0];\r\n    }\r\n    return result || user?.organisationItems || {};\r\n  }, [organisationsData, user]);\r\n\r\n  // Memoize branch details for consistency\r\n  const branchDetails = useMemo(() => user?.branchItems || {}, [user]);\r\n\r\n  // RTK Query hooks for fetching data\r\n  const {\r\n    data: productListData,\r\n    isLoading: productLoading,\r\n    refetch: refetchProducts,\r\n  } = ProductsApi.useGetAll();\r\n  const {\r\n    data: customerListData,\r\n    isLoading: customerLoading,\r\n    refetch: refetchCustomers,\r\n  } = CustomerApi.useGetAll();\r\n  const {\r\n    data: vendorListData,\r\n    isLoading: vendorLoading,\r\n    refetch: refetchVendors,\r\n  } = VendorApi.useGetAll();\r\n  const {\r\n    data: userListData,\r\n    isLoading: userLoading,\r\n    refetch: refetchUsers,\r\n  } = BillingUsersApi.useGetAll();\r\n\r\n  // Stock APIs - Load when editing to prefill stock data\r\n  // For new bills, skip initial load - stock quantities will come from modal selection\r\n  const {\r\n    data: stockAuditListData,\r\n    isLoading: stockLoading,\r\n    refetch: refetchStockAudit,\r\n  } = apiSlice.useGetStockAuditQuery({}, { skip: !billdata || !!branchId });\r\n  \r\n  const {\r\n    data: branchStockListData,\r\n    isLoading: branchStockLoading,\r\n    refetch: refetchBranchStock,\r\n  } = apiSlice.useGetBranchStockQuery({}, { skip: !billdata || !branchId });\r\n\r\n  const { data: invoiceNoData, refetch: refetchInvoiceNo } =\r\n    InvoiceNumberApi.useGetAll();\r\n\r\n  // Extract data with proper fallback - RTK Query returns the API response with { statusCode, result, ... }\r\n  const productList = productListData || {};\r\n  const customerList = customerListData || {};\r\n  const vendorList = vendorListData || {};\r\n  const userList = userListData || {};\r\n  const stockAuditList = stockAuditListData || {};\r\n  const branchStockList = branchStockListData || {};\r\n  const invoice_no_item = invoiceNoData || {};\r\n\r\n  // Access the result field from the API response\r\n  const productListResult = Array.isArray(productList.result)\r\n    ? productList.result\r\n    : [];\r\n  const customerListResult = Array.isArray(customerList.result)\r\n    ? customerList.result\r\n    : [];\r\n  const vendorListResult = Array.isArray((vendorList as any)?.result)\r\n    ? (vendorList as any).result\r\n    : [];\r\n  const userListResult = Array.isArray(userList.result) ? userList.result : [];\r\n  const stockAuditListResult = Array.isArray((stockAuditList as any)?.result)\r\n    ? (stockAuditList as any).result\r\n    : [];\r\n  const branchStockListResult = Array.isArray((branchStockList as any)?.result)\r\n    ? (branchStockList as any).result\r\n    : [];\r\n\r\n  // RTK Query mutation hooks\r\n  const { create: createSalesRecord, isLoading: saleCreateLoading } =\r\n    SalesRecord.useCreate();\r\n  const { update: updateSalesRecord, isLoading: saleUpdateLoading } =\r\n    SalesRecord.useUpdate();\r\n  const { create: createInvoiceNumber, isLoading: invoice_no_create_loading } =\r\n    InvoiceNumberApi.useCreate();\r\n\r\n  const invoice_no_create_item = null; // Not needed for RTK Query\r\n\r\n  // Track create/update responses\r\n  const [createResponse, setCreateResponse] = useState<any>(null);\r\n  const [updateResponse, setUpdateResponse] = useState<any>(null);\r\n\r\n  // Utility function to validate stock quantities based on pack size\r\n  const validateStockQuantities = useCallback(\r\n    (stock: any, productItem: any) => {\r\n      if (!stock || !productItem?.VariantItem?.pack_size)\r\n        return { isValid: true, expectedLoose: 0, totalAvailable: 0 };\r\n\r\n      const packSize = parseInt(productItem.VariantItem.pack_size);\r\n      const availablePackQty = stock.available_quantity || 0;\r\n      const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n      // Stock quantities are valid as they are - no need to enforce a specific relationship\r\n      // The validation happens during quantity entry, not during stock data validation\r\n      const isValid = true; // Always valid - let the quantity validation handle limits\r\n      const totalAvailable = availablePackQty * packSize + availableLooseQty;\r\n\r\n      return { isValid, expectedLoose: availableLooseQty, totalAvailable };\r\n    },\r\n    []\r\n  );\r\n\r\n  // State\r\n  const [billFormData, setBillFormData] = useState<BillFormData>({\r\n    invoice_no: '',\r\n    date: dayjs().format('YYYY-MM-DD'),\r\n    customer_id: '',\r\n    customer_name: '',\r\n    billed_by_id: '',\r\n    billed_by_name: '',\r\n    payment_mode: 'cash',\r\n    items: [],\r\n  });\r\n\r\n  const [billSettings, setBillSettings] = useState({\r\n    isPaid: true,\r\n    isPartiallyPaid: false,\r\n    isRetail: true,\r\n    isGstIncluded: true,\r\n    discount: 0,\r\n    discountType: 'percentage' as 'percentage' | 'amount',\r\n    paidAmount: 0,\r\n  });\r\n\r\n  const [stockModalRowIndex, setStockModalRowIndex] = useState<number | null>(\r\n    null\r\n  );\r\n  const [externalEditingCell, setExternalEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n  const [customerModalVisible, setCustomerModalVisible] = useState(false);\r\n  const [userModalVisible, setUserModalVisible] = useState(false);\r\n  const [saveConfirmationVisible, setSaveConfirmationVisible] = useState(false);\r\n  const [billListDrawerVisible, setBillListDrawerVisible] = useState(false);\r\n  const [savedBillData, setSavedBillData] = useState<any>(null);\r\n  const [productDetailsModalVisible, setProductDetailsModalVisible] =\r\n    useState(false);\r\n  const [selectedProductId, setSelectedProductId] = useState<string>('');\r\n  const [productSelectionModalVisible, setProductSelectionModalVisible] =\r\n    useState(false);\r\n  const [productSelectionRowIndex, setProductSelectionRowIndex] = useState<\r\n    number | null\r\n  >(null);\r\n  const [lastInteractedRowIndex, setLastInteractedRowIndex] =\r\n    useState<number>(0);\r\n\r\n  // Fetch settings to get default document type\r\n  const { data: settingsData } = apiSlice.useGetSettingsQuery(\r\n    { organisation_id: organisationId, page: 1, limit: 1 },\r\n    {\r\n      skip: !organisationId,\r\n      refetchOnMountOrArgChange: false,\r\n    }\r\n  );\r\n\r\n  const settings = useMemo(() => {\r\n    const settingsResult = (settingsData as any)?.result || settingsData || {};\r\n    return Array.isArray(settingsResult) ? settingsResult[0] : settingsResult;\r\n  }, [settingsData]);\r\n\r\n  // Document type state (bill or invoice) - Initialize with settings default or 'bill'\r\n  const [documentType, setDocumentType] = useState<'bill' | 'invoice'>('bill');\r\n  const { printDocument } = usePrintDocument();\r\n\r\n  // Update documentType when settings load (only for new bills, not when editing)\r\n  useEffect(() => {\r\n    if (!billdata && settings?.default_document_type) {\r\n      setDocumentType(settings.default_document_type as 'bill' | 'invoice');\r\n    }\r\n  }, [settings?.default_document_type, billdata]);\r\n\r\n  // Helper function to validate stock quantities\r\n  const validateStockQuantity = (\r\n    stockId: string,\r\n    qty: number,\r\n    looseQty: number\r\n  ): {\r\n    isValid: boolean;\r\n    availablePackQty: number;\r\n    maxLooseQty: number;\r\n    message: string;\r\n  } => {\r\n    const stockListData = branchId\r\n      ? branchStockListResult\r\n      : stockAuditListResult;\r\n    const stock = stockListData.find((s: any) => s._id === stockId);\r\n\r\n    if (!stock) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty: 0,\r\n        maxLooseQty: 0,\r\n        message: 'Stock not found',\r\n      };\r\n    }\r\n\r\n    // Get pack size from stock data\r\n    const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n    const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n    // Available pack quantity (number of complete packs/boxes)\r\n    const availablePackQty = stock.available_quantity || 0;\r\n\r\n    // Available loose quantity (actual loose items in stock, not calculated)\r\n    const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n    // Validate pack quantity (QTY field)\r\n    if (qty > availablePackQty) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty,\r\n        maxLooseQty: 0,\r\n        message: `Pack quantity (${qty}) exceeds available packs (${availablePackQty})`,\r\n      };\r\n    }\r\n\r\n    // Calculate max loose quantity based on remaining packs after QTY selection\r\n    // Formula: (available_packs - selected_qty)  pack_size + available_loose_qty\r\n    const remainingPacks = availablePackQty - qty;\r\n    const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n    const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n    // Validate loose quantity (LOOSE QTY field)\r\n    if (looseQty > maxLooseQty) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty,\r\n        maxLooseQty,\r\n        message: `Loose quantity (${looseQty}) exceeds available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`,\r\n      };\r\n    }\r\n\r\n    return {\r\n      isValid: true,\r\n      availablePackQty,\r\n      maxLooseQty,\r\n      message: '',\r\n    };\r\n  };\r\n\r\n  // Handle quantity change with validation - memoized to prevent column recreation\r\n  const handleQuantityChange = useCallback(\r\n    (rowIndex: number, field: 'qty' | 'loose_qty', value: number) => {\r\n      const newItems = [...billFormData.items];\r\n      const item = newItems[rowIndex];\r\n\r\n      if (!item.stock_id) {\r\n        // If no stock selected, just update the value\r\n        newItems[rowIndex] = { ...item, [field]: value };\r\n        setBillFormData(prev => ({ ...prev, items: newItems }));\r\n        return;\r\n      }\r\n\r\n      // Validate the new quantity\r\n      const newQty = field === 'qty' ? value : item.qty || 0;\r\n      const newLooseQty = field === 'loose_qty' ? value : item.loose_qty || 0;\r\n\r\n      const validation = validateStockQuantity(\r\n        item.stock_id,\r\n        newQty,\r\n        newLooseQty\r\n      );\r\n\r\n      if (!validation.isValid) {\r\n        message.error(validation.message);\r\n\r\n        // Auto-correct the quantity if it exceeds available stock\r\n        if (field === 'qty' && newQty > validation.availablePackQty) {\r\n          newItems[rowIndex] = {\r\n            ...item,\r\n            qty: validation.availablePackQty,\r\n          };\r\n        } else if (\r\n          field === 'loose_qty' &&\r\n          newLooseQty > validation.maxLooseQty\r\n        ) {\r\n          newItems[rowIndex] = { ...item, loose_qty: validation.maxLooseQty };\r\n        }\r\n      } else {\r\n        // Update the quantity\r\n        newItems[rowIndex] = { ...item, [field]: value };\r\n      }\r\n\r\n      setBillFormData(prev => ({ ...prev, items: newItems }));\r\n    },\r\n    [billFormData.items, validateStockQuantity]\r\n  );\r\n\r\n  // Initialize data - fetch fresh data only once when component mounts or billdata changes\r\n  useEffect(() => {\r\n    // Only refetch if this is a new session (not just a re-render)\r\n    // RTK Query caching will prevent duplicate calls if data is fresh\r\n    if (!productListResult.length) refetchProducts();\r\n    if (!customerListResult.length) refetchCustomers();\r\n    if (!vendorListResult.length) refetchVendors();\r\n    if (!userListResult.length) refetchUsers();\r\n    \r\n    // Only get invoice number for new bills, not when editing existing bills\r\n    if (!billdata && !invoice_no_create_loading && !billFormData.invoice_no) {\r\n      refetchInvoiceNo();\r\n    }\r\n\r\n    if (billdata) {\r\n      // Check if this is an invoice or bill to get correct party details\r\n      const isInvoice = billdata.document_type === 'invoice';\r\n      const partyDetails = isInvoice ? billdata.vendorDetails : billdata.customerDetails;\r\n      const partyId = isInvoice ? billdata.vendor_id : billdata.customer_id;\r\n      const partyName = partyDetails?.vendor_name || partyDetails?.full_name || partyDetails?.name || '';\r\n      \r\n      setBillFormData({\r\n        invoice_no: billdata.invoice_no,\r\n        date: dayjs(billdata.date).format('YYYY-MM-DD'),\r\n        customer_id: partyId,\r\n        customer_name: partyName,\r\n        billed_by_id: billdata.billed_by_id || '',\r\n        billed_by_name: billdata.billedByDetails?.name || '',\r\n        payment_mode: billdata.payment_mode,\r\n        items:\r\n          billdata.Items?.map((item: any) => ({\r\n            _id: item._id,\r\n            product_id: item.product_id,\r\n            product_name: item.productItems?.name || '',\r\n            variant_name: item.productItems?.VariantItem?.variant_name || '',\r\n            stock_id: branchId ? item.branch_stock_id : item.stock_id,\r\n            qty: item.qty || 0,\r\n            loose_qty: item.loose_qty || 0,\r\n            price: item.price,\r\n            mrp: item.mrp || item.price,\r\n            amount: item.amount,\r\n            tax_percentage: item.tax_percentage || 0,\r\n          })) || [],\r\n      });\r\n\r\n      setBillSettings({\r\n        isPaid: billdata.is_paid ?? true,\r\n        isPartiallyPaid: billdata.is_partially_paid ?? false,\r\n        isRetail: billdata.sale_type === 'retail',\r\n        isGstIncluded: billdata.is_gst_included ?? true,\r\n        discount: billdata.discount ?? 0,\r\n        discountType: billdata.discount_type ?? 'percentage',\r\n        paidAmount: billdata.paid_amount ?? 0,\r\n      });\r\n\r\n      // Load document type from saved bill data\r\n      setDocumentType(billdata.document_type || 'bill');\r\n    }\r\n  }, [billdata]);\r\n\r\n  // Set auto-generated invoice number\r\n  useEffect(() => {\r\n    if (invoice_no_item?.result?.invoice_no && !billdata) {\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        invoice_no: invoice_no_item.result.invoice_no,\r\n      }));\r\n    }\r\n  }, [invoice_no_item, billdata]);\r\n\r\n  // Initialize with 5 default empty items if no existing data\r\n  useEffect(() => {\r\n    if (!billdata && billFormData.items.length === 0) {\r\n      const defaultItems = Array(1)\r\n        .fill(null)\r\n        .map((_, index) => ({\r\n          product_id: '',\r\n          product_name: '',\r\n          variant_name: '',\r\n          stock_id: '',\r\n          batch_no: '',\r\n          qty: 0,\r\n          loose_qty: 0,\r\n          price: 0,\r\n          mrp: 0,\r\n          amount: 0,\r\n          tax_percentage: 0,\r\n        }));\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        items: defaultItems,\r\n      }));\r\n    }\r\n  }, [billdata, billFormData.items.length]);\r\n\r\n  // Auto-set current user as billed_by for new bills\r\n  useEffect(() => {\r\n    if (\r\n      !billdata &&\r\n      userListResult &&\r\n      user?._id &&\r\n      !billFormData.billed_by_id\r\n    ) {\r\n      const currentUserInList = userListResult.find(\r\n        (u: any) => u._id === user._id\r\n      );\r\n      if (currentUserInList) {\r\n        setBillFormData(prev => ({\r\n          ...prev,\r\n          billed_by_id: user._id,\r\n          billed_by_name: currentUserInList.name || user.name || '',\r\n        }));\r\n      }\r\n    }\r\n  }, [userListResult, user?._id, billdata, billFormData.billed_by_id]);\r\n\r\n  // Product and stock options\r\n  const productOptions = useMemo(\r\n    () =>\r\n      productListResult.map((product: any) => ({\r\n        label:\r\n          `${product.name} ${product?.VariantItem?.variant_name || ''}`.trim(),\r\n        value: product._id,\r\n      })),\r\n    [productListResult]\r\n  );\r\n\r\n  const customerOptions = useMemo(() => {\r\n    const options = customerListResult.map((customer: any) => ({\r\n      label: `${customer.full_name} - ${customer.mobile}`,\r\n      value: customer._id,\r\n    }));\r\n    return options;\r\n  }, [customerListResult]);\r\n\r\n  const vendorOptions = useMemo(() => {\r\n    const options = vendorListResult.map((vendor: any) => ({\r\n      label: `${vendor.vendor_name} - ${vendor.contact_number || 'N/A'}`,\r\n      value: vendor._id,\r\n    }));\r\n    return options;\r\n  }, [vendorListResult]);\r\n\r\n  // Conditionally use customer or vendor options based on document type\r\n  const customerOrVendorOptions = useMemo(() => {\r\n    return documentType === 'invoice' ? vendorOptions : customerOptions;\r\n  }, [documentType, vendorOptions, customerOptions]);\r\n\r\n  const userOptions = useMemo(() => {\r\n    const options = userListResult.map((user: any) => ({\r\n      label: `${user.name} (${user.roleItems?.name || 'No Role'})`,\r\n      value: user._id,\r\n    }));\r\n    return options;\r\n  }, [userListResult]);\r\n\r\n  // Column definitions for bill header - memoized to prevent recreation\r\n  const headerColumns: AntdEditableColumn[] = useMemo(\r\n    () => [\r\n      {\r\n        key: 'invoice_no',\r\n        title: ' INVOICE #',\r\n        dataIndex: 'invoice_no',\r\n        type: 'text',\r\n        required: true,\r\n        width: 180,\r\n      },\r\n      {\r\n        key: 'date',\r\n        title: ' DATE',\r\n        dataIndex: 'date',\r\n        type: 'date',\r\n        required: true,\r\n        width: 150,\r\n      },\r\n      {\r\n        key: 'customer_id',\r\n        title: documentType === 'bill' ? ' CUSTOMER' : ' VENDOR',\r\n        dataIndex: 'customer_id',\r\n        type: 'select',\r\n        options: customerOrVendorOptions,\r\n        required: true,\r\n        width: 250,\r\n        render: (value: any, record: any) => {\r\n          const selectedItem = customerOrVendorOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          const isVendor = documentType === 'invoice';\r\n          const placeholderText = isVendor\r\n            ? 'Select vendor'\r\n            : 'Select customer';\r\n          const tooltipText = isVendor\r\n            ? 'Click to open vendor selection modal (or press End key)'\r\n            : 'Click to open customer selection modal (or press End key)';\r\n\r\n          return (\r\n            <Tooltip title={tooltipText}>\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={() => setCustomerModalVisible(true)}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#fafafa';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>\r\n                  {selectedItem ? selectedItem.label : placeholderText}\r\n                </span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#f0f8ff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  End\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'billed_by_id',\r\n        title: ' BILLED BY',\r\n        dataIndex: 'billed_by_id',\r\n        type: 'select',\r\n        options: userOptions,\r\n        required: false,\r\n        width: 250,\r\n        render: (value: any, record: any) => {\r\n          const selectedUser = userOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          return (\r\n            <Tooltip title=\"Click to open user selection modal (or press Ctrl+U key)\">\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#f0f8ff',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={() => setUserModalVisible(true)}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#e6f7ff';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f8ff';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>{selectedUser ? selectedUser.label : 'Select user'}</span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#ffffff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  Ctrl+U\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'payment_mode',\r\n        title: ' PAYMENT',\r\n        dataIndex: 'payment_mode',\r\n        type: 'select',\r\n        options: [\r\n          { label: ' Cash', value: 'cash' },\r\n          { label: ' UPI', value: 'upi' },\r\n          { label: ' Card', value: 'card' },\r\n        ],\r\n        required: true,\r\n        width: 150,\r\n      },\r\n    ],\r\n    [customerOrVendorOptions, userOptions, documentType]\r\n  );\r\n\r\n  const headerData = useMemo(\r\n    () => [\r\n      {\r\n        invoice_no: billFormData.invoice_no,\r\n        date: billFormData.date,\r\n        customer_id: billFormData.customer_id,\r\n        billed_by_id: billFormData.billed_by_id,\r\n        payment_mode: billFormData.payment_mode,\r\n      },\r\n    ],\r\n    [\r\n      billFormData.invoice_no,\r\n      billFormData.date,\r\n      billFormData.customer_id,\r\n      billFormData.billed_by_id,\r\n      billFormData.payment_mode,\r\n    ]\r\n  );\r\n\r\n  // Column definitions for bill items - memoized to prevent recreation\r\n  const itemColumns: AntdEditableColumn[] = useMemo(\r\n    () => [\r\n      {\r\n        key: 'product_id',\r\n        title: ' PRODUCT',\r\n        dataIndex: 'product_id',\r\n        type: 'product', // triggers modal\r\n        required: true,\r\n        width: 280,\r\n        render: (value, record, index) => {\r\n          const selectedProduct = productOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          // Use product name from record if available (for edit mode), otherwise use selectedProduct label\r\n          const displayName = value\r\n            ? selectedProduct?.label ||\r\n              (record.product_name\r\n                ? `${record.product_name}${record.variant_name ? ` ${record.variant_name}` : ''}`.trim()\r\n                : 'Unknown Product')\r\n            : 'Select product';\r\n          return (\r\n            <Tooltip\r\n              title={\r\n                value\r\n                  ? `Product: ${displayName} - Click to change  F5 to reopen`\r\n                  : 'Click to select product from inventory  F5 to open'\r\n              }\r\n              placement=\"top\"\r\n            >\r\n              <div\r\n                style={{\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: value ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                  backgroundColor: value ? '#f6ffed' : '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                  minHeight: '32px',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                }}\r\n                onClick={() => {\r\n                  // Open product selection modal\r\n                  if (typeof index === 'number') {\r\n                    setProductSelectionRowIndex(index);\r\n                    setLastInteractedRowIndex(index); // Track this row for F5\r\n                    setProductSelectionModalVisible(true);\r\n                  }\r\n                }}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = value\r\n                    ? '#f6ffed'\r\n                    : '#fafafa';\r\n                  e.currentTarget.style.borderColor = value\r\n                    ? '#52c41a'\r\n                    : '#d9d9d9';\r\n                }}\r\n              >\r\n                <span\r\n                  style={{\r\n                    color: value ? '#52c41a' : '#1890ff',\r\n                    fontWeight: value ? 600 : 400,\r\n                  }}\r\n                >\r\n                  {displayName}\r\n                </span>\r\n                {value && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '12px', color: '#52c41a' }}>\r\n                      \r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#52c41a',\r\n                        backgroundColor: '#f6ffed',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Selected\r\n                    </span>\r\n                  </div>\r\n                )}\r\n                {!value && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                      marginTop: '2px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '10px', color: '#ff4d4f' }}>\r\n                       Product required\r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#1890ff',\r\n                        backgroundColor: '#f0f8ff',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Click\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'stock_id',\r\n        title: ' STOCK',\r\n        dataIndex: 'batch_no',\r\n        type: 'stock',\r\n        required: true,\r\n        width: 280,\r\n        editable: true, // allow editing to open modal\r\n        render: (value, record, index) => {\r\n          // Use saved stock data from the item (no need to fetch from API)\r\n          const stockData = (record as any).stockData;\r\n          \r\n          // Calculate available quantities from saved data\r\n          const availablePackQty = stockData?.available_quantity || 0;\r\n          const availableLooseQty = stockData?.available_loose_quantity || 0;\r\n          const packSizeNum = stockData?.pack_size || 1;\r\n\r\n          const isLowStock = availablePackQty > 0 && availablePackQty <= 10;\r\n          const isOutOfStock = availablePackQty === 0;\r\n          \r\n          // Stock data exists if we have saved stock info\r\n          const hasStockData = !!stockData;\r\n\r\n          return (\r\n            <Tooltip\r\n              title={\r\n                record.product_id\r\n                  ? value\r\n                    ? `Stock: ${value} - Packs Available: ${availablePackQty}  Loose Available: ${availableLooseQty}  Pack Size: ${packSizeNum}  Click to change  F7 to reopen`\r\n                    : 'Click to select stock from available inventory  F7 to open'\r\n                  : 'Please select a product first to choose stock  F7 to open after product selection'\r\n              }\r\n              placement=\"top\"\r\n            >\r\n              <div\r\n                style={{\r\n                  cursor: 'pointer',\r\n                  padding: '6px 10px',\r\n                  borderRadius: '6px',\r\n                  border: value ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                  backgroundColor: value ? '#f6ffed' : '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                  minHeight: '32px',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  width: '100%',\r\n                  gap: '10px',\r\n                }}\r\n                onClick={() => {\r\n                  if (record.product_id && typeof index === 'number') {\r\n                    setStockModalRowIndex(index);\r\n                  } else if (!record.product_id) {\r\n                    message.warning('Please select a product first');\r\n                  }\r\n                }}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = value\r\n                    ? '#f6ffed'\r\n                    : '#fafafa';\r\n                  e.currentTarget.style.borderColor = value\r\n                    ? '#52c41a'\r\n                    : '#d9d9d9';\r\n                }}\r\n              >\r\n                {/* Left Section */}\r\n                <div\r\n                  style={{\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: '6px',\r\n                    flex: 1,\r\n                    flexWrap: 'wrap',\r\n                  }}\r\n                >\r\n                  {/* Batch Number */}\r\n                  <span\r\n                    style={{\r\n                      color: value\r\n                        ? '#52c41a'\r\n                        : record.product_id\r\n                          ? '#1890ff'\r\n                          : '#bfbfbf',\r\n                      fontWeight: value ? 700 : 400,\r\n                      fontSize: '12px',\r\n                      whiteSpace: 'nowrap',\r\n                    }}\r\n                  >\r\n                    {value ? ` ${value}` : 'Select Stock'}\r\n                  </span>\r\n\r\n                  {/* Stock Quantities - Show inline with batch */}\r\n                  {hasStockData && value && (\r\n                    <>\r\n                      <span style={{ color: '#d9d9d9', fontSize: '12px' }}>\r\n                        |\r\n                      </span>\r\n                      <span\r\n                        style={{\r\n                          color: isOutOfStock\r\n                            ? '#ff4d4f'\r\n                            : isLowStock\r\n                              ? '#faad14'\r\n                              : '#52c41a',\r\n                          fontWeight: 'bold',\r\n                          backgroundColor: isOutOfStock\r\n                            ? '#fff2f0'\r\n                            : isLowStock\r\n                              ? '#fffbe6'\r\n                              : '#f6ffed',\r\n                          padding: '2px 6px',\r\n                          borderRadius: '4px',\r\n                          border: `1px solid ${\r\n                            isOutOfStock\r\n                              ? '#ffccc7'\r\n                              : isLowStock\r\n                                ? '#ffe58f'\r\n                                : '#b7eb8f'\r\n                          }`,\r\n                          fontSize: '11px',\r\n                          whiteSpace: 'nowrap',\r\n                        }}\r\n                      >\r\n                         A/Q {availablePackQty}\r\n                      </span>\r\n                      <span\r\n                        style={{\r\n                          color: '#722ed1',\r\n                          fontWeight: 'bold',\r\n                          backgroundColor: '#f9f0ff',\r\n                          padding: '2px 6px',\r\n                          borderRadius: '4px',\r\n                          border: '1px solid #d3adf7',\r\n                          fontSize: '11px',\r\n                          whiteSpace: 'nowrap',\r\n                        }}\r\n                      >\r\n                         A/L {availableLooseQty}\r\n                      </span>\r\n                    </>\r\n                  )}\r\n\r\n                  {/* Warning (inline, not breaking row) */}\r\n                  {record.product_id && !value && (\r\n                    <span\r\n                      style={{\r\n                        fontSize: '11px',\r\n                        color: '#ff4d4f',\r\n                        whiteSpace: 'nowrap',\r\n                      }}\r\n                    >\r\n                       Stock required\r\n                    </span>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Right Side \"Click\" Indicator */}\r\n                {record.product_id && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '12px', color: '#1890ff' }}>\r\n                      \r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#52c41a',\r\n                        backgroundColor: '#f6ffed',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Click\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'qty',\r\n        title: ' QTY',\r\n        dataIndex: 'qty',\r\n        type: 'number',\r\n        width: 90,\r\n        render: (value: number, record: any, index?: number) => {\r\n          // Get stock info for validation\r\n          const stockListData = branchId\r\n            ? branchStockListResult\r\n            : stockAuditListResult;\r\n          const stock = stockListData.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const isExceedingStock = value > availablePackQty;\r\n\r\n          return (\r\n            <div style={{ position: 'relative' }}>\r\n              <InputNumber\r\n                value={value}\r\n                min={0}\r\n                max={availablePackQty}\r\n                style={{\r\n                  width: '100%',\r\n                  borderColor: isExceedingStock ? '#ff4d4f' : undefined,\r\n                  backgroundColor: isExceedingStock ? '#fff2f0' : undefined,\r\n                }}\r\n                onPressEnter={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'qty', newValue);\r\n                  }\r\n                }}\r\n                onBlur={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'qty', newValue);\r\n                  }\r\n                }}\r\n                onChange={newValue => {\r\n                  if (newValue !== null && newValue > availablePackQty) {\r\n                    message.error(\r\n                      `Pack quantity cannot exceed available packs (${availablePackQty})`\r\n                    );\r\n                    return;\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'loose_qty',\r\n        title: ' LOOSE',\r\n        dataIndex: 'loose_qty',\r\n        type: 'number',\r\n        width: 90,\r\n        render: (value: number, record: any, index?: number) => {\r\n          // Get stock info for validation\r\n          const stockListData = branchId\r\n            ? branchStockListResult\r\n            : stockAuditListResult;\r\n          const stock = stockListData.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n\r\n          if (!stock) {\r\n            return (\r\n              <div style={{ position: 'relative' }}>\r\n                <InputNumber\r\n                  value={value}\r\n                  min={0}\r\n                  style={{ width: '100%' }}\r\n                  disabled\r\n                />\r\n              </div>\r\n            );\r\n          }\r\n\r\n          // Calculate dynamic max loose quantity based on current QTY selection\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const availableLooseQty = stock?.available_loose_quantity || 0;\r\n\r\n          // Current QTY selection affects max loose quantity\r\n          const currentQty = record.qty || 0;\r\n          const remainingPacks = availablePackQty - currentQty;\r\n          const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n          const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n          const isExceedingStock = value > maxLooseQty;\r\n\r\n          return (\r\n            <div style={{ position: 'relative' }}>\r\n              <InputNumber\r\n                value={value}\r\n                min={0}\r\n                max={maxLooseQty}\r\n                style={{\r\n                  width: '100%',\r\n                  borderColor: isExceedingStock ? '#ff4d4f' : undefined,\r\n                  backgroundColor: isExceedingStock ? '#fff2f0' : undefined,\r\n                }}\r\n                onPressEnter={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'loose_qty', newValue);\r\n                  }\r\n                }}\r\n                onBlur={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'loose_qty', newValue);\r\n                  }\r\n                }}\r\n                onChange={newValue => {\r\n                  if (newValue !== null && newValue > maxLooseQty) {\r\n                    message.error(\r\n                      `Loose quantity cannot exceed available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`\r\n                    );\r\n                    return;\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'price',\r\n        title: ' RATE',\r\n        dataIndex: 'price',\r\n        type: 'number',\r\n        required: true,\r\n        width: 120,\r\n        editable: false, // Make rate not editable\r\n        render: value => (\r\n          <InputNumber value={value} disabled style={{ width: '100%' }} />\r\n        ),\r\n      },\r\n      {\r\n        key: 'amount',\r\n        title: ' AMOUNT',\r\n        dataIndex: 'amount',\r\n        type: 'number',\r\n        editable: false, // Make amount not editable\r\n        width: 130,\r\n        render: value => (\r\n          <InputNumber value={value} disabled style={{ width: '100%' }} />\r\n        ),\r\n      },\r\n    ],\r\n    [\r\n      productOptions,\r\n      branchId,\r\n      branchStockListResult,\r\n      stockAuditListResult,\r\n      handleQuantityChange,\r\n    ]\r\n  );\r\n\r\n  // Find the column index for qty\r\n  const qtyColIndex = itemColumns.findIndex(\r\n    col => col.key === 'qty' || col.dataIndex === 'qty'\r\n  );\r\n\r\n  // Calculate bill totals\r\n  const billCalculations = useMemo(() => {\r\n    if (!billFormData.items.length)\r\n      return {\r\n        sub_total: 0,\r\n        value_of_goods: 0,\r\n        total_gst: 0,\r\n        cgst: 0,\r\n        sgst: 0,\r\n        total_amount: 0,\r\n        discountValue: 0,\r\n      };\r\n\r\n    return calculateBillTotals({\r\n      items: billFormData.items,\r\n      productList: productListResult,\r\n      isGstIncluded: billSettings.isGstIncluded,\r\n      discount: billSettings.discount,\r\n      discountType: billSettings.discountType,\r\n    });\r\n  }, [billFormData.items, productListResult, billSettings]);\r\n\r\n  // Handle header changes - memoized to prevent unnecessary re-renders\r\n  const handleHeaderChange = useCallback(\r\n    (headerRows: any[]) => {\r\n      const updatedHeader = headerRows[0];\r\n      if (updatedHeader) {\r\n        // Find customer name for display\r\n        const customer = customerListResult.find(\r\n          (c: any) => c._id === updatedHeader.customer_id\r\n        );\r\n        // Find user name for display\r\n        const user = userListResult.find(\r\n          (u: any) => u._id === updatedHeader.billed_by_id\r\n        );\r\n        setBillFormData(prev => ({\r\n          ...prev,\r\n          invoice_no: updatedHeader.invoice_no || '',\r\n          date: updatedHeader.date || dayjs().format('YYYY-MM-DD'),\r\n          customer_id: updatedHeader.customer_id || '',\r\n          customer_name: customer?.full_name || '',\r\n          billed_by_id: updatedHeader.billed_by_id || '',\r\n          billed_by_name: user?.name || '',\r\n          payment_mode: updatedHeader.payment_mode || 'cash',\r\n        }));\r\n      }\r\n    },\r\n    [customerListResult, userListResult]\r\n  );\r\n\r\n  // Handle item changes - memoized to prevent unnecessary re-renders\r\n  const handleItemsChange = useCallback(\r\n    (items: any[]) => {\r\n      // Convert back to BillItem format and auto-populate stock\r\n      const billItems: BillItem[] = items.map(item => {\r\n        const billItem: BillItem = {\r\n          product_id: item.product_id || '',\r\n          product_name:\r\n            productOptions.find(\r\n              (opt: { label: string; value: string }) =>\r\n                opt.value === item.product_id\r\n            )?.label || '',\r\n          variant_name: item.variant_name || '',\r\n          stock_id: item.stock_id || '',\r\n          batch_no: item.batch_no || '', //  Preserve batch_no from input\r\n          qty: item.qty || 0,\r\n          loose_qty: item.loose_qty || 0,\r\n          price: item.price || 0,\r\n          mrp: item.mrp || 0,\r\n          amount: item.amount || 0,\r\n          tax_percentage: item.tax_percentage || 0,\r\n          stockData: item.stockData, //  Preserve stockData for displaying quantities\r\n        };\r\n\r\n        // Stock validation for pack and loose quantities\r\n        if (item.stock_id && (item.qty || item.loose_qty)) {\r\n          const stockListData = branchId\r\n            ? branchStockListResult\r\n            : stockAuditListResult;\r\n          const stock = stockListData.find((s: any) => s._id === item.stock_id);\r\n\r\n          if (stock) {\r\n            // Get pack size from stock data\r\n            const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n            const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n            // Available pack quantity and actual loose quantity\r\n            const availablePackQty = stock.available_quantity || 0;\r\n            const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n            // Validate pack quantity (QTY field)\r\n            if (item.qty && item.qty > availablePackQty) {\r\n              message.error(\r\n                `Pack quantity (${item.qty}) exceeds available packs (${availablePackQty})`\r\n              );\r\n              billItem.qty = availablePackQty;\r\n            }\r\n\r\n            // Calculate max loose quantity based on remaining packs after QTY selection\r\n            const remainingPacks = availablePackQty - (item.qty || 0);\r\n            const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n            const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n            // Validate loose quantity (LOOSE QTY field)\r\n            if (item.loose_qty && item.loose_qty > maxLooseQty) {\r\n              message.error(\r\n                `Loose quantity (${item.loose_qty}) exceeds available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`\r\n              );\r\n              billItem.loose_qty = maxLooseQty;\r\n            }\r\n          }\r\n        }\r\n\r\n        // Auto-populate stock if product is selected but stock is not\r\n        if (item.product_id && !item.stock_id) {\r\n          const stockListData = branchId\r\n            ? branchStockListResult\r\n            : stockAuditListResult;\r\n          const availableStocks = stockListData.filter(\r\n            (stock: any) =>\r\n              stock.product === item.product_id ||\r\n              stock.ProductItem?._id === item.product_id\r\n          );\r\n\r\n          if (availableStocks.length > 0) {\r\n            const firstStock = availableStocks[0];\r\n            billItem.stock_id = firstStock._id;\r\n            billItem.batch_no = firstStock.batch_no || '';\r\n\r\n            // Auto-focus quantity field after auto-selecting stock\r\n            setTimeout(() => {\r\n              const qtyCell = document.querySelector(\r\n                `td[data-row-key=\"${item.key}\"][data-column-key=\"qty\"]`\r\n              ) as HTMLElement;\r\n              if (qtyCell) {\r\n                qtyCell.focus();\r\n              }\r\n            }, 300);\r\n          }\r\n        }\r\n\r\n        return billItem;\r\n      });\r\n      // Update items with calculated amounts\r\n      const updatedItems = billItems.map(item => {\r\n        if (!item.product_id || !item.stock_id) return item;\r\n\r\n        // Get stock info\r\n        const stockListData = branchId\r\n          ? branchStockListResult\r\n          : stockAuditListResult;\r\n        const stock = stockListData.find((s: any) => s._id === item.stock_id);\r\n\r\n        if (stock) {\r\n          const sellPrice = stock.sell_price || 0;\r\n          // Get pack size from stock data\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n          // Calculate loose item rate: sell_price / pack_size (since sell_price is per pack)\r\n          const looseRate = sellPrice / packSizeNum;\r\n\r\n          const baseAmount =\r\n            (item.qty || 0) * sellPrice + (item.loose_qty || 0) * looseRate;\r\n\r\n          // Get product for tax calculation\r\n          const product = productListResult.find(\r\n            (p: any) => p._id === item.product_id\r\n          );\r\n          const taxPercentage = product?.CategoryItem?.tax_percentage || 0;\r\n\r\n          let amount = baseAmount;\r\n          if (!billSettings.isGstIncluded) {\r\n            amount = baseAmount + (baseAmount * taxPercentage) / 100;\r\n          }\r\n\r\n          return {\r\n            ...item,\r\n            price: item.price || sellPrice,\r\n            mrp: stock.mrp || sellPrice,\r\n            amount: amount,\r\n            tax_percentage: taxPercentage,\r\n            product_name: product?.name || '',\r\n            variant_name: product?.VariantItem?.variant_name || '',\r\n            batch_no: stock.batch_no || '',\r\n          };\r\n        }\r\n\r\n        return item;\r\n      });\r\n\r\n      setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n    },\r\n    [\r\n      productOptions,\r\n      branchId,\r\n      branchStockListResult,\r\n      stockAuditListResult,\r\n      productListResult,\r\n      billSettings,\r\n    ]\r\n  );\r\n\r\n  const handleProductSelect = useCallback(\r\n    (product: any, rowIndex: number) => {\r\n      // Validate rowIndex bounds\r\n      if (rowIndex < 0 || rowIndex >= billFormData.items.length) {\r\n        console.error(\r\n          `Invalid rowIndex: ${rowIndex}. Items length: ${billFormData.items.length}`\r\n        );\r\n        message.error(`Invalid row index: ${rowIndex}. Please try again.`);\r\n        return;\r\n      }\r\n\r\n      const newItems = [...billFormData.items];\r\n\r\n      // Double-check the item exists before modifying\r\n      if (!newItems[rowIndex]) {\r\n        console.error(\r\n          `Item at index ${rowIndex} is undefined. Items length: ${newItems.length}`\r\n        );\r\n        message.error('Selected row is no longer valid. Please try again.');\r\n        return;\r\n      }\r\n\r\n      // Robustly set product_id from product.id or product._id\r\n      newItems[rowIndex].product_id = product.id || product._id || '';\r\n      newItems[rowIndex].product_name = product.name || '';\r\n      newItems[rowIndex].price = product.selling_price || 0;\r\n      handleItemsChange(newItems);\r\n      setStockModalRowIndex(rowIndex); // Open stock modal for this row\r\n    },\r\n    [handleItemsChange, billFormData.items.length]\r\n  );\r\n\r\n  const handleF5ProductSelection = () => {\r\n    // First, check if stock modal is open and close it\r\n    if (stockModalRowIndex !== null) {\r\n      setStockModalRowIndex(null);\r\n      message.info('Stock modal closed. Opening product selection...');\r\n\r\n      // Wait a bit for the stock modal to close before opening product modal\r\n      setTimeout(() => {\r\n        openProductModalForRow();\r\n      }, 100);\r\n      return;\r\n    }\r\n\r\n    // If stock modal is not open, proceed with normal F5 behavior\r\n    openProductModalForRow();\r\n  };\r\n\r\n  const openProductModalForRow = () => {\r\n    let targetRowIndex = -1;\r\n\r\n    // Check what element is currently focused\r\n    const activeElement = document.activeElement as HTMLElement;\r\n\r\n    // First, check if there's a currently focused row in the table\r\n    const focusedRow = activeElement?.closest('tr');\r\n\r\n    if (focusedRow) {\r\n      const rowIndex = focusedRow.getAttribute('data-row-key');\r\n\r\n      if (rowIndex !== null) {\r\n        targetRowIndex = parseInt(rowIndex);\r\n      }\r\n    } else {\r\n      // Try alternative method: look for any focused cell in the table\r\n      const focusedCell = activeElement?.closest('td');\r\n      if (focusedCell) {\r\n        const row = focusedCell.closest('tr');\r\n        if (row) {\r\n          const rowIndex = row.getAttribute('data-row-key');\r\n          if (rowIndex !== null) {\r\n            targetRowIndex = parseInt(rowIndex);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // If no focused row found, try using the externally editing cell row\r\n    if (targetRowIndex === -1 && externalEditingCell) {\r\n      targetRowIndex = externalEditingCell.row;\r\n    }\r\n\r\n    // If still no target, try using the last interacted row\r\n    if (targetRowIndex === -1) {\r\n      if (lastInteractedRowIndex < billFormData.items.length) {\r\n        targetRowIndex = lastInteractedRowIndex;\r\n      }\r\n    }\r\n\r\n    // If still no target, find the first row without a product\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(item => !item.product_id);\r\n    }\r\n\r\n    // If still no target row, add a new item and target that\r\n    if (targetRowIndex === -1) {\r\n      handleAddItem();\r\n      targetRowIndex = billFormData.items.length;\r\n    }\r\n\r\n    // Set the target row for product selection\r\n    setProductSelectionRowIndex(targetRowIndex);\r\n    setProductSelectionModalVisible(true);\r\n\r\n    message.info(`Opening product selection for row ${targetRowIndex + 1}`);\r\n  };\r\n\r\n  // Helper function to auto-open product modal (used after bill creation)\r\n  const autoOpenProductModal = useCallback(() => {\r\n    setProductSelectionRowIndex(0); // Target the first row\r\n    setProductSelectionModalVisible(true);\r\n    message.success(\r\n      ' Bill saved! Ready for next bill - Select product to continue.',\r\n      4\r\n    );\r\n  }, []);\r\n\r\n  const handleF7StockSelection = () => {\r\n    // Find the first row that has a product but needs stock or the currently focused row\r\n    let targetRowIndex = -1;\r\n\r\n    // First, check if there's a currently focused row in the table\r\n    const activeElement = document.activeElement as HTMLElement;\r\n    const focusedRow = activeElement?.closest('tr');\r\n    if (focusedRow) {\r\n      const rowIndex = focusedRow.getAttribute('data-row-key');\r\n      if (rowIndex !== null) {\r\n        const rowIndexNum = parseInt(rowIndex);\r\n        // Check if the focused row has a product\r\n        if (billFormData.items[rowIndexNum]?.product_id) {\r\n          targetRowIndex = rowIndexNum;\r\n        }\r\n      }\r\n    }\r\n\r\n    // If no focused row with product found, find the first row with product but without stock\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(\r\n        item => item.product_id && !item.stock_id\r\n      );\r\n    }\r\n\r\n    // If still no target row, find the first row with product (even if it has stock)\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(item => item.product_id);\r\n    }\r\n\r\n    // If no row with product found, show message\r\n    if (targetRowIndex === -1) {\r\n      message.warning('Please select a product first before selecting stock');\r\n      return;\r\n    }\r\n\r\n    // Set the target row for stock selection\r\n    setStockModalRowIndex(targetRowIndex);\r\n\r\n    message.info(`Opening stock selection for row ${targetRowIndex + 1}`);\r\n  };\r\n\r\n  const handleProductSelectionModalSelect = (product: any) => {\r\n    if (productSelectionRowIndex === null) return;\r\n\r\n    // Validate productSelectionRowIndex bounds\r\n    if (\r\n      productSelectionRowIndex < 0 ||\r\n      productSelectionRowIndex >= billFormData.items.length\r\n    ) {\r\n      console.error(\r\n        `Invalid productSelectionRowIndex: ${productSelectionRowIndex}. Items length: ${billFormData.items.length}`\r\n      );\r\n      message.error(\r\n        `Invalid row index: ${productSelectionRowIndex}. Please try again.`\r\n      );\r\n      setProductSelectionRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    const newItems = [...billFormData.items];\r\n\r\n    // Double-check the item exists before modifying\r\n    if (!newItems[productSelectionRowIndex]) {\r\n      console.error(\r\n        `Item at index ${productSelectionRowIndex} is undefined. Items length: ${newItems.length}`\r\n      );\r\n      message.error('Selected row is no longer valid. Please try again.');\r\n      setProductSelectionRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    newItems[productSelectionRowIndex].product_id = product._id || '';\r\n    newItems[productSelectionRowIndex].product_name = product.name || '';\r\n    newItems[productSelectionRowIndex].variant_name =\r\n      product.VariantItem?.variant_name || '';\r\n    newItems[productSelectionRowIndex].price = product.selling_price || 0;\r\n\r\n    handleItemsChange(newItems);\r\n\r\n    // Close the product selection modal\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n\r\n    // Open stock selection modal for this row\r\n    setStockModalRowIndex(productSelectionRowIndex);\r\n\r\n    message.success(`Product \"${product.name}\" selected successfully!`);\r\n  };\r\n\r\n  const handleStockSelect = (stock: any) => {\r\n    if (stockModalRowIndex === null) return;\r\n\r\n    // Validate stockModalRowIndex bounds\r\n    if (\r\n      stockModalRowIndex < 0 ||\r\n      stockModalRowIndex >= billFormData.items.length\r\n    ) {\r\n      console.error(\r\n        `Invalid stockModalRowIndex: ${stockModalRowIndex}. Items length: ${billFormData.items.length}`\r\n      );\r\n      message.error(\r\n        `Invalid row index: ${stockModalRowIndex}. Please try again.`\r\n      );\r\n      setStockModalRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    const newItems = [...billFormData.items];\r\n\r\n    // Double-check the item exists before modifying\r\n    if (!newItems[stockModalRowIndex]) {\r\n      console.error(\r\n        `Item at index ${stockModalRowIndex} is undefined. Items length: ${newItems.length}`\r\n      );\r\n      message.error('Selected row is no longer valid. Please try again.');\r\n      setStockModalRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    // Save stock ID and batch number\r\n    newItems[stockModalRowIndex].stock_id =\r\n      stock.id || stock._id || stock.invoice_id || '';\r\n    newItems[stockModalRowIndex].batch_no = stock.batch_no || '';\r\n    \r\n    // Save complete stock data for displaying quantities\r\n    // Stock object comes directly from StockSelectionModal with all properties\r\n    const savedStockData = {\r\n      available_quantity: stock.available_quantity || 0,\r\n      available_loose_quantity: stock.available_loose_quantity || 0,\r\n      batch_no: stock.batch_no || stock.name || '',\r\n      pack_size: stock.ProductItem?.VariantItem?.pack_size || 1,\r\n    };\r\n    \r\n    newItems[stockModalRowIndex] = {\r\n      ...newItems[stockModalRowIndex],\r\n      stockData: savedStockData,\r\n    };\r\n    \r\n    handleItemsChange(newItems);\r\n    setStockModalRowIndex(null); // Close stock modal\r\n\r\n    // Set external editing cell to qty cell in the same row\r\n    if (qtyColIndex !== -1) {\r\n      setExternalEditingCell({ row: stockModalRowIndex, col: qtyColIndex });\r\n    }\r\n  };\r\n\r\n  // Handle customer selection from modal\r\n  const handleCustomerSelect = useCallback(\r\n    (customer: any) => {\r\n      // Prevent duplicate calls\r\n      if (billFormData.customer_id === customer._id) {\r\n        return;\r\n      }\r\n\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        customer_id: customer._id,\r\n        customer_name: customer.full_name,\r\n      }));\r\n\r\n      // Ensure modal closes\r\n      setTimeout(() => {\r\n        setCustomerModalVisible(false);\r\n        // Auto-open user selection modal after customer is selected\r\n        setTimeout(() => {\r\n          setUserModalVisible(true);\r\n        }, 100);\r\n      }, 50);\r\n\r\n      message.success(\r\n        `Customer \"${customer.full_name}\" selected successfully!`\r\n      );\r\n    },\r\n    [billFormData.customer_id]\r\n  );\r\n\r\n  // Handle vendor selection from modal\r\n  const handleVendorSelect = useCallback(\r\n    (vendor: any) => {\r\n      // Prevent duplicate calls\r\n      if (billFormData.customer_id === vendor._id) {\r\n        return;\r\n      }\r\n\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        customer_id: vendor._id,\r\n        customer_name: vendor.vendor_name,\r\n      }));\r\n\r\n      // Ensure modal closes\r\n      setTimeout(() => {\r\n        setCustomerModalVisible(false);\r\n        // Auto-open user selection modal after vendor is selected\r\n        setTimeout(() => {\r\n          setUserModalVisible(true);\r\n        }, 100);\r\n      }, 50);\r\n\r\n      message.success(`Vendor \"${vendor.vendor_name}\" selected successfully!`);\r\n    },\r\n    [billFormData.customer_id]\r\n  );\r\n\r\n  // Handle user selection from modal\r\n  const handleUserSelect = useCallback(\r\n    (user: any) => {\r\n      // Prevent duplicate calls\r\n      if (billFormData.billed_by_id === user._id) {\r\n        return;\r\n      }\r\n\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        billed_by_id: user._id,\r\n        billed_by_name: user.name,\r\n      }));\r\n\r\n      // Ensure modal closes\r\n      setTimeout(() => {\r\n        setUserModalVisible(false);\r\n      }, 50);\r\n\r\n      message.success(\r\n        `User \"${user.name}\" selected as billed by successfully!`\r\n      );\r\n    },\r\n    [billFormData.billed_by_id]\r\n  );\r\n\r\n  // Handle new bill creation\r\n  const handleNewBill = () => {\r\n    resetBill(false); // Don't show resetBill message\r\n    setSaveConfirmationVisible(false);\r\n    setSavedBillData(null);\r\n    message.success('New bill form cleared successfully!');\r\n  };\r\n\r\n  // Reset bill function - comprehensive reset for after successful save\r\n  const resetBill = useCallback((showMessage = true) => {\r\n    // Clear all form data for new bill\r\n    setBillFormData({\r\n      invoice_no: '',\r\n      date: dayjs().format('YYYY-MM-DD'),\r\n      customer_id: '',\r\n      customer_name: '',\r\n      payment_mode: 'cash',\r\n      items: [\r\n        {\r\n          product_id: '',\r\n          product_name: '',\r\n          variant_name: '',\r\n          stock_id: '',\r\n          batch_no: '',\r\n          qty: 0,\r\n          loose_qty: 0,\r\n          price: 0,\r\n          mrp: 0,\r\n          amount: 0,\r\n          tax_percentage: 0,\r\n        },\r\n      ],\r\n    });\r\n\r\n    // Reset bill settings to defaults\r\n    setBillSettings({\r\n      isPaid: true,\r\n      isPartiallyPaid: false,\r\n      isRetail: true,\r\n      isGstIncluded: true,\r\n      discount: 0,\r\n      discountType: 'percentage',\r\n      paidAmount: 0,\r\n    });\r\n\r\n    // Reset document type to default\r\n    setDocumentType('bill');\r\n\r\n    // Reset all modal states\r\n    setStockModalRowIndex(null);\r\n    setExternalEditingCell(null);\r\n    setCustomerModalVisible(false);\r\n    setSaveConfirmationVisible(false);\r\n    setBillListDrawerVisible(false);\r\n    setSavedBillData(null);\r\n    setProductDetailsModalVisible(false);\r\n    setSelectedProductId('');\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n    refetchInvoiceNo();\r\n    // Only show message if explicitly requested (not during auto-reset after bill creation)\r\n    if (showMessage) {\r\n      message.success('Ready for next bill!', 2);\r\n    }\r\n  }, []);\r\n\r\n  // Handle continue with current bill\r\n  const handleContinueBill = () => {\r\n    setSaveConfirmationVisible(false);\r\n    setSavedBillData(null);\r\n  };\r\n\r\n  // Handle clear bill form\r\n  const handleClearBill = () => {\r\n    resetBill(false); // Don't show resetBill message\r\n    message.success('Bill form cleared successfully!');\r\n  };\r\n\r\n  // Handle view bill from drawer\r\n  const handleViewBill = (bill: any) => {\r\n    if (!bill) {\r\n      message.error('No bill data received');\r\n      return;\r\n    }\r\n\r\n    // Ensure we have the latest data loaded\r\n    refetchProducts();\r\n    refetchCustomers();\r\n    if (branchId) {\r\n      refetchBranchStock();\r\n    } else {\r\n      refetchStockAudit();\r\n    }\r\n\r\n    // Force immediate data loading if not already loaded\r\n    if (productListResult.length === 0) {\r\n      refetchProducts();\r\n    }\r\n\r\n    if (customerListResult.length === 0) {\r\n      refetchCustomers();\r\n    }\r\n\r\n    const currentStockListData = branchId\r\n      ? branchStockListResult\r\n      : stockAuditListResult;\r\n    if (currentStockListData.length === 0) {\r\n      if (branchId) {\r\n        refetchBranchStock();\r\n      } else {\r\n        refetchStockAudit();\r\n      }\r\n    }\r\n\r\n    // Handle different possible data structures for items\r\n    let items = [];\r\n    if (bill.Items && Array.isArray(bill.Items)) {\r\n      items = bill.Items;\r\n    } else if (bill.items && Array.isArray(bill.items)) {\r\n      items = bill.items;\r\n    } else if (bill.sales_items && Array.isArray(bill.sales_items)) {\r\n      items = bill.sales_items;\r\n    } else if (\r\n      bill.result &&\r\n      bill.result.Items &&\r\n      Array.isArray(bill.result.Items)\r\n    ) {\r\n      items = bill.result.Items;\r\n    } else if (\r\n      bill.result &&\r\n      bill.result.items &&\r\n      Array.isArray(bill.result.items)\r\n    ) {\r\n      items = bill.result.items;\r\n    }\r\n\r\n    // Map items with proper fallbacks and enhanced product name resolution\r\n    const mappedItems = items.map((item: any, index: number) => {\r\n      // Try to get the best product name from various sources\r\n      let productName = '';\r\n      let variantName = '';\r\n\r\n      if (item.productItems?.name) {\r\n        productName = item.productItems.name;\r\n        variantName = item.productItems.VariantItem?.variant_name || '';\r\n      } else if (item.product_name) {\r\n        productName = item.product_name;\r\n        variantName = item.variant_name || '';\r\n      } else if (item.product?.name) {\r\n        productName = item.product.name;\r\n        variantName = item.product.VariantItem?.variant_name || '';\r\n      } else if (item.product_id) {\r\n        // Try to find product name from productList if available\r\n        const product = productListResult.find(\r\n          (p: any) => p._id === item.product_id\r\n        );\r\n        if (product) {\r\n          productName = product.name;\r\n          variantName = product.VariantItem?.variant_name || '';\r\n        } else {\r\n          // If product list is not loaded yet, try to load it and mark for later update\r\n          if (productListResult.length === 0) {\r\n            refetchProducts();\r\n          }\r\n          // Use a more descriptive placeholder that will be updated later\r\n          productName = `Loading... (ID: ${item.product_id})`;\r\n\r\n          // Try to force load and resolve immediately\r\n          setTimeout(() => {\r\n            if (productListResult.length > 0) {\r\n              const foundProduct = productListResult.find(\r\n                (p: any) => p._id === item.product_id\r\n              );\r\n              if (foundProduct) {\r\n                // Update the item directly\r\n                const updatedItems = [...billFormData.items];\r\n                const itemIndex = updatedItems.findIndex(\r\n                  i => i.product_id === item.product_id\r\n                );\r\n                if (itemIndex !== -1) {\r\n                  updatedItems[itemIndex].product_name = foundProduct.name;\r\n                  updatedItems[itemIndex].variant_name =\r\n                    foundProduct.VariantItem?.variant_name || '';\r\n                  setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n                }\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n      }\r\n\r\n      // Handle stock information with proper fallbacks\r\n      let stockId = '';\r\n      let batchNo = '';\r\n\r\n      if (item.stock_id) {\r\n        stockId = item.stock_id;\r\n        batchNo = item.batch_no || '';\r\n      } else if (item.branch_stock_id) {\r\n        stockId = item.branch_stock_id;\r\n        batchNo = item.batch_no || '';\r\n      } else if (item.stock) {\r\n        stockId = item.stock;\r\n        batchNo = item.batch_no || '';\r\n      }\r\n\r\n      // If we have stock_id but no batch_no, try to find it from stock list\r\n      if (stockId && !batchNo) {\r\n        const stockList = branchId ? branchStockList : stockAuditList;\r\n        const stock = (stockList as any)?.result?.find(\r\n          (s: any) => s._id === stockId\r\n        );\r\n        if (stock) {\r\n          batchNo = stock.batch_no || '';\r\n        } else {\r\n          // If stock list is not loaded yet, mark for later update\r\n          if (!(stockList as any)?.result) {\r\n            if (branchId) {\r\n              refetchBranchStock();\r\n            } else {\r\n              refetchStockAudit();\r\n            }\r\n          }\r\n          batchNo = `Loading... (Stock: ${stockId})`;\r\n\r\n          // Try to force load and resolve immediately\r\n          setTimeout(() => {\r\n            const currentStockList = branchId\r\n              ? branchStockList\r\n              : stockAuditList;\r\n            if ((currentStockList as any)?.result) {\r\n              const foundStock = (currentStockList as any).result.find(\r\n                (s: any) => s._id === stockId\r\n              );\r\n              if (foundStock) {\r\n                // Update the item directly\r\n                const updatedItems = [...billFormData.items];\r\n                const itemIndex = updatedItems.findIndex(\r\n                  i => i.stock_id === stockId\r\n                );\r\n                if (itemIndex !== -1) {\r\n                  updatedItems[itemIndex].batch_no = foundStock.batch_no || '';\r\n                  setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n                }\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n      }\r\n\r\n      const mappedItem = {\r\n        _id: item._id || '',\r\n        product_id: item.product_id || item.product || '',\r\n        product_name: productName,\r\n        variant_name: variantName,\r\n        stock_id: stockId,\r\n        batch_no: batchNo,\r\n        qty: item.qty || 0,\r\n        loose_qty: item.loose_qty || 0,\r\n        price: item.price || 0,\r\n        mrp: item.mrp || item.price || 0,\r\n        amount: item.amount || 0,\r\n        tax_percentage: item.tax_percentage || 0,\r\n      };\r\n\r\n      return mappedItem;\r\n    });\r\n\r\n    // Handle customer information with fallbacks\r\n    const customerId = bill.customer_id || '';\r\n    let customerName = '';\r\n\r\n    if (bill.customerDetails?.full_name) {\r\n      customerName = bill.customerDetails.full_name;\r\n    } else if (bill.customer_name) {\r\n      customerName = bill.customer_name;\r\n    } else if (bill.customer?.full_name) {\r\n      customerName = bill.customer.full_name;\r\n    } else if (bill.customer_id) {\r\n      // Try to find customer name from customerList if available\r\n      const customer = customerList?.result?.find(\r\n        (c: any) => c._id === bill.customer_id\r\n      );\r\n      customerName = customer?.full_name || `Customer ID: ${bill.customer_id}`;\r\n    }\r\n\r\n    // Handle date with fallback\r\n    let formattedDate = dayjs().format('YYYY-MM-DD'); // Default to today\r\n    if (bill.date) {\r\n      try {\r\n        formattedDate = dayjs(bill.date).format('YYYY-MM-DD');\r\n      } catch (error) {\r\n        formattedDate = dayjs().format('YYYY-MM-DD');\r\n      }\r\n    }\r\n\r\n    // Immediately resolve any available product names and stock info if data is already loaded\r\n    let finalMappedItems = [...mappedItems];\r\n\r\n    // If product list is already loaded, resolve product names immediately\r\n    if (productListResult.length > 0) {\r\n      finalMappedItems = finalMappedItems.map(item => {\r\n        if (\r\n          item.product_id &&\r\n          (item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:'))\r\n        ) {\r\n          const product = productListResult.find(\r\n            (p: any) => p._id === item.product_id\r\n          );\r\n          if (product) {\r\n            return {\r\n              ...item,\r\n              product_name: product.name,\r\n              variant_name: product.VariantItem?.variant_name || '',\r\n            };\r\n          }\r\n        }\r\n        return item;\r\n      });\r\n    }\r\n\r\n    // If stock list is already loaded, resolve batch numbers immediately\r\n    const stockListData = branchId\r\n      ? branchStockListResult\r\n      : stockAuditListResult;\r\n    if (stockListData.length > 0) {\r\n      finalMappedItems = finalMappedItems.map(item => {\r\n        if (\r\n          item.stock_id &&\r\n          (item.batch_no.includes('Loading...') || !item.batch_no)\r\n        ) {\r\n          const stock = stockListData.find((s: any) => s._id === item.stock_id);\r\n          if (stock) {\r\n            return {\r\n              ...item,\r\n              batch_no: stock.batch_no || '',\r\n            };\r\n          }\r\n        }\r\n        return item;\r\n      });\r\n    }\r\n\r\n    // Load bill data into form with resolved items\r\n    setBillFormData({\r\n      invoice_no: bill.invoice_no || '',\r\n      date: formattedDate,\r\n      customer_id: customerId,\r\n      customer_name: customerName,\r\n      payment_mode: bill.payment_mode || 'cash',\r\n      items: finalMappedItems,\r\n    });\r\n\r\n    // Load bill settings with proper fallbacks\r\n    setBillSettings({\r\n      isPaid: bill.is_paid ?? true,\r\n      isPartiallyPaid: bill.is_partially_paid ?? false,\r\n      isRetail: bill.sale_type === 'retail' || bill.sale_type === undefined,\r\n      isGstIncluded: bill.is_gst_included ?? true,\r\n      discount: bill.discount || 0,\r\n      discountType: bill.discount_type || 'percentage',\r\n      paidAmount: bill.paid_amount || 0,\r\n    });\r\n\r\n    // Show success message\r\n    message.success(`Bill \"${bill.invoice_no}\" loaded successfully!`);\r\n\r\n    // Force immediate resolution after a short delay to catch any data that loads asynchronously\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 100);\r\n\r\n    // Add a more aggressive resolution approach\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 500);\r\n\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 1000);\r\n  };\r\n\r\n  // Force resolve product names and stock information\r\n  const forceResolveProductNamesAndStock = () => {\r\n    if (billFormData.items.length === 0) return;\r\n\r\n    let hasChanges = false;\r\n    const updatedItems = billFormData.items.map(item => {\r\n      let updated = false;\r\n\r\n      // Resolve product names\r\n      if (item.product_id && productListResult.length > 0) {\r\n        const product = productListResult.find(\r\n          (p: any) => p._id === item.product_id\r\n        );\r\n        if (\r\n          product &&\r\n          (item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:') ||\r\n            !item.product_name)\r\n        ) {\r\n          item.product_name = product.name;\r\n          item.variant_name = product.VariantItem?.variant_name || '';\r\n          updated = true;\r\n        }\r\n      }\r\n\r\n      // Resolve stock batch numbers\r\n      if (item.stock_id) {\r\n        const stockListData = branchId\r\n          ? branchStockListResult\r\n          : stockAuditListResult;\r\n        if (stockListData.length > 0) {\r\n          const stock = stockListData.find((s: any) => s._id === item.stock_id);\r\n          if (\r\n            stock &&\r\n            (item.batch_no?.includes('Loading...') || !item.batch_no)\r\n          ) {\r\n            item.batch_no = stock.batch_no || '';\r\n            updated = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (updated) hasChanges = true;\r\n      return item;\r\n    });\r\n\r\n    if (hasChanges) {\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        items: updatedItems,\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Handle item addition\r\n  const handleAddItem = () => {\r\n    const newItem: BillItem = {\r\n      product_id: '',\r\n      product_name: '',\r\n      variant_name: '',\r\n      stock_id: '',\r\n      batch_no: '',\r\n      qty: 0,\r\n      loose_qty: 0,\r\n      price: 0,\r\n      mrp: 0,\r\n      amount: 0,\r\n      tax_percentage: 0,\r\n    };\r\n\r\n    setBillFormData(prev => ({\r\n      ...prev,\r\n      items: [...prev.items, newItem],\r\n    }));\r\n  };\r\n\r\n  // Handle item deletion\r\n  const handleDeleteItems = (indices: number[]) => {\r\n    setBillFormData(prev => {\r\n      const newItems = prev.items.filter(\r\n        (_, index: any) => !indices.includes(index?.toString())\r\n      );\r\n      return {\r\n        ...prev,\r\n        items: newItems,\r\n      };\r\n    });\r\n  };\r\n\r\n  // Handle save draft (validation: invoice_no and at least one product/item required)\r\n  const handleSaveDraft = async () => {\r\n    // Validation for draft: invoice_no required\r\n    if (!billFormData.invoice_no) {\r\n      message.error('Please enter an invoice number');\r\n      return;\r\n    }\r\n\r\n    // Check if at least one item exists in the items array\r\n    if (!billFormData.items || billFormData.items.length === 0) {\r\n      message.error('Please add at least one product/item to save as draft');\r\n      return;\r\n    }\r\n\r\n    // Filter out empty items (items without product_id)\r\n    const validItems = billFormData.items.filter(item => item.product_id);\r\n\r\n    // At least one item with product_id must be present\r\n    if (validItems.length === 0) {\r\n      message.error('Please add at least one product/item to save as draft');\r\n      return;\r\n    }\r\n\r\n    const payload = {\r\n      invoice_no: billFormData.invoice_no,\r\n      date: billFormData.date || dayjs().format('YYYY-MM-DD'),\r\n      ...(documentType === 'invoice'\r\n        ? { vendor_id: billFormData.customer_id || null }\r\n        : { customer_id: billFormData.customer_id || null }),\r\n      billed_by_id: billFormData.billed_by_id || null, // Not required for draft\r\n      payment_mode: billFormData.payment_mode || 'cash',\r\n      items: billFormData.items.map(item => ({\r\n        product_id: item.product_id || null,\r\n        stock_id: item.stock_id || null,\r\n        ...(branchId && item.stock_id && { branch_stock_id: item.stock_id }),\r\n        qty: item.qty || 0,\r\n        loose_qty: item.loose_qty || 0,\r\n        price: item.price || 0,\r\n        mrp: item.mrp || 0,\r\n        amount: item.amount || 0,\r\n        tax_percentage: item.tax_percentage || 0,\r\n        _id: item._id,\r\n      })),\r\n      ...billCalculations,\r\n      discount: billSettings.discount,\r\n      discount_type: billSettings.discountType,\r\n      is_paid: billSettings.isPaid,\r\n      is_partially_paid: billSettings.isPartiallyPaid,\r\n      sale_type: billSettings.isRetail ? 'retail' : 'wholesale',\r\n      is_gst_included: billSettings.isGstIncluded,\r\n      paid_amount: billSettings.isPartiallyPaid\r\n        ? billSettings.paidAmount\r\n        : billSettings.isPaid\r\n          ? billCalculations.total_amount\r\n          : 0,\r\n      status: 'draft', // Mark as draft\r\n      document_type: documentType, // Save document type (bill or invoice)\r\n    };\r\n\r\n    try {\r\n      let response: any;\r\n      if (billdata) {\r\n        const result = await updateSalesRecord(billdata._id, payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setUpdateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      } else {\r\n        const result = await createSalesRecord(payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setCreateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      }\r\n\r\n      if (response?.statusCode === 200) {\r\n        message.success('Draft saved successfully!');\r\n        const savedData = {\r\n          ...payload,\r\n          customer_name: billFormData.customer_name,\r\n          total_amount: billCalculations.total_amount,\r\n          invoice_no: payload.invoice_no,\r\n          date: payload.date,\r\n        };\r\n        setSavedBillData(savedData);\r\n\r\n        // Don't invalidate stock for drafts - they don't affect inventory\r\n        // Only show confirmation modal for bill updates, not new bills\r\n        if (billdata) {\r\n          setSaveConfirmationVisible(true);\r\n        } else {\r\n          // For new drafts, don't auto-reset - allow user to continue editing\r\n          onSuccess?.();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      message.error('Failed to save draft. Please try again.');\r\n    }\r\n  };\r\n\r\n  // Handle complete bill (full validation)\r\n  const handleCompleteBill = async () => {\r\n    // Full validation\r\n    if (\r\n      !billFormData.invoice_no ||\r\n      !billFormData.customer_id ||\r\n      !billFormData.items.length\r\n    ) {\r\n      message.error('Please fill all required fields');\r\n      return;\r\n    }\r\n\r\n    // Check for incomplete items\r\n    const incompleteItems = billFormData.items.some(\r\n      item =>\r\n        !item.product_id ||\r\n        !item.stock_id ||\r\n        (!item.qty && !item.loose_qty) ||\r\n        !item.price\r\n    );\r\n\r\n    if (incompleteItems) {\r\n      message.error('Please complete all item details');\r\n      return;\r\n    }\r\n\r\n    // Validate that entered quantities don't exceed available stock\r\n    const stockValidationErrors: string[] = [];\r\n    billFormData.items.forEach((item, index) => {\r\n      if (item.stock_id && (item.qty || item.loose_qty)) {\r\n        const validation = validateStockQuantity(\r\n          item.stock_id,\r\n          item.qty || 0,\r\n          item.loose_qty || 0\r\n        );\r\n\r\n        if (!validation.isValid) {\r\n          stockValidationErrors.push(`Row ${index + 1}: ${validation.message}`);\r\n        }\r\n      }\r\n    });\r\n\r\n    if (stockValidationErrors.length > 0) {\r\n      message.error(\r\n        `Stock validation errors:\\n${stockValidationErrors.join('\\n')}`\r\n      );\r\n      return;\r\n    }\r\n    if (!billFormData.customer_id) {\r\n      message.error(\r\n        `Please select a ${documentType === 'invoice' ? 'vendor' : 'customer'}`\r\n      );\r\n      return;\r\n    }\r\n    if (!billFormData.payment_mode) {\r\n      message.error('Please select a payment mode');\r\n      return;\r\n    }\r\n\r\n    const payload = {\r\n      invoice_no: billFormData.invoice_no,\r\n      date: billFormData.date,\r\n      ...(documentType === 'invoice'\r\n        ? { vendor_id: billFormData.customer_id }\r\n        : { customer_id: billFormData.customer_id }),\r\n      billed_by_id: billFormData.billed_by_id,\r\n      payment_mode: billFormData.payment_mode,\r\n      items: billFormData.items.map(item => ({\r\n        product_id: item.product_id,\r\n        stock_id: item.stock_id,\r\n        ...(branchId && { branch_stock_id: item.stock_id }),\r\n        qty: item.qty,\r\n        loose_qty: item.loose_qty,\r\n        price: item.price,\r\n        mrp: item.mrp,\r\n        amount: item.amount,\r\n        tax_percentage: item.tax_percentage,\r\n        _id: item._id,\r\n      })),\r\n      ...billCalculations,\r\n      discount: billSettings.discount,\r\n      discount_type: billSettings.discountType,\r\n      is_paid: billSettings.isPaid,\r\n      is_partially_paid: billSettings.isPartiallyPaid,\r\n      sale_type: billSettings.isRetail ? 'retail' : 'wholesale',\r\n      is_gst_included: billSettings.isGstIncluded,\r\n      paid_amount: billSettings.isPartiallyPaid\r\n        ? billSettings.paidAmount\r\n        : billSettings.isPaid\r\n          ? billCalculations.total_amount\r\n          : 0,\r\n      status: 'completed', // Mark as completed\r\n      document_type: documentType, // Save document type (bill or invoice)\r\n    };\r\n\r\n    try {\r\n      let response: any;\r\n      if (billdata) {\r\n        const result = await updateSalesRecord(billdata._id, payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setUpdateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      } else {\r\n        const result = await createSalesRecord(payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setCreateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      }\r\n\r\n      // Show confirmation modal after successful save (only for updates, not new bills)\r\n      if (response?.statusCode === 200) {\r\n        const savedData = {\r\n          ...payload,\r\n          customer_name: billFormData.customer_name,\r\n          total_amount: billCalculations.total_amount,\r\n          invoice_no: payload.invoice_no,\r\n          date: payload.date,\r\n        };\r\n        setSavedBillData(savedData);\r\n\r\n        // Invalidate stock caches so next bill sees updated quantities\r\n        dispatch(apiSlice.util.invalidateTags(['StockAudit', 'BranchStock']));\r\n\r\n        // Only show confirmation modal for bill updates, not new bills (they auto-reset)\r\n        if (billdata) {\r\n          setSaveConfirmationVisible(true);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      // Handle error silently or show user-friendly message\r\n      message.error('Failed to complete bill. Please try again.');\r\n    }\r\n  };\r\n\r\n  // Handle create success\r\n  useEffect(() => {\r\n    if (createResponse?.statusCode === 200) {\r\n      onSuccess?.();\r\n      // Only auto-reset for completed bills, not drafts\r\n      const isDraft =\r\n        createResponse?.data?.status === 'draft' ||\r\n        (billFormData as any).status === 'draft';\r\n\r\n      if (!isDraft) {\r\n        createInvoiceNumber({});\r\n        // Auto-reset the bill after successful creation (only for new completed bills, not updates)\r\n        if (!billdata) {\r\n          // Close confirmation modal first, then reset immediately\r\n          setSaveConfirmationVisible(false);\r\n          setTimeout(() => {\r\n            resetBill(false); // Don't show \"Ready for next bill!\" message\r\n\r\n            // Auto-open product selection modal for the first row after reset\r\n            setTimeout(() => {\r\n              autoOpenProductModal();\r\n            }, 200); // Wait for reset to complete\r\n          }, 100); // Minimal delay just to close modal smoothly\r\n        }\r\n      }\r\n      setCreateResponse(null); // Clear response\r\n    }\r\n  }, [\r\n    createResponse,\r\n    billdata,\r\n    resetBill,\r\n    onSuccess,\r\n    autoOpenProductModal,\r\n    createInvoiceNumber,\r\n    billFormData,\r\n  ]);\r\n\r\n  // Handle update success\r\n  useEffect(() => {\r\n    if (updateResponse?.statusCode === 200) {\r\n      onSuccess?.();\r\n      setUpdateResponse(null); // Clear response\r\n    }\r\n  }, [updateResponse, onSuccess]);\r\n\r\n  // Update product names when product list is loaded (for bill viewing)\r\n  useEffect(() => {\r\n    if (productListResult.length > 0 && billFormData.items.length > 0) {\r\n      // Check if any items have product_id but no product_name or have placeholder text\r\n      const needsUpdate = billFormData.items.some(\r\n        item =>\r\n          item.product_id &&\r\n          (!item.product_name ||\r\n            item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:'))\r\n      );\r\n\r\n      if (needsUpdate) {\r\n        const updatedItems = billFormData.items.map(item => {\r\n          if (\r\n            item.product_id &&\r\n            (!item.product_name ||\r\n              item.product_name.includes('Loading...') ||\r\n              item.product_name.includes('Product ID:'))\r\n          ) {\r\n            const product = productListResult.find(\r\n              (p: any) => p._id === item.product_id\r\n            );\r\n            if (product) {\r\n              return {\r\n                ...item,\r\n                product_name: product.name,\r\n                variant_name: product.VariantItem?.variant_name || '',\r\n              };\r\n            }\r\n          }\r\n          return item;\r\n        });\r\n\r\n        // Only update if we actually made changes\r\n        const hasChanges = updatedItems.some(\r\n          (item, index) =>\r\n            item.product_name !== billFormData.items[index].product_name\r\n        );\r\n\r\n        if (hasChanges) {\r\n          setBillFormData(prev => ({\r\n            ...prev,\r\n            items: updatedItems,\r\n          }));\r\n        }\r\n      }\r\n    }\r\n  }, [productListResult, billFormData.items]);\r\n\r\n  // Load stock data when editing existing bills - runs once when stock data loads\r\n  useEffect(() => {\r\n    if (!billdata) return; // Only for editing\r\n    \r\n    const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n    \r\n    if (stockListData.length > 0) {\r\n      // Check if any items have stock_id but no stockData\r\n      const needsStockData = billFormData.items.some(\r\n        item => item.stock_id && !(item as any).stockData\r\n      );\r\n\r\n      if (needsStockData) {\r\n        const updatedItems = billFormData.items.map(item => {\r\n          if (item.stock_id && !(item as any).stockData) {\r\n            const stockData = stockListData.find(\r\n              (s: any) => s._id === item.stock_id\r\n            );\r\n            if (stockData) {\r\n              return {\r\n                ...item,\r\n                stockData: stockData,\r\n              };\r\n            }\r\n          }\r\n          return item;\r\n        });\r\n\r\n        // Only update if we actually made changes\r\n        const hasChanges = updatedItems.some(\r\n          (item, index) => (item as any).stockData && !(billFormData.items[index] as any).stockData\r\n        );\r\n\r\n        if (hasChanges) {\r\n          setBillFormData(prev => ({\r\n            ...prev,\r\n            items: updatedItems,\r\n          }));\r\n        }\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [stockAuditListResult, branchStockListResult, branchId, billdata]);\r\n\r\n  // Force resolve product names when product list changes\r\n  useEffect(() => {\r\n    if (productListResult.length > 0 && billFormData.items.length > 0) {\r\n      // Force resolve any remaining unresolved product names\r\n      setTimeout(() => {\r\n        forceResolveProductNamesAndStock();\r\n      }, 200);\r\n    }\r\n  }, [productListResult, billFormData.items]);\r\n\r\n  // Update stock information when stock list is loaded (for bill viewing)\r\n  useEffect(() => {\r\n    const stockListData = branchId\r\n      ? branchStockListResult\r\n      : stockAuditListResult;\r\n    if (stockListData.length > 0 && billFormData.items.length > 0) {\r\n      // Check if any items have stock_id but no batch_no or have placeholder text\r\n      const needsUpdate = billFormData.items.some(\r\n        item =>\r\n          item.stock_id &&\r\n          (!item.batch_no || item.batch_no.includes('Loading...'))\r\n      );\r\n\r\n      if (needsUpdate) {\r\n        const updatedItems = billFormData.items.map(item => {\r\n          if (\r\n            item.stock_id &&\r\n            (!item.batch_no || item.batch_no.includes('Loading...'))\r\n          ) {\r\n            const stock = stockListData.find(\r\n              (s: any) => s._id === item.stock_id\r\n            );\r\n            if (stock) {\r\n              return {\r\n                ...item,\r\n                batch_no: stock.batch_no || '',\r\n              };\r\n            }\r\n          }\r\n          return item;\r\n        });\r\n\r\n        // Only update if we actually made changes\r\n        const hasChanges = updatedItems.some(\r\n          (item, index) => item.batch_no !== billFormData.items[index].batch_no\r\n        );\r\n\r\n        if (hasChanges) {\r\n          setBillFormData(prev => ({\r\n            ...prev,\r\n            items: updatedItems,\r\n          }));\r\n        }\r\n      }\r\n    }\r\n  }, [\r\n    branchStockListResult,\r\n    stockAuditListResult,\r\n    billFormData.items,\r\n    branchId,\r\n  ]);\r\n\r\n  // Force resolve stock information when stock list changes\r\n  useEffect(() => {\r\n    const stockListData = branchId\r\n      ? branchStockListResult\r\n      : stockAuditListResult;\r\n    if (stockListData.length > 0 && billFormData.items.length > 0) {\r\n      // Force resolve any remaining unresolved stock information\r\n      setTimeout(() => {\r\n        forceResolveProductNamesAndStock();\r\n      }, 200);\r\n    }\r\n  }, [\r\n    branchStockListResult,\r\n    stockAuditListResult,\r\n    billFormData.items,\r\n    branchId,\r\n  ]);\r\n\r\n  // Periodic check to resolve any remaining unresolved data\r\n  useEffect(() => {\r\n    if (billFormData.items.length > 0) {\r\n      const interval = setInterval(() => {\r\n        const hasUnresolvedItems = billFormData.items.some(\r\n          item =>\r\n            (item.product_id &&\r\n              (!item.product_name ||\r\n                item.product_name.includes('Loading...') ||\r\n                item.product_name.includes('Product ID:'))) ||\r\n            (item.stock_id &&\r\n              (!item.batch_no || item.batch_no.includes('Loading...')))\r\n        );\r\n\r\n        if (\r\n          hasUnresolvedItems &&\r\n          (productListResult.length > 0 ||\r\n            (branchId\r\n              ? branchStockListResult.length > 0\r\n              : stockAuditListResult.length > 0))\r\n        ) {\r\n          forceResolveProductNamesAndStock();\r\n        }\r\n      }, 1000); // Check every second\r\n\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [\r\n    billFormData.items,\r\n    productListResult,\r\n    branchStockListResult,\r\n    stockAuditListResult,\r\n    branchId,\r\n  ]);\r\n\r\n  // Ultra-Fast Billing Keyboard Shortcuts\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // F1: Add item and focus first product field\r\n      if (e.key === 'F1') {\r\n        e.preventDefault();\r\n        handleAddItem();\r\n        setTimeout(() => {\r\n          const productCell = document.querySelector(\r\n            '.ant-table-tbody tr:last-child td[data-column-key=\"product_id\"]'\r\n          ) as HTMLElement;\r\n          productCell?.focus();\r\n        }, 200);\r\n      }\r\n      // F2: Save draft\r\n      else if (e.key === 'F2') {\r\n        e.preventDefault();\r\n        handleSaveDraft();\r\n      }\r\n      // F3: Complete bill\r\n      else if (e.key === 'F3') {\r\n        e.preventDefault();\r\n        handleCompleteBill();\r\n      }\r\n      // F4: Clear bill form\r\n      else if (e.key === 'F4') {\r\n        e.preventDefault();\r\n        handleClearBill();\r\n      }\r\n      // F5: Open product selection modal for current row or first empty row\r\n      else if (e.key === 'F5') {\r\n        e.preventDefault();\r\n        handleF5ProductSelection();\r\n      }\r\n      // End: Open customer selection modal\r\n      else if (e.key === 'End') {\r\n        e.preventDefault();\r\n        setCustomerModalVisible(true);\r\n      }\r\n      // F6: Open bill list drawer\r\n      else if (e.key === 'F6') {\r\n        e.preventDefault();\r\n        setBillListDrawerVisible(true);\r\n      }\r\n      // F7: Open stock selection modal for current row or first row with product\r\n      else if (e.key === 'F7') {\r\n        e.preventDefault();\r\n        handleF7StockSelection();\r\n      }\r\n      // F8: Print bill\r\n      else if (e.key === 'F8') {\r\n        e.preventDefault();\r\n        // TODO: Implement print functionality\r\n        message.info('Print functionality coming soon!');\r\n      }\r\n\r\n      // Ctrl shortcuts\r\n      else if (e.ctrlKey) {\r\n        switch (e.key) {\r\n          case 's':\r\n            e.preventDefault();\r\n            handleSaveDraft();\r\n            break;\r\n          case 'n':\r\n            e.preventDefault();\r\n            handleAddItem();\r\n            setTimeout(() => {\r\n              const productCell = document.querySelector(\r\n                '.ant-table-tbody tr:last-child td[data-column-key=\"product_id\"]'\r\n              ) as HTMLElement;\r\n              productCell?.focus();\r\n            }, 200);\r\n            break;\r\n          case 'p':\r\n            e.preventDefault();\r\n            // TODO: Implement print functionality\r\n            message.info('Print functionality coming soon!');\r\n            break;\r\n          case 'r':\r\n            e.preventDefault();\r\n            // Reset form completely\r\n            resetBill(); // Show message for manual reset via keyboard\r\n            break;\r\n          case 'u':\r\n            e.preventDefault();\r\n            setUserModalVisible(true);\r\n            break;\r\n        }\r\n      }\r\n      // Quick quantity entry (Ctrl + 0-9)\r\n      else if (e.ctrlKey && /^[0-9]$/.test(e.key)) {\r\n        e.preventDefault();\r\n        const activeElement = document.activeElement as HTMLElement;\r\n        if (activeElement?.closest('td[data-column-key=\"qty\"]')) {\r\n          const input = activeElement.querySelector(\r\n            'input'\r\n          ) as HTMLInputElement;\r\n          if (input) {\r\n            input.value = e.key;\r\n            input.dispatchEvent(new Event('change', { bubbles: true }));\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, [\r\n    billFormData,\r\n    billSettings,\r\n    handleF5ProductSelection,\r\n    handleF7StockSelection,\r\n    stockModalRowIndex,\r\n  ]);\r\n\r\n  return (\r\n    <div className={styles.mainContainer}>\r\n      {/* Background Half Circles */}\r\n      <div className={styles.backgroundCircle1} />\r\n      <div className={styles.backgroundCircle2} />\r\n      <div className={styles.backgroundCircle3} />\r\n      <div className={styles.backgroundCircle4} />\r\n      <div className={styles.backgroundCircle5} />\r\n      {/* Ultra-Fast Billing Header */}\r\n      <div className={styles.headerContainer}>\r\n        {/* Animated decorative background elements */}\r\n        <div className={styles.headerCircle1} />\r\n        <div className={styles.headerCircle2} />\r\n        <div className={styles.headerCircle3} />\r\n        <div className={styles.headerCircle4} />\r\n        <div className={styles.headerCircle5} />\r\n\r\n        <div className={styles.headerContent}>\r\n          {/* Title Section */}\r\n          <div className={styles.titleSection}>\r\n            <div className={styles.titleIcon}>\r\n              <FileTextOutlined style={{ fontSize: '24px', color: 'white' }} />\r\n            </div>\r\n            <div>\r\n              <Title level={4} className={styles.titleText}>\r\n                {billdata ? ' EDIT INVOICE' : ' NEW INVOICE'}\r\n              </Title>\r\n              <Text className={styles.subtitleText}>\r\n                Lightning Fast  {dayjs().format('DD MMM YYYY, dddd')}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Controls Section */}\r\n          <div className={styles.controlsSection}>\r\n            {/* Document Type Toggle - Integrated */}\r\n            <div style={{ marginRight: '12px' }}>\r\n              <DocumentTypeToggle\r\n                value={documentType}\r\n                onChange={setDocumentType}\r\n              />\r\n            </div>\r\n\r\n            <div className={`${styles.controlGroup} ${styles.saleTypeControl}`}>\r\n              <Text className={styles.controlLabel}> SALE TYPE</Text>\r\n              <Switch\r\n                checkedChildren=\"RETAIL\"\r\n                unCheckedChildren=\"WHOLESALE\"\r\n                checked={billSettings.isRetail}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({ ...prev, isRetail: checked }))\r\n                }\r\n                className={styles.saleTypeSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            <div className={`${styles.controlGroup} ${styles.gstControl}`}>\r\n              <Text className={styles.controlLabel}> GST</Text>\r\n              <Switch\r\n                checkedChildren=\"INCL\"\r\n                unCheckedChildren=\"EXCL\"\r\n                checked={billSettings.isGstIncluded}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({ ...prev, isGstIncluded: checked }))\r\n                }\r\n                className={styles.gstSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            <div className={`${styles.controlGroup} ${styles.paymentControl}`}>\r\n              <Text className={styles.controlLabel}> PAYMENT</Text>\r\n              <Switch\r\n                checkedChildren=\"PAID\"\r\n                unCheckedChildren=\"UNPAID\"\r\n                checked={billSettings.isPaid}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({\r\n                    ...prev,\r\n                    isPaid: checked,\r\n                    isPartiallyPaid: checked ? false : prev.isPartiallyPaid,\r\n                  }))\r\n                }\r\n                className={styles.paymentSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            {!billSettings.isPaid && (\r\n              <div\r\n                className={`${styles.controlGroup} ${styles.partialPaymentControl}`}\r\n              >\r\n                <Text className={styles.controlLabel}> PARTIAL</Text>\r\n                <Switch\r\n                  checkedChildren=\"YES\"\r\n                  unCheckedChildren=\"NO\"\r\n                  checked={billSettings.isPartiallyPaid}\r\n                  onChange={checked =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      isPartiallyPaid: checked,\r\n                    }))\r\n                  }\r\n                  className={styles.partialPaymentSwitch}\r\n                  size=\"small\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* Items and Amount Badges - Moved to the end */}\r\n            <div className={styles.badgesContainer}>\r\n              <div className={styles.itemsBadge}>\r\n                <Text className={styles.badgeText}>\r\n                   ITEMS: {billFormData.items.length}\r\n                </Text>\r\n              </div>\r\n              <div className={styles.amountBadge}>\r\n                <Text className={styles.badgeText}>\r\n                   {billCalculations.total_amount.toFixed(2)}\r\n                </Text>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Invoice Details Data Grid */}\r\n      <div className={styles.invoiceDetailsGrid}>\r\n        <AntdEditableTable\r\n          columns={headerColumns}\r\n          dataSource={headerData}\r\n          onSave={handleHeaderChange}\r\n          allowAdd={false}\r\n          allowDelete={false}\r\n          loading={customerLoading || vendorLoading}\r\n          className=\"compact-header-grid\"\r\n          size=\"small\"\r\n          rowKey=\"invoice_no\"\r\n        />\r\n      </div>\r\n\r\n      {/* Items Section with Summary */}\r\n      <div className={styles.itemsSection}>\r\n        {/* Decorative half circles for items section */}\r\n        <div className={styles.itemsCircle1} />\r\n        <div className={styles.itemsCircle2} />\r\n        {/* Bill Items Grid */}\r\n        <div className={styles.billItemsGrid}>\r\n          <div className={styles.billItemsHeader}>\r\n            <Text className={styles.billItemsTitle}> BILL ITEMS</Text>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <Badge\r\n                count={billFormData.items.length}\r\n                showZero\r\n                size=\"small\"\r\n                style={{ backgroundColor: 'rgba(255,255,255,0.2)' }}\r\n              >\r\n                <Text className={styles.billItemsBadge}>Items</Text>\r\n              </Badge>\r\n              <Text\r\n                style={{\r\n                  fontSize: '10px',\r\n                  color: '#666',\r\n                  backgroundColor: '#f0f0f0',\r\n                  padding: '2px 6px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                }}\r\n              ></Text>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Stock Validation Summary */}\r\n          {/* {(() => {\r\n            const stockValidationSummary = billFormData.items\r\n              .filter(item => item.stock_id && (item.qty || item.loose_qty))\r\n              .map(item => {\r\n                const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n                const stock = stockListData.find((s: any) => s._id === item.stock_id);\r\n                const availableQty = stock?.available_quantity || 0;\r\n                const totalEnteredQty = (item.qty || 0) + (item.loose_qty || 0);\r\n                const isValid = totalEnteredQty <= availableQty;\r\n                const remainingQty = Math.max(0, availableQty - totalEnteredQty);\r\n                \r\n                return {\r\n                  productName: item.product_name || 'Unknown Product',\r\n                  batchNo: item.batch_no || 'No Batch',\r\n                  availableQty,\r\n                  enteredQty: totalEnteredQty,\r\n                  remainingQty,\r\n                  isValid,\r\n                  isLowStock: remainingQty > 0 && remainingQty <= 5\r\n                };\r\n              });\r\n\r\n            const hasValidationIssues = stockValidationSummary.some(item => !item.isValid);\r\n            const hasLowStock = stockValidationSummary.some(item => item.isLowStock);\r\n\r\n            if (stockValidationSummary.length === 0) return null;\r\n\r\n            return (\r\n              <div style={{\r\n                marginBottom: '16px',\r\n                padding: '12px',\r\n                borderRadius: '8px',\r\n                backgroundColor: hasValidationIssues ? '#fff2f0' : hasLowStock ? '#fffbe6' : '#f6ffed',\r\n                border: `1px solid ${hasValidationIssues ? '#ffccc7' : hasLowStock ? '#ffe58f' : '#b7eb8f'}`,\r\n                fontSize: '12px'\r\n              }}>\r\n                <div style={{ \r\n                  fontWeight: 'bold', \r\n                  marginBottom: '8px',\r\n                  color: hasValidationIssues ? '#cf1322' : hasLowStock ? '#d48806' : '#389e0d'\r\n                }}>\r\n                   Stock Validation Summary\r\n                </div>\r\n                {stockValidationSummary.map((item, index) => (\r\n                  <div key={index} style={{\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center',\r\n                    padding: '4px 0',\r\n                    borderBottom: index < stockValidationSummary.length - 1 ? '1px solid #f0f0f0' : 'none'\r\n                  }}>\r\n                    <span style={{ fontWeight: '500' }}>\r\n                      {item.productName} ({item.batchNo})\r\n                    </span>\r\n                    <div style={{ display: 'flex', gap: '16px', alignItems: 'center' }}>\r\n                      <span>Available: {item.availableQty}</span>\r\n                      <span>Entered: {item.enteredQty}</span>\r\n                      <span>Remaining: {item.remainingQty}</span>\r\n                      <span style={{\r\n                        color: item.isValid ? '#52c41a' : '#ff4d4f',\r\n                        fontWeight: 'bold'\r\n                      }}>\r\n                        {item.isValid ? ' Valid' : ' Exceeds Stock'}\r\n                      </span>\r\n                      {item.isLowStock && (\r\n                        <span style={{ color: '#faad14', fontWeight: 'bold' }}>\r\n                           Low Stock\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            );\r\n          })()} */}\r\n\r\n          <AntdEditableTable\r\n            columns={itemColumns}\r\n            dataSource={billFormData.items.map((item, index) => ({\r\n              ...item,\r\n              key: index.toString(),\r\n            }))}\r\n            onSave={handleItemsChange}\r\n            onAdd={handleAddItem}\r\n            onDelete={handleDeleteItems}\r\n            onProductSelect={handleProductSelect}\r\n            loading={productLoading || stockLoading || branchStockLoading}\r\n            className=\"modern-bill-grid\"\r\n            size=\"small\"\r\n            rowKey=\"key\"\r\n            externalEditingCell={externalEditingCell}\r\n          />\r\n        </div>\r\n\r\n        {/* Bill Summary - Right Side */}\r\n        <div className={styles.billSummary}>\r\n          {/* Decorative half circles for summary */}\r\n          <div className={styles.summaryCircle1} />\r\n          <div className={styles.summaryCircle2} />\r\n          {/* Header */}\r\n          <div className={styles.summaryHeader}>\r\n            <Text className={styles.summaryTitle}> BILL SUMMARY</Text>\r\n          </div>\r\n\r\n          {/* Summary Table */}\r\n          <div className={styles.summaryTable}>\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Sub Total:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.sub_total.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Value of Goods:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.value_of_goods.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Total GST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.total_gst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>CGST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.cgst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>SGST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.sgst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            {billSettings.discount > 0 && (\r\n              <div className={styles.summaryRow}>\r\n                <Text className={styles.summaryLabel}>DISCOUNT:</Text>\r\n                <Text className={styles.discountValue}>\r\n                  -\r\n                  {billSettings.discountType === 'percentage'\r\n                    ? (\r\n                        ((billCalculations.sub_total +\r\n                          billCalculations.total_gst) *\r\n                          (typeof billSettings.discount === 'number'\r\n                            ? billSettings.discount\r\n                            : 0)) /\r\n                        100\r\n                      ).toFixed(2)\r\n                    : (typeof billSettings.discount === 'number'\r\n                        ? billSettings.discount\r\n                        : 0\r\n                      ).toFixed(2)}\r\n                </Text>\r\n              </div>\r\n            )}\r\n\r\n            <div className={styles.totalAmountRow}>\r\n              <Text className={styles.totalAmountLabel}>NET/EXC/REPL:</Text>\r\n              <Text className={styles.totalAmountValue}>\r\n                {billCalculations.total_amount.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            {billSettings.isPartiallyPaid && (\r\n              <div className={styles.partialPaymentInfo}>\r\n                <div className={styles.partialPaymentRow}>\r\n                  <Text className={styles.partialPaymentLabel}>\r\n                    Paid Amount:\r\n                  </Text>\r\n                  <Text className={styles.partialPaymentValue}>\r\n                    \r\n                    {(typeof billSettings.paidAmount === 'number'\r\n                      ? billSettings.paidAmount\r\n                      : 0\r\n                    ).toFixed(2)}\r\n                  </Text>\r\n                </div>\r\n                <div className={styles.partialPaymentRow}>\r\n                  <Text className={styles.partialPaymentLabel}>Balance:</Text>\r\n                  <Text className={styles.partialPaymentValue}>\r\n                    \r\n                    {(\r\n                      billCalculations.total_amount -\r\n                      (typeof billSettings.paidAmount === 'number'\r\n                        ? billSettings.paidAmount\r\n                        : 0)\r\n                    ).toFixed(2)}\r\n                  </Text>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Discount & Payment Controls */}\r\n          <div className={styles.controlsContainer}>\r\n            {/* Discount Controls */}\r\n            <div className={styles.discountControl}>\r\n              <Text className={styles.discountControlLabel}> DISCOUNT</Text>\r\n              <div className={styles.discountControlInputs}>\r\n                <InputNumber\r\n                  min={0}\r\n                  value={billSettings.discount}\r\n                  onChange={value =>\r\n                    setBillSettings(prev => ({ ...prev, discount: value || 0 }))\r\n                  }\r\n                  style={{ width: 70 }}\r\n                  size=\"small\"\r\n                />\r\n                <Switch\r\n                  checkedChildren=\"%\"\r\n                  unCheckedChildren=\"\"\r\n                  checked={billSettings.discountType === 'percentage'}\r\n                  onChange={checked =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      discountType: checked ? 'percentage' : 'amount',\r\n                    }))\r\n                  }\r\n                  size=\"small\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Partial Payment Controls */}\r\n            {billSettings.isPartiallyPaid && (\r\n              <div className={styles.partialPaymentControl}>\r\n                <Text className={styles.partialPaymentControlLabel}>\r\n                   PARTIAL PAY\r\n                </Text>\r\n                <InputNumber\r\n                  min={0}\r\n                  max={billCalculations.total_amount}\r\n                  value={billSettings.paidAmount}\r\n                  onChange={value =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      paidAmount: value || 0,\r\n                    }))\r\n                  }\r\n                  style={{ width: 90 }}\r\n                  size=\"small\"\r\n                  formatter={value =>\r\n                    `${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\r\n                  }\r\n                  parser={value => Number(value!.replace(/\\s?|(,*)/g, ''))}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Ultra-Fast Action Hub */}\r\n      <div className={styles.actionHub}>\r\n        {/* Background decoration */}\r\n        <div className={styles.actionHubCircle1} />\r\n        <div className={styles.actionHubCircle2} />\r\n        <div className={styles.actionHubCircle3} />\r\n        <div className={styles.actionHubCircle4} />\r\n\r\n        <div className={styles.actionButtonsContainer}>\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            icon={<SaveOutlined />}\r\n            onClick={handleSaveDraft}\r\n            loading={saleCreateLoading}\r\n            className={styles.saveButton}\r\n          >\r\n             SAVE DRAFT (F2)\r\n          </Button>\r\n\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            icon={<SaveOutlined />}\r\n            onClick={handleCompleteBill}\r\n            loading={saleCreateLoading || saleUpdateLoading}\r\n            className={styles.saveButton}\r\n          >\r\n             {billdata ? 'UPDATE' : 'COMPLETE BILL'} (F3)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<FileTextOutlined />}\r\n            onClick={() => setBillListDrawerVisible(true)}\r\n            className={styles.billListButton}\r\n          >\r\n             BILL LIST (F6)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<ClearOutlined />}\r\n            onClick={handleClearBill}\r\n            className={styles.clearButton}\r\n          >\r\n             CLEAR (F4 / Ctrl+R)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<PrinterOutlined />}\r\n            className={styles.printButton}\r\n            onClick={() => {\r\n              if (!billFormData.items || billFormData.items.length === 0) {\r\n                message.warning('Please add items before printing');\r\n                return;\r\n              }\r\n\r\n              // Format bill data for printing - handle both bills and invoices\r\n              const isInvoice = documentType === 'invoice';\r\n              const partyList = isInvoice ? vendorListResult : customerListResult;\r\n              const selectedParty = partyList.find(\r\n                (p: any) => p._id === billFormData.customer_id\r\n              );\r\n              \r\n              const printData = {\r\n                invoice_no: billFormData.invoice_no,\r\n                date: billFormData.date,\r\n                customerName: selectedParty?.vendor_name || selectedParty?.full_name || billFormData.customer_name || '',\r\n                customerAddress: selectedParty?.address || selectedParty?.address1 || '',\r\n                customerCity: selectedParty?.city || '',\r\n                customerState: selectedParty?.state || '',\r\n                customerPincode: selectedParty?.pincode || '',\r\n                customerPhone: selectedParty?.phone || selectedParty?.mobile || selectedParty?.contact_number || '',\r\n                customerEmail: selectedParty?.email || '',\r\n                customer_gstin: selectedParty?.gst_no || selectedParty?.gst_number || selectedParty?.gstin || '',\r\n                customer_pan: selectedParty?.pan_no || selectedParty?.pan_number || '',\r\n                items: billFormData.items,\r\n                total: billCalculations.total_amount,\r\n                total_gst: billCalculations.total_gst,\r\n                cgst: billCalculations.total_gst / 2,\r\n                sgst: billCalculations.total_gst / 2,\r\n                discount: billSettings.discount,\r\n                discount_type: billSettings.discountType,\r\n                payment_mode: billFormData.payment_mode,\r\n                // Add organization and branch details\r\n                organisationItems: organisationDetails,\r\n                branchItems: branchDetails,\r\n              };\r\n\r\n              // Print with selected document type\r\n              printDocument(printData, documentType);\r\n            }}\r\n          >\r\n             PRINT {documentType === 'bill' ? 'BILL' : 'INVOICE'} (F8)\r\n          </Button>\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)',\r\n            padding: '14px 18px',\r\n            borderRadius: '10px',\r\n            border: '1px solid #cbd5e1',\r\n            position: 'relative',\r\n            zIndex: 1,\r\n            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.05)',\r\n          }}\r\n        >\r\n          <div style={{ textAlign: 'right' }}>\r\n            <Text\r\n              style={{\r\n                color: '#475569',\r\n                fontSize: '12px',\r\n                display: 'block',\r\n                fontWeight: 600,\r\n                lineHeight: '18px',\r\n              }}\r\n            >\r\n               <strong>Keyboard Shortcuts:</strong> Ctrl+S (Save)  Ctrl+N\r\n              (Add)  F4/Ctrl+R (Clear)  Tab/Shift+Tab (Navigate)  Enter\r\n              (Edit)  Esc (Cancel)  End (Customer)  Ctrl+U (User)  F5\r\n              (Product)  F6 (Bill List)  F7 (Stock)\r\n            </Text>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {stockModalRowIndex !== null && (\r\n        <StockSelectionModal\r\n          visible={true}\r\n          onSelect={handleStockSelect}\r\n          onCancel={() => setStockModalRowIndex(null)}\r\n          productId={billFormData.items[stockModalRowIndex]?.product_id || ''}\r\n        />\r\n      )}\r\n\r\n      {/* Customer Selection Modal */}\r\n      {documentType === 'bill' && (\r\n        <CustomerSelectionModal\r\n          visible={customerModalVisible}\r\n          onSelect={handleCustomerSelect}\r\n          onCancel={() => setCustomerModalVisible(false)}\r\n        />\r\n      )}\r\n\r\n      {/* Vendor Selection Modal */}\r\n      {documentType === 'invoice' && (\r\n        <VendorSelectionModal\r\n          visible={customerModalVisible}\r\n          onSelect={handleVendorSelect}\r\n          onCancel={() => setCustomerModalVisible(false)}\r\n        />\r\n      )}\r\n\r\n      {/* User Selection Modal */}\r\n      <UserSelectionModal\r\n        visible={userModalVisible}\r\n        onSelect={handleUserSelect}\r\n        onCancel={() => setUserModalVisible(false)}\r\n      />\r\n\r\n      {/* Bill Save Confirmation Modal */}\r\n      <BillSaveConfirmationModal\r\n        visible={saveConfirmationVisible}\r\n        onNewBill={handleNewBill}\r\n        onContinueBill={handleContinueBill}\r\n        onCancel={() => setSaveConfirmationVisible(false)}\r\n        savedBillData={savedBillData}\r\n      />\r\n\r\n      {/* Product Details Modal */}\r\n      <ProductDetailsModal\r\n        visible={productDetailsModalVisible}\r\n        onCancel={() => setProductDetailsModalVisible(false)}\r\n        productId={selectedProductId}\r\n      />\r\n\r\n      {/* Product Selection Modal */}\r\n      <ProductSelectionModal\r\n        visible={productSelectionModalVisible}\r\n        onSelect={handleProductSelectionModalSelect}\r\n        onCancel={() => {\r\n          setProductSelectionModalVisible(false);\r\n          setProductSelectionRowIndex(null);\r\n        }}\r\n      />\r\n\r\n      {/* Bill List Drawer */}\r\n      <BillListDrawer\r\n        visible={billListDrawerVisible}\r\n        onClose={() => setBillListDrawerVisible(false)}\r\n        onViewBill={handleViewBill}\r\n        onNewBill={handleNewBill}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillDataGrid;\r\n","/**\r\n * Centralized bill calculation utility\r\n * @param items - array of bill items\r\n * @param productList - product list (for tax/category lookup)\r\n * @param isGstIncluded - whether GST is included in price\r\n * @param discount - discount value\r\n * @param discountType - 'percentage' or 'amount'\r\n * @returns { totalAmount, totalGST, cgst, sgst, valueOfGoods, subtotal, itemsWithTax }\r\n */\r\nexport function calculateBillTotals({\r\n  items,\r\n  productList,\r\n  isGstIncluded,\r\n  discount,\r\n  discountType,\r\n}: {\r\n  items: any[];\r\n  productList: any[];\r\n  isGstIncluded: boolean;\r\n  discount: number;\r\n  discountType: \"percentage\" | \"amount\";\r\n}) {\r\n  // Calculate item base amounts\r\n  const itemsWithTax = items.map((item) => {\r\n    const product = productList?.find((p: any) => p._id === item.product_id);\r\n    // Use item's tax_percentage if available, otherwise get from product category, or default to 18%\r\n    let taxPercentage = item.tax_percentage || product?.CategoryItem?.tax_percentage || 18;\r\n    \r\n    // If still no tax percentage, use a default based on common GST rates\r\n    if (!taxPercentage || taxPercentage === 0) {\r\n      // Default to 18% GST for most goods\r\n      taxPercentage = 18;\r\n    }\r\n    \r\n\r\n    // Calculate base amount (before GST)\r\n    const baseAmount =\r\n      Number(item.qty || 0) * Number(item.price || 0) +\r\n      Number(item.loose_qty || 0) *\r\n        (Number(item.price || 0) / (product?.VariantItem?.pack_size || 1) || 0);\r\n    \r\n    // Calculate amount (with GST if applicable)\r\n    let amount = baseAmount;\r\n    if (!isGstIncluded && taxPercentage > 0) {\r\n      amount = baseAmount + (baseAmount * taxPercentage / 100);\r\n    }\r\n    return {\r\n      ...item,\r\n      tax_percentage: taxPercentage,\r\n      baseAmount,\r\n      amount,\r\n    };\r\n  });\r\n\r\n  // sub_total: sum of all item.amount values (table total before discount/GST)\r\n  const sub_total = itemsWithTax.reduce(\r\n    (sum, item) => sum + Number(item.amount),\r\n    0\r\n  );\r\n\r\n  // base_sub_total: sum of all item base amounts (before GST and discount)\r\n  const base_sub_total = itemsWithTax.reduce(\r\n    (sum, item) => sum + Number(item.baseAmount),\r\n    0\r\n  );\r\n\r\n  // Discount\r\n  let discountValue = 0;\r\n  if (discount > 0) {\r\n    if (discountType === \"percentage\") {\r\n      discountValue = base_sub_total * (discount / 100);\r\n    } else {\r\n      discountValue = discount;\r\n    }\r\n  }\r\n\r\n  // Discounted value of goods\r\n  const discounted_value_of_goods = base_sub_total - discountValue;\r\n\r\n  let total_gst = 0;\r\n  let value_of_goods = 0;\r\n  let total_amount = 0;\r\n  // Calculate GST and totals for each item\r\n  itemsWithTax.forEach(item => {\r\n    let discountedBase = item.baseAmount;\r\n    if (discount > 0) {\r\n      if (discountType === \"percentage\") {\r\n        discountedBase = item.baseAmount - (item.baseAmount * (discount / 100));\r\n      } else {\r\n        discountedBase = item.baseAmount - ((discount/base_sub_total)*item.baseAmount);\r\n      }\r\n    }\r\n    \r\n    let gstAmount = 0;\r\n    if (!isGstIncluded) {\r\n      // GST Excluded: GST is added on top\r\n      if (item.tax_percentage > 0) {\r\n        gstAmount = discountedBase * (item.tax_percentage / 100);\r\n        value_of_goods += discountedBase;\r\n        total_gst += gstAmount;\r\n        total_amount += discountedBase + gstAmount;\r\n      } else {\r\n        // No tax\r\n        value_of_goods += discountedBase;\r\n        total_amount += discountedBase;\r\n      }\r\n    } else {\r\n      // GST Included: GST is part of the price, extract it\r\n      if (item.tax_percentage > 0) {\r\n        gstAmount = discountedBase * (item.tax_percentage / (100 + item.tax_percentage));\r\n        value_of_goods += discountedBase - gstAmount;\r\n        total_gst += gstAmount;\r\n        total_amount += discountedBase;\r\n      } else {\r\n        // No tax\r\n        value_of_goods += discountedBase;\r\n        total_amount += discountedBase;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Calculate CGST and SGST (each is total_gst / 2)\r\n  const cgst = total_gst / 2;\r\n  const sgst = total_gst / 2;\r\n\r\n  return {\r\n    sub_total,\r\n    value_of_goods,\r\n    total_gst,\r\n    cgst,\r\n    sgst,\r\n    total_amount,\r\n    discountValue,\r\n  };\r\n}\r\n","import { useCallback, useMemo } from 'react';\r\nimport { getEntityHooks } from '../services/redux/api/apiSlice';\r\nimport { API_ROUTES } from '../services/api/utils';\r\n// Define EntityName type locally\r\ntype EntityName = string;\r\n\r\n// Type for RTK query parameters\r\nexport interface RTKQueryParams {\r\n  page?: number;\r\n  limit?: number;\r\n  [key: string]: any;\r\n}\r\n\r\n// Type for RTK mutation result\r\nexport interface RTKMutationResult<T = any> {\r\n  data?: T;\r\n  error?: any;\r\n  isLoading: boolean;\r\n  isSuccess: boolean;\r\n  isError: boolean;\r\n}\r\n\r\n// Type for RTK query result\r\nexport interface RTKQueryResult<T = any> {\r\n  data?: T;\r\n  error?: any;\r\n  isLoading: boolean;\r\n  isSuccess: boolean;\r\n  isError: boolean;\r\n  refetch: () => void;\r\n}\r\n\r\n/**\r\n * Custom hook that provides RTK Query functionality for any entity\r\n * Works with the existing createCrudRoutes system\r\n */\r\nexport const useGenericCrudRTK = <T extends EntityName>(entityName: T) => {\r\n  \r\n  // Get the RTK hooks for this entity\r\n  const entityHooks = useMemo(() => getEntityHooks(entityName), [entityName]);\r\n  \r\n  // Check if entity exists in API_ROUTES\r\n  const entityRoutes = useMemo(() => {\r\n    const routes = API_ROUTES[entityName as keyof typeof API_ROUTES];\r\n    if (!routes || typeof routes !== 'object' || !('GetAll' in routes)) {\r\n      throw new Error(`Entity ${entityName} not found in API_ROUTES or doesn't follow CRUD pattern`);\r\n    }\r\n    return routes as any;\r\n  }, [entityName]);\r\n\r\n  // Get all records with pagination and filters\r\n  const useGetAll = (params: RTKQueryParams = {}) => {\r\n    const query = entityHooks.useGetQuery(params);\r\n    return {\r\n      ...query,\r\n      refetch: query.refetch,\r\n    } as RTKQueryResult;\r\n  };\r\n\r\n  // Get single record by ID\r\n  const useGetById = (id: string, params: RTKQueryParams = {}) => {\r\n    const query = entityHooks.useGetByIdQuery({ id, ...params });\r\n    return {\r\n      ...query,\r\n      refetch: query.refetch,\r\n    } as RTKQueryResult;\r\n  };\r\n\r\n  // Create new record\r\n  const useCreate = () => {\r\n    const [createMutation, result] = entityHooks.useCreateMutation();\r\n    \r\n    const create = useCallback(async (data: any) => {\r\n      try {\r\n        const response = await createMutation(data).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [createMutation]);\r\n\r\n    return {\r\n      create,\r\n      ...result,\r\n    } as RTKMutationResult & { create: (data: any) => Promise<{ data: any; error: any }> };\r\n  };\r\n\r\n  // Update existing record\r\n  const useUpdate = () => {\r\n    const [updateMutation, result] = entityHooks.useUpdateMutation();\r\n    \r\n    const update = useCallback(async (id: string, data: any) => {\r\n      try {\r\n        const response = await updateMutation({ id, data }).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [updateMutation]);\r\n\r\n    return {\r\n      update,\r\n      ...result,\r\n    } as RTKMutationResult & { update: (id: string, data: any) => Promise<{ data: any; error: any }> };\r\n  };\r\n\r\n  // Delete record\r\n  const useDelete = () => {\r\n    const [deleteMutation, result] = entityHooks.useDeleteMutation();\r\n    \r\n    const remove = useCallback(async (id: string) => {\r\n      try {\r\n        const response = await deleteMutation(id).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [deleteMutation]);\r\n\r\n    return {\r\n      delete: remove,\r\n      remove, // Alias for delete\r\n      ...result,\r\n    } as RTKMutationResult & { \r\n      delete: (id: string) => Promise<{ data: any; error: any }>;\r\n      remove: (id: string) => Promise<{ data: any; error: any }>;\r\n    };\r\n  };\r\n\r\n  // Get entity routes for manual API calls\r\n  const getRoutes = useCallback(() => {\r\n    return {\r\n      getAll: entityRoutes.GetAll,\r\n      get: entityRoutes.Get,\r\n      create: entityRoutes.Create,\r\n      update: entityRoutes.Update,\r\n      delete: entityRoutes.Delete,\r\n    };\r\n  }, [entityRoutes]);\r\n\r\n  return {\r\n    // Query hooks\r\n    useGetAll,\r\n    useGetById,\r\n    \r\n    // Mutation hooks\r\n    useCreate,\r\n    useUpdate,\r\n    useDelete,\r\n    \r\n    // Utility functions\r\n    getRoutes,\r\n    \r\n    // Entity info\r\n    entityName,\r\n    entityRoutes,\r\n  };\r\n};\r\n\r\n// Export individual hooks for convenience\r\nexport const useEntityQuery = <T extends EntityName>(entityName: T, params: RTKQueryParams = {}) => {\r\n  const { useGetAll } = useGenericCrudRTK(entityName);\r\n  return useGetAll(params);\r\n};\r\n\r\nexport const useEntityMutation = <T extends EntityName>(entityName: T) => {\r\n  const { useCreate, useUpdate, useDelete } = useGenericCrudRTK(entityName);\r\n  return {\r\n    useCreate,\r\n    useUpdate,\r\n    useDelete,\r\n  };\r\n};\r\n\r\n// Export for backward compatibility\r\nexport default useGenericCrudRTK;","import { handleApiResponse } from './handleApiResponse';\r\nimport { useEffect, useRef } from 'react';\r\n\r\n// RTK Query mutation result type\r\ninterface RTKMutationResult {\r\n  isLoading?: boolean;\r\n  isSuccess?: boolean;\r\n  isError?: boolean;\r\n  data?: any;\r\n  error?: any;\r\n  reset?: () => void;\r\n}\r\n\r\nexport const useHandleApiResponse = ({\r\n  action,\r\n  title,\r\n  mutationResult,\r\n  refetch,\r\n}: {\r\n  action: 'create' | 'update' | 'delete';\r\n  title: string;\r\n  mutationResult: RTKMutationResult;\r\n  refetch?: () => void;\r\n}) => {\r\n  const {\r\n    isLoading,\r\n    isSuccess,\r\n    isError,\r\n    data,\r\n    error,\r\n    reset,\r\n  } = mutationResult;\r\n\r\n  // Track previous loading state to detect transitions\r\n  const prevLoadingRef = useRef<boolean>(false);\r\n  // Track if we've already handled this result to prevent duplicate notifications\r\n  const handledRef = useRef<string>('');\r\n\r\n  useEffect(() => {\r\n    // Track transition from loading to not-loading\r\n    const wasLoading = prevLoadingRef.current;\r\n    prevLoadingRef.current = isLoading || false;\r\n\r\n    // Skip if still loading\r\n    if (isLoading) {\r\n      return;\r\n    }\r\n\r\n    // Only process if we just transitioned from loading to not-loading\r\n    if (!wasLoading) {\r\n      return;\r\n    }\r\n\r\n    // Create a unique key for this result to prevent duplicate handling\r\n    const resultKey = `${isSuccess}-${isError}-${data?.statusCode || ''}-${error?.status || ''}`;\r\n    \r\n    // Skip if we've already handled this exact result\r\n    // Since we're tracking loading transitions, this should only trigger once per mutation\r\n    if (handledRef.current === resultKey) {\r\n      return;\r\n    }\r\n\r\n    // Handle success case\r\n    if (isSuccess && data) {\r\n      const success = data?.statusCode === 200 || data?.status === 'success' || isSuccess;\r\n\r\n      // Prepare refetch function for handleApiResponse\r\n      // RTK Query provides refetch function, entityApi parameter is deprecated\r\n      const refetchFn = refetch;\r\n\r\n      handleApiResponse({\r\n        action,\r\n        title,\r\n        success: true,\r\n        getAllItems: refetchFn,\r\n      });\r\n\r\n      handledRef.current = resultKey;\r\n\r\n      // Reset mutation state if reset function is available\r\n      if (reset) {\r\n        // Delay reset slightly to ensure state updates are processed\r\n        setTimeout(() => {\r\n          reset();\r\n          // Clear handled ref to allow handling new mutations\r\n          handledRef.current = '';\r\n        }, 100);\r\n      }\r\n    }\r\n\r\n    // Handle error case\r\n    if (isError && error) {\r\n      const errorMessage = \r\n        error?.data?.message || \r\n        error?.message || \r\n        error?.error || \r\n        `Failed to ${action} ${title}`;\r\n\r\n      handleApiResponse({\r\n        action,\r\n        title,\r\n        success: false,\r\n        errorMessage,\r\n      });\r\n\r\n      handledRef.current = resultKey;\r\n\r\n      // Reset mutation state if reset function is available\r\n      if (reset) {\r\n        // Delay reset slightly to ensure state updates are processed\r\n        setTimeout(() => {\r\n          reset();\r\n          // Clear handled ref to allow handling new mutations\r\n          handledRef.current = '';\r\n        }, 100);\r\n      }\r\n    }\r\n  }, [\r\n    isLoading,\r\n    isSuccess,\r\n    isError,\r\n    data,\r\n    error,\r\n    action,\r\n    title,\r\n    refetch,\r\n    reset,\r\n  ]);\r\n};\r\n","import { message } from \"antd\";\r\nimport { API_ROUTES } from \"../services/api/utils\";\r\n\r\nexport const showToast = (type: \"success\" | \"error\", content: string) => {\r\n  if (type === \"success\") {\r\n    message.success(content);\r\n  } else if (type === \"error\") {\r\n    message.error(content);\r\n  }\r\n};\r\n\r\n// Generic function to generate API route getters for any entity\r\nexport const createApiRouteGetter = <T extends keyof typeof API_ROUTES>(entityName: T) => {\r\n  return (action: keyof typeof API_ROUTES[T]) => {\r\n    const route = API_ROUTES?.[entityName]?.[action];\r\n    if (!route) {\r\n\r\n      throw new Error(`API route for ${String(entityName)}.${String(action)} is not defined.`);\r\n    }\r\n    return route;\r\n  };\r\n};\r\n\r\n// Generic CRUD factory that creates all CRUD operations for an entity\r\nexport const createCrudOperations = <T extends keyof typeof API_ROUTES>(entityName: T) => {\r\n  const getRoute = createApiRouteGetter(entityName);\r\n  \r\n  return {\r\n    getAll: () => getRoute(\"GetAll\" as keyof typeof API_ROUTES[T]),\r\n    create: () => getRoute(\"Create\" as keyof typeof API_ROUTES[T]),\r\n    update: () => getRoute(\"Update\" as keyof typeof API_ROUTES[T]),\r\n    delete: () => getRoute(\"Delete\" as keyof typeof API_ROUTES[T]),\r\n    get: () => getRoute(\"Get\" as keyof typeof API_ROUTES[T]),\r\n  };\r\n};\r\n\r\n// Auto-generated CRUD operations for all entities (minimal - only for fallback)\r\nexport const CrudOperations = {\r\n  Unit: createCrudOperations(\"Unit\"),\r\n  // Note: All API calls are now handled by RTK Query via apiSlice\r\n  // because they don't follow the standard CRUD pattern\r\n} as const;"],"names":["handleApiResponse","_ref","action","success","title","getAllItems","resetForm","errorMessage","showToast","concat","usePrintDocument","BillTemplateComponent","InvoiceTemplateComponent","settings","useTemplateSettings","printDocument","useCallback","billData","documentType","enhancedSettings","finalSettings","TemplateComponent","printWindow","window","open","console","error","element","React","templateHtml","ReactDOMServer","document","write","invoice_no","close","previewDocument","_userItem$organisatio","userItem","useMemo","getCurrentUser","organisationId","organisation_id","organisationItems","_id","data","settingsData","isLoading","apiSlice","useGetSettingsQuery","page","limit","skip","refetchOnMountOrArgChange","settingsResult","result","Array","isArray","billTemplateKey","bill_template","invoiceTemplateKey","invoice_template","getBillTemplate","getInvoiceTemplate","Search","Input","visible","onSelect","onCancel","productsData","loading","useGetProductQuery","products","searchTerm","setSearchTerm","useState","selectedRowKey","setSelectedRowKey","highlightedIndex","setHighlightedIndex","scannerVisible","setScannerVisible","searchInputRef","useRef","filteredProducts","filter","p","_p$name","_p$sku","_p$VariantItem","_p$VariantItem$varian","_p$VariantItem2","_p$VariantItem2$varia","_p$selling_price","searchLower","toLowerCase","name","includes","sku","VariantItem","variant_name","variant_code","selling_price","toString","sort","a","b","_a$name","_a$VariantItem","_a$VariantItem$varian","_a$sku","_b$name","_b$VariantItem","_b$VariantItem$varian","_b$sku","_a$name2","_a$VariantItem2","_a$VariantItem2$varia","_a$sku2","_b$name2","_b$VariantItem2","_b$VariantItem2$varia","_b$sku2","aExactMatch","bExactMatch","aStartsWith","startsWith","bStartsWith","useEffect","length","setTimeout","_searchInputRef$curre","current","focus","columns","dataIndex","key","width","render","record","_record$VariantItem","_record$VariantItem2","_jsxs","children","_jsx","style","fontWeight","color","fontSize","marginTop","marginLeft","variant","fontStyle","price","toFixed","handleSelectRow","product","Modal","footer","destroyOnClose","onClick","handleModalClick","_searchInputRef$curre4","Space","Compact","marginBottom","ref","placeholder","onChange","e","target","value","flex","autoFocus","onKeyDown","_searchInputRef$curre2","preventDefault","prev","next","Math","min","_searchInputRef$curre3","prevIndex","max","selectedProduct","onBlur","_searchInputRef$curre5","Button","type","icon","ScanOutlined","minWidth","Table","dataSource","rowKey","size","pagination","onRow","idx","_searchInputRef$curre6","onDoubleClick","className","backgroundColor","undefined","border","rowSelection","selectedRowKeys","keys","findIndex","scroll","y","BarcodeScanner","onClose","onScan","barcode","_products$result","foundProduct","find","_p$sku2","_p$name2","_p$VariantItem3","_p$VariantItem3$varia","message","warning","description","productId","scopeData","SessionStorageEncryption","getItem","userRole","userType","user_type","usertype","user_role","isOrganisationUser","isBranchUser","shouldFetch","orgStocksData","loadingOrg","useGetStockAuditQuery","product_id","refetchOnFocus","refetchOnReconnect","branchStocksData","loadingBranch","useGetBranchStockQuery","stocks","setErrorMessage","tableBodyRef","isStockExpired","stock","expiry_date","dayjs","isBefore","isStockOutOfStock","available_quantity","showExpiredStockError","expiryDate","format","errorMsg","showOutOfStockError","allStocks","s","_s$batch_no","_s$ProductItem","_s$ProductItem$name","_s$ProductItem2","_s$ProductItem2$Varia","_s$ProductItem2$Varia2","_s$available_quantity","_s$sell_price","batch_no","ProductItem","sell_price","firstValidIndex","_allStocks$highlighte","row","querySelector","scrollIntoView","block","_ProductItem$VariantI","isOutOfStock","ExclamationCircleOutlined","today","isExpired","daysUntilExpiry","diff","CheckCircleOutlined","status","Tooltip","Tag","_stock$ProductItem","id","code","available_loose_quantity","_searchInputRef$curre7","finalNext","finalPrev","selectedStock","_searchInputRef$curre8","padding","borderRadius","display","alignItems","gap","i","shiftKey","tabIndex","outline","justifyContent","margin","_searchInputRef$curre9","opacity","cursor","getCheckboxProps","disabled","Text","Typography","onSave","onAdd","onDelete","allowAdd","allowDelete","compact","enableKeyboardNav","onProductSelect","externalEditingCell","setData","selectedRows","setSelectedRows","editingCell","setEditingCell","firstLoadRef","firstProductColIndex","col","String","handleAddRow","firstEditableCol","editable","saveCell","column","required","validation","newData","handleKeyDown","ctrlKey","addEventListener","removeEventListener","getNextEditableCol","startCol","direction","EditableCell","_ref2","_data$row","_data$row2","_data$row3","_data$row4","cellValue","setCellValue","inputRef","isProductModalVisible","setIsProductModalVisible","isStockModalVisible","setIsStockModalVisible","_inputRef$current","handleChange","val","stopPropagation","nextCol","nextRow","colIndex","handleProductSelect","handleStockSelect","stock_id","productName","product_name","trim","_Fragment","readOnly","ProductSelectionModal","StockSelectionModal","InputNumber","controls","Select","options","_inputRef$current2","DatePicker","date","mergedColumns","map","_objectSpread","onCell","_record","rowIndex","onContextMenu","option","opt","label","PlusOutlined","danger","DeleteOutlined","handleDeleteRow","confirm","onOk","slice","SaveOutlined","bordered","Title","Option","CustomerSelectionModalComponent","debouncedSearchTerm","setDebouncedSearchTerm","showAddForm","setShowAddForm","selectedCustomer","setSelectedCustomer","selectedRowIndex","setSelectedRowIndex","showCreateGrid","setShowCreateGrid","newCustomerData","setNewCustomerData","full_name","email","mobile","address","customer_type","form","Form","useForm","modalRef","searchTimeoutRef","createGridRef","firstFormInputRef","customerData","customerLoading","refetch","refetchCustomerList","useGetCustomerQuery","searchString","_customerRTK$useCreat","useGenericCrudRTK","useCreate","create","createCustomer","createResult","_objectWithoutProperties","_excluded","createLoading","customers","filteredCustomers","term","customer","_customer$full_name","_customer$mobile","_customer$email","shouldShowCreateGrid","getCustomerTypeColor","vip","wholesale","regular","navigateToCustomer","newIndex","rowElement","scrollBehavior","behavior","handleSearch","clearTimeout","handleCustomerSelect","clearFormData","resetFields","handleCreateCustomerFromForm","async","_result$data","_result$data2","newCustomer","handleFormFieldChange","field","ArrowDown","ArrowUp","Home","End","handleGlobalKeyDown","tagName","classList","contains","closest","select","firstInput","text","index","c","height","transition","strong","toUpperCase","PhoneOutlined","MailOutlined","HomeOutlined","getRowProps","onMouseEnter","currentTarget","onMouseLeave","focusSearch","timer","useHandleApiResponse","mutationResult","content","duration","destroy","handleSearchFocus","top","afterOpenChange","prefix","SearchOutlined","onFocus","suffix","UserAddOutlined","newState","background","boxShadow","position","overflow","right","zIndex","bottom","left","Row","justify","align","Col","level","WebkitBackgroundClip","WebkitTextFillColor","backgroundClip","marginRight","CloseOutlined","layout","gridTemplateColumns","Item","UserOutlined","rules","pattern","TextArea","rows","resize","Divider","maxHeight","textAlign","VendorSelectionModalComponent","selectedVendor","setSelectedVendor","vendorData","vendorLoading","useGetVendorQuery","vendors","filteredVendors","vendor","_vendor$vendor_name","_vendor$contact_numbe","_vendor$email","vendor_name","contact_number","getVendorTypeColor","premium","navigateToVendor","selectedRow","handleVendorSelect","ShopOutlined","vendor_type","userData","userLoading","useGetBillingUsersQuery","userList","users","items","selectedUser","setSelectedUser","currentUser","filteredUsers","user","_user$name","_user$email","_user$mobile","_user$user_name","_user$roleItems","_user$roleItems$name","user_name","roleItems","navigateToUser","handleUserSelect","u","_record$roleItems","_record$branchItems","branchItems","branch_name","currentUserInList","onNewBill","onContinueBill","savedBillData","centered","maskClosable","closable","FileTextOutlined","customer_name","CalendarOutlined","DollarOutlined","total_amount","parseFloat","onViewBill","billListData","useGetSalesRecordQuery","billList","activeTab","setActiveTab","filteredBills","statusFiltered","bill","_bill$customerDetails","invoiceNo","customerName","customerDetails","totalAmount","getPaymentStatusText","isPaid","isPartiallyPaid","handleViewBill","handleNewBill","Drawer","placement","bodyStyle","headerStyle","borderBottom","allowClear","Tabs","activeKey","Spin","Empty","List","renderItem","_bill$customerDetails2","transform","Avatar","is_paid","is_partially_paid","EyeOutlined","PrinterOutlined","borderTop","_productDetails$Varia","_productDetails$Varia2","_productDetails$Varia3","_productDetails$selli","_productDetails$mrp","_productDetails$Categ","_productDetails$Categ2","productDetails","setProductDetails","handleCancel","Descriptions","span","brand","unit","mrp","CategoryItem","tax_percentage","min_stock","max_stock","letterSpacing","userSelect","_user$organisationIte","_billFormData$items$s","billdata","onSuccess","dispatch","useDispatch","ProductsApi","CustomerApi","VendorApi","BillingUsersApi","SalesRecord","InvoiceNumberApi","branchId","branch_id","organisationsData","useGetOrganisationsQuery","organisationDetails","branchDetails","productListData","productLoading","refetchProducts","useGetAll","customerListData","refetchCustomers","vendorListData","refetchVendors","userListData","refetchUsers","stockAuditListData","stockLoading","refetchStockAudit","branchStockListData","branchStockLoading","refetchBranchStock","invoiceNoData","refetchInvoiceNo","productList","customerList","vendorList","stockAuditList","branchStockList","invoice_no_item","productListResult","customerListResult","vendorListResult","userListResult","stockAuditListResult","branchStockListResult","createSalesRecord","saleCreateLoading","update","updateSalesRecord","saleUpdateLoading","useUpdate","createInvoiceNumber","invoice_no_create_loading","createResponse","setCreateResponse","updateResponse","setUpdateResponse","billFormData","setBillFormData","productItem","_productItem$VariantI","pack_size","isValid","expectedLoose","totalAvailable","packSize","parseInt","availablePackQty","availableLooseQty","customer_id","billed_by_id","billed_by_name","payment_mode","billSettings","setBillSettings","isRetail","isGstIncluded","discount","discountType","paidAmount","stockModalRowIndex","setStockModalRowIndex","setExternalEditingCell","customerModalVisible","setCustomerModalVisible","userModalVisible","setUserModalVisible","saveConfirmationVisible","setSaveConfirmationVisible","billListDrawerVisible","setBillListDrawerVisible","setSavedBillData","productDetailsModalVisible","setProductDetailsModalVisible","selectedProductId","setSelectedProductId","productSelectionModalVisible","setProductSelectionModalVisible","productSelectionRowIndex","setProductSelectionRowIndex","lastInteractedRowIndex","setLastInteractedRowIndex","setDocumentType","default_document_type","validateStockQuantity","stockId","qty","looseQty","_stock$ProductItem$Va","maxLooseQty","packSizeNum","remainingPacks","handleQuantityChange","newItems","item","newQty","newLooseQty","loose_qty","_billdata$billedByDet","_billdata$Items","_billdata$is_paid","_billdata$is_partiall","_billdata$is_gst_incl","_billdata$discount","_billdata$discount_ty","_billdata$paid_amount","isInvoice","document_type","partyDetails","vendorDetails","partyId","vendor_id","partyName","billedByDetails","Items","_item$productItems","_item$productItems2","_item$productItems2$V","productItems","branch_stock_id","amount","sale_type","is_gst_included","discount_type","paid_amount","_invoice_no_item$resu","defaultItems","fill","_","productOptions","_product$VariantItem","customerOptions","vendorOptions","customerOrVendorOptions","userOptions","headerColumns","selectedItem","isVendor","placeholderText","tooltipText","borderColor","headerData","itemColumns","displayName","minHeight","stockData","isLowStock","hasStockData","flexWrap","whiteSpace","isExceedingStock","onPressEnter","newValue","_stock$ProductItem2","_stock$ProductItem2$V","qtyColIndex","billCalculations","itemsWithTax","_product$CategoryItem","taxPercentage","baseAmount","Number","sub_total","reduce","sum","base_sub_total","discountValue","total_gst","value_of_goods","forEach","discountedBase","gstAmount","cgst","sgst","calculateBillTotals","handleHeaderChange","headerRows","updatedHeader","handleItemsChange","updatedItems","_productOptions$find","billItem","_stock$ProductItem3","_stock$ProductItem3$V","availableStocks","_stock$ProductItem4","firstStock","qtyCell","_stock$ProductItem5","_stock$ProductItem5$V","_product$VariantItem2","sellPrice","looseRate","handleF5ProductSelection","info","openProductModalForRow","targetRowIndex","activeElement","focusedRow","getAttribute","focusedCell","handleAddItem","autoOpenProductModal","handleF7StockSelection","_billFormData$items$r","rowIndexNum","resetBill","showMessage","arguments","handleClearBill","forceResolveProductNamesAndStock","hasChanges","updated","_product$VariantItem6","stockListData","_item$batch_no","newItem","handleSaveDraft","payload","_response","response","statusCode","savedData","handleCompleteBill","some","stockValidationErrors","push","join","_response2","util","invalidateTags","_createResponse$data","_product$VariantItem7","interval","setInterval","clearInterval","productCell","test","input","dispatchEvent","Event","bubbles","styles","DocumentTypeToggle","Switch","checkedChildren","unCheckedChildren","checked","AntdEditableTable","Badge","count","showZero","indices","formatter","replace","parser","ClearOutlined","selectedParty","printData","customerAddress","address1","customerCity","city","customerState","state","customerPincode","pincode","customerPhone","phone","customerEmail","customer_gstin","gst_no","gst_number","gstin","customer_pan","pan_no","pan_number","total","lineHeight","_stock$ProductItem6","_stock$ProductItem6$V","invoice_id","savedStockData","CustomerSelectionModal","VendorSelectionModal","UserSelectionModal","BillSaveConfirmationModal","handleContinueBill","ProductDetailsModal","_product$VariantItem3","BillListDrawer","_bill$customer","_bill$is_paid","_bill$is_partially_pa","_bill$is_gst_included","sales_items","mappedItems","_item$productItems3","_item$product","variantName","_item$productItems$Va","_item$product$Variant","_product$VariantItem4","itemIndex","_foundProduct$Variant","batchNo","_result","stockList","currentStockList","foundStock","customerId","_customerList$result","formattedDate","finalMappedItems","_product$VariantItem5","entityName","entityHooks","getEntityHooks","entityRoutes","routes","API_ROUTES","Error","params","query","useGetQuery","useGetById","useGetByIdQuery","createMutation","useCreateMutation","unwrap","updateMutation","useUpdateMutation","useDelete","deleteMutation","useDeleteMutation","remove","delete","getRoutes","getAll","GetAll","get","Get","Create","Update","Delete","isSuccess","isError","reset","prevLoadingRef","handledRef","wasLoading","resultKey","refetchFn","_error$data","getRoute","_API_ROUTES$entityNam","route","createApiRouteGetter","createCrudOperations"],"sourceRoot":""}