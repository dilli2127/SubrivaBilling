"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[468],{19468:(e,t,l)=>{l.d(t,{A:()=>Ft});var i=l(89379),n=l(65043),o=l(83833),a=l(16569),r=l(96651),s=l(7866),d=l(12624),c=l(37490),u=l(95206),m=l(60446),p=l.n(m),v=l(62751),f=l(36621),x=l(26553),y=l(93504),_=l(6051),h=l(39249),g=l(73847),b=l(9316),j=l(88143),A=l(4825),k=l(97031),C=l(70579);const{Search:w}=f.A,I=e=>{var t;let{visible:l,onSelect:i,onCancel:o}=e;const{getEntityApi:a}=(0,A.p)(),r=a("Product"),{items:s,loading:d}=(0,k.Sm)(r.getIdentifier("GetAll")),[c,u]=(0,n.useState)(""),[m,p]=(0,n.useState)(null),[f,x]=(0,n.useState)(0),y=(0,n.useRef)(null),_=(null===s||void 0===s||null===(t=s.result)||void 0===t?void 0:t.filter((e=>{var t,l,i,n,o,a,r;const s=c.toLowerCase();return((null===(t=e.name)||void 0===t?void 0:t.toLowerCase())||"").includes(s)||((null===(l=e.sku)||void 0===l?void 0:l.toLowerCase())||"").includes(s)||(null===(i=e.VariantItem)||void 0===i||null===(n=i.variant_name)||void 0===n?void 0:n.toLowerCase().includes(s))||(null===(o=e.VariantItem)||void 0===o||null===(a=o.variant_code)||void 0===a?void 0:a.toLowerCase().includes(s))||((null===(r=e.selling_price)||void 0===r?void 0:r.toString())||"").includes(s)})).sort(((e,t)=>{var l,i,n,o,a,r,s,d,u,m,p,v,f,x,y,_;const h=c.toLowerCase(),g=((null===(l=e.name)||void 0===l?void 0:l.toLowerCase())||"")===h||(null===(i=e.VariantItem)||void 0===i||null===(n=i.variant_name)||void 0===n?void 0:n.toLowerCase())===h||((null===(o=e.sku)||void 0===o?void 0:o.toLowerCase())||"")===h,b=((null===(a=t.name)||void 0===a?void 0:a.toLowerCase())||"")===h||(null===(r=t.VariantItem)||void 0===r||null===(s=r.variant_name)||void 0===s?void 0:s.toLowerCase())===h||((null===(d=t.sku)||void 0===d?void 0:d.toLowerCase())||"")===h;if(g&&!b)return-1;if(!g&&b)return 1;const j=((null===(u=e.name)||void 0===u?void 0:u.toLowerCase())||"").startsWith(h)||(null===(m=e.VariantItem)||void 0===m||null===(p=m.variant_name)||void 0===p?void 0:p.toLowerCase().startsWith(h))||((null===(v=e.sku)||void 0===v?void 0:v.toLowerCase())||"").startsWith(h),A=((null===(f=t.name)||void 0===f?void 0:f.toLowerCase())||"").startsWith(h)||(null===(x=t.VariantItem)||void 0===x||null===(y=x.variant_name)||void 0===y?void 0:y.toLowerCase().startsWith(h))||((null===(_=t.sku)||void 0===_?void 0:_.toLowerCase())||"").startsWith(h);return j&&!A?-1:!j&&A?1:0})))||[];(0,n.useEffect)((()=>{x(0),_.length>0?p(_[0]._id):p(null)}),[c,l,s]),(0,n.useEffect)((()=>{l&&setTimeout((()=>{var e;null===(e=y.current)||void 0===e||e.focus()}),100)}),[l]);const g=[{title:"Product & Variant",dataIndex:"name",key:"name",width:250,render:(e,t)=>{var l,i;return(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{style:{fontWeight:600,color:"#1890ff"},children:e}),(null===(l=t.VariantItem)||void 0===l?void 0:l.variant_name)&&(0,C.jsxs)("div",{style:{fontSize:"12px",color:"#52c41a",marginTop:"2px"},children:["Variant: ",t.VariantItem.variant_name,(null===(i=t.VariantItem)||void 0===i?void 0:i.variant_code)&&(0,C.jsxs)("span",{style:{marginLeft:"8px",color:"#fa8c16",fontSize:"11px"},children:["(",t.VariantItem.variant_code,")"]})]})]})}},{title:"Variant",dataIndex:"VariantItem",key:"variant",width:120,render:e=>null!==e&&void 0!==e&&e.variant_name?(0,C.jsx)("span",{style:{color:"#52c41a",fontWeight:500},children:e.variant_name}):(0,C.jsx)("span",{style:{color:"#bfbfbf",fontStyle:"italic"},children:"No variant"})},{title:"SKU",dataIndex:"sku",key:"sku",width:120},{title:"Price",dataIndex:"selling_price",key:"selling_price",width:100,render:e=>(0,C.jsxs)("span",{style:{color:"#52c41a",fontWeight:600,fontSize:"14px"},children:["\u20b9",(null===e||void 0===e?void 0:e.toFixed(2))||"0.00"]})}],b=e=>{i(e)};return(0,C.jsx)(v.A,{title:"Select Product & Variant (F5 to reopen anytime)",open:l,onCancel:o,width:900,footer:null,destroyOnClose:!0,children:(0,C.jsxs)("div",{onClick:()=>{var e;null===(e=y.current)||void 0===e||e.focus()},children:[(0,C.jsx)(w,{ref:y,placeholder:"Search by product name, variant, SKU, or price (use \u2191\u2193 arrows to navigate, Enter to select)",onChange:e=>u(e.target.value),style:{marginBottom:16},autoFocus:!0,onKeyDown:e=>{var t;if(_.length)if("ArrowDown"===e.key)e.preventDefault(),x((e=>{const t=Math.min(e+1,_.length-1);return p(_[t]._id),t})),null===(t=y.current)||void 0===t||t.focus();else if("ArrowUp"===e.key){var l;e.preventDefault(),x((e=>{const t=Math.max(e-1,0);return p(_[t]._id),t})),null===(l=y.current)||void 0===l||l.focus()}else if("Enter"===e.key){e.preventDefault();const t=_[f];t&&b(t)}else"Escape"===e.key&&(e.preventDefault(),o())},onBlur:()=>{setTimeout((()=>{var e;l&&(null===(e=y.current)||void 0===e||e.focus())}),10)}}),(0,C.jsx)(h.A,{dataSource:_,columns:g,loading:d,rowKey:"_id",size:"small",pagination:!1,onRow:(e,t)=>({onClick:()=>{b(e),setTimeout((()=>{var e;null===(e=y.current)||void 0===e||e.focus()}),10)},onDoubleClick:()=>b(e),className:t===f?"ant-table-row ant-table-row-selected":"ant-table-row",style:{backgroundColor:t===f?"#e6f7ff":void 0,border:t===f?"2px solid #1890ff":void 0}}),rowSelection:{type:"radio",selectedRowKeys:m?[m]:[],onChange:e=>{p(e[0]);const t=_.findIndex((t=>t._id===e[0]));-1!==t&&x(t)}},scroll:{y:300}}),(0,C.jsxs)("div",{style:{marginTop:16,fontSize:"12px",color:"#666"},children:[(0,C.jsx)("strong",{children:"Keyboard Shortcuts:"})," \u2191\u2193 Navigate products | Enter Select | Escape Cancel",(0,C.jsx)("br",{}),(0,C.jsx)("strong",{children:"Search:"})," Product name, variant name, SKU, or price",(0,C.jsx)("br",{}),(0,C.jsx)("strong",{children:"Tip:"})," Press F5 anytime to reopen this modal for product changes"]})]})})};var S=l(76399),D=l(39470),N=l(46237);const{Search:T}=f.A,B=e=>{var t;let{visible:l,onSelect:i,onCancel:o,productId:s}=e;const{getEntityApi:d}=(0,A.p)(),c=d("StockAudit"),{items:u,loading:m}=(0,k.Sm)(c.getIdentifier("GetAll")),[f,x]=(0,n.useState)(""),[y,_]=(0,n.useState)(null),[g,b]=(0,n.useState)(0),[j,w]=(0,n.useState)(""),I=(0,n.useRef)(null),B=(0,n.useRef)(null),P=e=>!(!e.expiry_date||!p()(e.expiry_date).isBefore(p()())),E=e=>e.available_quantity<=0,G=e=>{const t=p()(e.expiry_date).format("DD/MM/YYYY"),l="Cannot select expired stock! This item expired on ".concat(t,". Please select a valid stock item.");w(l),a.Ay.error(l),setTimeout((()=>{w("")}),5e3)},q=e=>{const t="Cannot select out of stock item! This item has 0 available quantity. Please select a stock item with available quantity.";w(t),a.Ay.error(t),setTimeout((()=>{w("")}),5e3)},L=(null===u||void 0===u||null===(t=u.result)||void 0===t?void 0:t.filter((e=>{var t,l,i,n,o,a,r,s;const d=f.toLowerCase();return(null===(t=e.batch_no)||void 0===t?void 0:t.toLowerCase().includes(d))||(null===(l=e.ProductItem)||void 0===l||null===(i=l.name)||void 0===i?void 0:i.toLowerCase().includes(d))||(null===(n=e.ProductItem)||void 0===n||null===(o=n.VariantItem)||void 0===o||null===(a=o.variant_name)||void 0===a?void 0:a.toLowerCase().includes(d))||(null===(r=e.available_quantity)||void 0===r?void 0:r.toString().includes(d))||(null===(s=e.sell_price)||void 0===s?void 0:s.toString().includes(d))})))||[];(0,n.useEffect)((()=>{if(b(0),w(""),L.length>0){let e=0;for(;e<L.length&&(L[e].expiry_date&&p()(L[e].expiry_date).isBefore(p()())||L[e].available_quantity<=0);)e++;e<L.length?(_(L[e]._id),b(e)):_(null)}else _(null)}),[f,l,u]),(0,n.useEffect)((()=>{l&&(w(""),setTimeout((()=>{var e;null===(e=B.current)||void 0===e||e.focus()}),0))}),[l]),(0,n.useEffect)((()=>{if(I.current){var e;const t=I.current.querySelector(".ant-table-row[data-row-key='".concat(null===(e=L[g])||void 0===e?void 0:e._id,"']"));null===t||void 0===t||t.scrollIntoView({block:"nearest"})}}),[g,L]),(0,n.useEffect)((()=>{l&&s&&c("GetAll",{product:s})}),[l,s,c]);const z=[{title:"Product",dataIndex:"ProductItem",key:"product",render:e=>(null===e||void 0===e?void 0:e.name)||"N/A"},{title:"Variant",dataIndex:"ProductItem",key:"variant",render:e=>{var t;return(null===e||void 0===e||null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)||"N/A"}},{title:"Batch No",dataIndex:"batch_no",key:"batch_no"},{title:"Available",dataIndex:"available_quantity",key:"available_quantity",render:(e,t)=>{const l=e<=0;return(0,C.jsxs)("span",{style:{color:l?"#ff4d4f":"#52c41a",fontWeight:l?"bold":"normal"},children:[e,l&&(0,C.jsx)(D.A,{style:{marginLeft:4,color:"#ff4d4f"}})]})}},{title:"Price",dataIndex:"sell_price",key:"sell_price"},{title:"Expiry Date",dataIndex:"expiry_date",key:"expiry_date",render:(e,t)=>{if(!e)return(0,C.jsx)("span",{style:{color:"#999"},children:"No Expiry"});const l=p()(e),i=p()(),n=l.isBefore(i),o=l.diff(i,"days");let a="green",s=(0,C.jsx)(N.A,{}),d="Valid";return n?(a="red",s=(0,C.jsx)(D.A,{}),d="Expired"):o<=30&&(a="orange",s=(0,C.jsx)(D.A,{}),d="Expires in ".concat(o," days")),(0,C.jsx)(r.A,{title:d,children:(0,C.jsx)(S.A,{color:a,icon:s,children:l.format("DD/MM/YYYY")})})}}],R=e=>{var t;P(e)?G(e):E(e)?q():(w(""),i({id:e._id,_id:e._id,batch_no:e.batch_no,name:(null===(t=e.ProductItem)||void 0===t?void 0:t.name)||e.name||"",code:e.code,available_quantity:e.available_quantity,sell_price:e.sell_price}))};return(0,C.jsx)(v.A,{title:"Select Stock (F7 to reopen anytime)",open:l,onCancel:o,width:800,footer:null,destroyOnClose:!0,children:(0,C.jsxs)("div",{onClick:()=>{var e;null===(e=B.current)||void 0===e||e.focus()},children:[(0,C.jsx)(T,{ref:B,placeholder:"Search stocks (use \u2191\u2193 arrows to navigate, Enter to select)",onChange:e=>x(e.target.value),style:{marginBottom:16},autoFocus:!0,onKeyDown:e=>{var t;if(L.length)if("ArrowDown"===e.key)e.preventDefault(),b((e=>{let t=e+1;for(;t<L.length&&(L[t].expiry_date&&p()(L[t].expiry_date).isBefore(p()())||L[t].available_quantity<=0);)t++;const l=Math.min(t,L.length-1);return _(L[l]._id),l})),null===(t=B.current)||void 0===t||t.focus();else if("ArrowUp"===e.key){var l;e.preventDefault(),b((e=>{let t=e-1;for(;t>=0&&(L[t].expiry_date&&p()(L[t].expiry_date).isBefore(p()())||L[t].available_quantity<=0);)t--;const l=Math.max(t,0);return _(L[l]._id),l})),null===(l=B.current)||void 0===l||l.focus()}else if("Enter"===e.key){e.preventDefault();const t=L[g];t&&(R(t),P(t)||E(t)||o())}},onBlur:()=>{setTimeout((()=>{var e;l&&(null===(e=B.current)||void 0===e||e.focus())}),10)}}),j&&(0,C.jsxs)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#cf1322",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px"},children:[(0,C.jsx)(D.A,{style:{color:"#cf1322"}}),j]}),(0,C.jsxs)("div",{onKeyDown:e=>{var t;if(L.length)if("ArrowDown"===e.key)e.preventDefault(),b((e=>{let t=e+1;for(;t<L.length&&(L[t].expiry_date&&p()(L[t].expiry_date).isBefore(p()())||L[t].available_quantity<=0);)t++;const l=Math.min(t,L.length-1);return _(L[l]._id),l})),null===(t=B.current)||void 0===t||t.focus();else if("ArrowUp"===e.key)e.preventDefault(),b((e=>{let t=e-1;for(;t>=0&&(L[t].expiry_date&&p()(L[t].expiry_date).isBefore(p()())||L[t].available_quantity<=0);)t--;const l=Math.max(t,0);return _(L[l]._id),l}));else if("Enter"===e.key){e.preventDefault();const t=L[g];t&&(R(t),P(t)||E(t)||o())}else if("Escape"===e.key){var l;e.preventDefault(),null===(l=B.current)||void 0===l||l.focus()}else if("Tab"===e.key&&e.shiftKey){var i;e.preventDefault(),null===(i=B.current)||void 0===i||i.focus()}},tabIndex:0,ref:I,style:{outline:"none"},children:[(0,C.jsx)(h.A,{dataSource:L,columns:z,loading:m,rowKey:"_id",size:"small",pagination:!1,title:()=>(0,C.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0"},children:[(0,C.jsx)("span",{children:"Stock Items"}),(0,C.jsxs)("div",{style:{fontSize:"12px",color:"#666"},children:[(0,C.jsx)("span",{style:{color:"#52c41a"},children:"\ud83d\udfe2 Valid"}),(0,C.jsx)("span",{style:{margin:"0 8px",color:"#faad14"},children:"\ud83d\udfe0 Near Expiry"}),(0,C.jsx)("span",{style:{color:"#ff4d4f"},children:"\ud83d\udd34 Expired/Out of Stock (Disabled)"})]})]}),onRow:(e,t)=>{const l=P(e),i=E(e);return{onClick:()=>{l||i?l?G(e):i&&q():(R(e),setTimeout((()=>{var e;null===(e=B.current)||void 0===e||e.focus()}),10))},onDoubleClick:()=>{l||i?l?G(e):i&&q():R(e)},className:t===g?"ant-table-row ant-table-row-selected":"ant-table-row","data-row-key":e._id,style:{opacity:l||i?.6:1,cursor:l||i?"not-allowed":"pointer",backgroundColor:l||i?"#f5f5f5":void 0}}},rowSelection:{type:"radio",selectedRowKeys:y?[y]:[],onChange:e=>{_(e[0]);const t=L.findIndex((t=>t._id===e[0]));-1!==t&&b(t)},getCheckboxProps:e=>({disabled:P(e)||E(e)})}}),(0,C.jsxs)("div",{style:{marginTop:16,fontSize:"12px",color:"#666"},children:[(0,C.jsx)("strong",{children:"Keyboard Shortcuts:"})," \u2191\u2193 Navigate stocks | Enter Select | Escape Cancel",(0,C.jsx)("br",{}),(0,C.jsx)("strong",{children:"Tip:"})," Press F7 anytime to reopen this modal for stock changes",(0,C.jsx)("br",{}),(0,C.jsx)("strong",{children:"Note:"})," Expired items (\ud83d\udd34) and out of stock items (\ud83d\udd34) are shown but cannot be selected. Navigation automatically skips expired and out of stock items.",(0,C.jsx)("br",{}),(0,C.jsx)("strong",{children:"Error Handling:"})," Attempting to select expired or out of stock items will show an error message and prevent selection."]})]})]})})},{Text:P}=o.A,E=e=>{let{columns:t,dataSource:l,onSave:o,onAdd:r,onDelete:d,allowAdd:c=!0,allowDelete:m=!0,rowKey:A="key",loading:k=!1,compact:w=!1,enableKeyboardNav:S=!0,size:D="middle",className:N,onProductSelect:T,externalEditingCell:E}=e;const[G,q]=(0,n.useState)([]),[L,z]=(0,n.useState)([]),[R,M]=(0,n.useState)(null),V=(0,n.useRef)(!0);(0,n.useEffect)((()=>{q(l);const e=t.findIndex((e=>"product_id"===e.dataIndex));V.current&&0===l.length&&e>=0?(M({row:0,col:e}),V.current=!1):z(l.length>0?[String(l.length-1)]:[])}),[l,t]),(0,n.useEffect)((()=>{E&&M(E)}),[E]);const F=()=>{null===r||void 0===r||r();const e=t.findIndex((e=>!1!==e.editable));e>=0&&M({row:G.length,col:e})},Y=(e,l,i)=>{const n=t[l];if(n.required&&(!i||""===i))return a.Ay.error("".concat(n.title," is required")),!1;if(n.validation){const e=n.validation(i);if(e)return a.Ay.error(e),!1}const r=[...G];return r[e][t[l].dataIndex]=i,q(r),o(r),!0};(0,n.useEffect)((()=>{const e=e=>{e.ctrlKey&&"s"===e.key&&(e.preventDefault(),o(G)),e.shiftKey&&"a"===e.key.toLowerCase()&&c&&(e.preventDefault(),F())};if(S)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[G,c,o,S,F]);const U={onChange:(e,t)=>{z([...e])}};function K(e,t,l){let i=e+t;for(;i>=0&&i<l.length;){if(!1!==l[i].editable)return i;i+=t}return-1}const W=e=>{var l,i;let{row:r,col:d,value:u}=e;const[m,v]=(0,n.useState)(u),_=(0,n.useRef)(null),h=t[d],[g,b]=(0,n.useState)(!1),[j,A]=(0,n.useState)(!1);(0,n.useEffect)((()=>{v(u),setTimeout((()=>{var e;null===(e=_.current)||void 0===e||e.focus()}),50)}),[u]);const k=e=>{v(e),Y(r,d,e)},w=e=>{if("product"===h.type&&"Enter"===e.key)return e.stopPropagation(),void b(!0);if("stock"===h.type&&"Enter"===e.key)return e.stopPropagation(),void A(!0);if("Tab"===e.key){if(e.preventDefault(),h.required&&(!m||""===m))return void a.Ay.error("".concat(h.title," is required"));const l=e.shiftKey?d-1:d+1,i=r+(l>=t.length?1:0),n=(l+t.length)%t.length;i<G.length?M({row:i,col:n}):c&&(F(),M({row:G.length,col:n}))}else"Escape"===e.key&&M(null)},S=e=>{T&&T(e,r),b(!1),M(null)},D=e=>{const t=[...G];t[r].stock_id=e.id||e._id||"",t[r].batch_no=e.batch_no||"",q(t),o(t),A(!1),M(null)};switch(h.type){case"product":return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,C.jsx)(f.A,{ref:_,value:m,onKeyDown:w,placeholder:"Press Enter to select product"})}),g&&(0,C.jsx)(I,{visible:g,onSelect:S,onCancel:()=>b(!1)})]});case"stock":return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,C.jsx)(f.A,{ref:_,value:(null===(l=G[r])||void 0===l?void 0:l.batch_no)||m,onKeyDown:w,placeholder:"Press Enter to select stock",readOnly:!0})}),j&&(0,C.jsx)(B,{visible:j,onSelect:D,onCancel:()=>A(!1),productId:(null===(i=G[r])||void 0===i?void 0:i.product_id)||""})]});case"number":return(0,C.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,C.jsx)(s.A,{ref:_,value:m,onChange:k,onBlur:()=>M(null),controls:!1,onKeyDown:e=>{if("Tab"===e.key||"Enter"===e.key){if(e.preventDefault(),h.required&&(!m||""===m))return void a.Ay.error("".concat(h.title," is required"));const l=e.shiftKey?-1:1,i=K(d,l,t);if(-1!==i)M({row:r,col:i});else{const e=l>0?r+1:r-1;if(e>=0&&e<G.length){const l=K(-1,1,t);-1!==l&&M({row:e,col:l})}else if(l>0&&c){F();const e=K(-1,1,t);-1!==e&&M({row:G.length,col:e})}else M(null)}}else"Escape"===e.key&&M(null)},style:{width:"100%"}})});case"select":return(0,C.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,C.jsx)(x.A,{ref:_,value:m,options:h.options,onChange:e=>{if(Y(r,d,e)){const e=d+1,l=r+(e>=t.length?1:0),i=(e+t.length)%t.length;l<G.length?M({row:l,col:i}):c&&(F(),M({row:G.length,col:i}))}else setTimeout((()=>{var e;null===(e=_.current)||void 0===e||e.focus()}),50)},style:{width:"100%"},onKeyDown:e=>{"Enter"!==e.key&&"Tab"!==e.key||e.preventDefault()}})});case"date":return(0,C.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,C.jsx)(y.A,{ref:_,value:m?p()(m):null,onChange:e=>{k(e?e.format("YYYY-MM-DD"):null),M(null)},onBlur:()=>M(null),onKeyDown:w,style:{width:"100%"}})});default:return(0,C.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,C.jsx)(f.A,{ref:_,value:m,onChange:e=>k(e.target.value),onBlur:()=>M(null),onKeyDown:w})})}},O=t.map(((e,t)=>(0,i.A)((0,i.A)({},e),{},{onCell:(e,l)=>({onClick:()=>{"number"===typeof l&&M({row:l,col:t})},onContextMenu:e=>{e.preventDefault(),"number"===typeof l&&M({row:l,col:t})}}),render:(l,i,n)=>{if(R&&R.row===n&&R.col===t)return(0,C.jsx)(W,{row:n,col:t,value:i[e.dataIndex]},"".concat(n,"-").concat(t));if("function"===typeof e.render)return e.render(l,i,n);if("batch_no"===e.dataIndex)return i.batch_no||i[e.dataIndex];if("product_id"===e.dataIndex)return i.product_name||i[e.dataIndex];if("select"===e.type&&e.options){const t=e.options.find((t=>t.value===i[e.dataIndex]));return t?t.label:i[e.dataIndex]}return i[e.dataIndex]}})));return(0,C.jsxs)("div",{className:"antd-editable-table ".concat(w?"compact":""," ").concat(N||""),children:[(0,C.jsxs)("div",{className:"table-toolbar",children:[(0,C.jsxs)(_.A,{children:[c&&(0,C.jsx)(u.Ay,{type:"primary",icon:(0,C.jsx)(g.A,{}),onClick:F,children:"Add Row (Shift+A)"}),m&&(0,C.jsx)(u.Ay,{danger:!0,icon:(0,C.jsx)(b.A,{}),onClick:()=>{0!==G.length?v.A.confirm({title:"Are you sure you want to delete the selected Bill Items?",onOk:()=>{const e=G.slice(0,-1);q(e),o(e),null===d||void 0===d||d(L)}}):a.Ay.warning("No rows to delete")},children:"Delete Row"}),(0,C.jsx)(u.Ay,{type:"primary",icon:(0,C.jsx)(j.A,{}),onClick:()=>o(G),children:"Save (Ctrl+S)"})]}),(0,C.jsx)(P,{type:"secondary",className:"table-info",children:"Use Tab / Shift+Tab to navigate cells"})]}),(0,C.jsx)(h.A,{bordered:!0,dataSource:G,columns:O,rowKey:A,loading:k,pagination:!1,size:D,scroll:{y:400},rowSelection:(0,i.A)((0,i.A)({},U),{},{type:"checkbox",selectedRowKeys:L})})]})};var G=l(94211),q=l(36091),L=l(93310),z=l(94834),R=l(62305),M=l(47419),V=l(11645),F=l(8354),Y=l(87534),U=l(75388),K=l(46011),W=l(72411),O=l(67177),H=l(15615),Q=l(53722);const{Title:J,Text:X}=o.A,{Option:Z}=x.A,$=e=>{let{visible:t,onSelect:l,onCancel:o}=e;const{getEntityApi:r}=(0,A.p)(),s=r("Customer"),{items:d,loading:c}=(0,k.Sm)(s.getIdentifier("GetAll")),{loading:m}=(0,k.Sm)(s.getIdentifier("Create")),p=(null===d||void 0===d?void 0:d.items)||(null===d||void 0===d?void 0:d.result)||[],[x,y]=(0,n.useState)(""),[b,w]=(0,n.useState)(!1),[I,D]=(0,n.useState)(null),[N,T]=(0,n.useState)(-1),[B,P]=(0,n.useState)(!1),[E,q]=(0,n.useState)({full_name:"",email:"",mobile:"",address:"",customer_type:"regular"}),[L]=R.A.useForm(),z=(0,n.useRef)(null),Z=(0,n.useRef)(null),$=(0,n.useRef)(null),ee=(0,n.useRef)(null),te=(0,n.useRef)(null),le=(0,n.useMemo)((()=>p),[p]),ie=(0,n.useMemo)((()=>x.trim()&&!c&&0===le.length),[x,c,le.length]),ne=(0,n.useCallback)((e=>({vip:"gold",wholesale:"blue",regular:"green"}[e]||"green")),[]),oe=(0,n.useCallback)((e=>{if(0===le.length)return;let t;switch(e){case"up":t=-1===N?le.length-1:Math.max(N-1,0);break;case"down":t=-1===N?0:Math.min(N+1,le.length-1);break;case"home":t=0;break;case"end":t=le.length-1;break;default:return}T(t),D(le[t]),setTimeout((()=>{const l=document.querySelector('[data-row-key="'.concat(le[t]._id,'"]'));if(l){const t="home"===e?"start":"end"===e?"end":"nearest";l.scrollIntoView({behavior:"smooth",block:t})}}),100)}),[le,N]),ae=(0,n.useCallback)((e=>{y(e),$.current&&clearTimeout($.current),$.current=setTimeout((()=>{e.trim()?s("GetAll",{searchString:e.trim()}):s("GetAll")}),500)}),[s]),re=(0,n.useCallback)((e=>{D(e),l(e),setTimeout((()=>o()),100)}),[l,o]),se=(0,n.useCallback)((async()=>{try{if(!E.full_name.trim())return void a.Ay.error("Full name is required");if(!E.mobile.trim())return void a.Ay.error("Mobile number is required");await s("Create",E)}catch(e){a.Ay.error("Failed to create customer"),de()}}),[E,s]),de=(0,n.useCallback)((()=>{q({full_name:"",email:"",mobile:"",address:"",customer_type:"regular"}),L.resetFields()}),[L]),ce=(0,n.useCallback)(((e,t)=>{q((l=>(0,i.A)((0,i.A)({},l),{},{[e]:t})))}),[]),ue=(0,n.useCallback)((e=>{if("Escape"===e.key)o();else if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();oe({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}),[oe,o]),me=(0,n.useCallback)((e=>{if(!t)return;const l=e.target;if("INPUT"!==l.tagName&&"TEXTAREA"!==l.tagName&&!l.classList.contains("ant-select-selector")&&!l.closest(".ant-select-dropdown")){if(e.ctrlKey&&"f"===e.key)return e.preventDefault(),e.stopPropagation(),void(z.current&&(z.current.focus(),z.current.select()));if(e.ctrlKey&&"n"===e.key)return e.preventDefault(),e.stopPropagation(),void(ie&&(P(!0),setTimeout((()=>{if(ee.current){const e=ee.current.querySelector("input");e&&(e.focus(),e.select())}}),100)));if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();oe({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}}),[t,oe,ie]),pe=(0,n.useMemo)((()=>[{title:"",key:"select",width:60,render:(e,t)=>(0,C.jsx)("div",{style:{cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>{D(t);const e=le.findIndex((e=>e._id===t._id));T(e)},children:(0,C.jsx)("div",{style:{width:"18px",height:"18px",borderRadius:"50%",border:(null===I||void 0===I?void 0:I._id)===t._id?"2px solid #1890ff":"2px solid #d9d9d9",backgroundColor:(null===I||void 0===I?void 0:I._id)===t._id?"#1890ff":"white",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:(null===I||void 0===I?void 0:I._id)===t._id&&(0,C.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"white"}})})})},{title:"Customer Name",dataIndex:"full_name",key:"full_name",render:(e,t)=>(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,C.jsx)(X,{strong:!0,children:e}),(0,C.jsx)(S.A,{color:ne(t.customer_type),children:t.customer_type.toUpperCase()})]})},{title:"Mobile",dataIndex:"mobile",key:"mobile",render:e=>(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,C.jsx)(Y.A,{style:{color:"#666"}}),(0,C.jsx)(X,{children:e})]})},{title:"Email",dataIndex:"email",key:"email",render:e=>(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,C.jsx)(U.A,{style:{color:"#666"}}),(0,C.jsx)(X,{children:e||"-"})]})},{title:"Address",dataIndex:"address",key:"address",render:e=>(0,C.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[(0,C.jsx)(K.A,{style:{color:"#666",marginTop:"2px"}}),(0,C.jsx)(X,{type:"secondary",style:{fontSize:"12px"},children:e||"-"})]})}]),[I,le,ne]),ve=(0,n.useCallback)(((e,t)=>({onClick:()=>{D(e),T(null!==t&&void 0!==t?t:0)},style:{cursor:"pointer",backgroundColor:(null===I||void 0===I?void 0:I._id)===e._id?"#f0f8ff":"white",border:(null===I||void 0===I?void 0:I._id)===e._id?"2px solid #1890ff":"1px solid #f0f0f0",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:t=>{(null===I||void 0===I?void 0:I._id)!==e._id&&(t.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:t=>{(null===I||void 0===I?void 0:I._id)!==e._id&&(t.currentTarget.style.backgroundColor="white")}})),[I]);(0,n.useEffect)((()=>(t?(s("GetAll"),D(null),T(-1),P(!1)):(y(""),D(null),T(-1),P(!1),w(!1),de(),$.current&&(clearTimeout($.current),$.current=null)),()=>{$.current&&clearTimeout($.current)})),[t,s,de]),(0,n.useEffect)((()=>{!ie||B||b||P(!0)}),[ie,B,b]),(0,n.useEffect)((()=>{if(t&&z.current&&!b&&!B){const e=()=>{z.current&&(z.current.focus(),z.current.select())};e();const t=setTimeout(e,100);return()=>clearTimeout(t)}}),[t,b,B]),(0,n.useEffect)((()=>{if((b||B)&&t){const e=setTimeout((()=>{te.current&&(te.current.focus(),te.current.select())}),100);return()=>clearTimeout(e)}}),[b,B,t]),(0,n.useEffect)((()=>{if(t)return document.addEventListener("keydown",me,!0),()=>document.removeEventListener("keydown",me,!0)}),[t,me]),(0,G.z)({action:"create",title:"Customer",identifier:s.getIdentifier("Create"),entityApi:s});const{items:fe}=(0,k.Sm)(s.getIdentifier("Create"));(0,n.useEffect)((()=>{m?a.Ay.loading({content:"Creating customer...",key:"customer-creation",duration:0}):a.Ay.destroy("customer-creation")}),[m]),(0,n.useEffect)((()=>{if(fe)if(200===fe.statusCode){const e=fe.data||fe.result;e&&(de(),w(!1),P(!1),s("GetAll"),setTimeout((()=>{l(e),o()}),100))}else fe.statusCode&&200!==fe.statusCode&&(a.Ay.error(fe.message||"Failed to create customer"),de())}),[fe,l,o,s,de]);const xe=(0,n.useCallback)((()=>{D(null),T(-1)}),[]);return(0,C.jsxs)(v.A,{title:"Select Customer",open:t,onCancel:o,footer:null,width:1e3,style:{top:20},afterOpenChange:e=>{e&&z.current&&!b&&!B&&setTimeout((()=>{var e,t;null===(e=z.current)||void 0===e||e.focus(),null===(t=z.current)||void 0===t||t.select()}),100)},children:[(0,C.jsx)("div",{ref:Z,style:{marginBottom:16},onKeyDown:ue,tabIndex:0,children:(0,C.jsxs)(_.A.Compact,{style:{width:"100%"},children:[(0,C.jsx)(f.A,{ref:z,placeholder:"Search customers... (Ctrl+N: New customer, \u2191\u2193: Navigate, Enter: Select, Esc: Close)",value:x,onChange:e=>ae(e.target.value),prefix:(0,C.jsx)(W.A,{}),style:{flex:1},onKeyDown:e=>{"Enter"===e.key&&I&&re(I)},onFocus:xe,autoFocus:!b&&!B,onBlur:b||B?void 0:()=>{t&&z.current&&setTimeout((()=>{t&&z.current&&!b&&!B&&z.current.focus()}),10)},suffix:x&&c?(0,C.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:"Searching..."}):null}),(0,C.jsx)(u.Ay,{type:b?"default":"primary",icon:(0,C.jsx)(O.A,{}),onClick:()=>{const e=!b;w(e),e||de()},style:{minWidth:120},children:b?"Cancel":"Add New"})]})}),(B||b)&&(0,C.jsxs)("div",{ref:ee,style:{marginBottom:20,padding:24,border:"2px solid #6366f1",borderRadius:16,backgroundColor:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",overflow:"hidden"},tabIndex:-1,children:[(0,C.jsx)("div",{style:{position:"absolute",top:-20,right:-20,width:100,height:100,borderRadius:"50%",background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",opacity:.1,zIndex:0}}),(0,C.jsx)("div",{style:{position:"absolute",bottom:-30,left:-30,width:80,height:80,borderRadius:"50%",background:"linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)",opacity:.1,zIndex:0}}),(0,C.jsxs)(M.A,{justify:"space-between",align:"middle",style:{marginBottom:24,position:"relative",zIndex:1},children:[(0,C.jsxs)(V.A,{children:[(0,C.jsxs)(J,{level:4,style:{margin:0,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",fontWeight:700,fontSize:"20px"},children:[(0,C.jsx)(g.A,{style:{marginRight:8,color:"#6366f1"}}),"Create New Customer"]}),(0,C.jsx)(X,{style:{fontSize:"14px",color:"#64748b",fontWeight:500,display:"block",marginTop:4},children:"\u2728 Fill in the details below to create a new customer"})]}),(0,C.jsx)(V.A,{children:(0,C.jsxs)(_.A,{size:"middle",children:[(0,C.jsx)(u.Ay,{size:"middle",icon:(0,C.jsx)(H.A,{}),onClick:()=>{P(!1),w(!1),s("GetAll"),de()},style:{border:"2px solid #e2e8f0",borderRadius:8,fontWeight:600,color:"#64748b",background:"white",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",height:40,padding:"0 20px"},children:"Cancel"}),(0,C.jsx)(u.Ay,{type:"primary",size:"middle",icon:(0,C.jsx)(j.A,{}),onClick:se,loading:m,style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none",borderRadius:8,fontWeight:600,height:40,padding:"0 24px",boxShadow:"0 4px 12px rgba(99, 102, 241, 0.3)",transition:"all 0.3s ease"},children:"Create & Select"})]})})]}),(0,C.jsxs)(R.A,{form:L,layout:"vertical",size:"middle",style:{position:"relative",zIndex:1},children:[(0,C.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginBottom:20},children:[(0,C.jsx)(R.A.Item,{name:"full_name",label:(0,C.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,C.jsx)(Q.A,{style:{color:"#6366f1"}}),"Full Name"]}),rules:[{required:!0,message:"Please enter full name"}],children:(0,C.jsx)(f.A,{ref:te,name:"full_name",placeholder:"Enter full name",prefix:(0,C.jsx)(Q.A,{style:{color:"#9ca3af"}}),autoFocus:b||B,value:E.full_name,onChange:e=>ce("full_name",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),se())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white"}})}),(0,C.jsx)(R.A.Item,{name:"mobile",label:(0,C.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,C.jsx)(Y.A,{style:{color:"#10b981"}}),"Mobile Number"]}),rules:[{required:!0,message:"Please enter mobile number"},{pattern:/^[0-9]{10}$/,message:"Mobile must be 10 digits"}],children:(0,C.jsx)(f.A,{name:"mobile",placeholder:"Enter mobile number",prefix:(0,C.jsx)(Y.A,{style:{color:"#9ca3af"}}),value:E.mobile,onChange:e=>ce("mobile",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),se())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white"}})}),(0,C.jsx)(R.A.Item,{name:"email",label:(0,C.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,C.jsx)(U.A,{style:{color:"#f59e0b"}}),"Email"]}),rules:[{type:"email",message:"Please enter valid email"}],children:(0,C.jsx)(f.A,{name:"email",placeholder:"Enter email",prefix:(0,C.jsx)(U.A,{style:{color:"#9ca3af"}}),value:E.email,onChange:e=>ce("email",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),se())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white"}})})]}),(0,C.jsx)(R.A.Item,{name:"address",label:(0,C.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,C.jsx)(K.A,{style:{color:"#ef4444"}}),"Address"]}),children:(0,C.jsx)(f.A.TextArea,{name:"address",placeholder:"Enter address",rows:3,value:E.address,onChange:e=>ce("address",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),se())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white",resize:"none"}})})]})]}),(0,C.jsx)(F.A,{style:{margin:"16px 0"}}),(0,C.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:c?(0,C.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,C.jsx)(X,{children:"Loading customers..."})}):0===le.length?(0,C.jsxs)("div",{style:{textAlign:"center",padding:40},children:[(0,C.jsx)(X,{type:"secondary",children:x?"No customers found matching your search.":"No customers available."}),x&&(0,C.jsx)("div",{style:{marginTop:16},children:(0,C.jsx)(X,{type:"secondary",children:"Press Ctrl+N to create a new customer instantly"})})]}):(0,C.jsx)(h.A,{columns:pe,dataSource:le,rowKey:"_id",pagination:!1,size:"small",scroll:{y:300},onRow:ve})})]})},{Title:ee,Text:te}=o.A,le=e=>{let{visible:t,onSelect:l,onCancel:i}=e;const{getEntityApi:o}=(0,A.p)(),a=o("BillingUsers"),{items:r,loading:s}=(0,k.Sm)(a.getIdentifier("GetAll")),d=(null===r||void 0===r?void 0:r.items)||(null===r||void 0===r?void 0:r.result)||[],[c,u]=(0,n.useState)(""),[m,p]=(0,n.useState)(null),[x,y]=(0,n.useState)(-1),_=(0,n.useMemo)((()=>{try{return JSON.parse(sessionStorage.getItem("user")||"{}")}catch(e){return{}}}),[]),g=(0,n.useRef)(null),b=(0,n.useRef)(null),j=(0,n.useRef)(null),w=(0,n.useMemo)((()=>{if(!c.trim())return d;const e=c.toLowerCase();return d.filter((t=>{var l,i,n,o,a,r;return(null===(l=t.name)||void 0===l?void 0:l.toLowerCase().includes(e))||(null===(i=t.email)||void 0===i?void 0:i.toLowerCase().includes(e))||(null===(n=t.mobile)||void 0===n?void 0:n.toLowerCase().includes(e))||(null===(o=t.user_name)||void 0===o?void 0:o.toLowerCase().includes(e))||(null===(a=t.roleItems)||void 0===a||null===(r=a.name)||void 0===r?void 0:r.toLowerCase().includes(e))}))}),[d,c]),I=(0,n.useCallback)((e=>{if(0===w.length)return;let t;switch(e){case"up":t=-1===x?w.length-1:Math.max(x-1,0);break;case"down":t=-1===x?0:Math.min(x+1,w.length-1);break;case"home":t=0;break;case"end":t=w.length-1;break;default:return}y(t),p(w[t]),setTimeout((()=>{const l=document.querySelector('[data-row-key="'.concat(w[t]._id,'"]'));if(l){const t="home"===e?"start":"end"===e?"end":"nearest";l.scrollIntoView({behavior:"smooth",block:t})}}),100)}),[w,x]),D=(0,n.useCallback)((e=>{u(e),j.current&&clearTimeout(j.current),j.current=setTimeout((()=>{e.trim()?a("GetAll",{searchString:e.trim()}):a("GetAll")}),300)}),[a]),N=(0,n.useCallback)((e=>{p(e),l(e),setTimeout((()=>i()),100)}),[l,i]),T=(0,n.useCallback)((e=>{if("Escape"===e.key)i();else if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();I({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}),[I,i]),B=(0,n.useCallback)((e=>{if(!t)return;const l=e.target;if("INPUT"!==l.tagName&&"TEXTAREA"!==l.tagName&&!l.classList.contains("ant-select-selector")&&!l.closest(".ant-select-dropdown")){if(e.ctrlKey&&"f"===e.key)return e.preventDefault(),e.stopPropagation(),void(g.current&&(g.current.focus(),g.current.select()));if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();I({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}}),[t,I]),P=(0,n.useMemo)((()=>[{title:"",key:"select",width:60,render:(e,t)=>(0,C.jsx)("div",{style:{cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>{p(t);const e=w.findIndex((e=>e._id===t._id));y(e)},children:(0,C.jsx)("div",{style:{width:"18px",height:"18px",borderRadius:"50%",border:(null===m||void 0===m?void 0:m._id)===t._id?"2px solid #1890ff":"2px solid #d9d9d9",backgroundColor:(null===m||void 0===m?void 0:m._id)===t._id?"#1890ff":"white",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:(null===m||void 0===m?void 0:m._id)===t._id&&(0,C.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"white"}})})})},{title:"Name",dataIndex:"name",key:"name",render:(e,t)=>(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,C.jsx)(Q.A,{style:{color:"#1890ff"}}),(0,C.jsxs)("div",{children:[(0,C.jsx)(te,{strong:!0,children:e}),(0,C.jsx)("br",{}),(0,C.jsxs)(te,{type:"secondary",style:{fontSize:"12px"},children:["@",t.user_name]})]})]})},{title:"Role",key:"role",render:(e,t)=>{var l;return(0,C.jsx)(S.A,{color:"blue",children:(null===(l=t.roleItems)||void 0===l?void 0:l.name)||"No Role"})}},{title:"Mobile",dataIndex:"mobile",key:"mobile",render:e=>(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,C.jsx)(Y.A,{style:{color:"#666"}}),(0,C.jsx)(te,{children:e})]})},{title:"Email",dataIndex:"email",key:"email",render:e=>(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,C.jsx)(U.A,{style:{color:"#666"}}),(0,C.jsx)(te,{children:e||"-"})]})},{title:"Branch",key:"branch",render:(e,t)=>{var l;return(0,C.jsx)(te,{type:"secondary",style:{fontSize:"12px"},children:(null===(l=t.branchItems)||void 0===l?void 0:l.branch_name)||"-"})}}]),[m,w]),E=(0,n.useCallback)(((e,t)=>({onClick:()=>{p(e),y(null!==t&&void 0!==t?t:0)},style:{cursor:"pointer",backgroundColor:(null===m||void 0===m?void 0:m._id)===e._id?"#f0f8ff":"white",border:(null===m||void 0===m?void 0:m._id)===e._id?"2px solid #1890ff":"1px solid #f0f0f0",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:t=>{(null===m||void 0===m?void 0:m._id)!==e._id&&(t.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:t=>{(null===m||void 0===m?void 0:m._id)!==e._id&&(t.currentTarget.style.backgroundColor="white")}})),[m]);(0,n.useEffect)((()=>(t?(a("GetAll"),p(null),y(-1)):(u(""),p(null),y(-1),j.current&&(clearTimeout(j.current),j.current=null)),()=>{j.current&&clearTimeout(j.current)})),[t,a]),(0,n.useEffect)((()=>{if(t&&d.length>0&&_._id&&!m){const e=d.find((e=>e._id===_._id));if(e){p(e);const t=d.findIndex((e=>e._id===_._id));y(t),setTimeout((()=>{const t=document.querySelector('[data-row-key="'.concat(e._id,'"]'));t&&t.scrollIntoView({behavior:"smooth",block:"center"})}),200)}}}),[t,d,_._id,m]),(0,n.useEffect)((()=>{if(t&&g.current){const e=()=>{g.current&&(g.current.focus(),g.current.select())};e();const t=setTimeout(e,100);return()=>clearTimeout(t)}}),[t]),(0,n.useEffect)((()=>{if(t)return document.addEventListener("keydown",B,!0),()=>document.removeEventListener("keydown",B,!0)}),[t,B]);const G=(0,n.useCallback)((()=>{p(null),y(-1)}),[]);return(0,C.jsxs)(v.A,{title:"Select User (Billed By)",open:t,onCancel:i,footer:null,width:900,style:{top:20},afterOpenChange:e=>{e&&g.current&&setTimeout((()=>{var e,t;null===(e=g.current)||void 0===e||e.focus(),null===(t=g.current)||void 0===t||t.select()}),100)},children:[(0,C.jsx)("div",{ref:b,style:{marginBottom:16},onKeyDown:T,tabIndex:0,children:(0,C.jsx)(f.A,{ref:g,placeholder:"Search users... (\u2191\u2193: Navigate, Enter: Select, Esc: Close)",value:c,onChange:e=>D(e.target.value),prefix:(0,C.jsx)(W.A,{}),style:{width:"100%"},onKeyDown:e=>{"Enter"===e.key&&m&&N(m)},onFocus:G,autoFocus:!0,onBlur:()=>{t&&g.current&&setTimeout((()=>{t&&g.current&&g.current.focus()}),10)},suffix:c&&s?(0,C.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:"Searching..."}):null})}),(0,C.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:s?(0,C.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,C.jsx)(te,{children:"Loading users..."})}):0===w.length?(0,C.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,C.jsx)(te,{type:"secondary",children:c?"No users found matching your search.":"No users available."})}):(0,C.jsx)(h.A,{columns:P,dataSource:w,rowKey:"_id",pagination:!1,size:"small",scroll:{y:300},onRow:E})})]})};var ie=l(6881),ne=l(76401);const{Title:oe,Text:ae}=o.A,re=e=>{let{visible:t,onNewBill:l,onContinueBill:i,onCancel:n,savedBillData:o}=e;return(0,C.jsxs)(v.A,{title:(0,C.jsxs)("div",{style:{textAlign:"center"},children:[(0,C.jsx)(N.A,{style:{color:"#52c41a",fontSize:"24px",marginRight:"8px"}}),(0,C.jsx)("span",{style:{color:"#52c41a",fontWeight:600},children:"Bill Saved Successfully!"})]}),open:t,onCancel:n,footer:null,width:500,centered:!0,maskClosable:!1,closable:!1,children:[(0,C.jsx)("div",{style:{textAlign:"center",marginBottom:"24px"},children:(0,C.jsx)(ae,{type:"secondary",children:"Your bill has been saved successfully. What would you like to do next?"})}),o&&(0,C.jsxs)("div",{style:{background:"linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)",border:"1px solid #0ea5e9",borderRadius:"8px",padding:"16px",marginBottom:"24px"},children:[(0,C.jsx)(oe,{level:5,style:{marginBottom:"12px",color:"#0369a1"},children:"\ud83d\udccb Bill Summary"}),(0,C.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,C.jsx)(q.A,{style:{color:"#0ea5e9"}}),(0,C.jsxs)(ae,{strong:!0,children:["Invoice: ",o.invoice_no]})]}),(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,C.jsx)(Q.A,{style:{color:"#0ea5e9"}}),(0,C.jsx)(ae,{strong:!0,children:o.customer_name||"N/A"})]}),(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,C.jsx)(ie.A,{style:{color:"#0ea5e9"}}),(0,C.jsx)(ae,{strong:!0,children:p()(o.date).format("DD/MM/YYYY")})]}),(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,C.jsx)(ne.A,{style:{color:"#0ea5e9"}}),(0,C.jsxs)(ae,{strong:!0,children:["\u20b9",("number"===typeof o.total_amount?o.total_amount:parseFloat(o.total_amount)||0).toFixed(2)]})]})]})]}),(0,C.jsx)(F.A,{style:{margin:"20px 0"}}),(0,C.jsxs)(_.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,C.jsx)(u.Ay,{type:"primary",size:"large",icon:(0,C.jsx)(g.A,{}),onClick:l,style:{width:"100%",height:"48px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",fontWeight:600,fontSize:"16px",borderRadius:"8px"},children:"\ud83c\udd95 Create New Bill"}),(0,C.jsx)(u.Ay,{size:"large",icon:(0,C.jsx)(q.A,{}),onClick:i,style:{width:"100%",height:"48px",background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",border:"none",fontWeight:600,fontSize:"16px",borderRadius:"8px"},children:"\ud83d\udcdd Continue with Current Bill"})]}),(0,C.jsx)("div",{style:{textAlign:"center",marginTop:"16px"},children:(0,C.jsx)(ae,{type:"secondary",style:{fontSize:"12px"},children:'\ud83d\udca1 Tip: Use "New Bill" to start fresh or "Continue Bill" to add more items'})})]})};var se=l(48677),de=l(91686),ce=l(99472),ue=l(54522),me=l(45964),pe=l(61118);const{Title:ve,Text:fe}=o.A,{Search:xe}=f.A,ye=e=>{let{visible:t,onClose:l,onViewBill:i,onNewBill:o}=e;const{getEntityApi:a}=(0,A.p)(),s=a("SalesRecord"),{items:d,loading:c}=(0,k.Sm)(s.getIdentifier("GetAll")),[m,v]=(0,n.useState)(""),[f,x]=(0,n.useState)([]);(0,n.useEffect)((()=>{t&&s("GetAll")}),[t]),(0,n.useEffect)((()=>{if(null!==d&&void 0!==d&&d.result){const e=d.result.filter((e=>{var t;if(!m)return!0;const l=m.toLowerCase(),i=e.invoice_no||"",n=(null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||"",o=e.date||"",a="number"===typeof e.total_amount?e.total_amount.toString():String(e.total_amount||"");return i.toLowerCase().includes(l)||n.toLowerCase().includes(l)||o.includes(m)||a.includes(m)}));x(e)}}),[d,m]);const y=(e,t)=>e&&!t?"Paid":t?"Partial":"Unpaid",h=e=>{i(e),l()},b=()=>{o(),l()};return(0,C.jsxs)(se.A,{title:(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,C.jsx)(ve,{level:4,style:{margin:0,color:"#1f2937"},children:"\ud83d\udccb Bill List"}),(0,C.jsx)(u.Ay,{type:"text",icon:(0,C.jsx)(H.A,{}),onClick:l,size:"small"})]}),placement:"left",open:t,onClose:l,width:400,bodyStyle:{padding:"16px"},headerStyle:{borderBottom:"1px solid #e5e7eb",padding:"16px 16px 12px 16px"},children:[(0,C.jsx)("div",{style:{marginBottom:"16px"},children:(0,C.jsxs)(_.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,C.jsx)(xe,{placeholder:"Search bills by invoice, customer, date...",value:m,onChange:e=>v(e.target.value),prefix:(0,C.jsx)(W.A,{}),allowClear:!0,size:"large"}),(0,C.jsx)(u.Ay,{type:"primary",icon:(0,C.jsx)(g.A,{}),onClick:b,style:{width:"100%",height:"40px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",fontWeight:600,borderRadius:"8px"},children:"\ud83c\udd95 Create New Bill"})]})}),(0,C.jsx)(F.A,{style:{margin:"16px 0"}}),(0,C.jsx)("div",{style:{height:"calc(100vh - 250px)",overflow:"auto"},children:c?(0,C.jsxs)("div",{style:{textAlign:"center",padding:"40px"},children:[(0,C.jsx)(de.A,{size:"large"}),(0,C.jsx)("div",{style:{marginTop:"16px"},children:(0,C.jsx)(fe,{type:"secondary",children:"Loading bills..."})})]}):0===f.length?(0,C.jsx)(ce.A,{description:(0,C.jsxs)("div",{children:[(0,C.jsx)(fe,{type:"secondary",children:m?"No bills found matching your search.":"No bills available."}),!m&&(0,C.jsx)("div",{style:{marginTop:"8px"},children:(0,C.jsx)(u.Ay,{type:"link",onClick:b,children:"Create your first bill"})})]}),style:{marginTop:"40px"}}):(0,C.jsx)(ue.A,{dataSource:f,renderItem:e=>{var t,l,i;return(0,C.jsx)(ue.A.Item,{style:{padding:"16px",border:"1px solid #e5e7eb",borderRadius:"8px",marginBottom:"12px",background:"white",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)",e.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="none",e.currentTarget.style.transform="translateY(0)"},onClick:()=>h(e),children:(0,C.jsxs)("div",{style:{width:"100%"},children:[(0,C.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,C.jsx)(me.A,{icon:(0,C.jsx)(q.A,{}),style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white"}}),(0,C.jsx)(fe,{strong:!0,style:{fontSize:"14px"},children:e.invoice_no})]}),(0,C.jsx)(S.A,{color:(l=e.is_paid,i=e.is_partially_paid,l&&!i?"success":i?"warning":"error"),children:y(e.is_paid,e.is_partially_paid)})]}),(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px"},children:[(0,C.jsx)(Q.A,{style:{color:"#6b7280",fontSize:"12px"}}),(0,C.jsx)(fe,{style:{fontSize:"12px",color:"#374151"},children:(null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||e.customer_name||"N/A"})]}),(0,C.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,C.jsx)(ie.A,{style:{color:"#6b7280",fontSize:"12px"}}),(0,C.jsx)(fe,{style:{fontSize:"12px",color:"#6b7280"},children:e.date?p()(e.date).format("DD/MM/YYYY"):"N/A"})]}),(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,C.jsx)(ne.A,{style:{color:"#10b981",fontSize:"12px"}}),(0,C.jsxs)(fe,{strong:!0,style:{fontSize:"14px",color:"#10b981"},children:["\u20b9",("number"===typeof e.total_amount?e.total_amount:parseFloat(e.total_amount)||0).toFixed(2)]})]})]}),(0,C.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"12px",justifyContent:"flex-end"},children:[(0,C.jsx)(r.A,{title:"View Bill",children:(0,C.jsx)(u.Ay,{type:"text",icon:(0,C.jsx)(pe.A,{}),size:"small",onClick:t=>{t.stopPropagation(),h(e)},style:{color:"#3b82f6"}})}),(0,C.jsx)(r.A,{title:"Print Bill",children:(0,C.jsx)(u.Ay,{type:"text",icon:(0,C.jsx)(z.A,{}),size:"small",onClick:e=>{e.stopPropagation()},style:{color:"#10b981"}})})]})]})})},pagination:!1})}),(0,C.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:"16px",background:"white",borderTop:"1px solid #e5e7eb"},children:(0,C.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,C.jsxs)(fe,{type:"secondary",style:{fontSize:"12px"},children:["Total Bills: ",f.length]}),(0,C.jsx)(fe,{type:"secondary",style:{fontSize:"12px"},children:"\ud83d\udca1 Click on any bill to view details"})]})})]})};var _e=l(20691);const{Title:he,Text:ge}=o.A,be=e=>{var t,l,i,o,a,r,s;let{visible:d,onCancel:c,productId:u}=e;const{getEntityApi:m}=(0,A.p)(),p=m("Product"),{items:f,loading:x}=(0,k.Sm)(p.getIdentifier("GetAll")),[y,_]=(0,n.useState)(null);(0,n.useEffect)((()=>{if(d&&u&&null!==f&&void 0!==f&&f.result){const e=f.result.find((e=>e._id===u));e&&_(e)}}),[d,u,f]),(0,n.useEffect)((()=>{!d||!u||null!==f&&void 0!==f&&f.result||p("GetAll")}),[d,u,f,p]);const h=()=>{_(null),c()};return y?(0,C.jsx)(v.A,{title:(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,C.jsx)("span",{children:"\ud83d\udce6 Product Details"}),(0,C.jsx)(S.A,{color:"blue",style:{margin:0},children:y.sku})]}),open:d,onCancel:h,footer:null,width:700,destroyOnClose:!0,children:(0,C.jsxs)("div",{style:{padding:"16px 0"},children:[(0,C.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,C.jsx)(he,{level:4,style:{margin:"0 0 8px 0",color:"#1890ff"},children:y.name}),(null===(t=y.VariantItem)||void 0===t?void 0:t.variant_name)&&(0,C.jsxs)(S.A,{color:"green",style:{fontSize:"12px"},children:["Variant: ",y.VariantItem.variant_name]})]}),(0,C.jsx)(F.A,{style:{margin:"16px 0"}}),(0,C.jsxs)(_e.A,{title:"Product Information",column:2,size:"small",bordered:!0,style:{marginBottom:"24px"},children:[(0,C.jsx)(_e.A.Item,{label:"Product Name",span:2,children:(0,C.jsx)(ge,{strong:!0,children:y.name})}),(null===(l=y.VariantItem)||void 0===l?void 0:l.variant_name)&&(0,C.jsx)(_e.A.Item,{label:"Variant Name",children:(0,C.jsx)(ge,{children:y.VariantItem.variant_name})}),(null===(i=y.VariantItem)||void 0===i?void 0:i.variant_code)&&(0,C.jsx)(_e.A.Item,{label:"Variant Code",children:(0,C.jsx)(ge,{code:!0,children:y.VariantItem.variant_code})}),(0,C.jsx)(_e.A.Item,{label:"SKU",children:(0,C.jsx)(ge,{code:!0,children:y.sku})}),y.brand&&(0,C.jsx)(_e.A.Item,{label:"Brand",children:(0,C.jsx)(ge,{children:y.brand})}),y.unit&&(0,C.jsx)(_e.A.Item,{label:"Unit",children:(0,C.jsx)(ge,{children:y.unit})}),y.description&&(0,C.jsx)(_e.A.Item,{label:"Description",span:2,children:(0,C.jsx)(ge,{children:y.description})})]}),(0,C.jsxs)(_e.A,{title:"Pricing & Tax",column:2,size:"small",bordered:!0,style:{marginBottom:"24px"},children:[(0,C.jsx)(_e.A.Item,{label:"Selling Price",children:(0,C.jsxs)(ge,{strong:!0,style:{color:"#52c41a",fontSize:"16px"},children:["\u20b9",(null===(o=y.selling_price)||void 0===o?void 0:o.toFixed(2))||"0.00"]})}),(0,C.jsx)(_e.A.Item,{label:"MRP",children:(0,C.jsxs)(ge,{style:{color:"#fa8c16"},children:["\u20b9",(null===(a=y.mrp)||void 0===a?void 0:a.toFixed(2))||"0.00"]})}),(null===(r=y.CategoryItem)||void 0===r?void 0:r.name)&&(0,C.jsx)(_e.A.Item,{label:"Category",children:(0,C.jsx)(ge,{children:y.CategoryItem.name})}),void 0!==(null===(s=y.CategoryItem)||void 0===s?void 0:s.tax_percentage)&&(0,C.jsx)(_e.A.Item,{label:"Tax Rate",children:(0,C.jsxs)(S.A,{color:"orange",children:[y.CategoryItem.tax_percentage,"%"]})})]}),(void 0!==y.min_stock||void 0!==y.max_stock)&&(0,C.jsxs)(_e.A,{title:"Stock Information",column:2,size:"small",bordered:!0,children:[void 0!==y.min_stock&&(0,C.jsx)(_e.A.Item,{label:"Minimum Stock",children:(0,C.jsx)(ge,{children:y.min_stock})}),void 0!==y.max_stock&&(0,C.jsx)(_e.A.Item,{label:"Maximum Stock",children:(0,C.jsx)(ge,{children:y.max_stock})})]}),(0,C.jsx)("div",{style:{marginTop:"24px",padding:"16px",backgroundColor:"#f6f8fa",borderRadius:"8px",textAlign:"center"},children:(0,C.jsx)(ge,{type:"secondary",style:{fontSize:"12px"},children:"Right-click on product field to view details \u2022 Press ESC to close"})})]})}):(0,C.jsx)(v.A,{title:"Product Details",open:d,onCancel:h,footer:null,width:600,destroyOnClose:!0,children:(0,C.jsx)("div",{style:{textAlign:"center",padding:"40px 20px"},children:x?(0,C.jsx)(ge,{children:"Loading product details..."}):(0,C.jsx)(ge,{type:"secondary",children:"Product not found"})})})},je="BillDataGrid_mainContainer__Jnuo1",Ae="BillDataGrid_backgroundCircle1__5PBPG",ke="BillDataGrid_backgroundCircle2__J+xMs",Ce="BillDataGrid_backgroundCircle3__AgoEw",we="BillDataGrid_backgroundCircle4__86Xfd",Ie="BillDataGrid_backgroundCircle5__qpbiT",Se="BillDataGrid_headerContainer__wfojf",De="BillDataGrid_headerCircle1__8+aPI",Ne="BillDataGrid_headerCircle2__Z9w17",Te="BillDataGrid_headerCircle3__3eMNm",Be="BillDataGrid_headerCircle4__fVITr",Pe="BillDataGrid_headerCircle5__0E6vl",Ee="BillDataGrid_headerContent__6Rnkr",Ge="BillDataGrid_titleSection__LBuxT",qe="BillDataGrid_titleIcon__qffZU",Le="BillDataGrid_titleText__XlvSS",ze="BillDataGrid_subtitleText__Hgyav",Re="BillDataGrid_controlsSection__PSC3w",Me="BillDataGrid_controlGroup__AFGBT",Ve="BillDataGrid_saleTypeControl__hzHpa",Fe="BillDataGrid_gstControl__AiGdY",Ye="BillDataGrid_paymentControl__BD0r9",Ue="BillDataGrid_partialPaymentControl__unngo",Ke="BillDataGrid_controlLabel__QP4fP",We="BillDataGrid_badgesContainer__bqqSt",Oe="BillDataGrid_itemsBadge__o0Uro",He="BillDataGrid_amountBadge__IPSqT",Qe="BillDataGrid_badgeText__9cTal",Je="BillDataGrid_invoiceDetailsGrid__QPpaj",Xe="BillDataGrid_itemsSection__vJE1b",Ze="BillDataGrid_itemsCircle1__PQoMB",$e="BillDataGrid_itemsCircle2__0lWcR",et="BillDataGrid_billItemsGrid__jpWQo",tt="BillDataGrid_billItemsHeader__hxL0O",lt="BillDataGrid_billItemsTitle__MQduV",it="BillDataGrid_billItemsBadge__vdJMk",nt="BillDataGrid_billSummary__yA4j-",ot="BillDataGrid_summaryCircle1__PuveY",at="BillDataGrid_summaryCircle2__fdcks",rt="BillDataGrid_summaryHeader__h1BtQ",st="BillDataGrid_summaryTitle__dSOoP",dt="BillDataGrid_summaryRow__yUShR",ct="BillDataGrid_summaryLabel__cLnHd",ut="BillDataGrid_summaryValue__LUh-6",mt="BillDataGrid_summaryTable__ZpVlt",pt="BillDataGrid_totalAmountRow__JXMuL",vt="BillDataGrid_totalAmountLabel__IVRMe",ft="BillDataGrid_totalAmountValue__5W5mL",xt="BillDataGrid_discountValue__QjPij",yt="BillDataGrid_partialPaymentInfo__OpO+-",_t="BillDataGrid_partialPaymentRow__Qy-Ni",ht="BillDataGrid_partialPaymentLabel__yEvTO",gt="BillDataGrid_partialPaymentValue__SLg8d",bt="BillDataGrid_controlsContainer__2jCRg",jt="BillDataGrid_discountControl__n0WOI",At="BillDataGrid_discountControlLabel__0iwJ9",kt="BillDataGrid_discountControlInputs__TbgUU",Ct="BillDataGrid_partialPaymentControlLabel__lxP98",wt="BillDataGrid_actionHub__SlPSg",It="BillDataGrid_actionButtonsContainer__BcfKu",St="BillDataGrid_actionHubCircle1__ggNzA",Dt="BillDataGrid_actionHubCircle2__Nb-oj",Nt="BillDataGrid_actionHubCircle3__D2pna",Tt="BillDataGrid_actionHubCircle4__ayVXK",Bt="BillDataGrid_saveButton__vWggk",Pt="BillDataGrid_billListButton__ahHFc",Et="BillDataGrid_printButton__nkIDd",Gt="BillDataGrid_clearButton__518xA",qt="BillDataGrid_saleTypeSwitch__Xa4gR",Lt="BillDataGrid_gstSwitch__ZQG0t",zt="BillDataGrid_paymentSwitch__KxB-J",Rt="BillDataGrid_partialPaymentSwitch__5nNFs",{Title:Mt,Text:Vt}=o.A,Ft=e=>{var t;let{billdata:l,onSuccess:o}=e;const{getEntityApi:m}=(0,A.p)(),v=((0,n.useCallback)(((e,t)=>{var l;if(!e||null===t||void 0===t||null===(l=t.VariantItem)||void 0===l||!l.pack_size)return{isValid:!0,expectedLoose:0,totalAvailable:0};const i=parseInt(t.VariantItem.pack_size),n=e.available_quantity||0,o=e.available_loose_quantity||0;return{isValid:!0,expectedLoose:o,totalAvailable:n*i+o}}),[]),m("Product")),f=m("Customer"),x=m("BillingUsers"),y=m("StockAudit"),_=m("BranchStock"),h=m("SalesRecord"),g=m("InvoiceNumber"),{items:b,loading:w}=(0,k.Sm)(v.getIdentifier("GetAll")),{items:S,loading:D}=(0,k.Sm)(f.getIdentifier("GetAll")),{items:N,loading:T}=(0,k.Sm)(x.getIdentifier("GetAll")),{items:P,loading:R}=(0,k.Sm)(y.getIdentifier("GetAll")),{items:M,loading:V}=(0,k.Sm)(_.getIdentifier("GetAll")),{items:F}=(0,k.Sm)(g.getIdentifier("GetAll")),{items:Y,loading:U}=(0,k.Sm)(g.getIdentifier("Create")),{loading:K}=(0,k.Sm)(h.getIdentifier("Create")),[W,O]=(0,n.useState)({invoice_no:"",date:p()().format("YYYY-MM-DD"),customer_id:"",customer_name:"",billed_by_id:"",billed_by_name:"",payment_mode:"cash",items:[]}),[H,Q]=(0,n.useState)({isPaid:!0,isPartiallyPaid:!1,isRetail:!0,isGstIncluded:!0,discount:0,discountType:"percentage",paidAmount:0}),[J,X]=(0,n.useState)(null),[Z,ee]=(0,n.useState)(null),[te,ie]=(0,n.useState)(!1),[ne,oe]=(0,n.useState)(!1),[ae,se]=(0,n.useState)(!1),[de,ce]=(0,n.useState)(!1),[ue,me]=(0,n.useState)(null),[pe,ve]=(0,n.useState)(!1),[fe,xe]=(0,n.useState)(""),[_e,he]=(0,n.useState)(!1),[ge,Ft]=(0,n.useState)(null),[Yt,Ut]=(0,n.useState)(0),Kt=(0,n.useMemo)((()=>JSON.parse(sessionStorage.getItem("user")||"{}")),[]),Wt=null===Kt||void 0===Kt?void 0:Kt.branch_id,Ot=(e,t,l)=>{var i,n,o;const a=Wt?M:P,r=null===a||void 0===a||null===(i=a.result)||void 0===i?void 0:i.find((t=>t._id===e));if(!r)return{isValid:!1,availablePackQty:0,maxLooseQty:0,message:"Stock not found"};const s=null===r||void 0===r||null===(n=r.ProductItem)||void 0===n||null===(o=n.VariantItem)||void 0===o?void 0:o.pack_size,d=s?parseInt(s):1,c=r.available_quantity||0,u=r.available_loose_quantity||0;if(t>c)return{isValid:!1,availablePackQty:c,maxLooseQty:0,message:"Pack quantity (".concat(t,") exceeds available packs (").concat(c,")")};const m=c-t,p=m*d+u;return l>p?{isValid:!1,availablePackQty:c,maxLooseQty:p,message:"Loose quantity (".concat(l,") exceeds available loose items (").concat(p," = ").concat(m," remaining packs \xd7 ").concat(d," + ").concat(u," loose)")}:{isValid:!0,availablePackQty:c,maxLooseQty:p,message:""}},Ht=(0,n.useCallback)(((e,t,l)=>{const n=[...W.items],o=n[e];if(!o.stock_id)return n[e]=(0,i.A)((0,i.A)({},o),{},{[t]:l}),void O((e=>(0,i.A)((0,i.A)({},e),{},{items:n})));const r="qty"===t?l:o.qty||0,s="loose_qty"===t?l:o.loose_qty||0,d=Ot(o.stock_id,r,s);d.isValid?n[e]=(0,i.A)((0,i.A)({},o),{},{[t]:l}):(a.Ay.error(d.message),"qty"===t&&r>d.availablePackQty?n[e]=(0,i.A)((0,i.A)({},o),{},{qty:d.availablePackQty}):"loose_qty"===t&&s>d.maxLooseQty&&(n[e]=(0,i.A)((0,i.A)({},o),{},{loose_qty:d.maxLooseQty}))),O((e=>(0,i.A)((0,i.A)({},e),{},{items:n})))}),[W.items,Ot]);(0,n.useEffect)((()=>{var e,t,i,n,o,a,r,s,d;(v("GetAll"),f("GetAll"),x("GetAll"),l||U||g("GetAll"),l)&&(O({invoice_no:l.invoice_no,date:p()(l.date).format("YYYY-MM-DD"),customer_id:l.customer_id,customer_name:(null===(e=l.customerDetails)||void 0===e?void 0:e.full_name)||"",billed_by_id:l.billed_by_id||"",billed_by_name:(null===(t=l.billedByDetails)||void 0===t?void 0:t.name)||"",payment_mode:l.payment_mode,items:(null===(i=l.Items)||void 0===i?void 0:i.map((e=>{var t,l,i;return{_id:e._id,product_id:e.product_id,product_name:(null===(t=e.productItems)||void 0===t?void 0:t.name)||"",variant_name:(null===(l=e.productItems)||void 0===l||null===(i=l.VariantItem)||void 0===i?void 0:i.variant_name)||"",stock_id:Wt?e.branch_stock_id:e.stock_id,qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price,mrp:e.mrp||e.price,amount:e.amount,tax_percentage:e.tax_percentage||0}})))||[]}),Q({isPaid:null===(n=l.is_paid)||void 0===n||n,isPartiallyPaid:null!==(o=l.is_partially_paid)&&void 0!==o&&o,isRetail:"retail"===l.sale_type,isGstIncluded:null===(a=l.is_gst_included)||void 0===a||a,discount:null!==(r=l.discount)&&void 0!==r?r:0,discountType:null!==(s=l.discount_type)&&void 0!==s?s:"percentage",paidAmount:null!==(d=l.paid_amount)&&void 0!==d?d:0}))}),[l]),(0,n.useEffect)((()=>{var e;null!==F&&void 0!==F&&null!==(e=F.result)&&void 0!==e&&e.invoice_no&&!l&&O((e=>(0,i.A)((0,i.A)({},e),{},{invoice_no:F.result.invoice_no})))}),[F,l]),(0,n.useEffect)((()=>{if(!l&&0===W.items.length){const e=Array(1).fill(null).map(((e,t)=>({product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0})));O((t=>(0,i.A)((0,i.A)({},t),{},{items:e})))}}),[l,W.items.length]),(0,n.useEffect)((()=>{if(!l&&null!==N&&void 0!==N&&N.result&&null!==Kt&&void 0!==Kt&&Kt._id&&!W.billed_by_id){const e=N.result.find((e=>e._id===Kt._id));e&&O((t=>(0,i.A)((0,i.A)({},t),{},{billed_by_id:Kt._id,billed_by_name:e.name||Kt.name||""})))}}),[N,Kt._id,l,W.billed_by_id]);const Qt=(0,n.useMemo)((()=>{var e;return(null===b||void 0===b||null===(e=b.result)||void 0===e?void 0:e.map((e=>{var t;return{label:"".concat(e.name," ").concat((null===e||void 0===e||null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)||"").trim(),value:e._id}})))||[]}),[b]),Jt=(0,n.useMemo)((()=>{var e;return(null===S||void 0===S||null===(e=S.result)||void 0===e?void 0:e.map((e=>({label:"".concat(e.full_name," - ").concat(e.mobile),value:e._id}))))||[]}),[S]),Xt=(0,n.useMemo)((()=>{var e;const t=(null===N||void 0===N||null===(e=N.result)||void 0===e?void 0:e.map((e=>{var t;return{label:"".concat(e.name," (").concat((null===(t=e.roleItems)||void 0===t?void 0:t.name)||"No Role",")"),value:e._id}})))||[];return t}),[N]),Zt=(0,n.useMemo)((()=>[{key:"invoice_no",title:"\ud83d\udcc4 INVOICE #",dataIndex:"invoice_no",type:"text",required:!0,width:180},{key:"date",title:"\ud83d\udcc5 DATE",dataIndex:"date",type:"date",required:!0,width:150},{key:"customer_id",title:"\ud83d\udc64 CUSTOMER",dataIndex:"customer_id",type:"select",options:Jt,required:!0,width:250,render:(e,t)=>{const l=Jt.find((t=>t.value===e));return(0,C.jsx)(r.A,{title:"Click to open customer selection modal (or press End key)",children:(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:"1px solid #d9d9d9",backgroundColor:"#fafafa",transition:"all 0.2s ease"},onClick:()=>ie(!0),onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#fafafa",e.currentTarget.style.borderColor="#d9d9d9"},children:[(0,C.jsx)("span",{children:l?l.label:"Select customer"}),(0,C.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#f0f8ff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d6e4ff"},children:"End"})]})})}},{key:"billed_by_id",title:"\ud83d\udc68\u200d\ud83d\udcbc BILLED BY",dataIndex:"billed_by_id",type:"select",options:Xt,required:!1,width:250,render:(e,t)=>{const l=Xt.find((t=>t.value===e));return(0,C.jsx)(r.A,{title:"Click to open user selection modal (or press Ctrl+U key)",children:(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:"1px solid #d9d9d9",backgroundColor:"#f0f8ff",transition:"all 0.2s ease"},onClick:()=>oe(!0),onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#e6f7ff",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#f0f8ff",e.currentTarget.style.borderColor="#d9d9d9"},children:[(0,C.jsx)("span",{children:l?l.label:"Select user"}),(0,C.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#ffffff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d6e4ff"},children:"Ctrl+U"})]})})}},{key:"payment_mode",title:"\ud83d\udcb3 PAYMENT",dataIndex:"payment_mode",type:"select",options:[{label:"\ud83d\udcb5 Cash",value:"cash"},{label:"\ud83d\udcf1 UPI",value:"upi"},{label:"\ud83d\udcb3 Card",value:"card"}],required:!0,width:150}]),[Jt,Xt]),$t=(0,n.useMemo)((()=>[{invoice_no:W.invoice_no,date:W.date,customer_id:W.customer_id,billed_by_id:W.billed_by_id,payment_mode:W.payment_mode}]),[W.invoice_no,W.date,W.customer_id,W.billed_by_id,W.payment_mode]),el=(0,n.useMemo)((()=>[{key:"product_id",title:"\ud83d\uded2 PRODUCT",dataIndex:"product_id",type:"product",required:!0,width:280,render:(e,t,l)=>{const i=Qt.find((t=>t.value===e));return(0,C.jsx)(r.A,{title:e?"Product: ".concat((null===i||void 0===i?void 0:i.label)||"Unknown"," - Click to change \u2022 F5 to reopen"):"Click to select product from inventory \u2022 F5 to open",placement:"top",children:(0,C.jsxs)("div",{style:{cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:e?"1px solid #52c41a":"1px solid #d9d9d9",backgroundColor:e?"#f6ffed":"#fafafa",transition:"all 0.2s ease",minHeight:"32px",display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>{"number"===typeof l&&(Ft(l),Ut(l),he(!0))},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=e?"#f6ffed":"#fafafa",t.currentTarget.style.borderColor=e?"#52c41a":"#d9d9d9"},children:[(0,C.jsx)("span",{style:{color:e?"#52c41a":"#1890ff",fontWeight:e?600:400},children:e?(null===i||void 0===i?void 0:i.label)||"Unknown Product":"Select product"}),e&&(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,C.jsx)("span",{style:{fontSize:"12px",color:"#52c41a"},children:"\u2705"}),(0,C.jsx)("span",{style:{fontSize:"10px",color:"#52c41a",backgroundColor:"#f6ffed",padding:"2px 4px",borderRadius:"3px"},children:"Selected"})]}),!e&&(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginTop:"2px"},children:[(0,C.jsx)("span",{style:{fontSize:"10px",color:"#ff4d4f"},children:"\u26a0\ufe0f Product required"}),(0,C.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#f0f8ff",padding:"2px 4px",borderRadius:"3px"},children:"Click"})]})]})})}},{key:"stock_id",title:"\ud83d\udce6 STOCK",dataIndex:"batch_no",type:"stock",required:!0,width:280,editable:!0,render:(e,t,l)=>{var i,n,o;const s=Wt?M:P,d=null===s||void 0===s||null===(i=s.result)||void 0===i?void 0:i.find((e=>e._id===t.stock_id)),c=null===d||void 0===d||null===(n=d.ProductItem)||void 0===n||null===(o=n.VariantItem)||void 0===o?void 0:o.pack_size,u=c?parseInt(c):1,m=(null===d||void 0===d?void 0:d.available_quantity)||0,p=(null===d||void 0===d?void 0:d.available_loose_quantity)||0,v=m>0&&m<=10,f=0===m;return(0,C.jsx)(r.A,{title:t.product_id?e?"Stock: ".concat(e," - Packs Available: ").concat(m," \u2022 Loose Available: ").concat(p," \u2022 Pack Size: ").concat(u," \u2022 Click to change \u2022 F7 to reopen"):"Click to select stock from available inventory \u2022 F7 to open":"Please select a product first to choose stock \u2022 F7 to open after product selection",placement:"top",children:(0,C.jsxs)("div",{style:{cursor:"pointer",padding:"6px 10px",borderRadius:"6px",border:e?"1px solid #52c41a":"1px solid #d9d9d9",backgroundColor:e?"#f6ffed":"#fafafa",transition:"all 0.2s ease",minHeight:"32px",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",gap:"10px"},onClick:()=>{t.product_id&&"number"===typeof l?X(l):t.product_id||a.Ay.warning("Please select a product first")},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=e?"#f6ffed":"#fafafa",t.currentTarget.style.borderColor=e?"#52c41a":"#d9d9d9"},children:[(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",flex:1},children:[(0,C.jsx)("span",{style:{color:e?"#52c41a":t.product_id?"#1890ff":"#bfbfbf",fontWeight:e?600:400,fontSize:"13px",whiteSpace:"nowrap"},children:e||"Select Stock"}),d&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsxs)("span",{style:{color:f?"#ff4d4f":v?"#faad14":"#52c41a",fontWeight:"bold",backgroundColor:f?"#fff2f0":v?"#fffbe6":"#f6ffed",padding:"2px 6px",borderRadius:"4px",border:"1px solid ".concat(f?"#ffccc7":v?"#ffe58f":"#b7eb8f"),fontSize:"12px"},children:["\ud83d\udce6 ",m]}),(0,C.jsxs)("span",{style:{color:"#722ed1",fontWeight:"bold",backgroundColor:"#f9f0ff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d3adf7",fontSize:"12px"},children:["\ud83d\udccb ",p]})]}),t.product_id&&!e&&(0,C.jsx)("span",{style:{fontSize:"11px",color:"#ff4d4f",whiteSpace:"nowrap"},children:"\u26a0\ufe0f Stock required"})]}),t.product_id&&(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,C.jsx)("span",{style:{fontSize:"12px",color:"#1890ff"},children:"\ud83d\udccb"}),(0,C.jsx)("span",{style:{fontSize:"10px",color:"#52c41a",backgroundColor:"#f6ffed",padding:"2px 4px",borderRadius:"3px"},children:"Click"})]})]})})}},{key:"qty",title:"\ud83d\udcca QTY",dataIndex:"qty",type:"number",width:90,render:(e,t,l)=>{var i;const n=Wt?M:P,o=null===n||void 0===n||null===(i=n.result)||void 0===i?void 0:i.find((e=>e._id===t.stock_id)),r=(null===o||void 0===o?void 0:o.available_quantity)||0,d=e>r;return(0,C.jsx)("div",{style:{position:"relative"},children:(0,C.jsx)(s.A,{value:e,min:0,max:r,style:{width:"100%",borderColor:d?"#ff4d4f":void 0,backgroundColor:d?"#fff2f0":void 0},onPressEnter:e=>{if(void 0!==l){const t=e.target,i=parseInt(t.value)||0;Ht(l,"qty",i)}},onBlur:e=>{if(void 0!==l){const t=e.target,i=parseInt(t.value)||0;Ht(l,"qty",i)}},onChange:e=>{null!==e&&e>r&&a.Ay.error("Pack quantity cannot exceed available packs (".concat(r,")"))}})})}},{key:"loose_qty",title:"\ud83d\udccb LOOSE",dataIndex:"loose_qty",type:"number",width:90,render:(e,t,l)=>{var i,n,o;const r=Wt?M:P,d=null===r||void 0===r||null===(i=r.result)||void 0===i?void 0:i.find((e=>e._id===t.stock_id));if(!d)return(0,C.jsx)("div",{style:{position:"relative"},children:(0,C.jsx)(s.A,{value:e,min:0,style:{width:"100%"},disabled:!0})});const c=null===d||void 0===d||null===(n=d.ProductItem)||void 0===n||null===(o=n.VariantItem)||void 0===o?void 0:o.pack_size,u=c?parseInt(c):1,m=(null===d||void 0===d?void 0:d.available_quantity)||0,p=(null===d||void 0===d?void 0:d.available_loose_quantity)||0,v=m-(t.qty||0),f=v*u+p,x=e>f;return(0,C.jsx)("div",{style:{position:"relative"},children:(0,C.jsx)(s.A,{value:e,min:0,max:f,style:{width:"100%",borderColor:x?"#ff4d4f":void 0,backgroundColor:x?"#fff2f0":void 0},onPressEnter:e=>{if(void 0!==l){const t=e.target,i=parseInt(t.value)||0;Ht(l,"loose_qty",i)}},onBlur:e=>{if(void 0!==l){const t=e.target,i=parseInt(t.value)||0;Ht(l,"loose_qty",i)}},onChange:e=>{null!==e&&e>f&&a.Ay.error("Loose quantity cannot exceed available loose items (".concat(f," = ").concat(v," remaining packs \xd7 ").concat(u," + ").concat(p," loose)"))}})})}},{key:"price",title:"\ud83d\udcb0 RATE",dataIndex:"price",type:"number",required:!0,width:120,editable:!1,render:e=>(0,C.jsx)(s.A,{value:e,disabled:!0,style:{width:"100%"}})},{key:"amount",title:"\ud83d\udcb5 AMOUNT",dataIndex:"amount",type:"number",editable:!1,width:130,render:e=>(0,C.jsx)(s.A,{value:e,disabled:!0,style:{width:"100%"}})}]),[Qt,Wt,M,P,Ht]),tl=el.findIndex((e=>"qty"===e.key||"qty"===e.dataIndex)),ll=(0,n.useMemo)((()=>W.items.length?function(e){let{items:t,productList:l,isGstIncluded:n,discount:o,discountType:a}=e;const r=t.map((e=>{var t,o;const a=null===l||void 0===l?void 0:l.find((t=>t._id===e.product_id));let r=e.tax_percentage||(null===a||void 0===a||null===(t=a.CategoryItem)||void 0===t?void 0:t.tax_percentage)||18;r&&0!==r||(r=18);const s=Number(e.qty||0)*Number(e.price||0)+Number(e.loose_qty||0)*(Number(e.price||0)/((null===a||void 0===a||null===(o=a.VariantItem)||void 0===o?void 0:o.pack_size)||1)||0);let d=s;return!n&&r>0&&(d=s+s*r/100),(0,i.A)((0,i.A)({},e),{},{tax_percentage:r,baseAmount:s,amount:d})})),s=r.reduce(((e,t)=>e+Number(t.amount)),0),d=r.reduce(((e,t)=>e+Number(t.baseAmount)),0);let c=0;o>0&&(c="percentage"===a?d*(o/100):o);let u=0,m=0,p=0;return r.forEach((e=>{let t=e.baseAmount;o>0&&(t="percentage"===a?e.baseAmount-e.baseAmount*(o/100):e.baseAmount-o/d*e.baseAmount);let l=0;n?e.tax_percentage>0?(l=t*(e.tax_percentage/(100+e.tax_percentage)),m+=t-l,u+=l,p+=t):(m+=t,p+=t):e.tax_percentage>0?(l=t*(e.tax_percentage/100),m+=t,u+=l,p+=t+l):(m+=t,p+=t)})),{sub_total:s,value_of_goods:m,total_gst:u,cgst:u/2,sgst:u/2,total_amount:p,discountValue:c}}({items:W.items,productList:(null===b||void 0===b?void 0:b.result)||[],isGstIncluded:H.isGstIncluded,discount:H.discount,discountType:H.discountType}):{sub_total:0,value_of_goods:0,total_gst:0,cgst:0,sgst:0,total_amount:0,discountValue:0}),[W.items,b,H]),il=(0,n.useCallback)((e=>{const t=e[0];if(t){var l,n;const e=null===S||void 0===S||null===(l=S.result)||void 0===l?void 0:l.find((e=>e._id===t.customer_id)),o=null===N||void 0===N||null===(n=N.result)||void 0===n?void 0:n.find((e=>e._id===t.billed_by_id));O((l=>(0,i.A)((0,i.A)({},l),{},{invoice_no:t.invoice_no||"",date:t.date||p()().format("YYYY-MM-DD"),customer_id:t.customer_id||"",customer_name:(null===e||void 0===e?void 0:e.full_name)||"",billed_by_id:t.billed_by_id||"",billed_by_name:(null===o||void 0===o?void 0:o.name)||"",payment_mode:t.payment_mode||"cash"})))}}),[S,N]),nl=(0,n.useCallback)((e=>{const t=e.map((e=>{var t;const l={product_id:e.product_id||"",product_name:(null===(t=Qt.find((t=>t.value===e.product_id)))||void 0===t?void 0:t.label)||"",variant_name:e.variant_name||"",stock_id:e.stock_id||"",batch_no:e.batch_no||"",qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price||0,mrp:e.mrp||0,amount:e.amount||0,tax_percentage:e.tax_percentage||0};if(e.stock_id&&(e.qty||e.loose_qty)){var i;const t=Wt?M:P,r=null===t||void 0===t||null===(i=t.result)||void 0===i?void 0:i.find((t=>t._id===e.stock_id));if(r){var n,o;const t=null===r||void 0===r||null===(n=r.ProductItem)||void 0===n||null===(o=n.VariantItem)||void 0===o?void 0:o.pack_size,i=t?parseInt(t):1,s=r.available_quantity||0,d=r.available_loose_quantity||0;e.qty&&e.qty>s&&(a.Ay.error("Pack quantity (".concat(e.qty,") exceeds available packs (").concat(s,")")),l.qty=s);const c=s-(e.qty||0),u=c*i+d;e.loose_qty&&e.loose_qty>u&&(a.Ay.error("Loose quantity (".concat(e.loose_qty,") exceeds available loose items (").concat(u," = ").concat(c," remaining packs \xd7 ").concat(i," + ").concat(d," loose)")),l.loose_qty=u)}}if(e.product_id&&!e.stock_id){var r;const t=Wt?M:P,i=(null===t||void 0===t||null===(r=t.result)||void 0===r?void 0:r.filter((t=>{var l;return t.product===e.product_id||(null===(l=t.ProductItem)||void 0===l?void 0:l._id)===e.product_id})))||[];if(i.length>0){const t=i[0];l.stock_id=t._id,l.batch_no=t.batch_no||"",setTimeout((()=>{const t=document.querySelector('td[data-row-key="'.concat(e.key,'"][data-column-key="qty"]'));t&&t.focus()}),300)}}return l})).map((e=>{var t;if(!e.product_id||!e.stock_id)return e;const l=Wt?M:P,n=null===l||void 0===l||null===(t=l.result)||void 0===t?void 0:t.find((t=>t._id===e.stock_id));if(n){var o,a,r,s,d;const t=n.sell_price||0,l=null===n||void 0===n||null===(o=n.ProductItem)||void 0===o||null===(a=o.VariantItem)||void 0===a?void 0:a.pack_size,c=t/(l?parseInt(l):1),u=(e.qty||0)*t+(e.loose_qty||0)*c,m=null===b||void 0===b||null===(r=b.result)||void 0===r?void 0:r.find((t=>t._id===e.product_id)),p=(null===m||void 0===m||null===(s=m.CategoryItem)||void 0===s?void 0:s.tax_percentage)||0;let v=u;return H.isGstIncluded||(v=u+u*p/100),(0,i.A)((0,i.A)({},e),{},{price:e.price||t,mrp:n.mrp||t,amount:v,tax_percentage:p,product_name:(null===m||void 0===m?void 0:m.name)||"",variant_name:(null===m||void 0===m||null===(d=m.VariantItem)||void 0===d?void 0:d.variant_name)||"",batch_no:n.batch_no||""})}return e}));O((e=>(0,i.A)((0,i.A)({},e),{},{items:t})))}),[Qt,Wt,M,P,b,H]),ol=(0,n.useCallback)(((e,t)=>{if(t<0||t>=W.items.length)return console.error("Invalid rowIndex: ".concat(t,". Items length: ").concat(W.items.length)),void a.Ay.error("Invalid row index: ".concat(t,". Please try again."));const l=[...W.items];if(!l[t])return console.error("Item at index ".concat(t," is undefined. Items length: ").concat(l.length)),void a.Ay.error("Selected row is no longer valid. Please try again.");l[t].product_id=e.id||e._id||"",l[t].product_name=e.name||"",l[t].price=e.selling_price||0,nl(l),X(t)}),[nl,W.items.length]),al=()=>{if(null!==J)return X(null),a.Ay.info("Stock modal closed. Opening product selection..."),void setTimeout((()=>{rl()}),100);rl()},rl=()=>{let e=-1;const t=document.activeElement,l=null===t||void 0===t?void 0:t.closest("tr");if(l){const t=l.getAttribute("data-row-key");null!==t&&(e=parseInt(t))}else{const l=null===t||void 0===t?void 0:t.closest("td");if(l){const t=l.closest("tr");if(t){const l=t.getAttribute("data-row-key");null!==l&&(e=parseInt(l))}}}-1===e&&Z&&(e=Z.row),-1===e&&Yt<W.items.length&&(e=Yt),-1===e&&(e=W.items.findIndex((e=>!e.product_id))),-1===e&&(xl(),e=W.items.length),Ft(e),he(!0),a.Ay.info("Opening product selection for row ".concat(e+1))},sl=(0,n.useCallback)((()=>{Ft(0),he(!0),a.Ay.success("\ud83c\udf89 Bill saved! Ready for next bill - Select product to continue.",4)}),[]),dl=()=>{let e=-1;const t=document.activeElement,l=null===t||void 0===t?void 0:t.closest("tr");if(l){const t=l.getAttribute("data-row-key");if(null!==t){var i;const l=parseInt(t);null!==(i=W.items[l])&&void 0!==i&&i.product_id&&(e=l)}}-1===e&&(e=W.items.findIndex((e=>e.product_id&&!e.stock_id))),-1===e&&(e=W.items.findIndex((e=>e.product_id))),-1!==e?(X(e),a.Ay.info("Opening stock selection for row ".concat(e+1))):a.Ay.warning("Please select a product first before selecting stock")},cl=(0,n.useCallback)((e=>{W.customer_id!==e._id&&(O((t=>(0,i.A)((0,i.A)({},t),{},{customer_id:e._id,customer_name:e.full_name}))),setTimeout((()=>{ie(!1),setTimeout((()=>{oe(!0)}),100)}),50),a.Ay.success('Customer "'.concat(e.full_name,'" selected successfully!')))}),[W.customer_id]),ul=(0,n.useCallback)((e=>{W.billed_by_id!==e._id&&(O((t=>(0,i.A)((0,i.A)({},t),{},{billed_by_id:e._id,billed_by_name:e.name}))),setTimeout((()=>{oe(!1)}),50),a.Ay.success('User "'.concat(e.name,'" selected as billed by successfully!')))}),[W.billed_by_id]),ml=()=>{pl(!1),se(!1),me(null),a.Ay.success("New bill form cleared successfully!")},pl=(0,n.useCallback)((function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];O({invoice_no:"",date:p()().format("YYYY-MM-DD"),customer_id:"",customer_name:"",payment_mode:"cash",items:[{product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0}]}),Q({isPaid:!0,isPartiallyPaid:!1,isRetail:!0,isGstIncluded:!0,discount:0,discountType:"percentage",paidAmount:0}),X(null),ee(null),ie(!1),se(!1),ce(!1),me(null),ve(!1),xe(""),he(!1),Ft(null),g("GetAll"),e&&a.Ay.success("Ready for next bill!",2)}),[]),vl=()=>{pl(!1),a.Ay.success("Bill form cleared successfully!")},fl=()=>{if(0===W.items.length)return;let e=!1;const t=W.items.map((t=>{let l=!1;if(t.product_id&&null!==b&&void 0!==b&&b.result){const e=b.result.find((e=>e._id===t.product_id));var i;if(e&&(t.product_name.includes("Loading...")||t.product_name.includes("Product ID:")||!t.product_name))t.product_name=e.name,t.variant_name=(null===(i=e.VariantItem)||void 0===i?void 0:i.variant_name)||"",l=!0}if(t.stock_id){const e=Wt?M:P;if(null!==e&&void 0!==e&&e.result){var n;const i=e.result.find((e=>e._id===t.stock_id));i&&(null!==(n=t.batch_no)&&void 0!==n&&n.includes("Loading...")||!t.batch_no)&&(t.batch_no=i.batch_no||"",l=!0)}}return l&&(e=!0),t}));e&&O((e=>(0,i.A)((0,i.A)({},e),{},{items:t})))},xl=()=>{const e={product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0};O((t=>(0,i.A)((0,i.A)({},t),{},{items:[...t.items,e]})))},yl=async()=>{if(!W.invoice_no||!W.customer_id||!W.items.length)return void a.Ay.error("Please fill all required fields");if(W.items.some((e=>!e.product_id||!e.stock_id||!e.qty&&!e.loose_qty||!e.price)))return void a.Ay.error("Please complete all item details");const e=[];if(W.items.forEach(((t,l)=>{if(t.stock_id&&(t.qty||t.loose_qty)){const i=Ot(t.stock_id,t.qty||0,t.loose_qty||0);i.isValid||e.push("Row ".concat(l+1,": ").concat(i.message))}})),e.length>0)return void a.Ay.error("Stock validation errors:\n".concat(e.join("\n")));if(!W.customer_id)return void a.Ay.error("Please select a customer");if(!W.payment_mode)return void a.Ay.error("Please select a payment mode");const t=(0,i.A)((0,i.A)({invoice_no:W.invoice_no,date:W.date,customer_id:W.customer_id,billed_by_id:W.billed_by_id,payment_mode:W.payment_mode,items:W.items.map((e=>(0,i.A)((0,i.A)({product_id:e.product_id,stock_id:e.stock_id},Wt&&{branch_stock_id:e.stock_id}),{},{qty:e.qty,loose_qty:e.loose_qty,price:e.price,mrp:e.mrp,amount:e.amount,tax_percentage:e.tax_percentage,_id:e._id})))},ll),{},{discount:H.discount,discount_type:H.discountType,is_paid:H.isPaid,is_partially_paid:H.isPartiallyPaid,sale_type:H.isRetail?"retail":"wholesale",is_gst_included:H.isGstIncluded,paid_amount:H.isPartiallyPaid?H.paidAmount:H.isPaid?ll.total_amount:0});try{var n;let e;if(e=l?await h("Update",t,l._id):await h("Create",t),200===(null===(n=e)||void 0===n?void 0:n.statusCode)){const e=(0,i.A)((0,i.A)({},t),{},{customer_name:W.customer_name,total_amount:ll.total_amount,invoice_no:t.invoice_no,date:t.date});me(e),l&&se(!0)}}catch(o){a.Ay.error("Failed to save bill. Please try again.")}},{items:_l,error:hl}=(0,k.Sm)(h.getIdentifier("Create")),{items:gl}=(0,k.Sm)(h.getIdentifier("Update"));return(0,G.z)({action:"update",title:"Bill",identifier:h.getIdentifier("Update"),entityApi:h}),(0,n.useEffect)((()=>{200===(null===_l||void 0===_l?void 0:_l.statusCode)&&(null===o||void 0===o||o(),g("Create"),l||(se(!1),setTimeout((()=>{pl(!1),setTimeout((()=>{sl()}),200)}),100)))}),[_l,l,pl,o,sl]),(0,n.useEffect)((()=>{hl&&a.Ay.error(null===hl||void 0===hl?void 0:hl.message)}),[hl]),(0,n.useEffect)((()=>{200===(null===gl||void 0===gl?void 0:gl.statusCode)&&(null===o||void 0===o||o())}),[gl]),(0,n.useEffect)((()=>{if(null!==b&&void 0!==b&&b.result&&W.items.length>0){if(W.items.some((e=>e.product_id&&(!e.product_name||e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))))){const e=W.items.map((e=>{if(e.product_id&&(!e.product_name||e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))){const l=b.result.find((t=>t._id===e.product_id));var t;if(l)return(0,i.A)((0,i.A)({},e),{},{product_name:l.name,variant_name:(null===(t=l.VariantItem)||void 0===t?void 0:t.variant_name)||""})}return e}));e.some(((e,t)=>e.product_name!==W.items[t].product_name))&&O((t=>(0,i.A)((0,i.A)({},t),{},{items:e})))}}}),[b,W.items]),(0,n.useEffect)((()=>{null!==b&&void 0!==b&&b.result&&W.items.length>0&&setTimeout((()=>{fl()}),200)}),[b]),(0,n.useEffect)((()=>{const e=Wt?M:P;if(null!==e&&void 0!==e&&e.result&&W.items.length>0){if(W.items.some((e=>e.stock_id&&(!e.batch_no||e.batch_no.includes("Loading..."))))){const t=W.items.map((t=>{if(t.stock_id&&(!t.batch_no||t.batch_no.includes("Loading..."))){const l=e.result.find((e=>e._id===t.stock_id));if(l)return(0,i.A)((0,i.A)({},t),{},{batch_no:l.batch_no||""})}return t}));t.some(((e,t)=>e.batch_no!==W.items[t].batch_no))&&O((e=>(0,i.A)((0,i.A)({},e),{},{items:t})))}}}),[M,P,W.items,Wt]),(0,n.useEffect)((()=>{const e=Wt?M:P;null!==e&&void 0!==e&&e.result&&W.items.length>0&&setTimeout((()=>{fl()}),200)}),[M,P,Wt]),(0,n.useEffect)((()=>{if(W.items.length>0){const e=setInterval((()=>{W.items.some((e=>e.product_id&&(!e.product_name||e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))||e.stock_id&&(!e.batch_no||e.batch_no.includes("Loading..."))))&&(null!==b&&void 0!==b&&b.result||(Wt?null===M||void 0===M?void 0:M.result:null===P||void 0===P?void 0:P.result))&&fl()}),1e3);return()=>clearInterval(e)}}),[W.items,b,M,P,Wt]),(0,n.useEffect)((()=>{const e=e=>{if("F1"===e.key)e.preventDefault(),xl(),setTimeout((()=>{const e=document.querySelector('.ant-table-tbody tr:last-child td[data-column-key="product_id"]');null===e||void 0===e||e.focus()}),200);else if("F2"===e.key)e.preventDefault(),yl();else if("F3"===e.key)e.preventDefault(),a.Ay.info("Print functionality coming soon!");else if("F4"===e.key)e.preventDefault(),vl();else if("F5"===e.key)e.preventDefault(),al();else if("End"===e.key)e.preventDefault(),ie(!0);else if("F6"===e.key)e.preventDefault(),ce(!0);else if("F7"===e.key)e.preventDefault(),dl();else if(e.ctrlKey)switch(e.key){case"s":e.preventDefault(),yl();break;case"n":e.preventDefault(),xl(),setTimeout((()=>{const e=document.querySelector('.ant-table-tbody tr:last-child td[data-column-key="product_id"]');null===e||void 0===e||e.focus()}),200);break;case"p":e.preventDefault(),a.Ay.info("Print functionality coming soon!");break;case"r":e.preventDefault(),pl();break;case"u":e.preventDefault(),oe(!0)}else if(e.ctrlKey&&/^[0-9]$/.test(e.key)){e.preventDefault();const t=document.activeElement;if(null!==t&&void 0!==t&&t.closest('td[data-column-key="qty"]')){const l=t.querySelector("input");l&&(l.value=e.key,l.dispatchEvent(new Event("change",{bubbles:!0})))}}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[W,H,al,dl,J]),(0,C.jsxs)("div",{className:je,children:[(0,C.jsx)("div",{className:Ae}),(0,C.jsx)("div",{className:ke}),(0,C.jsx)("div",{className:Ce}),(0,C.jsx)("div",{className:we}),(0,C.jsx)("div",{className:Ie}),(0,C.jsxs)("div",{className:Se,children:[(0,C.jsx)("div",{className:De}),(0,C.jsx)("div",{className:Ne}),(0,C.jsx)("div",{className:Te}),(0,C.jsx)("div",{className:Be}),(0,C.jsx)("div",{className:Pe}),(0,C.jsxs)("div",{className:Ee,children:[(0,C.jsxs)("div",{className:Ge,children:[(0,C.jsx)("div",{className:qe,children:(0,C.jsx)(q.A,{style:{fontSize:"24px",color:"white"}})}),(0,C.jsxs)("div",{children:[(0,C.jsx)(Mt,{level:4,className:Le,children:l?"\u26a1 EDIT INVOICE":"\ud83d\ude80 NEW INVOICE"}),(0,C.jsxs)(Vt,{className:ze,children:["\u26a1Lightning Fast \u2022 ",p()().format("DD MMM YYYY, dddd")]})]})]}),(0,C.jsxs)("div",{className:Re,children:[(0,C.jsxs)("div",{className:"".concat(Me," ").concat(Ve),children:[(0,C.jsx)(Vt,{className:Ke,children:"\ud83c\udfea SALE TYPE"}),(0,C.jsx)(d.A,{checkedChildren:"RETAIL",unCheckedChildren:"WHOLESALE",checked:H.isRetail,onChange:e=>Q((t=>(0,i.A)((0,i.A)({},t),{},{isRetail:e}))),className:qt,size:"small"})]}),(0,C.jsxs)("div",{className:"".concat(Me," ").concat(Fe),children:[(0,C.jsx)(Vt,{className:Ke,children:"\ud83d\udcca GST"}),(0,C.jsx)(d.A,{checkedChildren:"INCL",unCheckedChildren:"EXCL",checked:H.isGstIncluded,onChange:e=>Q((t=>(0,i.A)((0,i.A)({},t),{},{isGstIncluded:e}))),className:Lt,size:"small"})]}),(0,C.jsxs)("div",{className:"".concat(Me," ").concat(Ye),children:[(0,C.jsx)(Vt,{className:Ke,children:"\ud83d\udcb3 PAYMENT"}),(0,C.jsx)(d.A,{checkedChildren:"PAID",unCheckedChildren:"UNPAID",checked:H.isPaid,onChange:e=>Q((t=>(0,i.A)((0,i.A)({},t),{},{isPaid:e,isPartiallyPaid:!e&&t.isPartiallyPaid}))),className:zt,size:"small"})]}),!H.isPaid&&(0,C.jsxs)("div",{className:"".concat(Me," ").concat(Ue),children:[(0,C.jsx)(Vt,{className:Ke,children:"\ud83d\udcb0 PARTIAL"}),(0,C.jsx)(d.A,{checkedChildren:"YES",unCheckedChildren:"NO",checked:H.isPartiallyPaid,onChange:e=>Q((t=>(0,i.A)((0,i.A)({},t),{},{isPartiallyPaid:e}))),className:Rt,size:"small"})]}),(0,C.jsxs)("div",{className:We,children:[(0,C.jsx)("div",{className:Oe,children:(0,C.jsxs)(Vt,{className:Qe,children:["\ud83c\udfaf ITEMS: ",W.items.length]})}),(0,C.jsx)("div",{className:He,children:(0,C.jsxs)(Vt,{className:Qe,children:["\ud83d\udcb0 \u20b9",ll.total_amount.toFixed(2)]})})]})]})]})]}),(0,C.jsx)("div",{className:Je,children:(0,C.jsx)(E,{columns:Zt,dataSource:$t,onSave:il,allowAdd:!1,allowDelete:!1,loading:D,className:"compact-header-grid",size:"small",rowKey:"invoice_no"})}),(0,C.jsxs)("div",{className:Xe,children:[(0,C.jsx)("div",{className:Ze}),(0,C.jsx)("div",{className:$e}),(0,C.jsxs)("div",{className:et,children:[(0,C.jsxs)("div",{className:tt,children:[(0,C.jsx)(Vt,{className:lt,children:"\ud83d\uded2 BILL ITEMS"}),(0,C.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,C.jsx)(c.A,{count:W.items.length,showZero:!0,size:"small",style:{backgroundColor:"rgba(255,255,255,0.2)"},children:(0,C.jsx)(Vt,{className:it,children:"Items"})}),(0,C.jsx)(Vt,{style:{fontSize:"10px",color:"#666",backgroundColor:"#f0f0f0",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d9d9d9"}})]})]}),(0,C.jsx)(E,{columns:el,dataSource:W.items.map(((e,t)=>(0,i.A)((0,i.A)({},e),{},{key:t.toString()}))),onSave:nl,onAdd:xl,onDelete:e=>{O((t=>{const l=t.items.filter(((t,l)=>!e.includes(null===l||void 0===l?void 0:l.toString())));return(0,i.A)((0,i.A)({},t),{},{items:l})}))},onProductSelect:ol,loading:w||R||V,className:"modern-bill-grid",size:"small",rowKey:"key",externalEditingCell:Z})]}),(0,C.jsxs)("div",{className:nt,children:[(0,C.jsx)("div",{className:ot}),(0,C.jsx)("div",{className:at}),(0,C.jsx)("div",{className:rt,children:(0,C.jsx)(Vt,{className:st,children:"\ud83d\udcb0 BILL SUMMARY"})}),(0,C.jsxs)("div",{className:mt,children:[(0,C.jsxs)("div",{className:dt,children:[(0,C.jsx)(Vt,{className:ct,children:"Sub Total:"}),(0,C.jsxs)(Vt,{className:ut,children:["\u20b9",ll.sub_total.toFixed(2)]})]}),(0,C.jsxs)("div",{className:dt,children:[(0,C.jsx)(Vt,{className:ct,children:"Value of Goods:"}),(0,C.jsxs)(Vt,{className:ut,children:["\u20b9",ll.value_of_goods.toFixed(2)]})]}),(0,C.jsxs)("div",{className:dt,children:[(0,C.jsx)(Vt,{className:ct,children:"Total GST:"}),(0,C.jsxs)(Vt,{className:ut,children:["\u20b9",ll.total_gst.toFixed(2)]})]}),(0,C.jsxs)("div",{className:dt,children:[(0,C.jsx)(Vt,{className:ct,children:"CGST:"}),(0,C.jsxs)(Vt,{className:ut,children:["\u20b9",ll.cgst.toFixed(2)]})]}),(0,C.jsxs)("div",{className:dt,children:[(0,C.jsx)(Vt,{className:ct,children:"SGST:"}),(0,C.jsxs)(Vt,{className:ut,children:["\u20b9",ll.sgst.toFixed(2)]})]}),H.discount>0&&(0,C.jsxs)("div",{className:dt,children:[(0,C.jsx)(Vt,{className:ct,children:"DISCOUNT:"}),(0,C.jsxs)(Vt,{className:xt,children:["-\u20b9","percentage"===H.discountType?((ll.sub_total+ll.total_gst)*("number"===typeof H.discount?H.discount:0)/100).toFixed(2):("number"===typeof H.discount?H.discount:0).toFixed(2)]})]}),(0,C.jsxs)("div",{className:pt,children:[(0,C.jsx)(Vt,{className:vt,children:"NET/EXC/REPL:"}),(0,C.jsxs)(Vt,{className:ft,children:["\u20b9",ll.total_amount.toFixed(2)]})]}),H.isPartiallyPaid&&(0,C.jsxs)("div",{className:yt,children:[(0,C.jsxs)("div",{className:_t,children:[(0,C.jsx)(Vt,{className:ht,children:"Paid Amount:"}),(0,C.jsxs)(Vt,{className:gt,children:["\u20b9",("number"===typeof H.paidAmount?H.paidAmount:0).toFixed(2)]})]}),(0,C.jsxs)("div",{className:_t,children:[(0,C.jsx)(Vt,{className:ht,children:"Balance:"}),(0,C.jsxs)(Vt,{className:gt,children:["\u20b9",(ll.total_amount-("number"===typeof H.paidAmount?H.paidAmount:0)).toFixed(2)]})]})]})]}),(0,C.jsxs)("div",{className:bt,children:[(0,C.jsxs)("div",{className:jt,children:[(0,C.jsx)(Vt,{className:At,children:"\ud83d\udcb8 DISCOUNT"}),(0,C.jsxs)("div",{className:kt,children:[(0,C.jsx)(s.A,{min:0,value:H.discount,onChange:e=>Q((t=>(0,i.A)((0,i.A)({},t),{},{discount:e||0}))),style:{width:70},size:"small"}),(0,C.jsx)(d.A,{checkedChildren:"%",unCheckedChildren:"\u20b9",checked:"percentage"===H.discountType,onChange:e=>Q((t=>(0,i.A)((0,i.A)({},t),{},{discountType:e?"percentage":"amount"}))),size:"small"})]})]}),H.isPartiallyPaid&&(0,C.jsxs)("div",{className:Ue,children:[(0,C.jsx)(Vt,{className:Ct,children:"\ud83d\udcb0 PARTIAL PAY"}),(0,C.jsx)(s.A,{min:0,max:ll.total_amount,value:H.paidAmount,onChange:e=>Q((t=>(0,i.A)((0,i.A)({},t),{},{paidAmount:e||0}))),style:{width:90},size:"small",formatter:e=>"\u20b9".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>Number(e.replace(/\u20b9\s?|(,*)/g,""))})]})]})]})]}),(0,C.jsxs)("div",{className:wt,children:[(0,C.jsx)("div",{className:St}),(0,C.jsx)("div",{className:Dt}),(0,C.jsx)("div",{className:Nt}),(0,C.jsx)("div",{className:Tt}),(0,C.jsxs)("div",{className:It,children:[(0,C.jsxs)(u.Ay,{type:"primary",size:"large",icon:(0,C.jsx)(j.A,{}),onClick:yl,loading:K,className:Bt,children:["\ud83d\ude80 ",l?"UPDATE":"SAVE BILL"," (F2)"]}),(0,C.jsx)(u.Ay,{size:"large",icon:(0,C.jsx)(q.A,{}),onClick:()=>ce(!0),className:Pt,children:"\ud83d\udccb BILL LIST (F6)"}),(0,C.jsx)(u.Ay,{size:"large",icon:(0,C.jsx)(L.A,{}),onClick:vl,className:Gt,children:"\ud83e\uddf9 CLEAR (F4 / Ctrl+R)"}),(0,C.jsx)(u.Ay,{size:"large",icon:(0,C.jsx)(z.A,{}),className:Et,children:"\ud83d\udda8\ufe0f PRINT (F3)"})]}),(0,C.jsx)("div",{style:{background:"linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)",padding:"14px 18px",borderRadius:"10px",border:"1px solid #cbd5e1",position:"relative",zIndex:1,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.05)"},children:(0,C.jsx)("div",{style:{textAlign:"right"},children:(0,C.jsxs)(Vt,{style:{color:"#475569",fontSize:"12px",display:"block",fontWeight:600,lineHeight:"18px"},children:["\u26a1 ",(0,C.jsx)("strong",{children:"Keyboard Shortcuts:"})," Ctrl+S (Save) \u2022 Ctrl+N (Add) \u2022 F4/Ctrl+R (Clear) \u2022 Tab/Shift+Tab (Navigate) \u2022 Enter (Edit) \u2022 Esc (Cancel) \u2022 End (Customer) \u2022 Ctrl+U (User) \u2022 F5 (Product) \u2022 F6 (Bill List) \u2022 F7 (Stock)"]})})})]}),null!==J&&(0,C.jsx)(B,{visible:!0,onSelect:e=>{if(null===J)return;if(J<0||J>=W.items.length)return console.error("Invalid stockModalRowIndex: ".concat(J,". Items length: ").concat(W.items.length)),a.Ay.error("Invalid row index: ".concat(J,". Please try again.")),void X(null);const t=[...W.items];if(!t[J])return console.error("Item at index ".concat(J," is undefined. Items length: ").concat(t.length)),a.Ay.error("Selected row is no longer valid. Please try again."),void X(null);t[J].stock_id=e.id||e._id||e.invoice_id||"",t[J].batch_no=e.batch_no||"",nl(t),X(null),-1!==tl&&ee({row:J,col:tl})},onCancel:()=>X(null),productId:(null===(t=W.items[J])||void 0===t?void 0:t.product_id)||""}),(0,C.jsx)($,{visible:te,onSelect:cl,onCancel:()=>ie(!1)}),(0,C.jsx)(le,{visible:ne,onSelect:ul,onCancel:()=>oe(!1)}),(0,C.jsx)(re,{visible:ae,onNewBill:ml,onContinueBill:()=>{se(!1),me(null)},onCancel:()=>se(!1),savedBillData:ue}),(0,C.jsx)(be,{visible:pe,onCancel:()=>ve(!1),productId:fe}),(0,C.jsx)(I,{visible:_e,onSelect:e=>{var t;if(null===ge)return;if(ge<0||ge>=W.items.length)return console.error("Invalid productSelectionRowIndex: ".concat(ge,". Items length: ").concat(W.items.length)),a.Ay.error("Invalid row index: ".concat(ge,". Please try again.")),void Ft(null);const l=[...W.items];if(!l[ge])return console.error("Item at index ".concat(ge," is undefined. Items length: ").concat(l.length)),a.Ay.error("Selected row is no longer valid. Please try again."),void Ft(null);l[ge].product_id=e._id||"",l[ge].product_name=e.name||"",l[ge].variant_name=(null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)||"",l[ge].price=e.selling_price||0,nl(l),he(!1),Ft(null),X(ge),a.Ay.success('Product "'.concat(e.name,'" selected successfully!'))},onCancel:()=>{he(!1),Ft(null)}}),(0,C.jsx)(ye,{visible:de,onClose:()=>ce(!1),onViewBill:e=>{var t,l,n,o,r;if(!e)return void a.Ay.error("No bill data received");v("GetAll"),f("GetAll"),Wt?_("GetAll"):y("GetAll"),null!==b&&void 0!==b&&b.result||v("GetAll"),null!==S&&void 0!==S&&S.result||f("GetAll");const s=Wt?M:P;null!==s&&void 0!==s&&s.result||(Wt?_("GetAll"):y("GetAll"));let d=[];e.Items&&Array.isArray(e.Items)?d=e.Items:e.items&&Array.isArray(e.items)?d=e.items:e.sales_items&&Array.isArray(e.sales_items)?d=e.sales_items:e.result&&e.result.Items&&Array.isArray(e.result.Items)?d=e.result.Items:e.result&&e.result.items&&Array.isArray(e.result.items)&&(d=e.result.items);const c=d.map(((e,t)=>{var l,n;let o="",a="";var r;if(null!==(l=e.productItems)&&void 0!==l&&l.name)o=e.productItems.name,a=(null===(r=e.productItems.VariantItem)||void 0===r?void 0:r.variant_name)||"";else if(e.product_name)o=e.product_name,a=e.variant_name||"";else if(null!==(n=e.product)&&void 0!==n&&n.name){var s;o=e.product.name,a=(null===(s=e.product.VariantItem)||void 0===s?void 0:s.variant_name)||""}else if(e.product_id){var d;const t=null===b||void 0===b||null===(d=b.result)||void 0===d?void 0:d.find((t=>t._id===e.product_id));var c;if(t)o=t.name,a=(null===(c=t.VariantItem)||void 0===c?void 0:c.variant_name)||"";else null!==b&&void 0!==b&&b.result||v("GetAll"),o="Loading... (ID: ".concat(e.product_id,")"),setTimeout((()=>{if(null!==b&&void 0!==b&&b.result){const l=b.result.find((t=>t._id===e.product_id));if(l){const n=[...W.items],o=n.findIndex((t=>t.product_id===e.product_id));var t;if(-1!==o)n[o].product_name=l.name,n[o].variant_name=(null===(t=l.VariantItem)||void 0===t?void 0:t.variant_name)||"",O((e=>(0,i.A)((0,i.A)({},e),{},{items:n})))}}}),100)}let u="",m="";if(e.stock_id?(u=e.stock_id,m=e.batch_no||""):e.branch_stock_id?(u=e.branch_stock_id,m=e.batch_no||""):e.stock&&(u=e.stock,m=e.batch_no||""),u&&!m){var p;const e=Wt?M:P,t=null===e||void 0===e||null===(p=e.result)||void 0===p?void 0:p.find((e=>e._id===u));t?m=t.batch_no||"":(null!==e&&void 0!==e&&e.result||(Wt?_("GetAll"):y("GetAll")),m="Loading... (Stock: ".concat(u,")"),setTimeout((()=>{const e=Wt?M:P;if(null!==e&&void 0!==e&&e.result){const t=e.result.find((e=>e._id===u));if(t){const e=[...W.items],l=e.findIndex((e=>e.stock_id===u));-1!==l&&(e[l].batch_no=t.batch_no||"",O((t=>(0,i.A)((0,i.A)({},t),{},{items:e}))))}}}),100))}return{_id:e._id||"",product_id:e.product_id||e.product||"",product_name:o,variant_name:a,stock_id:u,batch_no:m,qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price||0,mrp:e.mrp||e.price||0,amount:e.amount||0,tax_percentage:e.tax_percentage||0}})),u=e.customer_id||"";let m="";if(null!==(t=e.customerDetails)&&void 0!==t&&t.full_name)m=e.customerDetails.full_name;else if(e.customer_name)m=e.customer_name;else if(null!==(l=e.customer)&&void 0!==l&&l.full_name)m=e.customer.full_name;else if(e.customer_id){var x;const t=null===S||void 0===S||null===(x=S.result)||void 0===x?void 0:x.find((t=>t._id===e.customer_id));m=(null===t||void 0===t?void 0:t.full_name)||"Customer ID: ".concat(e.customer_id)}let h=p()().format("YYYY-MM-DD");if(e.date)try{h=p()(e.date).format("YYYY-MM-DD")}catch(A){h=p()().format("YYYY-MM-DD")}let g=[...c];null!==b&&void 0!==b&&b.result&&(g=g.map((e=>{if(e.product_id&&(e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))){const l=b.result.find((t=>t._id===e.product_id));var t;if(l)return(0,i.A)((0,i.A)({},e),{},{product_name:l.name,variant_name:(null===(t=l.VariantItem)||void 0===t?void 0:t.variant_name)||""})}return e})));const j=Wt?M:P;null!==j&&void 0!==j&&j.result&&(g=g.map((e=>{if(e.stock_id&&(e.batch_no.includes("Loading...")||!e.batch_no)){const t=j.result.find((t=>t._id===e.stock_id));if(t)return(0,i.A)((0,i.A)({},e),{},{batch_no:t.batch_no||""})}return e}))),O({invoice_no:e.invoice_no||"",date:h,customer_id:u,customer_name:m,payment_mode:e.payment_mode||"cash",items:g}),Q({isPaid:null===(n=e.is_paid)||void 0===n||n,isPartiallyPaid:null!==(o=e.is_partially_paid)&&void 0!==o&&o,isRetail:"retail"===e.sale_type||void 0===e.sale_type,isGstIncluded:null===(r=e.is_gst_included)||void 0===r||r,discount:e.discount||0,discountType:e.discount_type||"percentage",paidAmount:e.paid_amount||0}),a.Ay.success('Bill "'.concat(e.invoice_no,'" loaded successfully!')),setTimeout((()=>{fl()}),100),setTimeout((()=>{fl()}),500),setTimeout((()=>{fl()}),1e3)},onNewBill:ml})]})}}}]);
//# sourceMappingURL=468.87e05431.chunk.js.map