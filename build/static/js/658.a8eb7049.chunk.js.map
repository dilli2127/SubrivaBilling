{"version":3,"file":"static/js/658.a8eb7049.chunk.js","mappings":"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","sources":["pages/RetaillBill/components/ProductSelectionModal.tsx","pages/RetaillBill/components/StockSelectionModal.tsx","components/common/AntdEditableTable.tsx","hooks/useGenericCrudRTK.ts","pages/RetaillBill/components/CustomerSelectionModal.tsx","pages/RetaillBill/components/UserSelectionModal.tsx","pages/RetaillBill/components/BillSaveConfirmationModal.tsx","pages/RetaillBill/components/BillListDrawer.tsx","pages/RetaillBill/components/ProductDetailsModal.tsx","webpack://SUBRIVA-BILLING/./src/pages/RetaillBill/components/BillDataGrid.module.css?232c","pages/RetaillBill/components/BillDataGrid.tsx","helpers/amount_calculations.ts"],"sourcesContent":["import React, { useEffect, useState, FC, KeyboardEvent, useRef } from 'react';\r\nimport { Modal, Table, Input, Button, Space, message } from 'antd';\r\nimport type { InputRef } from 'antd/es/input';\r\nimport { BarcodeOutlined, ScanOutlined } from '@ant-design/icons';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport type { ColumnType } from 'antd/es/table';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\nimport BarcodeScanner from '../../../components/common/BarcodeScanner';\r\n\r\nconst { Search } = Input;\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name?: string;\r\n  sku?: string;\r\n  selling_price?: number;\r\n  VariantItem?: {\r\n    variant_name?: string;\r\n    variant_code?: string;\r\n  };\r\n}\r\n\r\ninterface ProductSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (product: Product) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst ProductSelectionModal: FC<ProductSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const ProductsApi = getEntityApi('Product');\r\n  const { items: products, loading } = useDynamicSelector(\r\n    ProductsApi.getIdentifier('GetAll')\r\n  );\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedRowKey, setSelectedRowKey] = useState<React.Key | null>(null);\r\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\r\n  const [scannerVisible, setScannerVisible] = useState(false);\r\n  const searchInputRef = useRef<InputRef>(null);\r\n\r\n  const filteredProducts: Product[] =\r\n    products?.result?.filter((p: Product) => {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      return (\r\n        (p.name?.toLowerCase() || '').includes(searchLower) ||\r\n        (p.sku?.toLowerCase() || '').includes(searchLower) ||\r\n        p.VariantItem?.variant_name?.toLowerCase().includes(searchLower) ||\r\n        p.VariantItem?.variant_code?.toLowerCase().includes(searchLower) ||\r\n        (p.selling_price?.toString() || '').includes(searchLower)\r\n      );\r\n    }).sort((a: Product, b: Product) => {\r\n      // Prioritize exact matches and matches at the beginning\r\n      const searchLower = searchTerm.toLowerCase();\r\n      \r\n      // Check for exact matches first\r\n      const aExactMatch = (a.name?.toLowerCase() || '') === searchLower || \r\n                          a.VariantItem?.variant_name?.toLowerCase() === searchLower ||\r\n                          (a.sku?.toLowerCase() || '') === searchLower;\r\n      const bExactMatch = (b.name?.toLowerCase() || '') === searchLower || \r\n                          b.VariantItem?.variant_name?.toLowerCase() === searchLower ||\r\n                          (b.sku?.toLowerCase() || '') === searchLower;\r\n      \r\n      if (aExactMatch && !bExactMatch) return -1;\r\n      if (!aExactMatch && bExactMatch) return 1;\r\n      \r\n      // Then check for matches at the beginning\r\n      const aStartsWith = (a.name?.toLowerCase() || '').startsWith(searchLower) || \r\n                          a.VariantItem?.variant_name?.toLowerCase().startsWith(searchLower) ||\r\n                          (a.sku?.toLowerCase() || '').startsWith(searchLower);\r\n      const bStartsWith = (b.name?.toLowerCase() || '').startsWith(searchLower) || \r\n                          b.VariantItem?.variant_name?.toLowerCase().startsWith(searchLower) ||\r\n                          (b.sku?.toLowerCase() || '').startsWith(searchLower);\r\n      \r\n      if (aStartsWith && !bStartsWith) return -1;\r\n      if (!aStartsWith && bStartsWith) return 1;\r\n      \r\n      return 0;\r\n    }) || [];\r\n\r\n  useEffect(() => {\r\n    setHighlightedIndex(0);\r\n    if (filteredProducts.length > 0) {\r\n              setSelectedRowKey(filteredProducts[0]._id);\r\n    } else {\r\n      setSelectedRowKey(null);\r\n    }\r\n  }, [searchTerm, visible, products]);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n      }, 100);\r\n    }\r\n  }, [visible]);\r\n\r\n  const columns: ColumnType<Product>[] = [\r\n    { \r\n      title: 'Product & Variant', \r\n      dataIndex: 'name', \r\n      key: 'name', \r\n      width: 250,\r\n      render: (name, record) => (\r\n        <div>\r\n          <div style={{ fontWeight: 600, color: '#1890ff' }}>{name}</div>\r\n          {record.VariantItem?.variant_name && (\r\n            <div style={{ fontSize: '12px', color: '#52c41a', marginTop: '2px' }}>\r\n              Variant: {record.VariantItem.variant_name}\r\n              {record.VariantItem?.variant_code && (\r\n                <span style={{ marginLeft: '8px', color: '#fa8c16', fontSize: '11px' }}>\r\n                  ({record.VariantItem.variant_code})\r\n                </span>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    { title: 'Variant', dataIndex: 'VariantItem', key: 'variant', width: 120, \r\n      render: (variant) => variant?.variant_name ? (\r\n        <span style={{ color: '#52c41a', fontWeight: 500 }}>{variant.variant_name}</span>\r\n      ) : (\r\n        <span style={{ color: '#bfbfbf', fontStyle: 'italic' }}>No variant</span>\r\n      ) },\r\n    { title: 'SKU', dataIndex: 'sku', key: 'sku', width: 120 },\r\n    { title: 'Price', dataIndex: 'selling_price', key: 'selling_price', width: 100,\r\n      render: (price) => (\r\n        <span style={{ \r\n          color: '#52c41a', \r\n          fontWeight: 600, \r\n          fontSize: '14px' \r\n        }}>\r\n          {price?.toFixed(2) || '0.00'}\r\n        </span>\r\n      ) },\r\n  ];\r\n\r\n  const handleSelectRow = (product: Product) => {\r\n    onSelect(product);\r\n  };\r\n\r\n  // Handle barcode scan\r\n  const handleBarcodeScan = (barcode: string) => {\r\n    setSearchTerm(barcode);\r\n    setScannerVisible(false);\r\n    \r\n    // Try to find product by barcode/SKU\r\n    const foundProduct = products?.result?.find((p: Product) => {\r\n      const searchLower = barcode.toLowerCase();\r\n      return (\r\n        (p.sku?.toLowerCase() || '').includes(searchLower) ||\r\n        (p.name?.toLowerCase() || '').includes(searchLower) ||\r\n        p.VariantItem?.variant_code?.toLowerCase().includes(searchLower)\r\n      );\r\n    });\r\n\r\n    if (foundProduct) {\r\n      // Auto-select the found product\r\n      setTimeout(() => {\r\n        onSelect(foundProduct);\r\n      }, 500);\r\n      message.success(`Product found: ${foundProduct.name}`);\r\n    } else {\r\n      message.warning(`No product found with barcode: ${barcode}`);\r\n    }\r\n  };\r\n\r\n  const handleSearchKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!filteredProducts.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        const next = Math.min(prev + 1, filteredProducts.length - 1);\r\n        setSelectedRowKey(filteredProducts[next]._id);\r\n        return next;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        const prevIndex = Math.max(prev - 1, 0);\r\n        setSelectedRowKey(filteredProducts[prevIndex]._id);\r\n        return prevIndex;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedProduct = filteredProducts[highlightedIndex];\r\n      if (selectedProduct) {\r\n        handleSelectRow(selectedProduct);\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      onCancel();\r\n    }\r\n  };\r\n\r\n  // Auto-focus back to search input when clicking outside\r\n  const handleModalClick = () => {\r\n    searchInputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select Product & Variant (F5 to reopen anytime)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      width={900}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div onClick={handleModalClick}>\r\n        <Space.Compact style={{ marginBottom: 16, width: '100%' }}>\r\n          <Search\r\n            ref={searchInputRef}\r\n            placeholder=\"Search by product name, variant, SKU, or price (use  arrows to navigate, Enter to select)\"\r\n            onChange={e => setSearchTerm(e.target.value)}\r\n            style={{ flex: 1 }}\r\n            autoFocus\r\n            onKeyDown={handleSearchKeyDown}\r\n            onBlur={() => {\r\n              // Re-focus after a short delay to ensure it stays focused\r\n              setTimeout(() => {\r\n                if (visible) {\r\n                  searchInputRef.current?.focus();\r\n                }\r\n              }, 10);\r\n            }}\r\n            value={searchTerm}\r\n          />\r\n          <Button \r\n            type=\"primary\" \r\n            icon={<ScanOutlined />}\r\n            onClick={() => setScannerVisible(true)}\r\n            style={{ minWidth: 100 }}\r\n          >\r\n            Scan\r\n          </Button>\r\n        </Space.Compact>\r\n        <Table\r\n          dataSource={filteredProducts}\r\n          columns={columns}\r\n          loading={loading}\r\n          rowKey=\"_id\"\r\n          size=\"small\"\r\n          pagination={false}\r\n          onRow={(record, idx) => ({\r\n            onClick: () => {\r\n              handleSelectRow(record);\r\n              // Keep focus on search input after selection\r\n              setTimeout(() => {\r\n                searchInputRef.current?.focus();\r\n              }, 10);\r\n            },\r\n            onDoubleClick: () => handleSelectRow(record),\r\n            className:\r\n              idx === highlightedIndex\r\n                ? 'ant-table-row ant-table-row-selected'\r\n                : 'ant-table-row',\r\n            style: {\r\n              backgroundColor: idx === highlightedIndex ? '#e6f7ff' : undefined,\r\n              border: idx === highlightedIndex ? '2px solid #1890ff' : undefined,\r\n            },\r\n          })}\r\n          rowSelection={{\r\n            type: 'radio',\r\n            selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n            onChange: keys => {\r\n              setSelectedRowKey(keys[0]);\r\n              const idx = filteredProducts.findIndex(p => p._id === keys[0]);\r\n              if (idx !== -1) setHighlightedIndex(idx);\r\n            },\r\n          }}\r\n          scroll={{ y: 300 }}\r\n        />\r\n              <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n        <strong>Keyboard Shortcuts:</strong>  Navigate products | Enter Select | Escape Cancel\r\n        <br />\r\n        <strong>Search:</strong> Product name, variant name, SKU, or price\r\n        <br />\r\n        <strong>Barcode Scanner:</strong> Click \"Scan\" button or use USB barcode scanner\r\n        <br />\r\n        <strong>Tip:</strong> Press F5 anytime to reopen this modal for product changes\r\n      </div>\r\n      </div>\r\n\r\n      {/* Barcode Scanner Modal */}\r\n      <BarcodeScanner\r\n        visible={scannerVisible}\r\n        onClose={() => setScannerVisible(false)}\r\n        onScan={handleBarcodeScan}\r\n        title=\"Scan Product Barcode\"\r\n        description=\"Scan barcode to find product automatically\"\r\n      />\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProductSelectionModal;\r\n","import React, { useEffect, useState, FC, KeyboardEvent, useRef } from 'react';\r\nimport { Modal, Table, Input, Tag, Tooltip, message } from 'antd';\r\nimport type { InputRef } from 'antd/es/input';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport type { ColumnType } from 'antd/es/table';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\nimport dayjs from 'dayjs';\r\nimport {\r\n  ExclamationCircleOutlined,\r\n  CheckCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport type { Stock } from '../../../types/entities';\r\n\r\nconst { Search } = Input;\r\n\r\ninterface StockSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (stock: {\r\n    id: string;\r\n    _id: string;\r\n    batch_no: string;\r\n    name: string;\r\n    code?: string;\r\n    available_quantity: number;\r\n    sell_price: number;\r\n  }) => void;\r\n  onCancel: () => void;\r\n  productId: string;\r\n}\r\n\r\nconst StockSelectionModal: FC<StockSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n  productId, // <-- Destructure\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const StockApi = getEntityApi('StockAudit');\r\n  const { items: stocks, loading } = useDynamicSelector(\r\n    StockApi.getIdentifier('GetAll')\r\n  );\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedRowKey, setSelectedRowKey] = useState<React.Key | null>(null);\r\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\r\n  const [errorMessage, setErrorMessage] = useState<string>('');\r\n  const tableBodyRef = useRef<HTMLDivElement>(null);\r\n  const searchInputRef = useRef<InputRef>(null);\r\n\r\n  // Helper function to check if stock is expired\r\n  const isStockExpired = (stock: Stock): boolean => {\r\n    return !!(stock.expiry_date && dayjs(stock.expiry_date).isBefore(dayjs()));\r\n  };\r\n\r\n  // Helper function to check if stock has zero quantity\r\n  const isStockOutOfStock = (stock: Stock): boolean => {\r\n    return stock.available_quantity <= 0;\r\n  };\r\n\r\n  // Helper function to show expired stock error message\r\n  const showExpiredStockError = (stock: Stock) => {\r\n    const expiryDate = dayjs(stock.expiry_date).format('DD/MM/YYYY');\r\n    const errorMsg = `Cannot select expired stock! This item expired on ${expiryDate}. Please select a valid stock item.`;\r\n    setErrorMessage(errorMsg);\r\n    message.error(errorMsg);\r\n\r\n    // Clear error message after 5 seconds\r\n    setTimeout(() => {\r\n      setErrorMessage('');\r\n    }, 5000);\r\n  };\r\n\r\n  // Helper function to show out of stock error message\r\n  const showOutOfStockError = (stock: Stock) => {\r\n    const errorMsg = `Cannot select out of stock item! This item has 0 available quantity. Please select a stock item with available quantity.`;\r\n    setErrorMessage(errorMsg);\r\n    message.error(errorMsg);\r\n\r\n    // Clear error message after 5 seconds\r\n    setTimeout(() => {\r\n      setErrorMessage('');\r\n    }, 5000);\r\n  };\r\n\r\n  const filteredStocks: Stock[] =\r\n    stocks?.result?.filter((s: Stock) => {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      return (\r\n        s.batch_no?.toLowerCase().includes(searchLower) ||\r\n        s.ProductItem?.name?.toLowerCase().includes(searchLower) ||\r\n        s.ProductItem?.VariantItem?.variant_name\r\n          ?.toLowerCase()\r\n          .includes(searchLower) ||\r\n        s.available_quantity?.toString().includes(searchLower) ||\r\n        s.sell_price?.toString().includes(searchLower)\r\n      );\r\n    }) || [];\r\n\r\n  // Show all stocks including expired ones, but disable selection of expired items\r\n  const allStocks = filteredStocks;\r\n\r\n  useEffect(() => {\r\n    setHighlightedIndex(0);\r\n    setErrorMessage(''); // Clear any existing error messages\r\n    if (allStocks.length > 0) {\r\n      // Find the first valid stock (not expired and not out of stock)\r\n      let firstValidIndex = 0;\r\n      while (\r\n        firstValidIndex < allStocks.length &&\r\n        ((allStocks[firstValidIndex].expiry_date &&\r\n          dayjs(allStocks[firstValidIndex].expiry_date).isBefore(dayjs())) ||\r\n          allStocks[firstValidIndex].available_quantity <= 0)\r\n      ) {\r\n        firstValidIndex++;\r\n      }\r\n      if (firstValidIndex < allStocks.length) {\r\n        setSelectedRowKey(allStocks[firstValidIndex]._id);\r\n        setHighlightedIndex(firstValidIndex);\r\n      } else {\r\n        setSelectedRowKey(null);\r\n      }\r\n    } else {\r\n      setSelectedRowKey(null);\r\n    }\r\n  }, [searchTerm, visible, stocks]);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setErrorMessage(''); // Clear error messages when modal opens\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n      }, 0);\r\n    }\r\n  }, [visible]);\r\n\r\n  useEffect(() => {\r\n    if (tableBodyRef.current) {\r\n      const row = tableBodyRef.current.querySelector(\r\n        `.ant-table-row[data-row-key='${allStocks[highlightedIndex]?._id}']`\r\n      ) as HTMLElement;\r\n      row?.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  }, [highlightedIndex, allStocks]);\r\n\r\n  useEffect(() => {\r\n    if (visible && productId) {\r\n      StockApi('GetAll', { product: productId });\r\n    }\r\n  }, [visible, productId, StockApi]);\r\n\r\n  const columns: ColumnType<Stock>[] = [\r\n    {\r\n      title: 'Product',\r\n      dataIndex: 'ProductItem',\r\n      key: 'product',\r\n      render: (ProductItem: any) => ProductItem?.name || 'N/A',\r\n    },\r\n    {\r\n      title: 'Variant',\r\n      dataIndex: 'ProductItem',\r\n      key: 'variant',\r\n      render: (ProductItem: any) =>\r\n        ProductItem?.VariantItem?.variant_name || 'N/A',\r\n    },\r\n    { title: 'Batch No', dataIndex: 'batch_no', key: 'batch_no' },\r\n    {\r\n      title: 'Available',\r\n      dataIndex: 'available_quantity',\r\n      key: 'available_quantity',\r\n      render: (available_quantity: number, record: Stock) => {\r\n        const isOutOfStock = available_quantity <= 0;\r\n        return (\r\n          <span\r\n            style={{\r\n              color: isOutOfStock ? '#ff4d4f' : '#52c41a',\r\n              fontWeight: isOutOfStock ? 'bold' : 'normal',\r\n            }}\r\n          >\r\n            {available_quantity}\r\n            {isOutOfStock && (\r\n              <ExclamationCircleOutlined\r\n                style={{ marginLeft: 4, color: '#ff4d4f' }}\r\n              />\r\n            )}\r\n          </span>\r\n        );\r\n      },\r\n    },\r\n    { title: 'Price', dataIndex: 'sell_price', key: 'sell_price' },\r\n    {\r\n      title: 'Expiry Date',\r\n      dataIndex: 'expiry_date',\r\n      key: 'expiry_date',\r\n      render: (expiry_date: string, record: Stock) => {\r\n        if (!expiry_date)\r\n          return <span style={{ color: '#999' }}>No Expiry</span>;\r\n\r\n        const expiryDate = dayjs(expiry_date);\r\n        const today = dayjs();\r\n        const isExpired = expiryDate.isBefore(today);\r\n        const daysUntilExpiry = expiryDate.diff(today, 'days');\r\n\r\n        let color = 'green';\r\n        let icon = <CheckCircleOutlined />;\r\n        let status = 'Valid';\r\n\r\n        if (isExpired) {\r\n          color = 'red';\r\n          icon = <ExclamationCircleOutlined />;\r\n          status = 'Expired';\r\n        } else if (daysUntilExpiry <= 30) {\r\n          color = 'orange';\r\n          icon = <ExclamationCircleOutlined />;\r\n          status = `Expires in ${daysUntilExpiry} days`;\r\n        }\r\n\r\n        return (\r\n          <Tooltip title={status}>\r\n            <Tag color={color} icon={icon}>\r\n              {expiryDate.format('DD/MM/YYYY')}\r\n            </Tag>\r\n          </Tooltip>\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  const handleSelectRow = (stock: Stock) => {\r\n    // Check if stock is expired and show error message\r\n    if (isStockExpired(stock)) {\r\n      showExpiredStockError(stock);\r\n      return;\r\n    }\r\n\r\n    // Check if stock is out of stock and show error message\r\n    if (isStockOutOfStock(stock)) {\r\n      showOutOfStockError(stock);\r\n      return;\r\n    }\r\n\r\n    // Clear any existing error message\r\n    setErrorMessage('');\r\n\r\n    onSelect({\r\n      id: stock._id,\r\n      _id: stock._id,\r\n      batch_no: stock.batch_no,\r\n      name: stock.ProductItem?.name || stock.name || '',\r\n      code: stock.code,\r\n      available_quantity: stock.available_quantity,\r\n      sell_price: stock.sell_price,\r\n    });\r\n  };\r\n\r\n  const handleSearchKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!allStocks.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        let next = prev + 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          next < allStocks.length &&\r\n          ((allStocks[next].expiry_date &&\r\n            dayjs(allStocks[next].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[next].available_quantity <= 0)\r\n        ) {\r\n          next++;\r\n        }\r\n        const finalNext = Math.min(next, allStocks.length - 1);\r\n        setSelectedRowKey(allStocks[finalNext]._id);\r\n        return finalNext;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        let prevIndex = prev - 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          prevIndex >= 0 &&\r\n          ((allStocks[prevIndex].expiry_date &&\r\n            dayjs(allStocks[prevIndex].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[prevIndex].available_quantity <= 0)\r\n        ) {\r\n          prevIndex--;\r\n        }\r\n        const finalPrev = Math.max(prevIndex, 0);\r\n        setSelectedRowKey(allStocks[finalPrev]._id);\r\n        return finalPrev;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedStock = allStocks[highlightedIndex];\r\n      if (selectedStock) {\r\n        handleSelectRow(selectedStock);\r\n        // Only close modal if selection was successful (not expired and not out of stock)\r\n        if (\r\n          !isStockExpired(selectedStock) &&\r\n          !isStockOutOfStock(selectedStock)\r\n        ) {\r\n          onCancel(); // Close the modal after selection\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleTableKeyDown = (e: KeyboardEvent<HTMLDivElement>) => {\r\n    if (!allStocks.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(i => {\r\n        let next = i + 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          next < allStocks.length &&\r\n          ((allStocks[next].expiry_date &&\r\n            dayjs(allStocks[next].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[next].available_quantity <= 0)\r\n        ) {\r\n          next++;\r\n        }\r\n        const finalNext = Math.min(next, allStocks.length - 1);\r\n        setSelectedRowKey(allStocks[finalNext]._id);\r\n        return finalNext;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(i => {\r\n        let prev = i - 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          prev >= 0 &&\r\n          ((allStocks[prev].expiry_date &&\r\n            dayjs(allStocks[prev].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[prev].available_quantity <= 0)\r\n        ) {\r\n          prev--;\r\n        }\r\n        const finalPrev = Math.max(prev, 0);\r\n        setSelectedRowKey(allStocks[finalPrev]._id);\r\n        return finalPrev;\r\n      });\r\n      // Keep focus on search input\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedStock = allStocks[highlightedIndex];\r\n      if (selectedStock) {\r\n        handleSelectRow(selectedStock);\r\n        // Only close modal if selection was successful (not expired and not out of stock)\r\n        if (\r\n          !isStockExpired(selectedStock) &&\r\n          !isStockOutOfStock(selectedStock)\r\n        ) {\r\n          onCancel(); // Close the modal after selection\r\n        }\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Tab' && e.shiftKey) {\r\n      e.preventDefault();\r\n      searchInputRef.current?.focus();\r\n    }\r\n  };\r\n\r\n  // Auto-focus back to search input when clicking outside\r\n  const handleModalClick = () => {\r\n    searchInputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select Stock (F7 to reopen anytime)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      width={800}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div onClick={handleModalClick}>\r\n        <Search\r\n          ref={searchInputRef}\r\n          placeholder=\"Search stocks (use  arrows to navigate, Enter to select)\"\r\n          onChange={e => setSearchTerm(e.target.value)}\r\n          style={{ marginBottom: 16 }}\r\n          autoFocus\r\n          onKeyDown={handleSearchKeyDown}\r\n          onBlur={() => {\r\n            // Re-focus after a short delay to ensure it stays focused\r\n            setTimeout(() => {\r\n              if (visible) {\r\n                searchInputRef.current?.focus();\r\n              }\r\n            }, 10);\r\n          }}\r\n        />\r\n\r\n        {/* Error Message Display */}\r\n        {errorMessage && (\r\n          <div\r\n            style={{\r\n              marginBottom: 16,\r\n              padding: '12px 16px',\r\n              backgroundColor: '#fff2f0',\r\n              border: '1px solid #ffccc7',\r\n              borderRadius: '6px',\r\n              color: '#cf1322',\r\n              fontSize: '14px',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '8px',\r\n            }}\r\n          >\r\n            <ExclamationCircleOutlined style={{ color: '#cf1322' }} />\r\n            {errorMessage}\r\n          </div>\r\n        )}\r\n\r\n        <div\r\n          onKeyDown={handleTableKeyDown}\r\n          tabIndex={0}\r\n          ref={tableBodyRef}\r\n          style={{ outline: 'none' }}\r\n        >\r\n          <Table\r\n            dataSource={allStocks}\r\n            columns={columns}\r\n            loading={loading}\r\n            rowKey=\"_id\"\r\n            size=\"small\"\r\n            pagination={false}\r\n            title={() => (\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  justifyContent: 'space-between',\r\n                  alignItems: 'center',\r\n                  padding: '8px 0',\r\n                }}\r\n              >\r\n                <span>Stock Items</span>\r\n                <div style={{ fontSize: '12px', color: '#666' }}>\r\n                  <span style={{ color: '#52c41a' }}> Valid</span>\r\n                  <span style={{ margin: '0 8px', color: '#faad14' }}>\r\n                     Near Expiry\r\n                  </span>\r\n                  <span style={{ color: '#ff4d4f' }}>\r\n                     Expired/Out of Stock (Disabled)\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            )}\r\n            onRow={(record, idx) => {\r\n              const isExpired = isStockExpired(record);\r\n              const isOutOfStock = isStockOutOfStock(record);\r\n              return {\r\n                onClick: () => {\r\n                  if (!isExpired && !isOutOfStock) {\r\n                    handleSelectRow(record);\r\n                    // Keep focus on search input after selection\r\n                    setTimeout(() => {\r\n                      searchInputRef.current?.focus();\r\n                    }, 10);\r\n                  } else if (isExpired) {\r\n                    showExpiredStockError(record);\r\n                  } else if (isOutOfStock) {\r\n                    showOutOfStockError(record);\r\n                  }\r\n                },\r\n                onDoubleClick: () => {\r\n                  if (!isExpired && !isOutOfStock) {\r\n                    handleSelectRow(record);\r\n                  } else if (isExpired) {\r\n                    showExpiredStockError(record);\r\n                  } else if (isOutOfStock) {\r\n                    showOutOfStockError(record);\r\n                  }\r\n                },\r\n                className:\r\n                  idx === highlightedIndex\r\n                    ? 'ant-table-row ant-table-row-selected'\r\n                    : 'ant-table-row',\r\n                'data-row-key': record._id,\r\n                style: {\r\n                  opacity: isExpired || isOutOfStock ? 0.6 : 1,\r\n                  cursor: isExpired || isOutOfStock ? 'not-allowed' : 'pointer',\r\n                  backgroundColor:\r\n                    isExpired || isOutOfStock ? '#f5f5f5' : undefined,\r\n                },\r\n              };\r\n            }}\r\n            rowSelection={{\r\n              type: 'radio',\r\n              selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n              onChange: (keys: React.Key[]) => {\r\n                setSelectedRowKey(keys[0]);\r\n                const idx = allStocks.findIndex(s => s._id === keys[0]);\r\n                if (idx !== -1) setHighlightedIndex(idx);\r\n              },\r\n              getCheckboxProps: (record: Stock) => ({\r\n                disabled: isStockExpired(record) || isStockOutOfStock(record),\r\n              }),\r\n            }}\r\n          />\r\n          <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n            <strong>Keyboard Shortcuts:</strong>  Navigate stocks | Enter\r\n            Select | Escape Cancel\r\n            <br />\r\n            <strong>Tip:</strong> Press F7 anytime to reopen this modal for\r\n            stock changes\r\n            <br />\r\n            <strong>Note:</strong> Expired items () and out of stock items\r\n            () are shown but cannot be selected. Navigation automatically\r\n            skips expired and out of stock items.\r\n            <br />\r\n            <strong>Error Handling:</strong> Attempting to select expired or out\r\n            of stock items will show an error message and prevent selection.\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default StockSelectionModal;\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Table,\r\n  Input,\r\n  InputNumber,\r\n  Select,\r\n  DatePicker,\r\n  Button,\r\n  Space,\r\n  Modal,\r\n  Typography,\r\n  message,\r\n  TableProps,\r\n} from 'antd';\r\nimport type { SizeType } from 'antd/es/config-provider/SizeContext';\r\nimport { PlusOutlined, DeleteOutlined, SaveOutlined } from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport './AntdEditableTable.css';\r\nimport ProductSelectionModal from '../../pages/RetaillBill/components/ProductSelectionModal';\r\nimport StockSelectionModal from '../../pages/RetaillBill/components/StockSelectionModal';\r\n\r\nconst { Text } = Typography;\r\n\r\nexport interface AntdEditableColumn {\r\n  title: string;\r\n  dataIndex: string;\r\n  key?: string;\r\n  defaultValue?: any;\r\n  type?: 'text' | 'number' | 'select' | 'date' | 'product' | 'stock';\r\n  options?: { label: string; value: any }[];\r\n  required?: boolean;\r\n  width?: number;\r\n  editable?: boolean;\r\n  validation?: (value: any) => string | undefined;\r\n  render?: (value: any, record?: any, rowIndex?: number) => React.ReactNode;\r\n}\r\n\r\nexport interface AntdEditableTableProps {\r\n  columns: AntdEditableColumn[];\r\n  dataSource: any[];\r\n  onSave: (data: any[]) => void;\r\n  onAdd?: () => void;\r\n  onDelete?: (indices: number[]) => void;\r\n  onProductSelect?: (product: any, rowIndex: number) => void;\r\n  allowAdd?: boolean;\r\n  allowDelete?: boolean;\r\n  rowKey?: string;\r\n  loading?: boolean;\r\n  compact?: boolean;\r\n  enableKeyboardNav?: boolean;\r\n  size?: SizeType;\r\n  className?: string;\r\n  externalEditingCell?: { row: number; col: number } | null;\r\n}\r\n\r\nconst AntdEditableTable: React.FC<AntdEditableTableProps> = ({\r\n  columns,\r\n  dataSource,\r\n  onSave,\r\n  onAdd,\r\n  onDelete,\r\n  allowAdd = true,\r\n  allowDelete = true,\r\n  rowKey = 'key',\r\n  loading = false,\r\n  compact = false,\r\n  enableKeyboardNav = true,\r\n  size = 'middle',\r\n  className,\r\n  onProductSelect,\r\n  externalEditingCell,\r\n}) => {\r\n  const [data, setData] = useState<any[]>([]);\r\n  const [selectedRows, setSelectedRows] = useState<any[]>([]);\r\n  const [editingCell, setEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n  const firstLoadRef = useRef(true);\r\n\r\n  useEffect(() => {\r\n    setData(dataSource);\r\n\r\n    const firstProductColIndex = columns.findIndex(\r\n      col => col.dataIndex === 'product_id'\r\n    );\r\n\r\n    //  Auto-focus only if table is empty on first load\r\n    if (\r\n      firstLoadRef.current &&\r\n      dataSource.length === 0 &&\r\n      firstProductColIndex >= 0\r\n    ) {\r\n      setEditingCell({ row: 0, col: firstProductColIndex });\r\n      firstLoadRef.current = false; // Prevent repeat auto-focus\r\n    }else{\r\n      setSelectedRows(dataSource.length>0?[String(dataSource.length-1)]:[])\r\n    }\r\n  }, [dataSource, columns]);\r\n\r\n  // Sync editingCell with externalEditingCell prop\r\n  useEffect(() => {\r\n    if (externalEditingCell) {\r\n      setEditingCell(externalEditingCell);\r\n    }\r\n  }, [externalEditingCell]);\r\n\r\n  const handleAddRow = () => {\r\n    onAdd?.();\r\n    // Set focus to the first editable cell of the new row (after parent updates data)\r\n    const firstEditableCol = columns.findIndex(col => col.editable !== false);\r\n    if (firstEditableCol >= 0) {\r\n      setEditingCell({ row: data.length, col: firstEditableCol });\r\n    }\r\n  };\r\n\r\n  const handleDeleteRow = () => {\r\n    if (data.length === 0) {\r\n      message.warning('No rows to delete');\r\n      return;\r\n    }\r\n    Modal.confirm({\r\n      title: 'Are you sure you want to delete the selected Bill Items?',\r\n      onOk: () => {\r\n        const newData = data.slice(0, -1);\r\n        setData(newData);\r\n        onSave(newData);\r\n        onDelete?.(selectedRows);\r\n      },\r\n    });\r\n  };\r\n\r\n  const saveCell = (row: number, col: number, value: any): boolean => {\r\n    const column = columns[col];\r\n\r\n    // Basic validation\r\n    if (column.required && (!value || value === '')) {\r\n      message.error(`${column.title} is required`);\r\n      return false;\r\n    }\r\n\r\n    // Custom validation\r\n    if (column.validation) {\r\n      const error = column.validation(value);\r\n      if (error) {\r\n        message.error(error);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const newData = [...data];\r\n    newData[row][columns[col].dataIndex] = value;\r\n    setData(newData);\r\n    onSave(newData);\r\n    return true;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.ctrlKey && e.key === 's') {\r\n        e.preventDefault();\r\n        onSave(data);\r\n      }\r\n      if (e.shiftKey && e.key.toLowerCase() === 'a' && allowAdd) {\r\n        e.preventDefault();\r\n        handleAddRow();\r\n      }\r\n    };\r\n    if (enableKeyboardNav) {\r\n      document.addEventListener('keydown', handleKeyDown);\r\n      return () => document.removeEventListener('keydown', handleKeyDown);\r\n    }\r\n  }, [data, allowAdd, onSave, enableKeyboardNav, handleAddRow]);\r\n\r\n  const rowSelection: TableProps<any>['rowSelection'] = {\r\n    onChange: (selectedRowKeys: React.Key[], selectedRows:any[]) => {\r\n      setSelectedRows([...selectedRowKeys]);\r\n    },\r\n  };\r\n  \r\n  // Helper to find the next editable column index\r\n  function getNextEditableCol(startCol: number, direction: 1 | -1, columns: AntdEditableColumn[]): number {\r\n    let col = startCol + direction;\r\n    while (col >= 0 && col < columns.length) {\r\n      if (columns[col].editable !== false) return col;\r\n      col += direction;\r\n    }\r\n    return -1; // No editable column found\r\n  }\r\n\r\n  const EditableCell = ({\r\n    row,\r\n    col,\r\n    value,\r\n  }: {\r\n    row: number;\r\n    col: number;\r\n    value: any;\r\n  }) => {\r\n    const [cellValue, setCellValue] = useState(value);\r\n    const inputRef = useRef<any>(null);\r\n    const column = columns[col];\r\n    const [isProductModalVisible, setIsProductModalVisible] = useState(false);\r\n    const [isStockModalVisible, setIsStockModalVisible] = useState(false);\r\n\r\n    useEffect(() => {\r\n      setCellValue(value);\r\n      //  Focus input/select when cell enters edit mode\r\n      setTimeout(() => {\r\n        inputRef.current?.focus();\r\n      }, 50);\r\n    }, [value]);\r\n\r\n    const handleChange = (val: any) => {\r\n      setCellValue(val);\r\n      saveCell(row, col, val);\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n      if (column.type === 'product' && e.key === 'Enter') {\r\n        e.stopPropagation();\r\n        setIsProductModalVisible(true);\r\n        return; // Do not validate or move cell yet!\r\n      }\r\n      if (column.type === 'stock' && e.key === 'Enter') {\r\n        e.stopPropagation();\r\n        setIsStockModalVisible(true);\r\n        return;\r\n      }\r\n      if (e.key === 'Tab') {\r\n        e.preventDefault();\r\n        // Only validate on Tab\r\n        if (column.required && (!cellValue || cellValue === '')) {\r\n          message.error(`${column.title} is required`);\r\n          return;\r\n        }\r\n        const nextCol = e.shiftKey ? col - 1 : col + 1;\r\n        const nextRow = row + (nextCol >= columns.length ? 1 : 0);\r\n        const colIndex = (nextCol + columns.length) % columns.length;\r\n        if (nextRow < data.length) {\r\n          setEditingCell({ row: nextRow, col: colIndex });\r\n        } else if (allowAdd) {\r\n          handleAddRow();\r\n          setEditingCell({ row: data.length, col: colIndex });\r\n        }\r\n      } else if (e.key === 'Escape') {\r\n        setEditingCell(null);\r\n      }\r\n    };\r\n\r\n    const handleProductSelect = (product: any) => {\r\n      if (onProductSelect) {\r\n        onProductSelect(product, row);\r\n      }\r\n      setIsProductModalVisible(false);\r\n      setEditingCell(null);\r\n    };\r\n\r\n    const handleStockSelect = (stock: any) => {\r\n      // Set stock_id and batch_no in the row\r\n      const newData = [...data];\r\n      newData[row].stock_id = stock.id || stock._id || '';\r\n      newData[row].batch_no = stock.batch_no || '';\r\n      setData(newData);\r\n      onSave(newData);\r\n      setIsStockModalVisible(false);\r\n      setEditingCell(null);\r\n    };\r\n\r\n    switch (column.type) {\r\n      case 'product':\r\n        return (\r\n          <>\r\n            <div onClick={e => e.stopPropagation()}>\r\n              <Input\r\n                ref={inputRef}\r\n                value={cellValue}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder=\"Press Enter to select product\"\r\n              />\r\n            </div>\r\n            {isProductModalVisible && (\r\n              <ProductSelectionModal\r\n                visible={isProductModalVisible}\r\n                onSelect={handleProductSelect}\r\n                onCancel={() => setIsProductModalVisible(false)}\r\n              />\r\n            )}\r\n          </>\r\n        );\r\n      case 'stock':\r\n        return (\r\n          <>\r\n            <div onClick={e => e.stopPropagation()}>\r\n              <Input\r\n                ref={inputRef}\r\n                value={data[row]?.batch_no || cellValue}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder=\"Press Enter to select stock\"\r\n                readOnly\r\n              />\r\n            </div>\r\n            {isStockModalVisible && (\r\n              <StockSelectionModal\r\n                visible={isStockModalVisible}\r\n                onSelect={handleStockSelect}\r\n                onCancel={() => setIsStockModalVisible(false)}\r\n                productId={data[row]?.product_id || ''}\r\n              />\r\n            )}\r\n          </>\r\n        );\r\n      case 'number':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <InputNumber\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              onChange={handleChange}\r\n              onBlur={() => setEditingCell(null)}\r\n              controls={false}\r\n              onKeyDown={e => {\r\n                // Allow Enter/Tab to move to next editable cell\r\n                if (e.key === 'Tab' || e.key === 'Enter') {\r\n                  e.preventDefault();\r\n                  // Only validate on Tab or Enter\r\n                  if (column.required && (!cellValue || cellValue === '')) {\r\n                    message.error(`${column.title} is required`);\r\n                    return;\r\n                  }\r\n                  const direction = e.shiftKey ? -1 : 1;\r\n                  const nextCol = getNextEditableCol(col, direction, columns);\r\n                  if (nextCol !== -1) {\r\n                    setEditingCell({ row, col: nextCol });\r\n                  } else {\r\n                    // Move to next/previous row's first editable cell\r\n                    const nextRow = direction > 0 ? row + 1 : row - 1;\r\n                    if (nextRow >= 0 && nextRow < data.length) {\r\n                      const firstEditableCol = getNextEditableCol(-1, 1, columns);\r\n                      if (firstEditableCol !== -1) {\r\n                        setEditingCell({ row: nextRow, col: firstEditableCol });\r\n                      }\r\n                    } else if (direction > 0 && allowAdd) {\r\n                      // Add new row if moving forward and at the end\r\n                      handleAddRow();\r\n                      const firstEditableCol = getNextEditableCol(-1, 1, columns);\r\n                      if (firstEditableCol !== -1) {\r\n                        setEditingCell({ row: data.length, col: firstEditableCol });\r\n                      }\r\n                    } else {\r\n                      // Exit edit mode if no more rows\r\n                      setEditingCell(null);\r\n                    }\r\n                  }\r\n                } else if (e.key === 'Escape') {\r\n                  setEditingCell(null);\r\n                }\r\n              }}\r\n              style={{ width: '100%' }}\r\n            />\r\n          </div>\r\n        );\r\n      case 'select':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <Select\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              options={column.options}\r\n              onChange={val => {\r\n                const success = saveCell(row, col, val);\r\n                if (success) {\r\n                  // Move to next editable cell\r\n                  const nextCol = col + 1;\r\n                  const nextRow = row + (nextCol >= columns.length ? 1 : 0);\r\n                  const colIndex = (nextCol + columns.length) % columns.length;\r\n\r\n                  if (nextRow < data.length) {\r\n                    setEditingCell({ row: nextRow, col: colIndex });\r\n                  } else if (allowAdd) {\r\n                    handleAddRow();\r\n                    setEditingCell({ row: data.length, col: colIndex });\r\n                  }\r\n                }else {\r\n                  // Validation failed; keep focus\r\n                  setTimeout(() => {\r\n                    inputRef.current?.focus();\r\n                  }, 50);\r\n                }\r\n              }}\r\n              style={{ width: '100%' }}\r\n              onKeyDown={e => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  e.preventDefault(); // Block default key behavior\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n        );\r\n\r\n      case 'date':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <DatePicker\r\n              ref={inputRef}\r\n              value={cellValue ? dayjs(cellValue) : null}\r\n              onChange={date => {\r\n                handleChange(date ? date.format('YYYY-MM-DD') : null);\r\n                setEditingCell(null);\r\n              }}\r\n              onBlur={() => setEditingCell(null)}\r\n              onKeyDown={handleKeyDown}\r\n              style={{ width: '100%' }}\r\n            />\r\n          </div>\r\n        );\r\n      default:\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <Input\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              onChange={e => handleChange(e.target.value)}\r\n              onBlur={() => setEditingCell(null)}\r\n              onKeyDown={handleKeyDown}\r\n            />\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  const mergedColumns = columns.map((col, colIndex) => ({\r\n    ...col,\r\n    onCell: (_record: any, rowIndex?: number) => ({\r\n      onClick: () => {\r\n        if (typeof rowIndex === 'number') {\r\n          setEditingCell({ row: rowIndex, col: colIndex });\r\n        }\r\n      },\r\n      onContextMenu: (e: React.MouseEvent) => {\r\n        e.preventDefault(); //  Prevent default context menu\r\n        if (typeof rowIndex === 'number') {\r\n          setEditingCell({ row: rowIndex, col: colIndex });\r\n        }\r\n      },\r\n    }),\r\n    render: (val: any, record: any, rowIndex: number) => {\r\n      if (\r\n        editingCell &&\r\n        editingCell.row === rowIndex &&\r\n        editingCell.col === colIndex\r\n      ) {\r\n        return (\r\n          <EditableCell\r\n            key={`${rowIndex}-${colIndex}`}\r\n            row={rowIndex}\r\n            col={colIndex}\r\n            value={record[col.dataIndex]}\r\n          />\r\n        );\r\n      }\r\n      // Use custom render if provided and not editing\r\n      if (typeof col.render === 'function') {\r\n        return col.render(val, record, rowIndex);\r\n      }\r\n      // Show batch_no for stock_id column when not editing\r\n      if (col.dataIndex === 'batch_no') {\r\n        return record.batch_no || record[col.dataIndex];\r\n      }\r\n      // Show product_name for product_id column when not editing\r\n      if (col.dataIndex === 'product_id') {\r\n        return record.product_name || record[col.dataIndex];\r\n      }\r\n      if (col.type === 'select' && col.options) {\r\n        const option = col.options.find(\r\n          opt => opt.value === record[col.dataIndex]\r\n        );\r\n        return option ? option.label : record[col.dataIndex];\r\n      }\r\n      return record[col.dataIndex];\r\n    },\r\n  }));\r\n\r\n  return (\r\n    <div\r\n      className={`antd-editable-table ${compact ? 'compact' : ''} ${\r\n        className || ''\r\n      }`}\r\n    >\r\n      <div className=\"table-toolbar\">\r\n        <Space>\r\n          {allowAdd && (\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<PlusOutlined />}\r\n              onClick={handleAddRow}\r\n            >\r\n              Add Row (Shift+A)\r\n            </Button>\r\n          )}\r\n          {allowDelete && (\r\n            <Button danger icon={<DeleteOutlined />} onClick={handleDeleteRow}>\r\n              Delete Row\r\n            </Button>\r\n          )}\r\n          <Button\r\n            type=\"primary\"\r\n            icon={<SaveOutlined />}\r\n            onClick={() => onSave(data)}\r\n          >\r\n            Save (Ctrl+S)\r\n          </Button>\r\n        </Space>\r\n        <Text type=\"secondary\" className=\"table-info\">\r\n          Use Tab / Shift+Tab to navigate cells\r\n        </Text>\r\n      </div>\r\n      <Table\r\n        bordered\r\n        dataSource={data}\r\n        columns={mergedColumns}\r\n        rowKey={rowKey}\r\n        loading={loading}\r\n        pagination={false}\r\n        size={size}\r\n        scroll={{ y: 400 }}\r\n        rowSelection={{...rowSelection,type:\"checkbox\",selectedRowKeys:selectedRows}}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AntdEditableTable;\r\n","import { useCallback, useMemo } from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport { getEntityHooks } from '../services/redux/api/apiSlice';\r\nimport { API_ROUTES } from '../services/api/utils';\r\n// Define EntityName type locally\r\ntype EntityName = string;\r\n\r\n// Type for RTK query parameters\r\nexport interface RTKQueryParams {\r\n  page?: number;\r\n  limit?: number;\r\n  [key: string]: any;\r\n}\r\n\r\n// Type for RTK mutation result\r\nexport interface RTKMutationResult<T = any> {\r\n  data?: T;\r\n  error?: any;\r\n  isLoading: boolean;\r\n  isSuccess: boolean;\r\n  isError: boolean;\r\n}\r\n\r\n// Type for RTK query result\r\nexport interface RTKQueryResult<T = any> {\r\n  data?: T;\r\n  error?: any;\r\n  isLoading: boolean;\r\n  isSuccess: boolean;\r\n  isError: boolean;\r\n  refetch: () => void;\r\n}\r\n\r\n/**\r\n * Custom hook that provides RTK Query functionality for any entity\r\n * Works with the existing createCrudRoutes system\r\n */\r\nexport const useGenericCrudRTK = <T extends EntityName>(entityName: T) => {\r\n  const dispatch = useDispatch();\r\n  \r\n  // Get the RTK hooks for this entity\r\n  const entityHooks = useMemo(() => getEntityHooks(entityName), [entityName]);\r\n  \r\n  // Check if entity exists in API_ROUTES\r\n  const entityRoutes = useMemo(() => {\r\n    const routes = API_ROUTES[entityName as keyof typeof API_ROUTES];\r\n    if (!routes || typeof routes !== 'object' || !('GetAll' in routes)) {\r\n      throw new Error(`Entity ${entityName} not found in API_ROUTES or doesn't follow CRUD pattern`);\r\n    }\r\n    return routes as any;\r\n  }, [entityName]);\r\n\r\n  // Get all records with pagination and filters\r\n  const useGetAll = (params: RTKQueryParams = {}) => {\r\n    const query = entityHooks.useGetQuery(params);\r\n    return {\r\n      ...query,\r\n      refetch: query.refetch,\r\n    } as RTKQueryResult;\r\n  };\r\n\r\n  // Get single record by ID\r\n  const useGetById = (id: string, params: RTKQueryParams = {}) => {\r\n    const query = entityHooks.useGetByIdQuery({ id, ...params });\r\n    return {\r\n      ...query,\r\n      refetch: query.refetch,\r\n    } as RTKQueryResult;\r\n  };\r\n\r\n  // Create new record\r\n  const useCreate = () => {\r\n    const [createMutation, result] = entityHooks.useCreateMutation();\r\n    \r\n    const create = useCallback(async (data: any) => {\r\n      try {\r\n        const response = await createMutation(data).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [createMutation]);\r\n\r\n    return {\r\n      create,\r\n      ...result,\r\n    } as RTKMutationResult & { create: (data: any) => Promise<{ data: any; error: any }> };\r\n  };\r\n\r\n  // Update existing record\r\n  const useUpdate = () => {\r\n    const [updateMutation, result] = entityHooks.useUpdateMutation();\r\n    \r\n    const update = useCallback(async (id: string, data: any) => {\r\n      try {\r\n        const response = await updateMutation({ id, data }).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [updateMutation]);\r\n\r\n    return {\r\n      update,\r\n      ...result,\r\n    } as RTKMutationResult & { update: (id: string, data: any) => Promise<{ data: any; error: any }> };\r\n  };\r\n\r\n  // Delete record\r\n  const useDelete = () => {\r\n    const [deleteMutation, result] = entityHooks.useDeleteMutation();\r\n    \r\n    const remove = useCallback(async (id: string) => {\r\n      try {\r\n        const response = await deleteMutation(id).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [deleteMutation]);\r\n\r\n    return {\r\n      delete: remove,\r\n      remove, // Alias for delete\r\n      ...result,\r\n    } as RTKMutationResult & { \r\n      delete: (id: string) => Promise<{ data: any; error: any }>;\r\n      remove: (id: string) => Promise<{ data: any; error: any }>;\r\n    };\r\n  };\r\n\r\n  // Get entity routes for manual API calls\r\n  const getRoutes = useCallback(() => {\r\n    return {\r\n      getAll: entityRoutes.GetAll,\r\n      get: entityRoutes.Get,\r\n      create: entityRoutes.Create,\r\n      update: entityRoutes.Update,\r\n      delete: entityRoutes.Delete,\r\n    };\r\n  }, [entityRoutes]);\r\n\r\n  return {\r\n    // Query hooks\r\n    useGetAll,\r\n    useGetById,\r\n    \r\n    // Mutation hooks\r\n    useCreate,\r\n    useUpdate,\r\n    useDelete,\r\n    \r\n    // Utility functions\r\n    getRoutes,\r\n    \r\n    // Entity info\r\n    entityName,\r\n    entityRoutes,\r\n  };\r\n};\r\n\r\n// Export individual hooks for convenience\r\nexport const useEntityQuery = <T extends EntityName>(entityName: T, params: RTKQueryParams = {}) => {\r\n  const { useGetAll } = useGenericCrudRTK(entityName);\r\n  return useGetAll(params);\r\n};\r\n\r\nexport const useEntityMutation = <T extends EntityName>(entityName: T) => {\r\n  const { useCreate, useUpdate, useDelete } = useGenericCrudRTK(entityName);\r\n  return {\r\n    useCreate,\r\n    useUpdate,\r\n    useDelete,\r\n  };\r\n};\r\n\r\n// Export for backward compatibility\r\nexport default useGenericCrudRTK;","import React, {\r\n  useState,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Button,\r\n  Typography,\r\n  message,\r\n  Form,\r\n  Select,\r\n  Space,\r\n  Divider,\r\n  Tag,\r\n  Table,\r\n  Row,\r\n  Col,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  UserAddOutlined,\r\n  UserOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n  HomeOutlined,\r\n  PlusOutlined,\r\n  SaveOutlined,\r\n  CloseOutlined,\r\n} from '@ant-design/icons';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\nimport { useHandleApiResponse } from '../../../components/common/useHandleApiResponse';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Option } = Select;\r\n\r\ninterface Customer {\r\n  _id: string;\r\n  full_name: string;\r\n  email: string;\r\n  mobile: string;\r\n  address: string;\r\n  customer_type: 'regular' | 'vip' | 'wholesale';\r\n}\r\n\r\ninterface NewCustomerData {\r\n  full_name: string;\r\n  email: string;\r\n  mobile: string;\r\n  address: string;\r\n  customer_type: 'regular' | 'vip' | 'wholesale';\r\n}\r\n\r\ninterface CustomerSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (customer: Customer) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst CustomerSelectionModalComponent: React.FC<CustomerSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const CustomerApi = getEntityApi('Customer');\r\n\r\n  const { items: customerList, loading: customerLoading } = useDynamicSelector(\r\n    CustomerApi.getIdentifier('GetAll')\r\n  );\r\n  const { loading: createLoading } = useDynamicSelector(\r\n    CustomerApi.getIdentifier('Create')\r\n  );\r\n\r\n  // Extract items from customerList if it exists\r\n  const customers = customerList?.items || customerList?.result || [];\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [showAddForm, setShowAddForm] = useState(false);\r\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(\r\n    null\r\n  );\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n  const [showCreateGrid, setShowCreateGrid] = useState(false);\r\n  const [newCustomerData, setNewCustomerData] = useState<NewCustomerData>({\r\n    full_name: '',\r\n    email: '',\r\n    mobile: '',\r\n    address: '',\r\n    customer_type: 'regular',\r\n  });\r\n\r\n  const [form] = Form.useForm();\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const createGridRef = useRef<HTMLDivElement>(null);\r\n  const firstFormInputRef = useRef<any>(null);\r\n\r\n  // Memoized filtered customers\r\n  const filteredCustomers = useMemo(() => customers, [customers]);\r\n\r\n  // Check if search has no results and should show create grid\r\n  const shouldShowCreateGrid = useMemo(() => {\r\n    return (\r\n      searchTerm.trim() && !customerLoading && filteredCustomers.length === 0\r\n    );\r\n  }, [searchTerm, customerLoading, filteredCustomers.length]);\r\n\r\n  // Memoized customer type color function\r\n  const getCustomerTypeColor = useCallback((type: string) => {\r\n    const colorMap: Record<string, string> = {\r\n      vip: 'gold',\r\n      wholesale: 'blue',\r\n      regular: 'green',\r\n    };\r\n    return colorMap[type] || 'green';\r\n  }, []);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToCustomer = useCallback(\r\n    (direction: 'up' | 'down' | 'home' | 'end') => {\r\n      if (filteredCustomers.length === 0) return;\r\n\r\n      let newIndex: number;\r\n      switch (direction) {\r\n        case 'up':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? filteredCustomers.length - 1\r\n              : Math.max(selectedRowIndex - 1, 0);\r\n          break;\r\n        case 'down':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? 0\r\n              : Math.min(selectedRowIndex + 1, filteredCustomers.length - 1);\r\n          break;\r\n        case 'home':\r\n          newIndex = 0;\r\n          break;\r\n        case 'end':\r\n          newIndex = filteredCustomers.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedCustomer(filteredCustomers[newIndex]);\r\n\r\n      // Scroll to the selected row\r\n      setTimeout(() => {\r\n        const rowElement = document.querySelector(\r\n          `[data-row-key=\"${filteredCustomers[newIndex]._id}\"]`\r\n        ) as HTMLElement;\r\n        if (rowElement) {\r\n          const scrollBehavior =\r\n            direction === 'home'\r\n              ? 'start'\r\n              : direction === 'end'\r\n                ? 'end'\r\n                : 'nearest';\r\n          rowElement.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: scrollBehavior,\r\n          });\r\n        }\r\n      }, 100);\r\n    },\r\n    [filteredCustomers, selectedRowIndex]\r\n  );\r\n\r\n  // Debounced search function\r\n  const handleSearch = useCallback(\r\n    (value: string) => {\r\n      setSearchTerm(value);\r\n\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n\r\n      searchTimeoutRef.current = setTimeout(() => {\r\n        if (value.trim()) {\r\n          CustomerApi('GetAll', { searchString: value.trim() });\r\n        } else {\r\n          CustomerApi('GetAll');\r\n        }\r\n      }, 500);\r\n    },\r\n    [CustomerApi]\r\n  );\r\n\r\n  // Handle customer selection\r\n  const handleCustomerSelect = useCallback(\r\n    (customer: Customer) => {\r\n      setSelectedCustomer(customer);\r\n      onSelect(customer);\r\n      setTimeout(() => onCancel(), 100);\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Handle new customer creation from unified form\r\n  const handleCreateCustomerFromForm = useCallback(async () => {\r\n    try {\r\n      // Validate required fields - only Full Name and Mobile are mandatory\r\n      if (!newCustomerData.full_name.trim()) {\r\n        message.error('Full name is required');\r\n        return;\r\n      }\r\n      if (!newCustomerData.mobile.trim()) {\r\n        message.error('Mobile number is required');\r\n        return;\r\n      }\r\n\r\n      // Call the API - the response will be handled by the useEffect watching createResult\r\n      await CustomerApi('Create', newCustomerData);\r\n\r\n      // Note: The modal will be automatically closed by the useEffect when the API response comes back\r\n    } catch (error) {\r\n      message.error('Failed to create customer');\r\n      // Clear form data on error\r\n      clearFormData();\r\n    }\r\n  }, [newCustomerData, CustomerApi]);\r\n\r\n  // Function to clear form data\r\n  const clearFormData = useCallback(() => {\r\n    setNewCustomerData({\r\n      full_name: '',\r\n      email: '',\r\n      mobile: '',\r\n      address: '',\r\n      customer_type: 'regular',\r\n    });\r\n    form.resetFields();\r\n  }, [form]);\r\n\r\n  // Handle form field changes\r\n  const handleFormFieldChange = useCallback(\r\n    (field: keyof NewCustomerData, value: string) => {\r\n      setNewCustomerData(prev => ({\r\n        ...prev,\r\n        [field]: value,\r\n      }));\r\n    },\r\n    []\r\n  );\r\n\r\n  // Remove the navigateToNextField function as it's no longer needed\r\n\r\n  // Handle keyboard events (excluding Enter key which is handled by input field)\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onCancel();\r\n      } else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToCustomer(directionMap[e.key]);\r\n      }\r\n    },\r\n    [navigateToCustomer, onCancel]\r\n  );\r\n\r\n  // Global keyboard event handler\r\n  const handleGlobalKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (!visible) return;\r\n\r\n      // Don't interfere if user is typing in form inputs\r\n      const target = e.target as HTMLElement;\r\n      if (\r\n        target.tagName === 'INPUT' ||\r\n        target.tagName === 'TEXTAREA' ||\r\n        target.classList.contains('ant-select-selector') ||\r\n        target.closest('.ant-select-dropdown')\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === 'f') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Handle Ctrl+N for new customer creation\r\n      if (e.ctrlKey && e.key === 'n') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (shouldShowCreateGrid) {\r\n          setShowCreateGrid(true);\r\n          setTimeout(() => {\r\n            if (createGridRef.current) {\r\n              const firstInput = createGridRef.current.querySelector(\r\n                'input'\r\n              ) as HTMLInputElement;\r\n              if (firstInput) {\r\n                firstInput.focus();\r\n                firstInput.select();\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Only handle navigation keys globally when not in form inputs\r\n      if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToCustomer(directionMap[e.key]);\r\n      }\r\n    },\r\n    [visible, navigateToCustomer, shouldShowCreateGrid]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: Customer) => (\r\n          <div\r\n            style={{\r\n              cursor: 'pointer',\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n            }}\r\n            onClick={() => {\r\n              setSelectedCustomer(record);\r\n              const index = filteredCustomers.findIndex(\r\n                (c: Customer) => c._id === record._id\r\n              );\r\n              setSelectedRowIndex(index);\r\n              // Don't auto-select here, let user click the row or press Enter\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                borderRadius: '50%',\r\n                border:\r\n                  selectedCustomer?._id === record._id\r\n                    ? '2px solid #1890ff'\r\n                    : '2px solid #d9d9d9',\r\n                backgroundColor:\r\n                  selectedCustomer?._id === record._id ? '#1890ff' : 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedCustomer?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Customer Name',\r\n        dataIndex: 'full_name',\r\n        key: 'full_name',\r\n        render: (text: string, record: Customer) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <Text strong>{text}</Text>\r\n            <Tag color={getCustomerTypeColor(record.customer_type)}>\r\n              {record.customer_type.toUpperCase()}\r\n            </Tag>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Mobile',\r\n        dataIndex: 'mobile',\r\n        key: 'mobile',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Address',\r\n        dataIndex: 'address',\r\n        key: 'address',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'flex-start', gap: 8 }}>\r\n            <HomeOutlined style={{ color: '#666', marginTop: '2px' }} />\r\n            <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n              {text || '-'}\r\n            </Text>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedCustomer, filteredCustomers, getCustomerTypeColor]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: Customer, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedCustomer(record);\r\n        setSelectedRowIndex(index ?? 0);\r\n        // Don't auto-select on row click, let user press Enter to confirm\r\n      },\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedCustomer?._id === record._id ? '#f0f8ff' : 'white',\r\n        border:\r\n          selectedCustomer?._id === record._id\r\n            ? '2px solid #1890ff'\r\n            : '1px solid #f0f0f0',\r\n        borderRadius: '4px',\r\n        transition: 'all 0.2s ease',\r\n      },\r\n      onMouseEnter: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedCustomer?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = '#f5f5f5';\r\n        }\r\n      },\r\n      onMouseLeave: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedCustomer?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = 'white';\r\n        }\r\n      },\r\n    }),\r\n    [selectedCustomer]\r\n  );\r\n\r\n  // Load customers on mount and handle modal close\r\n  useEffect(() => {\r\n    if (visible) {\r\n      CustomerApi('GetAll');\r\n      setSelectedCustomer(null);\r\n      setSelectedRowIndex(-1);\r\n      setShowCreateGrid(false);\r\n    } else {\r\n      setSearchTerm('');\r\n      setSelectedCustomer(null);\r\n      setSelectedRowIndex(-1);\r\n      setShowCreateGrid(false);\r\n      setShowAddForm(false);\r\n      clearFormData();\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = null;\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [visible, CustomerApi, clearFormData]);\r\n\r\n  // Auto-show create form when search has no results\r\n  useEffect(() => {\r\n    if (shouldShowCreateGrid && !showCreateGrid && !showAddForm) {\r\n      setShowCreateGrid(true);\r\n    }\r\n  }, [shouldShowCreateGrid, showCreateGrid, showAddForm]);\r\n\r\n  // Focus search input when modal becomes visible (but not when create form is shown)\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current && !showAddForm && !showCreateGrid) {\r\n      const focusSearch = () => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n      };\r\n\r\n      focusSearch();\r\n      const timer = setTimeout(focusSearch, 100);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [visible, showAddForm, showCreateGrid]);\r\n\r\n  // Focus on first form field when create form is shown\r\n  useEffect(() => {\r\n    if ((showAddForm || showCreateGrid) && visible) {\r\n      const timer = setTimeout(() => {\r\n        if (firstFormInputRef.current) {\r\n          firstFormInputRef.current.focus();\r\n          firstFormInputRef.current.select();\r\n        }\r\n      }, 100);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [showAddForm, showCreateGrid, visible]); // Depend on all three to trigger when form is shown\r\n\r\n  // Remove the useLayoutEffect that was causing focus to reset\r\n\r\n  // Global keyboard event listener\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('keydown', handleGlobalKeyDown, true);\r\n      return () =>\r\n        document.removeEventListener('keydown', handleGlobalKeyDown, true);\r\n    }\r\n  }, [visible, handleGlobalKeyDown]);\r\n\r\n  // Handle API responses using the standard pattern\r\n  useHandleApiResponse({\r\n    action: 'create',\r\n    title: 'Customer',\r\n    identifier: CustomerApi.getIdentifier('Create'),\r\n    entityApi: CustomerApi,\r\n  });\r\n\r\n  // Watch for successful customer creation and select the new customer\r\n  const { items: createResult } = useDynamicSelector(\r\n    CustomerApi.getIdentifier('Create')\r\n  );\r\n\r\n  // Watch createLoading state to show/hide loading message\r\n  useEffect(() => {\r\n    if (createLoading) {\r\n      // Show loading message when API call starts\r\n      message.loading({\r\n        content: 'Creating customer...',\r\n        key: 'customer-creation',\r\n        duration: 0,\r\n      });\r\n    } else {\r\n      // Hide loading message when API call completes\r\n      message.destroy('customer-creation');\r\n    }\r\n  }, [createLoading]);\r\n\r\n  useEffect(() => {\r\n    if (createResult) {\r\n      if (createResult.statusCode === 200) {\r\n        // Customer created successfully, get the new customer data\r\n        const newCustomer = createResult.data || createResult.result;\r\n\r\n        if (newCustomer) {\r\n          // message.success(\r\n          //   `Customer \"${newCustomer.full_name}\" created and selected successfully!`\r\n          // );\r\n\r\n          // Clear form data on success\r\n          clearFormData();\r\n          setShowAddForm(false);\r\n          setShowCreateGrid(false);\r\n\r\n          // Refresh the customer list to include the new customer\r\n          CustomerApi('GetAll');\r\n\r\n          // Auto-select the newly created customer\r\n          setTimeout(() => {\r\n            onSelect(newCustomer);\r\n            onCancel();\r\n          }, 100);\r\n        }\r\n      } else if (createResult.statusCode && createResult.statusCode !== 200) {\r\n        // Handle error case\r\n        message.error(createResult.message || 'Failed to create customer');\r\n        // Clear form data on error\r\n        clearFormData();\r\n      }\r\n    }\r\n  }, [createResult, onSelect, onCancel, CustomerApi, clearFormData]);\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedCustomer(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n  return (\r\n    <Modal\r\n      title=\"Select Customer\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={1000}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current && !showAddForm && !showCreateGrid) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Space.Compact style={{ width: '100%' }}>\r\n          <Input\r\n            ref={searchInputRef}\r\n            placeholder=\"Search customers... (Ctrl+N: New customer, : Navigate, Enter: Select, Esc: Close)\"\r\n            value={searchTerm}\r\n            onChange={e => handleSearch(e.target.value)}\r\n            prefix={<SearchOutlined />}\r\n            style={{ flex: 1 }}\r\n            onKeyDown={e => {\r\n              // Only handle Enter key in search input, let other keys bubble up\r\n              if (e.key === 'Enter' && selectedCustomer) {\r\n                handleCustomerSelect(selectedCustomer);\r\n              }\r\n            }}\r\n            onFocus={handleSearchFocus}\r\n            autoFocus={!showAddForm && !showCreateGrid}\r\n            onBlur={\r\n              !showAddForm && !showCreateGrid\r\n                ? () => {\r\n                    // Only auto-focus back to search if no forms are shown\r\n                    if (visible && searchInputRef.current) {\r\n                      setTimeout(() => {\r\n                        if (\r\n                          visible &&\r\n                          searchInputRef.current &&\r\n                          !showAddForm &&\r\n                          !showCreateGrid\r\n                        ) {\r\n                          searchInputRef.current.focus();\r\n                        }\r\n                      }, 10);\r\n                    }\r\n                  }\r\n                : undefined\r\n            }\r\n            suffix={\r\n              searchTerm && customerLoading ? (\r\n                <div style={{ fontSize: '12px', color: '#999' }}>\r\n                  Searching...\r\n                </div>\r\n              ) : null\r\n            }\r\n          />\r\n          <Button\r\n            type={showAddForm ? 'default' : 'primary'}\r\n            icon={<UserAddOutlined />}\r\n            onClick={() => {\r\n              const newState = !showAddForm;\r\n              setShowAddForm(newState);\r\n              if (!newState) {\r\n                // Clear form data when switching back to search mode\r\n                clearFormData();\r\n              }\r\n              // Focus will be handled by the useEffect when visible changes\r\n            }}\r\n            style={{ minWidth: 120 }}\r\n          >\r\n            {showAddForm ? 'Cancel' : 'Add New'}\r\n          </Button>\r\n        </Space.Compact>\r\n      </div>\r\n\r\n      {/* Unified Create Form - Shows when search has no results or when Add New is clicked */}\r\n      {(showCreateGrid || showAddForm) && (\r\n        <div\r\n          ref={createGridRef}\r\n          style={{\r\n            marginBottom: 20,\r\n            padding: 24,\r\n            border: '2px solid #6366f1',\r\n            borderRadius: 16,\r\n            backgroundColor:\r\n              'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\r\n            background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\r\n            boxShadow:\r\n              '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',\r\n            position: 'relative',\r\n            overflow: 'hidden',\r\n          }}\r\n          tabIndex={-1}\r\n        >\r\n          {/* Decorative background elements */}\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              top: -20,\r\n              right: -20,\r\n              width: 100,\r\n              height: 100,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n              opacity: 0.1,\r\n              zIndex: 0,\r\n            }}\r\n          />\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              bottom: -30,\r\n              left: -30,\r\n              width: 80,\r\n              height: 80,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)',\r\n              opacity: 0.1,\r\n              zIndex: 0,\r\n            }}\r\n          />\r\n\r\n          <Row\r\n            justify=\"space-between\"\r\n            align=\"middle\"\r\n            style={{ marginBottom: 24, position: 'relative', zIndex: 1 }}\r\n          >\r\n            <Col>\r\n              <Title\r\n                level={4}\r\n                style={{\r\n                  margin: 0,\r\n                  background:\r\n                    'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n                  WebkitBackgroundClip: 'text',\r\n                  WebkitTextFillColor: 'transparent',\r\n                  backgroundClip: 'text',\r\n                  fontWeight: 700,\r\n                  fontSize: '20px',\r\n                }}\r\n              >\r\n                <PlusOutlined style={{ marginRight: 8, color: '#6366f1' }} />\r\n                Create New Customer\r\n              </Title>\r\n              <Text\r\n                style={{\r\n                  fontSize: '14px',\r\n                  color: '#64748b',\r\n                  fontWeight: 500,\r\n                  display: 'block',\r\n                  marginTop: 4,\r\n                }}\r\n              >\r\n                 Fill in the details below to create a new customer\r\n              </Text>\r\n            </Col>\r\n            <Col>\r\n              <Space size=\"middle\">\r\n                <Button\r\n                  size=\"middle\"\r\n                  icon={<CloseOutlined />}\r\n                  onClick={() => {\r\n                    setShowCreateGrid(false);\r\n                    setShowAddForm(false);\r\n                    CustomerApi('GetAll');\r\n                    clearFormData();\r\n                  }}\r\n                  style={{\r\n                    border: '2px solid #e2e8f0',\r\n                    borderRadius: 8,\r\n                    fontWeight: 600,\r\n                    color: '#64748b',\r\n                    background: 'white',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    height: 40,\r\n                    padding: '0 20px',\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </Button>\r\n                <Button\r\n                  type=\"primary\"\r\n                  size=\"middle\"\r\n                  icon={<SaveOutlined />}\r\n                  onClick={handleCreateCustomerFromForm}\r\n                  loading={createLoading}\r\n                  style={{\r\n                    background:\r\n                      'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n                    border: 'none',\r\n                    borderRadius: 8,\r\n                    fontWeight: 600,\r\n                    height: 40,\r\n                    padding: '0 24px',\r\n                    boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)',\r\n                    transition: 'all 0.3s ease',\r\n                  }}\r\n                >\r\n                  Create & Select\r\n                </Button>\r\n              </Space>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form\r\n            form={form}\r\n            layout=\"vertical\"\r\n            size=\"middle\"\r\n            style={{ position: 'relative', zIndex: 1 }}\r\n          >\r\n            <div\r\n              style={{\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 1fr',\r\n                gap: 20,\r\n                marginBottom: 20,\r\n              }}\r\n            >\r\n              <Form.Item\r\n                name=\"full_name\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <UserOutlined style={{ color: '#6366f1' }} />\r\n                    Full Name\r\n                  </span>\r\n                }\r\n                rules={[{ required: true, message: 'Please enter full name' }]}\r\n              >\r\n                <Input\r\n                  ref={firstFormInputRef}\r\n                  name=\"full_name\"\r\n                  placeholder=\"Enter full name\"\r\n                  prefix={<UserOutlined style={{ color: '#9ca3af' }} />}\r\n                  autoFocus={showAddForm || showCreateGrid}\r\n                  value={newCustomerData.full_name}\r\n                  onChange={e =>\r\n                    handleFormFieldChange('full_name', e.target.value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"mobile\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <PhoneOutlined style={{ color: '#10b981' }} />\r\n                    Mobile Number\r\n                  </span>\r\n                }\r\n                rules={[\r\n                  { required: true, message: 'Please enter mobile number' },\r\n                  {\r\n                    pattern: /^[0-9]{10}$/,\r\n                    message: 'Mobile must be 10 digits',\r\n                  },\r\n                ]}\r\n              >\r\n                <Input\r\n                  name=\"mobile\"\r\n                  placeholder=\"Enter mobile number\"\r\n                  prefix={<PhoneOutlined style={{ color: '#9ca3af' }} />}\r\n                  value={newCustomerData.mobile}\r\n                  onChange={e =>\r\n                    handleFormFieldChange('mobile', e.target.value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"email\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <MailOutlined style={{ color: '#f59e0b' }} />\r\n                    Email\r\n                  </span>\r\n                }\r\n                rules={[{ type: 'email', message: 'Please enter valid email' }]}\r\n              >\r\n                <Input\r\n                  name=\"email\"\r\n                  placeholder=\"Enter email\"\r\n                  prefix={<MailOutlined style={{ color: '#9ca3af' }} />}\r\n                  value={newCustomerData.email}\r\n                  onChange={e => handleFormFieldChange('email', e.target.value)}\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              {/* <Form.Item\r\n                name=\"customer_type\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <Tag\r\n                      style={{\r\n                        background:\r\n                          'linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)',\r\n                        color: 'white',\r\n                        border: 'none',\r\n                        borderRadius: 6,\r\n                        padding: '2px 8px',\r\n                        fontSize: '10px',\r\n                        fontWeight: 600,\r\n                      }}\r\n                    >\r\n                      TYPE\r\n                    </Tag>\r\n                    Customer Type\r\n                  </span>\r\n                }\r\n                initialValue=\"regular\"\r\n              >\r\n                <Select\r\n                  value={newCustomerData.customer_type}\r\n                  onChange={value =>\r\n                    handleFormFieldChange('customer_type', value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                >\r\n                  <Option value=\"regular\">Regular</Option>\r\n                  <Option value=\"vip\">VIP</Option>\r\n                  <Option value=\"wholesale\">Wholesale</Option>\r\n                </Select>\r\n              </Form.Item> */}\r\n            </div>\r\n\r\n            <Form.Item\r\n              name=\"address\"\r\n              label={\r\n                <span\r\n                  style={{\r\n                    fontWeight: 600,\r\n                    color: '#374151',\r\n                    fontSize: '14px',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: 6,\r\n                  }}\r\n                >\r\n                  <HomeOutlined style={{ color: '#ef4444' }} />\r\n                  Address\r\n                </span>\r\n              }\r\n            >\r\n              <Input.TextArea\r\n                name=\"address\"\r\n                placeholder=\"Enter address\"\r\n                rows={3}\r\n                value={newCustomerData.address}\r\n                onChange={e => handleFormFieldChange('address', e.target.value)}\r\n                onKeyDown={e => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    // If it's the last field, create the customer\r\n                    handleCreateCustomerFromForm();\r\n                  }\r\n                }}\r\n                style={{\r\n                  borderRadius: 10,\r\n                  border: '2px solid #e5e7eb',\r\n                  padding: '12px 16px',\r\n                  fontSize: '14px',\r\n                  transition: 'all 0.3s ease',\r\n                  boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                  background: 'white',\r\n                  resize: 'none',\r\n                }}\r\n              />\r\n            </Form.Item>\r\n          </Form>\r\n        </div>\r\n      )}\r\n\r\n      <Divider style={{ margin: '16px 0' }} />\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {customerLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading customers...</Text>\r\n          </div>\r\n        ) : filteredCustomers.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No customers found matching your search.'\r\n                : 'No customers available.'}\r\n            </Text>\r\n            {searchTerm && (\r\n              <div style={{ marginTop: 16 }}>\r\n                <Text type=\"secondary\">\r\n                  Press Ctrl+N to create a new customer instantly\r\n                </Text>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredCustomers}\r\n            rowKey=\"_id\"\r\n            pagination={false}\r\n            size=\"small\"\r\n            scroll={{ y: 300 }}\r\n            onRow={getRowProps}\r\n          />\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\n// Memoize the component to prevent unnecessary re-renders\r\nconst CustomerSelectionModal = React.memo(CustomerSelectionModalComponent);\r\nexport default CustomerSelectionModal;\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Typography,\r\n  Table,\r\n  Tag,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  UserOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n} from '@ant-design/icons';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface User {\r\n  _id: string;\r\n  name: string;\r\n  email: string;\r\n  mobile: string;\r\n  user_name: string;\r\n  roleItems?: {\r\n    name: string;\r\n  };\r\n  branchItems?: {\r\n    branch_name: string;\r\n  };\r\n  organisationItems?: {\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface UserSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (user: User) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst UserSelectionModal: React.FC<UserSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const BillingUsersApi = getEntityApi('BillingUsers');\r\n\r\n  const { items: userList, loading: userLoading } = useDynamicSelector(\r\n    BillingUsersApi.getIdentifier('GetAll')\r\n  );\r\n\r\n  // Extract items from userList if it exists\r\n  const users = userList?.items || userList?.result || [];\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n  \r\n  // Get current user from session storage\r\n  const currentUser = useMemo(() => {\r\n    return getCurrentUser();\r\n  }, []);\r\n\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Memoized filtered users\r\n  const filteredUsers = useMemo(() => {\r\n    if (!searchTerm.trim()) {\r\n      return users;\r\n    }\r\n    \r\n    const searchLower = searchTerm.toLowerCase();\r\n    return users.filter((user: User) =>\r\n      user.name?.toLowerCase().includes(searchLower) ||\r\n      user.email?.toLowerCase().includes(searchLower) ||\r\n      user.mobile?.toLowerCase().includes(searchLower) ||\r\n      user.user_name?.toLowerCase().includes(searchLower) ||\r\n      user.roleItems?.name?.toLowerCase().includes(searchLower)\r\n    );\r\n  }, [users, searchTerm]);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToUser = useCallback(\r\n    (direction: 'up' | 'down' | 'home' | 'end') => {\r\n      if (filteredUsers.length === 0) return;\r\n\r\n      let newIndex: number;\r\n      switch (direction) {\r\n        case 'up':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? filteredUsers.length - 1\r\n              : Math.max(selectedRowIndex - 1, 0);\r\n          break;\r\n        case 'down':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? 0\r\n              : Math.min(selectedRowIndex + 1, filteredUsers.length - 1);\r\n          break;\r\n        case 'home':\r\n          newIndex = 0;\r\n          break;\r\n        case 'end':\r\n          newIndex = filteredUsers.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedUser(filteredUsers[newIndex]);\r\n\r\n      // Scroll to the selected row\r\n      setTimeout(() => {\r\n        const rowElement = document.querySelector(\r\n          `[data-row-key=\"${filteredUsers[newIndex]._id}\"]`\r\n        ) as HTMLElement;\r\n        if (rowElement) {\r\n          const scrollBehavior =\r\n            direction === 'home'\r\n              ? 'start'\r\n              : direction === 'end'\r\n                ? 'end'\r\n                : 'nearest';\r\n          rowElement.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: scrollBehavior,\r\n          });\r\n        }\r\n      }, 100);\r\n    },\r\n    [filteredUsers, selectedRowIndex]\r\n  );\r\n\r\n  // Debounced search function\r\n  const handleSearch = useCallback(\r\n    (value: string) => {\r\n      setSearchTerm(value);\r\n\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n\r\n      searchTimeoutRef.current = setTimeout(() => {\r\n        if (value.trim()) {\r\n          BillingUsersApi('GetAll', { searchString: value.trim() });\r\n        } else {\r\n          BillingUsersApi('GetAll');\r\n        }\r\n      }, 300);\r\n    },\r\n    [BillingUsersApi]\r\n  );\r\n\r\n  // Handle user selection\r\n  const handleUserSelect = useCallback(\r\n    (user: User) => {\r\n      setSelectedUser(user);\r\n      onSelect(user);\r\n      setTimeout(() => onCancel(), 100);\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Handle keyboard events\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onCancel();\r\n      } else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToUser(directionMap[e.key]);\r\n      }\r\n    },\r\n    [navigateToUser, onCancel]\r\n  );\r\n\r\n  // Global keyboard event handler\r\n  const handleGlobalKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (!visible) return;\r\n\r\n      // Don't interfere if user is typing in form inputs\r\n      const target = e.target as HTMLElement;\r\n      if (\r\n        target.tagName === 'INPUT' ||\r\n        target.tagName === 'TEXTAREA' ||\r\n        target.classList.contains('ant-select-selector') ||\r\n        target.closest('.ant-select-dropdown')\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === 'f') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Only handle navigation keys globally when not in form inputs\r\n      if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToUser(directionMap[e.key]);\r\n      }\r\n    },\r\n    [visible, navigateToUser]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: User) => (\r\n          <div\r\n            style={{\r\n              cursor: 'pointer',\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n            }}\r\n            onClick={() => {\r\n              setSelectedUser(record);\r\n              const index = filteredUsers.findIndex(\r\n                (u: User) => u._id === record._id\r\n              );\r\n              setSelectedRowIndex(index);\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                borderRadius: '50%',\r\n                border:\r\n                  selectedUser?._id === record._id\r\n                    ? '2px solid #1890ff'\r\n                    : '2px solid #d9d9d9',\r\n                backgroundColor:\r\n                  selectedUser?._id === record._id ? '#1890ff' : 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedUser?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Name',\r\n        dataIndex: 'name',\r\n        key: 'name',\r\n        render: (text: string, record: User) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <UserOutlined style={{ color: '#1890ff' }} />\r\n            <div>\r\n              <Text strong>{text}</Text>\r\n              <br />\r\n              <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n                @{record.user_name}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Role',\r\n        key: 'role',\r\n        render: (text: string, record: User) => (\r\n          <Tag color=\"blue\">\r\n            {record.roleItems?.name || 'No Role'}\r\n          </Tag>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Mobile',\r\n        dataIndex: 'mobile',\r\n        key: 'mobile',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Branch',\r\n        key: 'branch',\r\n        render: (text: string, record: User) => (\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            {record.branchItems?.branch_name || '-'}\r\n          </Text>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedUser, filteredUsers]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: User, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedUser(record);\r\n        setSelectedRowIndex(index ?? 0);\r\n      },\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedUser?._id === record._id ? '#f0f8ff' : 'white',\r\n        border:\r\n          selectedUser?._id === record._id\r\n            ? '2px solid #1890ff'\r\n            : '1px solid #f0f0f0',\r\n        borderRadius: '4px',\r\n        transition: 'all 0.2s ease',\r\n      },\r\n      onMouseEnter: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedUser?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = '#f5f5f5';\r\n        }\r\n      },\r\n      onMouseLeave: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedUser?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = 'white';\r\n        }\r\n      },\r\n    }),\r\n    [selectedUser]\r\n  );\r\n\r\n  // Load users on mount and handle modal close\r\n  useEffect(() => {\r\n    if (visible) {\r\n      BillingUsersApi('GetAll');\r\n      setSelectedUser(null);\r\n      setSelectedRowIndex(-1);\r\n    } else {\r\n      setSearchTerm('');\r\n      setSelectedUser(null);\r\n      setSelectedRowIndex(-1);\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = null;\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [visible, BillingUsersApi]);\r\n\r\n  // Auto-select current user when users are loaded\r\n  useEffect(() => {\r\n    if (visible && users.length > 0 && currentUser?._id && !selectedUser) {\r\n      const currentUserInList = users.find((user: User) => user._id === currentUser._id);\r\n      if (currentUserInList) {\r\n        setSelectedUser(currentUserInList);\r\n        const index = users.findIndex((user: User) => user._id === currentUser._id);\r\n        setSelectedRowIndex(index);\r\n        \r\n        // Scroll to the selected user after a short delay\r\n        setTimeout(() => {\r\n          const rowElement = document.querySelector(\r\n            `[data-row-key=\"${currentUserInList._id}\"]`\r\n          ) as HTMLElement;\r\n          if (rowElement) {\r\n            rowElement.scrollIntoView({\r\n              behavior: 'smooth',\r\n              block: 'center',\r\n            });\r\n          }\r\n        }, 200);\r\n      }\r\n    }\r\n  }, [visible, users, currentUser?._id, selectedUser]);\r\n\r\n  // Focus search input when modal becomes visible\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current) {\r\n      const focusSearch = () => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n      };\r\n\r\n      focusSearch();\r\n      const timer = setTimeout(focusSearch, 100);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [visible]);\r\n\r\n  // Global keyboard event listener\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('keydown', handleGlobalKeyDown, true);\r\n      return () =>\r\n        document.removeEventListener('keydown', handleGlobalKeyDown, true);\r\n    }\r\n  }, [visible, handleGlobalKeyDown]);\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedUser(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select User (Billed By)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={900}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Input\r\n          ref={searchInputRef}\r\n          placeholder=\"Search users... (: Navigate, Enter: Select, Esc: Close)\"\r\n          value={searchTerm}\r\n          onChange={e => handleSearch(e.target.value)}\r\n          prefix={<SearchOutlined />}\r\n          style={{ width: '100%' }}\r\n          onKeyDown={e => {\r\n            // Only handle Enter key in search input, let other keys bubble up\r\n            if (e.key === 'Enter' && selectedUser) {\r\n              handleUserSelect(selectedUser);\r\n            }\r\n          }}\r\n          onFocus={handleSearchFocus}\r\n          autoFocus\r\n          onBlur={() => {\r\n            // Auto-focus back to search if modal is still visible\r\n            if (visible && searchInputRef.current) {\r\n              setTimeout(() => {\r\n                if (visible && searchInputRef.current) {\r\n                  searchInputRef.current.focus();\r\n                }\r\n              }, 10);\r\n            }\r\n          }}\r\n          suffix={\r\n            searchTerm && userLoading ? (\r\n              <div style={{ fontSize: '12px', color: '#999' }}>\r\n                Searching...\r\n              </div>\r\n            ) : null\r\n          }\r\n        />\r\n      </div>\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {userLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading users...</Text>\r\n          </div>\r\n        ) : filteredUsers.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No users found matching your search.'\r\n                : 'No users available.'}\r\n            </Text>\r\n          </div>\r\n        ) : (\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredUsers}\r\n            rowKey=\"_id\"\r\n            pagination={false}\r\n            size=\"small\"\r\n            scroll={{ y: 300 }}\r\n            onRow={getRowProps}\r\n          />\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default UserSelectionModal;\r\n","import React from 'react';\r\nimport { Modal, Button, Typography, Space, Divider } from 'antd';\r\nimport { \r\n  FileTextOutlined, \r\n  PlusOutlined, \r\n  CheckCircleOutlined,\r\n  DollarOutlined,\r\n  UserOutlined,\r\n  CalendarOutlined\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillSaveConfirmationModalProps {\r\n  visible: boolean;\r\n  onNewBill: () => void;\r\n  onContinueBill: () => void;\r\n  onCancel: () => void;\r\n  savedBillData?: any;\r\n}\r\n\r\nconst BillSaveConfirmationModal: React.FC<BillSaveConfirmationModalProps> = ({\r\n  visible,\r\n  onNewBill,\r\n  onContinueBill,\r\n  onCancel,\r\n  savedBillData\r\n}) => {\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ textAlign: 'center' }}>\r\n          <CheckCircleOutlined \r\n            style={{ \r\n              color: '#52c41a', \r\n              fontSize: '24px', \r\n              marginRight: '8px' \r\n            }} \r\n          />\r\n          <span style={{ color: '#52c41a', fontWeight: 600 }}>\r\n            Bill Saved Successfully!\r\n          </span>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={500}\r\n      centered\r\n      maskClosable={false}\r\n      closable={false}\r\n    >\r\n      <div style={{ textAlign: 'center', marginBottom: '24px' }}>\r\n        <Text type=\"secondary\">\r\n          Your bill has been saved successfully. What would you like to do next?\r\n        </Text>\r\n      </div>\r\n\r\n      {savedBillData && (\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)',\r\n            border: '1px solid #0ea5e9',\r\n            borderRadius: '8px',\r\n            padding: '16px',\r\n            marginBottom: '24px',\r\n          }}\r\n        >\r\n          <Title level={5} style={{ marginBottom: '12px', color: '#0369a1' }}>\r\n             Bill Summary\r\n          </Title>\r\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <FileTextOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>Invoice: {savedBillData.invoice_no}</Text>\r\n            </div>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <UserOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>{savedBillData.customer_name || 'N/A'}</Text>\r\n            </div>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <CalendarOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>{dayjs(savedBillData.date).format('DD/MM/YYYY')}</Text>\r\n            </div>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <DollarOutlined style={{ color: '#0ea5e9' }} />\r\n              <Text strong>{(typeof savedBillData.total_amount === 'number' ? savedBillData.total_amount : parseFloat(savedBillData.total_amount) || 0).toFixed(2)}</Text>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <Divider style={{ margin: '20px 0' }} />\r\n\r\n      <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n        <Button\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          icon={<PlusOutlined />}\r\n          onClick={onNewBill}\r\n          style={{\r\n            width: '100%',\r\n            height: '48px',\r\n            background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n            border: 'none',\r\n            fontWeight: 600,\r\n            fontSize: '16px',\r\n            borderRadius: '8px',\r\n          }}\r\n        >\r\n           Create New Bill\r\n        </Button>\r\n        \r\n        <Button\r\n          size=\"large\"\r\n          icon={<FileTextOutlined />}\r\n          onClick={onContinueBill}\r\n          style={{\r\n            width: '100%',\r\n            height: '48px',\r\n            background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\r\n            color: 'white',\r\n            border: 'none',\r\n            fontWeight: 600,\r\n            fontSize: '16px',\r\n            borderRadius: '8px',\r\n          }}\r\n        >\r\n           Continue with Current Bill\r\n        </Button>\r\n      </Space>\r\n\r\n      <div style={{ textAlign: 'center', marginTop: '16px' }}>\r\n        <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n           Tip: Use \"New Bill\" to start fresh or \"Continue Bill\" to add more items\r\n        </Text>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default BillSaveConfirmationModal;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Drawer, \r\n  List, \r\n  Typography, \r\n  Button, \r\n  Input, \r\n  Space, \r\n  Tag, \r\n  Avatar, \r\n  Badge,\r\n  Tooltip,\r\n  Divider,\r\n  Empty,\r\n  Spin\r\n} from 'antd';\r\nimport { \r\n  SearchOutlined, \r\n  FileTextOutlined, \r\n  UserOutlined, \r\n  CalendarOutlined,\r\n  DollarOutlined,\r\n  EyeOutlined,\r\n  PrinterOutlined,\r\n  PlusOutlined,\r\n  CloseOutlined\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Search } = Input;\r\n\r\ninterface BillListDrawerProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onViewBill: (bill: any) => void;\r\n  onNewBill: () => void;\r\n}\r\n\r\nconst BillListDrawer: React.FC<BillListDrawerProps> = ({\r\n  visible,\r\n  onClose,\r\n  onViewBill,\r\n  onNewBill\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const SalesRecord = getEntityApi('SalesRecord');\r\n  \r\n  const { items: billList, loading } = useDynamicSelector(\r\n    SalesRecord.getIdentifier('GetAll')\r\n  );\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filteredBills, setFilteredBills] = useState<any[]>([]);\r\n\r\n  // Load bills when drawer opens\r\n  useEffect(() => {\r\n    if (visible) {\r\n      SalesRecord('GetAll');\r\n    }\r\n  }, [visible]);\r\n\r\n  // Filter bills based on search term\r\n  useEffect(() => {\r\n    if (billList?.result) {\r\n      const filtered = billList.result.filter((bill: any) => {\r\n        if (!searchTerm) return true;\r\n        const searchLower = searchTerm.toLowerCase();\r\n        \r\n        // Safely handle bill properties\r\n        const invoiceNo = bill.invoice_no || '';\r\n        const customerName = bill.customerDetails?.full_name || '';\r\n        const date = bill.date || '';\r\n        const totalAmount = typeof bill.total_amount === 'number' ? bill.total_amount.toString() : String(bill.total_amount || '');\r\n        \r\n        return (\r\n          invoiceNo.toLowerCase().includes(searchLower) ||\r\n          customerName.toLowerCase().includes(searchLower) ||\r\n          date.includes(searchTerm) ||\r\n          totalAmount.includes(searchTerm)\r\n        );\r\n      });\r\n      setFilteredBills(filtered);\r\n    }\r\n  }, [billList, searchTerm]);\r\n\r\n  const getPaymentStatusColor = (isPaid: boolean, isPartiallyPaid: boolean) => {\r\n    if (isPaid && !isPartiallyPaid) return 'success';\r\n    if (isPartiallyPaid) return 'warning';\r\n    return 'error';\r\n  };\r\n\r\n  const getPaymentStatusText = (isPaid: boolean, isPartiallyPaid: boolean) => {\r\n    if (isPaid && !isPartiallyPaid) return 'Paid';\r\n    if (isPartiallyPaid) return 'Partial';\r\n    return 'Unpaid';\r\n  };\r\n\r\n  const handleViewBill = (bill: any) => {\r\n\r\n    onViewBill(bill);\r\n    onClose();\r\n  };\r\n\r\n  const handleNewBill = () => {\r\n    onNewBill();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n          <Title level={4} style={{ margin: 0, color: '#1f2937' }}>\r\n             Bill List\r\n          </Title>\r\n          <Button\r\n            type=\"text\"\r\n            icon={<CloseOutlined />}\r\n            onClick={onClose}\r\n            size=\"small\"\r\n          />\r\n        </div>\r\n      }\r\n      placement=\"left\"\r\n      open={visible}\r\n      onClose={onClose}\r\n      width={400}\r\n      bodyStyle={{ padding: '16px' }}\r\n      headerStyle={{ \r\n        borderBottom: '1px solid #e5e7eb',\r\n        padding: '16px 16px 12px 16px'\r\n      }}\r\n    >\r\n      {/* Search and New Bill Section */}\r\n      <div style={{ marginBottom: '16px' }}>\r\n        <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n          <Search\r\n            placeholder=\"Search bills by invoice, customer, date...\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n            prefix={<SearchOutlined />}\r\n            allowClear\r\n            size=\"large\"\r\n          />\r\n          \r\n          <Button\r\n            type=\"primary\"\r\n            icon={<PlusOutlined />}\r\n            onClick={handleNewBill}\r\n            style={{\r\n              width: '100%',\r\n              height: '40px',\r\n              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n              border: 'none',\r\n              fontWeight: 600,\r\n              borderRadius: '8px',\r\n            }}\r\n          >\r\n             Create New Bill\r\n          </Button>\r\n        </Space>\r\n      </div>\r\n\r\n      <Divider style={{ margin: '16px 0' }} />\r\n\r\n      {/* Bill List */}\r\n      <div style={{ height: 'calc(100vh - 250px)', overflow: 'auto' }}>\r\n        {loading ? (\r\n          <div style={{ textAlign: 'center', padding: '40px' }}>\r\n            <Spin size=\"large\" />\r\n            <div style={{ marginTop: '16px' }}>\r\n              <Text type=\"secondary\">Loading bills...</Text>\r\n            </div>\r\n          </div>\r\n        ) : filteredBills.length === 0 ? (\r\n          <Empty\r\n            description={\r\n              <div>\r\n                <Text type=\"secondary\">\r\n                  {searchTerm ? 'No bills found matching your search.' : 'No bills available.'}\r\n                </Text>\r\n                {!searchTerm && (\r\n                  <div style={{ marginTop: '8px' }}>\r\n                    <Button type=\"link\" onClick={handleNewBill}>\r\n                      Create your first bill\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            }\r\n            style={{ marginTop: '40px' }}\r\n          />\r\n        ) : (\r\n          <List\r\n            dataSource={filteredBills}\r\n            renderItem={(bill) => (\r\n              <List.Item\r\n                style={{\r\n                  padding: '16px',\r\n                  border: '1px solid #e5e7eb',\r\n                  borderRadius: '8px',\r\n                  marginBottom: '12px',\r\n                  background: 'white',\r\n                  cursor: 'pointer',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onMouseEnter={(e) => {\r\n                  e.currentTarget.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';\r\n                  e.currentTarget.style.transform = 'translateY(-2px)';\r\n                }}\r\n                onMouseLeave={(e) => {\r\n                  e.currentTarget.style.boxShadow = 'none';\r\n                  e.currentTarget.style.transform = 'translateY(0)';\r\n                }}\r\n                onClick={() => handleViewBill(bill)}\r\n              >\r\n                <div style={{ width: '100%' }}>\r\n                  {/* Header with Invoice and Status */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center',\r\n                    marginBottom: '8px'\r\n                  }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <Avatar \r\n                        icon={<FileTextOutlined />} \r\n                        style={{ \r\n                          background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\r\n                          color: 'white'\r\n                        }} \r\n                      />\r\n                      <Text strong style={{ fontSize: '14px' }}>\r\n                        {bill.invoice_no}\r\n                      </Text>\r\n                    </div>\r\n                    <Tag color={getPaymentStatusColor(bill.is_paid, bill.is_partially_paid)}>\r\n                      {getPaymentStatusText(bill.is_paid, bill.is_partially_paid)}\r\n                    </Tag>\r\n                  </div>\r\n\r\n                  {/* Customer Info */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    alignItems: 'center', \r\n                    gap: '8px',\r\n                    marginBottom: '6px'\r\n                  }}>\r\n                    <UserOutlined style={{ color: '#6b7280', fontSize: '12px' }} />\r\n                    <Text style={{ fontSize: '12px', color: '#374151' }}>\r\n                      {bill.customerDetails?.full_name || bill.customer_name || 'N/A'}\r\n                    </Text>\r\n                  </div>\r\n\r\n                  {/* Date and Amount */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center'\r\n                  }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <CalendarOutlined style={{ color: '#6b7280', fontSize: '12px' }} />\r\n                      <Text style={{ fontSize: '12px', color: '#6b7280' }}>\r\n                        {bill.date ? dayjs(bill.date).format('DD/MM/YYYY') : 'N/A'}\r\n                      </Text>\r\n                    </div>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <DollarOutlined style={{ color: '#10b981', fontSize: '12px' }} />\r\n                      <Text strong style={{ fontSize: '14px', color: '#10b981' }}>\r\n                        {(typeof bill.total_amount === 'number' ? bill.total_amount : parseFloat(bill.total_amount) || 0).toFixed(2)}\r\n                      </Text>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Action Buttons */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    gap: '8px', \r\n                    marginTop: '12px',\r\n                    justifyContent: 'flex-end'\r\n                  }}>\r\n                    <Tooltip title=\"View Bill\">\r\n                      <Button\r\n                        type=\"text\"\r\n                        icon={<EyeOutlined />}\r\n                        size=\"small\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          handleViewBill(bill);\r\n                        }}\r\n                        style={{ color: '#3b82f6' }}\r\n                      />\r\n                    </Tooltip>\r\n                    <Tooltip title=\"Print Bill\">\r\n                      <Button\r\n                        type=\"text\"\r\n                        icon={<PrinterOutlined />}\r\n                        size=\"small\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          // Handle print functionality\r\n                        }}\r\n                        style={{ color: '#10b981' }}\r\n                      />\r\n                    </Tooltip>\r\n                  </div>\r\n                </div>\r\n              </List.Item>\r\n            )}\r\n            pagination={false}\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      {/* Footer Stats */}\r\n      <div style={{ \r\n        position: 'absolute', \r\n        bottom: 0, \r\n        left: 0, \r\n        right: 0, \r\n        padding: '16px',\r\n        background: 'white',\r\n        borderTop: '1px solid #e5e7eb'\r\n      }}>\r\n        <div style={{ \r\n          display: 'flex', \r\n          justifyContent: 'space-between', \r\n          alignItems: 'center'\r\n        }}>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            Total Bills: {filteredBills.length}\r\n          </Text>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n             Click on any bill to view details\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Drawer>\r\n  );\r\n};\r\n\r\nexport default BillListDrawer;\r\n","import React, { FC, useEffect, useState } from 'react';\r\nimport { Modal, Descriptions, Typography, Tag, Divider } from 'antd';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface ProductDetailsModalProps {\r\n  visible: boolean;\r\n  onCancel: () => void;\r\n  productId: string;\r\n}\r\n\r\ninterface ProductDetails {\r\n  _id: string;\r\n  name: string;\r\n  sku: string;\r\n  description?: string;\r\n  selling_price: number;\r\n  mrp: number;\r\n  VariantItem?: {\r\n    variant_name: string;\r\n    variant_code?: string;\r\n  };\r\n  CategoryItem?: {\r\n    name: string;\r\n    tax_percentage: number;\r\n  };\r\n  brand?: string;\r\n  unit?: string;\r\n  min_stock?: number;\r\n  max_stock?: number;\r\n}\r\n\r\nconst ProductDetailsModal: FC<ProductDetailsModalProps> = ({\r\n  visible,\r\n  onCancel,\r\n  productId,\r\n}) => {\r\n  const { getEntityApi } = useApiActions();\r\n  const ProductsApi = getEntityApi('Product');\r\n  \r\n  const { items: products, loading } = useDynamicSelector(\r\n    ProductsApi.getIdentifier('GetAll')\r\n  );\r\n\r\n  const [productDetails, setProductDetails] = useState<ProductDetails | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (visible && productId && products?.result) {\r\n      const product = products.result.find((p: any) => p._id === productId);\r\n      if (product) {\r\n        setProductDetails(product);\r\n      }\r\n    }\r\n  }, [visible, productId, products]);\r\n\r\n  useEffect(() => {\r\n    if (visible && productId && !products?.result) {\r\n      // Load products if not already loaded\r\n      ProductsApi('GetAll');\r\n    }\r\n  }, [visible, productId, products, ProductsApi]);\r\n\r\n  const handleCancel = () => {\r\n    setProductDetails(null);\r\n    onCancel();\r\n  };\r\n\r\n  if (!productDetails) {\r\n    return (\r\n      <Modal\r\n        title=\"Product Details\"\r\n        open={visible}\r\n        onCancel={handleCancel}\r\n        footer={null}\r\n        width={600}\r\n        destroyOnClose\r\n      >\r\n        <div style={{ textAlign: 'center', padding: '40px 20px' }}>\r\n          {loading ? (\r\n            <Text>Loading product details...</Text>\r\n          ) : (\r\n            <Text type=\"secondary\">Product not found</Text>\r\n          )}\r\n        </div>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n          <span> Product Details</span>\r\n          <Tag color=\"blue\" style={{ margin: 0 }}>\r\n            {productDetails.sku}\r\n          </Tag>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={handleCancel}\r\n      footer={null}\r\n      width={700}\r\n      destroyOnClose\r\n    >\r\n      <div style={{ padding: '16px 0' }}>\r\n        {/* Product Name and Variant */}\r\n        <div style={{ marginBottom: '24px' }}>\r\n          <Title level={4} style={{ margin: '0 0 8px 0', color: '#1890ff' }}>\r\n            {productDetails.name}\r\n          </Title>\r\n          {productDetails.VariantItem?.variant_name && (\r\n            <Tag color=\"green\" style={{ fontSize: '12px' }}>\r\n              Variant: {productDetails.VariantItem.variant_name}\r\n            </Tag>\r\n          )}\r\n        </div>\r\n\r\n        <Divider style={{ margin: '16px 0' }} />\r\n\r\n        {/* Product Information */}\r\n        <Descriptions\r\n          title=\"Product Information\"\r\n          column={2}\r\n          size=\"small\"\r\n          bordered\r\n          style={{ marginBottom: '24px' }}\r\n        >\r\n          <Descriptions.Item label=\"Product Name\" span={2}>\r\n            <Text strong>{productDetails.name}</Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.VariantItem?.variant_name && (\r\n            <Descriptions.Item label=\"Variant Name\">\r\n              <Text>{productDetails.VariantItem.variant_name}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.VariantItem?.variant_code && (\r\n            <Descriptions.Item label=\"Variant Code\">\r\n              <Text code>{productDetails.VariantItem.variant_code}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          <Descriptions.Item label=\"SKU\">\r\n            <Text code>{productDetails.sku}</Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.brand && (\r\n            <Descriptions.Item label=\"Brand\">\r\n              <Text>{productDetails.brand}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.unit && (\r\n            <Descriptions.Item label=\"Unit\">\r\n              <Text>{productDetails.unit}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.description && (\r\n            <Descriptions.Item label=\"Description\" span={2}>\r\n              <Text>{productDetails.description}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n        </Descriptions>\r\n\r\n        {/* Pricing Information */}\r\n        <Descriptions\r\n          title=\"Pricing & Tax\"\r\n          column={2}\r\n          size=\"small\"\r\n          bordered\r\n          style={{ marginBottom: '24px' }}\r\n        >\r\n          <Descriptions.Item label=\"Selling Price\">\r\n            <Text strong style={{ color: '#52c41a', fontSize: '16px' }}>\r\n              {productDetails.selling_price?.toFixed(2) || '0.00'}\r\n            </Text>\r\n          </Descriptions.Item>\r\n          \r\n          <Descriptions.Item label=\"MRP\">\r\n            <Text style={{ color: '#fa8c16' }}>\r\n              {productDetails.mrp?.toFixed(2) || '0.00'}\r\n            </Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.CategoryItem?.name && (\r\n            <Descriptions.Item label=\"Category\">\r\n              <Text>{productDetails.CategoryItem.name}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.CategoryItem?.tax_percentage !== undefined && (\r\n            <Descriptions.Item label=\"Tax Rate\">\r\n              <Tag color=\"orange\">\r\n                {productDetails.CategoryItem.tax_percentage}%\r\n              </Tag>\r\n            </Descriptions.Item>\r\n          )}\r\n        </Descriptions>\r\n\r\n        {/* Stock Information */}\r\n        {(productDetails.min_stock !== undefined || productDetails.max_stock !== undefined) && (\r\n          <Descriptions\r\n            title=\"Stock Information\"\r\n            column={2}\r\n            size=\"small\"\r\n            bordered\r\n          >\r\n            {productDetails.min_stock !== undefined && (\r\n              <Descriptions.Item label=\"Minimum Stock\">\r\n                <Text>{productDetails.min_stock}</Text>\r\n              </Descriptions.Item>\r\n            )}\r\n            \r\n            {productDetails.max_stock !== undefined && (\r\n              <Descriptions.Item label=\"Maximum Stock\">\r\n                <Text>{productDetails.max_stock}</Text>\r\n              </Descriptions.Item>\r\n            )}\r\n          </Descriptions>\r\n        )}\r\n\r\n        {/* Footer Information */}\r\n        <div style={{ \r\n          marginTop: '24px', \r\n          padding: '16px', \r\n          backgroundColor: '#f6f8fa', \r\n          borderRadius: '8px',\r\n          textAlign: 'center'\r\n        }}>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            Right-click on product field to view details  Press ESC to close\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProductDetailsModal;\r\n","// extracted by mini-css-extract-plugin\nexport default {\"mainContainer\":\"BillDataGrid_mainContainer__Jnuo1\",\"gradientShift\":\"BillDataGrid_gradientShift__hhIW9\",\"backgroundCircle1\":\"BillDataGrid_backgroundCircle1__5PBPG\",\"float\":\"BillDataGrid_float__1VyT0\",\"backgroundCircle2\":\"BillDataGrid_backgroundCircle2__J+xMs\",\"backgroundCircle3\":\"BillDataGrid_backgroundCircle3__AgoEw\",\"backgroundCircle4\":\"BillDataGrid_backgroundCircle4__86Xfd\",\"backgroundCircle5\":\"BillDataGrid_backgroundCircle5__qpbiT\",\"headerContainer\":\"BillDataGrid_headerContainer__wfojf\",\"slideInDown\":\"BillDataGrid_slideInDown__l3LU5\",\"headerCircle1\":\"BillDataGrid_headerCircle1__8+aPI\",\"headerCircle2\":\"BillDataGrid_headerCircle2__Z9w17\",\"headerCircle3\":\"BillDataGrid_headerCircle3__3eMNm\",\"pulse\":\"BillDataGrid_pulse__EVfnw\",\"headerCircle4\":\"BillDataGrid_headerCircle4__fVITr\",\"headerCircle5\":\"BillDataGrid_headerCircle5__0E6vl\",\"headerContent\":\"BillDataGrid_headerContent__6Rnkr\",\"titleSection\":\"BillDataGrid_titleSection__LBuxT\",\"fadeInLeft\":\"BillDataGrid_fadeInLeft__YHJna\",\"titleIcon\":\"BillDataGrid_titleIcon__qffZU\",\"bounce\":\"BillDataGrid_bounce__fYaGs\",\"titleText\":\"BillDataGrid_titleText__XlvSS\",\"slideInRight\":\"BillDataGrid_slideInRight__+-bkg\",\"subtitleText\":\"BillDataGrid_subtitleText__Hgyav\",\"fadeInUp\":\"BillDataGrid_fadeInUp__Y00FE\",\"controlsSection\":\"BillDataGrid_controlsSection__PSC3w\",\"fadeInRight\":\"BillDataGrid_fadeInRight__eA5Bm\",\"controlGroup\":\"BillDataGrid_controlGroup__AFGBT\",\"saleTypeControl\":\"BillDataGrid_saleTypeControl__hzHpa\",\"slideInUp\":\"BillDataGrid_slideInUp__ZuvW2\",\"gstControl\":\"BillDataGrid_gstControl__AiGdY\",\"paymentControl\":\"BillDataGrid_paymentControl__BD0r9\",\"partialPaymentControl\":\"BillDataGrid_partialPaymentControl__unngo\",\"controlLabel\":\"BillDataGrid_controlLabel__QP4fP\",\"badgesContainer\":\"BillDataGrid_badgesContainer__bqqSt\",\"itemsBadge\":\"BillDataGrid_itemsBadge__o0Uro\",\"amountBadge\":\"BillDataGrid_amountBadge__IPSqT\",\"badgeText\":\"BillDataGrid_badgeText__9cTal\",\"invoiceDetailsGrid\":\"BillDataGrid_invoiceDetailsGrid__QPpaj\",\"itemsSection\":\"BillDataGrid_itemsSection__vJE1b\",\"itemsCircle1\":\"BillDataGrid_itemsCircle1__PQoMB\",\"rotate\":\"BillDataGrid_rotate__l3nA9\",\"itemsCircle2\":\"BillDataGrid_itemsCircle2__0lWcR\",\"scaleIn\":\"BillDataGrid_scaleIn__xFZvA\",\"billItemsGrid\":\"BillDataGrid_billItemsGrid__jpWQo\",\"billItemsHeader\":\"BillDataGrid_billItemsHeader__hxL0O\",\"billItemsTitle\":\"BillDataGrid_billItemsTitle__MQduV\",\"billItemsBadge\":\"BillDataGrid_billItemsBadge__vdJMk\",\"billSummary\":\"BillDataGrid_billSummary__yA4j-\",\"summaryCircle1\":\"BillDataGrid_summaryCircle1__PuveY\",\"summaryCircle2\":\"BillDataGrid_summaryCircle2__fdcks\",\"summaryHeader\":\"BillDataGrid_summaryHeader__h1BtQ\",\"summaryTitle\":\"BillDataGrid_summaryTitle__dSOoP\",\"summaryRow\":\"BillDataGrid_summaryRow__yUShR\",\"summaryLabel\":\"BillDataGrid_summaryLabel__cLnHd\",\"summaryValue\":\"BillDataGrid_summaryValue__LUh-6\",\"summaryTotal\":\"BillDataGrid_summaryTotal__ujvAB\",\"summaryTable\":\"BillDataGrid_summaryTable__ZpVlt\",\"totalAmountRow\":\"BillDataGrid_totalAmountRow__JXMuL\",\"totalAmountLabel\":\"BillDataGrid_totalAmountLabel__IVRMe\",\"totalAmountValue\":\"BillDataGrid_totalAmountValue__5W5mL\",\"discountValue\":\"BillDataGrid_discountValue__QjPij\",\"partialPaymentInfo\":\"BillDataGrid_partialPaymentInfo__OpO+-\",\"partialPaymentRow\":\"BillDataGrid_partialPaymentRow__Qy-Ni\",\"partialPaymentLabel\":\"BillDataGrid_partialPaymentLabel__yEvTO\",\"partialPaymentValue\":\"BillDataGrid_partialPaymentValue__SLg8d\",\"controlsContainer\":\"BillDataGrid_controlsContainer__2jCRg\",\"discountControl\":\"BillDataGrid_discountControl__n0WOI\",\"discountControlLabel\":\"BillDataGrid_discountControlLabel__0iwJ9\",\"discountControlInputs\":\"BillDataGrid_discountControlInputs__TbgUU\",\"partialPaymentControlLabel\":\"BillDataGrid_partialPaymentControlLabel__lxP98\",\"summaryTotalLabel\":\"BillDataGrid_summaryTotalLabel__u+656\",\"summaryTotalValue\":\"BillDataGrid_summaryTotalValue__sKz9B\",\"partialPaymentBalance\":\"BillDataGrid_partialPaymentBalance__lFxZE\",\"discountLabel\":\"BillDataGrid_discountLabel__906vd\",\"discountInputs\":\"BillDataGrid_discountInputs__9BUMD\",\"actionHub\":\"BillDataGrid_actionHub__SlPSg\",\"actionButtonsContainer\":\"BillDataGrid_actionButtonsContainer__BcfKu\",\"actionHubCircle1\":\"BillDataGrid_actionHubCircle1__ggNzA\",\"actionHubCircle2\":\"BillDataGrid_actionHubCircle2__Nb-oj\",\"actionHubCircle3\":\"BillDataGrid_actionHubCircle3__D2pna\",\"actionHubCircle4\":\"BillDataGrid_actionHubCircle4__ayVXK\",\"actionButtons\":\"BillDataGrid_actionButtons__tQbXu\",\"saveButton\":\"BillDataGrid_saveButton__vWggk\",\"billListButton\":\"BillDataGrid_billListButton__ahHFc\",\"refreshButton\":\"BillDataGrid_refreshButton__XnoTE\",\"printButton\":\"BillDataGrid_printButton__nkIDd\",\"clearButton\":\"BillDataGrid_clearButton__518xA\",\"shortcutsInfo\":\"BillDataGrid_shortcutsInfo__kN1Ka\",\"shortcutsText\":\"BillDataGrid_shortcutsText__qGuNn\",\"customerField\":\"BillDataGrid_customerField__+4wOA\",\"customerFieldEndKey\":\"BillDataGrid_customerFieldEndKey__HaMh6\",\"stockField\":\"BillDataGrid_stockField__BQirP\",\"stockFieldSelected\":\"BillDataGrid_stockFieldSelected__x7NU5\",\"stockFieldIcon\":\"BillDataGrid_stockFieldIcon__WeVkj\",\"stockFieldWarning\":\"BillDataGrid_stockFieldWarning__7Lv+C\",\"saleTypeSwitch\":\"BillDataGrid_saleTypeSwitch__Xa4gR\",\"ant-switch-checked\":\"BillDataGrid_ant-switch-checked__rQynk\",\"gstSwitch\":\"BillDataGrid_gstSwitch__ZQG0t\",\"paymentSwitch\":\"BillDataGrid_paymentSwitch__KxB-J\",\"partialPaymentSwitch\":\"BillDataGrid_partialPaymentSwitch__5nNFs\",\"keyboardShortcuts\":\"BillDataGrid_keyboardShortcuts__2e-4z\",\"keyboardShortcutsContent\":\"BillDataGrid_keyboardShortcutsContent__5FpEl\",\"keyboardShortcutsText\":\"BillDataGrid_keyboardShortcutsText__A58I9\",\"slideInLeft\":\"BillDataGrid_slideInLeft__TTFPm\"};","import React, { useEffect, useState, useMemo, useCallback } from 'react';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport {\r\n  Button,\r\n  Typography,\r\n  message,\r\n  Switch,\r\n  InputNumber,\r\n  Badge,\r\n  Tooltip,\r\n} from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport AntdEditableTable, {\r\n  AntdEditableColumn,\r\n} from '../../../components/common/AntdEditableTable';\r\nimport { useGenericCrudRTK } from '../../../hooks/useGenericCrudRTK';\r\nimport { calculateBillTotals } from '../../../helpers/amount_calculations';\r\nimport { useHandleApiResponse } from '../../../components/common/useHandleApiResponse';\r\nimport { BillItem, BillFormData } from '../../../types/entities';\r\nimport {\r\n  SaveOutlined,\r\n  PrinterOutlined,\r\n  FileTextOutlined,\r\n  ClearOutlined,\r\n} from '@ant-design/icons';\r\nimport StockSelectionModal from './StockSelectionModal';\r\nimport CustomerSelectionModal from './CustomerSelectionModal';\r\nimport UserSelectionModal from './UserSelectionModal';\r\nimport BillSaveConfirmationModal from './BillSaveConfirmationModal';\r\nimport BillListDrawer from './BillListDrawer';\r\nimport ProductDetailsModal from './ProductDetailsModal';\r\nimport ProductSelectionModal from './ProductSelectionModal';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillDataGridProps {\r\n  billdata?: any;\r\n  onSuccess?: (formattedBill?: any) => void;\r\n}\r\n\r\nconst BillDataGrid: React.FC<BillDataGridProps> = ({ billdata, onSuccess }) => {\r\n  // RTK Query hooks\r\n  const ProductsApi = useGenericCrudRTK('Product');\r\n  const CustomerApi = useGenericCrudRTK('Customer');\r\n  const BillingUsersApi = useGenericCrudRTK('BillingUsers');\r\n  const StockAuditApi = useGenericCrudRTK('StockAudit');\r\n  const BranchStock = useGenericCrudRTK('BranchStock');\r\n  const SalesRecord = useGenericCrudRTK('SalesRecord');\r\n  const InvoiceNumberApi = useGenericCrudRTK('InvoiceNumber');\r\n\r\n  // RTK Query hooks for fetching data\r\n  const { data: productListData, isLoading: productLoading, refetch: refetchProducts } = ProductsApi.useGetAll();\r\n  const { data: customerListData, isLoading: customerLoading, refetch: refetchCustomers } = CustomerApi.useGetAll();\r\n  const { data: userListData, isLoading: userLoading, refetch: refetchUsers } = BillingUsersApi.useGetAll();\r\n  const { data: stockAuditListData, isLoading: stockLoading, refetch: refetchStockAudit } = StockAuditApi.useGetAll();\r\n  const { data: branchStockListData, isLoading: branchStockLoading, refetch: refetchBranchStock } = BranchStock.useGetAll();\r\n  const { data: invoiceNoData, refetch: refetchInvoiceNo } = InvoiceNumberApi.useGetAll();\r\n\r\n  // Extract data with proper fallback - RTK Query returns the API response with { statusCode, result, ... }\r\n  const productList = productListData || {};\r\n  const customerList = customerListData || {};\r\n  const userList = userListData || {};\r\n  const stockAuditList = stockAuditListData || {};\r\n  const branchStockList = branchStockListData || {};\r\n  const invoice_no_item = invoiceNoData || {};\r\n  \r\n  // Access the result field from the API response\r\n  const productListResult = Array.isArray(productList.result) ? productList.result : [];\r\n  const customerListResult = Array.isArray(customerList.result) ? customerList.result : [];\r\n  const userListResult = Array.isArray(userList.result) ? userList.result : [];\r\n  const stockAuditListResult = Array.isArray(stockAuditList.result) ? stockAuditList.result : [];\r\n  const branchStockListResult = Array.isArray(branchStockList.result) ? branchStockList.result : [];\r\n\r\n  // RTK Query mutation hooks\r\n  const { create: createSalesRecord, isLoading: saleCreateLoading } = SalesRecord.useCreate();\r\n  const { update: updateSalesRecord, isLoading: saleUpdateLoading } = SalesRecord.useUpdate();\r\n  const { create: createInvoiceNumber, isLoading: invoice_no_create_loading } = InvoiceNumberApi.useCreate();\r\n  \r\n  const invoice_no_create_item = null; // Not needed for RTK Query\r\n  \r\n  // Track create/update responses\r\n  const [createResponse, setCreateResponse] = useState<any>(null);\r\n  const [updateResponse, setUpdateResponse] = useState<any>(null);\r\n\r\n  // Utility function to validate stock quantities based on pack size\r\n  const validateStockQuantities = useCallback(\r\n    (stock: any, productItem: any) => {\r\n      if (!stock || !productItem?.VariantItem?.pack_size)\r\n        return { isValid: true, expectedLoose: 0, totalAvailable: 0 };\r\n\r\n      const packSize = parseInt(productItem.VariantItem.pack_size);\r\n      const availablePackQty = stock.available_quantity || 0;\r\n      const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n      // Stock quantities are valid as they are - no need to enforce a specific relationship\r\n      // The validation happens during quantity entry, not during stock data validation\r\n      const isValid = true; // Always valid - let the quantity validation handle limits\r\n      const totalAvailable = availablePackQty * packSize + availableLooseQty;\r\n\r\n      return { isValid, expectedLoose: availableLooseQty, totalAvailable };\r\n    },\r\n    []\r\n  );\r\n\r\n  // State\r\n  const [billFormData, setBillFormData] = useState<BillFormData>({\r\n    invoice_no: '',\r\n    date: dayjs().format('YYYY-MM-DD'),\r\n    customer_id: '',\r\n    customer_name: '',\r\n    billed_by_id: '',\r\n    billed_by_name: '',\r\n    payment_mode: 'cash',\r\n    items: [],\r\n  });\r\n\r\n  const [billSettings, setBillSettings] = useState({\r\n    isPaid: true,\r\n    isPartiallyPaid: false,\r\n    isRetail: true,\r\n    isGstIncluded: true,\r\n    discount: 0,\r\n    discountType: 'percentage' as 'percentage' | 'amount',\r\n    paidAmount: 0,\r\n  });\r\n\r\n  const [stockModalRowIndex, setStockModalRowIndex] = useState<number | null>(\r\n    null\r\n  );\r\n  const [externalEditingCell, setExternalEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n  const [customerModalVisible, setCustomerModalVisible] = useState(false);\r\n  const [userModalVisible, setUserModalVisible] = useState(false);\r\n  const [saveConfirmationVisible, setSaveConfirmationVisible] = useState(false);\r\n  const [billListDrawerVisible, setBillListDrawerVisible] = useState(false);\r\n  const [savedBillData, setSavedBillData] = useState<any>(null);\r\n  const [productDetailsModalVisible, setProductDetailsModalVisible] =\r\n    useState(false);\r\n  const [selectedProductId, setSelectedProductId] = useState<string>('');\r\n  const [productSelectionModalVisible, setProductSelectionModalVisible] =\r\n    useState(false);\r\n  const [productSelectionRowIndex, setProductSelectionRowIndex] = useState<\r\n    number | null\r\n  >(null);\r\n  const [lastInteractedRowIndex, setLastInteractedRowIndex] =\r\n    useState<number>(0);\r\n\r\n  // User info - memoized to prevent re-parsing on every render\r\n  const user = useMemo(() => {\r\n    return getCurrentUser();\r\n  }, []);\r\n  const branchId = user?.branch_id;\r\n\r\n  // Helper function to validate stock quantities\r\n  const validateStockQuantity = (\r\n    stockId: string,\r\n    qty: number,\r\n    looseQty: number\r\n  ): {\r\n    isValid: boolean;\r\n    availablePackQty: number;\r\n    maxLooseQty: number;\r\n    message: string;\r\n  } => {\r\n    const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n    const stock = stockListData.find((s: any) => s._id === stockId);\r\n\r\n    if (!stock) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty: 0,\r\n        maxLooseQty: 0,\r\n        message: 'Stock not found',\r\n      };\r\n    }\r\n\r\n    // Get pack size from stock data\r\n    const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n    const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n    // Available pack quantity (number of complete packs/boxes)\r\n    const availablePackQty = stock.available_quantity || 0;\r\n\r\n    // Available loose quantity (actual loose items in stock, not calculated)\r\n    const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n    // Validate pack quantity (QTY field)\r\n    if (qty > availablePackQty) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty,\r\n        maxLooseQty: 0,\r\n        message: `Pack quantity (${qty}) exceeds available packs (${availablePackQty})`,\r\n      };\r\n    }\r\n\r\n    // Calculate max loose quantity based on remaining packs after QTY selection\r\n    // Formula: (available_packs - selected_qty)  pack_size + available_loose_qty\r\n    const remainingPacks = availablePackQty - qty;\r\n    const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n    const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n    // Validate loose quantity (LOOSE QTY field)\r\n    if (looseQty > maxLooseQty) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty,\r\n        maxLooseQty,\r\n        message: `Loose quantity (${looseQty}) exceeds available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`,\r\n      };\r\n    }\r\n\r\n    return {\r\n      isValid: true,\r\n      availablePackQty,\r\n      maxLooseQty,\r\n      message: '',\r\n    };\r\n  };\r\n\r\n  // Handle quantity change with validation - memoized to prevent column recreation\r\n  const handleQuantityChange = useCallback(\r\n    (rowIndex: number, field: 'qty' | 'loose_qty', value: number) => {\r\n      const newItems = [...billFormData.items];\r\n      const item = newItems[rowIndex];\r\n\r\n      if (!item.stock_id) {\r\n        // If no stock selected, just update the value\r\n        newItems[rowIndex] = { ...item, [field]: value };\r\n        setBillFormData(prev => ({ ...prev, items: newItems }));\r\n        return;\r\n      }\r\n\r\n      // Validate the new quantity\r\n      const newQty = field === 'qty' ? value : item.qty || 0;\r\n      const newLooseQty = field === 'loose_qty' ? value : item.loose_qty || 0;\r\n\r\n      const validation = validateStockQuantity(\r\n        item.stock_id,\r\n        newQty,\r\n        newLooseQty\r\n      );\r\n\r\n      if (!validation.isValid) {\r\n        message.error(validation.message);\r\n\r\n        // Auto-correct the quantity if it exceeds available stock\r\n        if (field === 'qty' && newQty > validation.availablePackQty) {\r\n          newItems[rowIndex] = {\r\n            ...item,\r\n            qty: validation.availablePackQty,\r\n          };\r\n        } else if (\r\n          field === 'loose_qty' &&\r\n          newLooseQty > validation.maxLooseQty\r\n        ) {\r\n          newItems[rowIndex] = { ...item, loose_qty: validation.maxLooseQty };\r\n        }\r\n      } else {\r\n        // Update the quantity\r\n        newItems[rowIndex] = { ...item, [field]: value };\r\n      }\r\n\r\n      setBillFormData(prev => ({ ...prev, items: newItems }));\r\n    },\r\n    [billFormData.items, validateStockQuantity]\r\n  );\r\n\r\n  // Initialize data\r\n  useEffect(() => {\r\n    refetchProducts();\r\n    refetchCustomers();\r\n    refetchUsers();\r\n    // Only get invoice number for new bills, not when editing existing bills\r\n    if (!billdata && !invoice_no_create_loading) {\r\n      refetchInvoiceNo();\r\n    }\r\n\r\n    if (billdata) {\r\n      setBillFormData({\r\n        invoice_no: billdata.invoice_no,\r\n        date: dayjs(billdata.date).format('YYYY-MM-DD'),\r\n        customer_id: billdata.customer_id,\r\n        customer_name: billdata.customerDetails?.full_name || '',\r\n        billed_by_id: billdata.billed_by_id || '',\r\n        billed_by_name: billdata.billedByDetails?.name || '',\r\n        payment_mode: billdata.payment_mode,\r\n        items:\r\n          billdata.Items?.map((item: any) => ({\r\n            _id: item._id,\r\n            product_id: item.product_id,\r\n            product_name: item.productItems?.name || '',\r\n            variant_name: item.productItems?.VariantItem?.variant_name || '',\r\n            stock_id: branchId ? item.branch_stock_id : item.stock_id,\r\n            qty: item.qty || 0,\r\n            loose_qty: item.loose_qty || 0,\r\n            price: item.price,\r\n            mrp: item.mrp || item.price,\r\n            amount: item.amount,\r\n            tax_percentage: item.tax_percentage || 0,\r\n          })) || [],\r\n      });\r\n\r\n      setBillSettings({\r\n        isPaid: billdata.is_paid ?? true,\r\n        isPartiallyPaid: billdata.is_partially_paid ?? false,\r\n        isRetail: billdata.sale_type === 'retail',\r\n        isGstIncluded: billdata.is_gst_included ?? true,\r\n        discount: billdata.discount ?? 0,\r\n        discountType: billdata.discount_type ?? 'percentage',\r\n        paidAmount: billdata.paid_amount ?? 0,\r\n      });\r\n    }\r\n  }, [billdata]);\r\n\r\n  // Set auto-generated invoice number\r\n  useEffect(() => {\r\n    if (invoice_no_item?.result?.invoice_no && !billdata) {\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        invoice_no: invoice_no_item.result.invoice_no,\r\n      }));\r\n    }\r\n  }, [invoice_no_item, billdata]);\r\n\r\n  // Initialize with 5 default empty items if no existing data\r\n  useEffect(() => {\r\n    if (!billdata && billFormData.items.length === 0) {\r\n      const defaultItems = Array(1)\r\n        .fill(null)\r\n        .map((_, index) => ({\r\n          product_id: '',\r\n          product_name: '',\r\n          variant_name: '',\r\n          stock_id: '',\r\n          batch_no: '',\r\n          qty: 0,\r\n          loose_qty: 0,\r\n          price: 0,\r\n          mrp: 0,\r\n          amount: 0,\r\n          tax_percentage: 0,\r\n        }));\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        items: defaultItems,\r\n      }));\r\n    }\r\n  }, [billdata, billFormData.items.length]);\r\n\r\n  // Auto-set current user as billed_by for new bills\r\n  useEffect(() => {\r\n    if (\r\n      !billdata &&\r\n      userListResult &&\r\n      user?._id &&\r\n      !billFormData.billed_by_id\r\n    ) {\r\n      const currentUserInList = userListResult.find(\r\n        (u: any) => u._id === user._id\r\n      );\r\n      if (currentUserInList) {\r\n        setBillFormData(prev => ({\r\n          ...prev,\r\n          billed_by_id: user._id,\r\n          billed_by_name: currentUserInList.name || user.name || '',\r\n        }));\r\n      }\r\n    }\r\n  }, [userListResult, user?._id, billdata, billFormData.billed_by_id]);\r\n\r\n  // Product and stock options\r\n  const productOptions = useMemo(\r\n    () =>\r\n      productListResult.map((product: any) => ({\r\n        label:\r\n          `${product.name} ${product?.VariantItem?.variant_name || ''}`.trim(),\r\n        value: product._id,\r\n      })),\r\n    [productListResult]\r\n  );\r\n\r\n  const customerOptions = useMemo(() => {\r\n    const options =\r\n      customerListResult.map((customer: any) => ({\r\n        label: `${customer.full_name} - ${customer.mobile}`,\r\n        value: customer._id,\r\n      }));\r\n    return options;\r\n  }, [customerListResult]);\r\n\r\n  const userOptions = useMemo(() => {\r\n    const options =\r\n      userListResult.map((user: any) => ({\r\n        label: `${user.name} (${user.roleItems?.name || 'No Role'})`,\r\n        value: user._id,\r\n      }));\r\n    return options;\r\n  }, [userListResult]);\r\n\r\n  // Column definitions for bill header - memoized to prevent recreation\r\n  const headerColumns: AntdEditableColumn[] = useMemo(\r\n    () => [\r\n      {\r\n        key: 'invoice_no',\r\n        title: ' INVOICE #',\r\n        dataIndex: 'invoice_no',\r\n        type: 'text',\r\n        required: true,\r\n        width: 180,\r\n      },\r\n      {\r\n        key: 'date',\r\n        title: ' DATE',\r\n        dataIndex: 'date',\r\n        type: 'date',\r\n        required: true,\r\n        width: 150,\r\n      },\r\n      {\r\n        key: 'customer_id',\r\n        title: ' CUSTOMER',\r\n        dataIndex: 'customer_id',\r\n        type: 'select',\r\n        options: customerOptions,\r\n        required: true,\r\n        width: 250,\r\n        render: (value: any, record: any) => {\r\n          const selectedCustomer = customerOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          return (\r\n            <Tooltip title=\"Click to open customer selection modal (or press End key)\">\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={() => setCustomerModalVisible(true)}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#fafafa';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>\r\n                  {selectedCustomer\r\n                    ? selectedCustomer.label\r\n                    : 'Select customer'}\r\n                </span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#f0f8ff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  End\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'billed_by_id',\r\n        title: ' BILLED BY',\r\n        dataIndex: 'billed_by_id',\r\n        type: 'select',\r\n        options: userOptions,\r\n        required: false,\r\n        width: 250,\r\n        render: (value: any, record: any) => {\r\n          const selectedUser = userOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          return (\r\n            <Tooltip title=\"Click to open user selection modal (or press Ctrl+U key)\">\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#f0f8ff',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={() => setUserModalVisible(true)}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#e6f7ff';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f8ff';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>{selectedUser ? selectedUser.label : 'Select user'}</span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#ffffff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  Ctrl+U\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'payment_mode',\r\n        title: ' PAYMENT',\r\n        dataIndex: 'payment_mode',\r\n        type: 'select',\r\n        options: [\r\n          { label: ' Cash', value: 'cash' },\r\n          { label: ' UPI', value: 'upi' },\r\n          { label: ' Card', value: 'card' },\r\n        ],\r\n        required: true,\r\n        width: 150,\r\n      },\r\n    ],\r\n    [customerOptions, userOptions]\r\n  );\r\n\r\n  const headerData = useMemo(\r\n    () => [\r\n      {\r\n        invoice_no: billFormData.invoice_no,\r\n        date: billFormData.date,\r\n        customer_id: billFormData.customer_id,\r\n        billed_by_id: billFormData.billed_by_id,\r\n        payment_mode: billFormData.payment_mode,\r\n      },\r\n    ],\r\n    [\r\n      billFormData.invoice_no,\r\n      billFormData.date,\r\n      billFormData.customer_id,\r\n      billFormData.billed_by_id,\r\n      billFormData.payment_mode,\r\n    ]\r\n  );\r\n\r\n  // Column definitions for bill items - memoized to prevent recreation\r\n  const itemColumns: AntdEditableColumn[] = useMemo(\r\n    () => [\r\n      {\r\n        key: 'product_id',\r\n        title: ' PRODUCT',\r\n        dataIndex: 'product_id',\r\n        type: 'product', // triggers modal\r\n        required: true,\r\n        width: 280,\r\n        render: (value, record, index) => {\r\n          const selectedProduct = productOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          return (\r\n            <Tooltip\r\n              title={\r\n                value\r\n                  ? `Product: ${selectedProduct?.label || 'Unknown'} - Click to change  F5 to reopen`\r\n                  : 'Click to select product from inventory  F5 to open'\r\n              }\r\n              placement=\"top\"\r\n            >\r\n              <div\r\n                style={{\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: value ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                  backgroundColor: value ? '#f6ffed' : '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                  minHeight: '32px',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                }}\r\n                onClick={() => {\r\n                  // Open product selection modal\r\n                  if (typeof index === 'number') {\r\n                    setProductSelectionRowIndex(index);\r\n                    setLastInteractedRowIndex(index); // Track this row for F5\r\n                    setProductSelectionModalVisible(true);\r\n                  }\r\n                }}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = value\r\n                    ? '#f6ffed'\r\n                    : '#fafafa';\r\n                  e.currentTarget.style.borderColor = value\r\n                    ? '#52c41a'\r\n                    : '#d9d9d9';\r\n                }}\r\n              >\r\n                <span\r\n                  style={{\r\n                    color: value ? '#52c41a' : '#1890ff',\r\n                    fontWeight: value ? 600 : 400,\r\n                  }}\r\n                >\r\n                  {value\r\n                    ? selectedProduct?.label || 'Unknown Product'\r\n                    : 'Select product'}\r\n                </span>\r\n                {value && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '12px', color: '#52c41a' }}>\r\n                      \r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#52c41a',\r\n                        backgroundColor: '#f6ffed',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Selected\r\n                    </span>\r\n                  </div>\r\n                )}\r\n                {!value && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                      marginTop: '2px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '10px', color: '#ff4d4f' }}>\r\n                       Product required\r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#1890ff',\r\n                        backgroundColor: '#f0f8ff',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Click\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'stock_id',\r\n        title: ' STOCK',\r\n        dataIndex: 'batch_no',\r\n        type: 'stock',\r\n        required: true,\r\n        width: 280,\r\n        editable: true, // allow editing to open modal\r\n        render: (value, record, index) => {\r\n          // Get stock info for display\r\n          const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n          const stock = stockListData.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n\r\n          // Get pack size from stock data\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n          // Calculate available quantities\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const availableLooseQty = stock?.available_loose_quantity || 0;\r\n\r\n          const isLowStock = availablePackQty > 0 && availablePackQty <= 10;\r\n          const isOutOfStock = availablePackQty === 0;\r\n\r\n          return (\r\n            <Tooltip\r\n              title={\r\n                record.product_id\r\n                  ? value\r\n                    ? `Stock: ${value} - Packs Available: ${availablePackQty}  Loose Available: ${availableLooseQty}  Pack Size: ${packSizeNum}  Click to change  F7 to reopen`\r\n                    : 'Click to select stock from available inventory  F7 to open'\r\n                  : 'Please select a product first to choose stock  F7 to open after product selection'\r\n              }\r\n              placement=\"top\"\r\n            >\r\n              <div\r\n                style={{\r\n                  cursor: 'pointer',\r\n                  padding: '6px 10px',\r\n                  borderRadius: '6px',\r\n                  border: value ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                  backgroundColor: value ? '#f6ffed' : '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                  minHeight: '32px',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  width: '100%',\r\n                  gap: '10px',\r\n                }}\r\n                onClick={() => {\r\n                  if (record.product_id && typeof index === 'number') {\r\n                    setStockModalRowIndex(index);\r\n                  } else if (!record.product_id) {\r\n                    message.warning('Please select a product first');\r\n                  }\r\n                }}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = value\r\n                    ? '#f6ffed'\r\n                    : '#fafafa';\r\n                  e.currentTarget.style.borderColor = value\r\n                    ? '#52c41a'\r\n                    : '#d9d9d9';\r\n                }}\r\n              >\r\n                {/* Left Section */}\r\n                <div\r\n                  style={{\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: '8px',\r\n                    flex: 1,\r\n                  }}\r\n                >\r\n                  <span\r\n                    style={{\r\n                      color: value\r\n                        ? '#52c41a'\r\n                        : record.product_id\r\n                          ? '#1890ff'\r\n                          : '#bfbfbf',\r\n                      fontWeight: value ? 600 : 400,\r\n                      fontSize: '13px',\r\n                      whiteSpace: 'nowrap',\r\n                    }}\r\n                  >\r\n                    {value || 'Select Stock'}\r\n                  </span>\r\n\r\n                  {/* Stock Badges (inline) */}\r\n                  {stock && (\r\n                    <>\r\n                      <span\r\n                        style={{\r\n                          color: isOutOfStock\r\n                            ? '#ff4d4f'\r\n                            : isLowStock\r\n                              ? '#faad14'\r\n                              : '#52c41a',\r\n                          fontWeight: 'bold',\r\n                          backgroundColor: isOutOfStock\r\n                            ? '#fff2f0'\r\n                            : isLowStock\r\n                              ? '#fffbe6'\r\n                              : '#f6ffed',\r\n                          padding: '2px 6px',\r\n                          borderRadius: '4px',\r\n                          border: `1px solid ${\r\n                            isOutOfStock\r\n                              ? '#ffccc7'\r\n                              : isLowStock\r\n                                ? '#ffe58f'\r\n                                : '#b7eb8f'\r\n                          }`,\r\n                          fontSize: '12px',\r\n                        }}\r\n                      >\r\n                         {availablePackQty}\r\n                      </span>\r\n                      <span\r\n                        style={{\r\n                          color: '#722ed1',\r\n                          fontWeight: 'bold',\r\n                          backgroundColor: '#f9f0ff',\r\n                          padding: '2px 6px',\r\n                          borderRadius: '4px',\r\n                          border: '1px solid #d3adf7',\r\n                          fontSize: '12px',\r\n                        }}\r\n                      >\r\n                         {availableLooseQty}\r\n                      </span>\r\n                    </>\r\n                  )}\r\n\r\n                  {/* Warning (inline, not breaking row) */}\r\n                  {record.product_id && !value && (\r\n                    <span\r\n                      style={{\r\n                        fontSize: '11px',\r\n                        color: '#ff4d4f',\r\n                        whiteSpace: 'nowrap',\r\n                      }}\r\n                    >\r\n                       Stock required\r\n                    </span>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Right Side \"Click\" Indicator */}\r\n                {record.product_id && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '12px', color: '#1890ff' }}>\r\n                      \r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#52c41a',\r\n                        backgroundColor: '#f6ffed',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Click\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'qty',\r\n        title: ' QTY',\r\n        dataIndex: 'qty',\r\n        type: 'number',\r\n        width: 90,\r\n        render: (value: number, record: any, index?: number) => {\r\n          // Get stock info for validation\r\n          const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n          const stock = stockListData.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const isExceedingStock = value > availablePackQty;\r\n\r\n          return (\r\n            <div style={{ position: 'relative' }}>\r\n              <InputNumber\r\n                value={value}\r\n                min={0}\r\n                max={availablePackQty}\r\n                style={{\r\n                  width: '100%',\r\n                  borderColor: isExceedingStock ? '#ff4d4f' : undefined,\r\n                  backgroundColor: isExceedingStock ? '#fff2f0' : undefined,\r\n                }}\r\n                onPressEnter={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'qty', newValue);\r\n                  }\r\n                }}\r\n                onBlur={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'qty', newValue);\r\n                  }\r\n                }}\r\n                onChange={newValue => {\r\n                  if (newValue !== null && newValue > availablePackQty) {\r\n                    message.error(\r\n                      `Pack quantity cannot exceed available packs (${availablePackQty})`\r\n                    );\r\n                    return;\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'loose_qty',\r\n        title: ' LOOSE',\r\n        dataIndex: 'loose_qty',\r\n        type: 'number',\r\n        width: 90,\r\n        render: (value: number, record: any, index?: number) => {\r\n          // Get stock info for validation\r\n          const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n          const stock = stockListData.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n\r\n          if (!stock) {\r\n            return (\r\n              <div style={{ position: 'relative' }}>\r\n                <InputNumber\r\n                  value={value}\r\n                  min={0}\r\n                  style={{ width: '100%' }}\r\n                  disabled\r\n                />\r\n              </div>\r\n            );\r\n          }\r\n\r\n          // Calculate dynamic max loose quantity based on current QTY selection\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const availableLooseQty = stock?.available_loose_quantity || 0;\r\n\r\n          // Current QTY selection affects max loose quantity\r\n          const currentQty = record.qty || 0;\r\n          const remainingPacks = availablePackQty - currentQty;\r\n          const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n          const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n          const isExceedingStock = value > maxLooseQty;\r\n\r\n          return (\r\n            <div style={{ position: 'relative' }}>\r\n              <InputNumber\r\n                value={value}\r\n                min={0}\r\n                max={maxLooseQty}\r\n                style={{\r\n                  width: '100%',\r\n                  borderColor: isExceedingStock ? '#ff4d4f' : undefined,\r\n                  backgroundColor: isExceedingStock ? '#fff2f0' : undefined,\r\n                }}\r\n                onPressEnter={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'loose_qty', newValue);\r\n                  }\r\n                }}\r\n                onBlur={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'loose_qty', newValue);\r\n                  }\r\n                }}\r\n                onChange={newValue => {\r\n                  if (newValue !== null && newValue > maxLooseQty) {\r\n                    message.error(\r\n                      `Loose quantity cannot exceed available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`\r\n                    );\r\n                    return;\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'price',\r\n        title: ' RATE',\r\n        dataIndex: 'price',\r\n        type: 'number',\r\n        required: true,\r\n        width: 120,\r\n        editable: false, // Make rate not editable\r\n        render: value => (\r\n          <InputNumber value={value} disabled style={{ width: '100%' }} />\r\n        ),\r\n      },\r\n      {\r\n        key: 'amount',\r\n        title: ' AMOUNT',\r\n        dataIndex: 'amount',\r\n        type: 'number',\r\n        editable: false, // Make amount not editable\r\n        width: 130,\r\n        render: value => (\r\n          <InputNumber value={value} disabled style={{ width: '100%' }} />\r\n        ),\r\n      },\r\n    ],\r\n    [\r\n      productOptions,\r\n      branchId,\r\n      branchStockListResult,\r\n      stockAuditListResult,\r\n      handleQuantityChange,\r\n    ]\r\n  );\r\n\r\n  // Find the column index for qty\r\n  const qtyColIndex = itemColumns.findIndex(\r\n    col => col.key === 'qty' || col.dataIndex === 'qty'\r\n  );\r\n\r\n  // Calculate bill totals\r\n  const billCalculations = useMemo(() => {\r\n    if (!billFormData.items.length)\r\n      return {\r\n        sub_total: 0,\r\n        value_of_goods: 0,\r\n        total_gst: 0,\r\n        cgst: 0,\r\n        sgst: 0,\r\n        total_amount: 0,\r\n        discountValue: 0,\r\n      };\r\n\r\n    return calculateBillTotals({\r\n      items: billFormData.items,\r\n      productList: productListResult,\r\n      isGstIncluded: billSettings.isGstIncluded,\r\n      discount: billSettings.discount,\r\n      discountType: billSettings.discountType,\r\n    });\r\n  }, [billFormData.items, productListResult, billSettings]);\r\n\r\n  // Handle header changes - memoized to prevent unnecessary re-renders\r\n  const handleHeaderChange = useCallback(\r\n    (headerRows: any[]) => {\r\n      const updatedHeader = headerRows[0];\r\n      if (updatedHeader) {\r\n        // Find customer name for display\r\n        const customer = customerListResult.find(\r\n          (c: any) => c._id === updatedHeader.customer_id\r\n        );\r\n        // Find user name for display\r\n        const user = userListResult.find(\r\n          (u: any) => u._id === updatedHeader.billed_by_id\r\n        );\r\n        setBillFormData(prev => ({\r\n          ...prev,\r\n          invoice_no: updatedHeader.invoice_no || '',\r\n          date: updatedHeader.date || dayjs().format('YYYY-MM-DD'),\r\n          customer_id: updatedHeader.customer_id || '',\r\n          customer_name: customer?.full_name || '',\r\n          billed_by_id: updatedHeader.billed_by_id || '',\r\n          billed_by_name: user?.name || '',\r\n          payment_mode: updatedHeader.payment_mode || 'cash',\r\n        }));\r\n      }\r\n    },\r\n    [customerListResult, userListResult]\r\n  );\r\n\r\n  // Handle item changes - memoized to prevent unnecessary re-renders\r\n  const handleItemsChange = useCallback(\r\n    (items: any[]) => {\r\n      // Convert back to BillItem format and auto-populate stock\r\n      const billItems: BillItem[] = items.map(item => {\r\n        const billItem: BillItem = {\r\n          product_id: item.product_id || '',\r\n          product_name:\r\n            productOptions.find(\r\n              (opt: { label: string; value: string }) =>\r\n                opt.value === item.product_id\r\n            )?.label || '',\r\n          variant_name: item.variant_name || '',\r\n          stock_id: item.stock_id || '',\r\n          batch_no: item.batch_no || '', //  Preserve batch_no from input\r\n          qty: item.qty || 0,\r\n          loose_qty: item.loose_qty || 0,\r\n          price: item.price || 0,\r\n          mrp: item.mrp || 0,\r\n          amount: item.amount || 0,\r\n          tax_percentage: item.tax_percentage || 0,\r\n        };\r\n\r\n        // Stock validation for pack and loose quantities\r\n        if (item.stock_id && (item.qty || item.loose_qty)) {\r\n          const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n          const stock = stockListData.find(\r\n            (s: any) => s._id === item.stock_id\r\n          );\r\n\r\n          if (stock) {\r\n            // Get pack size from stock data\r\n            const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n            const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n            // Available pack quantity and actual loose quantity\r\n            const availablePackQty = stock.available_quantity || 0;\r\n            const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n            // Validate pack quantity (QTY field)\r\n            if (item.qty && item.qty > availablePackQty) {\r\n              message.error(\r\n                `Pack quantity (${item.qty}) exceeds available packs (${availablePackQty})`\r\n              );\r\n              billItem.qty = availablePackQty;\r\n            }\r\n\r\n            // Calculate max loose quantity based on remaining packs after QTY selection\r\n            const remainingPacks = availablePackQty - (item.qty || 0);\r\n            const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n            const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n            // Validate loose quantity (LOOSE QTY field)\r\n            if (item.loose_qty && item.loose_qty > maxLooseQty) {\r\n              message.error(\r\n                `Loose quantity (${item.loose_qty}) exceeds available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`\r\n              );\r\n              billItem.loose_qty = maxLooseQty;\r\n            }\r\n          }\r\n        }\r\n\r\n        // Auto-populate stock if product is selected but stock is not\r\n        if (item.product_id && !item.stock_id) {\r\n          const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n          const availableStocks =\r\n            stockListData.filter(\r\n              (stock: any) =>\r\n                stock.product === item.product_id ||\r\n                stock.ProductItem?._id === item.product_id\r\n            );\r\n\r\n          if (availableStocks.length > 0) {\r\n            const firstStock = availableStocks[0];\r\n            billItem.stock_id = firstStock._id;\r\n            billItem.batch_no = firstStock.batch_no || '';\r\n\r\n            // Auto-focus quantity field after auto-selecting stock\r\n            setTimeout(() => {\r\n              const qtyCell = document.querySelector(\r\n                `td[data-row-key=\"${item.key}\"][data-column-key=\"qty\"]`\r\n              ) as HTMLElement;\r\n              if (qtyCell) {\r\n                qtyCell.focus();\r\n              }\r\n            }, 300);\r\n          }\r\n        }\r\n\r\n        return billItem;\r\n      });\r\n      // Update items with calculated amounts\r\n      const updatedItems = billItems.map(item => {\r\n        if (!item.product_id || !item.stock_id) return item;\r\n\r\n        // Get stock info\r\n        const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n        const stock = stockListData.find(\r\n          (s: any) => s._id === item.stock_id\r\n        );\r\n\r\n        if (stock) {\r\n          const sellPrice = stock.sell_price || 0;\r\n          // Get pack size from stock data\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n          // Calculate loose item rate: sell_price / pack_size (since sell_price is per pack)\r\n          const looseRate = sellPrice / packSizeNum;\r\n\r\n          const baseAmount =\r\n            (item.qty || 0) * sellPrice + (item.loose_qty || 0) * looseRate;\r\n\r\n          // Get product for tax calculation\r\n          const product = productListResult.find(\r\n            (p: any) => p._id === item.product_id\r\n          );\r\n          const taxPercentage = product?.CategoryItem?.tax_percentage || 0;\r\n\r\n          let amount = baseAmount;\r\n          if (!billSettings.isGstIncluded) {\r\n            amount = baseAmount + (baseAmount * taxPercentage) / 100;\r\n          }\r\n\r\n          return {\r\n            ...item,\r\n            price: item.price || sellPrice,\r\n            mrp: stock.mrp || sellPrice,\r\n            amount: amount,\r\n            tax_percentage: taxPercentage,\r\n            product_name: product?.name || '',\r\n            variant_name: product?.VariantItem?.variant_name || '',\r\n            batch_no: stock.batch_no || '',\r\n          };\r\n        }\r\n\r\n        return item;\r\n      });\r\n\r\n      setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n    },\r\n    [\r\n      productOptions,\r\n      branchId,\r\n      branchStockListResult,\r\n      stockAuditListResult,\r\n      productListResult,\r\n      billSettings,\r\n    ]\r\n  );\r\n\r\n  const handleProductSelect = useCallback(\r\n    (product: any, rowIndex: number) => {\r\n      // Validate rowIndex bounds\r\n      if (rowIndex < 0 || rowIndex >= billFormData.items.length) {\r\n        console.error(`Invalid rowIndex: ${rowIndex}. Items length: ${billFormData.items.length}`);\r\n        message.error(`Invalid row index: ${rowIndex}. Please try again.`);\r\n        return;\r\n      }\r\n\r\n      const newItems = [...billFormData.items];\r\n      \r\n      // Double-check the item exists before modifying\r\n      if (!newItems[rowIndex]) {\r\n        console.error(`Item at index ${rowIndex} is undefined. Items length: ${newItems.length}`);\r\n        message.error('Selected row is no longer valid. Please try again.');\r\n        return;\r\n      }\r\n\r\n      // Robustly set product_id from product.id or product._id\r\n      newItems[rowIndex].product_id = product.id || product._id || '';\r\n      newItems[rowIndex].product_name = product.name || '';\r\n      newItems[rowIndex].price = product.selling_price || 0;\r\n      handleItemsChange(newItems);\r\n      setStockModalRowIndex(rowIndex); // Open stock modal for this row\r\n    },\r\n    [handleItemsChange, billFormData.items.length]\r\n  );\r\n\r\n  const handleF5ProductSelection = () => {\r\n    // First, check if stock modal is open and close it\r\n    if (stockModalRowIndex !== null) {\r\n      setStockModalRowIndex(null);\r\n      message.info('Stock modal closed. Opening product selection...');\r\n\r\n      // Wait a bit for the stock modal to close before opening product modal\r\n      setTimeout(() => {\r\n        openProductModalForRow();\r\n      }, 100);\r\n      return;\r\n    }\r\n\r\n    // If stock modal is not open, proceed with normal F5 behavior\r\n    openProductModalForRow();\r\n  };\r\n\r\n  const openProductModalForRow = () => {\r\n    let targetRowIndex = -1;\r\n\r\n    // Check what element is currently focused\r\n    const activeElement = document.activeElement as HTMLElement;\r\n\r\n    // First, check if there's a currently focused row in the table\r\n    const focusedRow = activeElement?.closest('tr');\r\n\r\n    if (focusedRow) {\r\n      const rowIndex = focusedRow.getAttribute('data-row-key');\r\n\r\n      if (rowIndex !== null) {\r\n        targetRowIndex = parseInt(rowIndex);\r\n      }\r\n    } else {\r\n      // Try alternative method: look for any focused cell in the table\r\n      const focusedCell = activeElement?.closest('td');\r\n      if (focusedCell) {\r\n        const row = focusedCell.closest('tr');\r\n        if (row) {\r\n          const rowIndex = row.getAttribute('data-row-key');\r\n          if (rowIndex !== null) {\r\n            targetRowIndex = parseInt(rowIndex);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // If no focused row found, try using the externally editing cell row\r\n    if (targetRowIndex === -1 && externalEditingCell) {\r\n      targetRowIndex = externalEditingCell.row;\r\n    }\r\n\r\n    // If still no target, try using the last interacted row\r\n    if (targetRowIndex === -1) {\r\n      if (lastInteractedRowIndex < billFormData.items.length) {\r\n        targetRowIndex = lastInteractedRowIndex;\r\n      }\r\n    }\r\n\r\n    // If still no target, find the first row without a product\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(item => !item.product_id);\r\n    }\r\n\r\n    // If still no target row, add a new item and target that\r\n    if (targetRowIndex === -1) {\r\n      handleAddItem();\r\n      targetRowIndex = billFormData.items.length;\r\n    }\r\n\r\n    // Set the target row for product selection\r\n    setProductSelectionRowIndex(targetRowIndex);\r\n    setProductSelectionModalVisible(true);\r\n\r\n    message.info(`Opening product selection for row ${targetRowIndex + 1}`);\r\n  };\r\n\r\n  // Helper function to auto-open product modal (used after bill creation)\r\n  const autoOpenProductModal = useCallback(() => {\r\n    setProductSelectionRowIndex(0); // Target the first row\r\n    setProductSelectionModalVisible(true);\r\n    message.success(\r\n      ' Bill saved! Ready for next bill - Select product to continue.',\r\n      4\r\n    );\r\n  }, []);\r\n\r\n  const handleF7StockSelection = () => {\r\n    // Find the first row that has a product but needs stock or the currently focused row\r\n    let targetRowIndex = -1;\r\n\r\n    // First, check if there's a currently focused row in the table\r\n    const activeElement = document.activeElement as HTMLElement;\r\n    const focusedRow = activeElement?.closest('tr');\r\n    if (focusedRow) {\r\n      const rowIndex = focusedRow.getAttribute('data-row-key');\r\n      if (rowIndex !== null) {\r\n        const rowIndexNum = parseInt(rowIndex);\r\n        // Check if the focused row has a product\r\n        if (billFormData.items[rowIndexNum]?.product_id) {\r\n          targetRowIndex = rowIndexNum;\r\n        }\r\n      }\r\n    }\r\n\r\n    // If no focused row with product found, find the first row with product but without stock\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(\r\n        item => item.product_id && !item.stock_id\r\n      );\r\n    }\r\n\r\n    // If still no target row, find the first row with product (even if it has stock)\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(item => item.product_id);\r\n    }\r\n\r\n    // If no row with product found, show message\r\n    if (targetRowIndex === -1) {\r\n      message.warning('Please select a product first before selecting stock');\r\n      return;\r\n    }\r\n\r\n    // Set the target row for stock selection\r\n    setStockModalRowIndex(targetRowIndex);\r\n\r\n    message.info(`Opening stock selection for row ${targetRowIndex + 1}`);\r\n  };\r\n\r\n  const handleProductSelectionModalSelect = (product: any) => {\r\n    if (productSelectionRowIndex === null) return;\r\n\r\n    // Validate productSelectionRowIndex bounds\r\n    if (productSelectionRowIndex < 0 || productSelectionRowIndex >= billFormData.items.length) {\r\n      console.error(`Invalid productSelectionRowIndex: ${productSelectionRowIndex}. Items length: ${billFormData.items.length}`);\r\n      message.error(`Invalid row index: ${productSelectionRowIndex}. Please try again.`);\r\n      setProductSelectionRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    const newItems = [...billFormData.items];\r\n    \r\n    // Double-check the item exists before modifying\r\n    if (!newItems[productSelectionRowIndex]) {\r\n      console.error(`Item at index ${productSelectionRowIndex} is undefined. Items length: ${newItems.length}`);\r\n      message.error('Selected row is no longer valid. Please try again.');\r\n      setProductSelectionRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    newItems[productSelectionRowIndex].product_id = product._id || '';\r\n    newItems[productSelectionRowIndex].product_name = product.name || '';\r\n    newItems[productSelectionRowIndex].variant_name =\r\n      product.VariantItem?.variant_name || '';\r\n    newItems[productSelectionRowIndex].price = product.selling_price || 0;\r\n\r\n    handleItemsChange(newItems);\r\n\r\n    // Close the product selection modal\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n\r\n    // Open stock selection modal for this row\r\n    setStockModalRowIndex(productSelectionRowIndex);\r\n\r\n    message.success(`Product \"${product.name}\" selected successfully!`);\r\n  };\r\n\r\n  const handleStockSelect = (stock: any) => {\r\n    if (stockModalRowIndex === null) return;\r\n    \r\n    // Validate stockModalRowIndex bounds\r\n    if (stockModalRowIndex < 0 || stockModalRowIndex >= billFormData.items.length) {\r\n      console.error(`Invalid stockModalRowIndex: ${stockModalRowIndex}. Items length: ${billFormData.items.length}`);\r\n      message.error(`Invalid row index: ${stockModalRowIndex}. Please try again.`);\r\n      setStockModalRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    const newItems = [...billFormData.items];\r\n    \r\n    // Double-check the item exists before modifying\r\n    if (!newItems[stockModalRowIndex]) {\r\n      console.error(`Item at index ${stockModalRowIndex} is undefined. Items length: ${newItems.length}`);\r\n      message.error('Selected row is no longer valid. Please try again.');\r\n      setStockModalRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    newItems[stockModalRowIndex].stock_id =\r\n      stock.id || stock._id || stock.invoice_id || '';\r\n    newItems[stockModalRowIndex].batch_no = stock.batch_no || '';\r\n    handleItemsChange(newItems);\r\n    setStockModalRowIndex(null); // Close stock modal\r\n\r\n    // Set external editing cell to qty cell in the same row\r\n    if (qtyColIndex !== -1) {\r\n      setExternalEditingCell({ row: stockModalRowIndex, col: qtyColIndex });\r\n    }\r\n  };\r\n\r\n  // Handle customer selection from modal\r\n  const handleCustomerSelect = useCallback(\r\n    (customer: any) => {\r\n      // Prevent duplicate calls\r\n      if (billFormData.customer_id === customer._id) {\r\n        return;\r\n      }\r\n\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        customer_id: customer._id,\r\n        customer_name: customer.full_name,\r\n      }));\r\n\r\n      // Ensure modal closes\r\n      setTimeout(() => {\r\n        setCustomerModalVisible(false);\r\n        // Auto-open user selection modal after customer is selected\r\n        setTimeout(() => {\r\n          setUserModalVisible(true);\r\n        }, 100);\r\n      }, 50);\r\n\r\n      message.success(\r\n        `Customer \"${customer.full_name}\" selected successfully!`\r\n      );\r\n    },\r\n    [billFormData.customer_id]\r\n  );\r\n\r\n  // Handle user selection from modal\r\n  const handleUserSelect = useCallback(\r\n    (user: any) => {\r\n      // Prevent duplicate calls\r\n      if (billFormData.billed_by_id === user._id) {\r\n        return;\r\n      }\r\n\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        billed_by_id: user._id,\r\n        billed_by_name: user.name,\r\n      }));\r\n\r\n      // Ensure modal closes\r\n      setTimeout(() => {\r\n        setUserModalVisible(false);\r\n      }, 50);\r\n\r\n      message.success(\r\n        `User \"${user.name}\" selected as billed by successfully!`\r\n      );\r\n    },\r\n    [billFormData.billed_by_id]\r\n  );\r\n\r\n  // Handle new bill creation\r\n  const handleNewBill = () => {\r\n    resetBill(false); // Don't show resetBill message\r\n    setSaveConfirmationVisible(false);\r\n    setSavedBillData(null);\r\n    message.success('New bill form cleared successfully!');\r\n  };\r\n\r\n  // Reset bill function - comprehensive reset for after successful save\r\n  const resetBill = useCallback((showMessage = true) => {\r\n    // Clear all form data for new bill\r\n    setBillFormData({\r\n      invoice_no: '',\r\n      date: dayjs().format('YYYY-MM-DD'),\r\n      customer_id: '',\r\n      customer_name: '',\r\n      payment_mode: 'cash',\r\n      items: [\r\n        {\r\n          product_id: '',\r\n          product_name: '',\r\n          variant_name: '',\r\n          stock_id: '',\r\n          batch_no: '',\r\n          qty: 0,\r\n          loose_qty: 0,\r\n          price: 0,\r\n          mrp: 0,\r\n          amount: 0,\r\n          tax_percentage: 0,\r\n        },\r\n      ],\r\n    });\r\n\r\n    // Reset bill settings to defaults\r\n    setBillSettings({\r\n      isPaid: true,\r\n      isPartiallyPaid: false,\r\n      isRetail: true,\r\n      isGstIncluded: true,\r\n      discount: 0,\r\n      discountType: 'percentage',\r\n      paidAmount: 0,\r\n    });\r\n\r\n    // Reset all modal states\r\n    setStockModalRowIndex(null);\r\n    setExternalEditingCell(null);\r\n    setCustomerModalVisible(false);\r\n    setSaveConfirmationVisible(false);\r\n    setBillListDrawerVisible(false);\r\n    setSavedBillData(null);\r\n    setProductDetailsModalVisible(false);\r\n    setSelectedProductId('');\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n    refetchInvoiceNo();\r\n    // Only show message if explicitly requested (not during auto-reset after bill creation)\r\n    if (showMessage) {\r\n      message.success('Ready for next bill!', 2);\r\n    }\r\n  }, []);\r\n\r\n  // Handle continue with current bill\r\n  const handleContinueBill = () => {\r\n    setSaveConfirmationVisible(false);\r\n    setSavedBillData(null);\r\n  };\r\n\r\n  // Handle clear bill form\r\n  const handleClearBill = () => {\r\n    resetBill(false); // Don't show resetBill message\r\n    message.success('Bill form cleared successfully!');\r\n  };\r\n\r\n  // Handle view bill from drawer\r\n  const handleViewBill = (bill: any) => {\r\n    if (!bill) {\r\n      message.error('No bill data received');\r\n      return;\r\n    }\r\n\r\n    // Ensure we have the latest data loaded\r\n    refetchProducts();\r\n    refetchCustomers();\r\n    if (branchId) {\r\n      refetchBranchStock();\r\n    } else {\r\n      refetchStockAudit();\r\n    }\r\n\r\n    // Force immediate data loading if not already loaded\r\n    if (productListResult.length === 0) {\r\n      refetchProducts();\r\n    }\r\n\r\n    if (customerListResult.length === 0) {\r\n      refetchCustomers();\r\n    }\r\n\r\n    const currentStockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n    if (currentStockListData.length === 0) {\r\n      if (branchId) {\r\n        refetchBranchStock();\r\n      } else {\r\n        refetchStockAudit();\r\n      }\r\n    }\r\n\r\n    // Handle different possible data structures for items\r\n    let items = [];\r\n    if (bill.Items && Array.isArray(bill.Items)) {\r\n      items = bill.Items;\r\n    } else if (bill.items && Array.isArray(bill.items)) {\r\n      items = bill.items;\r\n    } else if (bill.sales_items && Array.isArray(bill.sales_items)) {\r\n      items = bill.sales_items;\r\n    } else if (\r\n      bill.result &&\r\n      bill.result.Items &&\r\n      Array.isArray(bill.result.Items)\r\n    ) {\r\n      items = bill.result.Items;\r\n    } else if (\r\n      bill.result &&\r\n      bill.result.items &&\r\n      Array.isArray(bill.result.items)\r\n    ) {\r\n      items = bill.result.items;\r\n    }\r\n\r\n    // Map items with proper fallbacks and enhanced product name resolution\r\n    const mappedItems = items.map((item: any, index: number) => {\r\n      // Try to get the best product name from various sources\r\n      let productName = '';\r\n      let variantName = '';\r\n\r\n      if (item.productItems?.name) {\r\n        productName = item.productItems.name;\r\n        variantName = item.productItems.VariantItem?.variant_name || '';\r\n      } else if (item.product_name) {\r\n        productName = item.product_name;\r\n        variantName = item.variant_name || '';\r\n      } else if (item.product?.name) {\r\n        productName = item.product.name;\r\n        variantName = item.product.VariantItem?.variant_name || '';\r\n      } else if (item.product_id) {\r\n        // Try to find product name from productList if available\r\n        const product = productListResult.find(\r\n          (p: any) => p._id === item.product_id\r\n        );\r\n        if (product) {\r\n          productName = product.name;\r\n          variantName = product.VariantItem?.variant_name || '';\r\n        } else {\r\n          // If product list is not loaded yet, try to load it and mark for later update\r\n          if (productListResult.length === 0) {\r\n            refetchProducts();\r\n          }\r\n          // Use a more descriptive placeholder that will be updated later\r\n          productName = `Loading... (ID: ${item.product_id})`;\r\n\r\n          // Try to force load and resolve immediately\r\n          setTimeout(() => {\r\n            if (productListResult.length > 0) {\r\n              const foundProduct = productListResult.find(\r\n                (p: any) => p._id === item.product_id\r\n              );\r\n              if (foundProduct) {\r\n                // Update the item directly\r\n                const updatedItems = [...billFormData.items];\r\n                const itemIndex = updatedItems.findIndex(\r\n                  i => i.product_id === item.product_id\r\n                );\r\n                if (itemIndex !== -1) {\r\n                  updatedItems[itemIndex].product_name = foundProduct.name;\r\n                  updatedItems[itemIndex].variant_name =\r\n                    foundProduct.VariantItem?.variant_name || '';\r\n                  setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n                }\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n      }\r\n\r\n      // Handle stock information with proper fallbacks\r\n      let stockId = '';\r\n      let batchNo = '';\r\n\r\n      if (item.stock_id) {\r\n        stockId = item.stock_id;\r\n        batchNo = item.batch_no || '';\r\n      } else if (item.branch_stock_id) {\r\n        stockId = item.branch_stock_id;\r\n        batchNo = item.batch_no || '';\r\n      } else if (item.stock) {\r\n        stockId = item.stock;\r\n        batchNo = item.batch_no || '';\r\n      }\r\n\r\n      // If we have stock_id but no batch_no, try to find it from stock list\r\n      if (stockId && !batchNo) {\r\n        const stockList = branchId ? branchStockList : stockAuditList;\r\n        const stock = stockList?.result?.find((s: any) => s._id === stockId);\r\n        if (stock) {\r\n          batchNo = stock.batch_no || '';\r\n        } else {\r\n          // If stock list is not loaded yet, mark for later update\r\n          if (!stockList?.result) {\r\n            if (branchId) {\r\n              refetchBranchStock();\r\n            } else {\r\n              refetchStockAudit();\r\n            }\r\n          }\r\n          batchNo = `Loading... (Stock: ${stockId})`;\r\n\r\n          // Try to force load and resolve immediately\r\n          setTimeout(() => {\r\n            const currentStockList = branchId\r\n              ? branchStockList\r\n              : stockAuditList;\r\n            if (currentStockList?.result) {\r\n              const foundStock = currentStockList.result.find(\r\n                (s: any) => s._id === stockId\r\n              );\r\n              if (foundStock) {\r\n                // Update the item directly\r\n                const updatedItems = [...billFormData.items];\r\n                const itemIndex = updatedItems.findIndex(\r\n                  i => i.stock_id === stockId\r\n                );\r\n                if (itemIndex !== -1) {\r\n                  updatedItems[itemIndex].batch_no = foundStock.batch_no || '';\r\n                  setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n                }\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n      }\r\n\r\n      const mappedItem = {\r\n        _id: item._id || '',\r\n        product_id: item.product_id || item.product || '',\r\n        product_name: productName,\r\n        variant_name: variantName,\r\n        stock_id: stockId,\r\n        batch_no: batchNo,\r\n        qty: item.qty || 0,\r\n        loose_qty: item.loose_qty || 0,\r\n        price: item.price || 0,\r\n        mrp: item.mrp || item.price || 0,\r\n        amount: item.amount || 0,\r\n        tax_percentage: item.tax_percentage || 0,\r\n      };\r\n\r\n      return mappedItem;\r\n    });\r\n\r\n    // Handle customer information with fallbacks\r\n    const customerId = bill.customer_id || '';\r\n    let customerName = '';\r\n\r\n    if (bill.customerDetails?.full_name) {\r\n      customerName = bill.customerDetails.full_name;\r\n    } else if (bill.customer_name) {\r\n      customerName = bill.customer_name;\r\n    } else if (bill.customer?.full_name) {\r\n      customerName = bill.customer.full_name;\r\n    } else if (bill.customer_id) {\r\n      // Try to find customer name from customerList if available\r\n      const customer = customerList?.result?.find(\r\n        (c: any) => c._id === bill.customer_id\r\n      );\r\n      customerName = customer?.full_name || `Customer ID: ${bill.customer_id}`;\r\n    }\r\n\r\n    // Handle date with fallback\r\n    let formattedDate = dayjs().format('YYYY-MM-DD'); // Default to today\r\n    if (bill.date) {\r\n      try {\r\n        formattedDate = dayjs(bill.date).format('YYYY-MM-DD');\r\n      } catch (error) {\r\n        formattedDate = dayjs().format('YYYY-MM-DD');\r\n      }\r\n    }\r\n\r\n    // Immediately resolve any available product names and stock info if data is already loaded\r\n    let finalMappedItems = [...mappedItems];\r\n\r\n    // If product list is already loaded, resolve product names immediately\r\n    if (productListResult.length > 0) {\r\n      finalMappedItems = finalMappedItems.map(item => {\r\n        if (\r\n          item.product_id &&\r\n          (item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:'))\r\n        ) {\r\n          const product = productListResult.find(\r\n            (p: any) => p._id === item.product_id\r\n          );\r\n          if (product) {\r\n            return {\r\n              ...item,\r\n              product_name: product.name,\r\n              variant_name: product.VariantItem?.variant_name || '',\r\n            };\r\n          }\r\n        }\r\n        return item;\r\n      });\r\n    }\r\n\r\n    // If stock list is already loaded, resolve batch numbers immediately\r\n    const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n    if (stockListData.length > 0) {\r\n      finalMappedItems = finalMappedItems.map(item => {\r\n        if (\r\n          item.stock_id &&\r\n          (item.batch_no.includes('Loading...') || !item.batch_no)\r\n        ) {\r\n          const stock = stockListData.find(\r\n            (s: any) => s._id === item.stock_id\r\n          );\r\n          if (stock) {\r\n            return {\r\n              ...item,\r\n              batch_no: stock.batch_no || '',\r\n            };\r\n          }\r\n        }\r\n        return item;\r\n      });\r\n    }\r\n\r\n    // Load bill data into form with resolved items\r\n    setBillFormData({\r\n      invoice_no: bill.invoice_no || '',\r\n      date: formattedDate,\r\n      customer_id: customerId,\r\n      customer_name: customerName,\r\n      payment_mode: bill.payment_mode || 'cash',\r\n      items: finalMappedItems,\r\n    });\r\n\r\n    // Load bill settings with proper fallbacks\r\n    setBillSettings({\r\n      isPaid: bill.is_paid ?? true,\r\n      isPartiallyPaid: bill.is_partially_paid ?? false,\r\n      isRetail: bill.sale_type === 'retail' || bill.sale_type === undefined,\r\n      isGstIncluded: bill.is_gst_included ?? true,\r\n      discount: bill.discount || 0,\r\n      discountType: bill.discount_type || 'percentage',\r\n      paidAmount: bill.paid_amount || 0,\r\n    });\r\n\r\n    // Show success message\r\n    message.success(`Bill \"${bill.invoice_no}\" loaded successfully!`);\r\n\r\n    // Force immediate resolution after a short delay to catch any data that loads asynchronously\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 100);\r\n\r\n    // Add a more aggressive resolution approach\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 500);\r\n\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 1000);\r\n  };\r\n\r\n  // Force resolve product names and stock information\r\n  const forceResolveProductNamesAndStock = () => {\r\n    if (billFormData.items.length === 0) return;\r\n\r\n    let hasChanges = false;\r\n    const updatedItems = billFormData.items.map(item => {\r\n      let updated = false;\r\n\r\n      // Resolve product names\r\n      if (item.product_id && productListResult.length > 0) {\r\n        const product = productListResult.find(\r\n          (p: any) => p._id === item.product_id\r\n        );\r\n        if (\r\n          product &&\r\n          (item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:') ||\r\n            !item.product_name)\r\n        ) {\r\n          item.product_name = product.name;\r\n          item.variant_name = product.VariantItem?.variant_name || '';\r\n          updated = true;\r\n        }\r\n      }\r\n\r\n      // Resolve stock batch numbers\r\n      if (item.stock_id) {\r\n        const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n        if (stockListData.length > 0) {\r\n          const stock = stockListData.find(\r\n            (s: any) => s._id === item.stock_id\r\n          );\r\n          if (\r\n            stock &&\r\n            (item.batch_no?.includes('Loading...') || !item.batch_no)\r\n          ) {\r\n            item.batch_no = stock.batch_no || '';\r\n            updated = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (updated) hasChanges = true;\r\n      return item;\r\n    });\r\n\r\n    if (hasChanges) {\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        items: updatedItems,\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Handle item addition\r\n  const handleAddItem = () => {\r\n    const newItem: BillItem = {\r\n      product_id: '',\r\n      product_name: '',\r\n      variant_name: '',\r\n      stock_id: '',\r\n      batch_no: '',\r\n      qty: 0,\r\n      loose_qty: 0,\r\n      price: 0,\r\n      mrp: 0,\r\n      amount: 0,\r\n      tax_percentage: 0,\r\n    };\r\n\r\n    setBillFormData(prev => ({\r\n      ...prev,\r\n      items: [...prev.items, newItem],\r\n    }));\r\n  };\r\n\r\n  // Handle item deletion\r\n  const handleDeleteItems = (indices: number[]) => {\r\n    setBillFormData(prev => {\r\n      const newItems = prev.items.filter(\r\n        (_, index: any) => !indices.includes(index?.toString())\r\n      );\r\n      return {\r\n        ...prev,\r\n        items: newItems,\r\n      };\r\n    });\r\n  };\r\n\r\n  // Handle final save\r\n  const handleSaveBill = async () => {\r\n    // Validation\r\n    if (\r\n      !billFormData.invoice_no ||\r\n      !billFormData.customer_id ||\r\n      !billFormData.items.length\r\n    ) {\r\n      message.error('Please fill all required fields');\r\n      return;\r\n    }\r\n\r\n    // Check for incomplete items\r\n    const incompleteItems = billFormData.items.some(\r\n      item =>\r\n        !item.product_id ||\r\n        !item.stock_id ||\r\n        (!item.qty && !item.loose_qty) ||\r\n        !item.price\r\n    );\r\n\r\n    if (incompleteItems) {\r\n      message.error('Please complete all item details');\r\n      return;\r\n    }\r\n\r\n    // Validate that entered quantities don't exceed available stock\r\n    const stockValidationErrors: string[] = [];\r\n    billFormData.items.forEach((item, index) => {\r\n      if (item.stock_id && (item.qty || item.loose_qty)) {\r\n        const validation = validateStockQuantity(\r\n          item.stock_id,\r\n          item.qty || 0,\r\n          item.loose_qty || 0\r\n        );\r\n\r\n        if (!validation.isValid) {\r\n          stockValidationErrors.push(`Row ${index + 1}: ${validation.message}`);\r\n        }\r\n      }\r\n    });\r\n\r\n    if (stockValidationErrors.length > 0) {\r\n      message.error(\r\n        `Stock validation errors:\\n${stockValidationErrors.join('\\n')}`\r\n      );\r\n      return;\r\n    }\r\n    if (!billFormData.customer_id) {\r\n      message.error('Please select a customer');\r\n      return;\r\n    }\r\n    if (!billFormData.payment_mode) {\r\n      message.error('Please select a payment mode');\r\n      return;\r\n    }\r\n\r\n    const payload = {\r\n      invoice_no: billFormData.invoice_no,\r\n      date: billFormData.date,\r\n      customer_id: billFormData.customer_id,\r\n      billed_by_id: billFormData.billed_by_id,\r\n      payment_mode: billFormData.payment_mode,\r\n      items: billFormData.items.map(item => ({\r\n        product_id: item.product_id,\r\n        stock_id: item.stock_id,\r\n        ...(branchId && { branch_stock_id: item.stock_id }),\r\n        qty: item.qty,\r\n        loose_qty: item.loose_qty,\r\n        price: item.price,\r\n        mrp: item.mrp,\r\n        amount: item.amount,\r\n        tax_percentage: item.tax_percentage,\r\n        _id: item._id,\r\n      })),\r\n      ...billCalculations,\r\n      discount: billSettings.discount,\r\n      discount_type: billSettings.discountType,\r\n      is_paid: billSettings.isPaid,\r\n      is_partially_paid: billSettings.isPartiallyPaid,\r\n      sale_type: billSettings.isRetail ? 'retail' : 'wholesale',\r\n      is_gst_included: billSettings.isGstIncluded,\r\n      paid_amount: billSettings.isPartiallyPaid\r\n        ? billSettings.paidAmount\r\n        : billSettings.isPaid\r\n          ? billCalculations.total_amount\r\n          : 0,\r\n    };\r\n\r\n    try {\r\n      let response: any;\r\n      if (billdata) {\r\n        const result = await updateSalesRecord(billdata._id, payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setUpdateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      } else {\r\n        const result = await createSalesRecord(payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setCreateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      }\r\n\r\n      // Show confirmation modal after successful save (only for updates, not new bills)\r\n      if (response?.statusCode === 200) {\r\n        const savedData = {\r\n          ...payload,\r\n          customer_name: billFormData.customer_name,\r\n          total_amount: billCalculations.total_amount,\r\n          invoice_no: payload.invoice_no,\r\n          date: payload.date,\r\n        };\r\n        setSavedBillData(savedData);\r\n\r\n        // Only show confirmation modal for bill updates, not new bills (they auto-reset)\r\n        if (billdata) {\r\n          setSaveConfirmationVisible(true);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      // Handle error silently or show user-friendly message\r\n      message.error('Failed to save bill. Please try again.');\r\n    }\r\n  };\r\n\r\n  // Handle create success\r\n  useEffect(() => {\r\n    if (createResponse?.statusCode === 200) {\r\n      onSuccess?.();\r\n      createInvoiceNumber({});\r\n      // Auto-reset the bill after successful creation (only for new bills, not updates)\r\n      if (!billdata) {\r\n        // Close confirmation modal first, then reset immediately\r\n        setSaveConfirmationVisible(false);\r\n        setTimeout(() => {\r\n          resetBill(false); // Don't show \"Ready for next bill!\" message\r\n\r\n          // Auto-open product selection modal for the first row after reset\r\n          setTimeout(() => {\r\n            autoOpenProductModal();\r\n          }, 200); // Wait for reset to complete\r\n        }, 100); // Minimal delay just to close modal smoothly\r\n      }\r\n      setCreateResponse(null); // Clear response\r\n    }\r\n  }, [createResponse, billdata, resetBill, onSuccess, autoOpenProductModal, createInvoiceNumber]);\r\n\r\n  // Handle update success\r\n  useEffect(() => {\r\n    if (updateResponse?.statusCode === 200) {\r\n      onSuccess?.();\r\n      setUpdateResponse(null); // Clear response\r\n    }\r\n  }, [updateResponse, onSuccess]);\r\n\r\n  // Update product names when product list is loaded (for bill viewing)\r\n  useEffect(() => {\r\n    if (productListResult.length > 0 && billFormData.items.length > 0) {\r\n      // Check if any items have product_id but no product_name or have placeholder text\r\n      const needsUpdate = billFormData.items.some(\r\n        item =>\r\n          item.product_id &&\r\n          (!item.product_name ||\r\n            item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:'))\r\n      );\r\n\r\n      if (needsUpdate) {\r\n        const updatedItems = billFormData.items.map(item => {\r\n          if (\r\n            item.product_id &&\r\n            (!item.product_name ||\r\n              item.product_name.includes('Loading...') ||\r\n              item.product_name.includes('Product ID:'))\r\n          ) {\r\n            const product = productListResult.find(\r\n              (p: any) => p._id === item.product_id\r\n            );\r\n            if (product) {\r\n              return {\r\n                ...item,\r\n                product_name: product.name,\r\n                variant_name: product.VariantItem?.variant_name || '',\r\n              };\r\n            }\r\n          }\r\n          return item;\r\n        });\r\n\r\n        // Only update if we actually made changes\r\n        const hasChanges = updatedItems.some(\r\n          (item, index) =>\r\n            item.product_name !== billFormData.items[index].product_name\r\n        );\r\n\r\n        if (hasChanges) {\r\n          setBillFormData(prev => ({\r\n            ...prev,\r\n            items: updatedItems,\r\n          }));\r\n        }\r\n      }\r\n    }\r\n  }, [productListResult, billFormData.items]);\r\n\r\n  // Force resolve product names when product list changes\r\n  useEffect(() => {\r\n    if (productListResult.length > 0 && billFormData.items.length > 0) {\r\n      // Force resolve any remaining unresolved product names\r\n      setTimeout(() => {\r\n        forceResolveProductNamesAndStock();\r\n      }, 200);\r\n    }\r\n  }, [productListResult, billFormData.items]);\r\n\r\n  // Update stock information when stock list is loaded (for bill viewing)\r\n  useEffect(() => {\r\n    const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n    if (stockListData.length > 0 && billFormData.items.length > 0) {\r\n      // Check if any items have stock_id but no batch_no or have placeholder text\r\n      const needsUpdate = billFormData.items.some(\r\n        item =>\r\n          item.stock_id &&\r\n          (!item.batch_no || item.batch_no.includes('Loading...'))\r\n      );\r\n\r\n      if (needsUpdate) {\r\n        const updatedItems = billFormData.items.map(item => {\r\n          if (\r\n            item.stock_id &&\r\n            (!item.batch_no || item.batch_no.includes('Loading...'))\r\n          ) {\r\n            const stock = stockListData.find(\r\n              (s: any) => s._id === item.stock_id\r\n            );\r\n            if (stock) {\r\n              return {\r\n                ...item,\r\n                batch_no: stock.batch_no || '',\r\n              };\r\n            }\r\n          }\r\n          return item;\r\n        });\r\n\r\n        // Only update if we actually made changes\r\n        const hasChanges = updatedItems.some(\r\n          (item, index) => item.batch_no !== billFormData.items[index].batch_no\r\n        );\r\n\r\n        if (hasChanges) {\r\n          setBillFormData(prev => ({\r\n            ...prev,\r\n            items: updatedItems,\r\n          }));\r\n        }\r\n      }\r\n    }\r\n  }, [branchStockListResult, stockAuditListResult, billFormData.items, branchId]);\r\n\r\n  // Force resolve stock information when stock list changes\r\n  useEffect(() => {\r\n    const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n    if (stockListData.length > 0 && billFormData.items.length > 0) {\r\n      // Force resolve any remaining unresolved stock information\r\n      setTimeout(() => {\r\n        forceResolveProductNamesAndStock();\r\n      }, 200);\r\n    }\r\n  }, [branchStockListResult, stockAuditListResult, billFormData.items, branchId]);\r\n\r\n  // Periodic check to resolve any remaining unresolved data\r\n  useEffect(() => {\r\n    if (billFormData.items.length > 0) {\r\n      const interval = setInterval(() => {\r\n        const hasUnresolvedItems = billFormData.items.some(\r\n          item =>\r\n            (item.product_id &&\r\n              (!item.product_name ||\r\n                item.product_name.includes('Loading...') ||\r\n                item.product_name.includes('Product ID:'))) ||\r\n            (item.stock_id &&\r\n              (!item.batch_no || item.batch_no.includes('Loading...')))\r\n        );\r\n\r\n        if (\r\n          hasUnresolvedItems &&\r\n          (productListResult.length > 0 ||\r\n            (branchId ? branchStockListResult.length > 0 : stockAuditListResult.length > 0))\r\n        ) {\r\n          forceResolveProductNamesAndStock();\r\n        }\r\n      }, 1000); // Check every second\r\n\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [\r\n    billFormData.items,\r\n    productListResult,\r\n    branchStockListResult,\r\n    stockAuditListResult,\r\n    branchId,\r\n  ]);\r\n\r\n  // Ultra-Fast Billing Keyboard Shortcuts\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // F1: Add item and focus first product field\r\n      if (e.key === 'F1') {\r\n        e.preventDefault();\r\n        handleAddItem();\r\n        setTimeout(() => {\r\n          const productCell = document.querySelector(\r\n            '.ant-table-tbody tr:last-child td[data-column-key=\"product_id\"]'\r\n          ) as HTMLElement;\r\n          productCell?.focus();\r\n        }, 200);\r\n      }\r\n      // F2: Save bill\r\n      else if (e.key === 'F2') {\r\n        e.preventDefault();\r\n        handleSaveBill();\r\n      }\r\n      // F3: Print bill\r\n      else if (e.key === 'F3') {\r\n        e.preventDefault();\r\n        // TODO: Implement print functionality\r\n        message.info('Print functionality coming soon!');\r\n      }\r\n      // F4: Clear bill form\r\n      else if (e.key === 'F4') {\r\n        e.preventDefault();\r\n        handleClearBill();\r\n      }\r\n      // F5: Open product selection modal for current row or first empty row\r\n      else if (e.key === 'F5') {\r\n        e.preventDefault();\r\n        handleF5ProductSelection();\r\n      }\r\n      // End: Open customer selection modal\r\n      else if (e.key === 'End') {\r\n        e.preventDefault();\r\n        setCustomerModalVisible(true);\r\n      }\r\n      // F6: Open bill list drawer\r\n      else if (e.key === 'F6') {\r\n        e.preventDefault();\r\n        setBillListDrawerVisible(true);\r\n      }\r\n      // F7: Open stock selection modal for current row or first row with product\r\n      else if (e.key === 'F7') {\r\n        e.preventDefault();\r\n        handleF7StockSelection();\r\n      }\r\n\r\n      // Ctrl shortcuts\r\n      else if (e.ctrlKey) {\r\n        switch (e.key) {\r\n          case 's':\r\n            e.preventDefault();\r\n            handleSaveBill();\r\n            break;\r\n          case 'n':\r\n            e.preventDefault();\r\n            handleAddItem();\r\n            setTimeout(() => {\r\n              const productCell = document.querySelector(\r\n                '.ant-table-tbody tr:last-child td[data-column-key=\"product_id\"]'\r\n              ) as HTMLElement;\r\n              productCell?.focus();\r\n            }, 200);\r\n            break;\r\n          case 'p':\r\n            e.preventDefault();\r\n            // TODO: Implement print functionality\r\n            message.info('Print functionality coming soon!');\r\n            break;\r\n          case 'r':\r\n            e.preventDefault();\r\n            // Reset form completely\r\n            resetBill(); // Show message for manual reset via keyboard\r\n            break;\r\n          case 'u':\r\n            e.preventDefault();\r\n            setUserModalVisible(true);\r\n            break;\r\n        }\r\n      }\r\n      // Quick quantity entry (Ctrl + 0-9)\r\n      else if (e.ctrlKey && /^[0-9]$/.test(e.key)) {\r\n        e.preventDefault();\r\n        const activeElement = document.activeElement as HTMLElement;\r\n        if (activeElement?.closest('td[data-column-key=\"qty\"]')) {\r\n          const input = activeElement.querySelector(\r\n            'input'\r\n          ) as HTMLInputElement;\r\n          if (input) {\r\n            input.value = e.key;\r\n            input.dispatchEvent(new Event('change', { bubbles: true }));\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, [\r\n    billFormData,\r\n    billSettings,\r\n    handleF5ProductSelection,\r\n    handleF7StockSelection,\r\n    stockModalRowIndex,\r\n  ]);\r\n\r\n  return (\r\n    <div className={styles.mainContainer}>\r\n      {/* Background Half Circles */}\r\n      <div className={styles.backgroundCircle1} />\r\n      <div className={styles.backgroundCircle2} />\r\n      <div className={styles.backgroundCircle3} />\r\n      <div className={styles.backgroundCircle4} />\r\n      <div className={styles.backgroundCircle5} />\r\n      {/* Ultra-Fast Billing Header */}\r\n      <div className={styles.headerContainer}>\r\n        {/* Animated decorative background elements */}\r\n        <div className={styles.headerCircle1} />\r\n        <div className={styles.headerCircle2} />\r\n        <div className={styles.headerCircle3} />\r\n        <div className={styles.headerCircle4} />\r\n        <div className={styles.headerCircle5} />\r\n\r\n        <div className={styles.headerContent}>\r\n          {/* Title Section */}\r\n          <div className={styles.titleSection}>\r\n            <div className={styles.titleIcon}>\r\n              <FileTextOutlined style={{ fontSize: '24px', color: 'white' }} />\r\n            </div>\r\n            <div>\r\n              <Title level={4} className={styles.titleText}>\r\n                {billdata ? ' EDIT INVOICE' : ' NEW INVOICE'}\r\n              </Title>\r\n              <Text className={styles.subtitleText}>\r\n                Lightning Fast  {dayjs().format('DD MMM YYYY, dddd')}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Controls Section */}\r\n          <div className={styles.controlsSection}>\r\n            <div className={`${styles.controlGroup} ${styles.saleTypeControl}`}>\r\n              <Text className={styles.controlLabel}> SALE TYPE</Text>\r\n              <Switch\r\n                checkedChildren=\"RETAIL\"\r\n                unCheckedChildren=\"WHOLESALE\"\r\n                checked={billSettings.isRetail}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({ ...prev, isRetail: checked }))\r\n                }\r\n                className={styles.saleTypeSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            <div className={`${styles.controlGroup} ${styles.gstControl}`}>\r\n              <Text className={styles.controlLabel}> GST</Text>\r\n              <Switch\r\n                checkedChildren=\"INCL\"\r\n                unCheckedChildren=\"EXCL\"\r\n                checked={billSettings.isGstIncluded}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({ ...prev, isGstIncluded: checked }))\r\n                }\r\n                className={styles.gstSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            <div className={`${styles.controlGroup} ${styles.paymentControl}`}>\r\n              <Text className={styles.controlLabel}> PAYMENT</Text>\r\n              <Switch\r\n                checkedChildren=\"PAID\"\r\n                unCheckedChildren=\"UNPAID\"\r\n                checked={billSettings.isPaid}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({\r\n                    ...prev,\r\n                    isPaid: checked,\r\n                    isPartiallyPaid: checked ? false : prev.isPartiallyPaid,\r\n                  }))\r\n                }\r\n                className={styles.paymentSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            {!billSettings.isPaid && (\r\n              <div\r\n                className={`${styles.controlGroup} ${styles.partialPaymentControl}`}\r\n              >\r\n                <Text className={styles.controlLabel}> PARTIAL</Text>\r\n                <Switch\r\n                  checkedChildren=\"YES\"\r\n                  unCheckedChildren=\"NO\"\r\n                  checked={billSettings.isPartiallyPaid}\r\n                  onChange={checked =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      isPartiallyPaid: checked,\r\n                    }))\r\n                  }\r\n                  className={styles.partialPaymentSwitch}\r\n                  size=\"small\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* Items and Amount Badges - Moved to the end */}\r\n            <div className={styles.badgesContainer}>\r\n              <div className={styles.itemsBadge}>\r\n                <Text className={styles.badgeText}>\r\n                   ITEMS: {billFormData.items.length}\r\n                </Text>\r\n              </div>\r\n              <div className={styles.amountBadge}>\r\n                <Text className={styles.badgeText}>\r\n                   {billCalculations.total_amount.toFixed(2)}\r\n                </Text>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Invoice Details Data Grid */}\r\n      <div className={styles.invoiceDetailsGrid}>\r\n        <AntdEditableTable\r\n          columns={headerColumns}\r\n          dataSource={headerData}\r\n          onSave={handleHeaderChange}\r\n          allowAdd={false}\r\n          allowDelete={false}\r\n          loading={customerLoading}\r\n          className=\"compact-header-grid\"\r\n          size=\"small\"\r\n          rowKey=\"invoice_no\"\r\n        />\r\n      </div>\r\n\r\n      {/* Items Section with Summary */}\r\n      <div className={styles.itemsSection}>\r\n        {/* Decorative half circles for items section */}\r\n        <div className={styles.itemsCircle1} />\r\n        <div className={styles.itemsCircle2} />\r\n        {/* Bill Items Grid */}\r\n        <div className={styles.billItemsGrid}>\r\n          <div className={styles.billItemsHeader}>\r\n            <Text className={styles.billItemsTitle}> BILL ITEMS</Text>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <Badge\r\n                count={billFormData.items.length}\r\n                showZero\r\n                size=\"small\"\r\n                style={{ backgroundColor: 'rgba(255,255,255,0.2)' }}\r\n              >\r\n                <Text className={styles.billItemsBadge}>Items</Text>\r\n              </Badge>\r\n              <Text\r\n                style={{\r\n                  fontSize: '10px',\r\n                  color: '#666',\r\n                  backgroundColor: '#f0f0f0',\r\n                  padding: '2px 6px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                }}\r\n              ></Text>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Stock Validation Summary */}\r\n          {/* {(() => {\r\n            const stockValidationSummary = billFormData.items\r\n              .filter(item => item.stock_id && (item.qty || item.loose_qty))\r\n              .map(item => {\r\n                const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n                const stock = stockListData.find((s: any) => s._id === item.stock_id);\r\n                const availableQty = stock?.available_quantity || 0;\r\n                const totalEnteredQty = (item.qty || 0) + (item.loose_qty || 0);\r\n                const isValid = totalEnteredQty <= availableQty;\r\n                const remainingQty = Math.max(0, availableQty - totalEnteredQty);\r\n                \r\n                return {\r\n                  productName: item.product_name || 'Unknown Product',\r\n                  batchNo: item.batch_no || 'No Batch',\r\n                  availableQty,\r\n                  enteredQty: totalEnteredQty,\r\n                  remainingQty,\r\n                  isValid,\r\n                  isLowStock: remainingQty > 0 && remainingQty <= 5\r\n                };\r\n              });\r\n\r\n            const hasValidationIssues = stockValidationSummary.some(item => !item.isValid);\r\n            const hasLowStock = stockValidationSummary.some(item => item.isLowStock);\r\n\r\n            if (stockValidationSummary.length === 0) return null;\r\n\r\n            return (\r\n              <div style={{\r\n                marginBottom: '16px',\r\n                padding: '12px',\r\n                borderRadius: '8px',\r\n                backgroundColor: hasValidationIssues ? '#fff2f0' : hasLowStock ? '#fffbe6' : '#f6ffed',\r\n                border: `1px solid ${hasValidationIssues ? '#ffccc7' : hasLowStock ? '#ffe58f' : '#b7eb8f'}`,\r\n                fontSize: '12px'\r\n              }}>\r\n                <div style={{ \r\n                  fontWeight: 'bold', \r\n                  marginBottom: '8px',\r\n                  color: hasValidationIssues ? '#cf1322' : hasLowStock ? '#d48806' : '#389e0d'\r\n                }}>\r\n                   Stock Validation Summary\r\n                </div>\r\n                {stockValidationSummary.map((item, index) => (\r\n                  <div key={index} style={{\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center',\r\n                    padding: '4px 0',\r\n                    borderBottom: index < stockValidationSummary.length - 1 ? '1px solid #f0f0f0' : 'none'\r\n                  }}>\r\n                    <span style={{ fontWeight: '500' }}>\r\n                      {item.productName} ({item.batchNo})\r\n                    </span>\r\n                    <div style={{ display: 'flex', gap: '16px', alignItems: 'center' }}>\r\n                      <span>Available: {item.availableQty}</span>\r\n                      <span>Entered: {item.enteredQty}</span>\r\n                      <span>Remaining: {item.remainingQty}</span>\r\n                      <span style={{\r\n                        color: item.isValid ? '#52c41a' : '#ff4d4f',\r\n                        fontWeight: 'bold'\r\n                      }}>\r\n                        {item.isValid ? ' Valid' : ' Exceeds Stock'}\r\n                      </span>\r\n                      {item.isLowStock && (\r\n                        <span style={{ color: '#faad14', fontWeight: 'bold' }}>\r\n                           Low Stock\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            );\r\n          })()} */}\r\n\r\n          <AntdEditableTable\r\n            columns={itemColumns}\r\n            dataSource={billFormData.items.map((item, index) => ({\r\n              ...item,\r\n              key: index.toString(),\r\n            }))}\r\n            onSave={handleItemsChange}\r\n            onAdd={handleAddItem}\r\n            onDelete={handleDeleteItems}\r\n            onProductSelect={handleProductSelect}\r\n            loading={productLoading || stockLoading || branchStockLoading}\r\n            className=\"modern-bill-grid\"\r\n            size=\"small\"\r\n            rowKey=\"key\"\r\n            externalEditingCell={externalEditingCell}\r\n          />\r\n        </div>\r\n\r\n        {/* Bill Summary - Right Side */}\r\n        <div className={styles.billSummary}>\r\n          {/* Decorative half circles for summary */}\r\n          <div className={styles.summaryCircle1} />\r\n          <div className={styles.summaryCircle2} />\r\n          {/* Header */}\r\n          <div className={styles.summaryHeader}>\r\n            <Text className={styles.summaryTitle}> BILL SUMMARY</Text>\r\n          </div>\r\n\r\n          {/* Summary Table */}\r\n          <div className={styles.summaryTable}>\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Sub Total:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.sub_total.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Value of Goods:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.value_of_goods.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Total GST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.total_gst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>CGST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.cgst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>SGST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.sgst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            {billSettings.discount > 0 && (\r\n              <div className={styles.summaryRow}>\r\n                <Text className={styles.summaryLabel}>DISCOUNT:</Text>\r\n                <Text className={styles.discountValue}>\r\n                  -\r\n                  {billSettings.discountType === 'percentage'\r\n                    ? (\r\n                        ((billCalculations.sub_total +\r\n                          billCalculations.total_gst) *\r\n                          (typeof billSettings.discount === 'number'\r\n                            ? billSettings.discount\r\n                            : 0)) /\r\n                        100\r\n                      ).toFixed(2)\r\n                    : (typeof billSettings.discount === 'number'\r\n                        ? billSettings.discount\r\n                        : 0\r\n                      ).toFixed(2)}\r\n                </Text>\r\n              </div>\r\n            )}\r\n\r\n            <div className={styles.totalAmountRow}>\r\n              <Text className={styles.totalAmountLabel}>NET/EXC/REPL:</Text>\r\n              <Text className={styles.totalAmountValue}>\r\n                {billCalculations.total_amount.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            {billSettings.isPartiallyPaid && (\r\n              <div className={styles.partialPaymentInfo}>\r\n                <div className={styles.partialPaymentRow}>\r\n                  <Text className={styles.partialPaymentLabel}>\r\n                    Paid Amount:\r\n                  </Text>\r\n                  <Text className={styles.partialPaymentValue}>\r\n                    \r\n                    {(typeof billSettings.paidAmount === 'number'\r\n                      ? billSettings.paidAmount\r\n                      : 0\r\n                    ).toFixed(2)}\r\n                  </Text>\r\n                </div>\r\n                <div className={styles.partialPaymentRow}>\r\n                  <Text className={styles.partialPaymentLabel}>Balance:</Text>\r\n                  <Text className={styles.partialPaymentValue}>\r\n                    \r\n                    {(\r\n                      billCalculations.total_amount -\r\n                      (typeof billSettings.paidAmount === 'number'\r\n                        ? billSettings.paidAmount\r\n                        : 0)\r\n                    ).toFixed(2)}\r\n                  </Text>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Discount & Payment Controls */}\r\n          <div className={styles.controlsContainer}>\r\n            {/* Discount Controls */}\r\n            <div className={styles.discountControl}>\r\n              <Text className={styles.discountControlLabel}> DISCOUNT</Text>\r\n              <div className={styles.discountControlInputs}>\r\n                <InputNumber\r\n                  min={0}\r\n                  value={billSettings.discount}\r\n                  onChange={value =>\r\n                    setBillSettings(prev => ({ ...prev, discount: value || 0 }))\r\n                  }\r\n                  style={{ width: 70 }}\r\n                  size=\"small\"\r\n                />\r\n                <Switch\r\n                  checkedChildren=\"%\"\r\n                  unCheckedChildren=\"\"\r\n                  checked={billSettings.discountType === 'percentage'}\r\n                  onChange={checked =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      discountType: checked ? 'percentage' : 'amount',\r\n                    }))\r\n                  }\r\n                  size=\"small\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Partial Payment Controls */}\r\n            {billSettings.isPartiallyPaid && (\r\n              <div className={styles.partialPaymentControl}>\r\n                <Text className={styles.partialPaymentControlLabel}>\r\n                   PARTIAL PAY\r\n                </Text>\r\n                <InputNumber\r\n                  min={0}\r\n                  max={billCalculations.total_amount}\r\n                  value={billSettings.paidAmount}\r\n                  onChange={value =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      paidAmount: value || 0,\r\n                    }))\r\n                  }\r\n                  style={{ width: 90 }}\r\n                  size=\"small\"\r\n                  formatter={value =>\r\n                    `${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\r\n                  }\r\n                  parser={value => Number(value!.replace(/\\s?|(,*)/g, ''))}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Ultra-Fast Action Hub */}\r\n      <div className={styles.actionHub}>\r\n        {/* Background decoration */}\r\n        <div className={styles.actionHubCircle1} />\r\n        <div className={styles.actionHubCircle2} />\r\n        <div className={styles.actionHubCircle3} />\r\n        <div className={styles.actionHubCircle4} />\r\n\r\n        <div className={styles.actionButtonsContainer}>\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            icon={<SaveOutlined />}\r\n            onClick={handleSaveBill}\r\n            loading={saleCreateLoading}\r\n            className={styles.saveButton}\r\n          >\r\n             {billdata ? 'UPDATE' : 'SAVE BILL'} (F2)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<FileTextOutlined />}\r\n            onClick={() => setBillListDrawerVisible(true)}\r\n            className={styles.billListButton}\r\n          >\r\n             BILL LIST (F6)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<ClearOutlined />}\r\n            onClick={handleClearBill}\r\n            className={styles.clearButton}\r\n          >\r\n             CLEAR (F4 / Ctrl+R)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<PrinterOutlined />}\r\n            className={styles.printButton}\r\n          >\r\n             PRINT (F3)\r\n          </Button>\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)',\r\n            padding: '14px 18px',\r\n            borderRadius: '10px',\r\n            border: '1px solid #cbd5e1',\r\n            position: 'relative',\r\n            zIndex: 1,\r\n            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.05)',\r\n          }}\r\n        >\r\n          <div style={{ textAlign: 'right' }}>\r\n            <Text\r\n              style={{\r\n                color: '#475569',\r\n                fontSize: '12px',\r\n                display: 'block',\r\n                fontWeight: 600,\r\n                lineHeight: '18px',\r\n              }}\r\n            >\r\n               <strong>Keyboard Shortcuts:</strong> Ctrl+S (Save)  Ctrl+N\r\n              (Add)  F4/Ctrl+R (Clear)  Tab/Shift+Tab (Navigate)  Enter\r\n              (Edit)  Esc (Cancel)  End (Customer)  Ctrl+U (User)  F5\r\n              (Product)  F6 (Bill List)  F7 (Stock)\r\n            </Text>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {stockModalRowIndex !== null && (\r\n        <StockSelectionModal\r\n          visible={true}\r\n          onSelect={handleStockSelect}\r\n          onCancel={() => setStockModalRowIndex(null)}\r\n          productId={billFormData.items[stockModalRowIndex]?.product_id || ''}\r\n        />\r\n      )}\r\n\r\n      {/* Customer Selection Modal */}\r\n      <CustomerSelectionModal\r\n        visible={customerModalVisible}\r\n        onSelect={handleCustomerSelect}\r\n        onCancel={() => setCustomerModalVisible(false)}\r\n      />\r\n\r\n      {/* User Selection Modal */}\r\n      <UserSelectionModal\r\n        visible={userModalVisible}\r\n        onSelect={handleUserSelect}\r\n        onCancel={() => setUserModalVisible(false)}\r\n      />\r\n\r\n      {/* Bill Save Confirmation Modal */}\r\n      <BillSaveConfirmationModal\r\n        visible={saveConfirmationVisible}\r\n        onNewBill={handleNewBill}\r\n        onContinueBill={handleContinueBill}\r\n        onCancel={() => setSaveConfirmationVisible(false)}\r\n        savedBillData={savedBillData}\r\n      />\r\n\r\n      {/* Product Details Modal */}\r\n      <ProductDetailsModal\r\n        visible={productDetailsModalVisible}\r\n        onCancel={() => setProductDetailsModalVisible(false)}\r\n        productId={selectedProductId}\r\n      />\r\n\r\n      {/* Product Selection Modal */}\r\n      <ProductSelectionModal\r\n        visible={productSelectionModalVisible}\r\n        onSelect={handleProductSelectionModalSelect}\r\n        onCancel={() => {\r\n          setProductSelectionModalVisible(false);\r\n          setProductSelectionRowIndex(null);\r\n        }}\r\n      />\r\n\r\n      {/* Bill List Drawer */}\r\n      <BillListDrawer\r\n        visible={billListDrawerVisible}\r\n        onClose={() => setBillListDrawerVisible(false)}\r\n        onViewBill={handleViewBill}\r\n        onNewBill={handleNewBill}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillDataGrid;\r\n","/**\r\n * Centralized bill calculation utility\r\n * @param items - array of bill items\r\n * @param productList - product list (for tax/category lookup)\r\n * @param isGstIncluded - whether GST is included in price\r\n * @param discount - discount value\r\n * @param discountType - 'percentage' or 'amount'\r\n * @returns { totalAmount, totalGST, cgst, sgst, valueOfGoods, subtotal, itemsWithTax }\r\n */\r\nexport function calculateBillTotals({\r\n  items,\r\n  productList,\r\n  isGstIncluded,\r\n  discount,\r\n  discountType,\r\n}: {\r\n  items: any[];\r\n  productList: any[];\r\n  isGstIncluded: boolean;\r\n  discount: number;\r\n  discountType: \"percentage\" | \"amount\";\r\n}) {\r\n  // Calculate item base amounts\r\n  const itemsWithTax = items.map((item) => {\r\n    const product = productList?.find((p: any) => p._id === item.product_id);\r\n    // Use item's tax_percentage if available, otherwise get from product category, or default to 18%\r\n    let taxPercentage = item.tax_percentage || product?.CategoryItem?.tax_percentage || 18;\r\n    \r\n    // If still no tax percentage, use a default based on common GST rates\r\n    if (!taxPercentage || taxPercentage === 0) {\r\n      // Default to 18% GST for most goods\r\n      taxPercentage = 18;\r\n    }\r\n    \r\n\r\n    // Calculate base amount (before GST)\r\n    const baseAmount =\r\n      Number(item.qty || 0) * Number(item.price || 0) +\r\n      Number(item.loose_qty || 0) *\r\n        (Number(item.price || 0) / (product?.VariantItem?.pack_size || 1) || 0);\r\n    \r\n    // Calculate amount (with GST if applicable)\r\n    let amount = baseAmount;\r\n    if (!isGstIncluded && taxPercentage > 0) {\r\n      amount = baseAmount + (baseAmount * taxPercentage / 100);\r\n    }\r\n    return {\r\n      ...item,\r\n      tax_percentage: taxPercentage,\r\n      baseAmount,\r\n      amount,\r\n    };\r\n  });\r\n\r\n  // sub_total: sum of all item.amount values (table total before discount/GST)\r\n  const sub_total = itemsWithTax.reduce(\r\n    (sum, item) => sum + Number(item.amount),\r\n    0\r\n  );\r\n\r\n  // base_sub_total: sum of all item base amounts (before GST and discount)\r\n  const base_sub_total = itemsWithTax.reduce(\r\n    (sum, item) => sum + Number(item.baseAmount),\r\n    0\r\n  );\r\n\r\n  // Discount\r\n  let discountValue = 0;\r\n  if (discount > 0) {\r\n    if (discountType === \"percentage\") {\r\n      discountValue = base_sub_total * (discount / 100);\r\n    } else {\r\n      discountValue = discount;\r\n    }\r\n  }\r\n\r\n  // Discounted value of goods\r\n  const discounted_value_of_goods = base_sub_total - discountValue;\r\n\r\n  let total_gst = 0;\r\n  let value_of_goods = 0;\r\n  let total_amount = 0;\r\n  // Calculate GST and totals for each item\r\n  itemsWithTax.forEach(item => {\r\n    let discountedBase = item.baseAmount;\r\n    if (discount > 0) {\r\n      if (discountType === \"percentage\") {\r\n        discountedBase = item.baseAmount - (item.baseAmount * (discount / 100));\r\n      } else {\r\n        discountedBase = item.baseAmount - ((discount/base_sub_total)*item.baseAmount);\r\n      }\r\n    }\r\n    \r\n    let gstAmount = 0;\r\n    if (!isGstIncluded) {\r\n      // GST Excluded: GST is added on top\r\n      if (item.tax_percentage > 0) {\r\n        gstAmount = discountedBase * (item.tax_percentage / 100);\r\n        value_of_goods += discountedBase;\r\n        total_gst += gstAmount;\r\n        total_amount += discountedBase + gstAmount;\r\n      } else {\r\n        // No tax\r\n        value_of_goods += discountedBase;\r\n        total_amount += discountedBase;\r\n      }\r\n    } else {\r\n      // GST Included: GST is part of the price, extract it\r\n      if (item.tax_percentage > 0) {\r\n        gstAmount = discountedBase * (item.tax_percentage / (100 + item.tax_percentage));\r\n        value_of_goods += discountedBase - gstAmount;\r\n        total_gst += gstAmount;\r\n        total_amount += discountedBase;\r\n      } else {\r\n        // No tax\r\n        value_of_goods += discountedBase;\r\n        total_amount += discountedBase;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Calculate CGST and SGST (each is total_gst / 2)\r\n  const cgst = total_gst / 2;\r\n  const sgst = total_gst / 2;\r\n\r\n  return {\r\n    sub_total,\r\n    value_of_goods,\r\n    total_gst,\r\n    cgst,\r\n    sgst,\r\n    total_amount,\r\n    discountValue,\r\n  };\r\n}\r\n"],"names":["Search","Input","_ref","_products$result","visible","onSelect","onCancel","getEntityApi","useApiActions","ProductsApi","items","products","loading","useDynamicSelector","getIdentifier","searchTerm","setSearchTerm","useState","selectedRowKey","setSelectedRowKey","highlightedIndex","setHighlightedIndex","scannerVisible","setScannerVisible","searchInputRef","useRef","filteredProducts","result","filter","p","_p$name","_p$sku","_p$VariantItem","_p$VariantItem$varian","_p$VariantItem2","_p$VariantItem2$varia","_p$selling_price","searchLower","toLowerCase","name","includes","sku","VariantItem","variant_name","variant_code","selling_price","toString","sort","a","b","_a$name","_a$VariantItem","_a$VariantItem$varian","_a$sku","_b$name","_b$VariantItem","_b$VariantItem$varian","_b$sku","_a$name2","_a$VariantItem2","_a$VariantItem2$varia","_a$sku2","_b$name2","_b$VariantItem2","_b$VariantItem2$varia","_b$sku2","aExactMatch","bExactMatch","aStartsWith","startsWith","bStartsWith","useEffect","length","_id","setTimeout","_searchInputRef$curre","current","focus","columns","title","dataIndex","key","width","render","record","_record$VariantItem","_record$VariantItem2","_jsxs","children","_jsx","style","fontWeight","color","fontSize","marginTop","marginLeft","variant","fontStyle","price","toFixed","handleSelectRow","product","Modal","open","footer","destroyOnClose","onClick","handleModalClick","_searchInputRef$curre4","Space","Compact","marginBottom","ref","placeholder","onChange","e","target","value","flex","autoFocus","onKeyDown","_searchInputRef$curre2","preventDefault","prev","next","Math","min","_searchInputRef$curre3","prevIndex","max","selectedProduct","onBlur","_searchInputRef$curre5","Button","type","icon","ScanOutlined","minWidth","Table","dataSource","rowKey","size","pagination","onRow","idx","_searchInputRef$curre6","onDoubleClick","className","backgroundColor","undefined","border","rowSelection","selectedRowKeys","keys","findIndex","scroll","y","BarcodeScanner","onClose","onScan","barcode","_products$result2","foundProduct","find","_p$sku2","_p$name2","_p$VariantItem3","_p$VariantItem3$varia","message","success","concat","warning","description","_stocks$result","productId","StockApi","stocks","errorMessage","setErrorMessage","tableBodyRef","isStockExpired","stock","expiry_date","dayjs","isBefore","isStockOutOfStock","available_quantity","showExpiredStockError","expiryDate","format","errorMsg","error","showOutOfStockError","allStocks","s","_s$batch_no","_s$ProductItem","_s$ProductItem$name","_s$ProductItem2","_s$ProductItem2$Varia","_s$ProductItem2$Varia2","_s$available_quantity","_s$sell_price","batch_no","ProductItem","sell_price","firstValidIndex","_allStocks$highlighte","row","querySelector","scrollIntoView","block","_ProductItem$VariantI","isOutOfStock","ExclamationCircleOutlined","today","isExpired","daysUntilExpiry","diff","CheckCircleOutlined","status","Tooltip","Tag","_stock$ProductItem","id","code","_searchInputRef$curre7","finalNext","finalPrev","selectedStock","_searchInputRef$curre8","padding","borderRadius","display","alignItems","gap","i","shiftKey","tabIndex","outline","justifyContent","margin","_searchInputRef$curre9","opacity","cursor","getCheckboxProps","disabled","Text","Typography","onSave","onAdd","onDelete","allowAdd","allowDelete","compact","enableKeyboardNav","onProductSelect","externalEditingCell","data","setData","selectedRows","setSelectedRows","editingCell","setEditingCell","firstLoadRef","firstProductColIndex","col","String","handleAddRow","firstEditableCol","editable","saveCell","column","required","validation","newData","handleKeyDown","ctrlKey","document","addEventListener","removeEventListener","getNextEditableCol","startCol","direction","EditableCell","_ref2","_data$row","_data$row2","cellValue","setCellValue","inputRef","isProductModalVisible","setIsProductModalVisible","isStockModalVisible","setIsStockModalVisible","_inputRef$current","handleChange","val","stopPropagation","nextCol","nextRow","colIndex","handleProductSelect","handleStockSelect","stock_id","_Fragment","ProductSelectionModal","readOnly","StockSelectionModal","product_id","InputNumber","controls","Select","options","_inputRef$current2","DatePicker","date","mergedColumns","map","_objectSpread","onCell","_record","rowIndex","onContextMenu","product_name","option","opt","label","PlusOutlined","danger","DeleteOutlined","handleDeleteRow","confirm","onOk","slice","SaveOutlined","bordered","useGenericCrudRTK","entityName","useDispatch","entityHooks","useMemo","getEntityHooks","entityRoutes","routes","API_ROUTES","Error","useGetAll","params","arguments","query","useGetQuery","refetch","useGetById","useGetByIdQuery","useCreate","createMutation","useCreateMutation","create","useCallback","async","unwrap","useUpdate","updateMutation","useUpdateMutation","update","useDelete","deleteMutation","useDeleteMutation","remove","delete","getRoutes","getAll","GetAll","get","Get","Create","Update","Delete","Title","Option","CustomerSelectionModalComponent","CustomerApi","customerList","customerLoading","createLoading","customers","showAddForm","setShowAddForm","selectedCustomer","setSelectedCustomer","selectedRowIndex","setSelectedRowIndex","showCreateGrid","setShowCreateGrid","newCustomerData","setNewCustomerData","full_name","email","mobile","address","customer_type","form","Form","useForm","modalRef","searchTimeoutRef","createGridRef","firstFormInputRef","filteredCustomers","shouldShowCreateGrid","trim","getCustomerTypeColor","vip","wholesale","regular","navigateToCustomer","newIndex","rowElement","scrollBehavior","behavior","handleSearch","clearTimeout","searchString","handleCustomerSelect","customer","handleCreateCustomerFromForm","clearFormData","resetFields","handleFormFieldChange","field","ArrowDown","ArrowUp","Home","End","handleGlobalKeyDown","tagName","classList","contains","closest","select","firstInput","text","index","c","height","transition","strong","toUpperCase","PhoneOutlined","MailOutlined","HomeOutlined","getRowProps","onMouseEnter","currentTarget","onMouseLeave","focusSearch","timer","useHandleApiResponse","action","identifier","entityApi","createResult","content","duration","destroy","statusCode","newCustomer","handleSearchFocus","top","afterOpenChange","prefix","SearchOutlined","onFocus","suffix","UserAddOutlined","newState","background","boxShadow","position","overflow","right","zIndex","bottom","left","Row","justify","align","Col","level","WebkitBackgroundClip","WebkitTextFillColor","backgroundClip","marginRight","CloseOutlined","layout","gridTemplateColumns","Item","UserOutlined","rules","pattern","TextArea","rows","resize","Divider","maxHeight","textAlign","React","BillingUsersApi","userList","userLoading","users","selectedUser","setSelectedUser","currentUser","getCurrentUser","filteredUsers","user","_user$name","_user$email","_user$mobile","_user$user_name","_user$roleItems","_user$roleItems$name","user_name","roleItems","navigateToUser","handleUserSelect","u","_record$roleItems","_record$branchItems","branchItems","branch_name","currentUserInList","onNewBill","onContinueBill","savedBillData","centered","maskClosable","closable","FileTextOutlined","invoice_no","customer_name","CalendarOutlined","DollarOutlined","total_amount","parseFloat","onViewBill","SalesRecord","billList","filteredBills","setFilteredBills","filtered","bill","_bill$customerDetails","invoiceNo","customerName","customerDetails","totalAmount","getPaymentStatusText","isPaid","isPartiallyPaid","handleViewBill","handleNewBill","Drawer","placement","bodyStyle","headerStyle","borderBottom","allowClear","Spin","Empty","List","renderItem","_bill$customerDetails2","transform","Avatar","is_paid","is_partially_paid","EyeOutlined","PrinterOutlined","borderTop","_productDetails$Varia","_productDetails$Varia2","_productDetails$Varia3","_productDetails$selli","_productDetails$mrp","_productDetails$Categ","_productDetails$Categ2","productDetails","setProductDetails","handleCancel","Descriptions","span","brand","unit","mrp","CategoryItem","tax_percentage","min_stock","max_stock","_billFormData$items$s","billdata","onSuccess","StockAuditApi","BranchStock","InvoiceNumberApi","productListData","isLoading","productLoading","refetchProducts","customerListData","refetchCustomers","userListData","refetchUsers","stockAuditListData","stockLoading","refetchStockAudit","branchStockListData","branchStockLoading","refetchBranchStock","invoiceNoData","refetchInvoiceNo","productList","stockAuditList","branchStockList","invoice_no_item","productListResult","Array","isArray","customerListResult","userListResult","stockAuditListResult","branchStockListResult","createSalesRecord","saleCreateLoading","updateSalesRecord","saleUpdateLoading","createInvoiceNumber","invoice_no_create_loading","createResponse","setCreateResponse","updateResponse","setUpdateResponse","billFormData","setBillFormData","productItem","_productItem$VariantI","pack_size","isValid","expectedLoose","totalAvailable","packSize","parseInt","availablePackQty","availableLooseQty","available_loose_quantity","customer_id","billed_by_id","billed_by_name","payment_mode","billSettings","setBillSettings","isRetail","isGstIncluded","discount","discountType","paidAmount","stockModalRowIndex","setStockModalRowIndex","setExternalEditingCell","customerModalVisible","setCustomerModalVisible","userModalVisible","setUserModalVisible","saveConfirmationVisible","setSaveConfirmationVisible","billListDrawerVisible","setBillListDrawerVisible","setSavedBillData","productDetailsModalVisible","setProductDetailsModalVisible","selectedProductId","setSelectedProductId","productSelectionModalVisible","setProductSelectionModalVisible","productSelectionRowIndex","setProductSelectionRowIndex","lastInteractedRowIndex","setLastInteractedRowIndex","branchId","branch_id","validateStockQuantity","stockId","qty","looseQty","_stock$ProductItem$Va","maxLooseQty","packSizeNum","remainingPacks","handleQuantityChange","newItems","item","newQty","newLooseQty","loose_qty","_billdata$customerDet","_billdata$billedByDet","_billdata$Items","_billdata$is_paid","_billdata$is_partiall","_billdata$is_gst_incl","_billdata$discount","_billdata$discount_ty","_billdata$paid_amount","billedByDetails","Items","_item$productItems","_item$productItems2","_item$productItems2$V","productItems","branch_stock_id","amount","sale_type","is_gst_included","discount_type","paid_amount","_invoice_no_item$resu","defaultItems","fill","_","productOptions","_product$VariantItem","customerOptions","userOptions","headerColumns","borderColor","headerData","itemColumns","minHeight","_stock$ProductItem2","_stock$ProductItem2$V","isLowStock","whiteSpace","isExceedingStock","onPressEnter","newValue","_stock$ProductItem3","_stock$ProductItem3$V","qtyColIndex","billCalculations","itemsWithTax","_product$CategoryItem","taxPercentage","baseAmount","Number","sub_total","reduce","sum","base_sub_total","discountValue","total_gst","value_of_goods","forEach","discountedBase","gstAmount","cgst","sgst","calculateBillTotals","handleHeaderChange","headerRows","updatedHeader","handleItemsChange","updatedItems","_productOptions$find","billItem","_stock$ProductItem4","_stock$ProductItem4$V","availableStocks","_stock$ProductItem5","firstStock","qtyCell","_stock$ProductItem6","_stock$ProductItem6$V","_product$VariantItem2","sellPrice","looseRate","console","handleF5ProductSelection","info","openProductModalForRow","targetRowIndex","activeElement","focusedRow","getAttribute","focusedCell","handleAddItem","autoOpenProductModal","handleF7StockSelection","_billFormData$items$r","rowIndexNum","resetBill","showMessage","handleClearBill","forceResolveProductNamesAndStock","hasChanges","updated","_product$VariantItem6","stockListData","_item$batch_no","newItem","handleSaveBill","some","stockValidationErrors","push","join","payload","_response","response","savedData","_product$VariantItem7","interval","setInterval","clearInterval","productCell","test","input","dispatchEvent","Event","bubbles","styles","Switch","checkedChildren","unCheckedChildren","checked","AntdEditableTable","Badge","count","showZero","indices","formatter","replace","parser","ClearOutlined","lineHeight","invoice_id","CustomerSelectionModal","UserSelectionModal","BillSaveConfirmationModal","handleContinueBill","ProductDetailsModal","_product$VariantItem3","BillListDrawer","_bill$customer","_bill$is_paid","_bill$is_partially_pa","_bill$is_gst_included","sales_items","mappedItems","_item$productItems3","_item$product","productName","variantName","_item$productItems$Va","_item$product$Variant","_product$VariantItem4","itemIndex","_foundProduct$Variant","batchNo","_stockList$result","stockList","currentStockList","foundStock","customerId","_customerList$result","formattedDate","finalMappedItems","_product$VariantItem5"],"sourceRoot":""}