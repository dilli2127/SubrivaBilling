"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[159],{21159:(e,t,i)=>{i.r(t),i.d(t,{default:()=>qe});var n=i(89379),l=i(65043),o=i(83833),a=i(62305),s=i(76399),d=i(96651),r=i(6051),c=i(95206),u=i(60647),m=i(36621),p=i(62751),v=i(36091),x=i(6881),y=i(53722),h=i(11951),_=i(76401),f=i(61118),g=i(75388),A=i(94834),b=i(9316),j=i(72411),k=i(73847),I=i(60446),C=i.n(I),S=i(22671),N=i(83537),w=i(97031),P=i(89472),T=i(16569),D=i(7866),q=i(12624),E=i(37490),L=i(21448),M=i(38963),B=i(94211),G=i(88143),z=i(93310),V=i(32054),F=i(18796),R=i(73469),Y=i(87768),O=i(61345),U=i(43281),W=i(36977),Q=i(70224),X=i(70579);const{Title:H,Text:K}=o.A,J=e=>{var t;let{billdata:i,onSuccess:o}=e;const{getEntityApi:a}=(0,N.p)(),s=((0,l.useCallback)(((e,t)=>{var i;if(!e||null===t||void 0===t||null===(i=t.VariantItem)||void 0===i||!i.pack_size)return{isValid:!0,expectedLoose:0,totalAvailable:0};const n=parseInt(t.VariantItem.pack_size),l=e.available_quantity||0,o=e.available_loose_quantity||0;return{isValid:!0,expectedLoose:o,totalAvailable:l*n+o}}),[]),a("Product")),r=a("Customer"),u=a("BillingUsers"),m=a("StockAudit"),p=a("BranchStock"),x=a("SalesRecord"),y=a("InvoiceNumber"),{items:h,loading:_}=(0,w.Sm)(s.getIdentifier("GetAll")),{items:f,loading:g}=(0,w.Sm)(r.getIdentifier("GetAll")),{items:b,loading:j}=(0,w.Sm)(u.getIdentifier("GetAll")),{items:k,loading:I}=(0,w.Sm)(m.getIdentifier("GetAll")),{items:S,loading:J}=(0,w.Sm)(p.getIdentifier("GetAll")),{items:Z}=(0,w.Sm)(y.getIdentifier("GetAll")),{items:$,loading:ee}=(0,w.Sm)(y.getIdentifier("Create")),{loading:te}=(0,w.Sm)(x.getIdentifier("Create")),[ie,ne]=(0,l.useState)({invoice_no:"",date:C()().format("YYYY-MM-DD"),customer_id:"",customer_name:"",billed_by_id:"",billed_by_name:"",payment_mode:"cash",items:[]}),[le,oe]=(0,l.useState)({isPaid:!0,isPartiallyPaid:!1,isRetail:!0,isGstIncluded:!0,discount:0,discountType:"percentage",paidAmount:0}),[ae,se]=(0,l.useState)(null),[de,re]=(0,l.useState)(null),[ce,ue]=(0,l.useState)(!1),[me,pe]=(0,l.useState)(!1),[ve,xe]=(0,l.useState)(!1),[ye,he]=(0,l.useState)(!1),[_e,fe]=(0,l.useState)(null),[ge,Ae]=(0,l.useState)(!1),[be,je]=(0,l.useState)(""),[ke,Ie]=(0,l.useState)(!1),[Ce,Se]=(0,l.useState)(null),[Ne,we]=(0,l.useState)(0),Pe=(0,l.useMemo)((()=>(0,P.HW)()),[]),Te=null===Pe||void 0===Pe?void 0:Pe.branch_id,De=(e,t,i)=>{var n,l,o;const a=Te?S:k,s=null===a||void 0===a||null===(n=a.result)||void 0===n?void 0:n.find((t=>t._id===e));if(!s)return{isValid:!1,availablePackQty:0,maxLooseQty:0,message:"Stock not found"};const d=null===s||void 0===s||null===(l=s.ProductItem)||void 0===l||null===(o=l.VariantItem)||void 0===o?void 0:o.pack_size,r=d?parseInt(d):1,c=s.available_quantity||0,u=s.available_loose_quantity||0;if(t>c)return{isValid:!1,availablePackQty:c,maxLooseQty:0,message:"Pack quantity (".concat(t,") exceeds available packs (").concat(c,")")};const m=c-t,p=m*r+u;return i>p?{isValid:!1,availablePackQty:c,maxLooseQty:p,message:"Loose quantity (".concat(i,") exceeds available loose items (").concat(p," = ").concat(m," remaining packs \xd7 ").concat(r," + ").concat(u," loose)")}:{isValid:!0,availablePackQty:c,maxLooseQty:p,message:""}},qe=(0,l.useCallback)(((e,t,i)=>{const l=[...ie.items],o=l[e];if(!o.stock_id)return l[e]=(0,n.A)((0,n.A)({},o),{},{[t]:i}),void ne((e=>(0,n.A)((0,n.A)({},e),{},{items:l})));const a="qty"===t?i:o.qty||0,s="loose_qty"===t?i:o.loose_qty||0,d=De(o.stock_id,a,s);d.isValid?l[e]=(0,n.A)((0,n.A)({},o),{},{[t]:i}):(T.Ay.error(d.message),"qty"===t&&a>d.availablePackQty?l[e]=(0,n.A)((0,n.A)({},o),{},{qty:d.availablePackQty}):"loose_qty"===t&&s>d.maxLooseQty&&(l[e]=(0,n.A)((0,n.A)({},o),{},{loose_qty:d.maxLooseQty}))),ne((e=>(0,n.A)((0,n.A)({},e),{},{items:l})))}),[ie.items,De]);(0,l.useEffect)((()=>{var e,t,n,l,o,a,d,c,m;(s("GetAll"),r("GetAll"),u("GetAll"),i||ee||y("GetAll"),i)&&(ne({invoice_no:i.invoice_no,date:C()(i.date).format("YYYY-MM-DD"),customer_id:i.customer_id,customer_name:(null===(e=i.customerDetails)||void 0===e?void 0:e.full_name)||"",billed_by_id:i.billed_by_id||"",billed_by_name:(null===(t=i.billedByDetails)||void 0===t?void 0:t.name)||"",payment_mode:i.payment_mode,items:(null===(n=i.Items)||void 0===n?void 0:n.map((e=>{var t,i,n;return{_id:e._id,product_id:e.product_id,product_name:(null===(t=e.productItems)||void 0===t?void 0:t.name)||"",variant_name:(null===(i=e.productItems)||void 0===i||null===(n=i.VariantItem)||void 0===n?void 0:n.variant_name)||"",stock_id:Te?e.branch_stock_id:e.stock_id,qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price,mrp:e.mrp||e.price,amount:e.amount,tax_percentage:e.tax_percentage||0}})))||[]}),oe({isPaid:null===(l=i.is_paid)||void 0===l||l,isPartiallyPaid:null!==(o=i.is_partially_paid)&&void 0!==o&&o,isRetail:"retail"===i.sale_type,isGstIncluded:null===(a=i.is_gst_included)||void 0===a||a,discount:null!==(d=i.discount)&&void 0!==d?d:0,discountType:null!==(c=i.discount_type)&&void 0!==c?c:"percentage",paidAmount:null!==(m=i.paid_amount)&&void 0!==m?m:0}))}),[i]),(0,l.useEffect)((()=>{var e;null!==Z&&void 0!==Z&&null!==(e=Z.result)&&void 0!==e&&e.invoice_no&&!i&&ne((e=>(0,n.A)((0,n.A)({},e),{},{invoice_no:Z.result.invoice_no})))}),[Z,i]),(0,l.useEffect)((()=>{if(!i&&0===ie.items.length){const e=Array(1).fill(null).map(((e,t)=>({product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0})));ne((t=>(0,n.A)((0,n.A)({},t),{},{items:e})))}}),[i,ie.items.length]),(0,l.useEffect)((()=>{if(!i&&null!==b&&void 0!==b&&b.result&&null!==Pe&&void 0!==Pe&&Pe._id&&!ie.billed_by_id){const e=b.result.find((e=>e._id===Pe._id));e&&ne((t=>(0,n.A)((0,n.A)({},t),{},{billed_by_id:Pe._id,billed_by_name:e.name||Pe.name||""})))}}),[b,null===Pe||void 0===Pe?void 0:Pe._id,i,ie.billed_by_id]);const Ee=(0,l.useMemo)((()=>{var e;return(null===h||void 0===h||null===(e=h.result)||void 0===e?void 0:e.map((e=>{var t;return{label:"".concat(e.name," ").concat((null===e||void 0===e||null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)||"").trim(),value:e._id}})))||[]}),[h]),Le=(0,l.useMemo)((()=>{var e;return(null===f||void 0===f||null===(e=f.result)||void 0===e?void 0:e.map((e=>({label:"".concat(e.full_name," - ").concat(e.mobile),value:e._id}))))||[]}),[f]),Me=(0,l.useMemo)((()=>{var e;const t=(null===b||void 0===b||null===(e=b.result)||void 0===e?void 0:e.map((e=>{var t;return{label:"".concat(e.name," (").concat((null===(t=e.roleItems)||void 0===t?void 0:t.name)||"No Role",")"),value:e._id}})))||[];return t}),[b]),Be=(0,l.useMemo)((()=>[{key:"invoice_no",title:"\ud83d\udcc4 INVOICE #",dataIndex:"invoice_no",type:"text",required:!0,width:180},{key:"date",title:"\ud83d\udcc5 DATE",dataIndex:"date",type:"date",required:!0,width:150},{key:"customer_id",title:"\ud83d\udc64 CUSTOMER",dataIndex:"customer_id",type:"select",options:Le,required:!0,width:250,render:(e,t)=>{const i=Le.find((t=>t.value===e));return(0,X.jsx)(d.A,{title:"Click to open customer selection modal (or press End key)",children:(0,X.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:"1px solid #d9d9d9",backgroundColor:"#fafafa",transition:"all 0.2s ease"},onClick:()=>ue(!0),onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#fafafa",e.currentTarget.style.borderColor="#d9d9d9"},children:[(0,X.jsx)("span",{children:i?i.label:"Select customer"}),(0,X.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#f0f8ff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d6e4ff"},children:"End"})]})})}},{key:"billed_by_id",title:"\ud83d\udc68\u200d\ud83d\udcbc BILLED BY",dataIndex:"billed_by_id",type:"select",options:Me,required:!1,width:250,render:(e,t)=>{const i=Me.find((t=>t.value===e));return(0,X.jsx)(d.A,{title:"Click to open user selection modal (or press Ctrl+U key)",children:(0,X.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:"1px solid #d9d9d9",backgroundColor:"#f0f8ff",transition:"all 0.2s ease"},onClick:()=>pe(!0),onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#e6f7ff",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#f0f8ff",e.currentTarget.style.borderColor="#d9d9d9"},children:[(0,X.jsx)("span",{children:i?i.label:"Select user"}),(0,X.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#ffffff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d6e4ff"},children:"Ctrl+U"})]})})}},{key:"payment_mode",title:"\ud83d\udcb3 PAYMENT",dataIndex:"payment_mode",type:"select",options:[{label:"\ud83d\udcb5 Cash",value:"cash"},{label:"\ud83d\udcf1 UPI",value:"upi"},{label:"\ud83d\udcb3 Card",value:"card"}],required:!0,width:150}]),[Le,Me]),Ge=(0,l.useMemo)((()=>[{invoice_no:ie.invoice_no,date:ie.date,customer_id:ie.customer_id,billed_by_id:ie.billed_by_id,payment_mode:ie.payment_mode}]),[ie.invoice_no,ie.date,ie.customer_id,ie.billed_by_id,ie.payment_mode]),ze=(0,l.useMemo)((()=>[{key:"product_id",title:"\ud83d\uded2 PRODUCT",dataIndex:"product_id",type:"product",required:!0,width:280,render:(e,t,i)=>{const n=Ee.find((t=>t.value===e));return(0,X.jsx)(d.A,{title:e?"Product: ".concat((null===n||void 0===n?void 0:n.label)||"Unknown"," - Click to change \u2022 F5 to reopen"):"Click to select product from inventory \u2022 F5 to open",placement:"top",children:(0,X.jsxs)("div",{style:{cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:e?"1px solid #52c41a":"1px solid #d9d9d9",backgroundColor:e?"#f6ffed":"#fafafa",transition:"all 0.2s ease",minHeight:"32px",display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>{"number"===typeof i&&(Se(i),we(i),Ie(!0))},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=e?"#f6ffed":"#fafafa",t.currentTarget.style.borderColor=e?"#52c41a":"#d9d9d9"},children:[(0,X.jsx)("span",{style:{color:e?"#52c41a":"#1890ff",fontWeight:e?600:400},children:e?(null===n||void 0===n?void 0:n.label)||"Unknown Product":"Select product"}),e&&(0,X.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,X.jsx)("span",{style:{fontSize:"12px",color:"#52c41a"},children:"\u2705"}),(0,X.jsx)("span",{style:{fontSize:"10px",color:"#52c41a",backgroundColor:"#f6ffed",padding:"2px 4px",borderRadius:"3px"},children:"Selected"})]}),!e&&(0,X.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginTop:"2px"},children:[(0,X.jsx)("span",{style:{fontSize:"10px",color:"#ff4d4f"},children:"\u26a0\ufe0f Product required"}),(0,X.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#f0f8ff",padding:"2px 4px",borderRadius:"3px"},children:"Click"})]})]})})}},{key:"stock_id",title:"\ud83d\udce6 STOCK",dataIndex:"batch_no",type:"stock",required:!0,width:280,editable:!0,render:(e,t,i)=>{var n,l,o;const a=Te?S:k,s=null===a||void 0===a||null===(n=a.result)||void 0===n?void 0:n.find((e=>e._id===t.stock_id)),r=null===s||void 0===s||null===(l=s.ProductItem)||void 0===l||null===(o=l.VariantItem)||void 0===o?void 0:o.pack_size,c=r?parseInt(r):1,u=(null===s||void 0===s?void 0:s.available_quantity)||0,m=(null===s||void 0===s?void 0:s.available_loose_quantity)||0,p=u>0&&u<=10,v=0===u;return(0,X.jsx)(d.A,{title:t.product_id?e?"Stock: ".concat(e," - Packs Available: ").concat(u," \u2022 Loose Available: ").concat(m," \u2022 Pack Size: ").concat(c," \u2022 Click to change \u2022 F7 to reopen"):"Click to select stock from available inventory \u2022 F7 to open":"Please select a product first to choose stock \u2022 F7 to open after product selection",placement:"top",children:(0,X.jsxs)("div",{style:{cursor:"pointer",padding:"6px 10px",borderRadius:"6px",border:e?"1px solid #52c41a":"1px solid #d9d9d9",backgroundColor:e?"#f6ffed":"#fafafa",transition:"all 0.2s ease",minHeight:"32px",display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",gap:"10px"},onClick:()=>{t.product_id&&"number"===typeof i?se(i):t.product_id||T.Ay.warning("Please select a product first")},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:t=>{t.currentTarget.style.backgroundColor=e?"#f6ffed":"#fafafa",t.currentTarget.style.borderColor=e?"#52c41a":"#d9d9d9"},children:[(0,X.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",flex:1},children:[(0,X.jsx)("span",{style:{color:e?"#52c41a":t.product_id?"#1890ff":"#bfbfbf",fontWeight:e?600:400,fontSize:"13px",whiteSpace:"nowrap"},children:e||"Select Stock"}),s&&(0,X.jsxs)(X.Fragment,{children:[(0,X.jsxs)("span",{style:{color:v?"#ff4d4f":p?"#faad14":"#52c41a",fontWeight:"bold",backgroundColor:v?"#fff2f0":p?"#fffbe6":"#f6ffed",padding:"2px 6px",borderRadius:"4px",border:"1px solid ".concat(v?"#ffccc7":p?"#ffe58f":"#b7eb8f"),fontSize:"12px"},children:["\ud83d\udce6 ",u]}),(0,X.jsxs)("span",{style:{color:"#722ed1",fontWeight:"bold",backgroundColor:"#f9f0ff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d3adf7",fontSize:"12px"},children:["\ud83d\udccb ",m]})]}),t.product_id&&!e&&(0,X.jsx)("span",{style:{fontSize:"11px",color:"#ff4d4f",whiteSpace:"nowrap"},children:"\u26a0\ufe0f Stock required"})]}),t.product_id&&(0,X.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[(0,X.jsx)("span",{style:{fontSize:"12px",color:"#1890ff"},children:"\ud83d\udccb"}),(0,X.jsx)("span",{style:{fontSize:"10px",color:"#52c41a",backgroundColor:"#f6ffed",padding:"2px 4px",borderRadius:"3px"},children:"Click"})]})]})})}},{key:"qty",title:"\ud83d\udcca QTY",dataIndex:"qty",type:"number",width:90,render:(e,t,i)=>{var n;const l=Te?S:k,o=null===l||void 0===l||null===(n=l.result)||void 0===n?void 0:n.find((e=>e._id===t.stock_id)),a=(null===o||void 0===o?void 0:o.available_quantity)||0,s=e>a;return(0,X.jsx)("div",{style:{position:"relative"},children:(0,X.jsx)(D.A,{value:e,min:0,max:a,style:{width:"100%",borderColor:s?"#ff4d4f":void 0,backgroundColor:s?"#fff2f0":void 0},onPressEnter:e=>{if(void 0!==i){const t=e.target,n=parseInt(t.value)||0;qe(i,"qty",n)}},onBlur:e=>{if(void 0!==i){const t=e.target,n=parseInt(t.value)||0;qe(i,"qty",n)}},onChange:e=>{null!==e&&e>a&&T.Ay.error("Pack quantity cannot exceed available packs (".concat(a,")"))}})})}},{key:"loose_qty",title:"\ud83d\udccb LOOSE",dataIndex:"loose_qty",type:"number",width:90,render:(e,t,i)=>{var n,l,o;const a=Te?S:k,s=null===a||void 0===a||null===(n=a.result)||void 0===n?void 0:n.find((e=>e._id===t.stock_id));if(!s)return(0,X.jsx)("div",{style:{position:"relative"},children:(0,X.jsx)(D.A,{value:e,min:0,style:{width:"100%"},disabled:!0})});const d=null===s||void 0===s||null===(l=s.ProductItem)||void 0===l||null===(o=l.VariantItem)||void 0===o?void 0:o.pack_size,r=d?parseInt(d):1,c=(null===s||void 0===s?void 0:s.available_quantity)||0,u=(null===s||void 0===s?void 0:s.available_loose_quantity)||0,m=c-(t.qty||0),p=m*r+u,v=e>p;return(0,X.jsx)("div",{style:{position:"relative"},children:(0,X.jsx)(D.A,{value:e,min:0,max:p,style:{width:"100%",borderColor:v?"#ff4d4f":void 0,backgroundColor:v?"#fff2f0":void 0},onPressEnter:e=>{if(void 0!==i){const t=e.target,n=parseInt(t.value)||0;qe(i,"loose_qty",n)}},onBlur:e=>{if(void 0!==i){const t=e.target,n=parseInt(t.value)||0;qe(i,"loose_qty",n)}},onChange:e=>{null!==e&&e>p&&T.Ay.error("Loose quantity cannot exceed available loose items (".concat(p," = ").concat(m," remaining packs \xd7 ").concat(r," + ").concat(u," loose)"))}})})}},{key:"price",title:"\ud83d\udcb0 RATE",dataIndex:"price",type:"number",required:!0,width:120,editable:!1,render:e=>(0,X.jsx)(D.A,{value:e,disabled:!0,style:{width:"100%"}})},{key:"amount",title:"\ud83d\udcb5 AMOUNT",dataIndex:"amount",type:"number",editable:!1,width:130,render:e=>(0,X.jsx)(D.A,{value:e,disabled:!0,style:{width:"100%"}})}]),[Ee,Te,S,k,qe]),Ve=ze.findIndex((e=>"qty"===e.key||"qty"===e.dataIndex)),Fe=(0,l.useMemo)((()=>ie.items.length?(0,M.l)({items:ie.items,productList:(null===h||void 0===h?void 0:h.result)||[],isGstIncluded:le.isGstIncluded,discount:le.discount,discountType:le.discountType}):{sub_total:0,value_of_goods:0,total_gst:0,cgst:0,sgst:0,total_amount:0,discountValue:0}),[ie.items,h,le]),Re=(0,l.useCallback)((e=>{const t=e[0];if(t){var i,l;const e=null===f||void 0===f||null===(i=f.result)||void 0===i?void 0:i.find((e=>e._id===t.customer_id)),o=null===b||void 0===b||null===(l=b.result)||void 0===l?void 0:l.find((e=>e._id===t.billed_by_id));ne((i=>(0,n.A)((0,n.A)({},i),{},{invoice_no:t.invoice_no||"",date:t.date||C()().format("YYYY-MM-DD"),customer_id:t.customer_id||"",customer_name:(null===e||void 0===e?void 0:e.full_name)||"",billed_by_id:t.billed_by_id||"",billed_by_name:(null===o||void 0===o?void 0:o.name)||"",payment_mode:t.payment_mode||"cash"})))}}),[f,b]),Ye=(0,l.useCallback)((e=>{const t=e.map((e=>{var t;const i={product_id:e.product_id||"",product_name:(null===(t=Ee.find((t=>t.value===e.product_id)))||void 0===t?void 0:t.label)||"",variant_name:e.variant_name||"",stock_id:e.stock_id||"",batch_no:e.batch_no||"",qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price||0,mrp:e.mrp||0,amount:e.amount||0,tax_percentage:e.tax_percentage||0};if(e.stock_id&&(e.qty||e.loose_qty)){var n;const t=Te?S:k,a=null===t||void 0===t||null===(n=t.result)||void 0===n?void 0:n.find((t=>t._id===e.stock_id));if(a){var l,o;const t=null===a||void 0===a||null===(l=a.ProductItem)||void 0===l||null===(o=l.VariantItem)||void 0===o?void 0:o.pack_size,n=t?parseInt(t):1,s=a.available_quantity||0,d=a.available_loose_quantity||0;e.qty&&e.qty>s&&(T.Ay.error("Pack quantity (".concat(e.qty,") exceeds available packs (").concat(s,")")),i.qty=s);const r=s-(e.qty||0),c=r*n+d;e.loose_qty&&e.loose_qty>c&&(T.Ay.error("Loose quantity (".concat(e.loose_qty,") exceeds available loose items (").concat(c," = ").concat(r," remaining packs \xd7 ").concat(n," + ").concat(d," loose)")),i.loose_qty=c)}}if(e.product_id&&!e.stock_id){var a;const t=Te?S:k,n=(null===t||void 0===t||null===(a=t.result)||void 0===a?void 0:a.filter((t=>{var i;return t.product===e.product_id||(null===(i=t.ProductItem)||void 0===i?void 0:i._id)===e.product_id})))||[];if(n.length>0){const t=n[0];i.stock_id=t._id,i.batch_no=t.batch_no||"",setTimeout((()=>{const t=document.querySelector('td[data-row-key="'.concat(e.key,'"][data-column-key="qty"]'));t&&t.focus()}),300)}}return i})).map((e=>{var t;if(!e.product_id||!e.stock_id)return e;const i=Te?S:k,l=null===i||void 0===i||null===(t=i.result)||void 0===t?void 0:t.find((t=>t._id===e.stock_id));if(l){var o,a,s,d,r;const t=l.sell_price||0,i=null===l||void 0===l||null===(o=l.ProductItem)||void 0===o||null===(a=o.VariantItem)||void 0===a?void 0:a.pack_size,c=t/(i?parseInt(i):1),u=(e.qty||0)*t+(e.loose_qty||0)*c,m=null===h||void 0===h||null===(s=h.result)||void 0===s?void 0:s.find((t=>t._id===e.product_id)),p=(null===m||void 0===m||null===(d=m.CategoryItem)||void 0===d?void 0:d.tax_percentage)||0;let v=u;return le.isGstIncluded||(v=u+u*p/100),(0,n.A)((0,n.A)({},e),{},{price:e.price||t,mrp:l.mrp||t,amount:v,tax_percentage:p,product_name:(null===m||void 0===m?void 0:m.name)||"",variant_name:(null===m||void 0===m||null===(r=m.VariantItem)||void 0===r?void 0:r.variant_name)||"",batch_no:l.batch_no||""})}return e}));ne((e=>(0,n.A)((0,n.A)({},e),{},{items:t})))}),[Ee,Te,S,k,h,le]),Oe=(0,l.useCallback)(((e,t)=>{if(t<0||t>=ie.items.length)return console.error("Invalid rowIndex: ".concat(t,". Items length: ").concat(ie.items.length)),void T.Ay.error("Invalid row index: ".concat(t,". Please try again."));const i=[...ie.items];if(!i[t])return console.error("Item at index ".concat(t," is undefined. Items length: ").concat(i.length)),void T.Ay.error("Selected row is no longer valid. Please try again.");i[t].product_id=e.id||e._id||"",i[t].product_name=e.name||"",i[t].price=e.selling_price||0,Ye(i),se(t)}),[Ye,ie.items.length]),Ue=()=>{if(null!==ae)return se(null),T.Ay.info("Stock modal closed. Opening product selection..."),void setTimeout((()=>{We()}),100);We()},We=()=>{let e=-1;const t=document.activeElement,i=null===t||void 0===t?void 0:t.closest("tr");if(i){const t=i.getAttribute("data-row-key");null!==t&&(e=parseInt(t))}else{const i=null===t||void 0===t?void 0:t.closest("td");if(i){const t=i.closest("tr");if(t){const i=t.getAttribute("data-row-key");null!==i&&(e=parseInt(i))}}}-1===e&&de&&(e=de.row),-1===e&&Ne<ie.items.length&&(e=Ne),-1===e&&(e=ie.items.findIndex((e=>!e.product_id))),-1===e&&(tt(),e=ie.items.length),Se(e),Ie(!0),T.Ay.info("Opening product selection for row ".concat(e+1))},Qe=(0,l.useCallback)((()=>{Se(0),Ie(!0),T.Ay.success("\ud83c\udf89 Bill saved! Ready for next bill - Select product to continue.",4)}),[]),Xe=()=>{let e=-1;const t=document.activeElement,i=null===t||void 0===t?void 0:t.closest("tr");if(i){const t=i.getAttribute("data-row-key");if(null!==t){var n;const i=parseInt(t);null!==(n=ie.items[i])&&void 0!==n&&n.product_id&&(e=i)}}-1===e&&(e=ie.items.findIndex((e=>e.product_id&&!e.stock_id))),-1===e&&(e=ie.items.findIndex((e=>e.product_id))),-1!==e?(se(e),T.Ay.info("Opening stock selection for row ".concat(e+1))):T.Ay.warning("Please select a product first before selecting stock")},He=(0,l.useCallback)((e=>{ie.customer_id!==e._id&&(ne((t=>(0,n.A)((0,n.A)({},t),{},{customer_id:e._id,customer_name:e.full_name}))),setTimeout((()=>{ue(!1),setTimeout((()=>{pe(!0)}),100)}),50),T.Ay.success('Customer "'.concat(e.full_name,'" selected successfully!')))}),[ie.customer_id]),Ke=(0,l.useCallback)((e=>{ie.billed_by_id!==e._id&&(ne((t=>(0,n.A)((0,n.A)({},t),{},{billed_by_id:e._id,billed_by_name:e.name}))),setTimeout((()=>{pe(!1)}),50),T.Ay.success('User "'.concat(e.name,'" selected as billed by successfully!')))}),[ie.billed_by_id]),Je=()=>{Ze(!1),xe(!1),fe(null),T.Ay.success("New bill form cleared successfully!")},Ze=(0,l.useCallback)((function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];ne({invoice_no:"",date:C()().format("YYYY-MM-DD"),customer_id:"",customer_name:"",payment_mode:"cash",items:[{product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0}]}),oe({isPaid:!0,isPartiallyPaid:!1,isRetail:!0,isGstIncluded:!0,discount:0,discountType:"percentage",paidAmount:0}),se(null),re(null),ue(!1),xe(!1),he(!1),fe(null),Ae(!1),je(""),Ie(!1),Se(null),y("GetAll"),e&&T.Ay.success("Ready for next bill!",2)}),[]),$e=()=>{Ze(!1),T.Ay.success("Bill form cleared successfully!")},et=()=>{if(0===ie.items.length)return;let e=!1;const t=ie.items.map((t=>{let i=!1;if(t.product_id&&null!==h&&void 0!==h&&h.result){const e=h.result.find((e=>e._id===t.product_id));var n;if(e&&(t.product_name.includes("Loading...")||t.product_name.includes("Product ID:")||!t.product_name))t.product_name=e.name,t.variant_name=(null===(n=e.VariantItem)||void 0===n?void 0:n.variant_name)||"",i=!0}if(t.stock_id){const e=Te?S:k;if(null!==e&&void 0!==e&&e.result){var l;const n=e.result.find((e=>e._id===t.stock_id));n&&(null!==(l=t.batch_no)&&void 0!==l&&l.includes("Loading...")||!t.batch_no)&&(t.batch_no=n.batch_no||"",i=!0)}}return i&&(e=!0),t}));e&&ne((e=>(0,n.A)((0,n.A)({},e),{},{items:t})))},tt=()=>{const e={product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0};ne((t=>(0,n.A)((0,n.A)({},t),{},{items:[...t.items,e]})))},it=async()=>{if(!ie.invoice_no||!ie.customer_id||!ie.items.length)return void T.Ay.error("Please fill all required fields");if(ie.items.some((e=>!e.product_id||!e.stock_id||!e.qty&&!e.loose_qty||!e.price)))return void T.Ay.error("Please complete all item details");const e=[];if(ie.items.forEach(((t,i)=>{if(t.stock_id&&(t.qty||t.loose_qty)){const n=De(t.stock_id,t.qty||0,t.loose_qty||0);n.isValid||e.push("Row ".concat(i+1,": ").concat(n.message))}})),e.length>0)return void T.Ay.error("Stock validation errors:\n".concat(e.join("\n")));if(!ie.customer_id)return void T.Ay.error("Please select a customer");if(!ie.payment_mode)return void T.Ay.error("Please select a payment mode");const t=(0,n.A)((0,n.A)({invoice_no:ie.invoice_no,date:ie.date,customer_id:ie.customer_id,billed_by_id:ie.billed_by_id,payment_mode:ie.payment_mode,items:ie.items.map((e=>(0,n.A)((0,n.A)({product_id:e.product_id,stock_id:e.stock_id},Te&&{branch_stock_id:e.stock_id}),{},{qty:e.qty,loose_qty:e.loose_qty,price:e.price,mrp:e.mrp,amount:e.amount,tax_percentage:e.tax_percentage,_id:e._id})))},Fe),{},{discount:le.discount,discount_type:le.discountType,is_paid:le.isPaid,is_partially_paid:le.isPartiallyPaid,sale_type:le.isRetail?"retail":"wholesale",is_gst_included:le.isGstIncluded,paid_amount:le.isPartiallyPaid?le.paidAmount:le.isPaid?Fe.total_amount:0});try{var l;let e;if(e=i?await x("Update",t,i._id):await x("Create",t),200===(null===(l=e)||void 0===l?void 0:l.statusCode)){const e=(0,n.A)((0,n.A)({},t),{},{customer_name:ie.customer_name,total_amount:Fe.total_amount,invoice_no:t.invoice_no,date:t.date});fe(e),i&&xe(!0)}}catch(o){T.Ay.error("Failed to save bill. Please try again.")}},{items:nt,error:lt}=(0,w.Sm)(x.getIdentifier("Create")),{items:ot}=(0,w.Sm)(x.getIdentifier("Update"));return(0,B.z)({action:"update",title:"Bill",identifier:x.getIdentifier("Update"),entityApi:x}),(0,l.useEffect)((()=>{200===(null===nt||void 0===nt?void 0:nt.statusCode)&&(null===o||void 0===o||o(),y("Create"),i||(xe(!1),setTimeout((()=>{Ze(!1),setTimeout((()=>{Qe()}),200)}),100)))}),[nt,i,Ze,o,Qe]),(0,l.useEffect)((()=>{lt&&T.Ay.error(null===lt||void 0===lt?void 0:lt.message)}),[lt]),(0,l.useEffect)((()=>{200===(null===ot||void 0===ot?void 0:ot.statusCode)&&(null===o||void 0===o||o())}),[ot]),(0,l.useEffect)((()=>{if(null!==h&&void 0!==h&&h.result&&ie.items.length>0){if(ie.items.some((e=>e.product_id&&(!e.product_name||e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))))){const e=ie.items.map((e=>{if(e.product_id&&(!e.product_name||e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))){const i=h.result.find((t=>t._id===e.product_id));var t;if(i)return(0,n.A)((0,n.A)({},e),{},{product_name:i.name,variant_name:(null===(t=i.VariantItem)||void 0===t?void 0:t.variant_name)||""})}return e}));e.some(((e,t)=>e.product_name!==ie.items[t].product_name))&&ne((t=>(0,n.A)((0,n.A)({},t),{},{items:e})))}}}),[h,ie.items]),(0,l.useEffect)((()=>{null!==h&&void 0!==h&&h.result&&ie.items.length>0&&setTimeout((()=>{et()}),200)}),[h]),(0,l.useEffect)((()=>{const e=Te?S:k;if(null!==e&&void 0!==e&&e.result&&ie.items.length>0){if(ie.items.some((e=>e.stock_id&&(!e.batch_no||e.batch_no.includes("Loading..."))))){const t=ie.items.map((t=>{if(t.stock_id&&(!t.batch_no||t.batch_no.includes("Loading..."))){const i=e.result.find((e=>e._id===t.stock_id));if(i)return(0,n.A)((0,n.A)({},t),{},{batch_no:i.batch_no||""})}return t}));t.some(((e,t)=>e.batch_no!==ie.items[t].batch_no))&&ne((e=>(0,n.A)((0,n.A)({},e),{},{items:t})))}}}),[S,k,ie.items,Te]),(0,l.useEffect)((()=>{const e=Te?S:k;null!==e&&void 0!==e&&e.result&&ie.items.length>0&&setTimeout((()=>{et()}),200)}),[S,k,Te]),(0,l.useEffect)((()=>{if(ie.items.length>0){const e=setInterval((()=>{ie.items.some((e=>e.product_id&&(!e.product_name||e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))||e.stock_id&&(!e.batch_no||e.batch_no.includes("Loading..."))))&&(null!==h&&void 0!==h&&h.result||(Te?null===S||void 0===S?void 0:S.result:null===k||void 0===k?void 0:k.result))&&et()}),1e3);return()=>clearInterval(e)}}),[ie.items,h,S,k,Te]),(0,l.useEffect)((()=>{const e=e=>{if("F1"===e.key)e.preventDefault(),tt(),setTimeout((()=>{const e=document.querySelector('.ant-table-tbody tr:last-child td[data-column-key="product_id"]');null===e||void 0===e||e.focus()}),200);else if("F2"===e.key)e.preventDefault(),it();else if("F3"===e.key)e.preventDefault(),T.Ay.info("Print functionality coming soon!");else if("F4"===e.key)e.preventDefault(),$e();else if("F5"===e.key)e.preventDefault(),Ue();else if("End"===e.key)e.preventDefault(),ue(!0);else if("F6"===e.key)e.preventDefault(),he(!0);else if("F7"===e.key)e.preventDefault(),Xe();else if(e.ctrlKey)switch(e.key){case"s":e.preventDefault(),it();break;case"n":e.preventDefault(),tt(),setTimeout((()=>{const e=document.querySelector('.ant-table-tbody tr:last-child td[data-column-key="product_id"]');null===e||void 0===e||e.focus()}),200);break;case"p":e.preventDefault(),T.Ay.info("Print functionality coming soon!");break;case"r":e.preventDefault(),Ze();break;case"u":e.preventDefault(),pe(!0)}else if(e.ctrlKey&&/^[0-9]$/.test(e.key)){e.preventDefault();const t=document.activeElement;if(null!==t&&void 0!==t&&t.closest('td[data-column-key="qty"]')){const i=t.querySelector("input");i&&(i.value=e.key,i.dispatchEvent(new Event("change",{bubbles:!0})))}}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[ie,le,Ue,Xe,ae]),(0,X.jsxs)("div",{className:Q.A.mainContainer,children:[(0,X.jsx)("div",{className:Q.A.backgroundCircle1}),(0,X.jsx)("div",{className:Q.A.backgroundCircle2}),(0,X.jsx)("div",{className:Q.A.backgroundCircle3}),(0,X.jsx)("div",{className:Q.A.backgroundCircle4}),(0,X.jsx)("div",{className:Q.A.backgroundCircle5}),(0,X.jsxs)("div",{className:Q.A.headerContainer,children:[(0,X.jsx)("div",{className:Q.A.headerCircle1}),(0,X.jsx)("div",{className:Q.A.headerCircle2}),(0,X.jsx)("div",{className:Q.A.headerCircle3}),(0,X.jsx)("div",{className:Q.A.headerCircle4}),(0,X.jsx)("div",{className:Q.A.headerCircle5}),(0,X.jsxs)("div",{className:Q.A.headerContent,children:[(0,X.jsxs)("div",{className:Q.A.titleSection,children:[(0,X.jsx)("div",{className:Q.A.titleIcon,children:(0,X.jsx)(v.A,{style:{fontSize:"24px",color:"white"}})}),(0,X.jsxs)("div",{children:[(0,X.jsx)(H,{level:4,className:Q.A.titleText,children:i?"\u26a1 EDIT INVOICE":"\ud83d\ude80 NEW INVOICE"}),(0,X.jsxs)(K,{className:Q.A.subtitleText,children:["\u26a1Lightning Fast \u2022 ",C()().format("DD MMM YYYY, dddd")]})]})]}),(0,X.jsxs)("div",{className:Q.A.controlsSection,children:[(0,X.jsxs)("div",{className:"".concat(Q.A.controlGroup," ").concat(Q.A.saleTypeControl),children:[(0,X.jsx)(K,{className:Q.A.controlLabel,children:"\ud83c\udfea SALE TYPE"}),(0,X.jsx)(q.A,{checkedChildren:"RETAIL",unCheckedChildren:"WHOLESALE",checked:le.isRetail,onChange:e=>oe((t=>(0,n.A)((0,n.A)({},t),{},{isRetail:e}))),className:Q.A.saleTypeSwitch,size:"small"})]}),(0,X.jsxs)("div",{className:"".concat(Q.A.controlGroup," ").concat(Q.A.gstControl),children:[(0,X.jsx)(K,{className:Q.A.controlLabel,children:"\ud83d\udcca GST"}),(0,X.jsx)(q.A,{checkedChildren:"INCL",unCheckedChildren:"EXCL",checked:le.isGstIncluded,onChange:e=>oe((t=>(0,n.A)((0,n.A)({},t),{},{isGstIncluded:e}))),className:Q.A.gstSwitch,size:"small"})]}),(0,X.jsxs)("div",{className:"".concat(Q.A.controlGroup," ").concat(Q.A.paymentControl),children:[(0,X.jsx)(K,{className:Q.A.controlLabel,children:"\ud83d\udcb3 PAYMENT"}),(0,X.jsx)(q.A,{checkedChildren:"PAID",unCheckedChildren:"UNPAID",checked:le.isPaid,onChange:e=>oe((t=>(0,n.A)((0,n.A)({},t),{},{isPaid:e,isPartiallyPaid:!e&&t.isPartiallyPaid}))),className:Q.A.paymentSwitch,size:"small"})]}),!le.isPaid&&(0,X.jsxs)("div",{className:"".concat(Q.A.controlGroup," ").concat(Q.A.partialPaymentControl),children:[(0,X.jsx)(K,{className:Q.A.controlLabel,children:"\ud83d\udcb0 PARTIAL"}),(0,X.jsx)(q.A,{checkedChildren:"YES",unCheckedChildren:"NO",checked:le.isPartiallyPaid,onChange:e=>oe((t=>(0,n.A)((0,n.A)({},t),{},{isPartiallyPaid:e}))),className:Q.A.partialPaymentSwitch,size:"small"})]}),(0,X.jsxs)("div",{className:Q.A.badgesContainer,children:[(0,X.jsx)("div",{className:Q.A.itemsBadge,children:(0,X.jsxs)(K,{className:Q.A.badgeText,children:["\ud83c\udfaf ITEMS: ",ie.items.length]})}),(0,X.jsx)("div",{className:Q.A.amountBadge,children:(0,X.jsxs)(K,{className:Q.A.badgeText,children:["\ud83d\udcb0 \u20b9",Fe.total_amount.toFixed(2)]})})]})]})]})]}),(0,X.jsx)("div",{className:Q.A.invoiceDetailsGrid,children:(0,X.jsx)(L.A,{columns:Be,dataSource:Ge,onSave:Re,allowAdd:!1,allowDelete:!1,loading:g,className:"compact-header-grid",size:"small",rowKey:"invoice_no"})}),(0,X.jsxs)("div",{className:Q.A.itemsSection,children:[(0,X.jsx)("div",{className:Q.A.itemsCircle1}),(0,X.jsx)("div",{className:Q.A.itemsCircle2}),(0,X.jsxs)("div",{className:Q.A.billItemsGrid,children:[(0,X.jsxs)("div",{className:Q.A.billItemsHeader,children:[(0,X.jsx)(K,{className:Q.A.billItemsTitle,children:"\ud83d\uded2 BILL ITEMS"}),(0,X.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,X.jsx)(E.A,{count:ie.items.length,showZero:!0,size:"small",style:{backgroundColor:"rgba(255,255,255,0.2)"},children:(0,X.jsx)(K,{className:Q.A.billItemsBadge,children:"Items"})}),(0,X.jsx)(K,{style:{fontSize:"10px",color:"#666",backgroundColor:"#f0f0f0",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d9d9d9"}})]})]}),(0,X.jsx)(L.A,{columns:ze,dataSource:ie.items.map(((e,t)=>(0,n.A)((0,n.A)({},e),{},{key:t.toString()}))),onSave:Ye,onAdd:tt,onDelete:e=>{ne((t=>{const i=t.items.filter(((t,i)=>!e.includes(null===i||void 0===i?void 0:i.toString())));return(0,n.A)((0,n.A)({},t),{},{items:i})}))},onProductSelect:Oe,loading:_||I||J,className:"modern-bill-grid",size:"small",rowKey:"key",externalEditingCell:de})]}),(0,X.jsxs)("div",{className:Q.A.billSummary,children:[(0,X.jsx)("div",{className:Q.A.summaryCircle1}),(0,X.jsx)("div",{className:Q.A.summaryCircle2}),(0,X.jsx)("div",{className:Q.A.summaryHeader,children:(0,X.jsx)(K,{className:Q.A.summaryTitle,children:"\ud83d\udcb0 BILL SUMMARY"})}),(0,X.jsxs)("div",{className:Q.A.summaryTable,children:[(0,X.jsxs)("div",{className:Q.A.summaryRow,children:[(0,X.jsx)(K,{className:Q.A.summaryLabel,children:"Sub Total:"}),(0,X.jsxs)(K,{className:Q.A.summaryValue,children:["\u20b9",Fe.sub_total.toFixed(2)]})]}),(0,X.jsxs)("div",{className:Q.A.summaryRow,children:[(0,X.jsx)(K,{className:Q.A.summaryLabel,children:"Value of Goods:"}),(0,X.jsxs)(K,{className:Q.A.summaryValue,children:["\u20b9",Fe.value_of_goods.toFixed(2)]})]}),(0,X.jsxs)("div",{className:Q.A.summaryRow,children:[(0,X.jsx)(K,{className:Q.A.summaryLabel,children:"Total GST:"}),(0,X.jsxs)(K,{className:Q.A.summaryValue,children:["\u20b9",Fe.total_gst.toFixed(2)]})]}),(0,X.jsxs)("div",{className:Q.A.summaryRow,children:[(0,X.jsx)(K,{className:Q.A.summaryLabel,children:"CGST:"}),(0,X.jsxs)(K,{className:Q.A.summaryValue,children:["\u20b9",Fe.cgst.toFixed(2)]})]}),(0,X.jsxs)("div",{className:Q.A.summaryRow,children:[(0,X.jsx)(K,{className:Q.A.summaryLabel,children:"SGST:"}),(0,X.jsxs)(K,{className:Q.A.summaryValue,children:["\u20b9",Fe.sgst.toFixed(2)]})]}),le.discount>0&&(0,X.jsxs)("div",{className:Q.A.summaryRow,children:[(0,X.jsx)(K,{className:Q.A.summaryLabel,children:"DISCOUNT:"}),(0,X.jsxs)(K,{className:Q.A.discountValue,children:["-\u20b9","percentage"===le.discountType?((Fe.sub_total+Fe.total_gst)*("number"===typeof le.discount?le.discount:0)/100).toFixed(2):("number"===typeof le.discount?le.discount:0).toFixed(2)]})]}),(0,X.jsxs)("div",{className:Q.A.totalAmountRow,children:[(0,X.jsx)(K,{className:Q.A.totalAmountLabel,children:"NET/EXC/REPL:"}),(0,X.jsxs)(K,{className:Q.A.totalAmountValue,children:["\u20b9",Fe.total_amount.toFixed(2)]})]}),le.isPartiallyPaid&&(0,X.jsxs)("div",{className:Q.A.partialPaymentInfo,children:[(0,X.jsxs)("div",{className:Q.A.partialPaymentRow,children:[(0,X.jsx)(K,{className:Q.A.partialPaymentLabel,children:"Paid Amount:"}),(0,X.jsxs)(K,{className:Q.A.partialPaymentValue,children:["\u20b9",("number"===typeof le.paidAmount?le.paidAmount:0).toFixed(2)]})]}),(0,X.jsxs)("div",{className:Q.A.partialPaymentRow,children:[(0,X.jsx)(K,{className:Q.A.partialPaymentLabel,children:"Balance:"}),(0,X.jsxs)(K,{className:Q.A.partialPaymentValue,children:["\u20b9",(Fe.total_amount-("number"===typeof le.paidAmount?le.paidAmount:0)).toFixed(2)]})]})]})]}),(0,X.jsxs)("div",{className:Q.A.controlsContainer,children:[(0,X.jsxs)("div",{className:Q.A.discountControl,children:[(0,X.jsx)(K,{className:Q.A.discountControlLabel,children:"\ud83d\udcb8 DISCOUNT"}),(0,X.jsxs)("div",{className:Q.A.discountControlInputs,children:[(0,X.jsx)(D.A,{min:0,value:le.discount,onChange:e=>oe((t=>(0,n.A)((0,n.A)({},t),{},{discount:e||0}))),style:{width:70},size:"small"}),(0,X.jsx)(q.A,{checkedChildren:"%",unCheckedChildren:"\u20b9",checked:"percentage"===le.discountType,onChange:e=>oe((t=>(0,n.A)((0,n.A)({},t),{},{discountType:e?"percentage":"amount"}))),size:"small"})]})]}),le.isPartiallyPaid&&(0,X.jsxs)("div",{className:Q.A.partialPaymentControl,children:[(0,X.jsx)(K,{className:Q.A.partialPaymentControlLabel,children:"\ud83d\udcb0 PARTIAL PAY"}),(0,X.jsx)(D.A,{min:0,max:Fe.total_amount,value:le.paidAmount,onChange:e=>oe((t=>(0,n.A)((0,n.A)({},t),{},{paidAmount:e||0}))),style:{width:90},size:"small",formatter:e=>"\u20b9".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>Number(e.replace(/\u20b9\s?|(,*)/g,""))})]})]})]})]}),(0,X.jsxs)("div",{className:Q.A.actionHub,children:[(0,X.jsx)("div",{className:Q.A.actionHubCircle1}),(0,X.jsx)("div",{className:Q.A.actionHubCircle2}),(0,X.jsx)("div",{className:Q.A.actionHubCircle3}),(0,X.jsx)("div",{className:Q.A.actionHubCircle4}),(0,X.jsxs)("div",{className:Q.A.actionButtonsContainer,children:[(0,X.jsxs)(c.Ay,{type:"primary",size:"large",icon:(0,X.jsx)(G.A,{}),onClick:it,loading:te,className:Q.A.saveButton,children:["\ud83d\ude80 ",i?"UPDATE":"SAVE BILL"," (F2)"]}),(0,X.jsx)(c.Ay,{size:"large",icon:(0,X.jsx)(v.A,{}),onClick:()=>he(!0),className:Q.A.billListButton,children:"\ud83d\udccb BILL LIST (F6)"}),(0,X.jsx)(c.Ay,{size:"large",icon:(0,X.jsx)(z.A,{}),onClick:$e,className:Q.A.clearButton,children:"\ud83e\uddf9 CLEAR (F4 / Ctrl+R)"}),(0,X.jsx)(c.Ay,{size:"large",icon:(0,X.jsx)(A.A,{}),className:Q.A.printButton,children:"\ud83d\udda8\ufe0f PRINT (F3)"})]}),(0,X.jsx)("div",{style:{background:"linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)",padding:"14px 18px",borderRadius:"10px",border:"1px solid #cbd5e1",position:"relative",zIndex:1,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.05)"},children:(0,X.jsx)("div",{style:{textAlign:"right"},children:(0,X.jsxs)(K,{style:{color:"#475569",fontSize:"12px",display:"block",fontWeight:600,lineHeight:"18px"},children:["\u26a1 ",(0,X.jsx)("strong",{children:"Keyboard Shortcuts:"})," Ctrl+S (Save) \u2022 Ctrl+N (Add) \u2022 F4/Ctrl+R (Clear) \u2022 Tab/Shift+Tab (Navigate) \u2022 Enter (Edit) \u2022 Esc (Cancel) \u2022 End (Customer) \u2022 Ctrl+U (User) \u2022 F5 (Product) \u2022 F6 (Bill List) \u2022 F7 (Stock)"]})})})]}),null!==ae&&(0,X.jsx)(V.A,{visible:!0,onSelect:e=>{if(null===ae)return;if(ae<0||ae>=ie.items.length)return console.error("Invalid stockModalRowIndex: ".concat(ae,". Items length: ").concat(ie.items.length)),T.Ay.error("Invalid row index: ".concat(ae,". Please try again.")),void se(null);const t=[...ie.items];if(!t[ae])return console.error("Item at index ".concat(ae," is undefined. Items length: ").concat(t.length)),T.Ay.error("Selected row is no longer valid. Please try again."),void se(null);t[ae].stock_id=e.id||e._id||e.invoice_id||"",t[ae].batch_no=e.batch_no||"",Ye(t),se(null),-1!==Ve&&re({row:ae,col:Ve})},onCancel:()=>se(null),productId:(null===(t=ie.items[ae])||void 0===t?void 0:t.product_id)||""}),(0,X.jsx)(F.A,{visible:ce,onSelect:He,onCancel:()=>ue(!1)}),(0,X.jsx)(R.A,{visible:me,onSelect:Ke,onCancel:()=>pe(!1)}),(0,X.jsx)(Y.A,{visible:ve,onNewBill:Je,onContinueBill:()=>{xe(!1),fe(null)},onCancel:()=>xe(!1),savedBillData:_e}),(0,X.jsx)(U.A,{visible:ge,onCancel:()=>Ae(!1),productId:be}),(0,X.jsx)(W.A,{visible:ke,onSelect:e=>{var t;if(null===Ce)return;if(Ce<0||Ce>=ie.items.length)return console.error("Invalid productSelectionRowIndex: ".concat(Ce,". Items length: ").concat(ie.items.length)),T.Ay.error("Invalid row index: ".concat(Ce,". Please try again.")),void Se(null);const i=[...ie.items];if(!i[Ce])return console.error("Item at index ".concat(Ce," is undefined. Items length: ").concat(i.length)),T.Ay.error("Selected row is no longer valid. Please try again."),void Se(null);i[Ce].product_id=e._id||"",i[Ce].product_name=e.name||"",i[Ce].variant_name=(null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)||"",i[Ce].price=e.selling_price||0,Ye(i),Ie(!1),Se(null),se(Ce),T.Ay.success('Product "'.concat(e.name,'" selected successfully!'))},onCancel:()=>{Ie(!1),Se(null)}}),(0,X.jsx)(O.A,{visible:ye,onClose:()=>he(!1),onViewBill:e=>{var t,i,l,o,a;if(!e)return void T.Ay.error("No bill data received");s("GetAll"),r("GetAll"),Te?p("GetAll"):m("GetAll"),null!==h&&void 0!==h&&h.result||s("GetAll"),null!==f&&void 0!==f&&f.result||r("GetAll");const d=Te?S:k;null!==d&&void 0!==d&&d.result||(Te?p("GetAll"):m("GetAll"));let c=[];e.Items&&Array.isArray(e.Items)?c=e.Items:e.items&&Array.isArray(e.items)?c=e.items:e.sales_items&&Array.isArray(e.sales_items)?c=e.sales_items:e.result&&e.result.Items&&Array.isArray(e.result.Items)?c=e.result.Items:e.result&&e.result.items&&Array.isArray(e.result.items)&&(c=e.result.items);const u=c.map(((e,t)=>{var i,l;let o="",a="";var d;if(null!==(i=e.productItems)&&void 0!==i&&i.name)o=e.productItems.name,a=(null===(d=e.productItems.VariantItem)||void 0===d?void 0:d.variant_name)||"";else if(e.product_name)o=e.product_name,a=e.variant_name||"";else if(null!==(l=e.product)&&void 0!==l&&l.name){var r;o=e.product.name,a=(null===(r=e.product.VariantItem)||void 0===r?void 0:r.variant_name)||""}else if(e.product_id){var c;const t=null===h||void 0===h||null===(c=h.result)||void 0===c?void 0:c.find((t=>t._id===e.product_id));var u;if(t)o=t.name,a=(null===(u=t.VariantItem)||void 0===u?void 0:u.variant_name)||"";else null!==h&&void 0!==h&&h.result||s("GetAll"),o="Loading... (ID: ".concat(e.product_id,")"),setTimeout((()=>{if(null!==h&&void 0!==h&&h.result){const i=h.result.find((t=>t._id===e.product_id));if(i){const l=[...ie.items],o=l.findIndex((t=>t.product_id===e.product_id));var t;if(-1!==o)l[o].product_name=i.name,l[o].variant_name=(null===(t=i.VariantItem)||void 0===t?void 0:t.variant_name)||"",ne((e=>(0,n.A)((0,n.A)({},e),{},{items:l})))}}}),100)}let v="",x="";if(e.stock_id?(v=e.stock_id,x=e.batch_no||""):e.branch_stock_id?(v=e.branch_stock_id,x=e.batch_no||""):e.stock&&(v=e.stock,x=e.batch_no||""),v&&!x){var y;const e=Te?S:k,t=null===e||void 0===e||null===(y=e.result)||void 0===y?void 0:y.find((e=>e._id===v));t?x=t.batch_no||"":(null!==e&&void 0!==e&&e.result||(Te?p("GetAll"):m("GetAll")),x="Loading... (Stock: ".concat(v,")"),setTimeout((()=>{const e=Te?S:k;if(null!==e&&void 0!==e&&e.result){const t=e.result.find((e=>e._id===v));if(t){const e=[...ie.items],i=e.findIndex((e=>e.stock_id===v));-1!==i&&(e[i].batch_no=t.batch_no||"",ne((t=>(0,n.A)((0,n.A)({},t),{},{items:e}))))}}}),100))}return{_id:e._id||"",product_id:e.product_id||e.product||"",product_name:o,variant_name:a,stock_id:v,batch_no:x,qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price||0,mrp:e.mrp||e.price||0,amount:e.amount||0,tax_percentage:e.tax_percentage||0}})),v=e.customer_id||"";let x="";if(null!==(t=e.customerDetails)&&void 0!==t&&t.full_name)x=e.customerDetails.full_name;else if(e.customer_name)x=e.customer_name;else if(null!==(i=e.customer)&&void 0!==i&&i.full_name)x=e.customer.full_name;else if(e.customer_id){var y;const t=null===f||void 0===f||null===(y=f.result)||void 0===y?void 0:y.find((t=>t._id===e.customer_id));x=(null===t||void 0===t?void 0:t.full_name)||"Customer ID: ".concat(e.customer_id)}let _=C()().format("YYYY-MM-DD");if(e.date)try{_=C()(e.date).format("YYYY-MM-DD")}catch(b){_=C()().format("YYYY-MM-DD")}let g=[...u];null!==h&&void 0!==h&&h.result&&(g=g.map((e=>{if(e.product_id&&(e.product_name.includes("Loading...")||e.product_name.includes("Product ID:"))){const i=h.result.find((t=>t._id===e.product_id));var t;if(i)return(0,n.A)((0,n.A)({},e),{},{product_name:i.name,variant_name:(null===(t=i.VariantItem)||void 0===t?void 0:t.variant_name)||""})}return e})));const A=Te?S:k;null!==A&&void 0!==A&&A.result&&(g=g.map((e=>{if(e.stock_id&&(e.batch_no.includes("Loading...")||!e.batch_no)){const t=A.result.find((t=>t._id===e.stock_id));if(t)return(0,n.A)((0,n.A)({},e),{},{batch_no:t.batch_no||""})}return e}))),ne({invoice_no:e.invoice_no||"",date:_,customer_id:v,customer_name:x,payment_mode:e.payment_mode||"cash",items:g}),oe({isPaid:null===(l=e.is_paid)||void 0===l||l,isPartiallyPaid:null!==(o=e.is_partially_paid)&&void 0!==o&&o,isRetail:"retail"===e.sale_type||void 0===e.sale_type,isGstIncluded:null===(a=e.is_gst_included)||void 0===a||a,discount:e.discount||0,discountType:e.discount_type||"percentage",paidAmount:e.paid_amount||0}),T.Ay.success('Bill "'.concat(e.invoice_no,'" loaded successfully!')),setTimeout((()=>{et()}),100),setTimeout((()=>{et()}),500),setTimeout((()=>{et()}),1e3)},onNewBill:Je})]})};var Z=i(39249),$=i(8354),ee=i(42261),te=i(46237),ie=i(4394),ne=i(87977);const le="EmailSendModal_emailSendModal__BfdYk",oe="EmailSendModal_emailSendHeader__C2GeM",ae="EmailSendModal_emailSendContent__18hO-",se="EmailSendModal_emailForm__Dz-ws",de="EmailSendModal_formSection__XePkG",re="EmailSendModal_formActions__0+vVX",ce="EmailSendModal_emailPreview__z0YAf",ue="EmailSendModal_previewContent__i+Cpp",me="EmailSendModal_previewHeader__Y+2Wh",pe="EmailSendModal_previewBody__wL6Yl",ve="EmailSendModal_htmlPreview__Lr4X+",xe="EmailSendModal_previewActions__l-Y3Y",ye="EmailSendModal_billInfo__1yHvY",he="EmailSendModal_successState__gVP0P",_e="EmailSendModal_successIcon__levgm",{Title:fe,Text:ge}=o.A,{TextArea:Ae}=m.A,be=e=>{var t;let{visible:i,onClose:n,billData:o,customerEmail:s,customerName:d}=e;const[u]=a.A.useForm(),[v,x]=(0,l.useState)(!1),[y,h]=(0,l.useState)(!1),[_,A]=(0,l.useState)(null),[b,j]=(0,l.useState)(!1),[k,I]=(0,l.useState)(!1),{getEntityApi:C}=(0,N.p)();(0,l.useEffect)((()=>{i&&s&&u.setFieldsValue({to:s,subject:"Invoice #".concat((null===o||void 0===o?void 0:o.invoice_no)||""," - ").concat(d||"")})}),[i,s,d,o,u]);const S=e=>{var t,i;return"\nDear ".concat((null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||"Valued Customer",",\n\nThank you for your business! Please find your invoice details below:\n\nInvoice Number: ").concat(e.invoice_no,"\nDate: ").concat(new Date(e.date).toLocaleDateString(),"\nTotal Amount: \u20b9").concat(e.total_amount||0,"\n\nItems:\n").concat((null===(i=e.Items)||void 0===i?void 0:i.map((e=>{var t;return"- ".concat(null===(t=e.productItems)||void 0===t?void 0:t.name," (").concat(e.qty," x \u20b9").concat(e.price,") = \u20b9").concat(e.amount)})).join("\n"))||"No items","\n\nPayment Status: ").concat(e.is_paid?"Paid":"Pending","\n\nThank you for choosing us!\n\nBest regards,\nSubriva Billing Team\n    ").trim()},w=e=>{var t,i,n;return'\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset="UTF-8">\n        <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .header { background: #f8f9fa; padding: 20px; text-align: center; }\n            .content { padding: 20px; }\n            .invoice-table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n            .invoice-table th, .invoice-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n            .invoice-table th { background-color: #f8f9fa; }\n            .total { font-weight: bold; font-size: 18px; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; margin-top: 20px; }\n        </style>\n    </head>\n    <body>\n        <div class="header">\n            <h1>Subriva Billing</h1>\n            <h2>Invoice #'.concat(e.invoice_no,'</h2>\n        </div>\n        \n        <div class="content">\n            <p>Dear <strong>').concat((null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||"Valued Customer",'</strong>,</p>\n            \n            <p>Thank you for your business! Please find your invoice details below:</p>\n            \n            <table class="invoice-table">\n                <tr>\n                    <th>Invoice Number</th>\n                    <td>').concat(e.invoice_no,"</td>\n                </tr>\n                <tr>\n                    <th>Date</th>\n                    <td>").concat(new Date(e.date).toLocaleDateString(),"</td>\n                </tr>\n                <tr>\n                    <th>Customer</th>\n                    <td>").concat((null===(i=e.customerDetails)||void 0===i?void 0:i.full_name)||"N/A",'</td>\n                </tr>\n            </table>\n            \n            <h3>Items:</h3>\n            <table class="invoice-table">\n                <thead>\n                    <tr>\n                        <th>Product</th>\n                        <th>Quantity</th>\n                        <th>Price</th>\n                        <th>Amount</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ').concat((null===(n=e.Items)||void 0===n?void 0:n.map((e=>{var t;return"\n                        <tr>\n                            <td>".concat((null===(t=e.productItems)||void 0===t?void 0:t.name)||"N/A","</td>\n                            <td>").concat(e.qty||0,"</td>\n                            <td>\u20b9").concat(e.price||0,"</td>\n                            <td>\u20b9").concat(e.amount||0,"</td>\n                        </tr>\n                    ")})).join(""))||'<tr><td colspan="4">No items</td></tr>','\n                </tbody>\n                <tfoot>\n                    <tr class="total">\n                        <td colspan="3">Total Amount</td>\n                        <td>\u20b9').concat(e.total_amount||0,"</td>\n                    </tr>\n                </tfoot>\n            </table>\n            \n            <p><strong>Payment Status:</strong> ").concat(e.is_paid?"Paid":"Pending",'</p>\n        </div>\n        \n        <div class="footer">\n            <p>Thank you for choosing us!</p>\n            <p><strong>Best regards,<br>Subriva Billing Team</strong></p>\n        </div>\n    </body>\n    </html>\n    ')},P=async e=>{if(o){j(!0);try{const t=sessionStorage.getItem("token"),i=sessionStorage.getItem("csrf-token"),l=await fetch("".concat("http://localhost:8249/","/email/send-invoice"),{method:"POST",headers:{"Content-Type":"application/json",token:t||"","x-csrf-token":i||""},body:JSON.stringify({customerEmail:e.to,invoiceData:o,subject:e.subject,customMessage:e.message||""})}),a=await l.json();a.success?(I(!0),T.Ay.success("Invoice sent successfully to ".concat(e.to)),setTimeout((()=>{n()}),2e3)):T.Ay.error(a.error||"Failed to send email")}catch(t){console.error("Error sending email:",t),T.Ay.error("Failed to send email. Please try again.")}finally{j(!1)}}else T.Ay.error("No bill data available")},D=()=>{u.validateFields().then(P)},q=()=>{u.resetFields(),h(!1),A(null),I(!1),n()};return(0,X.jsx)(p.A,{title:(0,X.jsxs)("div",{className:oe,children:[(0,X.jsx)(g.A,{}),(0,X.jsx)("span",{children:"Send Invoice via Email"})]}),open:i,onCancel:q,width:900,className:le,footer:null,destroyOnClose:!0,children:(0,X.jsx)("div",{className:ae,children:k?(0,X.jsxs)("div",{className:he,children:[(0,X.jsx)(te.A,{className:_e}),(0,X.jsx)(fe,{level:3,children:"Email Sent Successfully!"}),(0,X.jsxs)(ge,{type:"secondary",children:["The invoice has been sent to ",u.getFieldValue("to")]})]}):(0,X.jsxs)(X.Fragment,{children:[(0,X.jsxs)(a.A,{form:u,layout:"vertical",onFinish:D,className:se,children:[(0,X.jsxs)("div",{className:de,children:[(0,X.jsx)(fe,{level:4,children:"Email Details"}),(0,X.jsx)(a.A.Item,{label:"To",name:"to",rules:[{required:!0,message:"Please enter recipient email"},{type:"email",message:"Please enter valid email address"}],children:(0,X.jsx)(m.A,{prefix:(0,X.jsx)(g.A,{}),placeholder:"customer@example.com",size:"large"})}),(0,X.jsx)(a.A.Item,{label:"Subject",name:"subject",rules:[{required:!0,message:"Please enter email subject"}],children:(0,X.jsx)(m.A,{placeholder:"Invoice subject",size:"large"})}),(0,X.jsx)(a.A.Item,{label:"Custom Message (Optional)",name:"message",children:(0,X.jsx)(Ae,{rows:3,placeholder:"Add a personal message to the customer..."})})]}),(0,X.jsx)($.A,{}),(0,X.jsx)("div",{className:re,children:(0,X.jsxs)(r.A,{children:[(0,X.jsx)(c.Ay,{icon:(0,X.jsx)(f.A,{}),onClick:async()=>{if(o){x(!0);try{var e;const t={subject:"Invoice #".concat(o.invoice_no," - ").concat((null===(e=o.customerDetails)||void 0===e?void 0:e.full_name)||"Customer"),text:S(o),html:w(o)};A(t),h(!0),u.setFieldsValue({subject:t.subject})}catch(t){T.Ay.error("Failed to generate email preview")}finally{x(!1)}}},loading:v,disabled:!o,children:"Preview Email"}),(0,X.jsx)(c.Ay,{type:"primary",icon:(0,X.jsx)(ie.A,{}),htmlType:"submit",loading:b,disabled:!o,children:"Send Email"}),(0,X.jsx)(c.Ay,{onClick:q,children:"Cancel"})]})})]}),y&&_&&(0,X.jsxs)("div",{className:ce,children:[(0,X.jsx)($.A,{children:"Email Preview"}),(0,X.jsxs)("div",{className:ue,children:[(0,X.jsx)("div",{className:me,children:(0,X.jsxs)(fe,{level:5,children:["Subject: ",_.subject]})}),(0,X.jsx)("div",{className:pe,children:(0,X.jsx)("div",{className:ve,dangerouslySetInnerHTML:{__html:(E=_.html,ne.A.sanitize(E,{ALLOWED_TAGS:["b","i","em","strong","u","s","a","p","br","ul","ol","li","h1","h2","h3","h4","h5","h6","blockquote","code","pre","span","div","hr","table","thead","tbody","tr","th","td"],ALLOWED_ATTR:["href","title","target","class","id"],ALLOW_DATA_ATTR:!1}))}})}),(0,X.jsxs)("div",{className:xe,children:[(0,X.jsx)(c.Ay,{type:"primary",icon:(0,X.jsx)(ie.A,{}),onClick:D,loading:b,children:"Send This Email"}),(0,X.jsx)(c.Ay,{onClick:()=>h(!1),children:"Back to Edit"})]})]})]}),o&&(0,X.jsx)("div",{className:ye,children:(0,X.jsx)(ee.A,{message:"Invoice Information",description:(0,X.jsxs)("div",{children:[(0,X.jsx)(ge,{strong:!0,children:"Invoice #:"})," ",o.invoice_no,(0,X.jsx)("br",{}),(0,X.jsx)(ge,{strong:!0,children:"Customer:"})," ",(null===(t=o.customerDetails)||void 0===t?void 0:t.full_name)||"N/A",(0,X.jsx)("br",{}),(0,X.jsx)(ge,{strong:!0,children:"Amount:"})," \u20b9",o.total_amount||0]}),type:"info",showIcon:!0})})]})})});var E},{Title:je,Text:ke}=o.A,Ie=e=>{var t,i,n;let{visible:o,onClose:a,billData:s}=e;const d=(0,l.useRef)(null),[r,u]=(0,l.useState)(!1),m=e=>(Number(e)||0).toFixed(2),v="Focuz Medicals",x="123 MG Road, Bangalore, Karnataka - 560001",y="29ABCDE1234F1Z5",h=[{title:"Item",dataIndex:"productItems",key:"name",render:(e,t)=>{var i;const n=t.productItems;if(!n)return"";const l=null===(i=n.VariantItem)||void 0===i?void 0:i.variant_name;return l?"".concat(n.name," - ").concat(l):n.name}},{title:"Qty",dataIndex:"qty",key:"qty",width:100,render:e=>e||0},{title:"Loose Qty",dataIndex:"loose_qty",key:"loose_qty",width:100,render:e=>e||0},{title:"Price",dataIndex:"price",key:"price",width:120,render:e=>"\u20b9 ".concat(m(e))},{title:"Amount",dataIndex:"amount",key:"amount",width:120,render:e=>"\u20b9 ".concat(m(e))}];return(0,X.jsxs)(X.Fragment,{children:[(0,X.jsxs)(p.A,{title:(0,X.jsx)(je,{level:4,style:{margin:0,color:"#1890ff"},children:"Sale Details"}),open:o,onCancel:a,width:800,footer:[(0,X.jsx)(c.Ay,{type:"primary",icon:(0,X.jsx)(g.A,{}),onClick:()=>u(!0),children:"Send via Email"},"email"),(0,X.jsx)(c.Ay,{icon:(0,X.jsx)(A.A,{}),onClick:()=>{var e;const t="\n      <html>\n        <head>\n          <title>Sale - ".concat(s.invoice_no,'</title>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; color: #222; }\n            .shop-info { text-align: center; margin-bottom: 20px; }\n            .shop-info h2 { margin-bottom: 0; color: #1890ff; }\n            .info-flex { display: flex; justify-content: space-between; margin-bottom: 10px; }\n            table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n            th { background-color: #f5f5f5; }\n            .total { text-align: right; font-weight: bold; margin-top: 10px; }\n            .thank-you { text-align: center; margin-top: 40px; font-size: 16px; color: #1890ff; font-weight: bold; }\n            @media print {\n              .no-print { display: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="shop-info">\n            <h2>').concat(v,"</h2>\n            <p>").concat(x,"</p>\n            <p><strong>GST No:</strong> ").concat(y,'</p>\n          </div>\n\n          <div class="info-flex">\n            <div>\n              <p><strong>Invoice No:</strong> ').concat(s.invoice_no,"</p>\n              <p><strong>Date:</strong> ").concat(new Date(s.date).toLocaleDateString(),'</p>\n            </div>\n            <div style="text-align: right;">\n              <p><strong>Customer:</strong> ').concat((null===(e=s.customerDetails)||void 0===e?void 0:e.full_name)||"","</p>\n              <p><strong>Payment Mode:</strong> ").concat(s.payment_mode||"","</p>\n            </div>\n          </div>\n\n          <table>\n            <thead>\n              <tr>\n                <th>Item</th>\n                <th>Qty</th>\n                <th>Loose Qty</th>\n                <th>Price</th>\n                <th>Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              ").concat(s.Items.map((e=>{var t;const i=e.productItems,n=i?"".concat(i.name).concat(null!==(t=i.VariantItem)&&void 0!==t&&t.variant_name?" - ".concat(i.VariantItem.variant_name):""):"";return"\n                  <tr>\n                    <td>".concat(n,"</td>\n                    <td>").concat(e.qty||0,"</td>\n                    <td>").concat(e.loose_qty||0,"</td>\n                    <td>\u20b9 ").concat(m(e.price),"</td>\n                    <td>\u20b9 ").concat(m(e.amount),"</td>\n                  </tr>\n                ")})).join(""),'\n            </tbody>\n          </table>\n\n          <div class="total">\n            <p>Value of Goods: \u20b9 ').concat(m(s.value_of_goods),"</p>\n            ").concat(s.discount>0?"\n              <p>Discount: ".concat("percentage"===s.discount_type?s.discount+"%":"\u20b9 "+m(s.discount),"</p>\n            "):"","\n            <p>Total GST: \u20b9 ").concat(m(s.total_gst),"</p>\n            <p>CGST: \u20b9 ").concat(m(s.cgst||s.total_gst/2),"</p>\n            <p>SGST: \u20b9 ").concat(m(s.sgst||s.total_gst/2),"</p>\n            <p><strong>").concat("retail"===s.sale_type?"Bill Value":"Invoice Value",": \u20b9 ").concat(m(s.total_amount),"</strong></p>\n            ").concat(s.is_partially_paid?"\n              <p>Paid Amount: \u20b9 ".concat(m(s.paid_amount),"</p>\n              <p>Remaining Amount: \u20b9 ").concat(m(Number(s.total_amount)-Number(s.paid_amount)),"</p>\n            "):"","\n            <p><strong>Payment Status:</strong> ").concat(s.is_paid?"Fully Paid":s.is_partially_paid?"Partially Paid":"Unpaid","</p>\n          </div>\n\n          <div class=\"thank-you\">\n            Thank you for shopping with us!\n          </div>\n\n          <script>\n            window.onload = function() {\n              window.print();\n              window.onafterprint = function() {\n                window.parent.postMessage('printComplete', '*');\n              };\n            };\n          <\/script>\n        </body>\n      </html>\n    "),i=d.current;i.contentWindow.document.open(),i.contentWindow.document.write(t),i.contentWindow.document.close(),window.addEventListener("message",(e=>{"printComplete"===e.data&&a()}))},children:"Print Sale"},"print"),(0,X.jsx)(c.Ay,{onClick:a,children:"Close"},"close")],children:[(0,X.jsxs)("div",{style:{textAlign:"center",marginBottom:16},children:[(0,X.jsx)(je,{level:4,style:{marginBottom:0,color:"#1890ff"},children:v}),(0,X.jsx)(ke,{children:x}),(0,X.jsx)("br",{}),(0,X.jsxs)(ke,{children:[(0,X.jsx)("strong",{children:"GST No:"})," ",(0,X.jsx)(ke,{code:!0,children:y})]})]}),(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:20},children:[(0,X.jsxs)("div",{children:[(0,X.jsx)(ke,{strong:!0,children:"Invoice No:"})," ",s.invoice_no,(0,X.jsx)("br",{}),(0,X.jsx)(ke,{strong:!0,children:"Date:"})," ",new Date(s.date).toLocaleDateString()]}),(0,X.jsxs)("div",{style:{textAlign:"right"},children:[(0,X.jsx)(ke,{strong:!0,children:"Customer:"})," ",null===(t=s.customerDetails)||void 0===t?void 0:t.full_name,(0,X.jsx)("br",{}),(0,X.jsx)(ke,{strong:!0,children:"Payment Mode:"})," ",s.payment_mode]})]}),(0,X.jsx)(Z.A,{dataSource:s.Items,columns:h,pagination:!1,bordered:!0,summary:()=>(0,X.jsxs)(Z.A.Summary.Row,{children:[(0,X.jsx)(Z.A.Summary.Cell,{index:0,colSpan:4,children:(0,X.jsx)(ke,{strong:!0,children:"Total Amount:"})}),(0,X.jsx)(Z.A.Summary.Cell,{index:1,children:(0,X.jsxs)(ke,{strong:!0,children:["\u20b9 ",m(s.sub_total)]})})]})}),(0,X.jsxs)("div",{style:{marginTop:20,textAlign:"right"},children:[(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,X.jsx)(ke,{strong:!0,children:"Value of Goods:"}),(0,X.jsxs)(ke,{children:["\u20b9 ",m(s.value_of_goods)]})]}),s.discount>0&&(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,X.jsx)(ke,{strong:!0,children:"Discount:"}),(0,X.jsx)(ke,{children:"percentage"===s.discount_type?"".concat(s.discount,"%"):"\u20b9 ".concat(m(s.discount))})]}),(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,X.jsx)(ke,{strong:!0,children:"Total GST:"}),(0,X.jsxs)(ke,{children:["\u20b9 ",m(s.total_gst)]})]}),(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,X.jsx)(ke,{strong:!0,children:"CGST:"}),(0,X.jsxs)(ke,{children:["\u20b9 ",m(s.cgst||s.total_gst/2)]})]}),(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,X.jsx)(ke,{strong:!0,children:"SGST:"}),(0,X.jsxs)(ke,{children:["\u20b9 ",m(s.sgst||s.total_gst/2)]})]}),(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,X.jsxs)(ke,{strong:!0,children:["retail"===s.sale_type?"Bill Value":"Invoice Value",":"]}),(0,X.jsxs)(ke,{children:["\u20b9 ",m(s.total_amount)]})]}),(0,X.jsx)(ke,{strong:!0,children:"Payment Status: "}),s.is_paid?(0,X.jsx)(ke,{type:"success",children:"Fully Paid"}):s.is_partially_paid?(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(ke,{type:"warning",children:"Partially Paid"}),(0,X.jsx)("br",{}),(0,X.jsxs)(ke,{children:["Paid Amount: \u20b9 ",m(s.paid_amount)]}),(0,X.jsx)("br",{}),(0,X.jsxs)(ke,{children:["Remaining Amount: \u20b9"," ",m(Number(s.total_amount)-Number(s.paid_amount))]})]}):(0,X.jsx)(ke,{type:"danger",children:"Unpaid"})]}),(0,X.jsx)("div",{style:{textAlign:"center",marginTop:40},children:(0,X.jsx)(ke,{style:{color:"#1890ff",fontWeight:500},children:"Thank you for shopping with us!"})})]}),(0,X.jsx)("iframe",{ref:d,style:{display:"none"},title:"print-frame"}),(0,X.jsx)(be,{visible:r,onClose:()=>u(!1),billData:s,customerEmail:null===s||void 0===s||null===(i=s.customerDetails)||void 0===i?void 0:i.email,customerName:null===s||void 0===s||null===(n=s.customerDetails)||void 0===n?void 0:n.full_name})]})};var Ce=i(4413),Se=i(83003),Ne=i(22115);const we={borderBottom:"1px solid #000",padding:"2px",textAlign:"left",fontSize:"11px"},Pe={padding:"2px",fontSize:"11px"},Te={classic:{label:"Classic",component:e=>{var t,i,n,l;let{billData:o}=e;const a=(0,Ne.J)();return(0,X.jsxs)("div",{style:{fontFamily:"Courier New, monospace",background:"#fff",border:"1px solid #ddd",maxWidth:"380px",margin:"20px auto",padding:"16px",fontSize:"12px",color:"#000"},children:[(0,X.jsxs)("div",{style:{textAlign:"center",marginBottom:"8px"},children:[(0,X.jsx)("h3",{style:{margin:"4px 0",fontWeight:"bold",fontSize:"16px"},children:(null===a||void 0===a||null===(t=a.organisationItems)||void 0===t?void 0:t.org_name)||""}),(0,X.jsx)("div",{style:{fontSize:"11px",marginBottom:"4px"},children:(null===a||void 0===a||null===(i=a.branchItems)||void 0===i?void 0:i.address1)||""}),(0,X.jsxs)("div",{style:{fontSize:"11px"},children:["GSTIN: ",(null===a||void 0===a||null===(n=a.organisationItems)||void 0===n?void 0:n.gst_number)||"33XXXXXXXXXXX"]})]}),(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[(0,X.jsxs)("div",{children:[(0,X.jsxs)("div",{children:["BILL NO: ",(null===o||void 0===o?void 0:o.invoice_no)||"INV-XXXX"]}),(0,X.jsxs)("div",{children:["DATE:"," ",null!==o&&void 0!==o&&o.date?new Date(o.date).toLocaleDateString():"-"]})]}),(0,X.jsx)("div",{style:{textAlign:"right"},children:(0,X.jsxs)("div",{children:["NAME:"," ",((null===o||void 0===o?void 0:o.customerName)||"").substring(0,20).toUpperCase()]})})]}),(0,X.jsx)("div",{style:{borderTop:"1px dashed #000",margin:"4px 0"}}),(0,X.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"8px"},children:[(0,X.jsx)("thead",{children:(0,X.jsxs)("tr",{children:[(0,X.jsx)("th",{style:we,children:"S.No"}),(0,X.jsx)("th",{style:we,children:"Item"}),(0,X.jsx)("th",{style:we,children:"Qty"}),(0,X.jsx)("th",{style:we,children:"Rate"}),(0,X.jsx)("th",{style:we,children:"MRP"}),(0,X.jsx)("th",{style:we,children:"Amt"})]})}),(0,X.jsx)("tbody",{children:null===o||void 0===o||null===(l=o.items)||void 0===l?void 0:l.map(((e,t)=>(0,X.jsxs)("tr",{children:[(0,X.jsx)("td",{style:Pe,children:t+1}),(0,X.jsx)("td",{style:Pe,children:e.name.length>15?e.name.substring(0,15)+"...":e.name}),(0,X.jsx)("td",{style:Pe,children:e.qty}),(0,X.jsxs)("td",{style:Pe,children:["\u20b9",e.price]}),(0,X.jsxs)("td",{style:Pe,children:["\u20b9",e.mrp||e.price]}),(0,X.jsxs)("td",{style:Pe,children:["\u20b9",e.amount]})]},t)))})]}),(0,X.jsx)("div",{style:{borderTop:"1px dashed #000",margin:"4px 0"}}),(0,X.jsxs)("div",{style:{textAlign:"right",fontWeight:"bold"},children:[(0,X.jsxs)("div",{children:["Subtotal: \u20b9 ",null===o||void 0===o?void 0:o.total]}),(0,X.jsxs)("div",{children:["CGST: \u20b9 ",((null===o||void 0===o?void 0:o.cgst)||((null===o||void 0===o?void 0:o.total_gst)||0)/2).toFixed(2)]}),(0,X.jsxs)("div",{children:["SGST: \u20b9 ",((null===o||void 0===o?void 0:o.sgst)||((null===o||void 0===o?void 0:o.total_gst)||0)/2).toFixed(2)]}),(0,X.jsxs)("div",{style:{fontSize:"14px"},children:["NET AMOUNT: \u20b9 ",null===o||void 0===o?void 0:o.total]})]}),(0,X.jsx)("div",{style:{borderTop:"1px dashed #000",margin:"8px 0"}}),(0,X.jsxs)("div",{style:{textAlign:"center",fontSize:"11px"},children:["*** GET WELL SOON. THANK YOU ***",(0,X.jsx)("br",{}),"Goods Once Sold Cannot Be Taken Back"]})]})},previewImg:"https://via.placeholder.com/220x120?text=Classic"},modern:{label:"Modern",component:e=>{var t,i,n,l,o;let{billData:a}=e;const s=(0,Ne.J)();return(0,X.jsxs)("div",{style:{padding:30,background:"#fff",border:"1px solid #ccc",borderRadius:12,maxWidth:850,margin:"20px auto",color:"#333",fontFamily:"Georgia, serif",boxShadow:"0 0 10px rgba(0,0,0,0.08)"},children:[(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",borderBottom:"2px solid #333",paddingBottom:10,marginBottom:20},children:[(0,X.jsxs)("div",{children:[(0,X.jsx)("h1",{style:{margin:0,fontSize:24},children:(null===s||void 0===s||null===(t=s.organisationItems)||void 0===t?void 0:t.org_name)||"Your Company Name"}),(0,X.jsx)("p",{style:{margin:"5px 0",fontSize:14},children:(null===s||void 0===s||null===(i=s.branchItems)||void 0===i?void 0:i.branch_name)||"Branch Name"}),(0,X.jsx)("p",{style:{margin:0,fontSize:12},children:(null===s||void 0===s||null===(n=s.branchItems)||void 0===n?void 0:n.address1)||"Branch Address"})]}),(0,X.jsxs)("div",{style:{textAlign:"right",fontSize:12},children:[(0,X.jsxs)("p",{style:{margin:0},children:[(0,X.jsx)("strong",{children:"GSTIN:"})," ",(null===s||void 0===s||null===(l=s.organisationItems)||void 0===l?void 0:l.gst_number)||"-"]}),(0,X.jsx)("p",{style:{margin:"5px 0",fontWeight:600},children:"wholesale"===(null===a||void 0===a?void 0:a.sale_type)?"INVOICE":"CASH BILL"}),(0,X.jsxs)("p",{style:{margin:0},children:[(0,X.jsx)("strong",{children:"Invoice #:"})," ",(null===a||void 0===a?void 0:a.invoice_no)||"-"]})]})]}),(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:20},children:[(0,X.jsxs)("div",{style:{fontSize:13},children:[(0,X.jsxs)("p",{style:{margin:"2px 0"},children:[(0,X.jsx)("strong",{children:"Bill To:"})," ",(null===a||void 0===a?void 0:a.customerName)||"Customer Name"]}),(0,X.jsx)("p",{style:{margin:"2px 0",color:"#555"},children:(null===a||void 0===a?void 0:a.customerAddress)||"Customer Address"})]}),(0,X.jsx)("div",{style:{textAlign:"right",fontSize:13},children:(0,X.jsxs)("p",{style:{margin:"2px 0"},children:[(0,X.jsx)("strong",{children:"Date:"})," ",null!==a&&void 0!==a&&a.date?new Date(a.date).toLocaleDateString():"-"]})})]}),(0,X.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:20},children:[(0,X.jsx)("thead",{children:(0,X.jsxs)("tr",{style:{background:"rgba(255,255,255,0.08)"},children:[(0,X.jsx)("th",{style:{padding:10,textAlign:"left"},children:"Item"}),(0,X.jsx)("th",{style:{padding:10,textAlign:"right"},children:"Qty"}),(0,X.jsx)("th",{style:{padding:10,textAlign:"right"},children:"Price"}),(0,X.jsx)("th",{style:{padding:10,textAlign:"right"},children:"MRP"}),(0,X.jsx)("th",{style:{padding:10,textAlign:"right"},children:"Amount"})]})}),(0,X.jsx)("tbody",{children:null===a||void 0===a||null===(o=a.items)||void 0===o?void 0:o.map(((e,t)=>(0,X.jsxs)("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.10)"},children:[(0,X.jsx)("td",{style:{padding:10},children:e.name}),(0,X.jsx)("td",{style:{padding:10,textAlign:"right"},children:e.qty}),(0,X.jsx)("td",{style:{padding:10,textAlign:"right"},children:e.price}),(0,X.jsx)("td",{style:{padding:10,textAlign:"right"},children:e.mrp||e.price}),(0,X.jsx)("td",{style:{padding:10,textAlign:"right"},children:e.amount})]},t)))})]}),(0,X.jsxs)("div",{style:{textAlign:"right",fontSize:14},children:[(null===a||void 0===a?void 0:a.discount)>0&&(0,X.jsxs)("p",{children:["Discount:"," ","percentage"===a.discount_type?"".concat(a.discount,"%"):"\u20b9 ".concat(a.discount)]}),(0,X.jsxs)("p",{children:["CGST: \u20b9 ",((null===a||void 0===a?void 0:a.cgst)||((null===a||void 0===a?void 0:a.total_gst)||0)/2).toFixed(2)]}),(0,X.jsxs)("p",{children:["SGST: \u20b9 ",((null===a||void 0===a?void 0:a.sgst)||((null===a||void 0===a?void 0:a.total_gst)||0)/2).toFixed(2)]}),(0,X.jsxs)("h2",{style:{margin:0},children:["Grand Total: \u20b9 ",null===a||void 0===a?void 0:a.total]})]}),(0,X.jsx)("div",{style:{textAlign:"center",marginTop:30,fontSize:12,color:"#999"},children:"*** Thank you for shopping with us! ***"})]})},previewImg:"https://via.placeholder.com/220x120?text=Modern"}},{Title:De}=o.A,qe=()=>{var e,t,i,o;const{getEntityApi:I}=(0,N.p)(),P=I("SalesRecord"),{items:T,loading:D}=(0,w.Sm)(P.getIdentifier("GetAll")),[q,E]=(0,l.useState)(null),[L,M]=(0,l.useState)(!1),[G,z]=(0,l.useState)(!1),[V]=a.A.useForm(),[F,R]=(0,l.useState)(""),[Y,O]=(0,l.useState)({current:1,pageSize:10}),[U,W]=(0,l.useState)(!1),[Q,H]=(0,l.useState)(null),[K,Z]=(0,l.useState)(!1),[$,ee]=(0,l.useState)(null);(0,Se.wA)();(0,B.z)({action:"delete",title:"Sale",identifier:P.getIdentifier("Delete"),entityApi:P});const te=[{title:"Invoice",dataIndex:"invoice_no",key:"invoice_no",render:e=>(0,X.jsx)(s.A,{icon:(0,X.jsx)(v.A,{}),color:"blue",children:e})},{title:"Date",dataIndex:"date",key:"date",render:e=>(0,X.jsx)(d.A,{title:C()(e).format("MMMM D, YYYY"),children:(0,X.jsx)(s.A,{icon:(0,X.jsx)(x.A,{}),color:"purple",children:C()(e).format("DD MMM YY")})})},{title:"Customer",dataIndex:"customerDetails",key:"customerDetails",render:e=>(0,X.jsxs)(r.A,{children:[(0,X.jsx)(y.A,{}),(0,X.jsxs)("span",{children:[(0,X.jsx)("strong",{children:null===e||void 0===e?void 0:e.full_name}),(0,X.jsx)("br",{}),(0,X.jsx)("small",{style:{color:"#999"},children:null===e||void 0===e?void 0:e.mobile})]})]})},{title:"Payment Mode",dataIndex:"payment_mode",key:"payment_mode",render:e=>{const t="cash"===e?"green":"upi"===e?"geekblue":"orange";return(0,X.jsx)(s.A,{icon:(0,X.jsx)(h.A,{}),color:t,children:e.toUpperCase()})}},{title:"Total",dataIndex:"total_amount",key:"total_amount",render:e=>(0,X.jsxs)(s.A,{icon:(0,X.jsx)(_.A,{}),color:"gold",children:["\u20b9 ",Number(e).toFixed(2)]})},{title:"Actions",key:"actions",render:(e,t)=>(0,X.jsxs)(r.A,{size:"middle",children:[(0,X.jsx)(d.A,{title:"View Bill",children:(0,X.jsx)(c.Ay,{type:"link",icon:(0,X.jsx)(f.A,{}),onClick:()=>(e=>{E(e),V.setFieldsValue((0,n.A)((0,n.A)({},e),{},{date:C()(e.date)})),M(!0)})(t)})}),(0,X.jsx)(d.A,{title:"Send via Email",children:(0,X.jsx)(c.Ay,{type:"link",icon:(0,X.jsx)(g.A,{}),onClick:()=>(e=>{ee(e),Z(!0)})(t)})}),(0,X.jsx)(d.A,{title:"Print",children:(0,X.jsx)(c.Ay,{type:"link",icon:(0,X.jsx)(A.A,{}),onClick:()=>(e=>{var t,i,n;const l={customerName:(null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||"",customerAddress:(null===(i=e.customerDetails)||void 0===i?void 0:i.address)||"",date:e.date,invoice_no:e.invoice_no,items:(e.Items||[]).map((e=>{var t,i,n;return{name:[(null===(t=e.productItems)||void 0===t?void 0:t.name)||e.product_name||"",(null===(i=e.productItems)||void 0===i||null===(n=i.VariantItem)||void 0===n?void 0:n.variant_name)||""].filter(Boolean).join(" "),qty:e.qty,price:e.price,mrp:e.mrp,amount:e.amount}})),total:e.total_amount||0,total_gst:e.total_gst||0,discount:e.discount||0,discount_type:e.discount_type||"",gst_number:e.gst_number||(null===(n=e.organisationItems)||void 0===n?void 0:n.gst_number)||""};H(l),W(!0)})(t)})}),(0,X.jsx)(u.A,{title:"Are you sure to delete this bill?",onConfirm:()=>(async e=>{try{await P("Delete",{},e)}catch(t){}})(t._id),okText:"Yes",cancelText:"No",children:(0,X.jsx)(d.A,{title:"Delete",children:(0,X.jsx)(c.Ay,{type:"link",icon:(0,X.jsx)(b.A,{}),danger:!0})})})]})}];return(0,l.useEffect)((()=>{P("GetAll",{pageNumber:Y.current,pageLimit:Y.pageSize,searchString:F})}),[P]),(0,X.jsxs)("div",{style:{padding:24},children:[(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,X.jsx)(De,{level:3,style:{color:"#1890ff",margin:0},children:"Sales List"}),(0,X.jsxs)(r.A,{children:[(0,X.jsx)(m.A,{placeholder:"Search by invoice no, customer name or mobile",prefix:(0,X.jsx)(j.A,{}),allowClear:!0,style:{width:300},onChange:e=>{return t=e.target.value,R(t),O((0,n.A)((0,n.A)({},Y),{},{current:1})),void P("GetAll",{pageNumber:1,pageLimit:Y.pageSize,searchString:t});var t}}),(0,X.jsx)(c.Ay,{type:"primary",icon:(0,X.jsx)(k.A,{}),onClick:()=>{E(null),M(!0)},children:"Create New Sale"})]})]}),(0,X.jsx)(Ce.A,{data:null===T||void 0===T?void 0:T.result,columns:te,loading:D,bordered:!0,rowKey:"_id",totalCount:(null===T||void 0===T||null===(e=T.pagination)||void 0===e?void 0:e.totalCount)||0,pageLimit:(null===T||void 0===T||null===(t=T.pagination)||void 0===t?void 0:t.pageLimit)||10,onPaginationChange:(e,t)=>{O({current:e,pageSize:t}),P("GetAll",{pageNumber:e,pageLimit:t,searchString:F})}}),(0,X.jsx)(S.A,{title:q?"Edit Sale":"Create New Sale",onClose:()=>M(!1),open:L,width:1200,children:(0,X.jsx)(J,{billdata:q,onSuccess:()=>{M(!1),P("GetAll")}})}),q&&(0,X.jsx)(Ie,{visible:G,onClose:()=>z(!1),billData:q}),(0,X.jsx)(p.A,{open:U,onCancel:()=>W(!1),footer:[(0,X.jsx)(c.Ay,{type:"primary",onClick:()=>window.print(),children:"Print"},"print"),(0,X.jsx)(c.Ay,{onClick:()=>W(!1),children:"Close"},"close")],width:800,title:Q?"Print Invoice #".concat(Q.invoice_no):"Print Invoice",centered:!0,children:Q&&(()=>{const e=localStorage.getItem("billingTemplate"),t=Te["modern"===e||"classic"===e?e:"classic"].component;return(0,X.jsx)(t,{billData:Q})})()}),(0,X.jsx)(be,{visible:K,onClose:()=>{Z(!1),ee(null)},billData:$,customerEmail:null===$||void 0===$||null===(i=$.customerDetails)||void 0===i?void 0:i.email,customerName:null===$||void 0===$||null===(o=$.customerDetails)||void 0===o?void 0:o.full_name})]})}}}]);
//# sourceMappingURL=159.0a018459.chunk.js.map