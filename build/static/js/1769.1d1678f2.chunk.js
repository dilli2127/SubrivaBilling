"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[1769],{47288:(e,t,n)=>{n.r(t),n.d(t,{default:()=>xe});var o=n(89379),i=n(53986),l=n(65043),a=n(71782),s=n(62305),r=n(76399),c=n(96651),d=n(6051),m=n(95206),u=n(60647),p=n(36621),v=n(98105),g=n(36091),h=n(6881),x=n(53722),y=n(11951),j=n(76401),f=n(61118),_=n(75388),b=n(94834),A=n(92003),S=n(9316),C=n(72411),I=n(73847),w=n(60446),P=n.n(w),k=n(66885),T=n(22671),D=n(23404),E=n(62751),N=n(91065),O=n(16569),B=n(8354),M=n(42261),F=n(46237),V=n(4394),L=n(87977);const z="EmailSendModal_emailSendModal__BfdYk",Y="EmailSendModal_emailSendHeader__C2GeM",q="EmailSendModal_emailSendContent__18hO-",G="EmailSendModal_emailForm__Dz-ws",R="EmailSendModal_formSection__XePkG",U="EmailSendModal_formActions__0+vVX",W="EmailSendModal_emailPreview__z0YAf",Q="EmailSendModal_previewContent__i+Cpp",H="EmailSendModal_previewHeader__Y+2Wh",X="EmailSendModal_previewBody__wL6Yl",K="EmailSendModal_htmlPreview__Lr4X+",J="EmailSendModal_previewActions__l-Y3Y",Z="EmailSendModal_billInfo__1yHvY",$="EmailSendModal_successState__gVP0P",ee="EmailSendModal_successIcon__levgm";var te=n(70579);const{Title:ne,Text:oe}=a.A,{TextArea:ie}=p.A,le=e=>{var t;let{visible:n,onClose:o,billData:i,customerEmail:a,customerName:r}=e;const[c]=s.A.useForm(),[u,v]=(0,l.useState)(!1),[g,h]=(0,l.useState)(!1),[x,y]=(0,l.useState)(null),[j,b]=(0,l.useState)(!1),[A,S]=(0,l.useState)(!1);(0,l.useEffect)((()=>{n&&a&&c.setFieldsValue({to:a,subject:"Invoice #".concat((null===i||void 0===i?void 0:i.invoice_no)||""," - ").concat(r||"")})}),[n,a,r,i,c]);const C=e=>{var t,n;return"\nDear ".concat((null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||"Valued Customer",",\n\nThank you for your business! Please find your invoice details below:\n\nInvoice Number: ").concat(e.invoice_no,"\nDate: ").concat(new Date(e.date).toLocaleDateString(),"\nTotal Amount: \u20b9").concat(e.total_amount||0,"\n\nItems:\n").concat((null===(n=e.Items)||void 0===n?void 0:n.map((e=>{var t;return"- ".concat(null===(t=e.productItems)||void 0===t?void 0:t.name," (").concat(e.qty," x \u20b9").concat(e.price,") = \u20b9").concat(e.amount)})).join("\n"))||"No items","\n\nPayment Status: ").concat(e.is_paid?"Paid":"Pending","\n\nThank you for choosing us!\n\nBest regards,\nSubriva Billing Team\n    ").trim()},I=e=>{var t,n,o;return'\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset="UTF-8">\n        <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .header { background: #f8f9fa; padding: 20px; text-align: center; }\n            .content { padding: 20px; }\n            .invoice-table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n            .invoice-table th, .invoice-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n            .invoice-table th { background-color: #f8f9fa; }\n            .total { font-weight: bold; font-size: 18px; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; margin-top: 20px; }\n        </style>\n    </head>\n    <body>\n        <div class="header">\n            <h1>Subriva Billing</h1>\n            <h2>Invoice #'.concat(e.invoice_no,'</h2>\n        </div>\n        \n        <div class="content">\n            <p>Dear <strong>').concat((null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||"Valued Customer",'</strong>,</p>\n            \n            <p>Thank you for your business! Please find your invoice details below:</p>\n            \n            <table class="invoice-table">\n                <tr>\n                    <th>Invoice Number</th>\n                    <td>').concat(e.invoice_no,"</td>\n                </tr>\n                <tr>\n                    <th>Date</th>\n                    <td>").concat(new Date(e.date).toLocaleDateString(),"</td>\n                </tr>\n                <tr>\n                    <th>Customer</th>\n                    <td>").concat((null===(n=e.customerDetails)||void 0===n?void 0:n.full_name)||"N/A",'</td>\n                </tr>\n            </table>\n            \n            <h3>Items:</h3>\n            <table class="invoice-table">\n                <thead>\n                    <tr>\n                        <th>Product</th>\n                        <th>Quantity</th>\n                        <th>Price</th>\n                        <th>Amount</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ').concat((null===(o=e.Items)||void 0===o?void 0:o.map((e=>{var t;return"\n                        <tr>\n                            <td>".concat((null===(t=e.productItems)||void 0===t?void 0:t.name)||"N/A","</td>\n                            <td>").concat(e.qty||0,"</td>\n                            <td>\u20b9").concat(e.price||0,"</td>\n                            <td>\u20b9").concat(e.amount||0,"</td>\n                        </tr>\n                    ")})).join(""))||'<tr><td colspan="4">No items</td></tr>','\n                </tbody>\n                <tfoot>\n                    <tr class="total">\n                        <td colspan="3">Total Amount</td>\n                        <td>\u20b9').concat(e.total_amount||0,"</td>\n                    </tr>\n                </tfoot>\n            </table>\n            \n            <p><strong>Payment Status:</strong> ").concat(e.is_paid?"Paid":"Pending",'</p>\n        </div>\n        \n        <div class="footer">\n            <p>Thank you for choosing us!</p>\n            <p><strong>Best regards,<br>Subriva Billing Team</strong></p>\n        </div>\n    </body>\n    </html>\n    ')},w=async e=>{if(i){b(!0);try{const t=sessionStorage.getItem("token"),n=sessionStorage.getItem("csrf-token"),l=await fetch("".concat("https://www.subrivabilling.com/api/","/email/send-invoice"),{method:"POST",headers:{"Content-Type":"application/json",token:t||"","x-csrf-token":n||""},body:JSON.stringify({customerEmail:e.to,invoiceData:i,subject:e.subject,customMessage:e.message||""})}),a=await l.json();a.success?(S(!0),O.Ay.success("Invoice sent successfully to ".concat(e.to)),setTimeout((()=>{o()}),2e3)):O.Ay.error(a.error||"Failed to send email")}catch(t){console.error("Error sending email:",t),O.Ay.error("Failed to send email. Please try again.")}finally{b(!1)}}else O.Ay.error("No bill data available")},P=()=>{c.validateFields().then(w)},k=()=>{c.resetFields(),h(!1),y(null),S(!1),o()};return(0,te.jsx)(E.A,{title:(0,te.jsxs)("div",{className:Y,children:[(0,te.jsx)(_.A,{}),(0,te.jsx)("span",{children:"Send Invoice via Email"})]}),open:n,onCancel:k,width:900,className:z,footer:null,destroyOnClose:!0,children:(0,te.jsx)("div",{className:q,children:A?(0,te.jsxs)("div",{className:$,children:[(0,te.jsx)(F.A,{className:ee}),(0,te.jsx)(ne,{level:3,children:"Email Sent Successfully!"}),(0,te.jsxs)(oe,{type:"secondary",children:["The invoice has been sent to ",c.getFieldValue("to")]})]}):(0,te.jsxs)(te.Fragment,{children:[(0,te.jsxs)(s.A,{form:c,layout:"vertical",onFinish:P,className:G,children:[(0,te.jsxs)("div",{className:R,children:[(0,te.jsx)(ne,{level:4,children:"Email Details"}),(0,te.jsx)(s.A.Item,{label:"To",name:"to",rules:[{required:!0,message:"Please enter recipient email"},{type:"email",message:"Please enter valid email address"}],children:(0,te.jsx)(p.A,{prefix:(0,te.jsx)(_.A,{}),placeholder:"customer@example.com",size:"large"})}),(0,te.jsx)(s.A.Item,{label:"Subject",name:"subject",rules:[{required:!0,message:"Please enter email subject"}],children:(0,te.jsx)(p.A,{placeholder:"Invoice subject",size:"large"})}),(0,te.jsx)(s.A.Item,{label:"Custom Message (Optional)",name:"message",children:(0,te.jsx)(ie,{rows:3,placeholder:"Add a personal message to the customer..."})})]}),(0,te.jsx)(B.A,{}),(0,te.jsx)("div",{className:U,children:(0,te.jsxs)(d.A,{children:[(0,te.jsx)(m.Ay,{icon:(0,te.jsx)(f.A,{}),onClick:async()=>{if(i){v(!0);try{var e;const t={subject:"Invoice #".concat(i.invoice_no," - ").concat((null===(e=i.customerDetails)||void 0===e?void 0:e.full_name)||"Customer"),text:C(i),html:I(i)};y(t),h(!0),c.setFieldsValue({subject:t.subject})}catch(t){O.Ay.error("Failed to generate email preview")}finally{v(!1)}}},loading:u,disabled:!i,children:"Preview Email"}),(0,te.jsx)(m.Ay,{type:"primary",icon:(0,te.jsx)(V.A,{}),htmlType:"submit",loading:j,disabled:!i,children:"Send Email"}),(0,te.jsx)(m.Ay,{onClick:k,children:"Cancel"})]})})]}),g&&x&&(0,te.jsxs)("div",{className:W,children:[(0,te.jsx)(B.A,{children:"Email Preview"}),(0,te.jsxs)("div",{className:Q,children:[(0,te.jsx)("div",{className:H,children:(0,te.jsxs)(ne,{level:5,children:["Subject: ",x.subject]})}),(0,te.jsx)("div",{className:X,children:(0,te.jsx)("div",{className:K,dangerouslySetInnerHTML:{__html:(T=x.html,L.default.sanitize(T,{ALLOWED_TAGS:["b","i","em","strong","u","s","a","p","br","ul","ol","li","h1","h2","h3","h4","h5","h6","blockquote","code","pre","span","div","hr","table","thead","tbody","tr","th","td"],ALLOWED_ATTR:["href","title","target","class","id"],ALLOW_DATA_ATTR:!1}))}})}),(0,te.jsxs)("div",{className:J,children:[(0,te.jsx)(m.Ay,{type:"primary",icon:(0,te.jsx)(V.A,{}),onClick:P,loading:j,children:"Send This Email"}),(0,te.jsx)(m.Ay,{onClick:()=>h(!1),children:"Back to Edit"})]})]})]}),i&&(0,te.jsx)("div",{className:Z,children:(0,te.jsx)(M.A,{message:"Invoice Information",description:(0,te.jsxs)("div",{children:[(0,te.jsx)(oe,{strong:!0,children:"Invoice #:"})," ",i.invoice_no,(0,te.jsx)("br",{}),(0,te.jsx)(oe,{strong:!0,children:"Customer:"})," ",(null===(t=i.customerDetails)||void 0===t?void 0:t.full_name)||"N/A",(0,te.jsx)("br",{}),(0,te.jsx)(oe,{strong:!0,children:"Amount:"})," \u20b9",i.total_amount||0]}),type:"info",showIcon:!0})})]})})});var T},{Title:ae,Text:se}=a.A,re=e=>{var t,n,o;let{visible:i,onClose:a,billData:s}=e;const r=(0,l.useRef)(null),[c,d]=(0,l.useState)(!1),u=e=>(Number(e)||0).toFixed(2),p="Focuz Medicals",v="123 MG Road, Bangalore, Karnataka - 560001",g="29ABCDE1234F1Z5",h=[{title:"Item",dataIndex:"productItems",key:"name",render:(e,t)=>{var n;const o=t.productItems;if(!o)return"";const i=null===(n=o.VariantItem)||void 0===n?void 0:n.variant_name;return i?"".concat(o.name," - ").concat(i):o.name}},{title:"Qty",dataIndex:"qty",key:"qty",width:100,render:e=>e||0},{title:"Loose Qty",dataIndex:"loose_qty",key:"loose_qty",width:100,render:e=>e||0},{title:"Price",dataIndex:"price",key:"price",width:120,render:e=>"\u20b9 ".concat(u(e))},{title:"Amount",dataIndex:"amount",key:"amount",width:120,render:e=>"\u20b9 ".concat(u(e))}];return(0,te.jsxs)(te.Fragment,{children:[(0,te.jsxs)(E.A,{title:(0,te.jsx)(ae,{level:4,style:{margin:0,color:"#1890ff"},children:"Sale Details"}),open:i,onCancel:a,width:800,footer:[(0,te.jsx)(m.Ay,{type:"primary",icon:(0,te.jsx)(_.A,{}),onClick:()=>d(!0),children:"Send via Email"},"email"),(0,te.jsx)(m.Ay,{icon:(0,te.jsx)(b.A,{}),onClick:()=>{var e;const t="\n      <html>\n        <head>\n          <title>Sale - ".concat(s.invoice_no,'</title>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; color: #222; }\n            .shop-info { text-align: center; margin-bottom: 20px; }\n            .shop-info h2 { margin-bottom: 0; color: #1890ff; }\n            .info-flex { display: flex; justify-content: space-between; margin-bottom: 10px; }\n            table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n            th { background-color: #f5f5f5; }\n            .total { text-align: right; font-weight: bold; margin-top: 10px; }\n            .thank-you { text-align: center; margin-top: 40px; font-size: 16px; color: #1890ff; font-weight: bold; }\n            @media print {\n              .no-print { display: none; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="shop-info">\n            <h2>').concat(p,"</h2>\n            <p>").concat(v,"</p>\n            <p><strong>GST No:</strong> ").concat(g,'</p>\n          </div>\n\n          <div class="info-flex">\n            <div>\n              <p><strong>Invoice No:</strong> ').concat(s.invoice_no,"</p>\n              <p><strong>Date:</strong> ").concat(new Date(s.date).toLocaleDateString(),'</p>\n            </div>\n            <div style="text-align: right;">\n              <p><strong>Customer:</strong> ').concat((null===(e=s.customerDetails)||void 0===e?void 0:e.full_name)||"","</p>\n              <p><strong>Payment Mode:</strong> ").concat(s.payment_mode||"","</p>\n            </div>\n          </div>\n\n          <table>\n            <thead>\n              <tr>\n                <th>Item</th>\n                <th>Qty</th>\n                <th>Loose Qty</th>\n                <th>Price</th>\n                <th>Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              ").concat(s.Items.map((e=>{var t;const n=e.productItems,o=n?"".concat(n.name).concat(null!==(t=n.VariantItem)&&void 0!==t&&t.variant_name?" - ".concat(n.VariantItem.variant_name):""):"";return"\n                  <tr>\n                    <td>".concat(o,"</td>\n                    <td>").concat(e.qty||0,"</td>\n                    <td>").concat(e.loose_qty||0,"</td>\n                    <td>\u20b9 ").concat(u(e.price),"</td>\n                    <td>\u20b9 ").concat(u(e.amount),"</td>\n                  </tr>\n                ")})).join(""),'\n            </tbody>\n          </table>\n\n          <div class="total">\n            <p>Value of Goods: \u20b9 ').concat(u(s.value_of_goods),"</p>\n            ").concat(s.discount>0?"\n              <p>Discount: ".concat("percentage"===s.discount_type?s.discount+"%":"\u20b9 "+u(s.discount),"</p>\n            "):"","\n            <p>Total GST: \u20b9 ").concat(u(s.total_gst),"</p>\n            <p>CGST: \u20b9 ").concat(u(s.cgst||s.total_gst/2),"</p>\n            <p>SGST: \u20b9 ").concat(u(s.sgst||s.total_gst/2),"</p>\n            <p><strong>").concat("retail"===s.sale_type?"Bill Value":"Invoice Value",": \u20b9 ").concat(u(s.total_amount),"</strong></p>\n            ").concat(s.is_partially_paid?"\n              <p>Paid Amount: \u20b9 ".concat(u(s.paid_amount),"</p>\n              <p>Remaining Amount: \u20b9 ").concat(u(Number(s.total_amount)-Number(s.paid_amount)),"</p>\n            "):"","\n            <p><strong>Payment Status:</strong> ").concat(s.is_paid?"Fully Paid":s.is_partially_paid?"Partially Paid":"Unpaid","</p>\n          </div>\n\n          <div class=\"thank-you\">\n            Thank you for shopping with us!\n          </div>\n\n          <script>\n            window.onload = function() {\n              window.print();\n              window.onafterprint = function() {\n                window.parent.postMessage('printComplete', '*');\n              };\n            };\n          <\/script>\n        </body>\n      </html>\n    "),n=r.current;n.contentWindow.document.open(),n.contentWindow.document.write(t),n.contentWindow.document.close();const o=e=>{"printComplete"===e.data&&(window.removeEventListener("message",o),clearTimeout(i),a())};window.addEventListener("message",o);const i=setTimeout((()=>{window.removeEventListener("message",o)}),1e4)},children:"Print Sale"},"print"),(0,te.jsx)(m.Ay,{onClick:a,children:"Close"},"close")],children:[(0,te.jsxs)("div",{style:{textAlign:"center",marginBottom:16},children:[(0,te.jsx)(ae,{level:4,style:{marginBottom:0,color:"#1890ff"},children:p}),(0,te.jsx)(se,{children:v}),(0,te.jsx)("br",{}),(0,te.jsxs)(se,{children:[(0,te.jsx)("strong",{children:"GST No:"})," ",(0,te.jsx)(se,{code:!0,children:g})]})]}),(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:20},children:[(0,te.jsxs)("div",{children:[(0,te.jsx)(se,{strong:!0,children:"Invoice No:"})," ",s.invoice_no,(0,te.jsx)("br",{}),(0,te.jsx)(se,{strong:!0,children:"Date:"})," ",new Date(s.date).toLocaleDateString()]}),(0,te.jsxs)("div",{style:{textAlign:"right"},children:[(0,te.jsx)(se,{strong:!0,children:"Customer:"})," ",null===(t=s.customerDetails)||void 0===t?void 0:t.full_name,(0,te.jsx)("br",{}),(0,te.jsx)(se,{strong:!0,children:"Payment Mode:"})," ",s.payment_mode]})]}),(0,te.jsx)(N.A,{dataSource:s.Items,columns:h,pagination:!1,bordered:!0,summary:()=>(0,te.jsxs)(N.A.Summary.Row,{children:[(0,te.jsx)(N.A.Summary.Cell,{index:0,colSpan:4,children:(0,te.jsx)(se,{strong:!0,children:"Total Amount:"})}),(0,te.jsx)(N.A.Summary.Cell,{index:1,children:(0,te.jsxs)(se,{strong:!0,children:["\u20b9 ",u(s.sub_total)]})})]})}),(0,te.jsxs)("div",{style:{marginTop:20,textAlign:"right"},children:[(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsx)(se,{strong:!0,children:"Value of Goods:"}),(0,te.jsxs)(se,{children:["\u20b9 ",u(s.value_of_goods)]})]}),s.discount>0&&(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsx)(se,{strong:!0,children:"Discount:"}),(0,te.jsx)(se,{children:"percentage"===s.discount_type?"".concat(s.discount,"%"):"\u20b9 ".concat(u(s.discount))})]}),(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsx)(se,{strong:!0,children:"Total GST:"}),(0,te.jsxs)(se,{children:["\u20b9 ",u(s.total_gst)]})]}),(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsx)(se,{strong:!0,children:"CGST:"}),(0,te.jsxs)(se,{children:["\u20b9 ",u(s.cgst||s.total_gst/2)]})]}),(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsx)(se,{strong:!0,children:"SGST:"}),(0,te.jsxs)(se,{children:["\u20b9 ",u(s.sgst||s.total_gst/2)]})]}),(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"8px",marginBottom:"8px"},children:[(0,te.jsxs)(se,{strong:!0,children:["retail"===s.sale_type?"Bill Value":"Invoice Value",":"]}),(0,te.jsxs)(se,{children:["\u20b9 ",u(s.total_amount)]})]}),(0,te.jsx)(se,{strong:!0,children:"Payment Status: "}),s.is_paid?(0,te.jsx)(se,{type:"success",children:"Fully Paid"}):s.is_partially_paid?(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(se,{type:"warning",children:"Partially Paid"}),(0,te.jsx)("br",{}),(0,te.jsxs)(se,{children:["Paid Amount: \u20b9 ",u(s.paid_amount)]}),(0,te.jsx)("br",{}),(0,te.jsxs)(se,{children:["Remaining Amount: \u20b9"," ",u(Number(s.total_amount)-Number(s.paid_amount))]})]}):(0,te.jsx)(se,{type:"danger",children:"Unpaid"})]}),(0,te.jsx)("div",{style:{textAlign:"center",marginTop:40},children:(0,te.jsx)(se,{style:{color:"#1890ff",fontWeight:500},children:"Thank you for shopping with us!"})})]}),(0,te.jsx)("iframe",{ref:r,style:{display:"none"},title:"print-frame"}),(0,te.jsx)(le,{visible:c,onClose:()=>d(!1),billData:s,customerEmail:null===s||void 0===s||null===(n=s.customerDetails)||void 0===n?void 0:n.email,customerName:null===s||void 0===s||null===(o=s.customerDetails)||void 0===o?void 0:o.full_name})]})};var ce=n(4413),de=n(71281),me=n(47246),ue=n(39177),pe=n(89472),ve=n(98350);const ge=["delete"],{Title:he}=a.A,xe=()=>{var e,t,a,w,E,N,O;const{BillTemplateComponent:B,InvoiceTemplateComponent:M,settings:F}=(0,ue.V)(),V=(0,l.useMemo)((()=>(0,pe.getCurrentUser)()),[]),L=(null===V||void 0===V?void 0:V.organisation_id)||(null===V||void 0===V||null===(e=V.organisationItems)||void 0===e?void 0:e._id),{data:z}=ve.lh.useGetOrganisationsQuery({organisation_id:L},{skip:!L}),Y=(0,l.useMemo)((()=>{const e=null===z||void 0===z?void 0:z.result;return Array.isArray(e)?e[0]:e||(null===V||void 0===V?void 0:V.organisationItems)||{}}),[z,V]),[q,G]=(0,l.useState)(null),[R,U]=(0,l.useState)(!1),[W,Q]=(0,l.useState)(!1),[H]=s.A.useForm(),[X,K]=(0,l.useState)(""),[J,Z]=(0,l.useState)({current:1,pageSize:10}),[$,ee]=(0,l.useState)(!1),[ne,oe]=(0,l.useState)(null),[ie,ae]=(0,l.useState)("completed"),se=(0,me.Ib)("SalesRecord"),{data:xe,isLoading:ye,refetch:je}=se.useGetAll({pageNumber:J.current,pageLimit:J.pageSize,searchString:X,status:"drafts"===ie?"draft":"completed"}),fe=xe||{result:[],pagination:null},_e=se.useDelete(),{delete:be}=_e,Ae=(0,i.A)(_e,ge);(0,de.z)({action:"delete",title:"Sale",mutationResult:Ae,refetch:je});const Se=e=>{var t,n;const o=e.customerDetails;return o||console.warn("\u26a0\ufe0f Data mismatch: ".concat(e.document_type||"Bill"," missing customerDetails"),e),{customerName:(null===o||void 0===o?void 0:o.full_name)||(null===o||void 0===o?void 0:o.name)||"",customerCompanyName:(null===o||void 0===o?void 0:o.company_name)||"",customerAddress:(null===o||void 0===o?void 0:o.address)||(null===o||void 0===o?void 0:o.address1)||"",customerCity:(null===o||void 0===o?void 0:o.city)||"",customerState:(null===o||void 0===o?void 0:o.state)||"",customerPincode:(null===o||void 0===o?void 0:o.pincode)||"",customerPhone:(null===o||void 0===o?void 0:o.phone)||(null===o||void 0===o?void 0:o.mobile)||"",customerEmail:(null===o||void 0===o?void 0:o.email)||"",customer_gstin:(null===o||void 0===o?void 0:o.gst_no)||(null===o||void 0===o?void 0:o.gst_number)||(null===o||void 0===o?void 0:o.gstin)||"",customer_pan:(null===o||void 0===o?void 0:o.pan_no)||(null===o||void 0===o?void 0:o.pan_number)||"",date:e.date,invoice_no:e.invoice_no,items:(e.Items||[]).map((e=>{var t,n,o,i,l,a,s,r,c,d,m;return{name:[(null===(t=e.productItems)||void 0===t?void 0:t.name)||e.product_name||"",(null===(n=e.productItems)||void 0===n||null===(o=n.VariantItem)||void 0===o?void 0:o.variant_name)||""].filter(Boolean).join(" "),product_name:(null===(i=e.productItems)||void 0===i?void 0:i.name)||e.product_name||"",qty:e.qty,quantity:e.quantity||e.qty,price:e.price,mrp:e.mrp,amount:e.amount,hsn_code:e.hsn_code||(null===(l=e.productItems)||void 0===l?void 0:l.hsn_code)||(null===(a=e.productItems)||void 0===a||null===(s=a.VariantItem)||void 0===s?void 0:s.hsn_code)||"",hsn_sac:e.hsn_sac||(null===(r=e.productItems)||void 0===r?void 0:r.hsn_sac)||"",tax_percentage:e.tax_percentage||(null===(c=e.productItems)||void 0===c||null===(d=c.CategoryItem)||void 0===d?void 0:d.tax_percentage)||(null===(m=e.productItems)||void 0===m?void 0:m.tax_percentage)||0,discount:e.discount||0,description:e.description||""}})),total:e.total_amount||0,total_amount:e.total_amount||0,value_of_goods:e.value_of_goods||0,sub_total:e.sub_total||0,total_gst:e.total_gst||0,cgst:e.cgst||(e.total_gst||0)/2,sgst:e.sgst||(e.total_gst||0)/2,discountValue:e.discountValue||0,discount:e.discount||0,discount_type:e.discount_type||"",is_gst_included:null===(t=e.is_gst_included)||void 0===t||t,gst_number:e.gst_number||(null===(n=e.organisationItems)||void 0===n?void 0:n.gst_number)||(null===Y||void 0===Y?void 0:Y.gst_number)||"",is_paid:e.is_paid||!1,is_partially_paid:e.is_partially_paid||!1,paid_amount:e.paid_amount||0,payment_mode:e.payment_mode||"Cash",organisationItems:e.organisationItems||Y||(null===V||void 0===V?void 0:V.organisationItems)||{},branchItems:e.branchItems||(null===V||void 0===V?void 0:V.branchItems)||{}}},Ce=[{title:"Status",dataIndex:"status",key:"status",width:100,render:e=>"draft"===e?(0,te.jsx)(r.A,{color:"orange",children:"DRAFT"}):(0,te.jsx)(r.A,{color:"green",children:"COMPLETED"})},{title:"Invoice",dataIndex:"invoice_no",key:"invoice_no",render:e=>(0,te.jsx)(r.A,{icon:(0,te.jsx)(g.A,{}),color:"blue",children:e})},{title:"Type",dataIndex:"document_type",key:"document_type",width:100,render:e=>{const t=!e||"bill"===e;return(0,te.jsx)(r.A,{color:t?"cyan":"purple",children:t?"BILL":"INVOICE"})}},{title:"Date",dataIndex:"date",key:"date",render:e=>(0,te.jsx)(c.A,{title:P()(e).format("MMMM D, YYYY"),children:(0,te.jsx)(r.A,{icon:(0,te.jsx)(h.A,{}),color:"purple",children:P()(e).format("DD MMM YY")})})},{title:"Customer",dataIndex:"customerDetails",key:"customerDetails",render:(e,t)=>{const n=e,o=(null===n||void 0===n?void 0:n.full_name)||(null===n||void 0===n?void 0:n.name)||"N/A",i=(null===n||void 0===n?void 0:n.phone)||(null===n||void 0===n?void 0:n.mobile)||"";return(0,te.jsxs)(d.A,{children:[(0,te.jsx)(x.A,{}),(0,te.jsxs)("span",{children:[(0,te.jsx)("strong",{children:o}),(0,te.jsx)("br",{}),(0,te.jsx)("small",{style:{color:"#999"},children:i})]})]})}},{title:"Payment Mode",dataIndex:"payment_mode",key:"payment_mode",render:e=>{const t="cash"===e?"green":"upi"===e?"geekblue":"orange";return(0,te.jsx)(r.A,{icon:(0,te.jsx)(y.A,{}),color:t,children:e.toUpperCase()})}},{title:"Total",dataIndex:"total_amount",key:"total_amount",render:e=>(0,te.jsxs)(r.A,{icon:(0,te.jsx)(j.A,{}),color:"gold",children:["\u20b9 ",Number(e).toFixed(2)]})},{title:"Actions",key:"actions",render:(e,t)=>{const i="draft"===t.status;return(0,te.jsxs)(d.A,{size:"middle",children:[(0,te.jsx)(c.A,{title:"View Bill",children:(0,te.jsx)(m.Ay,{type:"link",icon:(0,te.jsx)(f.A,{}),onClick:()=>(e=>{G(e),H.setFieldsValue((0,o.A)((0,o.A)({},e),{},{date:P()(e.date)})),U(!0)})(t)})}),!i&&(0,te.jsxs)(te.Fragment,{children:[(0,te.jsx)(c.A,{title:"Send via Email",children:(0,te.jsx)(m.Ay,{type:"link",icon:(0,te.jsx)(_.A,{}),onClick:()=>(e=>{oe(e),ee(!0)})(t)})}),(0,te.jsx)(c.A,{title:"Print",children:(0,te.jsx)(m.Ay,{type:"link",icon:(0,te.jsx)(b.A,{}),onClick:()=>(async e=>{const t=Se(e),i=e.document_type||"bill";let a="";if(null!==F&&void 0!==F&&F.enable_payment_qr&&null!==F&&void 0!==F&&F.upi_id)try{const{generateUPIQRCode:e,formatBillToUPIParams:o}=await Promise.resolve().then(n.bind(n,356)),i=o(t,F);i&&(a=await e(i,{width:(null===F||void 0===F?void 0:F.qr_size)||150}))}catch(p){console.error("Error pre-generating QR code for print:",p)}const s=(0,o.A)((0,o.A)({},F),{},{qrCodeDataUrl:a}),r="bill"===i?B:M,c=l.createElement(r,{billData:t,settings:s}),d=k.renderToString(c),{printAsPDF:m}=await Promise.all([n.e(7828),n.e(8090)]).then(n.bind(n,48090)),u="".concat(i,"_").concat(t.invoice_no,"_").concat(P()().format("YYYYMMDD"));await m(d,u,i)})(t)})}),(0,te.jsx)(c.A,{title:"Download PDF",children:(0,te.jsx)(m.Ay,{type:"link",icon:(0,te.jsx)(A.A,{}),onClick:()=>(async e=>{const t=Se(e),i=e.document_type||"bill";let a="";if(null!==F&&void 0!==F&&F.enable_payment_qr&&null!==F&&void 0!==F&&F.upi_id)try{const{generateUPIQRCode:e,formatBillToUPIParams:o}=await Promise.resolve().then(n.bind(n,356)),i=o(t,F);i&&(a=await e(i,{width:(null===F||void 0===F?void 0:F.qr_size)||150}))}catch(p){console.error("Error pre-generating QR code for download:",p)}const s=(0,o.A)((0,o.A)({},F),{},{qrCodeDataUrl:a}),r="bill"===i?B:M,c=l.createElement(r,{billData:t,settings:s}),d=k.renderToString(c),{downloadAsPDF:m}=await Promise.all([n.e(7828),n.e(8090)]).then(n.bind(n,48090)),u="".concat(i,"_").concat(t.invoice_no,"_").concat(P()().format("YYYYMMDD"));await m(d,u,i)})(t)})})]}),(0,te.jsx)(u.A,{title:"Are you sure to delete this bill?",onConfirm:()=>(async e=>{try{await be(e)}catch(t){}})(t._id),okText:"Yes",cancelText:"No",children:(0,te.jsx)(c.A,{title:"Delete",children:(0,te.jsx)(m.Ay,{type:"link",icon:(0,te.jsx)(S.A,{}),danger:!0})})})]})}}];return(0,te.jsxs)("div",{style:{padding:24},children:[(0,te.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,te.jsx)(he,{level:3,style:{color:"#1890ff",margin:0},children:"Sales List"}),(0,te.jsxs)(d.A,{children:[(0,te.jsx)(p.A,{placeholder:"Search by invoice no, customer name or mobile",prefix:(0,te.jsx)(C.A,{}),allowClear:!0,style:{width:300},onChange:e=>{return t=e.target.value,K(t),void Z((0,o.A)((0,o.A)({},J),{},{current:1}));var t}}),(0,te.jsx)(m.Ay,{type:"primary",icon:(0,te.jsx)(I.A,{}),onClick:()=>{G(null),U(!0)},children:"Create New Sale"})]})]}),(0,te.jsx)(v.A,{activeKey:ie,onChange:e=>{ae(e),Z({current:1,pageSize:J.pageSize})},items:[{key:"completed",label:(0,te.jsxs)("span",{children:["\u2705 Completed Bills (","completed"===ie?(null===fe||void 0===fe||null===(t=fe.result)||void 0===t?void 0:t.length)||0:"-",")"]})},{key:"drafts",label:(0,te.jsxs)("span",{children:["\ud83d\udcdd Drafts (","drafts"===ie?(null===fe||void 0===fe||null===(a=fe.result)||void 0===a?void 0:a.length)||0:"-",")"]})}],style:{marginBottom:16}}),(0,te.jsx)(ce.A,{data:(null===fe||void 0===fe?void 0:fe.result)||[],columns:Ce,loading:ye,bordered:!0,rowKey:"_id",totalCount:(null===fe||void 0===fe||null===(w=fe.pagination)||void 0===w?void 0:w.totalCount)||(null===fe||void 0===fe||null===(E=fe.result)||void 0===E?void 0:E.length)||0,pageLimit:J.pageSize,onPaginationChange:(e,t)=>{Z({current:e,pageSize:t})}}),(0,te.jsx)(T.A,{title:q?"Edit Sale":"Create New Sale",onClose:()=>U(!1),open:R,width:"100%",children:(0,te.jsx)(D.default,{billdata:q,onSuccess:()=>{U(!1),je()}})}),q&&(0,te.jsx)(re,{visible:W,onClose:()=>Q(!1),billData:q}),(0,te.jsx)(le,{visible:$,onClose:()=>{ee(!1),oe(null)},billData:ne,customerEmail:null===ne||void 0===ne||null===(N=ne.customerDetails)||void 0===N?void 0:N.email,customerName:null===ne||void 0===ne||null===(O=ne.customerDetails)||void 0===O?void 0:O.full_name})]})}},60647:(e,t,n)=>{n.d(t,{A:()=>C});var o=n(65043),i=n(24255),l=n(98139),a=n.n(l),s=n(28678),r=n(18574),c=n(35296),d=n(36282),m=n(38046),u=n(98986),p=n(95206),v=n(64160),g=n(10370),h=n(76970),x=n(34382),y=n(78855);const j=(0,y.OF)("Popconfirm",(e=>(e=>{const{componentCls:t,iconCls:n,antCls:o,zIndexPopup:i,colorText:l,colorWarning:a,marginXXS:s,marginXS:r,fontSize:c,fontWeightStrong:d,colorTextHeading:m}=e;return{[t]:{zIndex:i,["&".concat(o,"-popover")]:{fontSize:c},["".concat(t,"-message")]:{marginBottom:r,display:"flex",flexWrap:"nowrap",alignItems:"start",["> ".concat(t,"-message-icon ").concat(n)]:{color:a,fontSize:c,lineHeight:1,marginInlineEnd:r},["".concat(t,"-title")]:{fontWeight:d,color:m,"&:only-child":{fontWeight:"normal"}},["".concat(t,"-description")]:{marginTop:s,color:l}},["".concat(t,"-buttons")]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:r}}}}})(e)),(e=>{const{zIndexPopupBase:t}=e;return{zIndexPopup:t+60}}),{resetStyle:!1});var f=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};const _=e=>{const{prefixCls:t,okButtonProps:n,cancelButtonProps:l,title:a,description:s,cancelText:r,okText:d,okType:x="primary",icon:y=o.createElement(i.A,null),showCancel:j=!0,close:f,onConfirm:_,onCancel:b,onPopupClick:A}=e,{getPrefixCls:S}=o.useContext(c.QO),[C]=(0,g.A)("Popconfirm",h.A.Popconfirm),I=(0,u.b)(a),w=(0,u.b)(s);return o.createElement("div",{className:"".concat(t,"-inner-content"),onClick:A},o.createElement("div",{className:"".concat(t,"-message")},y&&o.createElement("span",{className:"".concat(t,"-message-icon")},y),o.createElement("div",{className:"".concat(t,"-message-text")},I&&o.createElement("div",{className:"".concat(t,"-title")},I),w&&o.createElement("div",{className:"".concat(t,"-description")},w))),o.createElement("div",{className:"".concat(t,"-buttons")},j&&o.createElement(p.Ay,Object.assign({onClick:b,size:"small"},l),r||(null===C||void 0===C?void 0:C.cancelText)),o.createElement(m.A,{buttonProps:Object.assign(Object.assign({size:"small"},(0,v.DU)(x)),n),actionFn:_,close:f,prefixCls:S("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},d||(null===C||void 0===C?void 0:C.okText))))},b=e=>{const{prefixCls:t,placement:n,className:i,style:l}=e,s=f(e,["prefixCls","placement","className","style"]),{getPrefixCls:r}=o.useContext(c.QO),d=r("popconfirm",t),[m]=j(d);return m(o.createElement(x.Ay,{placement:n,className:a()(d,i),style:l,content:o.createElement(_,Object.assign({prefixCls:d},s))}))};var A=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n};const S=o.forwardRef(((e,t)=>{var n,l;const{prefixCls:m,placement:u="top",trigger:p="click",okType:v="primary",icon:g=o.createElement(i.A,null),children:h,overlayClassName:x,onOpenChange:y,onVisibleChange:f,overlayStyle:b,styles:S,classNames:C}=e,I=A(e,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange","overlayStyle","styles","classNames"]),{getPrefixCls:w,className:P,style:k,classNames:T,styles:D}=(0,c.TP)("popconfirm"),[E,N]=(0,s.A)(!1,{value:null!==(n=e.open)&&void 0!==n?n:e.visible,defaultValue:null!==(l=e.defaultOpen)&&void 0!==l?l:e.defaultVisible}),O=(e,t)=>{N(e,!0),null===f||void 0===f||f(e),null===y||void 0===y||y(e,t)},B=w("popconfirm",m),M=a()(B,P,x,T.root,null===C||void 0===C?void 0:C.root),F=a()(T.body,null===C||void 0===C?void 0:C.body),[V]=j(B);return V(o.createElement(d.A,Object.assign({},(0,r.A)(I,["title"]),{trigger:p,placement:u,onOpenChange:(t,n)=>{const{disabled:o=!1}=e;o||O(t,n)},open:E,ref:t,classNames:{root:M,body:F},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign({},D.root),k),b),null===S||void 0===S?void 0:S.root),body:Object.assign(Object.assign({},D.body),null===S||void 0===S?void 0:S.body)},content:o.createElement(_,Object.assign({okType:v,icon:g},e,{prefixCls:B,close:e=>{O(!1,e)},onConfirm:t=>{var n;return null===(n=e.onConfirm)||void 0===n?void 0:n.call(void 0,t)},onCancel:t=>{var n;O(!1,t),null===(n=e.onCancel)||void 0===n||n.call(void 0,t)}})),"data-popover-inject":!0}),h))}));S._InternalPanelDoNotUseOrYouWillBeFired=b;const C=S}}]);
//# sourceMappingURL=1769.1d1678f2.chunk.js.map