{"version":3,"file":"static/js/159.0a018459.chunk.js","mappings":"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","sources":["pages/RetaillBill/components/BillDataGrid.tsx","helpers/sanitize.ts","webpack://SUBRIVA-BILLING/./src/components/common/EmailSendModal.module.css?97c3","components/common/EmailSendModal.tsx","pages/RetaillBill/components/BillViewModal.tsx","pages/RetaillBill/templates/ClassicBillingTemplate.tsx","pages/RetaillBill/templates/registry.ts","pages/RetaillBill/templates/ModernBillingTemplate.tsx","pages/RetaillBill/BillListPage.tsx"],"sourcesContent":["import React, { useEffect, useState, useMemo, useCallback } from 'react';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport {\r\n  Button,\r\n  Typography,\r\n  message,\r\n  Switch,\r\n  InputNumber,\r\n  Badge,\r\n  Tooltip,\r\n} from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport AntdEditableTable, {\r\n  AntdEditableColumn,\r\n} from '../../../components/common/AntdEditableTable';\r\nimport { useApiActions } from '../../../services/api/useApiActions';\r\nimport { useDynamicSelector } from '../../../services/redux';\r\nimport { calculateBillTotals } from '../../../helpers/amount_calculations';\r\nimport { useHandleApiResponse } from '../../../components/common/useHandleApiResponse';\r\nimport { BillItem, BillFormData } from '../../../types/entities';\r\nimport {\r\n  SaveOutlined,\r\n  PrinterOutlined,\r\n  FileTextOutlined,\r\n  ClearOutlined,\r\n} from '@ant-design/icons';\r\nimport StockSelectionModal from './StockSelectionModal';\r\nimport CustomerSelectionModal from './CustomerSelectionModal';\r\nimport UserSelectionModal from './UserSelectionModal';\r\nimport BillSaveConfirmationModal from './BillSaveConfirmationModal';\r\nimport BillListDrawer from './BillListDrawer';\r\nimport ProductDetailsModal from './ProductDetailsModal';\r\nimport ProductSelectionModal from './ProductSelectionModal';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillDataGridProps {\r\n  billdata?: any;\r\n  onSuccess?: (formattedBill?: any) => void;\r\n}\r\n\r\nconst BillDataGrid: React.FC<BillDataGridProps> = ({ billdata, onSuccess }) => {\r\n  const { getEntityApi } = useApiActions();\r\n\r\n  // Utility function to validate stock quantities based on pack size\r\n  const validateStockQuantities = useCallback(\r\n    (stock: any, productItem: any) => {\r\n      if (!stock || !productItem?.VariantItem?.pack_size)\r\n        return { isValid: true, expectedLoose: 0, totalAvailable: 0 };\r\n\r\n      const packSize = parseInt(productItem.VariantItem.pack_size);\r\n      const availablePackQty = stock.available_quantity || 0;\r\n      const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n      // Stock quantities are valid as they are - no need to enforce a specific relationship\r\n      // The validation happens during quantity entry, not during stock data validation\r\n      const isValid = true; // Always valid - let the quantity validation handle limits\r\n      const totalAvailable = availablePackQty * packSize + availableLooseQty;\r\n\r\n      return { isValid, expectedLoose: availableLooseQty, totalAvailable };\r\n    },\r\n    []\r\n  );\r\n\r\n  // API hooks\r\n  const ProductsApi = getEntityApi('Product');\r\n  const CustomerApi = getEntityApi('Customer');\r\n  const BillingUsersApi = getEntityApi('BillingUsers');\r\n  const StockAuditApi = getEntityApi('StockAudit');\r\n  const BranchStock = getEntityApi('BranchStock');\r\n  const SalesRecord = getEntityApi('SalesRecord');\r\n  const InvoiceNumberApi = getEntityApi('InvoiceNumber');\r\n\r\n  // Redux selectors\r\n  const { items: productList, loading: productLoading } = useDynamicSelector(\r\n    ProductsApi.getIdentifier('GetAll')\r\n  );\r\n  const { items: customerList, loading: customerLoading } = useDynamicSelector(\r\n    CustomerApi.getIdentifier('GetAll')\r\n  );\r\n  const { items: userList, loading: userLoading } = useDynamicSelector(\r\n    BillingUsersApi.getIdentifier('GetAll')\r\n  );\r\n  const { items: stockAuditList, loading: stockLoading } = useDynamicSelector(\r\n    StockAuditApi.getIdentifier('GetAll')\r\n  );\r\n  const { items: branchStockList, loading: branchStockLoading } =\r\n    useDynamicSelector(BranchStock.getIdentifier('GetAll'));\r\n  const { items: invoice_no_item } = useDynamicSelector(\r\n    InvoiceNumberApi.getIdentifier('GetAll')\r\n  );\r\n  const { items: invoice_no_create_item, loading: invoice_no_create_loading } =\r\n    useDynamicSelector(InvoiceNumberApi.getIdentifier('Create'));\r\n  const { loading: saleCreateLoading } = useDynamicSelector(\r\n    SalesRecord.getIdentifier('Create')\r\n  );\r\n\r\n  // State\r\n  const [billFormData, setBillFormData] = useState<BillFormData>({\r\n    invoice_no: '',\r\n    date: dayjs().format('YYYY-MM-DD'),\r\n    customer_id: '',\r\n    customer_name: '',\r\n    billed_by_id: '',\r\n    billed_by_name: '',\r\n    payment_mode: 'cash',\r\n    items: [],\r\n  });\r\n\r\n  const [billSettings, setBillSettings] = useState({\r\n    isPaid: true,\r\n    isPartiallyPaid: false,\r\n    isRetail: true,\r\n    isGstIncluded: true,\r\n    discount: 0,\r\n    discountType: 'percentage' as 'percentage' | 'amount',\r\n    paidAmount: 0,\r\n  });\r\n\r\n  const [stockModalRowIndex, setStockModalRowIndex] = useState<number | null>(\r\n    null\r\n  );\r\n  const [externalEditingCell, setExternalEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n  const [customerModalVisible, setCustomerModalVisible] = useState(false);\r\n  const [userModalVisible, setUserModalVisible] = useState(false);\r\n  const [saveConfirmationVisible, setSaveConfirmationVisible] = useState(false);\r\n  const [billListDrawerVisible, setBillListDrawerVisible] = useState(false);\r\n  const [savedBillData, setSavedBillData] = useState<any>(null);\r\n  const [productDetailsModalVisible, setProductDetailsModalVisible] =\r\n    useState(false);\r\n  const [selectedProductId, setSelectedProductId] = useState<string>('');\r\n  const [productSelectionModalVisible, setProductSelectionModalVisible] =\r\n    useState(false);\r\n  const [productSelectionRowIndex, setProductSelectionRowIndex] = useState<\r\n    number | null\r\n  >(null);\r\n  const [lastInteractedRowIndex, setLastInteractedRowIndex] =\r\n    useState<number>(0);\r\n\r\n  // User info - memoized to prevent re-parsing on every render\r\n  const user = useMemo(() => {\r\n    return getCurrentUser();\r\n  }, []);\r\n  const branchId = user?.branch_id;\r\n\r\n  // Helper function to validate stock quantities\r\n  const validateStockQuantity = (\r\n    stockId: string,\r\n    qty: number,\r\n    looseQty: number\r\n  ): {\r\n    isValid: boolean;\r\n    availablePackQty: number;\r\n    maxLooseQty: number;\r\n    message: string;\r\n  } => {\r\n    const stockList = branchId ? branchStockList : stockAuditList;\r\n    const stock = stockList?.result?.find((s: any) => s._id === stockId);\r\n\r\n    if (!stock) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty: 0,\r\n        maxLooseQty: 0,\r\n        message: 'Stock not found',\r\n      };\r\n    }\r\n\r\n    // Get pack size from stock data\r\n    const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n    const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n    // Available pack quantity (number of complete packs/boxes)\r\n    const availablePackQty = stock.available_quantity || 0;\r\n\r\n    // Available loose quantity (actual loose items in stock, not calculated)\r\n    const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n    // Validate pack quantity (QTY field)\r\n    if (qty > availablePackQty) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty,\r\n        maxLooseQty: 0,\r\n        message: `Pack quantity (${qty}) exceeds available packs (${availablePackQty})`,\r\n      };\r\n    }\r\n\r\n    // Calculate max loose quantity based on remaining packs after QTY selection\r\n    // Formula: (available_packs - selected_qty)  pack_size + available_loose_qty\r\n    const remainingPacks = availablePackQty - qty;\r\n    const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n    const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n    // Validate loose quantity (LOOSE QTY field)\r\n    if (looseQty > maxLooseQty) {\r\n      return {\r\n        isValid: false,\r\n        availablePackQty,\r\n        maxLooseQty,\r\n        message: `Loose quantity (${looseQty}) exceeds available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`,\r\n      };\r\n    }\r\n\r\n    return {\r\n      isValid: true,\r\n      availablePackQty,\r\n      maxLooseQty,\r\n      message: '',\r\n    };\r\n  };\r\n\r\n  // Handle quantity change with validation - memoized to prevent column recreation\r\n  const handleQuantityChange = useCallback(\r\n    (rowIndex: number, field: 'qty' | 'loose_qty', value: number) => {\r\n      const newItems = [...billFormData.items];\r\n      const item = newItems[rowIndex];\r\n\r\n      if (!item.stock_id) {\r\n        // If no stock selected, just update the value\r\n        newItems[rowIndex] = { ...item, [field]: value };\r\n        setBillFormData(prev => ({ ...prev, items: newItems }));\r\n        return;\r\n      }\r\n\r\n      // Validate the new quantity\r\n      const newQty = field === 'qty' ? value : item.qty || 0;\r\n      const newLooseQty = field === 'loose_qty' ? value : item.loose_qty || 0;\r\n\r\n      const validation = validateStockQuantity(\r\n        item.stock_id,\r\n        newQty,\r\n        newLooseQty\r\n      );\r\n\r\n      if (!validation.isValid) {\r\n        message.error(validation.message);\r\n\r\n        // Auto-correct the quantity if it exceeds available stock\r\n        if (field === 'qty' && newQty > validation.availablePackQty) {\r\n          newItems[rowIndex] = {\r\n            ...item,\r\n            qty: validation.availablePackQty,\r\n          };\r\n        } else if (\r\n          field === 'loose_qty' &&\r\n          newLooseQty > validation.maxLooseQty\r\n        ) {\r\n          newItems[rowIndex] = { ...item, loose_qty: validation.maxLooseQty };\r\n        }\r\n      } else {\r\n        // Update the quantity\r\n        newItems[rowIndex] = { ...item, [field]: value };\r\n      }\r\n\r\n      setBillFormData(prev => ({ ...prev, items: newItems }));\r\n    },\r\n    [billFormData.items, validateStockQuantity]\r\n  );\r\n\r\n  // Initialize data\r\n  useEffect(() => {\r\n    ProductsApi('GetAll');\r\n    CustomerApi('GetAll');\r\n    BillingUsersApi('GetAll');\r\n    // Only get invoice number for new bills, not when editing existing bills\r\n    if (!billdata && !invoice_no_create_loading) {\r\n      InvoiceNumberApi('GetAll');\r\n    }\r\n\r\n    if (billdata) {\r\n      setBillFormData({\r\n        invoice_no: billdata.invoice_no,\r\n        date: dayjs(billdata.date).format('YYYY-MM-DD'),\r\n        customer_id: billdata.customer_id,\r\n        customer_name: billdata.customerDetails?.full_name || '',\r\n        billed_by_id: billdata.billed_by_id || '',\r\n        billed_by_name: billdata.billedByDetails?.name || '',\r\n        payment_mode: billdata.payment_mode,\r\n        items:\r\n          billdata.Items?.map((item: any) => ({\r\n            _id: item._id,\r\n            product_id: item.product_id,\r\n            product_name: item.productItems?.name || '',\r\n            variant_name: item.productItems?.VariantItem?.variant_name || '',\r\n            stock_id: branchId ? item.branch_stock_id : item.stock_id,\r\n            qty: item.qty || 0,\r\n            loose_qty: item.loose_qty || 0,\r\n            price: item.price,\r\n            mrp: item.mrp || item.price,\r\n            amount: item.amount,\r\n            tax_percentage: item.tax_percentage || 0,\r\n          })) || [],\r\n      });\r\n\r\n      setBillSettings({\r\n        isPaid: billdata.is_paid ?? true,\r\n        isPartiallyPaid: billdata.is_partially_paid ?? false,\r\n        isRetail: billdata.sale_type === 'retail',\r\n        isGstIncluded: billdata.is_gst_included ?? true,\r\n        discount: billdata.discount ?? 0,\r\n        discountType: billdata.discount_type ?? 'percentage',\r\n        paidAmount: billdata.paid_amount ?? 0,\r\n      });\r\n    }\r\n  }, [billdata]);\r\n\r\n  // Set auto-generated invoice number\r\n  useEffect(() => {\r\n    if (invoice_no_item?.result?.invoice_no && !billdata) {\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        invoice_no: invoice_no_item.result.invoice_no,\r\n      }));\r\n    }\r\n  }, [invoice_no_item, billdata]);\r\n\r\n  // Initialize with 5 default empty items if no existing data\r\n  useEffect(() => {\r\n    if (!billdata && billFormData.items.length === 0) {\r\n      const defaultItems = Array(1)\r\n        .fill(null)\r\n        .map((_, index) => ({\r\n          product_id: '',\r\n          product_name: '',\r\n          variant_name: '',\r\n          stock_id: '',\r\n          batch_no: '',\r\n          qty: 0,\r\n          loose_qty: 0,\r\n          price: 0,\r\n          mrp: 0,\r\n          amount: 0,\r\n          tax_percentage: 0,\r\n        }));\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        items: defaultItems,\r\n      }));\r\n    }\r\n  }, [billdata, billFormData.items.length]);\r\n\r\n  // Auto-set current user as billed_by for new bills\r\n  useEffect(() => {\r\n    if (\r\n      !billdata &&\r\n      userList?.result &&\r\n      user?._id &&\r\n      !billFormData.billed_by_id\r\n    ) {\r\n      const currentUserInList = userList.result.find(\r\n        (u: any) => u._id === user._id\r\n      );\r\n      if (currentUserInList) {\r\n        setBillFormData(prev => ({\r\n          ...prev,\r\n          billed_by_id: user._id,\r\n          billed_by_name: currentUserInList.name || user.name || '',\r\n        }));\r\n      }\r\n    }\r\n  }, [userList, user?._id, billdata, billFormData.billed_by_id]);\r\n\r\n  // Product and stock options\r\n  const productOptions = useMemo(\r\n    () =>\r\n      productList?.result?.map((product: any) => ({\r\n        label:\r\n          `${product.name} ${product?.VariantItem?.variant_name || ''}`.trim(),\r\n        value: product._id,\r\n      })) || [],\r\n    [productList]\r\n  );\r\n\r\n  const customerOptions = useMemo(() => {\r\n    const options =\r\n      customerList?.result?.map((customer: any) => ({\r\n        label: `${customer.full_name} - ${customer.mobile}`,\r\n        value: customer._id,\r\n      })) || [];\r\n    return options;\r\n  }, [customerList]);\r\n\r\n  const userOptions = useMemo(() => {\r\n    const options =\r\n      userList?.result?.map((user: any) => ({\r\n        label: `${user.name} (${user.roleItems?.name || 'No Role'})`,\r\n        value: user._id,\r\n      })) || [];\r\n    return options;\r\n  }, [userList]);\r\n\r\n  // Column definitions for bill header - memoized to prevent recreation\r\n  const headerColumns: AntdEditableColumn[] = useMemo(\r\n    () => [\r\n      {\r\n        key: 'invoice_no',\r\n        title: ' INVOICE #',\r\n        dataIndex: 'invoice_no',\r\n        type: 'text',\r\n        required: true,\r\n        width: 180,\r\n      },\r\n      {\r\n        key: 'date',\r\n        title: ' DATE',\r\n        dataIndex: 'date',\r\n        type: 'date',\r\n        required: true,\r\n        width: 150,\r\n      },\r\n      {\r\n        key: 'customer_id',\r\n        title: ' CUSTOMER',\r\n        dataIndex: 'customer_id',\r\n        type: 'select',\r\n        options: customerOptions,\r\n        required: true,\r\n        width: 250,\r\n        render: (value: any, record: any) => {\r\n          const selectedCustomer = customerOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          return (\r\n            <Tooltip title=\"Click to open customer selection modal (or press End key)\">\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={() => setCustomerModalVisible(true)}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#fafafa';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>\r\n                  {selectedCustomer\r\n                    ? selectedCustomer.label\r\n                    : 'Select customer'}\r\n                </span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#f0f8ff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  End\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'billed_by_id',\r\n        title: ' BILLED BY',\r\n        dataIndex: 'billed_by_id',\r\n        type: 'select',\r\n        options: userOptions,\r\n        required: false,\r\n        width: 250,\r\n        render: (value: any, record: any) => {\r\n          const selectedUser = userOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          return (\r\n            <Tooltip title=\"Click to open user selection modal (or press Ctrl+U key)\">\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#f0f8ff',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={() => setUserModalVisible(true)}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#e6f7ff';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f8ff';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>{selectedUser ? selectedUser.label : 'Select user'}</span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#ffffff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  Ctrl+U\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'payment_mode',\r\n        title: ' PAYMENT',\r\n        dataIndex: 'payment_mode',\r\n        type: 'select',\r\n        options: [\r\n          { label: ' Cash', value: 'cash' },\r\n          { label: ' UPI', value: 'upi' },\r\n          { label: ' Card', value: 'card' },\r\n        ],\r\n        required: true,\r\n        width: 150,\r\n      },\r\n    ],\r\n    [customerOptions, userOptions]\r\n  );\r\n\r\n  const headerData = useMemo(\r\n    () => [\r\n      {\r\n        invoice_no: billFormData.invoice_no,\r\n        date: billFormData.date,\r\n        customer_id: billFormData.customer_id,\r\n        billed_by_id: billFormData.billed_by_id,\r\n        payment_mode: billFormData.payment_mode,\r\n      },\r\n    ],\r\n    [\r\n      billFormData.invoice_no,\r\n      billFormData.date,\r\n      billFormData.customer_id,\r\n      billFormData.billed_by_id,\r\n      billFormData.payment_mode,\r\n    ]\r\n  );\r\n\r\n  // Column definitions for bill items - memoized to prevent recreation\r\n  const itemColumns: AntdEditableColumn[] = useMemo(\r\n    () => [\r\n      {\r\n        key: 'product_id',\r\n        title: ' PRODUCT',\r\n        dataIndex: 'product_id',\r\n        type: 'product', // triggers modal\r\n        required: true,\r\n        width: 280,\r\n        render: (value, record, index) => {\r\n          const selectedProduct = productOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          return (\r\n            <Tooltip\r\n              title={\r\n                value\r\n                  ? `Product: ${selectedProduct?.label || 'Unknown'} - Click to change  F5 to reopen`\r\n                  : 'Click to select product from inventory  F5 to open'\r\n              }\r\n              placement=\"top\"\r\n            >\r\n              <div\r\n                style={{\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: value ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                  backgroundColor: value ? '#f6ffed' : '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                  minHeight: '32px',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                }}\r\n                onClick={() => {\r\n                  // Open product selection modal\r\n                  if (typeof index === 'number') {\r\n                    setProductSelectionRowIndex(index);\r\n                    setLastInteractedRowIndex(index); // Track this row for F5\r\n                    setProductSelectionModalVisible(true);\r\n                  }\r\n                }}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = value\r\n                    ? '#f6ffed'\r\n                    : '#fafafa';\r\n                  e.currentTarget.style.borderColor = value\r\n                    ? '#52c41a'\r\n                    : '#d9d9d9';\r\n                }}\r\n              >\r\n                <span\r\n                  style={{\r\n                    color: value ? '#52c41a' : '#1890ff',\r\n                    fontWeight: value ? 600 : 400,\r\n                  }}\r\n                >\r\n                  {value\r\n                    ? selectedProduct?.label || 'Unknown Product'\r\n                    : 'Select product'}\r\n                </span>\r\n                {value && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '12px', color: '#52c41a' }}>\r\n                      \r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#52c41a',\r\n                        backgroundColor: '#f6ffed',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Selected\r\n                    </span>\r\n                  </div>\r\n                )}\r\n                {!value && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                      marginTop: '2px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '10px', color: '#ff4d4f' }}>\r\n                       Product required\r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#1890ff',\r\n                        backgroundColor: '#f0f8ff',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Click\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'stock_id',\r\n        title: ' STOCK',\r\n        dataIndex: 'batch_no',\r\n        type: 'stock',\r\n        required: true,\r\n        width: 280,\r\n        editable: true, // allow editing to open modal\r\n        render: (value, record, index) => {\r\n          // Get stock info for display\r\n          const stockList = branchId ? branchStockList : stockAuditList;\r\n          const stock = stockList?.result?.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n\r\n          // Get pack size from stock data\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n          // Calculate available quantities\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const availableLooseQty = stock?.available_loose_quantity || 0;\r\n\r\n          const isLowStock = availablePackQty > 0 && availablePackQty <= 10;\r\n          const isOutOfStock = availablePackQty === 0;\r\n\r\n          return (\r\n            <Tooltip\r\n              title={\r\n                record.product_id\r\n                  ? value\r\n                    ? `Stock: ${value} - Packs Available: ${availablePackQty}  Loose Available: ${availableLooseQty}  Pack Size: ${packSizeNum}  Click to change  F7 to reopen`\r\n                    : 'Click to select stock from available inventory  F7 to open'\r\n                  : 'Please select a product first to choose stock  F7 to open after product selection'\r\n              }\r\n              placement=\"top\"\r\n            >\r\n              <div\r\n                style={{\r\n                  cursor: 'pointer',\r\n                  padding: '6px 10px',\r\n                  borderRadius: '6px',\r\n                  border: value ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                  backgroundColor: value ? '#f6ffed' : '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                  minHeight: '32px',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  width: '100%',\r\n                  gap: '10px',\r\n                }}\r\n                onClick={() => {\r\n                  if (record.product_id && typeof index === 'number') {\r\n                    setStockModalRowIndex(index);\r\n                  } else if (!record.product_id) {\r\n                    message.warning('Please select a product first');\r\n                  }\r\n                }}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = value\r\n                    ? '#f6ffed'\r\n                    : '#fafafa';\r\n                  e.currentTarget.style.borderColor = value\r\n                    ? '#52c41a'\r\n                    : '#d9d9d9';\r\n                }}\r\n              >\r\n                {/* Left Section */}\r\n                <div\r\n                  style={{\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: '8px',\r\n                    flex: 1,\r\n                  }}\r\n                >\r\n                  <span\r\n                    style={{\r\n                      color: value\r\n                        ? '#52c41a'\r\n                        : record.product_id\r\n                          ? '#1890ff'\r\n                          : '#bfbfbf',\r\n                      fontWeight: value ? 600 : 400,\r\n                      fontSize: '13px',\r\n                      whiteSpace: 'nowrap',\r\n                    }}\r\n                  >\r\n                    {value || 'Select Stock'}\r\n                  </span>\r\n\r\n                  {/* Stock Badges (inline) */}\r\n                  {stock && (\r\n                    <>\r\n                      <span\r\n                        style={{\r\n                          color: isOutOfStock\r\n                            ? '#ff4d4f'\r\n                            : isLowStock\r\n                              ? '#faad14'\r\n                              : '#52c41a',\r\n                          fontWeight: 'bold',\r\n                          backgroundColor: isOutOfStock\r\n                            ? '#fff2f0'\r\n                            : isLowStock\r\n                              ? '#fffbe6'\r\n                              : '#f6ffed',\r\n                          padding: '2px 6px',\r\n                          borderRadius: '4px',\r\n                          border: `1px solid ${\r\n                            isOutOfStock\r\n                              ? '#ffccc7'\r\n                              : isLowStock\r\n                                ? '#ffe58f'\r\n                                : '#b7eb8f'\r\n                          }`,\r\n                          fontSize: '12px',\r\n                        }}\r\n                      >\r\n                         {availablePackQty}\r\n                      </span>\r\n                      <span\r\n                        style={{\r\n                          color: '#722ed1',\r\n                          fontWeight: 'bold',\r\n                          backgroundColor: '#f9f0ff',\r\n                          padding: '2px 6px',\r\n                          borderRadius: '4px',\r\n                          border: '1px solid #d3adf7',\r\n                          fontSize: '12px',\r\n                        }}\r\n                      >\r\n                         {availableLooseQty}\r\n                      </span>\r\n                    </>\r\n                  )}\r\n\r\n                  {/* Warning (inline, not breaking row) */}\r\n                  {record.product_id && !value && (\r\n                    <span\r\n                      style={{\r\n                        fontSize: '11px',\r\n                        color: '#ff4d4f',\r\n                        whiteSpace: 'nowrap',\r\n                      }}\r\n                    >\r\n                       Stock required\r\n                    </span>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Right Side \"Click\" Indicator */}\r\n                {record.product_id && (\r\n                  <div\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                    }}\r\n                  >\r\n                    <span style={{ fontSize: '12px', color: '#1890ff' }}>\r\n                      \r\n                    </span>\r\n                    <span\r\n                      style={{\r\n                        fontSize: '10px',\r\n                        color: '#52c41a',\r\n                        backgroundColor: '#f6ffed',\r\n                        padding: '2px 4px',\r\n                        borderRadius: '3px',\r\n                      }}\r\n                    >\r\n                      Click\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'qty',\r\n        title: ' QTY',\r\n        dataIndex: 'qty',\r\n        type: 'number',\r\n        width: 90,\r\n        render: (value: number, record: any, index?: number) => {\r\n          // Get stock info for validation\r\n          const stockList = branchId ? branchStockList : stockAuditList;\r\n          const stock = stockList?.result?.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const isExceedingStock = value > availablePackQty;\r\n\r\n          return (\r\n            <div style={{ position: 'relative' }}>\r\n              <InputNumber\r\n                value={value}\r\n                min={0}\r\n                max={availablePackQty}\r\n                style={{\r\n                  width: '100%',\r\n                  borderColor: isExceedingStock ? '#ff4d4f' : undefined,\r\n                  backgroundColor: isExceedingStock ? '#fff2f0' : undefined,\r\n                }}\r\n                onPressEnter={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'qty', newValue);\r\n                  }\r\n                }}\r\n                onBlur={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'qty', newValue);\r\n                  }\r\n                }}\r\n                onChange={newValue => {\r\n                  if (newValue !== null && newValue > availablePackQty) {\r\n                    message.error(\r\n                      `Pack quantity cannot exceed available packs (${availablePackQty})`\r\n                    );\r\n                    return;\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'loose_qty',\r\n        title: ' LOOSE',\r\n        dataIndex: 'loose_qty',\r\n        type: 'number',\r\n        width: 90,\r\n        render: (value: number, record: any, index?: number) => {\r\n          // Get stock info for validation\r\n          const stockList = branchId ? branchStockList : stockAuditList;\r\n          const stock = stockList?.result?.find(\r\n            (s: any) => s._id === record.stock_id\r\n          );\r\n\r\n          if (!stock) {\r\n            return (\r\n              <div style={{ position: 'relative' }}>\r\n                <InputNumber\r\n                  value={value}\r\n                  min={0}\r\n                  style={{ width: '100%' }}\r\n                  disabled\r\n                />\r\n              </div>\r\n            );\r\n          }\r\n\r\n          // Calculate dynamic max loose quantity based on current QTY selection\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n          const availablePackQty = stock?.available_quantity || 0;\r\n          const availableLooseQty = stock?.available_loose_quantity || 0;\r\n\r\n          // Current QTY selection affects max loose quantity\r\n          const currentQty = record.qty || 0;\r\n          const remainingPacks = availablePackQty - currentQty;\r\n          const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n          const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n          const isExceedingStock = value > maxLooseQty;\r\n\r\n          return (\r\n            <div style={{ position: 'relative' }}>\r\n              <InputNumber\r\n                value={value}\r\n                min={0}\r\n                max={maxLooseQty}\r\n                style={{\r\n                  width: '100%',\r\n                  borderColor: isExceedingStock ? '#ff4d4f' : undefined,\r\n                  backgroundColor: isExceedingStock ? '#fff2f0' : undefined,\r\n                }}\r\n                onPressEnter={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'loose_qty', newValue);\r\n                  }\r\n                }}\r\n                onBlur={e => {\r\n                  if (index !== undefined) {\r\n                    const target = e.target as HTMLInputElement;\r\n                    const newValue = parseInt(target.value) || 0;\r\n                    handleQuantityChange(index, 'loose_qty', newValue);\r\n                  }\r\n                }}\r\n                onChange={newValue => {\r\n                  if (newValue !== null && newValue > maxLooseQty) {\r\n                    message.error(\r\n                      `Loose quantity cannot exceed available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`\r\n                    );\r\n                    return;\r\n                  }\r\n                }}\r\n              />\r\n            </div>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'price',\r\n        title: ' RATE',\r\n        dataIndex: 'price',\r\n        type: 'number',\r\n        required: true,\r\n        width: 120,\r\n        editable: false, // Make rate not editable\r\n        render: value => (\r\n          <InputNumber value={value} disabled style={{ width: '100%' }} />\r\n        ),\r\n      },\r\n      {\r\n        key: 'amount',\r\n        title: ' AMOUNT',\r\n        dataIndex: 'amount',\r\n        type: 'number',\r\n        editable: false, // Make amount not editable\r\n        width: 130,\r\n        render: value => (\r\n          <InputNumber value={value} disabled style={{ width: '100%' }} />\r\n        ),\r\n      },\r\n    ],\r\n    [\r\n      productOptions,\r\n      branchId,\r\n      branchStockList,\r\n      stockAuditList,\r\n      handleQuantityChange,\r\n    ]\r\n  );\r\n\r\n  // Find the column index for qty\r\n  const qtyColIndex = itemColumns.findIndex(\r\n    col => col.key === 'qty' || col.dataIndex === 'qty'\r\n  );\r\n\r\n  // Calculate bill totals\r\n  const billCalculations = useMemo(() => {\r\n    if (!billFormData.items.length)\r\n      return {\r\n        sub_total: 0,\r\n        value_of_goods: 0,\r\n        total_gst: 0,\r\n        cgst: 0,\r\n        sgst: 0,\r\n        total_amount: 0,\r\n        discountValue: 0,\r\n      };\r\n\r\n    return calculateBillTotals({\r\n      items: billFormData.items,\r\n      productList: productList?.result || [],\r\n      isGstIncluded: billSettings.isGstIncluded,\r\n      discount: billSettings.discount,\r\n      discountType: billSettings.discountType,\r\n    });\r\n  }, [billFormData.items, productList, billSettings]);\r\n\r\n  // Handle header changes - memoized to prevent unnecessary re-renders\r\n  const handleHeaderChange = useCallback(\r\n    (headerRows: any[]) => {\r\n      const updatedHeader = headerRows[0];\r\n      if (updatedHeader) {\r\n        // Find customer name for display\r\n        const customer = customerList?.result?.find(\r\n          (c: any) => c._id === updatedHeader.customer_id\r\n        );\r\n        // Find user name for display\r\n        const user = userList?.result?.find(\r\n          (u: any) => u._id === updatedHeader.billed_by_id\r\n        );\r\n        setBillFormData(prev => ({\r\n          ...prev,\r\n          invoice_no: updatedHeader.invoice_no || '',\r\n          date: updatedHeader.date || dayjs().format('YYYY-MM-DD'),\r\n          customer_id: updatedHeader.customer_id || '',\r\n          customer_name: customer?.full_name || '',\r\n          billed_by_id: updatedHeader.billed_by_id || '',\r\n          billed_by_name: user?.name || '',\r\n          payment_mode: updatedHeader.payment_mode || 'cash',\r\n        }));\r\n      }\r\n    },\r\n    [customerList, userList]\r\n  );\r\n\r\n  // Handle item changes - memoized to prevent unnecessary re-renders\r\n  const handleItemsChange = useCallback(\r\n    (items: any[]) => {\r\n      // Convert back to BillItem format and auto-populate stock\r\n      const billItems: BillItem[] = items.map(item => {\r\n        const billItem: BillItem = {\r\n          product_id: item.product_id || '',\r\n          product_name:\r\n            productOptions.find(\r\n              (opt: { label: string; value: string }) =>\r\n                opt.value === item.product_id\r\n            )?.label || '',\r\n          variant_name: item.variant_name || '',\r\n          stock_id: item.stock_id || '',\r\n          batch_no: item.batch_no || '', //  Preserve batch_no from input\r\n          qty: item.qty || 0,\r\n          loose_qty: item.loose_qty || 0,\r\n          price: item.price || 0,\r\n          mrp: item.mrp || 0,\r\n          amount: item.amount || 0,\r\n          tax_percentage: item.tax_percentage || 0,\r\n        };\r\n\r\n        // Stock validation for pack and loose quantities\r\n        if (item.stock_id && (item.qty || item.loose_qty)) {\r\n          const stockList = branchId ? branchStockList : stockAuditList;\r\n          const stock = stockList?.result?.find(\r\n            (s: any) => s._id === item.stock_id\r\n          );\r\n\r\n          if (stock) {\r\n            // Get pack size from stock data\r\n            const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n            const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n            // Available pack quantity and actual loose quantity\r\n            const availablePackQty = stock.available_quantity || 0;\r\n            const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n            // Validate pack quantity (QTY field)\r\n            if (item.qty && item.qty > availablePackQty) {\r\n              message.error(\r\n                `Pack quantity (${item.qty}) exceeds available packs (${availablePackQty})`\r\n              );\r\n              billItem.qty = availablePackQty;\r\n            }\r\n\r\n            // Calculate max loose quantity based on remaining packs after QTY selection\r\n            const remainingPacks = availablePackQty - (item.qty || 0);\r\n            const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n            const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n            // Validate loose quantity (LOOSE QTY field)\r\n            if (item.loose_qty && item.loose_qty > maxLooseQty) {\r\n              message.error(\r\n                `Loose quantity (${item.loose_qty}) exceeds available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`\r\n              );\r\n              billItem.loose_qty = maxLooseQty;\r\n            }\r\n          }\r\n        }\r\n\r\n        // Auto-populate stock if product is selected but stock is not\r\n        if (item.product_id && !item.stock_id) {\r\n          const stockList = branchId ? branchStockList : stockAuditList;\r\n          const availableStocks =\r\n            stockList?.result?.filter(\r\n              (stock: any) =>\r\n                stock.product === item.product_id ||\r\n                stock.ProductItem?._id === item.product_id\r\n            ) || [];\r\n\r\n          if (availableStocks.length > 0) {\r\n            const firstStock = availableStocks[0];\r\n            billItem.stock_id = firstStock._id;\r\n            billItem.batch_no = firstStock.batch_no || '';\r\n\r\n            // Auto-focus quantity field after auto-selecting stock\r\n            setTimeout(() => {\r\n              const qtyCell = document.querySelector(\r\n                `td[data-row-key=\"${item.key}\"][data-column-key=\"qty\"]`\r\n              ) as HTMLElement;\r\n              if (qtyCell) {\r\n                qtyCell.focus();\r\n              }\r\n            }, 300);\r\n          }\r\n        }\r\n\r\n        return billItem;\r\n      });\r\n      // Update items with calculated amounts\r\n      const updatedItems = billItems.map(item => {\r\n        if (!item.product_id || !item.stock_id) return item;\r\n\r\n        // Get stock info\r\n        const stockList = branchId ? branchStockList : stockAuditList;\r\n        const stock = stockList?.result?.find(\r\n          (s: any) => s._id === item.stock_id\r\n        );\r\n\r\n        if (stock) {\r\n          const sellPrice = stock.sell_price || 0;\r\n          // Get pack size from stock data\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n          // Calculate loose item rate: sell_price / pack_size (since sell_price is per pack)\r\n          const looseRate = sellPrice / packSizeNum;\r\n\r\n          const baseAmount =\r\n            (item.qty || 0) * sellPrice + (item.loose_qty || 0) * looseRate;\r\n\r\n          // Get product for tax calculation\r\n          const product = productList?.result?.find(\r\n            (p: any) => p._id === item.product_id\r\n          );\r\n          const taxPercentage = product?.CategoryItem?.tax_percentage || 0;\r\n\r\n          let amount = baseAmount;\r\n          if (!billSettings.isGstIncluded) {\r\n            amount = baseAmount + (baseAmount * taxPercentage) / 100;\r\n          }\r\n\r\n          return {\r\n            ...item,\r\n            price: item.price || sellPrice,\r\n            mrp: stock.mrp || sellPrice,\r\n            amount: amount,\r\n            tax_percentage: taxPercentage,\r\n            product_name: product?.name || '',\r\n            variant_name: product?.VariantItem?.variant_name || '',\r\n            batch_no: stock.batch_no || '',\r\n          };\r\n        }\r\n\r\n        return item;\r\n      });\r\n\r\n      setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n    },\r\n    [\r\n      productOptions,\r\n      branchId,\r\n      branchStockList,\r\n      stockAuditList,\r\n      productList,\r\n      billSettings,\r\n    ]\r\n  );\r\n\r\n  const handleProductSelect = useCallback(\r\n    (product: any, rowIndex: number) => {\r\n      // Validate rowIndex bounds\r\n      if (rowIndex < 0 || rowIndex >= billFormData.items.length) {\r\n        console.error(`Invalid rowIndex: ${rowIndex}. Items length: ${billFormData.items.length}`);\r\n        message.error(`Invalid row index: ${rowIndex}. Please try again.`);\r\n        return;\r\n      }\r\n\r\n      const newItems = [...billFormData.items];\r\n      \r\n      // Double-check the item exists before modifying\r\n      if (!newItems[rowIndex]) {\r\n        console.error(`Item at index ${rowIndex} is undefined. Items length: ${newItems.length}`);\r\n        message.error('Selected row is no longer valid. Please try again.');\r\n        return;\r\n      }\r\n\r\n      // Robustly set product_id from product.id or product._id\r\n      newItems[rowIndex].product_id = product.id || product._id || '';\r\n      newItems[rowIndex].product_name = product.name || '';\r\n      newItems[rowIndex].price = product.selling_price || 0;\r\n      handleItemsChange(newItems);\r\n      setStockModalRowIndex(rowIndex); // Open stock modal for this row\r\n    },\r\n    [handleItemsChange, billFormData.items.length]\r\n  );\r\n\r\n  const handleF5ProductSelection = () => {\r\n    // First, check if stock modal is open and close it\r\n    if (stockModalRowIndex !== null) {\r\n      setStockModalRowIndex(null);\r\n      message.info('Stock modal closed. Opening product selection...');\r\n\r\n      // Wait a bit for the stock modal to close before opening product modal\r\n      setTimeout(() => {\r\n        openProductModalForRow();\r\n      }, 100);\r\n      return;\r\n    }\r\n\r\n    // If stock modal is not open, proceed with normal F5 behavior\r\n    openProductModalForRow();\r\n  };\r\n\r\n  const openProductModalForRow = () => {\r\n    let targetRowIndex = -1;\r\n\r\n    // Check what element is currently focused\r\n    const activeElement = document.activeElement as HTMLElement;\r\n\r\n    // First, check if there's a currently focused row in the table\r\n    const focusedRow = activeElement?.closest('tr');\r\n\r\n    if (focusedRow) {\r\n      const rowIndex = focusedRow.getAttribute('data-row-key');\r\n\r\n      if (rowIndex !== null) {\r\n        targetRowIndex = parseInt(rowIndex);\r\n      }\r\n    } else {\r\n      // Try alternative method: look for any focused cell in the table\r\n      const focusedCell = activeElement?.closest('td');\r\n      if (focusedCell) {\r\n        const row = focusedCell.closest('tr');\r\n        if (row) {\r\n          const rowIndex = row.getAttribute('data-row-key');\r\n          if (rowIndex !== null) {\r\n            targetRowIndex = parseInt(rowIndex);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // If no focused row found, try using the externally editing cell row\r\n    if (targetRowIndex === -1 && externalEditingCell) {\r\n      targetRowIndex = externalEditingCell.row;\r\n    }\r\n\r\n    // If still no target, try using the last interacted row\r\n    if (targetRowIndex === -1) {\r\n      if (lastInteractedRowIndex < billFormData.items.length) {\r\n        targetRowIndex = lastInteractedRowIndex;\r\n      }\r\n    }\r\n\r\n    // If still no target, find the first row without a product\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(item => !item.product_id);\r\n    }\r\n\r\n    // If still no target row, add a new item and target that\r\n    if (targetRowIndex === -1) {\r\n      handleAddItem();\r\n      targetRowIndex = billFormData.items.length;\r\n    }\r\n\r\n    // Set the target row for product selection\r\n    setProductSelectionRowIndex(targetRowIndex);\r\n    setProductSelectionModalVisible(true);\r\n\r\n    message.info(`Opening product selection for row ${targetRowIndex + 1}`);\r\n  };\r\n\r\n  // Helper function to auto-open product modal (used after bill creation)\r\n  const autoOpenProductModal = useCallback(() => {\r\n    setProductSelectionRowIndex(0); // Target the first row\r\n    setProductSelectionModalVisible(true);\r\n    message.success(\r\n      ' Bill saved! Ready for next bill - Select product to continue.',\r\n      4\r\n    );\r\n  }, []);\r\n\r\n  const handleF7StockSelection = () => {\r\n    // Find the first row that has a product but needs stock or the currently focused row\r\n    let targetRowIndex = -1;\r\n\r\n    // First, check if there's a currently focused row in the table\r\n    const activeElement = document.activeElement as HTMLElement;\r\n    const focusedRow = activeElement?.closest('tr');\r\n    if (focusedRow) {\r\n      const rowIndex = focusedRow.getAttribute('data-row-key');\r\n      if (rowIndex !== null) {\r\n        const rowIndexNum = parseInt(rowIndex);\r\n        // Check if the focused row has a product\r\n        if (billFormData.items[rowIndexNum]?.product_id) {\r\n          targetRowIndex = rowIndexNum;\r\n        }\r\n      }\r\n    }\r\n\r\n    // If no focused row with product found, find the first row with product but without stock\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(\r\n        item => item.product_id && !item.stock_id\r\n      );\r\n    }\r\n\r\n    // If still no target row, find the first row with product (even if it has stock)\r\n    if (targetRowIndex === -1) {\r\n      targetRowIndex = billFormData.items.findIndex(item => item.product_id);\r\n    }\r\n\r\n    // If no row with product found, show message\r\n    if (targetRowIndex === -1) {\r\n      message.warning('Please select a product first before selecting stock');\r\n      return;\r\n    }\r\n\r\n    // Set the target row for stock selection\r\n    setStockModalRowIndex(targetRowIndex);\r\n\r\n    message.info(`Opening stock selection for row ${targetRowIndex + 1}`);\r\n  };\r\n\r\n  const handleProductSelectionModalSelect = (product: any) => {\r\n    if (productSelectionRowIndex === null) return;\r\n\r\n    // Validate productSelectionRowIndex bounds\r\n    if (productSelectionRowIndex < 0 || productSelectionRowIndex >= billFormData.items.length) {\r\n      console.error(`Invalid productSelectionRowIndex: ${productSelectionRowIndex}. Items length: ${billFormData.items.length}`);\r\n      message.error(`Invalid row index: ${productSelectionRowIndex}. Please try again.`);\r\n      setProductSelectionRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    const newItems = [...billFormData.items];\r\n    \r\n    // Double-check the item exists before modifying\r\n    if (!newItems[productSelectionRowIndex]) {\r\n      console.error(`Item at index ${productSelectionRowIndex} is undefined. Items length: ${newItems.length}`);\r\n      message.error('Selected row is no longer valid. Please try again.');\r\n      setProductSelectionRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    newItems[productSelectionRowIndex].product_id = product._id || '';\r\n    newItems[productSelectionRowIndex].product_name = product.name || '';\r\n    newItems[productSelectionRowIndex].variant_name =\r\n      product.VariantItem?.variant_name || '';\r\n    newItems[productSelectionRowIndex].price = product.selling_price || 0;\r\n\r\n    handleItemsChange(newItems);\r\n\r\n    // Close the product selection modal\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n\r\n    // Open stock selection modal for this row\r\n    setStockModalRowIndex(productSelectionRowIndex);\r\n\r\n    message.success(`Product \"${product.name}\" selected successfully!`);\r\n  };\r\n\r\n  const handleStockSelect = (stock: any) => {\r\n    if (stockModalRowIndex === null) return;\r\n    \r\n    // Validate stockModalRowIndex bounds\r\n    if (stockModalRowIndex < 0 || stockModalRowIndex >= billFormData.items.length) {\r\n      console.error(`Invalid stockModalRowIndex: ${stockModalRowIndex}. Items length: ${billFormData.items.length}`);\r\n      message.error(`Invalid row index: ${stockModalRowIndex}. Please try again.`);\r\n      setStockModalRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    const newItems = [...billFormData.items];\r\n    \r\n    // Double-check the item exists before modifying\r\n    if (!newItems[stockModalRowIndex]) {\r\n      console.error(`Item at index ${stockModalRowIndex} is undefined. Items length: ${newItems.length}`);\r\n      message.error('Selected row is no longer valid. Please try again.');\r\n      setStockModalRowIndex(null);\r\n      return;\r\n    }\r\n\r\n    newItems[stockModalRowIndex].stock_id =\r\n      stock.id || stock._id || stock.invoice_id || '';\r\n    newItems[stockModalRowIndex].batch_no = stock.batch_no || '';\r\n    handleItemsChange(newItems);\r\n    setStockModalRowIndex(null); // Close stock modal\r\n\r\n    // Set external editing cell to qty cell in the same row\r\n    if (qtyColIndex !== -1) {\r\n      setExternalEditingCell({ row: stockModalRowIndex, col: qtyColIndex });\r\n    }\r\n  };\r\n\r\n  // Handle customer selection from modal\r\n  const handleCustomerSelect = useCallback(\r\n    (customer: any) => {\r\n      // Prevent duplicate calls\r\n      if (billFormData.customer_id === customer._id) {\r\n        return;\r\n      }\r\n\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        customer_id: customer._id,\r\n        customer_name: customer.full_name,\r\n      }));\r\n\r\n      // Ensure modal closes\r\n      setTimeout(() => {\r\n        setCustomerModalVisible(false);\r\n        // Auto-open user selection modal after customer is selected\r\n        setTimeout(() => {\r\n          setUserModalVisible(true);\r\n        }, 100);\r\n      }, 50);\r\n\r\n      message.success(\r\n        `Customer \"${customer.full_name}\" selected successfully!`\r\n      );\r\n    },\r\n    [billFormData.customer_id]\r\n  );\r\n\r\n  // Handle user selection from modal\r\n  const handleUserSelect = useCallback(\r\n    (user: any) => {\r\n      // Prevent duplicate calls\r\n      if (billFormData.billed_by_id === user._id) {\r\n        return;\r\n      }\r\n\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        billed_by_id: user._id,\r\n        billed_by_name: user.name,\r\n      }));\r\n\r\n      // Ensure modal closes\r\n      setTimeout(() => {\r\n        setUserModalVisible(false);\r\n      }, 50);\r\n\r\n      message.success(\r\n        `User \"${user.name}\" selected as billed by successfully!`\r\n      );\r\n    },\r\n    [billFormData.billed_by_id]\r\n  );\r\n\r\n  // Handle new bill creation\r\n  const handleNewBill = () => {\r\n    resetBill(false); // Don't show resetBill message\r\n    setSaveConfirmationVisible(false);\r\n    setSavedBillData(null);\r\n    message.success('New bill form cleared successfully!');\r\n  };\r\n\r\n  // Reset bill function - comprehensive reset for after successful save\r\n  const resetBill = useCallback((showMessage = true) => {\r\n    // Clear all form data for new bill\r\n    setBillFormData({\r\n      invoice_no: '',\r\n      date: dayjs().format('YYYY-MM-DD'),\r\n      customer_id: '',\r\n      customer_name: '',\r\n      payment_mode: 'cash',\r\n      items: [\r\n        {\r\n          product_id: '',\r\n          product_name: '',\r\n          variant_name: '',\r\n          stock_id: '',\r\n          batch_no: '',\r\n          qty: 0,\r\n          loose_qty: 0,\r\n          price: 0,\r\n          mrp: 0,\r\n          amount: 0,\r\n          tax_percentage: 0,\r\n        },\r\n      ],\r\n    });\r\n\r\n    // Reset bill settings to defaults\r\n    setBillSettings({\r\n      isPaid: true,\r\n      isPartiallyPaid: false,\r\n      isRetail: true,\r\n      isGstIncluded: true,\r\n      discount: 0,\r\n      discountType: 'percentage',\r\n      paidAmount: 0,\r\n    });\r\n\r\n    // Reset all modal states\r\n    setStockModalRowIndex(null);\r\n    setExternalEditingCell(null);\r\n    setCustomerModalVisible(false);\r\n    setSaveConfirmationVisible(false);\r\n    setBillListDrawerVisible(false);\r\n    setSavedBillData(null);\r\n    setProductDetailsModalVisible(false);\r\n    setSelectedProductId('');\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n    InvoiceNumberApi('GetAll');\r\n    // Only show message if explicitly requested (not during auto-reset after bill creation)\r\n    if (showMessage) {\r\n      message.success('Ready for next bill!', 2);\r\n    }\r\n  }, []);\r\n\r\n  // Handle continue with current bill\r\n  const handleContinueBill = () => {\r\n    setSaveConfirmationVisible(false);\r\n    setSavedBillData(null);\r\n  };\r\n\r\n  // Handle clear bill form\r\n  const handleClearBill = () => {\r\n    resetBill(false); // Don't show resetBill message\r\n    message.success('Bill form cleared successfully!');\r\n  };\r\n\r\n  // Handle view bill from drawer\r\n  const handleViewBill = (bill: any) => {\r\n    if (!bill) {\r\n      message.error('No bill data received');\r\n      return;\r\n    }\r\n\r\n    // Ensure we have the latest data loaded\r\n    ProductsApi('GetAll');\r\n    CustomerApi('GetAll');\r\n    if (branchId) {\r\n      BranchStock('GetAll');\r\n    } else {\r\n      StockAuditApi('GetAll');\r\n    }\r\n\r\n    // Force immediate data loading if not already loaded\r\n    if (!productList?.result) {\r\n      ProductsApi('GetAll');\r\n    }\r\n\r\n    if (!customerList?.result) {\r\n      CustomerApi('GetAll');\r\n    }\r\n\r\n    const currentStockList = branchId ? branchStockList : stockAuditList;\r\n    if (!currentStockList?.result) {\r\n      if (branchId) {\r\n        BranchStock('GetAll');\r\n      } else {\r\n        StockAuditApi('GetAll');\r\n      }\r\n    }\r\n\r\n    // Handle different possible data structures for items\r\n    let items = [];\r\n    if (bill.Items && Array.isArray(bill.Items)) {\r\n      items = bill.Items;\r\n    } else if (bill.items && Array.isArray(bill.items)) {\r\n      items = bill.items;\r\n    } else if (bill.sales_items && Array.isArray(bill.sales_items)) {\r\n      items = bill.sales_items;\r\n    } else if (\r\n      bill.result &&\r\n      bill.result.Items &&\r\n      Array.isArray(bill.result.Items)\r\n    ) {\r\n      items = bill.result.Items;\r\n    } else if (\r\n      bill.result &&\r\n      bill.result.items &&\r\n      Array.isArray(bill.result.items)\r\n    ) {\r\n      items = bill.result.items;\r\n    }\r\n\r\n    // Map items with proper fallbacks and enhanced product name resolution\r\n    const mappedItems = items.map((item: any, index: number) => {\r\n      // Try to get the best product name from various sources\r\n      let productName = '';\r\n      let variantName = '';\r\n\r\n      if (item.productItems?.name) {\r\n        productName = item.productItems.name;\r\n        variantName = item.productItems.VariantItem?.variant_name || '';\r\n      } else if (item.product_name) {\r\n        productName = item.product_name;\r\n        variantName = item.variant_name || '';\r\n      } else if (item.product?.name) {\r\n        productName = item.product.name;\r\n        variantName = item.product.VariantItem?.variant_name || '';\r\n      } else if (item.product_id) {\r\n        // Try to find product name from productList if available\r\n        const product = productList?.result?.find(\r\n          (p: any) => p._id === item.product_id\r\n        );\r\n        if (product) {\r\n          productName = product.name;\r\n          variantName = product.VariantItem?.variant_name || '';\r\n        } else {\r\n          // If product list is not loaded yet, try to load it and mark for later update\r\n          if (!productList?.result) {\r\n            ProductsApi('GetAll');\r\n          }\r\n          // Use a more descriptive placeholder that will be updated later\r\n          productName = `Loading... (ID: ${item.product_id})`;\r\n\r\n          // Try to force load and resolve immediately\r\n          setTimeout(() => {\r\n            if (productList?.result) {\r\n              const foundProduct = productList.result.find(\r\n                (p: any) => p._id === item.product_id\r\n              );\r\n              if (foundProduct) {\r\n                // Update the item directly\r\n                const updatedItems = [...billFormData.items];\r\n                const itemIndex = updatedItems.findIndex(\r\n                  i => i.product_id === item.product_id\r\n                );\r\n                if (itemIndex !== -1) {\r\n                  updatedItems[itemIndex].product_name = foundProduct.name;\r\n                  updatedItems[itemIndex].variant_name =\r\n                    foundProduct.VariantItem?.variant_name || '';\r\n                  setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n                }\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n      }\r\n\r\n      // Handle stock information with proper fallbacks\r\n      let stockId = '';\r\n      let batchNo = '';\r\n\r\n      if (item.stock_id) {\r\n        stockId = item.stock_id;\r\n        batchNo = item.batch_no || '';\r\n      } else if (item.branch_stock_id) {\r\n        stockId = item.branch_stock_id;\r\n        batchNo = item.batch_no || '';\r\n      } else if (item.stock) {\r\n        stockId = item.stock;\r\n        batchNo = item.batch_no || '';\r\n      }\r\n\r\n      // If we have stock_id but no batch_no, try to find it from stock list\r\n      if (stockId && !batchNo) {\r\n        const stockList = branchId ? branchStockList : stockAuditList;\r\n        const stock = stockList?.result?.find((s: any) => s._id === stockId);\r\n        if (stock) {\r\n          batchNo = stock.batch_no || '';\r\n        } else {\r\n          // If stock list is not loaded yet, mark for later update\r\n          if (!stockList?.result) {\r\n            if (branchId) {\r\n              BranchStock('GetAll');\r\n            } else {\r\n              StockAuditApi('GetAll');\r\n            }\r\n          }\r\n          batchNo = `Loading... (Stock: ${stockId})`;\r\n\r\n          // Try to force load and resolve immediately\r\n          setTimeout(() => {\r\n            const currentStockList = branchId\r\n              ? branchStockList\r\n              : stockAuditList;\r\n            if (currentStockList?.result) {\r\n              const foundStock = currentStockList.result.find(\r\n                (s: any) => s._id === stockId\r\n              );\r\n              if (foundStock) {\r\n                // Update the item directly\r\n                const updatedItems = [...billFormData.items];\r\n                const itemIndex = updatedItems.findIndex(\r\n                  i => i.stock_id === stockId\r\n                );\r\n                if (itemIndex !== -1) {\r\n                  updatedItems[itemIndex].batch_no = foundStock.batch_no || '';\r\n                  setBillFormData(prev => ({ ...prev, items: updatedItems }));\r\n                }\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n      }\r\n\r\n      const mappedItem = {\r\n        _id: item._id || '',\r\n        product_id: item.product_id || item.product || '',\r\n        product_name: productName,\r\n        variant_name: variantName,\r\n        stock_id: stockId,\r\n        batch_no: batchNo,\r\n        qty: item.qty || 0,\r\n        loose_qty: item.loose_qty || 0,\r\n        price: item.price || 0,\r\n        mrp: item.mrp || item.price || 0,\r\n        amount: item.amount || 0,\r\n        tax_percentage: item.tax_percentage || 0,\r\n      };\r\n\r\n      return mappedItem;\r\n    });\r\n\r\n    // Handle customer information with fallbacks\r\n    const customerId = bill.customer_id || '';\r\n    let customerName = '';\r\n\r\n    if (bill.customerDetails?.full_name) {\r\n      customerName = bill.customerDetails.full_name;\r\n    } else if (bill.customer_name) {\r\n      customerName = bill.customer_name;\r\n    } else if (bill.customer?.full_name) {\r\n      customerName = bill.customer.full_name;\r\n    } else if (bill.customer_id) {\r\n      // Try to find customer name from customerList if available\r\n      const customer = customerList?.result?.find(\r\n        (c: any) => c._id === bill.customer_id\r\n      );\r\n      customerName = customer?.full_name || `Customer ID: ${bill.customer_id}`;\r\n    }\r\n\r\n    // Handle date with fallback\r\n    let formattedDate = dayjs().format('YYYY-MM-DD'); // Default to today\r\n    if (bill.date) {\r\n      try {\r\n        formattedDate = dayjs(bill.date).format('YYYY-MM-DD');\r\n      } catch (error) {\r\n        formattedDate = dayjs().format('YYYY-MM-DD');\r\n      }\r\n    }\r\n\r\n    // Immediately resolve any available product names and stock info if data is already loaded\r\n    let finalMappedItems = [...mappedItems];\r\n\r\n    // If product list is already loaded, resolve product names immediately\r\n    if (productList?.result) {\r\n      finalMappedItems = finalMappedItems.map(item => {\r\n        if (\r\n          item.product_id &&\r\n          (item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:'))\r\n        ) {\r\n          const product = productList.result.find(\r\n            (p: any) => p._id === item.product_id\r\n          );\r\n          if (product) {\r\n            return {\r\n              ...item,\r\n              product_name: product.name,\r\n              variant_name: product.VariantItem?.variant_name || '',\r\n            };\r\n          }\r\n        }\r\n        return item;\r\n      });\r\n    }\r\n\r\n    // If stock list is already loaded, resolve batch numbers immediately\r\n    const stockList = branchId ? branchStockList : stockAuditList;\r\n    if (stockList?.result) {\r\n      finalMappedItems = finalMappedItems.map(item => {\r\n        if (\r\n          item.stock_id &&\r\n          (item.batch_no.includes('Loading...') || !item.batch_no)\r\n        ) {\r\n          const stock = stockList.result.find(\r\n            (s: any) => s._id === item.stock_id\r\n          );\r\n          if (stock) {\r\n            return {\r\n              ...item,\r\n              batch_no: stock.batch_no || '',\r\n            };\r\n          }\r\n        }\r\n        return item;\r\n      });\r\n    }\r\n\r\n    // Load bill data into form with resolved items\r\n    setBillFormData({\r\n      invoice_no: bill.invoice_no || '',\r\n      date: formattedDate,\r\n      customer_id: customerId,\r\n      customer_name: customerName,\r\n      payment_mode: bill.payment_mode || 'cash',\r\n      items: finalMappedItems,\r\n    });\r\n\r\n    // Load bill settings with proper fallbacks\r\n    setBillSettings({\r\n      isPaid: bill.is_paid ?? true,\r\n      isPartiallyPaid: bill.is_partially_paid ?? false,\r\n      isRetail: bill.sale_type === 'retail' || bill.sale_type === undefined,\r\n      isGstIncluded: bill.is_gst_included ?? true,\r\n      discount: bill.discount || 0,\r\n      discountType: bill.discount_type || 'percentage',\r\n      paidAmount: bill.paid_amount || 0,\r\n    });\r\n\r\n    // Show success message\r\n    message.success(`Bill \"${bill.invoice_no}\" loaded successfully!`);\r\n\r\n    // Force immediate resolution after a short delay to catch any data that loads asynchronously\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 100);\r\n\r\n    // Add a more aggressive resolution approach\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 500);\r\n\r\n    setTimeout(() => {\r\n      forceResolveProductNamesAndStock();\r\n    }, 1000);\r\n  };\r\n\r\n  // Force resolve product names and stock information\r\n  const forceResolveProductNamesAndStock = () => {\r\n    if (billFormData.items.length === 0) return;\r\n\r\n    let hasChanges = false;\r\n    const updatedItems = billFormData.items.map(item => {\r\n      let updated = false;\r\n\r\n      // Resolve product names\r\n      if (item.product_id && productList?.result) {\r\n        const product = productList.result.find(\r\n          (p: any) => p._id === item.product_id\r\n        );\r\n        if (\r\n          product &&\r\n          (item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:') ||\r\n            !item.product_name)\r\n        ) {\r\n          item.product_name = product.name;\r\n          item.variant_name = product.VariantItem?.variant_name || '';\r\n          updated = true;\r\n        }\r\n      }\r\n\r\n      // Resolve stock batch numbers\r\n      if (item.stock_id) {\r\n        const stockList = branchId ? branchStockList : stockAuditList;\r\n        if (stockList?.result) {\r\n          const stock = stockList.result.find(\r\n            (s: any) => s._id === item.stock_id\r\n          );\r\n          if (\r\n            stock &&\r\n            (item.batch_no?.includes('Loading...') || !item.batch_no)\r\n          ) {\r\n            item.batch_no = stock.batch_no || '';\r\n            updated = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (updated) hasChanges = true;\r\n      return item;\r\n    });\r\n\r\n    if (hasChanges) {\r\n      setBillFormData(prev => ({\r\n        ...prev,\r\n        items: updatedItems,\r\n      }));\r\n    }\r\n  };\r\n\r\n  // Handle item addition\r\n  const handleAddItem = () => {\r\n    const newItem: BillItem = {\r\n      product_id: '',\r\n      product_name: '',\r\n      variant_name: '',\r\n      stock_id: '',\r\n      batch_no: '',\r\n      qty: 0,\r\n      loose_qty: 0,\r\n      price: 0,\r\n      mrp: 0,\r\n      amount: 0,\r\n      tax_percentage: 0,\r\n    };\r\n\r\n    setBillFormData(prev => ({\r\n      ...prev,\r\n      items: [...prev.items, newItem],\r\n    }));\r\n  };\r\n\r\n  // Handle item deletion\r\n  const handleDeleteItems = (indices: number[]) => {\r\n    setBillFormData(prev => {\r\n      const newItems = prev.items.filter(\r\n        (_, index: any) => !indices.includes(index?.toString())\r\n      );\r\n      return {\r\n        ...prev,\r\n        items: newItems,\r\n      };\r\n    });\r\n  };\r\n\r\n  // Handle final save\r\n  const handleSaveBill = async () => {\r\n    // Validation\r\n    if (\r\n      !billFormData.invoice_no ||\r\n      !billFormData.customer_id ||\r\n      !billFormData.items.length\r\n    ) {\r\n      message.error('Please fill all required fields');\r\n      return;\r\n    }\r\n\r\n    // Check for incomplete items\r\n    const incompleteItems = billFormData.items.some(\r\n      item =>\r\n        !item.product_id ||\r\n        !item.stock_id ||\r\n        (!item.qty && !item.loose_qty) ||\r\n        !item.price\r\n    );\r\n\r\n    if (incompleteItems) {\r\n      message.error('Please complete all item details');\r\n      return;\r\n    }\r\n\r\n    // Validate that entered quantities don't exceed available stock\r\n    const stockValidationErrors: string[] = [];\r\n    billFormData.items.forEach((item, index) => {\r\n      if (item.stock_id && (item.qty || item.loose_qty)) {\r\n        const validation = validateStockQuantity(\r\n          item.stock_id,\r\n          item.qty || 0,\r\n          item.loose_qty || 0\r\n        );\r\n\r\n        if (!validation.isValid) {\r\n          stockValidationErrors.push(`Row ${index + 1}: ${validation.message}`);\r\n        }\r\n      }\r\n    });\r\n\r\n    if (stockValidationErrors.length > 0) {\r\n      message.error(\r\n        `Stock validation errors:\\n${stockValidationErrors.join('\\n')}`\r\n      );\r\n      return;\r\n    }\r\n    if (!billFormData.customer_id) {\r\n      message.error('Please select a customer');\r\n      return;\r\n    }\r\n    if (!billFormData.payment_mode) {\r\n      message.error('Please select a payment mode');\r\n      return;\r\n    }\r\n\r\n    const payload = {\r\n      invoice_no: billFormData.invoice_no,\r\n      date: billFormData.date,\r\n      customer_id: billFormData.customer_id,\r\n      billed_by_id: billFormData.billed_by_id,\r\n      payment_mode: billFormData.payment_mode,\r\n      items: billFormData.items.map(item => ({\r\n        product_id: item.product_id,\r\n        stock_id: item.stock_id,\r\n        ...(branchId && { branch_stock_id: item.stock_id }),\r\n        qty: item.qty,\r\n        loose_qty: item.loose_qty,\r\n        price: item.price,\r\n        mrp: item.mrp,\r\n        amount: item.amount,\r\n        tax_percentage: item.tax_percentage,\r\n        _id: item._id,\r\n      })),\r\n      ...billCalculations,\r\n      discount: billSettings.discount,\r\n      discount_type: billSettings.discountType,\r\n      is_paid: billSettings.isPaid,\r\n      is_partially_paid: billSettings.isPartiallyPaid,\r\n      sale_type: billSettings.isRetail ? 'retail' : 'wholesale',\r\n      is_gst_included: billSettings.isGstIncluded,\r\n      paid_amount: billSettings.isPartiallyPaid\r\n        ? billSettings.paidAmount\r\n        : billSettings.isPaid\r\n          ? billCalculations.total_amount\r\n          : 0,\r\n    };\r\n\r\n    try {\r\n      let response: any;\r\n      if (billdata) {\r\n        response = await SalesRecord('Update', payload, billdata._id);\r\n      } else {\r\n        response = await SalesRecord('Create', payload);\r\n      }\r\n\r\n      // Show confirmation modal after successful save (only for updates, not new bills)\r\n      if (response?.statusCode === 200) {\r\n        const savedData = {\r\n          ...payload,\r\n          customer_name: billFormData.customer_name,\r\n          total_amount: billCalculations.total_amount,\r\n          invoice_no: payload.invoice_no,\r\n          date: payload.date,\r\n        };\r\n        setSavedBillData(savedData);\r\n\r\n        // Only show confirmation modal for bill updates, not new bills (they auto-reset)\r\n        if (billdata) {\r\n          setSaveConfirmationVisible(true);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      // Handle error silently or show user-friendly message\r\n      message.error('Failed to save bill. Please try again.');\r\n    }\r\n  };\r\n\r\n  // Handle API responses\r\n  const { items: createItems, error: createError } = useDynamicSelector(\r\n    SalesRecord.getIdentifier('Create')\r\n  );\r\n  const { items: updateItems } = useDynamicSelector(\r\n    SalesRecord.getIdentifier('Update')\r\n  );\r\n\r\n  // Note: Removed useHandleApiResponse for 'create' to avoid duplicate success messages\r\n  // Bill creation success is handled manually in useEffect below\r\n\r\n  useHandleApiResponse({\r\n    action: 'update',\r\n    title: 'Bill',\r\n    identifier: SalesRecord.getIdentifier('Update'),\r\n    entityApi: SalesRecord,\r\n  });\r\n\r\n  // Handle create success\r\n  useEffect(() => {\r\n    if (createItems?.statusCode === 200) {\r\n      onSuccess?.();\r\n      InvoiceNumberApi('Create');\r\n      // Auto-reset the bill after successful creation (only for new bills, not updates)\r\n      if (!billdata) {\r\n        // Close confirmation modal first, then reset immediately\r\n        setSaveConfirmationVisible(false);\r\n        setTimeout(() => {\r\n          resetBill(false); // Don't show \"Ready for next bill!\" message\r\n\r\n          // Auto-open product selection modal for the first row after reset\r\n          setTimeout(() => {\r\n            autoOpenProductModal();\r\n          }, 200); // Wait for reset to complete\r\n        }, 100); // Minimal delay just to close modal smoothly\r\n      }\r\n    }\r\n  }, [createItems, billdata, resetBill, onSuccess, autoOpenProductModal]);\r\n\r\n  // Handle create errors\r\n  useEffect(() => {\r\n    if (createError) {\r\n      message.error(createError?.message);\r\n    }\r\n  }, [createError]);\r\n\r\n  // Handle update success\r\n  useEffect(() => {\r\n    if (updateItems?.statusCode === 200) {\r\n      onSuccess?.();\r\n    }\r\n  }, [updateItems]);\r\n\r\n  // Update product names when product list is loaded (for bill viewing)\r\n  useEffect(() => {\r\n    if (productList?.result && billFormData.items.length > 0) {\r\n      // Check if any items have product_id but no product_name or have placeholder text\r\n      const needsUpdate = billFormData.items.some(\r\n        item =>\r\n          item.product_id &&\r\n          (!item.product_name ||\r\n            item.product_name.includes('Loading...') ||\r\n            item.product_name.includes('Product ID:'))\r\n      );\r\n\r\n      if (needsUpdate) {\r\n        const updatedItems = billFormData.items.map(item => {\r\n          if (\r\n            item.product_id &&\r\n            (!item.product_name ||\r\n              item.product_name.includes('Loading...') ||\r\n              item.product_name.includes('Product ID:'))\r\n          ) {\r\n            const product = productList.result.find(\r\n              (p: any) => p._id === item.product_id\r\n            );\r\n            if (product) {\r\n              return {\r\n                ...item,\r\n                product_name: product.name,\r\n                variant_name: product.VariantItem?.variant_name || '',\r\n              };\r\n            }\r\n          }\r\n          return item;\r\n        });\r\n\r\n        // Only update if we actually made changes\r\n        const hasChanges = updatedItems.some(\r\n          (item, index) =>\r\n            item.product_name !== billFormData.items[index].product_name\r\n        );\r\n\r\n        if (hasChanges) {\r\n          setBillFormData(prev => ({\r\n            ...prev,\r\n            items: updatedItems,\r\n          }));\r\n        }\r\n      }\r\n    }\r\n  }, [productList, billFormData.items]);\r\n\r\n  // Force resolve product names when product list changes\r\n  useEffect(() => {\r\n    if (productList?.result && billFormData.items.length > 0) {\r\n      // Force resolve any remaining unresolved product names\r\n      setTimeout(() => {\r\n        forceResolveProductNamesAndStock();\r\n      }, 200);\r\n    }\r\n  }, [productList]);\r\n\r\n  // Update stock information when stock list is loaded (for bill viewing)\r\n  useEffect(() => {\r\n    const stockList = branchId ? branchStockList : stockAuditList;\r\n    if (stockList?.result && billFormData.items.length > 0) {\r\n      // Check if any items have stock_id but no batch_no or have placeholder text\r\n      const needsUpdate = billFormData.items.some(\r\n        item =>\r\n          item.stock_id &&\r\n          (!item.batch_no || item.batch_no.includes('Loading...'))\r\n      );\r\n\r\n      if (needsUpdate) {\r\n        const updatedItems = billFormData.items.map(item => {\r\n          if (\r\n            item.stock_id &&\r\n            (!item.batch_no || item.batch_no.includes('Loading...'))\r\n          ) {\r\n            const stock = stockList.result.find(\r\n              (s: any) => s._id === item.stock_id\r\n            );\r\n            if (stock) {\r\n              return {\r\n                ...item,\r\n                batch_no: stock.batch_no || '',\r\n              };\r\n            }\r\n          }\r\n          return item;\r\n        });\r\n\r\n        // Only update if we actually made changes\r\n        const hasChanges = updatedItems.some(\r\n          (item, index) => item.batch_no !== billFormData.items[index].batch_no\r\n        );\r\n\r\n        if (hasChanges) {\r\n          setBillFormData(prev => ({\r\n            ...prev,\r\n            items: updatedItems,\r\n          }));\r\n        }\r\n      }\r\n    }\r\n  }, [branchStockList, stockAuditList, billFormData.items, branchId]);\r\n\r\n  // Force resolve stock information when stock list changes\r\n  useEffect(() => {\r\n    const stockList = branchId ? branchStockList : stockAuditList;\r\n    if (stockList?.result && billFormData.items.length > 0) {\r\n      // Force resolve any remaining unresolved stock information\r\n      setTimeout(() => {\r\n        forceResolveProductNamesAndStock();\r\n      }, 200);\r\n    }\r\n  }, [branchStockList, stockAuditList, branchId]);\r\n\r\n  // Periodic check to resolve any remaining unresolved data\r\n  useEffect(() => {\r\n    if (billFormData.items.length > 0) {\r\n      const interval = setInterval(() => {\r\n        const hasUnresolvedItems = billFormData.items.some(\r\n          item =>\r\n            (item.product_id &&\r\n              (!item.product_name ||\r\n                item.product_name.includes('Loading...') ||\r\n                item.product_name.includes('Product ID:'))) ||\r\n            (item.stock_id &&\r\n              (!item.batch_no || item.batch_no.includes('Loading...')))\r\n        );\r\n\r\n        if (\r\n          hasUnresolvedItems &&\r\n          (productList?.result ||\r\n            (branchId ? branchStockList?.result : stockAuditList?.result))\r\n        ) {\r\n          forceResolveProductNamesAndStock();\r\n        }\r\n      }, 1000); // Check every second\r\n\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [\r\n    billFormData.items,\r\n    productList,\r\n    branchStockList,\r\n    stockAuditList,\r\n    branchId,\r\n  ]);\r\n\r\n  // Ultra-Fast Billing Keyboard Shortcuts\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // F1: Add item and focus first product field\r\n      if (e.key === 'F1') {\r\n        e.preventDefault();\r\n        handleAddItem();\r\n        setTimeout(() => {\r\n          const productCell = document.querySelector(\r\n            '.ant-table-tbody tr:last-child td[data-column-key=\"product_id\"]'\r\n          ) as HTMLElement;\r\n          productCell?.focus();\r\n        }, 200);\r\n      }\r\n      // F2: Save bill\r\n      else if (e.key === 'F2') {\r\n        e.preventDefault();\r\n        handleSaveBill();\r\n      }\r\n      // F3: Print bill\r\n      else if (e.key === 'F3') {\r\n        e.preventDefault();\r\n        // TODO: Implement print functionality\r\n        message.info('Print functionality coming soon!');\r\n      }\r\n      // F4: Clear bill form\r\n      else if (e.key === 'F4') {\r\n        e.preventDefault();\r\n        handleClearBill();\r\n      }\r\n      // F5: Open product selection modal for current row or first empty row\r\n      else if (e.key === 'F5') {\r\n        e.preventDefault();\r\n        handleF5ProductSelection();\r\n      }\r\n      // End: Open customer selection modal\r\n      else if (e.key === 'End') {\r\n        e.preventDefault();\r\n        setCustomerModalVisible(true);\r\n      }\r\n      // F6: Open bill list drawer\r\n      else if (e.key === 'F6') {\r\n        e.preventDefault();\r\n        setBillListDrawerVisible(true);\r\n      }\r\n      // F7: Open stock selection modal for current row or first row with product\r\n      else if (e.key === 'F7') {\r\n        e.preventDefault();\r\n        handleF7StockSelection();\r\n      }\r\n\r\n      // Ctrl shortcuts\r\n      else if (e.ctrlKey) {\r\n        switch (e.key) {\r\n          case 's':\r\n            e.preventDefault();\r\n            handleSaveBill();\r\n            break;\r\n          case 'n':\r\n            e.preventDefault();\r\n            handleAddItem();\r\n            setTimeout(() => {\r\n              const productCell = document.querySelector(\r\n                '.ant-table-tbody tr:last-child td[data-column-key=\"product_id\"]'\r\n              ) as HTMLElement;\r\n              productCell?.focus();\r\n            }, 200);\r\n            break;\r\n          case 'p':\r\n            e.preventDefault();\r\n            // TODO: Implement print functionality\r\n            message.info('Print functionality coming soon!');\r\n            break;\r\n          case 'r':\r\n            e.preventDefault();\r\n            // Reset form completely\r\n            resetBill(); // Show message for manual reset via keyboard\r\n            break;\r\n          case 'u':\r\n            e.preventDefault();\r\n            setUserModalVisible(true);\r\n            break;\r\n        }\r\n      }\r\n      // Quick quantity entry (Ctrl + 0-9)\r\n      else if (e.ctrlKey && /^[0-9]$/.test(e.key)) {\r\n        e.preventDefault();\r\n        const activeElement = document.activeElement as HTMLElement;\r\n        if (activeElement?.closest('td[data-column-key=\"qty\"]')) {\r\n          const input = activeElement.querySelector(\r\n            'input'\r\n          ) as HTMLInputElement;\r\n          if (input) {\r\n            input.value = e.key;\r\n            input.dispatchEvent(new Event('change', { bubbles: true }));\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, [\r\n    billFormData,\r\n    billSettings,\r\n    handleF5ProductSelection,\r\n    handleF7StockSelection,\r\n    stockModalRowIndex,\r\n  ]);\r\n\r\n  return (\r\n    <div className={styles.mainContainer}>\r\n      {/* Background Half Circles */}\r\n      <div className={styles.backgroundCircle1} />\r\n      <div className={styles.backgroundCircle2} />\r\n      <div className={styles.backgroundCircle3} />\r\n      <div className={styles.backgroundCircle4} />\r\n      <div className={styles.backgroundCircle5} />\r\n      {/* Ultra-Fast Billing Header */}\r\n      <div className={styles.headerContainer}>\r\n        {/* Animated decorative background elements */}\r\n        <div className={styles.headerCircle1} />\r\n        <div className={styles.headerCircle2} />\r\n        <div className={styles.headerCircle3} />\r\n        <div className={styles.headerCircle4} />\r\n        <div className={styles.headerCircle5} />\r\n\r\n        <div className={styles.headerContent}>\r\n          {/* Title Section */}\r\n          <div className={styles.titleSection}>\r\n            <div className={styles.titleIcon}>\r\n              <FileTextOutlined style={{ fontSize: '24px', color: 'white' }} />\r\n            </div>\r\n            <div>\r\n              <Title level={4} className={styles.titleText}>\r\n                {billdata ? ' EDIT INVOICE' : ' NEW INVOICE'}\r\n              </Title>\r\n              <Text className={styles.subtitleText}>\r\n                Lightning Fast  {dayjs().format('DD MMM YYYY, dddd')}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Controls Section */}\r\n          <div className={styles.controlsSection}>\r\n            <div className={`${styles.controlGroup} ${styles.saleTypeControl}`}>\r\n              <Text className={styles.controlLabel}> SALE TYPE</Text>\r\n              <Switch\r\n                checkedChildren=\"RETAIL\"\r\n                unCheckedChildren=\"WHOLESALE\"\r\n                checked={billSettings.isRetail}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({ ...prev, isRetail: checked }))\r\n                }\r\n                className={styles.saleTypeSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            <div className={`${styles.controlGroup} ${styles.gstControl}`}>\r\n              <Text className={styles.controlLabel}> GST</Text>\r\n              <Switch\r\n                checkedChildren=\"INCL\"\r\n                unCheckedChildren=\"EXCL\"\r\n                checked={billSettings.isGstIncluded}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({ ...prev, isGstIncluded: checked }))\r\n                }\r\n                className={styles.gstSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            <div className={`${styles.controlGroup} ${styles.paymentControl}`}>\r\n              <Text className={styles.controlLabel}> PAYMENT</Text>\r\n              <Switch\r\n                checkedChildren=\"PAID\"\r\n                unCheckedChildren=\"UNPAID\"\r\n                checked={billSettings.isPaid}\r\n                onChange={checked =>\r\n                  setBillSettings(prev => ({\r\n                    ...prev,\r\n                    isPaid: checked,\r\n                    isPartiallyPaid: checked ? false : prev.isPartiallyPaid,\r\n                  }))\r\n                }\r\n                className={styles.paymentSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            {!billSettings.isPaid && (\r\n              <div\r\n                className={`${styles.controlGroup} ${styles.partialPaymentControl}`}\r\n              >\r\n                <Text className={styles.controlLabel}> PARTIAL</Text>\r\n                <Switch\r\n                  checkedChildren=\"YES\"\r\n                  unCheckedChildren=\"NO\"\r\n                  checked={billSettings.isPartiallyPaid}\r\n                  onChange={checked =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      isPartiallyPaid: checked,\r\n                    }))\r\n                  }\r\n                  className={styles.partialPaymentSwitch}\r\n                  size=\"small\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* Items and Amount Badges - Moved to the end */}\r\n            <div className={styles.badgesContainer}>\r\n              <div className={styles.itemsBadge}>\r\n                <Text className={styles.badgeText}>\r\n                   ITEMS: {billFormData.items.length}\r\n                </Text>\r\n              </div>\r\n              <div className={styles.amountBadge}>\r\n                <Text className={styles.badgeText}>\r\n                   {billCalculations.total_amount.toFixed(2)}\r\n                </Text>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Invoice Details Data Grid */}\r\n      <div className={styles.invoiceDetailsGrid}>\r\n        <AntdEditableTable\r\n          columns={headerColumns}\r\n          dataSource={headerData}\r\n          onSave={handleHeaderChange}\r\n          allowAdd={false}\r\n          allowDelete={false}\r\n          loading={customerLoading}\r\n          className=\"compact-header-grid\"\r\n          size=\"small\"\r\n          rowKey=\"invoice_no\"\r\n        />\r\n      </div>\r\n\r\n      {/* Items Section with Summary */}\r\n      <div className={styles.itemsSection}>\r\n        {/* Decorative half circles for items section */}\r\n        <div className={styles.itemsCircle1} />\r\n        <div className={styles.itemsCircle2} />\r\n        {/* Bill Items Grid */}\r\n        <div className={styles.billItemsGrid}>\r\n          <div className={styles.billItemsHeader}>\r\n            <Text className={styles.billItemsTitle}> BILL ITEMS</Text>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n              <Badge\r\n                count={billFormData.items.length}\r\n                showZero\r\n                size=\"small\"\r\n                style={{ backgroundColor: 'rgba(255,255,255,0.2)' }}\r\n              >\r\n                <Text className={styles.billItemsBadge}>Items</Text>\r\n              </Badge>\r\n              <Text\r\n                style={{\r\n                  fontSize: '10px',\r\n                  color: '#666',\r\n                  backgroundColor: '#f0f0f0',\r\n                  padding: '2px 6px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                }}\r\n              ></Text>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Stock Validation Summary */}\r\n          {/* {(() => {\r\n            const stockValidationSummary = billFormData.items\r\n              .filter(item => item.stock_id && (item.qty || item.loose_qty))\r\n              .map(item => {\r\n                const stockList = branchId ? branchStockList : stockAuditList;\r\n                const stock = stockList?.result?.find((s: any) => s._id === item.stock_id);\r\n                const availableQty = stock?.available_quantity || 0;\r\n                const totalEnteredQty = (item.qty || 0) + (item.loose_qty || 0);\r\n                const isValid = totalEnteredQty <= availableQty;\r\n                const remainingQty = Math.max(0, availableQty - totalEnteredQty);\r\n                \r\n                return {\r\n                  productName: item.product_name || 'Unknown Product',\r\n                  batchNo: item.batch_no || 'No Batch',\r\n                  availableQty,\r\n                  enteredQty: totalEnteredQty,\r\n                  remainingQty,\r\n                  isValid,\r\n                  isLowStock: remainingQty > 0 && remainingQty <= 5\r\n                };\r\n              });\r\n\r\n            const hasValidationIssues = stockValidationSummary.some(item => !item.isValid);\r\n            const hasLowStock = stockValidationSummary.some(item => item.isLowStock);\r\n\r\n            if (stockValidationSummary.length === 0) return null;\r\n\r\n            return (\r\n              <div style={{\r\n                marginBottom: '16px',\r\n                padding: '12px',\r\n                borderRadius: '8px',\r\n                backgroundColor: hasValidationIssues ? '#fff2f0' : hasLowStock ? '#fffbe6' : '#f6ffed',\r\n                border: `1px solid ${hasValidationIssues ? '#ffccc7' : hasLowStock ? '#ffe58f' : '#b7eb8f'}`,\r\n                fontSize: '12px'\r\n              }}>\r\n                <div style={{ \r\n                  fontWeight: 'bold', \r\n                  marginBottom: '8px',\r\n                  color: hasValidationIssues ? '#cf1322' : hasLowStock ? '#d48806' : '#389e0d'\r\n                }}>\r\n                   Stock Validation Summary\r\n                </div>\r\n                {stockValidationSummary.map((item, index) => (\r\n                  <div key={index} style={{\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center',\r\n                    padding: '4px 0',\r\n                    borderBottom: index < stockValidationSummary.length - 1 ? '1px solid #f0f0f0' : 'none'\r\n                  }}>\r\n                    <span style={{ fontWeight: '500' }}>\r\n                      {item.productName} ({item.batchNo})\r\n                    </span>\r\n                    <div style={{ display: 'flex', gap: '16px', alignItems: 'center' }}>\r\n                      <span>Available: {item.availableQty}</span>\r\n                      <span>Entered: {item.enteredQty}</span>\r\n                      <span>Remaining: {item.remainingQty}</span>\r\n                      <span style={{\r\n                        color: item.isValid ? '#52c41a' : '#ff4d4f',\r\n                        fontWeight: 'bold'\r\n                      }}>\r\n                        {item.isValid ? ' Valid' : ' Exceeds Stock'}\r\n                      </span>\r\n                      {item.isLowStock && (\r\n                        <span style={{ color: '#faad14', fontWeight: 'bold' }}>\r\n                           Low Stock\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            );\r\n          })()} */}\r\n\r\n          <AntdEditableTable\r\n            columns={itemColumns}\r\n            dataSource={billFormData.items.map((item, index) => ({\r\n              ...item,\r\n              key: index.toString(),\r\n            }))}\r\n            onSave={handleItemsChange}\r\n            onAdd={handleAddItem}\r\n            onDelete={handleDeleteItems}\r\n            onProductSelect={handleProductSelect}\r\n            loading={productLoading || stockLoading || branchStockLoading}\r\n            className=\"modern-bill-grid\"\r\n            size=\"small\"\r\n            rowKey=\"key\"\r\n            externalEditingCell={externalEditingCell}\r\n          />\r\n        </div>\r\n\r\n        {/* Bill Summary - Right Side */}\r\n        <div className={styles.billSummary}>\r\n          {/* Decorative half circles for summary */}\r\n          <div className={styles.summaryCircle1} />\r\n          <div className={styles.summaryCircle2} />\r\n          {/* Header */}\r\n          <div className={styles.summaryHeader}>\r\n            <Text className={styles.summaryTitle}> BILL SUMMARY</Text>\r\n          </div>\r\n\r\n          {/* Summary Table */}\r\n          <div className={styles.summaryTable}>\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Sub Total:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.sub_total.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Value of Goods:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.value_of_goods.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>Total GST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.total_gst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>CGST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.cgst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            <div className={styles.summaryRow}>\r\n              <Text className={styles.summaryLabel}>SGST:</Text>\r\n              <Text className={styles.summaryValue}>\r\n                {billCalculations.sgst.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            {billSettings.discount > 0 && (\r\n              <div className={styles.summaryRow}>\r\n                <Text className={styles.summaryLabel}>DISCOUNT:</Text>\r\n                <Text className={styles.discountValue}>\r\n                  -\r\n                  {billSettings.discountType === 'percentage'\r\n                    ? (\r\n                        ((billCalculations.sub_total +\r\n                          billCalculations.total_gst) *\r\n                          (typeof billSettings.discount === 'number'\r\n                            ? billSettings.discount\r\n                            : 0)) /\r\n                        100\r\n                      ).toFixed(2)\r\n                    : (typeof billSettings.discount === 'number'\r\n                        ? billSettings.discount\r\n                        : 0\r\n                      ).toFixed(2)}\r\n                </Text>\r\n              </div>\r\n            )}\r\n\r\n            <div className={styles.totalAmountRow}>\r\n              <Text className={styles.totalAmountLabel}>NET/EXC/REPL:</Text>\r\n              <Text className={styles.totalAmountValue}>\r\n                {billCalculations.total_amount.toFixed(2)}\r\n              </Text>\r\n            </div>\r\n\r\n            {billSettings.isPartiallyPaid && (\r\n              <div className={styles.partialPaymentInfo}>\r\n                <div className={styles.partialPaymentRow}>\r\n                  <Text className={styles.partialPaymentLabel}>\r\n                    Paid Amount:\r\n                  </Text>\r\n                  <Text className={styles.partialPaymentValue}>\r\n                    \r\n                    {(typeof billSettings.paidAmount === 'number'\r\n                      ? billSettings.paidAmount\r\n                      : 0\r\n                    ).toFixed(2)}\r\n                  </Text>\r\n                </div>\r\n                <div className={styles.partialPaymentRow}>\r\n                  <Text className={styles.partialPaymentLabel}>Balance:</Text>\r\n                  <Text className={styles.partialPaymentValue}>\r\n                    \r\n                    {(\r\n                      billCalculations.total_amount -\r\n                      (typeof billSettings.paidAmount === 'number'\r\n                        ? billSettings.paidAmount\r\n                        : 0)\r\n                    ).toFixed(2)}\r\n                  </Text>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Discount & Payment Controls */}\r\n          <div className={styles.controlsContainer}>\r\n            {/* Discount Controls */}\r\n            <div className={styles.discountControl}>\r\n              <Text className={styles.discountControlLabel}> DISCOUNT</Text>\r\n              <div className={styles.discountControlInputs}>\r\n                <InputNumber\r\n                  min={0}\r\n                  value={billSettings.discount}\r\n                  onChange={value =>\r\n                    setBillSettings(prev => ({ ...prev, discount: value || 0 }))\r\n                  }\r\n                  style={{ width: 70 }}\r\n                  size=\"small\"\r\n                />\r\n                <Switch\r\n                  checkedChildren=\"%\"\r\n                  unCheckedChildren=\"\"\r\n                  checked={billSettings.discountType === 'percentage'}\r\n                  onChange={checked =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      discountType: checked ? 'percentage' : 'amount',\r\n                    }))\r\n                  }\r\n                  size=\"small\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Partial Payment Controls */}\r\n            {billSettings.isPartiallyPaid && (\r\n              <div className={styles.partialPaymentControl}>\r\n                <Text className={styles.partialPaymentControlLabel}>\r\n                   PARTIAL PAY\r\n                </Text>\r\n                <InputNumber\r\n                  min={0}\r\n                  max={billCalculations.total_amount}\r\n                  value={billSettings.paidAmount}\r\n                  onChange={value =>\r\n                    setBillSettings(prev => ({\r\n                      ...prev,\r\n                      paidAmount: value || 0,\r\n                    }))\r\n                  }\r\n                  style={{ width: 90 }}\r\n                  size=\"small\"\r\n                  formatter={value =>\r\n                    `${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\r\n                  }\r\n                  parser={value => Number(value!.replace(/\\s?|(,*)/g, ''))}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Ultra-Fast Action Hub */}\r\n      <div className={styles.actionHub}>\r\n        {/* Background decoration */}\r\n        <div className={styles.actionHubCircle1} />\r\n        <div className={styles.actionHubCircle2} />\r\n        <div className={styles.actionHubCircle3} />\r\n        <div className={styles.actionHubCircle4} />\r\n\r\n        <div className={styles.actionButtonsContainer}>\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            icon={<SaveOutlined />}\r\n            onClick={handleSaveBill}\r\n            loading={saleCreateLoading}\r\n            className={styles.saveButton}\r\n          >\r\n             {billdata ? 'UPDATE' : 'SAVE BILL'} (F2)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<FileTextOutlined />}\r\n            onClick={() => setBillListDrawerVisible(true)}\r\n            className={styles.billListButton}\r\n          >\r\n             BILL LIST (F6)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<ClearOutlined />}\r\n            onClick={handleClearBill}\r\n            className={styles.clearButton}\r\n          >\r\n             CLEAR (F4 / Ctrl+R)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<PrinterOutlined />}\r\n            className={styles.printButton}\r\n          >\r\n             PRINT (F3)\r\n          </Button>\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)',\r\n            padding: '14px 18px',\r\n            borderRadius: '10px',\r\n            border: '1px solid #cbd5e1',\r\n            position: 'relative',\r\n            zIndex: 1,\r\n            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.05)',\r\n          }}\r\n        >\r\n          <div style={{ textAlign: 'right' }}>\r\n            <Text\r\n              style={{\r\n                color: '#475569',\r\n                fontSize: '12px',\r\n                display: 'block',\r\n                fontWeight: 600,\r\n                lineHeight: '18px',\r\n              }}\r\n            >\r\n               <strong>Keyboard Shortcuts:</strong> Ctrl+S (Save)  Ctrl+N\r\n              (Add)  F4/Ctrl+R (Clear)  Tab/Shift+Tab (Navigate)  Enter\r\n              (Edit)  Esc (Cancel)  End (Customer)  Ctrl+U (User)  F5\r\n              (Product)  F6 (Bill List)  F7 (Stock)\r\n            </Text>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {stockModalRowIndex !== null && (\r\n        <StockSelectionModal\r\n          visible={true}\r\n          onSelect={handleStockSelect}\r\n          onCancel={() => setStockModalRowIndex(null)}\r\n          productId={billFormData.items[stockModalRowIndex]?.product_id || ''}\r\n        />\r\n      )}\r\n\r\n      {/* Customer Selection Modal */}\r\n      <CustomerSelectionModal\r\n        visible={customerModalVisible}\r\n        onSelect={handleCustomerSelect}\r\n        onCancel={() => setCustomerModalVisible(false)}\r\n      />\r\n\r\n      {/* User Selection Modal */}\r\n      <UserSelectionModal\r\n        visible={userModalVisible}\r\n        onSelect={handleUserSelect}\r\n        onCancel={() => setUserModalVisible(false)}\r\n      />\r\n\r\n      {/* Bill Save Confirmation Modal */}\r\n      <BillSaveConfirmationModal\r\n        visible={saveConfirmationVisible}\r\n        onNewBill={handleNewBill}\r\n        onContinueBill={handleContinueBill}\r\n        onCancel={() => setSaveConfirmationVisible(false)}\r\n        savedBillData={savedBillData}\r\n      />\r\n\r\n      {/* Product Details Modal */}\r\n      <ProductDetailsModal\r\n        visible={productDetailsModalVisible}\r\n        onCancel={() => setProductDetailsModalVisible(false)}\r\n        productId={selectedProductId}\r\n      />\r\n\r\n      {/* Product Selection Modal */}\r\n      <ProductSelectionModal\r\n        visible={productSelectionModalVisible}\r\n        onSelect={handleProductSelectionModalSelect}\r\n        onCancel={() => {\r\n          setProductSelectionModalVisible(false);\r\n          setProductSelectionRowIndex(null);\r\n        }}\r\n      />\r\n\r\n      {/* Bill List Drawer */}\r\n      <BillListDrawer\r\n        visible={billListDrawerVisible}\r\n        onClose={() => setBillListDrawerVisible(false)}\r\n        onViewBill={handleViewBill}\r\n        onNewBill={handleNewBill}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillDataGrid;\r\n","// HTML sanitization utilities to prevent XSS attacks\r\nimport DOMPurify from 'dompurify';\r\n\r\n/**\r\n * Sanitize HTML content to prevent XSS\r\n * Use before rendering any user-generated HTML\r\n */\r\nexport const sanitizeHTML = (dirty: string): string => {\r\n  return DOMPurify.sanitize(dirty, {\r\n    ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a', 'p', 'br', 'ul', 'ol', 'li', 'span'],\r\n    ALLOWED_ATTR: ['href', 'title', 'target', 'class'],\r\n    ALLOW_DATA_ATTR: false,\r\n  });\r\n};\r\n\r\n/**\r\n * Sanitize HTML for rich text editors\r\n * More permissive tag set for formatted content\r\n */\r\nexport const sanitizeRichText = (dirty: string): string => {\r\n  return DOMPurify.sanitize(dirty, {\r\n    ALLOWED_TAGS: [\r\n      'b', 'i', 'em', 'strong', 'u', 's', 'a', 'p', 'br', \r\n      'ul', 'ol', 'li', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',\r\n      'blockquote', 'code', 'pre', 'span', 'div', 'hr', 'table',\r\n      'thead', 'tbody', 'tr', 'th', 'td'\r\n    ],\r\n    ALLOWED_ATTR: ['href', 'title', 'target', 'class', 'id'],\r\n    // Note: style attribute removed for security - inline styles can be risky\r\n    ALLOW_DATA_ATTR: false,\r\n  });\r\n};\r\n\r\n/**\r\n * Strip all HTML tags - use for plain text fields\r\n */\r\nexport const stripHTML = (dirty: string): string => {\r\n  return DOMPurify.sanitize(dirty, {\r\n    ALLOWED_TAGS: [],\r\n    ALLOWED_ATTR: [],\r\n  });\r\n};\r\n\r\n/**\r\n * Sanitize URL to prevent javascript: and data: URLs\r\n */\r\nexport const sanitizeURL = (url: string): string => {\r\n  const sanitized = DOMPurify.sanitize(url, {\r\n    ALLOWED_TAGS: [],\r\n    ALLOWED_ATTR: [],\r\n  });\r\n  \r\n  // Check for dangerous protocols\r\n  const lowerURL = sanitized.toLowerCase().trim();\r\n  if (\r\n    lowerURL.startsWith('javascript:') ||\r\n    lowerURL.startsWith('data:') ||\r\n    lowerURL.startsWith('vbscript:')\r\n  ) {\r\n    return '#';\r\n  }\r\n  \r\n  return sanitized;\r\n};\r\n\r\n/**\r\n * Safe component for rendering sanitized HTML\r\n * Usage: <div {...createSafeHTML(userContent)} />\r\n */\r\nexport const createSafeHTML = (dirty: string): { dangerouslySetInnerHTML: { __html: string } } => {\r\n  return {\r\n    dangerouslySetInnerHTML: {\r\n      __html: sanitizeHTML(dirty)\r\n    }\r\n  };\r\n};\r\n\r\n/**\r\n * Sanitize form input to prevent XSS in text fields\r\n */\r\nexport const sanitizeInput = (value: string): string => {\r\n  // Remove any HTML tags and encode special characters\r\n  return stripHTML(value)\r\n    .replace(/[<>]/g, '')\r\n    .trim();\r\n};\r\n\r\n","// extracted by mini-css-extract-plugin\nexport default {\"emailSendModal\":\"EmailSendModal_emailSendModal__BfdYk\",\"ant-modal-header\":\"EmailSendModal_ant-modal-header__8M-dy\",\"ant-modal-title\":\"EmailSendModal_ant-modal-title__UKq46\",\"emailSendHeader\":\"EmailSendModal_emailSendHeader__C2GeM\",\"anticon\":\"EmailSendModal_anticon__M+hfh\",\"ant-modal-body\":\"EmailSendModal_ant-modal-body__FQTZE\",\"emailSendContent\":\"EmailSendModal_emailSendContent__18hO-\",\"emailForm\":\"EmailSendModal_emailForm__Dz-ws\",\"formSection\":\"EmailSendModal_formSection__XePkG\",\"ant-typography\":\"EmailSendModal_ant-typography__Rf4oP\",\"ant-form-item-label\":\"EmailSendModal_ant-form-item-label__utKPG\",\"ant-input\":\"EmailSendModal_ant-input__nTmCv\",\"ant-input-affix-wrapper\":\"EmailSendModal_ant-input-affix-wrapper__uN9GE\",\"ant-input-prefix\":\"EmailSendModal_ant-input-prefix__n2R1a\",\"formActions\":\"EmailSendModal_formActions__0+vVX\",\"ant-btn\":\"EmailSendModal_ant-btn__NienV\",\"ant-btn-primary\":\"EmailSendModal_ant-btn-primary__0FF0H\",\"emailPreview\":\"EmailSendModal_emailPreview__z0YAf\",\"previewContent\":\"EmailSendModal_previewContent__i+Cpp\",\"previewHeader\":\"EmailSendModal_previewHeader__Y+2Wh\",\"previewBody\":\"EmailSendModal_previewBody__wL6Yl\",\"htmlPreview\":\"EmailSendModal_htmlPreview__Lr4X+\",\"total\":\"EmailSendModal_total__HXP29\",\"previewActions\":\"EmailSendModal_previewActions__l-Y3Y\",\"billInfo\":\"EmailSendModal_billInfo__1yHvY\",\"ant-alert\":\"EmailSendModal_ant-alert__V1924\",\"ant-alert-message\":\"EmailSendModal_ant-alert-message__a7i8z\",\"ant-alert-description\":\"EmailSendModal_ant-alert-description__2m7uE\",\"successState\":\"EmailSendModal_successState__gVP0P\",\"successIcon\":\"EmailSendModal_successIcon__levgm\",\"ant-typography-caption\":\"EmailSendModal_ant-typography-caption__bjmAF\",\"ant-spin\":\"EmailSendModal_ant-spin__m4HeQ\",\"ant-spin-dot\":\"EmailSendModal_ant-spin-dot__2ADDo\",\"slideInUp\":\"EmailSendModal_slideInUp__Mt1P+\"};","import React, { useState, useEffect } from 'react';\r\nimport { Modal, Form, Input, Button, Space, Typography, Divider, Alert, Spin, message } from 'antd';\r\nimport { \r\n  MailOutlined, \r\n  SendOutlined, \r\n  EyeOutlined, \r\n  CloseOutlined,\r\n  CheckCircleOutlined,\r\n  ExclamationCircleOutlined\r\n} from '@ant-design/icons';\r\nimport { useApiActions } from '../../services/api/useApiActions';\r\nimport { sanitizeRichText } from '../../helpers/sanitize';\r\nimport styles from './EmailSendModal.module.css';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { TextArea } = Input;\r\n\r\ninterface EmailSendModalProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  billData?: any;\r\n  customerEmail?: string;\r\n  customerName?: string;\r\n}\r\n\r\ninterface EmailPreview {\r\n  subject: string;\r\n  text: string;\r\n  html: string;\r\n}\r\n\r\nconst EmailSendModal: React.FC<EmailSendModalProps> = ({\r\n  visible,\r\n  onClose,\r\n  billData,\r\n  customerEmail,\r\n  customerName\r\n}) => {\r\n  const [form] = Form.useForm();\r\n  const [loading, setLoading] = useState(false);\r\n  const [previewMode, setPreviewMode] = useState(false);\r\n  const [emailPreview, setEmailPreview] = useState<EmailPreview | null>(null);\r\n  const [sending, setSending] = useState(false);\r\n  const [sendSuccess, setSendSuccess] = useState(false);\r\n  \r\n  const { getEntityApi } = useApiActions();\r\n\r\n  // Initialize form with customer email\r\n  useEffect(() => {\r\n    if (visible && customerEmail) {\r\n      form.setFieldsValue({\r\n        to: customerEmail,\r\n        subject: `Invoice #${billData?.invoice_no || ''} - ${customerName || ''}`\r\n      });\r\n    }\r\n  }, [visible, customerEmail, customerName, billData, form]);\r\n\r\n  // Generate email preview\r\n  const generatePreview = async () => {\r\n    if (!billData) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      // Simulate generating email preview (you can replace this with actual API call)\r\n      const preview: EmailPreview = {\r\n        subject: `Invoice #${billData.invoice_no} - ${billData.customerDetails?.full_name || 'Customer'}`,\r\n        text: generateInvoiceText(billData),\r\n        html: generateInvoiceHTML(billData)\r\n      };\r\n      \r\n      setEmailPreview(preview);\r\n      setPreviewMode(true);\r\n      form.setFieldsValue({ subject: preview.subject });\r\n    } catch (error) {\r\n      message.error('Failed to generate email preview');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Generate invoice text content\r\n  const generateInvoiceText = (invoiceData: any) => {\r\n    return `\r\nDear ${invoiceData.customerDetails?.full_name || 'Valued Customer'},\r\n\r\nThank you for your business! Please find your invoice details below:\r\n\r\nInvoice Number: ${invoiceData.invoice_no}\r\nDate: ${new Date(invoiceData.date).toLocaleDateString()}\r\nTotal Amount: ${invoiceData.total_amount || 0}\r\n\r\nItems:\r\n${invoiceData.Items?.map((item: any) => \r\n  `- ${item.productItems?.name} (${item.qty} x ${item.price}) = ${item.amount}`\r\n).join('\\n') || 'No items'}\r\n\r\nPayment Status: ${invoiceData.is_paid ? 'Paid' : 'Pending'}\r\n\r\nThank you for choosing us!\r\n\r\nBest regards,\r\nSubriva Billing Team\r\n    `.trim();\r\n  };\r\n\r\n  // Generate invoice HTML content\r\n  const generateInvoiceHTML = (invoiceData: any) => {\r\n    return `\r\n    <!DOCTYPE html>\r\n    <html>\r\n    <head>\r\n        <meta charset=\"UTF-8\">\r\n        <style>\r\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\r\n            .header { background: #f8f9fa; padding: 20px; text-align: center; }\r\n            .content { padding: 20px; }\r\n            .invoice-table { width: 100%; border-collapse: collapse; margin: 20px 0; }\r\n            .invoice-table th, .invoice-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }\r\n            .invoice-table th { background-color: #f8f9fa; }\r\n            .total { font-weight: bold; font-size: 18px; }\r\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; margin-top: 20px; }\r\n        </style>\r\n    </head>\r\n    <body>\r\n        <div class=\"header\">\r\n            <h1>Subriva Billing</h1>\r\n            <h2>Invoice #${invoiceData.invoice_no}</h2>\r\n        </div>\r\n        \r\n        <div class=\"content\">\r\n            <p>Dear <strong>${invoiceData.customerDetails?.full_name || 'Valued Customer'}</strong>,</p>\r\n            \r\n            <p>Thank you for your business! Please find your invoice details below:</p>\r\n            \r\n            <table class=\"invoice-table\">\r\n                <tr>\r\n                    <th>Invoice Number</th>\r\n                    <td>${invoiceData.invoice_no}</td>\r\n                </tr>\r\n                <tr>\r\n                    <th>Date</th>\r\n                    <td>${new Date(invoiceData.date).toLocaleDateString()}</td>\r\n                </tr>\r\n                <tr>\r\n                    <th>Customer</th>\r\n                    <td>${invoiceData.customerDetails?.full_name || 'N/A'}</td>\r\n                </tr>\r\n            </table>\r\n            \r\n            <h3>Items:</h3>\r\n            <table class=\"invoice-table\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Product</th>\r\n                        <th>Quantity</th>\r\n                        <th>Price</th>\r\n                        <th>Amount</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    ${invoiceData.Items?.map((item: any) => `\r\n                        <tr>\r\n                            <td>${item.productItems?.name || 'N/A'}</td>\r\n                            <td>${item.qty || 0}</td>\r\n                            <td>${item.price || 0}</td>\r\n                            <td>${item.amount || 0}</td>\r\n                        </tr>\r\n                    `).join('') || '<tr><td colspan=\"4\">No items</td></tr>'}\r\n                </tbody>\r\n                <tfoot>\r\n                    <tr class=\"total\">\r\n                        <td colspan=\"3\">Total Amount</td>\r\n                        <td>${invoiceData.total_amount || 0}</td>\r\n                    </tr>\r\n                </tfoot>\r\n            </table>\r\n            \r\n            <p><strong>Payment Status:</strong> ${invoiceData.is_paid ? 'Paid' : 'Pending'}</p>\r\n        </div>\r\n        \r\n        <div class=\"footer\">\r\n            <p>Thank you for choosing us!</p>\r\n            <p><strong>Best regards,<br>Subriva Billing Team</strong></p>\r\n        </div>\r\n    </body>\r\n    </html>\r\n    `;\r\n  };\r\n\r\n  // Handle email sending\r\n  const handleSendEmail = async (values: any) => {\r\n    if (!billData) {\r\n      message.error('No bill data available');\r\n      return;\r\n    }\r\n\r\n    setSending(true);\r\n    try {\r\n      // Call backend email API\r\n      const token = sessionStorage.getItem('token');\r\n      const csrfToken = sessionStorage.getItem('csrf-token');\r\n      \r\n      const response = await fetch(`${process.env.REACT_APP_API_URL || ''}/email/send-invoice`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'token': token || '',\r\n          'x-csrf-token': csrfToken || ''\r\n        },\r\n        body: JSON.stringify({\r\n          customerEmail: values.to,\r\n          invoiceData: billData,\r\n          subject: values.subject,\r\n          customMessage: values.message || ''\r\n        })\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        setSendSuccess(true);\r\n        message.success(`Invoice sent successfully to ${values.to}`);\r\n        setTimeout(() => {\r\n          onClose();\r\n        }, 2000);\r\n      } else {\r\n        message.error(result.error || 'Failed to send email');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sending email:', error);\r\n      message.error('Failed to send email. Please try again.');\r\n    } finally {\r\n      setSending(false);\r\n    }\r\n  };\r\n\r\n  // Handle form submission\r\n  const handleSubmit = () => {\r\n    form.validateFields().then(handleSendEmail);\r\n  };\r\n\r\n  // Reset modal state when closing\r\n  const handleClose = () => {\r\n    form.resetFields();\r\n    setPreviewMode(false);\r\n    setEmailPreview(null);\r\n    setSendSuccess(false);\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div className={styles.emailSendHeader}>\r\n          <MailOutlined />\r\n          <span>Send Invoice via Email</span>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={handleClose}\r\n      width={900}\r\n      className={styles.emailSendModal}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div className={styles.emailSendContent}>\r\n        {sendSuccess ? (\r\n          // Success State\r\n          <div className={styles.successState}>\r\n            <CheckCircleOutlined className={styles.successIcon} />\r\n            <Title level={3}>Email Sent Successfully!</Title>\r\n            <Text type=\"secondary\">\r\n              The invoice has been sent to {form.getFieldValue('to')}\r\n            </Text>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {/* Email Form */}\r\n            <Form\r\n              form={form}\r\n              layout=\"vertical\"\r\n              onFinish={handleSubmit}\r\n              className={styles.emailForm}\r\n            >\r\n                <div className={styles.formSection}>\r\n                <Title level={4}>Email Details</Title>\r\n                \r\n                <Form.Item\r\n                  label=\"To\"\r\n                  name=\"to\"\r\n                  rules={[\r\n                    { required: true, message: 'Please enter recipient email' },\r\n                    { type: 'email', message: 'Please enter valid email address' }\r\n                  ]}\r\n                >\r\n                  <Input\r\n                    prefix={<MailOutlined />}\r\n                    placeholder=\"customer@example.com\"\r\n                    size=\"large\"\r\n                  />\r\n                </Form.Item>\r\n\r\n                <Form.Item\r\n                  label=\"Subject\"\r\n                  name=\"subject\"\r\n                  rules={[{ required: true, message: 'Please enter email subject' }]}\r\n                >\r\n                  <Input\r\n                    placeholder=\"Invoice subject\"\r\n                    size=\"large\"\r\n                  />\r\n                </Form.Item>\r\n\r\n                <Form.Item\r\n                  label=\"Custom Message (Optional)\"\r\n                  name=\"message\"\r\n                >\r\n                  <TextArea\r\n                    rows={3}\r\n                    placeholder=\"Add a personal message to the customer...\"\r\n                  />\r\n                </Form.Item>\r\n              </div>\r\n\r\n              <Divider />\r\n\r\n              {/* Actions */}\r\n              <div className={styles.formActions}>\r\n                <Space>\r\n                  <Button\r\n                    icon={<EyeOutlined />}\r\n                    onClick={generatePreview}\r\n                    loading={loading}\r\n                    disabled={!billData}\r\n                  >\r\n                    Preview Email\r\n                  </Button>\r\n                  \r\n                  <Button\r\n                    type=\"primary\"\r\n                    icon={<SendOutlined />}\r\n                    htmlType=\"submit\"\r\n                    loading={sending}\r\n                    disabled={!billData}\r\n                  >\r\n                    Send Email\r\n                  </Button>\r\n                  \r\n                  <Button onClick={handleClose}>\r\n                    Cancel\r\n                  </Button>\r\n                </Space>\r\n              </div>\r\n            </Form>\r\n\r\n            {/* Email Preview */}\r\n            {previewMode && emailPreview && (\r\n              <div className={styles.emailPreview}>\r\n                <Divider>Email Preview</Divider>\r\n                <div className={styles.previewContent}>\r\n                  <div className={styles.previewHeader}>\r\n                    <Title level={5}>Subject: {emailPreview.subject}</Title>\r\n                  </div>\r\n                  \r\n                  <div className={styles.previewBody}>\r\n                    <div \r\n                      className={styles.htmlPreview}\r\n                      dangerouslySetInnerHTML={{ __html: sanitizeRichText(emailPreview.html) }}\r\n                    />\r\n                  </div>\r\n                  \r\n                  <div className={styles.previewActions}>\r\n                    <Button\r\n                      type=\"primary\"\r\n                      icon={<SendOutlined />}\r\n                      onClick={handleSubmit}\r\n                      loading={sending}\r\n                    >\r\n                      Send This Email\r\n                    </Button>\r\n                    <Button onClick={() => setPreviewMode(false)}>\r\n                      Back to Edit\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Bill Info */}\r\n            {billData && (\r\n              <div className={styles.billInfo}>\r\n                <Alert\r\n                  message=\"Invoice Information\"\r\n                  description={\r\n                    <div>\r\n                      <Text strong>Invoice #:</Text> {billData.invoice_no}<br />\r\n                      <Text strong>Customer:</Text> {billData.customerDetails?.full_name || 'N/A'}<br />\r\n                      <Text strong>Amount:</Text> {billData.total_amount || 0}\r\n                    </div>\r\n                  }\r\n                  type=\"info\"\r\n                  showIcon\r\n                />\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default EmailSendModal;\r\n","import React, { useRef, useState } from \"react\";\r\nimport { Modal, Button, Table, Typography } from \"antd\";\r\nimport { PrinterOutlined, MailOutlined } from \"@ant-design/icons\";\r\nimport EmailSendModal from '../../../components/common/EmailSendModal';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillViewModalProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  billData: {\r\n    invoice_no: string;\r\n    date: string;\r\n    sub_total: number;\r\n    customerDetails: any;\r\n    payment_mode: string;\r\n    Items: any[];\r\n    total_gst: number;\r\n    cgst: number;\r\n    sgst: number;\r\n    total_amount: number;\r\n    is_paid: boolean;\r\n    is_partially_paid: boolean;\r\n    paid_amount: number;\r\n    discount: number;\r\n    discount_type: string;\r\n    is_gst_included: boolean;\r\n    sale_type: \"retail\" | \"wholesale\";\r\n    value_of_goods: number;\r\n  };\r\n}\r\n\r\nconst BillViewModal: React.FC<BillViewModalProps> = ({\r\n  visible,\r\n  onClose,\r\n  billData,\r\n}) => {\r\n  const printFrameRef = useRef<HTMLIFrameElement>(null);\r\n  const [emailModalVisible, setEmailModalVisible] = useState(false);\r\n  const formatAmount = (amount: any) => {\r\n    const numAmount = Number(amount) || 0;\r\n    return numAmount.toFixed(2);\r\n  };\r\n  const shopDetails = {\r\n    name: \"Focuz Medicals\",\r\n    address: \"123 MG Road, Bangalore, Karnataka - 560001\",\r\n    gst: \"29ABCDE1234F1Z5\",\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      title: \"Item\",\r\n      dataIndex: \"productItems\",\r\n      key: \"name\",\r\n      render: (_: any, record: any) => {\r\n        const product = record.productItems;\r\n        if (!product) return \"\";\r\n        const variantName = product.VariantItem?.variant_name;\r\n        return variantName ? `${product.name} - ${variantName}` : product.name;\r\n      },\r\n    },\r\n    {\r\n      title: \"Qty\",\r\n      dataIndex: \"qty\",\r\n      key: \"qty\",\r\n      width: 100,\r\n      render: (qty: any) => qty || 0,\r\n    },\r\n    {\r\n      title: \"Loose Qty\",\r\n      dataIndex: \"loose_qty\",\r\n      key: \"loose_qty\",\r\n      width: 100,\r\n      render: (loose_qty: any) => loose_qty || 0,\r\n    },\r\n    {\r\n      title: \"Price\",\r\n      dataIndex: \"price\",\r\n      key: \"price\",\r\n      width: 120,\r\n      render: (price: any) => ` ${formatAmount(price)}`,\r\n    },\r\n    {\r\n      title: \"Amount\",\r\n      dataIndex: \"amount\",\r\n      key: \"amount\",\r\n      width: 120,\r\n      render: (amount: any) => ` ${formatAmount(amount)}`,\r\n    },\r\n  ];\r\n\r\n  const handlePrint = () => {\r\n    const content = `\r\n      <html>\r\n        <head>\r\n          <title>Sale - ${billData.invoice_no}</title>\r\n          <style>\r\n            body { font-family: Arial, sans-serif; padding: 20px; color: #222; }\r\n            .shop-info { text-align: center; margin-bottom: 20px; }\r\n            .shop-info h2 { margin-bottom: 0; color: #1890ff; }\r\n            .info-flex { display: flex; justify-content: space-between; margin-bottom: 10px; }\r\n            table { width: 100%; border-collapse: collapse; margin-top: 20px; }\r\n            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\r\n            th { background-color: #f5f5f5; }\r\n            .total { text-align: right; font-weight: bold; margin-top: 10px; }\r\n            .thank-you { text-align: center; margin-top: 40px; font-size: 16px; color: #1890ff; font-weight: bold; }\r\n            @media print {\r\n              .no-print { display: none; }\r\n            }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"shop-info\">\r\n            <h2>${shopDetails.name}</h2>\r\n            <p>${shopDetails.address}</p>\r\n            <p><strong>GST No:</strong> ${shopDetails.gst}</p>\r\n          </div>\r\n\r\n          <div class=\"info-flex\">\r\n            <div>\r\n              <p><strong>Invoice No:</strong> ${billData.invoice_no}</p>\r\n              <p><strong>Date:</strong> ${new Date(\r\n                billData.date\r\n              ).toLocaleDateString()}</p>\r\n            </div>\r\n            <div style=\"text-align: right;\">\r\n              <p><strong>Customer:</strong> ${\r\n                billData.customerDetails?.full_name || \"\"\r\n              }</p>\r\n              <p><strong>Payment Mode:</strong> ${\r\n                billData.payment_mode || \"\"\r\n              }</p>\r\n            </div>\r\n          </div>\r\n\r\n          <table>\r\n            <thead>\r\n              <tr>\r\n                <th>Item</th>\r\n                <th>Qty</th>\r\n                <th>Loose Qty</th>\r\n                <th>Price</th>\r\n                <th>Amount</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              ${billData.Items.map((item) => {\r\n                const product = item.productItems;\r\n                const itemName = product\r\n                  ? `${product.name}${\r\n                      product.VariantItem?.variant_name\r\n                        ? ` - ${product.VariantItem.variant_name}`\r\n                        : \"\"\r\n                    }`\r\n                  : \"\";\r\n                return `\r\n                  <tr>\r\n                    <td>${itemName}</td>\r\n                    <td>${item.qty || 0}</td>\r\n                    <td>${item.loose_qty || 0}</td>\r\n                    <td> ${formatAmount(item.price)}</td>\r\n                    <td> ${formatAmount(item.amount)}</td>\r\n                  </tr>\r\n                `;\r\n              }).join(\"\")}\r\n            </tbody>\r\n          </table>\r\n\r\n          <div class=\"total\">\r\n            <p>Value of Goods:  ${formatAmount(billData.value_of_goods)}</p>\r\n            ${\r\n              billData.discount > 0\r\n                ? `\r\n              <p>Discount: ${\r\n                billData.discount_type === \"percentage\"\r\n                  ? billData.discount + \"%\"\r\n                  : \" \" + formatAmount(billData.discount)\r\n              }</p>\r\n            `\r\n                : \"\"\r\n            }\r\n            <p>Total GST:  ${formatAmount(billData.total_gst)}</p>\r\n            <p>CGST:  ${formatAmount(billData.cgst || billData.total_gst / 2)}</p>\r\n            <p>SGST:  ${formatAmount(billData.sgst || billData.total_gst / 2)}</p>\r\n            <p><strong>${\r\n              billData.sale_type === \"retail\" ? \"Bill Value\" : \"Invoice Value\"\r\n            }:  ${formatAmount(billData.total_amount)}</strong></p>\r\n            ${\r\n              billData.is_partially_paid\r\n                ? `\r\n              <p>Paid Amount:  ${formatAmount(billData.paid_amount)}</p>\r\n              <p>Remaining Amount:  ${formatAmount(\r\n                Number(billData.total_amount) - Number(billData.paid_amount)\r\n              )}</p>\r\n            `\r\n                : \"\"\r\n            }\r\n            <p><strong>Payment Status:</strong> ${\r\n              billData.is_paid\r\n                ? \"Fully Paid\"\r\n                : billData.is_partially_paid\r\n                ? \"Partially Paid\"\r\n                : \"Unpaid\"\r\n            }</p>\r\n          </div>\r\n\r\n          <div class=\"thank-you\">\r\n            Thank you for shopping with us!\r\n          </div>\r\n\r\n          <script>\r\n            window.onload = function() {\r\n              window.print();\r\n              window.onafterprint = function() {\r\n                window.parent.postMessage('printComplete', '*');\r\n              };\r\n            };\r\n          </script>\r\n        </body>\r\n      </html>\r\n    `;\r\n\r\n    const iframe = printFrameRef.current;\r\n    iframe!.contentWindow!.document.open();\r\n    iframe!.contentWindow!.document.write(content);\r\n    iframe!.contentWindow!.document.close();\r\n\r\n    window.addEventListener(\"message\", (event) => {\r\n      if (event.data === \"printComplete\") {\r\n        onClose();\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Modal\r\n        title={\r\n          <Title level={4} style={{ margin: 0, color: \"#1890ff\" }}>\r\n            Sale Details\r\n          </Title>\r\n        }\r\n        open={visible}\r\n        onCancel={onClose}\r\n        width={800}\r\n        footer={[\r\n          <Button\r\n            key=\"email\"\r\n            type=\"primary\"\r\n            icon={<MailOutlined />}\r\n            onClick={() => setEmailModalVisible(true)}\r\n          >\r\n            Send via Email\r\n          </Button>,\r\n          <Button\r\n            key=\"print\"\r\n            icon={<PrinterOutlined />}\r\n            onClick={handlePrint}\r\n          >\r\n            Print Sale\r\n          </Button>,\r\n          <Button key=\"close\" onClick={onClose}>\r\n            Close\r\n          </Button>,\r\n        ]}\r\n      >\r\n        <div style={{ textAlign: \"center\", marginBottom: 16 }}>\r\n          <Title level={4} style={{ marginBottom: 0, color: \"#1890ff\" }}>\r\n            {shopDetails.name}\r\n          </Title>\r\n          <Text>{shopDetails.address}</Text>\r\n          <br />\r\n          <Text>\r\n            <strong>GST No:</strong> <Text code>{shopDetails.gst}</Text>\r\n          </Text>\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            display: \"flex\",\r\n            justifyContent: \"space-between\",\r\n            marginBottom: 20,\r\n          }}\r\n        >\r\n          <div>\r\n            <Text strong>Invoice No:</Text> {billData.invoice_no}\r\n            <br />\r\n            <Text strong>Date:</Text>{\" \"}\r\n            {new Date(billData.date).toLocaleDateString()}\r\n          </div>\r\n          <div style={{ textAlign: \"right\" }}>\r\n            <Text strong>Customer:</Text> {billData.customerDetails?.full_name}\r\n            <br />\r\n            <Text strong>Payment Mode:</Text> {billData.payment_mode}\r\n          </div>\r\n        </div>\r\n        <Table\r\n          dataSource={billData.Items}\r\n          columns={columns}\r\n          pagination={false}\r\n          bordered\r\n          summary={() => (\r\n            <Table.Summary.Row>\r\n              <Table.Summary.Cell index={0} colSpan={4}>\r\n                <Text strong>Total Amount:</Text>\r\n              </Table.Summary.Cell>\r\n              <Table.Summary.Cell index={1}>\r\n                <Text strong> {formatAmount(billData.sub_total)}</Text>\r\n              </Table.Summary.Cell>\r\n            </Table.Summary.Row>\r\n          )}\r\n        />\r\n\r\n        <div style={{ marginTop: 20, textAlign: \"right\" }}>\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: \"8px\",\r\n              marginBottom: \"8px\",\r\n            }}\r\n          >\r\n            <Text strong>Value of Goods:</Text>\r\n            <Text> {formatAmount(billData.value_of_goods)}</Text>\r\n          </div>\r\n          {billData.discount > 0 && (\r\n            <div\r\n              style={{\r\n                display: \"flex\",\r\n                justifyContent: \"flex-end\",\r\n                gap: \"8px\",\r\n                marginBottom: \"8px\",\r\n              }}\r\n            >\r\n              <Text strong>Discount:</Text>\r\n              <Text>\r\n                {billData.discount_type === \"percentage\"\r\n                  ? `${billData.discount}%`\r\n                  : ` ${formatAmount(billData.discount)}`}\r\n              </Text>\r\n            </div>\r\n          )}\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: \"8px\",\r\n              marginBottom: \"8px\",\r\n            }}\r\n          >\r\n            <Text strong>Total GST:</Text>\r\n            <Text> {formatAmount(billData.total_gst)}</Text>\r\n          </div>\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: \"8px\",\r\n              marginBottom: \"8px\",\r\n            }}\r\n          >\r\n            <Text strong>CGST:</Text>\r\n            <Text> {formatAmount(billData.cgst || billData.total_gst / 2)}</Text>\r\n          </div>\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: \"8px\",\r\n              marginBottom: \"8px\",\r\n            }}\r\n          >\r\n            <Text strong>SGST:</Text>\r\n            <Text> {formatAmount(billData.sgst || billData.total_gst / 2)}</Text>\r\n          </div>\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              justifyContent: \"flex-end\",\r\n              gap: \"8px\",\r\n              marginBottom: \"8px\",\r\n            }}\r\n          >\r\n            <Text strong>\r\n              {billData.sale_type === \"retail\" ? \"Bill Value\" : \"Invoice Value\"}\r\n              :\r\n            </Text>\r\n            <Text> {formatAmount(billData.total_amount)}</Text>\r\n          </div>\r\n          <Text strong>Payment Status: </Text>\r\n          {billData.is_paid ? (\r\n            <Text type=\"success\">Fully Paid</Text>\r\n          ) : billData.is_partially_paid ? (\r\n            <>\r\n              <Text type=\"warning\">Partially Paid</Text>\r\n              <br />\r\n              <Text>Paid Amount:  {formatAmount(billData.paid_amount)}</Text>\r\n              <br />\r\n              <Text>\r\n                Remaining Amount: {\" \"}\r\n                {formatAmount(\r\n                  Number(billData.total_amount) - Number(billData.paid_amount)\r\n                )}\r\n              </Text>\r\n            </>\r\n          ) : (\r\n            <Text type=\"danger\">Unpaid</Text>\r\n          )}\r\n        </div>\r\n\r\n        <div style={{ textAlign: \"center\", marginTop: 40 }}>\r\n          <Text style={{ color: \"#1890ff\", fontWeight: 500 }}>\r\n            Thank you for shopping with us!\r\n          </Text>\r\n        </div>\r\n      </Modal>\r\n\r\n      <iframe\r\n        ref={printFrameRef}\r\n        style={{ display: \"none\" }}\r\n        title=\"print-frame\"\r\n      />\r\n\r\n      {/* Email Send Modal */}\r\n      <EmailSendModal\r\n        visible={emailModalVisible}\r\n        onClose={() => setEmailModalVisible(false)}\r\n        billData={billData}\r\n        customerEmail={billData?.customerDetails?.email}\r\n        customerName={billData?.customerDetails?.full_name}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default BillViewModal;\r\n","import React from 'react';\r\nimport { useUser } from '../../../components/antd/UserContext';\r\n\r\ninterface ClassicBillingTemplateProps {\r\n  billData: any;\r\n}\r\n\r\nconst ClassicBillingTemplate: React.FC<ClassicBillingTemplateProps> = ({\r\n  billData,\r\n}) => {\r\n  const userItem = useUser();\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        fontFamily: 'Courier New, monospace',\r\n        background: '#fff',\r\n        border: '1px solid #ddd',\r\n        maxWidth: '380px', // Thermal receipt width\r\n        margin: '20px auto',\r\n        padding: '16px',\r\n        fontSize: '12px',\r\n        color: '#000',\r\n      }}\r\n    >\r\n      {/* Header */}\r\n      <div style={{ textAlign: 'center', marginBottom: '8px' }}>\r\n        <h3 style={{ margin: '4px 0', fontWeight: 'bold', fontSize: '16px' }}>\r\n          {userItem?.organisationItems?.org_name || ''}\r\n        </h3>\r\n        <div style={{ fontSize: '11px', marginBottom: '4px' }}>\r\n          {userItem?.branchItems?.address1 ||\r\n            ''}\r\n        </div>\r\n        <div style={{ fontSize: '11px' }}>\r\n          GSTIN: {userItem?.organisationItems?.gst_number || '33XXXXXXXXXXX'}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Invoice Info */}\r\n      <div\r\n        style={{\r\n          display: 'flex',\r\n          justifyContent: 'space-between',\r\n          marginBottom: '8px',\r\n        }}\r\n      >\r\n        <div>\r\n          <div>BILL NO: {billData?.invoice_no || 'INV-XXXX'}</div>\r\n          <div>\r\n            DATE:{' '}\r\n            {billData?.date\r\n              ? new Date(billData.date).toLocaleDateString()\r\n              : '-'}\r\n          </div>\r\n        </div>\r\n        <div style={{ textAlign: 'right' }}>\r\n          <div>\r\n            NAME:{' '}\r\n            {(billData?.customerName || '').substring(0, 20).toUpperCase()}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{ borderTop: '1px dashed #000', margin: '4px 0' }}></div>\r\n\r\n      {/* Items Table */}\r\n      <table\r\n        style={{\r\n          width: '100%',\r\n          borderCollapse: 'collapse',\r\n          marginBottom: '8px',\r\n        }}\r\n      >\r\n        <thead>\r\n          <tr>\r\n            <th style={tableHeaderStyle}>S.No</th>\r\n            <th style={tableHeaderStyle}>Item</th>\r\n            <th style={tableHeaderStyle}>Qty</th>\r\n            <th style={tableHeaderStyle}>Rate</th>\r\n            <th style={tableHeaderStyle}>MRP</th>\r\n            <th style={tableHeaderStyle}>Amt</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {billData?.items?.map((item: any, idx: number) => (\r\n            <tr key={idx}>\r\n              <td style={tableCellStyle}>{idx + 1}</td>\r\n              <td style={tableCellStyle}>\r\n                {item.name.length > 15\r\n                  ? item.name.substring(0, 15) + '...'\r\n                  : item.name}\r\n              </td>\r\n              <td style={tableCellStyle}>{item.qty}</td>\r\n              <td style={tableCellStyle}>{item.price}</td>\r\n              <td style={tableCellStyle}>{item.mrp || item.price}</td>\r\n              <td style={tableCellStyle}>{item.amount}</td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n\r\n      <div style={{ borderTop: '1px dashed #000', margin: '4px 0' }}></div>\r\n\r\n      {/* Total Section */}\r\n      <div style={{ textAlign: 'right', fontWeight: 'bold' }}>\r\n        <div>Subtotal:  {billData?.total}</div>\r\n        <div>CGST:  {(billData?.cgst || (billData?.total_gst || 0) / 2).toFixed(2)}</div>\r\n        <div>SGST:  {(billData?.sgst || (billData?.total_gst || 0) / 2).toFixed(2)}</div>\r\n        <div style={{ fontSize: '14px' }}>\r\n          NET AMOUNT:  {billData?.total}\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{ borderTop: '1px dashed #000', margin: '8px 0' }}></div>\r\n\r\n      {/* Footer */}\r\n      <div style={{ textAlign: 'center', fontSize: '11px' }}>\r\n        *** GET WELL SOON. THANK YOU ***\r\n        <br />\r\n        Goods Once Sold Cannot Be Taken Back\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst tableHeaderStyle = {\r\n  borderBottom: '1px solid #000',\r\n  padding: '2px',\r\n  textAlign: 'left' as const,\r\n  fontSize: '11px',\r\n};\r\n\r\nconst tableCellStyle = {\r\n  padding: '2px',\r\n  fontSize: '11px',\r\n};\r\n\r\nexport default ClassicBillingTemplate;\r\n","import ClassicBillingTemplate from './ClassicBillingTemplate';\r\nimport ModernBillingTemplate from './ModernBillingTemplate';\r\n\r\nexport const billingTemplates = {\r\n  classic: {\r\n    label: 'Classic',\r\n    component: ClassicBillingTemplate,\r\n    previewImg: 'https://via.placeholder.com/220x120?text=Classic',\r\n  },\r\n  modern: {\r\n    label: 'Modern',\r\n    component: ModernBillingTemplate,\r\n    previewImg: 'https://via.placeholder.com/220x120?text=Modern',\r\n  },\r\n};\r\n\r\nexport type BillingTemplateKey = keyof typeof billingTemplates; ","import React from 'react';\r\nimport { useUser } from '../../../components/antd/UserContext';\r\n\r\ninterface ModernBillingTemplateProps {\r\n  billData: any;\r\n}\r\n\r\nconst ModernBillingTemplate: React.FC<ModernBillingTemplateProps> = ({\r\n  billData,\r\n}) => {\r\n  const userItem = useUser();\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        padding: 30,\r\n        background: '#fff',\r\n        border: '1px solid #ccc',\r\n        borderRadius: 12,\r\n        maxWidth: 850,\r\n        margin: '20px auto',\r\n        color: '#333',\r\n        fontFamily: 'Georgia, serif',\r\n        boxShadow: '0 0 10px rgba(0,0,0,0.08)',\r\n      }}\r\n    >\r\n      {/* Header */}\r\n      <div\r\n        style={{\r\n          display: 'flex',\r\n          justifyContent: 'space-between',\r\n          borderBottom: '2px solid #333',\r\n          paddingBottom: 10,\r\n          marginBottom: 20,\r\n        }}\r\n      >\r\n        <div>\r\n          <h1 style={{ margin: 0, fontSize: 24 }}>\r\n            {userItem?.organisationItems?.org_name || 'Your Company Name'}\r\n          </h1>\r\n          <p style={{ margin: '5px 0', fontSize: 14 }}>\r\n            {userItem?.branchItems?.branch_name || 'Branch Name'}\r\n          </p>\r\n          <p style={{ margin: 0, fontSize: 12 }}>\r\n            {userItem?.branchItems?.address1 || 'Branch Address'}\r\n          </p>\r\n        </div>\r\n        <div style={{ textAlign: 'right', fontSize: 12 }}>\r\n          <p style={{ margin: 0 }}>\r\n            <strong>GSTIN:</strong>{' '}\r\n            {userItem?.organisationItems?.gst_number || '-'}\r\n          </p>\r\n          <p style={{ margin: '5px 0', fontWeight: 600 }}>\r\n            {billData?.sale_type === 'wholesale' ? 'INVOICE' : 'CASH BILL'}\r\n          </p>\r\n          <p style={{ margin: 0 }}>\r\n            <strong>Invoice #:</strong> {billData?.invoice_no || '-'}\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Customer Info */}\r\n      <div\r\n        style={{\r\n          display: 'flex',\r\n          justifyContent: 'space-between',\r\n          marginBottom: 20,\r\n        }}\r\n      >\r\n        <div style={{ fontSize: 13 }}>\r\n          <p style={{ margin: '2px 0' }}>\r\n            <strong>Bill To:</strong> {billData?.customerName || 'Customer Name'}\r\n          </p>\r\n          <p style={{ margin: '2px 0', color: '#555' }}>\r\n            {billData?.customerAddress || 'Customer Address'}\r\n          </p>\r\n        </div>\r\n        <div style={{ textAlign: 'right', fontSize: 13 }}>\r\n          <p style={{ margin: '2px 0' }}>\r\n            <strong>Date:</strong>{' '}\r\n            {billData?.date\r\n              ? new Date(billData.date).toLocaleDateString()\r\n              : '-'}\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Table */}\r\n      <table\r\n        style={{\r\n          width: '100%',\r\n          borderCollapse: 'collapse',\r\n          marginBottom: 20,\r\n        }}\r\n      >\r\n        <thead>\r\n          <tr style={{ background: 'rgba(255,255,255,0.08)' }}>\r\n            <th style={{ padding: 10, textAlign: 'left' }}>Item</th>\r\n            <th style={{ padding: 10, textAlign: 'right' }}>Qty</th>\r\n            <th style={{ padding: 10, textAlign: 'right' }}>Price</th>\r\n            <th style={{ padding: 10, textAlign: 'right' }}>MRP</th>\r\n            <th style={{ padding: 10, textAlign: 'right' }}>Amount</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {billData?.items?.map((item: any, idx: number) => (\r\n            <tr\r\n              key={idx}\r\n              style={{ borderBottom: '1px solid rgba(255,255,255,0.10)' }}\r\n            >\r\n              <td style={{ padding: 10 }}>{item.name}</td>\r\n              <td style={{ padding: 10, textAlign: 'right' }}>{item.qty}</td>\r\n              <td style={{ padding: 10, textAlign: 'right' }}>\r\n                {item.price}\r\n              </td>\r\n              <td style={{ padding: 10, textAlign: 'right' }}>\r\n                {item.mrp || item.price}\r\n              </td>\r\n              <td style={{ padding: 10, textAlign: 'right' }}>\r\n                {item.amount}\r\n              </td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n\r\n      {/* Totals */}\r\n      <div style={{ textAlign: 'right', fontSize: 14 }}>\r\n        {billData?.discount > 0 && (\r\n          <p>\r\n            Discount:{' '}\r\n            {billData.discount_type === 'percentage'\r\n              ? `${billData.discount}%`\r\n              : ` ${billData.discount}`}\r\n          </p>\r\n        )}\r\n        <p>CGST:  {(billData?.cgst || (billData?.total_gst || 0) / 2).toFixed(2)}</p>\r\n        <p>SGST:  {(billData?.sgst || (billData?.total_gst || 0) / 2).toFixed(2)}</p>\r\n        <h2 style={{ margin: 0 }}>Grand Total:  {billData?.total}</h2>\r\n      </div>\r\n\r\n      {/* Footer */}\r\n      <div\r\n        style={{\r\n          textAlign: 'center',\r\n          marginTop: 30,\r\n          fontSize: 12,\r\n          color: '#999',\r\n        }}\r\n      >\r\n        *** Thank you for shopping with us! ***\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst thStyle = {\r\n  border: '1px solid #ccc',\r\n  padding: 8,\r\n  fontSize: 13,\r\n};\r\n\r\nconst tdStyle = {\r\n  border: '1px solid #eee',\r\n  padding: 8,\r\n  fontSize: 12,\r\n};\r\n\r\nexport default ModernBillingTemplate;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport {\r\n  Button,\r\n  Space,\r\n  Popconfirm,\r\n  Tag,\r\n  Typography,\r\n  Form,\r\n  Input,\r\n  Tooltip,\r\n  Modal,\r\n} from \"antd\";\r\nimport {\r\n  EyeOutlined,\r\n  DeleteOutlined,\r\n  PrinterOutlined,\r\n  PlusOutlined,\r\n  SearchOutlined,\r\n  DollarOutlined,\r\n  CreditCardOutlined,\r\n  UserOutlined,\r\n  CalendarOutlined,\r\n  FileTextOutlined,\r\n  MailOutlined,\r\n} from \"@ant-design/icons\";\r\nimport dayjs from \"dayjs\";\r\nimport GlobalDrawer from \"../../components/antd/GlobalDrawer\";\r\nimport { useApiActions } from \"../../services/api/useApiActions\";\r\nimport { useDynamicSelector } from \"../../services/redux\";\r\nimport BillDataGrid from \"./components/BillDataGrid\";\r\nimport BillViewModal from \"./components/BillViewModal\";\r\nimport GlobalTable from \"../../components/antd/GlobalTable\";\r\nimport { useHandleApiResponse } from \"../../components/common/useHandleApiResponse\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { dynamic_clear } from \"../../services/redux\";\r\nimport EmailSendModal from \"../../components/common/EmailSendModal\";\r\nimport { billingTemplates } from './templates/registry';\r\n\r\nconst { Title } = Typography;\r\n\r\nconst BillListPage = () => {\r\n  const { getEntityApi } = useApiActions();\r\n  const SalesRecord = getEntityApi(\"SalesRecord\");\r\n  const { items: SalesRecordList, loading } = useDynamicSelector(\r\n    SalesRecord.getIdentifier(\"GetAll\")\r\n  );\r\n  const [selectedBill, setSelectedBill] = useState<any>(null);\r\n  const [isDrawerOpen, setIsDrawerOpen] = useState(false);\r\n  const [billViewVisible, setBillViewVisible] = useState(false);\r\n  const [form] = Form.useForm();\r\n  const [searchText, setSearchText] = useState(\"\");\r\n  const [pagination, setPagination] = useState({\r\n    current: 1,\r\n    pageSize: 10,\r\n  });\r\n  const [printModalVisible, setPrintModalVisible] = useState(false);\r\n  const [printBill, setPrintBill] = useState<any>(null);\r\n  const [emailModalVisible, setEmailModalVisible] = useState(false);\r\n  const [selectedBillForEmail, setSelectedBillForEmail] = useState<any>(null);\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  useHandleApiResponse({\r\n    action: \"delete\",\r\n    title: \"Sale\",\r\n    identifier: SalesRecord.getIdentifier(\"Delete\"),\r\n    entityApi: SalesRecord,\r\n  });\r\n\r\n  const handleDelete = async (id: string) => {\r\n    try {\r\n      await SalesRecord(\"Delete\", {}, id);\r\n      // You can add extra logic here if needed (e.g., refresh list, close modal)\r\n    } catch (error) {\r\n      // Optionally handle error here if needed, but notification is handled by the hook\r\n    }\r\n  };\r\n\r\n  const handleView = (record: any) => {\r\n    setSelectedBill(record);\r\n    form.setFieldsValue({\r\n      ...record,\r\n      date: dayjs(record.date),\r\n    });\r\n    setIsDrawerOpen(true);\r\n  };\r\n\r\n  const handleEmail = (record: any) => {\r\n    setSelectedBillForEmail(record);\r\n    setEmailModalVisible(true);\r\n  };\r\n\r\n  const handlePrint = (record: any) => {\r\n    // Map the sales record to the template's expected format\r\n    const billData = {\r\n      customerName: record.customerDetails?.full_name || '',\r\n      customerAddress: record.customerDetails?.address || '',\r\n      date: record.date,\r\n      invoice_no: record.invoice_no,\r\n      items: (record.Items || []).map((item: any) => ({\r\n        name: [\r\n          item.productItems?.name || item.product_name || '',\r\n          item.productItems?.VariantItem?.variant_name || '',\r\n        ].filter(Boolean).join(' '),\r\n        qty: item.qty,\r\n        price: item.price,\r\n        mrp:item.mrp,\r\n        amount: item.amount,\r\n      })),\r\n      total: record.total_amount || 0,\r\n      total_gst: record.total_gst || 0,\r\n      discount: record.discount || 0,\r\n      discount_type: record.discount_type || '',\r\n      gst_number: record.gst_number || record.organisationItems?.gst_number || '',\r\n    };\r\n    setPrintBill(billData);\r\n    setPrintModalVisible(true);\r\n  };\r\n\r\n  const handleSearch = (value: string) => {\r\n    setSearchText(value);\r\n    setPagination({ ...pagination, current: 1 }); // Reset to first page on search\r\n    SalesRecord(\"GetAll\", {\r\n      pageNumber: 1,\r\n      pageLimit: pagination.pageSize,\r\n      searchString: value,\r\n    });\r\n  };\r\n\r\n  const handlePaginationChange = (pageNumber: number, pageLimit: number) => {\r\n    setPagination({ current: pageNumber, pageSize: pageLimit });\r\n    SalesRecord(\"GetAll\", {\r\n      pageNumber,\r\n      pageLimit,\r\n      searchString: searchText,\r\n    });\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      title: \"Invoice\",\r\n      dataIndex: \"invoice_no\",\r\n      key: \"invoice_no\",\r\n      render: (text: string) => (\r\n        <Tag icon={<FileTextOutlined />} color=\"blue\">\r\n          {text}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: \"Date\",\r\n      dataIndex: \"date\",\r\n      key: \"date\",\r\n      render: (text: string) => (\r\n        <Tooltip title={dayjs(text).format(\"MMMM D, YYYY\")}>\r\n          <Tag icon={<CalendarOutlined />} color=\"purple\">\r\n            {dayjs(text).format(\"DD MMM YY\")}\r\n          </Tag>\r\n        </Tooltip>\r\n      ),\r\n    },\r\n    {\r\n      title: \"Customer\",\r\n      dataIndex: \"customerDetails\",\r\n      key: \"customerDetails\",\r\n      render: (customerDetails: any) => (\r\n        <Space>\r\n          <UserOutlined />\r\n          <span>\r\n            <strong>{customerDetails?.full_name}</strong>\r\n            <br />\r\n            <small style={{ color: \"#999\" }}>{customerDetails?.mobile}</small>\r\n          </span>\r\n        </Space>\r\n      ),\r\n    },\r\n    {\r\n      title: \"Payment Mode\",\r\n      dataIndex: \"payment_mode\",\r\n      key: \"payment_mode\",\r\n      render: (mode: string) => {\r\n        const color =\r\n          mode === \"cash\" ? \"green\" : mode === \"upi\" ? \"geekblue\" : \"orange\";\r\n        return (\r\n          <Tag icon={<CreditCardOutlined />} color={color}>\r\n            {mode.toUpperCase()}\r\n          </Tag>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      title: \"Total\",\r\n      dataIndex: \"total_amount\",\r\n      key: \"total_amount\",\r\n      render: (amount: number) => (\r\n        <Tag icon={<DollarOutlined />} color=\"gold\">\r\n           {Number(amount).toFixed(2)}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: \"Actions\",\r\n      key: \"actions\",\r\n      render: (_: any, record: any) => (\r\n        <Space size=\"middle\">\r\n          <Tooltip title=\"View Bill\">\r\n            <Button\r\n              type=\"link\"\r\n              icon={<EyeOutlined />}\r\n              onClick={() => handleView(record)}\r\n            />\r\n          </Tooltip>\r\n          <Tooltip title=\"Send via Email\">\r\n            <Button\r\n              type=\"link\"\r\n              icon={<MailOutlined />}\r\n              onClick={() => handleEmail(record)}\r\n            />\r\n          </Tooltip>\r\n          <Tooltip title=\"Print\">\r\n            <Button\r\n              type=\"link\"\r\n              icon={<PrinterOutlined />}\r\n              onClick={() => handlePrint(record)}\r\n            />\r\n          </Tooltip>\r\n          <Popconfirm\r\n            title=\"Are you sure to delete this bill?\"\r\n            onConfirm={() => handleDelete(record._id)}\r\n            okText=\"Yes\"\r\n            cancelText=\"No\"\r\n          >\r\n            <Tooltip title=\"Delete\">\r\n              <Button type=\"link\" icon={<DeleteOutlined />} danger />\r\n            </Tooltip>\r\n          </Popconfirm>\r\n        </Space>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  useEffect(() => {\r\n    SalesRecord(\"GetAll\", {\r\n      pageNumber: pagination.current,\r\n      pageLimit: pagination.pageSize,\r\n      searchString: searchText,\r\n    });\r\n  }, [SalesRecord]);\r\n\r\n  return (\r\n    <div style={{ padding: 24 }}>\r\n      <div\r\n        style={{\r\n          display: \"flex\",\r\n          justifyContent: \"space-between\",\r\n          alignItems: \"center\",\r\n          marginBottom: 16,\r\n        }}\r\n      >\r\n        <Title level={3} style={{ color: \"#1890ff\", margin: 0 }}>\r\n          Sales List\r\n        </Title>\r\n        <Space>\r\n          <Input\r\n            placeholder=\"Search by invoice no, customer name or mobile\"\r\n            prefix={<SearchOutlined />}\r\n            allowClear\r\n            style={{ width: 300 }}\r\n            onChange={(e) => handleSearch(e.target.value)}\r\n          />\r\n          <Button\r\n            type=\"primary\"\r\n            icon={<PlusOutlined />}\r\n            onClick={() => {\r\n              setSelectedBill(null);\r\n              setIsDrawerOpen(true);\r\n            }}\r\n          >\r\n            Create New Sale\r\n          </Button>\r\n        </Space>\r\n      </div>\r\n\r\n      <GlobalTable\r\n        data={SalesRecordList?.result}\r\n        columns={columns}\r\n        loading={loading}\r\n        bordered\r\n        rowKey=\"_id\"\r\n        totalCount={SalesRecordList?.pagination?.totalCount || 0}\r\n        pageLimit={SalesRecordList?.pagination?.pageLimit || 10}\r\n        onPaginationChange={handlePaginationChange}\r\n      />\r\n\r\n      <GlobalDrawer\r\n        title={selectedBill ? \"Edit Sale\" : \"Create New Sale\"}\r\n        onClose={() => setIsDrawerOpen(false)}\r\n        open={isDrawerOpen}\r\n        width={1200}\r\n      >\r\n        <BillDataGrid\r\n          billdata={selectedBill}\r\n          onSuccess={() => {\r\n            setIsDrawerOpen(false);\r\n            SalesRecord(\"GetAll\");\r\n          }}\r\n        />\r\n      </GlobalDrawer>\r\n\r\n      {selectedBill && (\r\n        <BillViewModal\r\n          visible={billViewVisible}\r\n          onClose={() => setBillViewVisible(false)}\r\n          billData={selectedBill}\r\n        />\r\n      )}\r\n\r\n      {/* Print Modal for Bill Template */}\r\n      <Modal\r\n        open={printModalVisible}\r\n        onCancel={() => setPrintModalVisible(false)}\r\n        footer={[\r\n          <Button key=\"print\" type=\"primary\" onClick={() => window.print()}>\r\n            Print\r\n          </Button>,\r\n          <Button key=\"close\" onClick={() => setPrintModalVisible(false)}>\r\n            Close\r\n          </Button>,\r\n        ]}\r\n        width={800}\r\n        title={printBill ? `Print Invoice #${printBill.invoice_no}` : 'Print Invoice'}\r\n        centered\r\n      >\r\n        {printBill && (() => {\r\n          const key = localStorage.getItem('billingTemplate');\r\n          const selectedTemplate: 'classic' | 'modern' = (key === 'modern' || key === 'classic') ? key : 'classic';\r\n          const TemplateComponent = billingTemplates[selectedTemplate].component;\r\n          return <TemplateComponent billData={printBill} />;\r\n        })()}\r\n      </Modal>\r\n\r\n      {/* Email Send Modal */}\r\n      <EmailSendModal\r\n        visible={emailModalVisible}\r\n        onClose={() => {\r\n          setEmailModalVisible(false);\r\n          setSelectedBillForEmail(null);\r\n        }}\r\n        billData={selectedBillForEmail}\r\n        customerEmail={selectedBillForEmail?.customerDetails?.email}\r\n        customerName={selectedBillForEmail?.customerDetails?.full_name}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillListPage;"],"names":["Title","Text","Typography","_ref","_billFormData$items$s","billdata","onSuccess","getEntityApi","useApiActions","ProductsApi","useCallback","stock","productItem","_productItem$VariantI","VariantItem","pack_size","isValid","expectedLoose","totalAvailable","packSize","parseInt","availablePackQty","available_quantity","availableLooseQty","available_loose_quantity","CustomerApi","BillingUsersApi","StockAuditApi","BranchStock","SalesRecord","InvoiceNumberApi","items","productList","loading","productLoading","useDynamicSelector","getIdentifier","customerList","customerLoading","userList","userLoading","stockAuditList","stockLoading","branchStockList","branchStockLoading","invoice_no_item","invoice_no_create_item","invoice_no_create_loading","saleCreateLoading","billFormData","setBillFormData","useState","invoice_no","date","dayjs","format","customer_id","customer_name","billed_by_id","billed_by_name","payment_mode","billSettings","setBillSettings","isPaid","isPartiallyPaid","isRetail","isGstIncluded","discount","discountType","paidAmount","stockModalRowIndex","setStockModalRowIndex","externalEditingCell","setExternalEditingCell","customerModalVisible","setCustomerModalVisible","userModalVisible","setUserModalVisible","saveConfirmationVisible","setSaveConfirmationVisible","billListDrawerVisible","setBillListDrawerVisible","savedBillData","setSavedBillData","productDetailsModalVisible","setProductDetailsModalVisible","selectedProductId","setSelectedProductId","productSelectionModalVisible","setProductSelectionModalVisible","productSelectionRowIndex","setProductSelectionRowIndex","lastInteractedRowIndex","setLastInteractedRowIndex","user","useMemo","getCurrentUser","branchId","branch_id","validateStockQuantity","stockId","qty","looseQty","_stockList$result","_stock$ProductItem","_stock$ProductItem$Va","stockList","result","find","s","_id","maxLooseQty","message","ProductItem","packSizeNum","concat","remainingPacks","handleQuantityChange","rowIndex","field","value","newItems","item","stock_id","_objectSpread","prev","newQty","newLooseQty","loose_qty","validation","error","useEffect","_billdata$customerDet","_billdata$billedByDet","_billdata$Items","_billdata$is_paid","_billdata$is_partiall","_billdata$is_gst_incl","_billdata$discount","_billdata$discount_ty","_billdata$paid_amount","customerDetails","full_name","billedByDetails","name","Items","map","_item$productItems","_item$productItems2","_item$productItems2$V","product_id","product_name","productItems","variant_name","branch_stock_id","price","mrp","amount","tax_percentage","is_paid","is_partially_paid","sale_type","is_gst_included","discount_type","paid_amount","_invoice_no_item$resu","length","defaultItems","Array","fill","_","index","batch_no","currentUserInList","u","productOptions","_productList$result","product","_product$VariantItem","label","trim","customerOptions","_customerList$result","customer","mobile","userOptions","_userList$result","options","_user$roleItems","roleItems","headerColumns","key","title","dataIndex","type","required","width","render","record","selectedCustomer","opt","_jsx","Tooltip","children","_jsxs","style","display","alignItems","justifyContent","cursor","padding","borderRadius","border","backgroundColor","transition","onClick","onMouseEnter","e","currentTarget","borderColor","onMouseLeave","fontSize","color","selectedUser","headerData","itemColumns","selectedProduct","placement","minHeight","fontWeight","gap","marginTop","editable","_stockList$result2","_stock$ProductItem2","_stock$ProductItem2$V","isLowStock","isOutOfStock","warning","flex","whiteSpace","_Fragment","_stockList$result3","isExceedingStock","position","InputNumber","min","max","undefined","onPressEnter","target","newValue","onBlur","onChange","_stockList$result4","_stock$ProductItem3","_stock$ProductItem3$V","disabled","qtyColIndex","findIndex","col","billCalculations","calculateBillTotals","sub_total","value_of_goods","total_gst","cgst","sgst","total_amount","discountValue","handleHeaderChange","headerRows","updatedHeader","_customerList$result2","_userList$result2","c","handleItemsChange","updatedItems","_productOptions$find","billItem","_stockList$result5","_stock$ProductItem4","_stock$ProductItem4$V","_stockList$result6","availableStocks","filter","_stock$ProductItem5","firstStock","setTimeout","qtyCell","document","querySelector","focus","_stockList$result7","_stock$ProductItem6","_stock$ProductItem6$V","_productList$result2","_product$CategoryItem","_product$VariantItem2","sellPrice","sell_price","looseRate","baseAmount","p","taxPercentage","CategoryItem","handleProductSelect","console","id","selling_price","handleF5ProductSelection","info","openProductModalForRow","targetRowIndex","activeElement","focusedRow","closest","getAttribute","focusedCell","row","handleAddItem","autoOpenProductModal","success","handleF7StockSelection","_billFormData$items$r","rowIndexNum","handleCustomerSelect","handleUserSelect","handleNewBill","resetBill","showMessage","arguments","handleClearBill","forceResolveProductNamesAndStock","hasChanges","updated","_product$VariantItem6","includes","_item$batch_no","newItem","handleSaveBill","async","some","stockValidationErrors","forEach","push","join","payload","_response","response","statusCode","savedData","createItems","createError","updateItems","useHandleApiResponse","action","identifier","entityApi","_product$VariantItem7","interval","setInterval","clearInterval","handleKeyDown","preventDefault","productCell","ctrlKey","test","input","dispatchEvent","Event","bubbles","addEventListener","removeEventListener","className","styles","mainContainer","backgroundCircle1","backgroundCircle2","backgroundCircle3","backgroundCircle4","backgroundCircle5","headerContainer","headerCircle1","headerCircle2","headerCircle3","headerCircle4","headerCircle5","headerContent","titleSection","titleIcon","FileTextOutlined","level","titleText","subtitleText","controlsSection","controlGroup","saleTypeControl","controlLabel","Switch","checkedChildren","unCheckedChildren","checked","saleTypeSwitch","size","gstControl","gstSwitch","paymentControl","paymentSwitch","partialPaymentControl","partialPaymentSwitch","badgesContainer","itemsBadge","badgeText","amountBadge","toFixed","invoiceDetailsGrid","AntdEditableTable","columns","dataSource","onSave","allowAdd","allowDelete","rowKey","itemsSection","itemsCircle1","itemsCircle2","billItemsGrid","billItemsHeader","billItemsTitle","Badge","count","showZero","billItemsBadge","toString","onAdd","onDelete","indices","onProductSelect","billSummary","summaryCircle1","summaryCircle2","summaryHeader","summaryTitle","summaryTable","summaryRow","summaryLabel","summaryValue","totalAmountRow","totalAmountLabel","totalAmountValue","partialPaymentInfo","partialPaymentRow","partialPaymentLabel","partialPaymentValue","controlsContainer","discountControl","discountControlLabel","discountControlInputs","partialPaymentControlLabel","formatter","replace","parser","Number","actionHub","actionHubCircle1","actionHubCircle2","actionHubCircle3","actionHubCircle4","actionButtonsContainer","Button","icon","SaveOutlined","saveButton","billListButton","ClearOutlined","clearButton","PrinterOutlined","printButton","background","zIndex","boxShadow","textAlign","lineHeight","StockSelectionModal","visible","onSelect","invoice_id","onCancel","productId","CustomerSelectionModal","UserSelectionModal","BillSaveConfirmationModal","onNewBill","onContinueBill","handleContinueBill","ProductDetailsModal","ProductSelectionModal","_product$VariantItem3","BillListDrawer","onClose","onViewBill","bill","_bill$customerDetails","_bill$customer","_bill$is_paid","_bill$is_partially_pa","_bill$is_gst_included","currentStockList","isArray","sales_items","mappedItems","_item$productItems3","_item$product","productName","variantName","_item$productItems$Va","_item$product$Variant","_productList$result3","_product$VariantItem4","foundProduct","itemIndex","i","_foundProduct$Variant","batchNo","_stockList$result8","foundStock","customerId","customerName","_customerList$result3","formattedDate","finalMappedItems","_product$VariantItem5","TextArea","Input","_billData$customerDet2","billData","customerEmail","form","Form","useForm","setLoading","previewMode","setPreviewMode","emailPreview","setEmailPreview","sending","setSending","sendSuccess","setSendSuccess","setFieldsValue","to","subject","generateInvoiceText","invoiceData","_invoiceData$customer","_invoiceData$Items","Date","toLocaleDateString","generateInvoiceHTML","_invoiceData$customer2","_invoiceData$customer3","_invoiceData$Items2","handleSendEmail","token","sessionStorage","getItem","csrfToken","fetch","process","method","headers","body","JSON","stringify","values","customMessage","json","handleSubmit","validateFields","then","handleClose","resetFields","Modal","MailOutlined","open","footer","destroyOnClose","CheckCircleOutlined","getFieldValue","layout","onFinish","Item","rules","prefix","placeholder","rows","Divider","Space","EyeOutlined","_billData$customerDet","preview","text","html","SendOutlined","htmlType","dangerouslySetInnerHTML","__html","dirty","DOMPurify","sanitize","ALLOWED_TAGS","ALLOWED_ATTR","ALLOW_DATA_ATTR","Alert","description","strong","showIcon","_billData$customerDet3","_billData$customerDet4","printFrameRef","useRef","emailModalVisible","setEmailModalVisible","formatAmount","shopDetails","margin","handlePrint","content","itemName","iframe","current","contentWindow","write","close","window","event","data","marginBottom","code","Table","pagination","bordered","summary","Summary","Row","Cell","colSpan","ref","EmailSendModal","email","tableHeaderStyle","borderBottom","tableCellStyle","billingTemplates","classic","component","_userItem$organisatio","_userItem$branchItems","_userItem$organisatio2","_billData$items","userItem","useUser","fontFamily","maxWidth","organisationItems","org_name","branchItems","address1","gst_number","substring","toUpperCase","borderTop","borderCollapse","idx","total","previewImg","modern","_userItem$branchItems2","paddingBottom","branch_name","customerAddress","BillListPage","_SalesRecordList$pagi","_SalesRecordList$pagi2","_selectedBillForEmail","_selectedBillForEmail2","SalesRecordList","selectedBill","setSelectedBill","isDrawerOpen","setIsDrawerOpen","billViewVisible","setBillViewVisible","searchText","setSearchText","setPagination","pageSize","printModalVisible","setPrintModalVisible","printBill","setPrintBill","selectedBillForEmail","setSelectedBillForEmail","useDispatch","Tag","CalendarOutlined","UserOutlined","mode","CreditCardOutlined","DollarOutlined","handleView","handleEmail","_record$customerDetai","_record$customerDetai2","_record$organisationI","address","Boolean","Popconfirm","onConfirm","handleDelete","okText","cancelText","DeleteOutlined","danger","pageNumber","pageLimit","searchString","SearchOutlined","allowClear","handleSearch","PlusOutlined","GlobalTable","totalCount","onPaginationChange","handlePaginationChange","GlobalDrawer","BillDataGrid","BillViewModal","print","centered","localStorage","TemplateComponent"],"sourceRoot":""}