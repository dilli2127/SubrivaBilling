{"version":3,"file":"static/js/12.ffc83f33.chunk.js","mappings":"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","sources":["components/common/handleApiResponse.ts","hooks/useTemplateSettings.ts","pages/RetaillBill/components/ProductSelectionModal.tsx","pages/RetaillBill/components/StockSelectionModal.tsx","components/common/AntdEditableTable.tsx","pages/RetaillBill/hooks/useBillCalculations.ts","helpers/amount_calculations.ts","pages/RetaillBill/hooks/useAdvancedBilling.ts","pages/RetaillBill/hooks/useBillData.ts","pages/RetaillBill/hooks/useBillForm.ts","pages/RetaillBill/hooks/useBillModals.ts","pages/RetaillBill/hooks/useBillItems.ts","pages/RetaillBill/hooks/useBillActions.ts","pages/RetaillBill/hooks/useBillKeyboardShortcuts.ts","pages/RetaillBill/components/DocumentTypeToggle.tsx","webpack://SUBRIVA-BILLING/./src/pages/RetaillBill/components/BillDataGrid.module.css?232c","pages/RetaillBill/components/BillTopBar.tsx","pages/RetaillBill/components/BillHeader.tsx","pages/RetaillBill/components/BillSummary.tsx","pages/RetaillBill/components/CustomerSelectionModal.tsx","pages/RetaillBill/components/VendorSelectionModal.tsx","pages/RetaillBill/components/UserSelectionModal.tsx","pages/RetaillBill/components/BillSaveConfirmationModal.tsx","pages/RetaillBill/components/BillListDrawer.tsx","pages/RetaillBill/components/ProductDetailsModal.tsx","pages/RetaillBill/components/BillDataGrid.tsx","hooks/useGenericCrudRTK.ts","components/common/useHandleApiResponse.ts","helpers/Common_functions.ts"],"sourcesContent":["import { showToast } from \"../../helpers/Common_functions\";\r\n\r\ntype ActionType = \"create\" | \"update\" | \"delete\";\r\n\r\ninterface ApiResponseHandlerParams {\r\n  action: ActionType;\r\n  success: boolean;\r\n  title: string;\r\n  getAllItems?: () => void;\r\n  resetForm?: () => void;\r\n  errorMessage?: string;\r\n}\r\n\r\nexport const handleApiResponse = ({\r\n  action,\r\n  success,\r\n  title,\r\n  getAllItems,\r\n  resetForm,\r\n  errorMessage,\r\n}: ApiResponseHandlerParams) => {\r\n  if (success) {\r\n    showToast(\"success\", `${title} ${action}d successfully`);\r\n    getAllItems?.();\r\n    resetForm?.();\r\n    // RTK Query handles cache invalidation automatically, no need for manual clearing\r\n  } else {\r\n    showToast(\"error\", errorMessage || `Failed to ${action} ${title}`);\r\n  }\r\n};\r\n","import { useMemo } from 'react';\r\nimport { apiSlice } from '../services/redux/api/apiSlice';\r\nimport { getCurrentUser } from '../helpers/auth';\r\nimport { getBillTemplate, getInvoiceTemplate, BillTemplateKey, InvoiceTemplateKey } from '../pages/RetaillBill/templates/registry';\r\n\r\n/**\r\n * Hook to get selected templates from settings\r\n * Returns the template components based on user's settings\r\n */\r\nexport const useTemplateSettings = () => {\r\n  const userItem = useMemo(() => getCurrentUser(), []);\r\n  const organisationId = userItem?.organisation_id || userItem?.organisationItems?._id;\r\n\r\n  // Fetch settings for current organisation\r\n  const { data: settingsData, isLoading } = apiSlice.useGetSettingsQuery(\r\n    { organisation_id: organisationId, page: 1, limit: 1 },\r\n    { \r\n      skip: !organisationId,\r\n      refetchOnMountOrArgChange: false\r\n    }\r\n  );\r\n\r\n  const settings = useMemo(() => {\r\n    const settingsResult = (settingsData as any)?.result || settingsData || {};\r\n    return Array.isArray(settingsResult) ? settingsResult[0] : settingsResult;\r\n  }, [settingsData]);\r\n\r\n  // Get selected template keys from API (no defaults - use actual API values)\r\n  // getBillTemplate/getInvoiceTemplate have built-in fallbacks to 'classic' if key is invalid\r\n  const billTemplateKey = (settings?.bill_template || 'classic') as BillTemplateKey;\r\n  const invoiceTemplateKey = (settings?.invoice_template || 'classic') as InvoiceTemplateKey;\r\n\r\n  // Get template components (these functions handle invalid keys gracefully)\r\n  const BillTemplateComponent = getBillTemplate(billTemplateKey);\r\n  const InvoiceTemplateComponent = getInvoiceTemplate(invoiceTemplateKey);\r\n\r\n  return {\r\n    // Template components ready to use\r\n    BillTemplateComponent,\r\n    InvoiceTemplateComponent,\r\n    \r\n    // Template keys\r\n    billTemplateKey,\r\n    invoiceTemplateKey,\r\n    \r\n    // Loading state\r\n    isLoading,\r\n    \r\n    // Settings data (if you need other settings)\r\n    settings,\r\n  };\r\n};\r\n\r\n","import React, { useEffect, useState, FC, KeyboardEvent, useRef } from 'react';\r\nimport { Modal, Table, Input, Button, Space, message } from 'antd';\r\nimport type { InputRef } from 'antd/es/input';\r\nimport { BarcodeOutlined, ScanOutlined } from '@ant-design/icons';\r\nimport type { ColumnType } from 'antd/es/table';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\nimport BarcodeScanner from '../../../components/common/BarcodeScanner';\r\n\r\nconst { Search } = Input;\r\n\r\ninterface Product {\r\n  _id: string;\r\n  name?: string;\r\n  sku?: string;\r\n  selling_price?: number;\r\n  hsn_code?: string;\r\n  hsn_sac?: string;\r\n  VariantItem?: {\r\n    variant_name?: string;\r\n    variant_code?: string;\r\n    hsn_code?: string;\r\n  };\r\n  CategoryItem?: {\r\n    category_name?: string;\r\n    tax_percentage?: number;\r\n  };\r\n}\r\n\r\ninterface ProductSelectionModalProps {\r\n  visible: boolean;\r\n  products?: Product[]; // Optional - if not provided, will load from API\r\n  onSelect: (product: Product) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst ProductSelectionModal: FC<ProductSelectionModalProps> = ({\r\n  visible,\r\n  products: providedProducts,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [debouncedSearch, setDebouncedSearch] = useState('');\r\n  const [page, setPage] = useState(1);\r\n  const [allProducts, setAllProducts] = useState<Product[]>([]);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [selectedRowKey, setSelectedRowKey] = useState<React.Key | null>(null);\r\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\r\n  const [scannerVisible, setScannerVisible] = useState(false);\r\n  const searchInputRef = useRef<InputRef>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isLoadingMoreRef = useRef(false);\r\n\r\n  // Only load from API if products not provided\r\n  const shouldLoadFromAPI = !providedProducts || providedProducts.length === 0;\r\n\r\n  // Use RTK Query for products with pagination and search (only if not provided)\r\n  const { data: productsData, isLoading: loading } = apiSlice.useGetProductQuery({\r\n    searchString: debouncedSearch,\r\n    page: page,\r\n    limit: 10,\r\n  }, {\r\n    skip: !visible || !shouldLoadFromAPI,\r\n    refetchOnMountOrArgChange: true,\r\n  });\r\n\r\n  // Accumulate products for infinite scroll (only if loading from API)\r\n  useEffect(() => {\r\n    // Only process when modal is visible and loading from API\r\n    if (!visible || !shouldLoadFromAPI) return;\r\n    \r\n    if (productsData) {\r\n      const newItems = (productsData as any)?.result || [];\r\n      const totalCount = (productsData as any).pagination?.totalCount || (productsData as any).pagination?.total || 0;\r\n      \r\n      if (page === 1) {\r\n        setAllProducts(newItems);\r\n        setHasMore(newItems.length < totalCount && newItems.length > 0);\r\n      } else {\r\n        setAllProducts(prev => {\r\n          const existingIds = new Set(prev.map((item: any) => item._id));\r\n          const uniqueNewItems = newItems.filter((item: any) => !existingIds.has(item._id));\r\n          const updated = [...prev, ...uniqueNewItems];\r\n          setHasMore(updated.length < totalCount && uniqueNewItems.length > 0);\r\n          return updated;\r\n        });\r\n      }\r\n      \r\n      isLoadingMoreRef.current = false;\r\n    }\r\n  }, [productsData, page, shouldLoadFromAPI, visible]);\r\n\r\n  // Use provided products OR loaded products\r\n  const sourceProducts = providedProducts || allProducts;\r\n\r\n  // Client-side filtering (fast when using provided products)\r\n  const filteredProducts: Product[] = sourceProducts?.filter((p: Product) => {\r\n    if (!searchTerm) return true;\r\n    const searchLower = searchTerm.toLowerCase();\r\n    return (\r\n      (p.name?.toLowerCase() || '').includes(searchLower) ||\r\n      (p.sku?.toLowerCase() || '').includes(searchLower) ||\r\n      p.VariantItem?.variant_name?.toLowerCase().includes(searchLower) ||\r\n      p.VariantItem?.variant_code?.toLowerCase().includes(searchLower) ||\r\n      (p.selling_price?.toString() || '').includes(searchLower)\r\n    );\r\n  }).sort((a: Product, b: Product) => {\r\n    // Prioritize exact matches and matches at the beginning\r\n    const searchLower = searchTerm.toLowerCase();\r\n    \r\n    // Check for exact matches first\r\n    const aExactMatch = (a.name?.toLowerCase() || '') === searchLower || \r\n                        a.VariantItem?.variant_name?.toLowerCase() === searchLower ||\r\n                        (a.sku?.toLowerCase() || '') === searchLower;\r\n    const bExactMatch = (b.name?.toLowerCase() || '') === searchLower || \r\n                        b.VariantItem?.variant_name?.toLowerCase() === searchLower ||\r\n                        (b.sku?.toLowerCase() || '') === searchLower;\r\n    \r\n    if (aExactMatch && !bExactMatch) return -1;\r\n    if (!aExactMatch && bExactMatch) return 1;\r\n    \r\n    // Then check for matches at the beginning\r\n    const aStartsWith = (a.name?.toLowerCase() || '').startsWith(searchLower) || \r\n                        a.VariantItem?.variant_name?.toLowerCase().startsWith(searchLower) ||\r\n                        (a.sku?.toLowerCase() || '').startsWith(searchLower);\r\n    const bStartsWith = (b.name?.toLowerCase() || '').startsWith(searchLower) || \r\n                        b.VariantItem?.variant_name?.toLowerCase().startsWith(searchLower) ||\r\n                        (b.sku?.toLowerCase() || '').startsWith(searchLower);\r\n    \r\n    if (aStartsWith && !bStartsWith) return -1;\r\n    if (!aStartsWith && bStartsWith) return 1;\r\n    \r\n    return 0;\r\n  }) || [];\r\n\r\n  // Debounce search (only for API mode)\r\n  useEffect(() => {\r\n    if (!shouldLoadFromAPI || !visible) return;\r\n\r\n    // Skip if value hasn't changed (prevents clearing immediately on open)\r\n    if (searchTerm === debouncedSearch) return;\r\n    \r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n    \r\n    searchTimeoutRef.current = setTimeout(() => {\r\n      setDebouncedSearch(searchTerm);\r\n      setPage(1);\r\n      setAllProducts([]);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    }, 300);\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [searchTerm, debouncedSearch, shouldLoadFromAPI, visible]);\r\n\r\n  useEffect(() => {\r\n    setHighlightedIndex(0);\r\n    if (filteredProducts.length > 0) {\r\n      setSelectedRowKey(filteredProducts[0]._id);\r\n    } else {\r\n      setSelectedRowKey(null);\r\n    }\r\n  }, [searchTerm, filteredProducts.length]);\r\n\r\n  // Reset when modal opens/closes (only run on visibility change)\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n      }, 100);\r\n      \r\n      // Only reset if loading from API\r\n      if (shouldLoadFromAPI) {\r\n        setPage(1);\r\n        setHasMore(true);\r\n        isLoadingMoreRef.current = false;\r\n      }\r\n    } else {\r\n      setSearchTerm('');\r\n      if (shouldLoadFromAPI) {\r\n        setDebouncedSearch('');\r\n        setPage(1);\r\n        setAllProducts([]);\r\n        setHasMore(true);\r\n        isLoadingMoreRef.current = false;\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [visible]); // Only depend on visible to avoid infinite loops\r\n\r\n  const columns: ColumnType<Product>[] = [\r\n    { \r\n      title: 'Product & Variant', \r\n      dataIndex: 'name', \r\n      key: 'name', \r\n      width: 250,\r\n      render: (name, record) => (\r\n        <div>\r\n          <div style={{ fontWeight: 600, color: '#1890ff' }}>{name}</div>\r\n          {record.VariantItem?.variant_name && (\r\n            <div style={{ fontSize: '12px', color: '#52c41a', marginTop: '2px' }}>\r\n              Variant: {record.VariantItem.variant_name}\r\n              {record.VariantItem?.variant_code && (\r\n                <span style={{ marginLeft: '8px', color: '#fa8c16', fontSize: '11px' }}>\r\n                  ({record.VariantItem.variant_code})\r\n                </span>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )\r\n    },\r\n    { title: 'Variant', dataIndex: 'VariantItem', key: 'variant', width: 120, \r\n      render: (variant) => variant?.variant_name ? (\r\n        <span style={{ color: '#52c41a', fontWeight: 500 }}>{variant.variant_name}</span>\r\n      ) : (\r\n        <span style={{ color: '#bfbfbf', fontStyle: 'italic' }}>No variant</span>\r\n      ) },\r\n    { title: 'SKU', dataIndex: 'sku', key: 'sku', width: 120 },\r\n    { title: 'Price', dataIndex: 'selling_price', key: 'selling_price', width: 100,\r\n      render: (price) => (\r\n        <span style={{ \r\n          color: '#52c41a', \r\n          fontWeight: 600, \r\n          fontSize: '14px' \r\n        }}>\r\n          {price?.toFixed(2) || '0.00'}\r\n        </span>\r\n      ) },\r\n  ];\r\n\r\n  const handleSelectRow = (product: Product) => {\r\n    onSelect(product);\r\n  };\r\n\r\n  // Handle barcode scan\r\n  const handleBarcodeScan = (barcode: string) => {\r\n    setSearchTerm(barcode);\r\n    setScannerVisible(false);\r\n    \r\n    // Try to find product by barcode/SKU\r\n    const foundProduct = sourceProducts?.find((p: Product) => {\r\n      const searchLower = barcode.toLowerCase();\r\n      return (\r\n        (p.sku?.toLowerCase() || '').includes(searchLower) ||\r\n        (p.name?.toLowerCase() || '').includes(searchLower) ||\r\n        p.VariantItem?.variant_code?.toLowerCase().includes(searchLower)\r\n      );\r\n    });\r\n\r\n    if (foundProduct) {\r\n      // Auto-select the found product\r\n      setTimeout(() => {\r\n        onSelect(foundProduct);\r\n      }, 500);\r\n      message.success(`Product found: ${foundProduct.name}`);\r\n    } else {\r\n      message.warning(`No product found with barcode: ${barcode}`);\r\n    }\r\n  };\r\n\r\n  const handleSearchKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!filteredProducts.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        const next = Math.min(prev + 1, filteredProducts.length - 1);\r\n        setSelectedRowKey(filteredProducts[next]._id);\r\n        return next;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        const prevIndex = Math.max(prev - 1, 0);\r\n        setSelectedRowKey(filteredProducts[prevIndex]._id);\r\n        return prevIndex;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedProduct = filteredProducts[highlightedIndex];\r\n      if (selectedProduct) {\r\n        handleSelectRow(selectedProduct);\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      onCancel();\r\n    }\r\n  };\r\n\r\n  // Auto-focus back to search input when clicking outside\r\n  const handleModalClick = () => {\r\n    searchInputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select Product & Variant (F5 to reopen anytime)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      width={900}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div onClick={handleModalClick}>\r\n        <Space.Compact style={{ marginBottom: 16, width: '100%' }}>\r\n          <Search\r\n            ref={searchInputRef}\r\n            placeholder=\"Search by product name, variant, SKU, or price (use  arrows to navigate, Enter to select)\"\r\n            onChange={e => setSearchTerm(e.target.value)}\r\n            style={{ flex: 1 }}\r\n            autoFocus\r\n            onKeyDown={handleSearchKeyDown}\r\n            onBlur={() => {\r\n              // Re-focus after a short delay to ensure it stays focused\r\n              setTimeout(() => {\r\n                if (visible) {\r\n                  searchInputRef.current?.focus();\r\n                }\r\n              }, 10);\r\n            }}\r\n            value={searchTerm}\r\n          />\r\n          <Button \r\n            type=\"primary\" \r\n            icon={<ScanOutlined />}\r\n            onClick={() => setScannerVisible(true)}\r\n            style={{ minWidth: 100 }}\r\n          >\r\n            Scan\r\n          </Button>\r\n        </Space.Compact>\r\n        {shouldLoadFromAPI ? (\r\n          <div\r\n            onScroll={(e: any) => {\r\n              const target = e.currentTarget;\r\n              const scrollTop = target.scrollTop;\r\n              const scrollHeight = target.scrollHeight;\r\n              const clientHeight = target.clientHeight;\r\n              const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\r\n              \r\n              if (scrollPercentage > 0.7 && hasMore && !loading && !isLoadingMoreRef.current) {\r\n                isLoadingMoreRef.current = true;\r\n                setPage(prev => prev + 1);\r\n              }\r\n            }}\r\n            style={{ maxHeight: 360, overflowY: 'auto' }}\r\n          >\r\n            <Table\r\n              dataSource={filteredProducts}\r\n              columns={columns}\r\n              loading={loading && filteredProducts.length === 0}\r\n              rowKey=\"_id\"\r\n              size=\"small\"\r\n              pagination={false}\r\n              onRow={(record, idx) => ({\r\n                onClick: () => {\r\n                  handleSelectRow(record);\r\n                  setTimeout(() => {\r\n                    searchInputRef.current?.focus();\r\n                  }, 10);\r\n                },\r\n                onDoubleClick: () => handleSelectRow(record),\r\n                className:\r\n                  idx === highlightedIndex\r\n                    ? 'ant-table-row ant-table-row-selected'\r\n                    : 'ant-table-row',\r\n                style: {\r\n                  backgroundColor: idx === highlightedIndex ? '#e6f7ff' : undefined,\r\n                  border: idx === highlightedIndex ? '2px solid #1890ff' : undefined,\r\n                },\r\n              })}\r\n              rowSelection={{\r\n                type: 'radio',\r\n                selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n                onChange: keys => {\r\n                  setSelectedRowKey(keys[0]);\r\n                  const idx = filteredProducts.findIndex(p => p._id === keys[0]);\r\n                  if (idx !== -1) setHighlightedIndex(idx);\r\n                },\r\n              }}\r\n              scroll={{ y: undefined }}\r\n            />\r\n            {hasMore && filteredProducts.length > 0 && (\r\n              <div style={{ textAlign: 'center', padding: '8px', color: '#999', borderTop: '1px solid #f0f0f0' }}>\r\n                {loading ? 'Loading more...' : 'Scroll for more products'}\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <Table\r\n            dataSource={filteredProducts}\r\n            columns={columns}\r\n            loading={false}\r\n            rowKey=\"_id\"\r\n            size=\"small\"\r\n            pagination={false}\r\n            onRow={(record, idx) => ({\r\n              onClick: () => {\r\n                handleSelectRow(record);\r\n                setTimeout(() => {\r\n                  searchInputRef.current?.focus();\r\n                }, 10);\r\n              },\r\n              onDoubleClick: () => handleSelectRow(record),\r\n              className:\r\n                idx === highlightedIndex\r\n                  ? 'ant-table-row ant-table-row-selected'\r\n                  : 'ant-table-row',\r\n              style: {\r\n                backgroundColor: idx === highlightedIndex ? '#e6f7ff' : undefined,\r\n                border: idx === highlightedIndex ? '2px solid #1890ff' : undefined,\r\n              },\r\n            })}\r\n            rowSelection={{\r\n              type: 'radio',\r\n              selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n              onChange: keys => {\r\n                setSelectedRowKey(keys[0]);\r\n                const idx = filteredProducts.findIndex(p => p._id === keys[0]);\r\n                if (idx !== -1) setHighlightedIndex(idx);\r\n              },\r\n            }}\r\n            scroll={{ y: 300 }}\r\n          />\r\n        )}\r\n        <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n          <strong>Keyboard Shortcuts:</strong>  Navigate products | Enter Select | Escape Cancel\r\n          <br />\r\n          <strong>Search:</strong> Product name, variant name, SKU, or price\r\n          <br />\r\n          <strong>Barcode Scanner:</strong> Click \"Scan\" button or use USB barcode scanner\r\n          <br />\r\n          <strong>Tip:</strong> Press F5 anytime to reopen this modal for product changes\r\n        </div>\r\n      </div>\r\n\r\n      {/* Barcode Scanner Modal */}\r\n      <BarcodeScanner\r\n        visible={scannerVisible}\r\n        onClose={() => setScannerVisible(false)}\r\n        onScan={handleBarcodeScan}\r\n        title=\"Scan Product Barcode\"\r\n        description=\"Scan barcode to find product automatically\"\r\n      />\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProductSelectionModal;\r\n","import React, { useEffect, useState, FC, KeyboardEvent, useRef } from 'react';\r\nimport { Modal, Table, Input, Tag, Tooltip, message } from 'antd';\r\nimport type { InputRef } from 'antd/es/input';\r\nimport type { ColumnType } from 'antd/es/table';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport SessionStorageEncryption from '../../../helpers/encryption';\r\nimport dayjs from 'dayjs';\r\nimport {\r\n  ExclamationCircleOutlined,\r\n  CheckCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport type { Stock } from '../../../types/entities';\r\n\r\nconst { Search } = Input;\r\n\r\ninterface StockSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (stock: {\r\n    id: string;\r\n    _id: string;\r\n    batch_no: string;\r\n    name: string;\r\n    code?: string;\r\n    available_quantity: number;\r\n    available_loose_quantity?: number;\r\n    sell_price: number;\r\n    ProductItem?: any;\r\n  }) => void;\r\n  onCancel: () => void;\r\n  productId: string;\r\n}\r\n\r\nconst StockSelectionModal: FC<StockSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n  productId, // <-- Destructure\r\n}) => {\r\n  // Resolve user role to decide which stock API to call\r\n  const userItem = getCurrentUser();\r\n  const scopeData = SessionStorageEncryption.getItem('scope');\r\n  const userRole = (\r\n    scopeData?.userType ||\r\n    userItem?.user_type ||\r\n    userItem?.usertype ||\r\n    userItem?.user_role ||\r\n    ''\r\n  ).toLowerCase();\r\n  const isOrganisationUser = userRole === 'organisationuser';\r\n  const isBranchUser = userRole === 'branchuser';\r\n\r\n  // Only fetch after a product is selected and modal is visible\r\n  const shouldFetch = !!productId && !!visible;\r\n\r\n  // Organisation users -> stock_audit\r\n  const { data: orgStocksData, isLoading: loadingOrg } =\r\n    apiSlice.useGetStockAuditQuery(\r\n      { product_id: productId },\r\n      {\r\n        skip: !shouldFetch || !isOrganisationUser,\r\n        refetchOnMountOrArgChange: true,\r\n        refetchOnFocus: true,\r\n        refetchOnReconnect: true,\r\n      }\r\n    );\r\n\r\n  // Branch users -> branch_stock\r\n  const { data: branchStocksData, isLoading: loadingBranch } =\r\n    apiSlice.useGetBranchStockQuery(\r\n      { product_id: productId },\r\n      {\r\n        skip: !shouldFetch || !isBranchUser,\r\n        refetchOnMountOrArgChange: true,\r\n        refetchOnFocus: true,\r\n        refetchOnReconnect: true,\r\n      }\r\n    );\r\n\r\n  const stocks = (\r\n    (isOrganisationUser\r\n      ? (orgStocksData as any)?.result\r\n      : isBranchUser\r\n      ? (branchStocksData as any)?.result\r\n      : []) || []\r\n  ) as Stock[];\r\n  const loading = loadingOrg || loadingBranch;\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedRowKey, setSelectedRowKey] = useState<React.Key | null>(null);\r\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(0);\r\n  const [errorMessage, setErrorMessage] = useState<string>('');\r\n  const tableBodyRef = useRef<HTMLDivElement>(null);\r\n  const searchInputRef = useRef<InputRef>(null);\r\n\r\n  // Helper function to check if stock is expired\r\n  const isStockExpired = (stock: Stock): boolean => {\r\n    return !!(stock.expiry_date && dayjs(stock.expiry_date).isBefore(dayjs()));\r\n  };\r\n\r\n  // Helper function to check if stock has zero quantity\r\n  const isStockOutOfStock = (stock: Stock): boolean => {\r\n    return stock.available_quantity <= 0;\r\n  };\r\n\r\n  // Helper function to show expired stock error message\r\n  const showExpiredStockError = (stock: Stock) => {\r\n    const expiryDate = dayjs(stock.expiry_date).format('DD/MM/YYYY');\r\n    const errorMsg = `Cannot select expired stock! This item expired on ${expiryDate}. Please select a valid stock item.`;\r\n    setErrorMessage(errorMsg);\r\n    message.error(errorMsg);\r\n\r\n    // Clear error message after 5 seconds\r\n    setTimeout(() => {\r\n      setErrorMessage('');\r\n    }, 5000);\r\n  };\r\n\r\n  // Helper function to show out of stock error message\r\n  const showOutOfStockError = (stock: Stock) => {\r\n    const errorMsg = `Cannot select out of stock item! This item has 0 available quantity. Please select a stock item with available quantity.`;\r\n    setErrorMessage(errorMsg);\r\n    message.error(errorMsg);\r\n\r\n    // Clear error message after 5 seconds\r\n    setTimeout(() => {\r\n      setErrorMessage('');\r\n    }, 5000);\r\n  };\r\n\r\n  const filteredStocks: Stock[] =\r\n    (Array.isArray(stocks) ? stocks : []).filter((s: Stock) => {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      return (\r\n        s.batch_no?.toLowerCase().includes(searchLower) ||\r\n        s.ProductItem?.name?.toLowerCase().includes(searchLower) ||\r\n        s.ProductItem?.VariantItem?.variant_name\r\n          ?.toLowerCase()\r\n          .includes(searchLower) ||\r\n        s.available_quantity?.toString().includes(searchLower) ||\r\n        s.sell_price?.toString().includes(searchLower)\r\n      );\r\n    });\r\n\r\n  // Show all stocks including expired ones, but disable selection of expired items\r\n  const allStocks = filteredStocks;\r\n\r\n  useEffect(() => {\r\n    setHighlightedIndex(0);\r\n    setErrorMessage(''); // Clear any existing error messages\r\n    if (allStocks.length > 0) {\r\n      // Find the first valid stock (not expired and not out of stock)\r\n      let firstValidIndex = 0;\r\n      while (\r\n        firstValidIndex < allStocks.length &&\r\n        ((allStocks[firstValidIndex].expiry_date &&\r\n          dayjs(allStocks[firstValidIndex].expiry_date).isBefore(dayjs())) ||\r\n          allStocks[firstValidIndex].available_quantity <= 0)\r\n      ) {\r\n        firstValidIndex++;\r\n      }\r\n      if (firstValidIndex < allStocks.length) {\r\n        setSelectedRowKey(allStocks[firstValidIndex]._id);\r\n        setHighlightedIndex(firstValidIndex);\r\n      } else {\r\n        setSelectedRowKey(null);\r\n      }\r\n    } else {\r\n      setSelectedRowKey(null);\r\n    }\r\n  }, [searchTerm, visible, stocks]);\r\n\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setErrorMessage(''); // Clear error messages when modal opens\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n      }, 0);\r\n    }\r\n  }, [visible]);\r\n\r\n  useEffect(() => {\r\n    if (tableBodyRef.current) {\r\n      const row = tableBodyRef.current.querySelector(\r\n        `.ant-table-row[data-row-key='${allStocks[highlightedIndex]?._id}']`\r\n      ) as HTMLElement;\r\n      row?.scrollIntoView({ block: 'nearest' });\r\n    }\r\n  }, [highlightedIndex, allStocks]);\r\n\r\n  // RTK Query automatically loads stocks on mount\r\n  // For product filtering, it's handled client-side from cached data\r\n  // TODO: Implement server-side product filtering with RTK Query if needed\r\n\r\n  const columns: ColumnType<Stock>[] = [\r\n    {\r\n      title: 'Product',\r\n      dataIndex: 'ProductItem',\r\n      key: 'product',\r\n      render: (ProductItem: any) => ProductItem?.name || 'N/A',\r\n    },\r\n    {\r\n      title: 'Variant',\r\n      dataIndex: 'ProductItem',\r\n      key: 'variant',\r\n      render: (ProductItem: any) =>\r\n        ProductItem?.VariantItem?.variant_name || 'N/A',\r\n    },\r\n    { title: 'Batch No', dataIndex: 'batch_no', key: 'batch_no' },\r\n    {\r\n      title: 'Available',\r\n      dataIndex: 'available_quantity',\r\n      key: 'available_quantity',\r\n      render: (available_quantity: number, record: Stock) => {\r\n        const isOutOfStock = available_quantity <= 0;\r\n        return (\r\n          <span\r\n            style={{\r\n              color: isOutOfStock ? '#ff4d4f' : '#52c41a',\r\n              fontWeight: isOutOfStock ? 'bold' : 'normal',\r\n            }}\r\n          >\r\n            {available_quantity}\r\n            {isOutOfStock && (\r\n              <ExclamationCircleOutlined\r\n                style={{ marginLeft: 4, color: '#ff4d4f' }}\r\n              />\r\n            )}\r\n          </span>\r\n        );\r\n      },\r\n    },\r\n    { title: 'Price', dataIndex: 'sell_price', key: 'sell_price' },\r\n    {\r\n      title: 'Expiry Date',\r\n      dataIndex: 'expiry_date',\r\n      key: 'expiry_date',\r\n      render: (expiry_date: string, record: Stock) => {\r\n        if (!expiry_date)\r\n          return <span style={{ color: '#999' }}>No Expiry</span>;\r\n\r\n        const expiryDate = dayjs(expiry_date);\r\n        const today = dayjs();\r\n        const isExpired = expiryDate.isBefore(today);\r\n        const daysUntilExpiry = expiryDate.diff(today, 'days');\r\n\r\n        let color = 'green';\r\n        let icon = <CheckCircleOutlined />;\r\n        let status = 'Valid';\r\n\r\n        if (isExpired) {\r\n          color = 'red';\r\n          icon = <ExclamationCircleOutlined />;\r\n          status = 'Expired';\r\n        } else if (daysUntilExpiry <= 30) {\r\n          color = 'orange';\r\n          icon = <ExclamationCircleOutlined />;\r\n          status = `Expires in ${daysUntilExpiry} days`;\r\n        }\r\n\r\n        return (\r\n          <Tooltip title={status}>\r\n            <Tag color={color} icon={icon}>\r\n              {expiryDate.format('DD/MM/YYYY')}\r\n            </Tag>\r\n          </Tooltip>\r\n        );\r\n      },\r\n    },\r\n  ];\r\n\r\n  const handleSelectRow = (stock: Stock) => {\r\n    // Check if stock is expired and show error message\r\n    if (isStockExpired(stock)) {\r\n      showExpiredStockError(stock);\r\n      return;\r\n    }\r\n\r\n    // Check if stock is out of stock and show error message\r\n    if (isStockOutOfStock(stock)) {\r\n      showOutOfStockError(stock);\r\n      return;\r\n    }\r\n\r\n    // Clear any existing error message\r\n    setErrorMessage('');\r\n\r\n    onSelect({\r\n      id: stock._id,\r\n      _id: stock._id,\r\n      batch_no: stock.batch_no,\r\n      name: stock.ProductItem?.name || stock.name || '',\r\n      code: stock.code,\r\n      available_quantity: stock.available_quantity,\r\n      available_loose_quantity: stock.available_loose_quantity,\r\n      sell_price: stock.sell_price,\r\n      ProductItem: stock.ProductItem, // Include ProductItem for pack_size\r\n    });\r\n  };\r\n\r\n  const handleSearchKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\r\n    if (!allStocks.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        let next = prev + 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          next < allStocks.length &&\r\n          ((allStocks[next].expiry_date &&\r\n            dayjs(allStocks[next].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[next].available_quantity <= 0)\r\n        ) {\r\n          next++;\r\n        }\r\n        const finalNext = Math.min(next, allStocks.length - 1);\r\n        setSelectedRowKey(allStocks[finalNext]._id);\r\n        return finalNext;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(prev => {\r\n        let prevIndex = prev - 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          prevIndex >= 0 &&\r\n          ((allStocks[prevIndex].expiry_date &&\r\n            dayjs(allStocks[prevIndex].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[prevIndex].available_quantity <= 0)\r\n        ) {\r\n          prevIndex--;\r\n        }\r\n        const finalPrev = Math.max(prevIndex, 0);\r\n        setSelectedRowKey(allStocks[finalPrev]._id);\r\n        return finalPrev;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedStock = allStocks[highlightedIndex];\r\n      if (selectedStock) {\r\n        handleSelectRow(selectedStock);\r\n        // Only close modal if selection was successful (not expired and not out of stock)\r\n        if (\r\n          !isStockExpired(selectedStock) &&\r\n          !isStockOutOfStock(selectedStock)\r\n        ) {\r\n          onCancel(); // Close the modal after selection\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleTableKeyDown = (e: KeyboardEvent<HTMLDivElement>) => {\r\n    if (!allStocks.length) return;\r\n\r\n    if (e.key === 'ArrowDown') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(i => {\r\n        let next = i + 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          next < allStocks.length &&\r\n          ((allStocks[next].expiry_date &&\r\n            dayjs(allStocks[next].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[next].available_quantity <= 0)\r\n        ) {\r\n          next++;\r\n        }\r\n        const finalNext = Math.min(next, allStocks.length - 1);\r\n        setSelectedRowKey(allStocks[finalNext]._id);\r\n        return finalNext;\r\n      });\r\n      // Keep focus on search input\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'ArrowUp') {\r\n      e.preventDefault();\r\n      setHighlightedIndex(i => {\r\n        let prev = i - 1;\r\n        // Skip over expired and out-of-stock items\r\n        while (\r\n          prev >= 0 &&\r\n          ((allStocks[prev].expiry_date &&\r\n            dayjs(allStocks[prev].expiry_date).isBefore(dayjs())) ||\r\n            allStocks[prev].available_quantity <= 0)\r\n        ) {\r\n          prev--;\r\n        }\r\n        const finalPrev = Math.max(prev, 0);\r\n        setSelectedRowKey(allStocks[finalPrev]._id);\r\n        return finalPrev;\r\n      });\r\n      // Keep focus on search input\r\n    } else if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      const selectedStock = allStocks[highlightedIndex];\r\n      if (selectedStock) {\r\n        handleSelectRow(selectedStock);\r\n        // Only close modal if selection was successful (not expired and not out of stock)\r\n        if (\r\n          !isStockExpired(selectedStock) &&\r\n          !isStockOutOfStock(selectedStock)\r\n        ) {\r\n          onCancel(); // Close the modal after selection\r\n        }\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      e.preventDefault();\r\n      searchInputRef.current?.focus();\r\n    } else if (e.key === 'Tab' && e.shiftKey) {\r\n      e.preventDefault();\r\n      searchInputRef.current?.focus();\r\n    }\r\n  };\r\n\r\n  // Auto-focus back to search input when clicking outside\r\n  const handleModalClick = () => {\r\n    searchInputRef.current?.focus();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select Stock (F7 to reopen anytime)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      width={800}\r\n      footer={null}\r\n      destroyOnClose\r\n    >\r\n      <div onClick={handleModalClick}>\r\n        <Search\r\n          ref={searchInputRef}\r\n          placeholder=\"Search stocks (use  arrows to navigate, Enter to select)\"\r\n          onChange={e => setSearchTerm(e.target.value)}\r\n          style={{ marginBottom: 16 }}\r\n          autoFocus\r\n          onKeyDown={handleSearchKeyDown}\r\n          onBlur={() => {\r\n            // Re-focus after a short delay to ensure it stays focused\r\n            setTimeout(() => {\r\n              if (visible) {\r\n                searchInputRef.current?.focus();\r\n              }\r\n            }, 10);\r\n          }}\r\n        />\r\n\r\n        {/* Error Message Display */}\r\n        {errorMessage && (\r\n          <div\r\n            style={{\r\n              marginBottom: 16,\r\n              padding: '12px 16px',\r\n              backgroundColor: '#fff2f0',\r\n              border: '1px solid #ffccc7',\r\n              borderRadius: '6px',\r\n              color: '#cf1322',\r\n              fontSize: '14px',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '8px',\r\n            }}\r\n          >\r\n            <ExclamationCircleOutlined style={{ color: '#cf1322' }} />\r\n            {errorMessage}\r\n          </div>\r\n        )}\r\n\r\n        <div\r\n          onKeyDown={handleTableKeyDown}\r\n          tabIndex={0}\r\n          ref={tableBodyRef}\r\n          style={{ outline: 'none' }}\r\n        >\r\n          <Table\r\n            dataSource={allStocks}\r\n            columns={columns}\r\n            loading={loading}\r\n            rowKey=\"_id\"\r\n            size=\"small\"\r\n            pagination={false}\r\n            title={() => (\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  justifyContent: 'space-between',\r\n                  alignItems: 'center',\r\n                  padding: '8px 0',\r\n                }}\r\n              >\r\n                <span>Stock Items</span>\r\n                <div style={{ fontSize: '12px', color: '#666' }}>\r\n                  <span style={{ color: '#52c41a' }}> Valid</span>\r\n                  <span style={{ margin: '0 8px', color: '#faad14' }}>\r\n                     Near Expiry\r\n                  </span>\r\n                  <span style={{ color: '#ff4d4f' }}>\r\n                     Expired/Out of Stock (Disabled)\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            )}\r\n            onRow={(record, idx) => {\r\n              const isExpired = isStockExpired(record);\r\n              const isOutOfStock = isStockOutOfStock(record);\r\n              return {\r\n                onClick: () => {\r\n                  if (!isExpired && !isOutOfStock) {\r\n                    handleSelectRow(record);\r\n                    // Keep focus on search input after selection\r\n                    setTimeout(() => {\r\n                      searchInputRef.current?.focus();\r\n                    }, 10);\r\n                  } else if (isExpired) {\r\n                    showExpiredStockError(record);\r\n                  } else if (isOutOfStock) {\r\n                    showOutOfStockError(record);\r\n                  }\r\n                },\r\n                onDoubleClick: () => {\r\n                  if (!isExpired && !isOutOfStock) {\r\n                    handleSelectRow(record);\r\n                  } else if (isExpired) {\r\n                    showExpiredStockError(record);\r\n                  } else if (isOutOfStock) {\r\n                    showOutOfStockError(record);\r\n                  }\r\n                },\r\n                className:\r\n                  idx === highlightedIndex\r\n                    ? 'ant-table-row ant-table-row-selected'\r\n                    : 'ant-table-row',\r\n                'data-row-key': record._id,\r\n                style: {\r\n                  opacity: isExpired || isOutOfStock ? 0.6 : 1,\r\n                  cursor: isExpired || isOutOfStock ? 'not-allowed' : 'pointer',\r\n                  backgroundColor:\r\n                    isExpired || isOutOfStock ? '#f5f5f5' : undefined,\r\n                },\r\n              };\r\n            }}\r\n            rowSelection={{\r\n              type: 'radio',\r\n              selectedRowKeys: selectedRowKey ? [selectedRowKey] : [],\r\n              onChange: (keys: React.Key[]) => {\r\n                setSelectedRowKey(keys[0]);\r\n                const idx = allStocks.findIndex(s => s._id === keys[0]);\r\n                if (idx !== -1) setHighlightedIndex(idx);\r\n              },\r\n              getCheckboxProps: (record: Stock) => ({\r\n                disabled: isStockExpired(record) || isStockOutOfStock(record),\r\n              }),\r\n            }}\r\n          />\r\n          <div style={{ marginTop: 16, fontSize: '12px', color: '#666' }}>\r\n            <strong>Keyboard Shortcuts:</strong>  Navigate stocks | Enter\r\n            Select | Escape Cancel\r\n            <br />\r\n            <strong>Tip:</strong> Press F7 anytime to reopen this modal for\r\n            stock changes\r\n            <br />\r\n            <strong>Note:</strong> Expired items () and out of stock items\r\n            () are shown but cannot be selected. Navigation automatically\r\n            skips expired and out of stock items.\r\n            <br />\r\n            <strong>Error Handling:</strong> Attempting to select expired or out\r\n            of stock items will show an error message and prevent selection.\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default StockSelectionModal;\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Table,\r\n  Input,\r\n  InputNumber,\r\n  Select,\r\n  DatePicker,\r\n  Button,\r\n  Space,\r\n  Modal,\r\n  Typography,\r\n  message,\r\n  TableProps,\r\n} from 'antd';\r\nimport type { SizeType } from 'antd/es/config-provider/SizeContext';\r\nimport { PlusOutlined, DeleteOutlined, SaveOutlined } from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport './AntdEditableTable.css';\r\nimport ProductSelectionModal from '../../pages/RetaillBill/components/ProductSelectionModal';\r\nimport StockSelectionModal from '../../pages/RetaillBill/components/StockSelectionModal';\r\n\r\nconst { Text } = Typography;\r\n\r\nexport interface AntdEditableColumn {\r\n  title: string;\r\n  dataIndex: string;\r\n  key?: string;\r\n  defaultValue?: any;\r\n  type?: 'text' | 'number' | 'select' | 'date' | 'product' | 'stock';\r\n  options?: { label: string; value: any }[];\r\n  required?: boolean;\r\n  width?: number;\r\n  editable?: boolean;\r\n  validation?: (value: any) => string | undefined;\r\n  render?: (value: any, record?: any, rowIndex?: number) => React.ReactNode;\r\n}\r\n\r\nexport interface AntdEditableTableProps {\r\n  columns: AntdEditableColumn[];\r\n  dataSource: any[];\r\n  onSave: (data: any[]) => void;\r\n  onAdd?: () => void;\r\n  onDelete?: (indices: number[]) => void;\r\n  onProductSelect?: (product: any, rowIndex: number) => void;\r\n  allowAdd?: boolean;\r\n  allowDelete?: boolean;\r\n  rowKey?: string;\r\n  loading?: boolean;\r\n  compact?: boolean;\r\n  enableKeyboardNav?: boolean;\r\n  size?: SizeType;\r\n  className?: string;\r\n  externalEditingCell?: { row: number; col: number } | null;\r\n}\r\n\r\nconst AntdEditableTable: React.FC<AntdEditableTableProps> = ({\r\n  columns,\r\n  dataSource,\r\n  onSave,\r\n  onAdd,\r\n  onDelete,\r\n  allowAdd = true,\r\n  allowDelete = true,\r\n  rowKey = 'key',\r\n  loading = false,\r\n  compact = false,\r\n  enableKeyboardNav = true,\r\n  size = 'middle',\r\n  className,\r\n  onProductSelect,\r\n  externalEditingCell,\r\n}) => {\r\n  const [data, setData] = useState<any[]>([]);\r\n  const [selectedRows, setSelectedRows] = useState<any[]>([]);\r\n  const [editingCell, setEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n  const firstLoadRef = useRef(true);\r\n\r\n  useEffect(() => {\r\n    setData(dataSource);\r\n\r\n    const firstProductColIndex = columns.findIndex(\r\n      col => col.dataIndex === 'product_id'\r\n    );\r\n\r\n    //  Auto-focus only if table is empty on first load\r\n    if (\r\n      firstLoadRef.current &&\r\n      dataSource.length === 0 &&\r\n      firstProductColIndex >= 0\r\n    ) {\r\n      setEditingCell({ row: 0, col: firstProductColIndex });\r\n      firstLoadRef.current = false; // Prevent repeat auto-focus\r\n    }else{\r\n      setSelectedRows(dataSource.length>0?[String(dataSource.length-1)]:[])\r\n    }\r\n  }, [dataSource, columns]);\r\n\r\n  // Sync editingCell with externalEditingCell prop\r\n  useEffect(() => {\r\n    if (externalEditingCell) {\r\n      setEditingCell(externalEditingCell);\r\n    }\r\n  }, [externalEditingCell]);\r\n\r\n  const handleAddRow = () => {\r\n    onAdd?.();\r\n    // Set focus to the first editable cell of the new row (after parent updates data)\r\n    const firstEditableCol = columns.findIndex(col => col.editable !== false);\r\n    if (firstEditableCol >= 0) {\r\n      setEditingCell({ row: data.length, col: firstEditableCol });\r\n    }\r\n  };\r\n\r\n  const handleDeleteRow = () => {\r\n    if (data.length === 0) {\r\n      message.warning('No rows to delete');\r\n      return;\r\n    }\r\n    Modal.confirm({\r\n      title: 'Are you sure you want to delete the selected Bill Items?',\r\n      onOk: () => {\r\n        const newData = data.slice(0, -1);\r\n        setData(newData);\r\n        onSave(newData);\r\n        onDelete?.(selectedRows);\r\n      },\r\n    });\r\n  };\r\n\r\n  const saveCell = (row: number, col: number, value: any): boolean => {\r\n    const column = columns[col];\r\n\r\n    // Basic validation\r\n    if (column.required && (!value || value === '')) {\r\n      message.error(`${column.title} is required`);\r\n      return false;\r\n    }\r\n\r\n    // Custom validation\r\n    if (column.validation) {\r\n      const error = column.validation(value);\r\n      if (error) {\r\n        message.error(error);\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const newData = [...data];\r\n    newData[row][columns[col].dataIndex] = value;\r\n    setData(newData);\r\n    onSave(newData);\r\n    return true;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.ctrlKey && e.key === 's') {\r\n        e.preventDefault();\r\n        onSave(data);\r\n      }\r\n      if (e.shiftKey && e.key.toLowerCase() === 'a' && allowAdd) {\r\n        e.preventDefault();\r\n        handleAddRow();\r\n      }\r\n    };\r\n    if (enableKeyboardNav) {\r\n      document.addEventListener('keydown', handleKeyDown);\r\n      return () => document.removeEventListener('keydown', handleKeyDown);\r\n    }\r\n  }, [data, allowAdd, onSave, enableKeyboardNav, handleAddRow]);\r\n\r\n  const rowSelection: TableProps<any>['rowSelection'] = {\r\n    onChange: (selectedRowKeys: React.Key[], selectedRows:any[]) => {\r\n      setSelectedRows([...selectedRowKeys]);\r\n    },\r\n  };\r\n  \r\n  // Helper to find the next editable column index\r\n  function getNextEditableCol(startCol: number, direction: 1 | -1, columns: AntdEditableColumn[]): number {\r\n    let col = startCol + direction;\r\n    while (col >= 0 && col < columns.length) {\r\n      if (columns[col].editable !== false) return col;\r\n      col += direction;\r\n    }\r\n    return -1; // No editable column found\r\n  }\r\n\r\n  const EditableCell = ({\r\n    row,\r\n    col,\r\n    value,\r\n  }: {\r\n    row: number;\r\n    col: number;\r\n    value: any;\r\n  }) => {\r\n    const [cellValue, setCellValue] = useState(value);\r\n    const inputRef = useRef<any>(null);\r\n    const column = columns[col];\r\n    const [isProductModalVisible, setIsProductModalVisible] = useState(false);\r\n    const [isStockModalVisible, setIsStockModalVisible] = useState(false);\r\n\r\n    useEffect(() => {\r\n      setCellValue(value);\r\n      //  Focus input/select when cell enters edit mode\r\n      setTimeout(() => {\r\n        inputRef.current?.focus();\r\n      }, 50);\r\n    }, [value]);\r\n\r\n    const handleChange = (val: any) => {\r\n      setCellValue(val);\r\n      saveCell(row, col, val);\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n      if (column.type === 'product' && e.key === 'Enter') {\r\n        e.stopPropagation();\r\n        setIsProductModalVisible(true);\r\n        return; // Do not validate or move cell yet!\r\n      }\r\n      if (column.type === 'stock' && e.key === 'Enter') {\r\n        e.stopPropagation();\r\n        setIsStockModalVisible(true);\r\n        return;\r\n      }\r\n      if (e.key === 'Tab') {\r\n        e.preventDefault();\r\n        // Only validate on Tab\r\n        if (column.required && (!cellValue || cellValue === '')) {\r\n          message.error(`${column.title} is required`);\r\n          return;\r\n        }\r\n        const nextCol = e.shiftKey ? col - 1 : col + 1;\r\n        const nextRow = row + (nextCol >= columns.length ? 1 : 0);\r\n        const colIndex = (nextCol + columns.length) % columns.length;\r\n        if (nextRow < data.length) {\r\n          setEditingCell({ row: nextRow, col: colIndex });\r\n        } else if (allowAdd) {\r\n          handleAddRow();\r\n          setEditingCell({ row: data.length, col: colIndex });\r\n        }\r\n      } else if (e.key === 'Escape') {\r\n        setEditingCell(null);\r\n      }\r\n    };\r\n\r\n    const handleProductSelect = (product: any) => {\r\n      if (onProductSelect) {\r\n        onProductSelect(product, row);\r\n      }\r\n      setIsProductModalVisible(false);\r\n      setEditingCell(null);\r\n    };\r\n\r\n    const handleStockSelect = (stock: any) => {\r\n      // Set stock_id and batch_no in the row\r\n      const newData = [...data];\r\n      newData[row].stock_id = stock.id || stock._id || '';\r\n      newData[row].batch_no = stock.batch_no || '';\r\n      setData(newData);\r\n      onSave(newData);\r\n      setIsStockModalVisible(false);\r\n      setEditingCell(null);\r\n    };\r\n\r\n    switch (column.type) {\r\n      case 'product':\r\n        // Display product name instead of product_id when cell is focused\r\n        const productName = data[row]?.product_name\r\n          ? `${data[row].product_name}${data[row]?.variant_name ? ` ${data[row].variant_name}` : ''}`.trim()\r\n          : cellValue; // Fallback to product_id if name not available\r\n        return (\r\n          <>\r\n            <div onClick={e => e.stopPropagation()}>\r\n              <Input\r\n                ref={inputRef}\r\n                value={productName}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder=\"Press Enter to select product\"\r\n                readOnly\r\n                style={{ cursor: 'pointer' }}\r\n              />\r\n            </div>\r\n            {isProductModalVisible && (\r\n              <ProductSelectionModal\r\n                visible={isProductModalVisible}\r\n                onSelect={handleProductSelect}\r\n                onCancel={() => setIsProductModalVisible(false)}\r\n              />\r\n            )}\r\n          </>\r\n        );\r\n      case 'stock':\r\n        return (\r\n          <>\r\n            <div onClick={e => e.stopPropagation()}>\r\n              <Input\r\n                ref={inputRef}\r\n                value={data[row]?.batch_no || cellValue}\r\n                onKeyDown={handleKeyDown}\r\n                placeholder=\"Press Enter to select stock\"\r\n                readOnly\r\n              />\r\n            </div>\r\n            {isStockModalVisible && (\r\n              <StockSelectionModal\r\n                visible={isStockModalVisible}\r\n                onSelect={handleStockSelect}\r\n                onCancel={() => setIsStockModalVisible(false)}\r\n                productId={data[row]?.product_id || ''}\r\n              />\r\n            )}\r\n          </>\r\n        );\r\n      case 'number':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <InputNumber\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              onChange={handleChange}\r\n              onBlur={() => setEditingCell(null)}\r\n              controls={false}\r\n              onKeyDown={e => {\r\n                // Allow Enter/Tab to move to next editable cell\r\n                if (e.key === 'Tab' || e.key === 'Enter') {\r\n                  e.preventDefault();\r\n                  // Only validate on Tab or Enter\r\n                  if (column.required && (!cellValue || cellValue === '')) {\r\n                    message.error(`${column.title} is required`);\r\n                    return;\r\n                  }\r\n                  const direction = e.shiftKey ? -1 : 1;\r\n                  const nextCol = getNextEditableCol(col, direction, columns);\r\n                  if (nextCol !== -1) {\r\n                    setEditingCell({ row, col: nextCol });\r\n                  } else {\r\n                    // Move to next/previous row's first editable cell\r\n                    const nextRow = direction > 0 ? row + 1 : row - 1;\r\n                    if (nextRow >= 0 && nextRow < data.length) {\r\n                      const firstEditableCol = getNextEditableCol(-1, 1, columns);\r\n                      if (firstEditableCol !== -1) {\r\n                        setEditingCell({ row: nextRow, col: firstEditableCol });\r\n                      }\r\n                    } else if (direction > 0 && allowAdd) {\r\n                      // Add new row if moving forward and at the end\r\n                      handleAddRow();\r\n                      const firstEditableCol = getNextEditableCol(-1, 1, columns);\r\n                      if (firstEditableCol !== -1) {\r\n                        setEditingCell({ row: data.length, col: firstEditableCol });\r\n                      }\r\n                    } else {\r\n                      // Exit edit mode if no more rows\r\n                      setEditingCell(null);\r\n                    }\r\n                  }\r\n                } else if (e.key === 'Escape') {\r\n                  setEditingCell(null);\r\n                }\r\n              }}\r\n              style={{ width: '100%' }}\r\n            />\r\n          </div>\r\n        );\r\n      case 'select':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <Select\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              options={column.options}\r\n              onChange={val => {\r\n                const success = saveCell(row, col, val);\r\n                if (success) {\r\n                  // Move to next editable cell\r\n                  const nextCol = col + 1;\r\n                  const nextRow = row + (nextCol >= columns.length ? 1 : 0);\r\n                  const colIndex = (nextCol + columns.length) % columns.length;\r\n\r\n                  if (nextRow < data.length) {\r\n                    setEditingCell({ row: nextRow, col: colIndex });\r\n                  } else if (allowAdd) {\r\n                    handleAddRow();\r\n                    setEditingCell({ row: data.length, col: colIndex });\r\n                  }\r\n                }else {\r\n                  // Validation failed; keep focus\r\n                  setTimeout(() => {\r\n                    inputRef.current?.focus();\r\n                  }, 50);\r\n                }\r\n              }}\r\n              style={{ width: '100%' }}\r\n              onKeyDown={e => {\r\n                if (e.key === 'Enter' || e.key === 'Tab') {\r\n                  e.preventDefault(); // Block default key behavior\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n        );\r\n\r\n      case 'date':\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <DatePicker\r\n              ref={inputRef}\r\n              value={cellValue ? dayjs(cellValue) : null}\r\n              onChange={date => {\r\n                handleChange(date ? date.format('YYYY-MM-DD') : null);\r\n                setEditingCell(null);\r\n              }}\r\n              onBlur={() => setEditingCell(null)}\r\n              onKeyDown={handleKeyDown}\r\n              style={{ width: '100%' }}\r\n            />\r\n          </div>\r\n        );\r\n      default:\r\n        return (\r\n          <div onClick={e => e.stopPropagation()}>\r\n            <Input\r\n              ref={inputRef}\r\n              value={cellValue}\r\n              onChange={e => handleChange(e.target.value)}\r\n              onBlur={() => setEditingCell(null)}\r\n              onKeyDown={handleKeyDown}\r\n            />\r\n          </div>\r\n        );\r\n    }\r\n  };\r\n\r\n  const mergedColumns = columns.map((col, colIndex) => ({\r\n    ...col,\r\n    onCell: (_record: any, rowIndex?: number) => ({\r\n      onClick: () => {\r\n        if (typeof rowIndex === 'number') {\r\n          setEditingCell({ row: rowIndex, col: colIndex });\r\n        }\r\n      },\r\n      onContextMenu: (e: React.MouseEvent) => {\r\n        e.preventDefault(); //  Prevent default context menu\r\n        if (typeof rowIndex === 'number') {\r\n          setEditingCell({ row: rowIndex, col: colIndex });\r\n        }\r\n      },\r\n    }),\r\n    render: (val: any, record: any, rowIndex: number) => {\r\n      if (\r\n        editingCell &&\r\n        editingCell.row === rowIndex &&\r\n        editingCell.col === colIndex\r\n      ) {\r\n        return (\r\n          <EditableCell\r\n            key={`${rowIndex}-${colIndex}`}\r\n            row={rowIndex}\r\n            col={colIndex}\r\n            value={record[col.dataIndex]}\r\n          />\r\n        );\r\n      }\r\n      // Use custom render if provided and not editing\r\n      if (typeof col.render === 'function') {\r\n        return col.render(val, record, rowIndex);\r\n      }\r\n      // Show batch_no for stock_id column when not editing\r\n      if (col.dataIndex === 'batch_no') {\r\n        return record.batch_no || record[col.dataIndex];\r\n      }\r\n      // Show product_name for product_id column when not editing\r\n      if (col.dataIndex === 'product_id') {\r\n        return record.product_name || record[col.dataIndex];\r\n      }\r\n      if (col.type === 'select' && col.options) {\r\n        const option = col.options.find(\r\n          opt => opt.value === record[col.dataIndex]\r\n        );\r\n        return option ? option.label : record[col.dataIndex];\r\n      }\r\n      return record[col.dataIndex];\r\n    },\r\n  }));\r\n\r\n  return (\r\n    <div\r\n      className={`antd-editable-table ${compact ? 'compact' : ''} ${\r\n        className || ''\r\n      }`}\r\n    >\r\n      <div className=\"table-toolbar\">\r\n        <Space>\r\n          {allowAdd && (\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<PlusOutlined />}\r\n              onClick={handleAddRow}\r\n            >\r\n              Add Row (Shift+A)\r\n            </Button>\r\n          )}\r\n          {allowDelete && (\r\n            <Button danger icon={<DeleteOutlined />} onClick={handleDeleteRow}>\r\n              Delete Row\r\n            </Button>\r\n          )}\r\n          <Button\r\n            type=\"primary\"\r\n            icon={<SaveOutlined />}\r\n            onClick={() => onSave(data)}\r\n          >\r\n            Save (Ctrl+S)\r\n          </Button>\r\n        </Space>\r\n        <Text type=\"secondary\" className=\"table-info\">\r\n          Use Tab / Shift+Tab to navigate cells\r\n        </Text>\r\n      </div>\r\n      <Table\r\n        bordered\r\n        dataSource={data}\r\n        columns={mergedColumns}\r\n        rowKey={rowKey}\r\n        loading={loading}\r\n        pagination={false}\r\n        size={size}\r\n        scroll={{ y: 400 }}\r\n        rowSelection={{...rowSelection,type:\"checkbox\",selectedRowKeys:selectedRows}}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AntdEditableTable;\r\n","import { useMemo } from 'react';\r\nimport { calculateBillTotals } from '../../../helpers/amount_calculations';\r\nimport { BillItem } from '../../../types/entities';\r\n\r\ninterface BillSettings {\r\n  isGstIncluded: boolean;\r\n  discount: number;\r\n  discountType: 'percentage' | 'amount';\r\n}\r\n\r\nexport const useBillCalculations = (\r\n  items: BillItem[],\r\n  billSettings: BillSettings\r\n) => {\r\n  const billCalculations = useMemo(() => {\r\n    if (!items.length)\r\n      return {\r\n        sub_total: 0,\r\n        value_of_goods: 0,\r\n        total_gst: 0,\r\n        cgst: 0,\r\n        sgst: 0,\r\n        total_amount: 0,\r\n        discountValue: 0,\r\n      };\r\n\r\n    return calculateBillTotals({\r\n      items,\r\n      productList: [], // Not needed - tax_percentage stored in bill items\r\n      isGstIncluded: billSettings.isGstIncluded,\r\n      discount: billSettings.discount,\r\n      discountType: billSettings.discountType,\r\n    });\r\n  }, [items, billSettings]);\r\n\r\n  return billCalculations;\r\n};\r\n\r\n","/**\r\n * Centralized bill calculation utility\r\n * @param items - array of bill items\r\n * @param productList - product list (for tax/category lookup)\r\n * @param isGstIncluded - whether GST is included in price\r\n * @param discount - discount value\r\n * @param discountType - 'percentage' or 'amount'\r\n * @returns { totalAmount, totalGST, cgst, sgst, valueOfGoods, subtotal, itemsWithTax }\r\n */\r\nexport function calculateBillTotals({\r\n  items,\r\n  productList,\r\n  isGstIncluded,\r\n  discount,\r\n  discountType,\r\n}: {\r\n  items: any[];\r\n  productList: any[];\r\n  isGstIncluded: boolean;\r\n  discount: number;\r\n  discountType: \"percentage\" | \"amount\";\r\n}) {\r\n  // Calculate item base amounts\r\n  const itemsWithTax = items.map((item) => {\r\n    const product = productList?.find((p: any) => p._id === item.product_id);\r\n    // Use item's tax_percentage if available, otherwise get from product category, or default to 18%\r\n    let taxPercentage = item.tax_percentage || product?.CategoryItem?.tax_percentage || 18;\r\n    \r\n    // If still no tax percentage, use a default based on common GST rates\r\n    if (!taxPercentage || taxPercentage === 0) {\r\n      // Default to 18% GST for most goods\r\n      taxPercentage = 18;\r\n    }\r\n    \r\n\r\n    // Calculate base amount (before GST)\r\n    const baseAmount =\r\n      Number(item.qty || 0) * Number(item.price || 0) +\r\n      Number(item.loose_qty || 0) *\r\n        (Number(item.price || 0) / (product?.VariantItem?.pack_size || 1) || 0);\r\n    \r\n    // Calculate amount (with GST if applicable)\r\n    let amount = baseAmount;\r\n    if (!isGstIncluded && taxPercentage > 0) {\r\n      amount = baseAmount + (baseAmount * taxPercentage / 100);\r\n    }\r\n    return {\r\n      ...item,\r\n      tax_percentage: taxPercentage,\r\n      baseAmount,\r\n      amount,\r\n    };\r\n  });\r\n\r\n  // sub_total: sum of all item.amount values (table total before discount/GST)\r\n  const sub_total = itemsWithTax.reduce(\r\n    (sum, item) => sum + Number(item.amount),\r\n    0\r\n  );\r\n\r\n  // base_sub_total: sum of all item base amounts (before GST and discount)\r\n  const base_sub_total = itemsWithTax.reduce(\r\n    (sum, item) => sum + Number(item.baseAmount),\r\n    0\r\n  );\r\n\r\n  // Discount\r\n  let discountValue = 0;\r\n  if (discount > 0) {\r\n    if (discountType === \"percentage\") {\r\n      discountValue = base_sub_total * (discount / 100);\r\n    } else {\r\n      discountValue = discount;\r\n    }\r\n  }\r\n\r\n  // Discounted value of goods\r\n  const discounted_value_of_goods = base_sub_total - discountValue;\r\n\r\n  let total_gst = 0;\r\n  let value_of_goods = 0;\r\n  let total_amount = 0;\r\n  // Calculate GST and totals for each item\r\n  itemsWithTax.forEach(item => {\r\n    let discountedBase = item.baseAmount;\r\n    if (discount > 0) {\r\n      if (discountType === \"percentage\") {\r\n        discountedBase = item.baseAmount - (item.baseAmount * (discount / 100));\r\n      } else {\r\n        discountedBase = item.baseAmount - ((discount/base_sub_total)*item.baseAmount);\r\n      }\r\n    }\r\n    \r\n    let gstAmount = 0;\r\n    if (!isGstIncluded) {\r\n      // GST Excluded: GST is added on top\r\n      if (item.tax_percentage > 0) {\r\n        gstAmount = discountedBase * (item.tax_percentage / 100);\r\n        value_of_goods += discountedBase;\r\n        total_gst += gstAmount;\r\n        total_amount += discountedBase + gstAmount;\r\n      } else {\r\n        // No tax\r\n        value_of_goods += discountedBase;\r\n        total_amount += discountedBase;\r\n      }\r\n    } else {\r\n      // GST Included: GST is part of the price, extract it\r\n      if (item.tax_percentage > 0) {\r\n        gstAmount = discountedBase * (item.tax_percentage / (100 + item.tax_percentage));\r\n        value_of_goods += discountedBase - gstAmount;\r\n        total_gst += gstAmount;\r\n        total_amount += discountedBase;\r\n      } else {\r\n        // No tax\r\n        value_of_goods += discountedBase;\r\n        total_amount += discountedBase;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Calculate CGST and SGST (each is total_gst / 2)\r\n  const cgst = total_gst / 2;\r\n  const sgst = total_gst / 2;\r\n\r\n  return {\r\n    sub_total,\r\n    value_of_goods,\r\n    total_gst,\r\n    cgst,\r\n    sgst,\r\n    total_amount,\r\n    discountValue,\r\n  };\r\n}\r\n","import { useEffect, useMemo, useCallback } from 'react';\r\nimport { message } from 'antd';\r\nimport React from 'react';\r\nimport ReactDOMServer from 'react-dom/server';\r\nimport dayjs from 'dayjs';\r\nimport { useBillData } from './useBillData';\r\nimport { useBillForm } from './useBillForm';\r\nimport { useBillModals } from './useBillModals';\r\nimport { useBillItems } from './useBillItems';\r\nimport { useBillCalculations } from './useBillCalculations';\r\nimport { useBillKeyboardShortcuts } from './useBillKeyboardShortcuts';\r\nimport { useBillActions } from './useBillActions';\r\nimport { useTemplateSettings } from '../../../hooks/useTemplateSettings';\r\n\r\ninterface AdvancedBillingProps {\r\n  billdata?: any;\r\n  onSuccess?: () => void;\r\n}\r\n\r\n/**\r\n *  MASTER ADVANCED BILLING HOOK\r\n * \r\n * This hook orchestrates all billing functionality:\r\n * - Data fetching and management\r\n * - Form state management\r\n * - Item calculations\r\n * - Modal management\r\n * - Keyboard shortcuts\r\n * - Save/print/clear actions\r\n * \r\n * Reduces main component from 3500+ lines to ~400 lines\r\n */\r\nexport const useAdvancedBilling = ({ billdata, onSuccess }: AdvancedBillingProps) => {\r\n  // 1. Data Management\r\n  const billData = useBillData(billdata);\r\n  const { BillTemplateComponent, InvoiceTemplateComponent, settings } = useTemplateSettings();\r\n\r\n  // 2. Form State Management\r\n  const form = useBillForm();\r\n\r\n  // 3. Modal Management\r\n  const modals = useBillModals();\r\n\r\n  // 4. Item Management & Calculations\r\n  const items = useBillItems({\r\n    productOptions: [], // Not needed - product data stored in bill items\r\n    branchId: billData.branchId,\r\n    branchStockListResult: billData.branchStockListResult,\r\n    stockAuditListResult: billData.stockAuditListResult,\r\n    billSettings: form.billSettings,\r\n  });\r\n\r\n  // 5. Bill Calculations\r\n  const billCalculations = useBillCalculations(\r\n    form.billFormData.items,\r\n    form.billSettings\r\n  );\r\n\r\n  // 6. Save/Print/Clear Actions\r\n  const actions = useBillActions({\r\n    billFormData: form.billFormData,\r\n    billSettings: form.billSettings,\r\n    billCalculations,\r\n    documentType: form.documentType,\r\n    branchId: billData.branchId,\r\n    createSalesRecord: billData.createSalesRecord,\r\n    updateSalesRecord: billData.updateSalesRecord,\r\n    createInvoiceNumber: billData.createInvoiceNumber,\r\n    billdata,\r\n    onSuccess,\r\n    onSaveSuccess: (savedData) => {\r\n      modals.openSaveConfirmation();\r\n    },\r\n  });\r\n\r\n  // Handle items change with calculation\r\n  const handleItemsChange = useCallback(\r\n    (newItems: any[]) => {\r\n      const calculatedItems = items.handleItemsChange(newItems);\r\n      form.updateItems(calculatedItems);\r\n    },\r\n    [items, form]\r\n  );\r\n\r\n  // Handle quantity change\r\n  const handleQuantityChange = useCallback(\r\n    (rowIndex: number, field: 'qty' | 'loose_qty', value: number) => {\r\n      const newItems = [...form.billFormData.items];\r\n      const item = newItems[rowIndex];\r\n\r\n      // Update the quantity\r\n      newItems[rowIndex] = { ...item, [field]: value };\r\n\r\n      // Recalculate through handleItemsChange\r\n      handleItemsChange(newItems);\r\n    },\r\n    [form.billFormData.items, handleItemsChange]\r\n  );\r\n\r\n  // Handle product selection\r\n  const handleProductSelect = useCallback(\r\n    (product: any, rowOrIndex: any) => {\r\n      const newItems = [...form.billFormData.items];\r\n      \r\n      // Find row index - AntdEditableTable passes row object, others might pass index number\r\n      let rowIndex: number;\r\n      if (typeof rowOrIndex === 'number') {\r\n        rowIndex = rowOrIndex;\r\n      } else {\r\n        // rowOrIndex is the row object - find its index by key\r\n        rowIndex = newItems.findIndex(item => (item as any).key === rowOrIndex.key);\r\n      }\r\n      \r\n      if (rowIndex === -1) {\r\n        console.error(' Could not find row index for product selection!');\r\n        return;\r\n      }\r\n      \r\n      // Store ALL product data (including tax %) for calculations\r\n      newItems[rowIndex].product_id = product.id || product._id || '';\r\n      newItems[rowIndex].product_name = product.name || '';\r\n      newItems[rowIndex].variant_name = product.VariantItem?.variant_name || '';\r\n      newItems[rowIndex].price = product.selling_price || 0;\r\n      newItems[rowIndex].tax_percentage = product.CategoryItem?.tax_percentage || 0;\r\n      newItems[rowIndex].category_name = product.CategoryItem?.category_name || '';\r\n      \r\n      handleItemsChange(newItems);\r\n      modals.openStockModal(rowIndex);\r\n    },\r\n    [form.billFormData.items, handleItemsChange, modals]\r\n  );\r\n\r\n  // Handle stock selection\r\n  const handleStockSelect = useCallback(\r\n    (stock: any) => {\r\n      if (modals.stockModalRowIndex === null) return;\r\n\r\n      const newItems = [...form.billFormData.items];\r\n      const rowIndex = modals.stockModalRowIndex;\r\n      const currentItem = { ...newItems[rowIndex] };\r\n\r\n      currentItem.stock_id = stock.id || stock._id || '';\r\n      currentItem.batch_no = stock.batch_no || '';\r\n\r\n      const productFromStock = stock.ProductItem;\r\n      if (productFromStock) {\r\n        currentItem.product_id = currentItem.product_id || productFromStock._id || '';\r\n        currentItem.product_name = productFromStock.name || currentItem.product_name || '';\r\n        currentItem.variant_name =\r\n          currentItem.variant_name || productFromStock.VariantItem?.variant_name || '';\r\n        currentItem.tax_percentage =\r\n          typeof currentItem.tax_percentage === 'number' && currentItem.tax_percentage !== undefined\r\n            ? currentItem.tax_percentage\r\n            : productFromStock.CategoryItem?.tax_percentage || 0;\r\n        currentItem.category_name =\r\n          currentItem.category_name || productFromStock.CategoryItem?.category_name || '';\r\n      }\r\n\r\n      // Save stock data for display AND price calculation\r\n      (currentItem as any).stockData = {\r\n        _id: stock.id || stock._id,\r\n        available_quantity: stock.available_quantity || 0,\r\n        available_loose_quantity: stock.available_loose_quantity || 0,\r\n        batch_no: stock.batch_no || '',\r\n        pack_size: stock.ProductItem?.VariantItem?.pack_size || 1,\r\n        sell_price: stock.sell_price || 0, //  ADD THIS!\r\n        mrp: stock.mrp || stock.sell_price || 0,\r\n        ProductItem: stock.ProductItem,\r\n      };\r\n\r\n      newItems[rowIndex] = currentItem;\r\n\r\n      handleItemsChange(newItems);\r\n      modals.closeStockModal();\r\n\r\n      // Focus on qty field\r\n      const qtyColIndex = 2; // Adjust based on your column order\r\n      modals.setExternalEditingCell({ row: modals.stockModalRowIndex, col: qtyColIndex });\r\n    },\r\n    [modals, form.billFormData.items, handleItemsChange]\r\n  );\r\n\r\n  // Handle print\r\n  const handlePrint = useCallback(async () => {\r\n    if (!form.billFormData.items || form.billFormData.items.length === 0) {\r\n      message.warning('Please add items before printing');\r\n      return;\r\n    }\r\n\r\n    const isInvoice = form.documentType === 'invoice';\r\n    const partyList = isInvoice ? billData.vendorListResult : billData.customerListResult;\r\n    const selectedParty = partyList.find((p: any) => p._id === form.billFormData.customer_id);\r\n\r\n    const billDataForPDF = {\r\n      invoice_no: form.billFormData.invoice_no,\r\n      date: form.billFormData.date,\r\n      customerName: selectedParty?.vendor_name || selectedParty?.full_name || '',\r\n      customerAddress: selectedParty?.address || selectedParty?.address1 || '',\r\n      customerCity: selectedParty?.city || '',\r\n      customerState: selectedParty?.state || '',\r\n      customerPincode: selectedParty?.pincode || '',\r\n      customerPhone: selectedParty?.phone || selectedParty?.mobile || '',\r\n      customerEmail: selectedParty?.email || '',\r\n      customer_gstin: selectedParty?.gst_no || '',\r\n      customer_pan: selectedParty?.pan_no || '',\r\n      items: form.billFormData.items,\r\n      total: billCalculations.total_amount,\r\n      total_amount: billCalculations.total_amount,\r\n      value_of_goods: billCalculations.value_of_goods,\r\n      sub_total: billCalculations.sub_total,\r\n      total_gst: billCalculations.total_gst,\r\n      cgst: billCalculations.cgst,\r\n      sgst: billCalculations.sgst,\r\n      discountValue: billCalculations.discountValue,\r\n      discount: form.billSettings.discount,\r\n      discount_type: form.billSettings.discountType,\r\n      is_gst_included: form.billSettings.isGstIncluded,\r\n      payment_mode: form.billFormData.payment_mode,\r\n      // Payment status fields\r\n      is_paid: form.billSettings.isPaid,\r\n      is_partially_paid: form.billSettings.isPartiallyPaid,\r\n      paid_amount: form.billSettings.isPartiallyPaid\r\n        ? form.billSettings.paidAmount\r\n        : form.billSettings.isPaid\r\n          ? billCalculations.total_amount\r\n          : 0,\r\n      organisationItems: billData.organisationDetails,\r\n      branchItems: billData.branchDetails,\r\n    };\r\n\r\n    // Generate QR code if enabled\r\n    let qrCodeDataUrl = '';\r\n    if (settings?.enable_payment_qr && settings?.upi_id) {\r\n      try {\r\n        const { generateUPIQRCode, formatBillToUPIParams } = await import('../../../helpers/upiPayment');\r\n        const upiParams = formatBillToUPIParams(billDataForPDF, settings);\r\n        if (upiParams) {\r\n          qrCodeDataUrl = await generateUPIQRCode(upiParams, { width: settings?.qr_size || 150 });\r\n        }\r\n      } catch (error) {\r\n        console.error('Error generating QR code for print:', error);\r\n      }\r\n    }\r\n\r\n    // Add QR code to settings\r\n    const enhancedSettings = {\r\n      ...settings,\r\n      qrCodeDataUrl,\r\n    };\r\n\r\n    // Select appropriate template\r\n    const TemplateComponent = form.documentType === 'bill' \r\n      ? BillTemplateComponent \r\n      : InvoiceTemplateComponent;\r\n\r\n    // Render template to HTML\r\n    const element = React.createElement(TemplateComponent, { \r\n      billData: billDataForPDF, \r\n      settings: enhancedSettings \r\n    });\r\n    const templateHtml = ReactDOMServer.renderToString(element);\r\n\r\n    // Import and use PDF helper for printing\r\n    const { printAsPDF } = await import('../../../helpers/pdfHelper');\r\n    const fileName = `${form.documentType}_${billDataForPDF.invoice_no}_${dayjs().format('YYYYMMDD')}`;\r\n    \r\n    await printAsPDF(templateHtml, fileName, form.documentType);\r\n  }, [form, billCalculations, billData, BillTemplateComponent, InvoiceTemplateComponent, settings]);\r\n\r\n  // Handle download PDF\r\n  const handleDownload = useCallback(async () => {\r\n    if (!form.billFormData.items || form.billFormData.items.length === 0) {\r\n      message.warning('Please add items before downloading');\r\n      return;\r\n    }\r\n\r\n    const isInvoice = form.documentType === 'invoice';\r\n    const partyList = isInvoice ? billData.vendorListResult : billData.customerListResult;\r\n    const selectedParty = partyList.find((p: any) => p._id === form.billFormData.customer_id);\r\n\r\n    const billDataForPDF = {\r\n      invoice_no: form.billFormData.invoice_no,\r\n      date: form.billFormData.date,\r\n      customerName: selectedParty?.vendor_name || selectedParty?.full_name || '',\r\n      customerAddress: selectedParty?.address || selectedParty?.address1 || '',\r\n      customerCity: selectedParty?.city || '',\r\n      customerState: selectedParty?.state || '',\r\n      customerPincode: selectedParty?.pincode || '',\r\n      customerPhone: selectedParty?.phone || selectedParty?.mobile || '',\r\n      customerEmail: selectedParty?.email || '',\r\n      customer_gstin: selectedParty?.gst_no || '',\r\n      customer_pan: selectedParty?.pan_no || '',\r\n      items: form.billFormData.items,\r\n      total: billCalculations.total_amount,\r\n      total_amount: billCalculations.total_amount,\r\n      value_of_goods: billCalculations.value_of_goods,\r\n      sub_total: billCalculations.sub_total,\r\n      total_gst: billCalculations.total_gst,\r\n      cgst: billCalculations.cgst,\r\n      sgst: billCalculations.sgst,\r\n      discountValue: billCalculations.discountValue,\r\n      discount: form.billSettings.discount,\r\n      discount_type: form.billSettings.discountType,\r\n      is_gst_included: form.billSettings.isGstIncluded,\r\n      payment_mode: form.billFormData.payment_mode,\r\n      // Payment status fields\r\n      is_paid: form.billSettings.isPaid,\r\n      is_partially_paid: form.billSettings.isPartiallyPaid,\r\n      paid_amount: form.billSettings.isPartiallyPaid\r\n        ? form.billSettings.paidAmount\r\n        : form.billSettings.isPaid\r\n          ? billCalculations.total_amount\r\n          : 0,\r\n      organisationItems: billData.organisationDetails,\r\n      branchItems: billData.branchDetails,\r\n    };\r\n\r\n    // Generate QR code if enabled\r\n    let qrCodeDataUrl = '';\r\n    if (settings?.enable_payment_qr && settings?.upi_id) {\r\n      try {\r\n        const { generateUPIQRCode, formatBillToUPIParams } = await import('../../../helpers/upiPayment');\r\n        const upiParams = formatBillToUPIParams(billDataForPDF, settings);\r\n        if (upiParams) {\r\n          qrCodeDataUrl = await generateUPIQRCode(upiParams, { width: settings?.qr_size || 150 });\r\n        }\r\n      } catch (error) {\r\n        console.error('Error generating QR code for download:', error);\r\n      }\r\n    }\r\n\r\n    // Add QR code to settings\r\n    const enhancedSettings = {\r\n      ...settings,\r\n      qrCodeDataUrl,\r\n    };\r\n\r\n    // Select appropriate template\r\n    const TemplateComponent = form.documentType === 'bill' \r\n      ? BillTemplateComponent \r\n      : InvoiceTemplateComponent;\r\n\r\n    // Render template to HTML\r\n    const element = React.createElement(TemplateComponent, { \r\n      billData: billDataForPDF, \r\n      settings: enhancedSettings \r\n    });\r\n    const templateHtml = ReactDOMServer.renderToString(element);\r\n\r\n    // Import and use PDF helper\r\n    const { downloadAsPDF } = await import('../../../helpers/pdfHelper');\r\n    const fileName = `${form.documentType}_${billDataForPDF.invoice_no}_${dayjs().format('YYYYMMDD')}`;\r\n    \r\n    await downloadAsPDF(templateHtml, fileName, form.documentType);\r\n  }, [form, billCalculations, billData, BillTemplateComponent, InvoiceTemplateComponent, settings]);\r\n\r\n  // 7. Keyboard Shortcuts\r\n  const shortcuts = useBillKeyboardShortcuts({\r\n    onF1AddItem: form.addItem,\r\n    onF2SaveDraft: actions.handleSaveDraft,\r\n    onF3CompleteBill: actions.handleCompleteBill,\r\n    onF4Clear: () => {\r\n      form.resetForm();\r\n      message.success('Bill form cleared successfully!');\r\n    },\r\n    onF5ProductSelection: () => {\r\n      // Logic to open product selection for current row\r\n      modals.openProductSelectionModal(modals.lastInteractedRowIndex);\r\n    },\r\n    onF6BillList: modals.openBillListDrawer,\r\n    onF7StockSelection: () => {\r\n      // Logic to open stock selection for current row\r\n      const rowIndex = form.billFormData.items.findIndex(\r\n        (item: any) => item.product_id && !item.stock_id\r\n      );\r\n      if (rowIndex !== -1) {\r\n        modals.openStockModal(rowIndex);\r\n      } else {\r\n        message.warning('Please select a product first');\r\n      }\r\n    },\r\n    onF8Print: handlePrint,\r\n    onEndCustomer: modals.openCustomerModal,\r\n    onCtrlU: modals.openUserModal,\r\n    onCtrlS: actions.handleSaveDraft,\r\n    onCtrlN: form.addItem,\r\n    onCtrlP: handlePrint,\r\n    onCtrlR: () => {\r\n      form.resetForm();\r\n      message.success('Ready for next bill!', 2);\r\n    },\r\n  });\r\n\r\n  // 8. Initialize data on mount\r\n  useEffect(() => {\r\n    // Products, Customers, Vendors, Users: All loaded by modals when opened\r\n    // Selected product data (with tax %) is stored in bill items for calculations\r\n    \r\n    // Get invoice number for new bills\r\n    if (!billdata && !billData.invoice_no_create_loading && !form.billFormData.invoice_no) {\r\n      billData.refetchInvoiceNo();\r\n    }\r\n\r\n    // Load bill data if editing\r\n    if (billdata) {\r\n      form.loadBillData(billdata, () => {\r\n        // Recalculate items after loading to populate stock data\r\n        if (form.billFormData.items.length > 0) {\r\n          const calculatedItems = items.calculateItemAmounts(form.billFormData.items);\r\n          form.updateItems(calculatedItems);\r\n        }\r\n      });\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [billdata?._id]);\r\n\r\n  // 9. Set invoice number\r\n  useEffect(() => {\r\n    if (billData.invoiceNoData?.result?.invoice_no && !billdata) {\r\n      form.updateHeader({ invoice_no: billData.invoiceNoData.result.invoice_no });\r\n    }\r\n  }, [billData.invoiceNoData, billdata]);\r\n\r\n  // 10. Initialize empty items for new bills\r\n  useEffect(() => {\r\n    if (!billdata && form.billFormData.items.length === 0) {\r\n      form.addItem();\r\n    }\r\n  }, [billdata, form.billFormData.items.length]);\r\n\r\n  // 11. Auto-set current user as billed_by\r\n  useEffect(() => {\r\n    if (!billdata && billData.userListResult.length && billData.user?._id && !form.billFormData.billed_by_id) {\r\n      const currentUser = billData.userListResult.find((u: any) => u._id === billData.user?._id);\r\n      if (currentUser && billData.user) {\r\n        form.updateHeader({\r\n          billed_by_id: billData.user._id,\r\n          billed_by_name: currentUser.name || billData.user.name || '',\r\n        });\r\n      }\r\n    }\r\n  }, [billData.userListResult, billData.user, billdata, form.billFormData.billed_by_id]);\r\n\r\n  // 12. Update document type from settings\r\n  useEffect(() => {\r\n    if (!billdata && billData.settings?.default_document_type) {\r\n      form.setDocumentType(billData.settings.default_document_type as 'bill' | 'invoice');\r\n    }\r\n  }, [billData.settings, billdata]);\r\n\r\n  // 13. Recalculate items when editing and stock data is loaded\r\n  useEffect(() => {\r\n    if (billdata && form.billFormData.items.length > 0 && \r\n        (billData.branchStockListResult.length > 0 || billData.stockAuditListResult.length > 0)) {\r\n      \r\n      // Check if any item needs stock data populated\r\n      const needsStockData = form.billFormData.items.some(\r\n        (item: any) => item.stock_id && !item.stockData\r\n      );\r\n      \r\n      if (needsStockData) {\r\n        // Recalculate items to populate stockData from stock lists\r\n        const calculatedItems = items.calculateItemAmounts(form.billFormData.items);\r\n        form.updateItems(calculatedItems);\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    billdata?._id, // Trigger when different bill is loaded\r\n    form.billFormData.items.length, \r\n    billData.branchStockListResult.length, \r\n    billData.stockAuditListResult.length\r\n  ]);\r\n\r\n  // Return all necessary data and functions\r\n  return {\r\n    // Data\r\n    billData,\r\n    \r\n    // Form\r\n    form,\r\n    billFormData: form.billFormData,\r\n    billSettings: form.billSettings,\r\n    documentType: form.documentType,\r\n    \r\n    // Calculations\r\n    billCalculations,\r\n    \r\n    // Modals\r\n    modals,\r\n    \r\n    // Actions\r\n    actions,\r\n    \r\n    // Handlers\r\n    handleItemsChange,\r\n    handleQuantityChange,\r\n    handleProductSelect,\r\n    handleStockSelect,\r\n    handlePrint,\r\n    handleDownload,\r\n    \r\n    // Keyboard\r\n    shortcuts,\r\n\r\n    // Options for dropdowns\r\n    // Product options not needed - products loaded in modal on demand\r\n    productOptions: [],\r\n    \r\n    customerOptions: useMemo(() => {\r\n      const options = billData.customerListResult.map((customer: any) => ({\r\n        label: `${customer.full_name} - ${customer.mobile}`,\r\n        value: customer._id,\r\n      }));\r\n\r\n      if (form.billFormData.customer_id && form.billFormData.customer_name) {\r\n        const exists = options.some((opt: { value: string }) => opt.value === form.billFormData.customer_id);\r\n        if (!exists) {\r\n          options.push({\r\n            value: form.billFormData.customer_id,\r\n            label: form.billFormData.customer_name,\r\n          });\r\n        }\r\n      }\r\n\r\n      return options;\r\n    }, [\r\n      billData.customerListResult,\r\n      form.billFormData.customer_id,\r\n      form.billFormData.customer_name,\r\n    ]),\r\n    \r\n    vendorOptions: useMemo(() => {\r\n      const options = billData.vendorListResult.map((vendor: any) => ({\r\n        label: `${vendor.vendor_name} - ${vendor.contact_number || 'N/A'}`,\r\n        value: vendor._id,\r\n      }));\r\n\r\n      if (form.billFormData.customer_id && form.billFormData.customer_name) {\r\n        const exists = options.some((opt: { value: string }) => opt.value === form.billFormData.customer_id);\r\n        if (!exists) {\r\n          options.push({\r\n            value: form.billFormData.customer_id,\r\n            label: form.billFormData.customer_name,\r\n          });\r\n        }\r\n      }\r\n\r\n      return options;\r\n    }, [\r\n      billData.vendorListResult,\r\n      form.billFormData.customer_id,\r\n      form.billFormData.customer_name,\r\n    ]),\r\n    \r\n    userOptions: useMemo(() => {\r\n      const options = billData.userListResult.map((user: any) => ({\r\n        label: `${user.name} (${user.roleItems?.name || 'No Role'})`,\r\n        value: user._id,\r\n      }));\r\n\r\n      if (form.billFormData.billed_by_id && form.billFormData.billed_by_name) {\r\n        const exists = options.some((opt: { value: string }) => opt.value === form.billFormData.billed_by_id);\r\n        if (!exists) {\r\n          options.push({\r\n            value: form.billFormData.billed_by_id,\r\n            label: form.billFormData.billed_by_name,\r\n          });\r\n        }\r\n      }\r\n\r\n      return options;\r\n    }, [\r\n      billData.userListResult,\r\n      form.billFormData.billed_by_id,\r\n      form.billFormData.billed_by_name,\r\n    ]),\r\n  };\r\n};\r\n\r\n","import { useMemo } from 'react';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport { useGenericCrudRTK } from '../../../hooks/useGenericCrudRTK';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\n/**\r\n * Hook to manage all data fetching for the bill\r\n * Centralizes all RTK Query hooks and data extraction\r\n */\r\nexport const useBillData = (billdata?: any) => {\r\n  const user = getCurrentUser();\r\n  const branchId = user?.branch_id;\r\n  const organisationId = user?.organisation_id || user?.organisationItems?._id;\r\n\r\n  // RTK Query API hooks\r\n  const SalesRecord = useGenericCrudRTK('SalesRecord');\r\n  const InvoiceNumberApi = useGenericCrudRTK('InvoiceNumber');\r\n\r\n  // Skip products - will load when modal opens (like Customer/Vendor/User)\r\n  // Selected product data will be stored in bill items for calculations\r\n  const {\r\n    data: productListData,\r\n    isLoading: productLoading,\r\n    refetch: refetchProducts,\r\n  } = apiSlice.useGetProductQuery({}, { skip: true });\r\n\r\n  const {\r\n    data: customerListData,\r\n    isLoading: customerLoading,\r\n    refetch: refetchCustomers,\r\n  } = apiSlice.useGetCustomerQuery({}, { skip: true });\r\n\r\n  const {\r\n    data: vendorListData,\r\n    isLoading: vendorLoading,\r\n    refetch: refetchVendors,\r\n  } = apiSlice.useGetVendorQuery({}, { skip: true });\r\n\r\n  const {\r\n    data: userListData,\r\n    isLoading: userLoading,\r\n    refetch: refetchUsers,\r\n  } = apiSlice.useGetBillingUsersQuery({}, { skip: true });\r\n\r\n  // Stock APIs - conditional based on branch\r\n  const shouldFetchStockAudit = !branchId && !!billdata;\r\n  const {\r\n    data: stockAuditListData,\r\n    isLoading: stockLoading,\r\n    refetch: refetchStockAudit,\r\n  } = apiSlice.useGetStockAuditQuery({}, { skip: !shouldFetchStockAudit });\r\n\r\n  const {\r\n    data: branchStockListData,\r\n    isLoading: branchStockLoading,\r\n    refetch: refetchBranchStock,\r\n  } = apiSlice.useGetBranchStockQuery({}, { skip: !branchId });\r\n\r\n  const { data: invoiceNoData, refetch: refetchInvoiceNo } =\r\n    InvoiceNumberApi.useGetAll();\r\n\r\n  // Fetch organization data\r\n  const { data: organisationsData } = apiSlice.useGetOrganisationsQuery(\r\n    { organisation_id: organisationId },\r\n    { skip: !organisationId }\r\n  );\r\n\r\n  // Fetch settings\r\n  const { data: settingsData } = apiSlice.useGetSettingsQuery(\r\n    { organisation_id: organisationId, page: 1, limit: 1 },\r\n    { skip: !organisationId, refetchOnMountOrArgChange: false }\r\n  );\r\n\r\n  // Extract results from API responses\r\n  const productListResult = useMemo(\r\n    () => (Array.isArray((productListData as any)?.result) ? (productListData as any).result : []),\r\n    [productListData]\r\n  );\r\n\r\n  const customerListResult = useMemo(\r\n    () => (Array.isArray((customerListData as any)?.result) ? (customerListData as any).result : []),\r\n    [customerListData]\r\n  );\r\n\r\n  const vendorListResult = useMemo(\r\n    () => (Array.isArray((vendorListData as any)?.result) ? (vendorListData as any).result : []),\r\n    [vendorListData]\r\n  );\r\n\r\n  const userListResult = useMemo(\r\n    () => (Array.isArray((userListData as any)?.result) ? (userListData as any).result : []),\r\n    [userListData]\r\n  );\r\n\r\n  const stockAuditListResult = useMemo(\r\n    () => (Array.isArray((stockAuditListData as any)?.result) ? (stockAuditListData as any).result : []),\r\n    [stockAuditListData]\r\n  );\r\n\r\n  const branchStockListResult = useMemo(\r\n    () => (Array.isArray((branchStockListData as any)?.result) ? (branchStockListData as any).result : []),\r\n    [branchStockListData]\r\n  );\r\n\r\n  const organisationDetails = useMemo(() => {\r\n    const result = (organisationsData as any)?.result;\r\n    if (Array.isArray(result)) return result[0];\r\n    return result || user?.organisationItems || {};\r\n  }, [organisationsData, user]);\r\n\r\n  const branchDetails = useMemo(() => user?.branchItems || {}, [user]);\r\n\r\n  const settings = useMemo(() => {\r\n    const settingsResult = (settingsData as any)?.result || settingsData || {};\r\n    return Array.isArray(settingsResult) ? settingsResult[0] : settingsResult;\r\n  }, [settingsData]);\r\n\r\n  // Mutations\r\n  const { create: createSalesRecord, isLoading: saleCreateLoading } =\r\n    SalesRecord.useCreate();\r\n  const { update: updateSalesRecord, isLoading: saleUpdateLoading } =\r\n    SalesRecord.useUpdate();\r\n  const { create: createInvoiceNumber, isLoading: invoice_no_create_loading } =\r\n    InvoiceNumberApi.useCreate();\r\n\r\n  // Refetch all data\r\n  const refetchAllData = () => {\r\n    refetchProducts();\r\n    refetchCustomers();\r\n    refetchVendors();\r\n    refetchUsers();\r\n    if (branchId) {\r\n      refetchBranchStock();\r\n    } else if (shouldFetchStockAudit) {\r\n      refetchStockAudit();\r\n    }\r\n  };\r\n\r\n  return {\r\n    // User & Organization\r\n    user,\r\n    branchId,\r\n    organisationId,\r\n    organisationDetails,\r\n    branchDetails,\r\n    settings,\r\n\r\n    // Lists\r\n    productListResult,\r\n    customerListResult,\r\n    vendorListResult,\r\n    userListResult,\r\n    stockAuditListResult,\r\n    branchStockListResult,\r\n\r\n    // Loading states\r\n    productLoading,\r\n    customerLoading,\r\n    vendorLoading,\r\n    userLoading,\r\n    stockLoading,\r\n    branchStockLoading,\r\n    saleCreateLoading,\r\n    saleUpdateLoading,\r\n    invoice_no_create_loading,\r\n\r\n    // Mutations\r\n    createSalesRecord,\r\n    updateSalesRecord,\r\n    createInvoiceNumber,\r\n\r\n    // Refetch functions\r\n    refetchProducts,\r\n    refetchCustomers,\r\n    refetchVendors,\r\n    refetchUsers,\r\n    refetchStockAudit,\r\n    refetchBranchStock,\r\n    refetchInvoiceNo,\r\n    refetchAllData,\r\n\r\n    // Invoice number\r\n    invoiceNoData,\r\n  };\r\n};\r\n\r\n","import { useState, useCallback } from 'react';\r\nimport dayjs from 'dayjs';\r\nimport { BillFormData, BillItem } from '../../../types/entities';\r\n\r\ninterface BillSettings {\r\n  isPaid: boolean;\r\n  isPartiallyPaid: boolean;\r\n  isRetail: boolean;\r\n  isGstIncluded: boolean;\r\n  discount: number;\r\n  discountType: 'percentage' | 'amount';\r\n  paidAmount: number;\r\n}\r\n\r\n/**\r\n * Hook to manage bill form state and settings\r\n */\r\nexport const useBillForm = () => {\r\n  const [billFormData, setBillFormData] = useState<BillFormData>({\r\n    invoice_no: '',\r\n    date: dayjs().format('YYYY-MM-DD'),\r\n    customer_id: '',\r\n    customer_name: '',\r\n    billed_by_id: '',\r\n    billed_by_name: '',\r\n    payment_mode: 'cash',\r\n    items: [],\r\n  });\r\n\r\n  const [billSettings, setBillSettings] = useState<BillSettings>({\r\n    isPaid: true,\r\n    isPartiallyPaid: false,\r\n    isRetail: true,\r\n    isGstIncluded: true,\r\n    discount: 0,\r\n    discountType: 'percentage',\r\n    paidAmount: 0,\r\n  });\r\n\r\n  const [documentType, setDocumentType] = useState<'bill' | 'invoice'>('bill');\r\n\r\n  // Update header fields\r\n  const updateHeader = useCallback((updates: Partial<BillFormData>) => {\r\n    setBillFormData(prev => ({ ...prev, ...updates }));\r\n  }, []);\r\n\r\n  // Update items\r\n  const updateItems = useCallback((items: BillItem[]) => {\r\n    setBillFormData(prev => ({ ...prev, items }));\r\n  }, []);\r\n\r\n  // Add item\r\n  const addItem = useCallback(() => {\r\n    const newItem: BillItem = {\r\n      product_id: '',\r\n      product_name: '',\r\n      variant_name: '',\r\n      stock_id: '',\r\n      batch_no: '',\r\n      qty: 0,\r\n      loose_qty: 0,\r\n      price: 0,\r\n      mrp: 0,\r\n      amount: 0,\r\n      tax_percentage: 0,\r\n    };\r\n    setBillFormData(prev => ({ ...prev, items: [...prev.items, newItem] }));\r\n  }, []);\r\n\r\n  // Delete items\r\n  const deleteItems = useCallback((indices: number[]) => {\r\n    setBillFormData(prev => ({\r\n      ...prev,\r\n      items: prev.items.filter((_, index) => !indices.includes(index)),\r\n    }));\r\n  }, []);\r\n\r\n  // Update settings\r\n  const updateSettings = useCallback((updates: Partial<BillSettings>) => {\r\n    setBillSettings(prev => ({ ...prev, ...updates }));\r\n  }, []);\r\n\r\n  // Reset form\r\n  const resetForm = useCallback(() => {\r\n    setBillFormData({\r\n      invoice_no: '',\r\n      date: dayjs().format('YYYY-MM-DD'),\r\n      customer_id: '',\r\n      customer_name: '',\r\n      billed_by_id: '',\r\n      billed_by_name: '',\r\n      payment_mode: 'cash',\r\n      items: [\r\n        {\r\n          product_id: '',\r\n          product_name: '',\r\n          variant_name: '',\r\n          stock_id: '',\r\n          batch_no: '',\r\n          qty: 0,\r\n          loose_qty: 0,\r\n          price: 0,\r\n          mrp: 0,\r\n          amount: 0,\r\n          tax_percentage: 0,\r\n        },\r\n      ],\r\n    });\r\n\r\n    setBillSettings({\r\n      isPaid: true,\r\n      isPartiallyPaid: false,\r\n      isRetail: true,\r\n      isGstIncluded: true,\r\n      discount: 0,\r\n      discountType: 'percentage',\r\n      paidAmount: 0,\r\n    });\r\n\r\n    setDocumentType('bill');\r\n  }, []);\r\n\r\n  // Load bill data (for editing)\r\n  const loadBillData = useCallback((billdata: any, onLoadComplete?: () => void) => {\r\n    const isInvoice = billdata.document_type === 'invoice';\r\n    const partyDetails = isInvoice ? billdata.vendorDetails : billdata.customerDetails;\r\n    const partyId = isInvoice ? billdata.vendor_id : billdata.customer_id;\r\n    const partyName =\r\n      partyDetails?.vendor_name || partyDetails?.full_name || partyDetails?.name || '';\r\n\r\n    setBillFormData({\r\n      invoice_no: billdata.invoice_no,\r\n      date: dayjs(billdata.date).format('YYYY-MM-DD'),\r\n      customer_id: partyId,\r\n      customer_name: partyName,\r\n      billed_by_id: billdata.billed_by_id || '',\r\n      billed_by_name: billdata.billedByDetails?.name || '',\r\n      payment_mode: billdata.payment_mode,\r\n      items:\r\n        billdata.Items?.map((item: any) => ({\r\n          _id: item._id,\r\n          product_id: item.product_id,\r\n          product_name: item.productItems?.name || item.product_name || '',\r\n          variant_name: item.productItems?.VariantItem?.variant_name || '',\r\n          stock_id: item.stock_id || item.branch_stock_id,\r\n          batch_no: item.batch_no || '',\r\n          qty: item.qty || 0,\r\n          loose_qty: item.loose_qty || 0,\r\n          price: item.price,\r\n          mrp: item.mrp || item.price,\r\n          amount: item.amount,\r\n          tax_percentage: item.tax_percentage || item.productItems?.CategoryItem?.tax_percentage || item.productItems?.tax_percentage || 0,\r\n          hsn_code: item.hsn_code || item.productItems?.hsn_code || item.productItems?.VariantItem?.hsn_code || '',\r\n          hsn_sac: item.hsn_sac || item.productItems?.hsn_sac || '',\r\n          discount: item.discount || 0,\r\n          description: item.description || '',\r\n          category_name: item.productItems?.CategoryItem?.category_name || '',\r\n        })) || [],\r\n    });\r\n\r\n    setBillSettings({\r\n      isPaid: billdata.is_paid ?? true,\r\n      isPartiallyPaid: billdata.is_partially_paid ?? false,\r\n      isRetail: billdata.sale_type === 'retail',\r\n      isGstIncluded: billdata.is_gst_included ?? true,\r\n      discount: billdata.discount ?? 0,\r\n      discountType: billdata.discount_type ?? 'percentage',\r\n      paidAmount: billdata.paid_amount ?? 0,\r\n    });\r\n\r\n    setDocumentType(billdata.document_type || 'bill');\r\n    \r\n    // Trigger callback after data is loaded\r\n    if (onLoadComplete) {\r\n      setTimeout(() => onLoadComplete(), 0);\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    billFormData,\r\n    billSettings,\r\n    documentType,\r\n    setBillFormData,\r\n    setBillSettings,\r\n    setDocumentType,\r\n    updateHeader,\r\n    updateItems,\r\n    addItem,\r\n    deleteItems,\r\n    updateSettings,\r\n    resetForm,\r\n    loadBillData,\r\n  };\r\n};\r\n\r\n","import { useState, useCallback } from 'react';\r\n\r\n/**\r\n * Hook to manage all modal states\r\n * Centralizes modal visibility and related state\r\n */\r\nexport const useBillModals = () => {\r\n  const [stockModalRowIndex, setStockModalRowIndex] = useState<number | null>(null);\r\n  const [customerModalVisible, setCustomerModalVisible] = useState(false);\r\n  const [userModalVisible, setUserModalVisible] = useState(false);\r\n  const [saveConfirmationVisible, setSaveConfirmationVisible] = useState(false);\r\n  const [billListDrawerVisible, setBillListDrawerVisible] = useState(false);\r\n  const [productDetailsModalVisible, setProductDetailsModalVisible] = useState(false);\r\n  const [productSelectionModalVisible, setProductSelectionModalVisible] = useState(false);\r\n  const [productSelectionRowIndex, setProductSelectionRowIndex] = useState<number | null>(null);\r\n  const [selectedProductId, setSelectedProductId] = useState<string>('');\r\n  const [lastInteractedRowIndex, setLastInteractedRowIndex] = useState<number>(0);\r\n  const [externalEditingCell, setExternalEditingCell] = useState<{\r\n    row: number;\r\n    col: number;\r\n  } | null>(null);\r\n\r\n  // Open stock modal for specific row\r\n  const openStockModal = useCallback((rowIndex: number) => {\r\n    setStockModalRowIndex(rowIndex);\r\n  }, []);\r\n\r\n  // Close stock modal\r\n  const closeStockModal = useCallback(() => {\r\n    setStockModalRowIndex(null);\r\n  }, []);\r\n\r\n  // Open customer modal\r\n  const openCustomerModal = useCallback(() => {\r\n    setCustomerModalVisible(true);\r\n  }, []);\r\n\r\n  // Close customer modal\r\n  const closeCustomerModal = useCallback(() => {\r\n    setCustomerModalVisible(false);\r\n  }, []);\r\n\r\n  // Open user modal\r\n  const openUserModal = useCallback(() => {\r\n    setUserModalVisible(true);\r\n  }, []);\r\n\r\n  // Close user modal\r\n  const closeUserModal = useCallback(() => {\r\n    setUserModalVisible(false);\r\n  }, []);\r\n\r\n  // Open product selection modal\r\n  const openProductSelectionModal = useCallback((rowIndex: number) => {\r\n    setProductSelectionRowIndex(rowIndex);\r\n    setProductSelectionModalVisible(true);\r\n    setLastInteractedRowIndex(rowIndex);\r\n  }, []);\r\n\r\n  // Close product selection modal\r\n  const closeProductSelectionModal = useCallback(() => {\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n  }, []);\r\n\r\n  // Open bill list drawer\r\n  const openBillListDrawer = useCallback(() => {\r\n    setBillListDrawerVisible(true);\r\n  }, []);\r\n\r\n  // Close bill list drawer\r\n  const closeBillListDrawer = useCallback(() => {\r\n    setBillListDrawerVisible(false);\r\n  }, []);\r\n\r\n  // Open save confirmation\r\n  const openSaveConfirmation = useCallback(() => {\r\n    setSaveConfirmationVisible(true);\r\n  }, []);\r\n\r\n  // Close save confirmation\r\n  const closeSaveConfirmation = useCallback(() => {\r\n    setSaveConfirmationVisible(false);\r\n  }, []);\r\n\r\n  // Open product details modal\r\n  const openProductDetailsModal = useCallback((productId: string) => {\r\n    setSelectedProductId(productId);\r\n    setProductDetailsModalVisible(true);\r\n  }, []);\r\n\r\n  // Close product details modal\r\n  const closeProductDetailsModal = useCallback(() => {\r\n    setProductDetailsModalVisible(false);\r\n    setSelectedProductId('');\r\n  }, []);\r\n\r\n  // Close all modals\r\n  const closeAllModals = useCallback(() => {\r\n    setStockModalRowIndex(null);\r\n    setCustomerModalVisible(false);\r\n    setUserModalVisible(false);\r\n    setSaveConfirmationVisible(false);\r\n    setBillListDrawerVisible(false);\r\n    setProductDetailsModalVisible(false);\r\n    setProductSelectionModalVisible(false);\r\n    setProductSelectionRowIndex(null);\r\n    setSelectedProductId('');\r\n    setExternalEditingCell(null);\r\n  }, []);\r\n\r\n  return {\r\n    // States\r\n    stockModalRowIndex,\r\n    customerModalVisible,\r\n    userModalVisible,\r\n    saveConfirmationVisible,\r\n    billListDrawerVisible,\r\n    productDetailsModalVisible,\r\n    productSelectionModalVisible,\r\n    productSelectionRowIndex,\r\n    selectedProductId,\r\n    lastInteractedRowIndex,\r\n    externalEditingCell,\r\n\r\n    // Setters\r\n    setStockModalRowIndex,\r\n    setCustomerModalVisible,\r\n    setUserModalVisible,\r\n    setSaveConfirmationVisible,\r\n    setBillListDrawerVisible,\r\n    setProductDetailsModalVisible,\r\n    setProductSelectionModalVisible,\r\n    setProductSelectionRowIndex,\r\n    setSelectedProductId,\r\n    setLastInteractedRowIndex,\r\n    setExternalEditingCell,\r\n\r\n    // Actions\r\n    openStockModal,\r\n    closeStockModal,\r\n    openCustomerModal,\r\n    closeCustomerModal,\r\n    openUserModal,\r\n    closeUserModal,\r\n    openProductSelectionModal,\r\n    closeProductSelectionModal,\r\n    openBillListDrawer,\r\n    closeBillListDrawer,\r\n    openSaveConfirmation,\r\n    closeSaveConfirmation,\r\n    openProductDetailsModal,\r\n    closeProductDetailsModal,\r\n    closeAllModals,\r\n  };\r\n};\r\n\r\n","import { useCallback } from 'react';\r\nimport { message } from 'antd';\r\nimport { BillItem } from '../../../types/entities';\r\n\r\ninterface UseBillItemsProps {\r\n  productOptions: Array<{ label: string; value: string }>;\r\n  branchId: string | undefined;\r\n  branchStockListResult: any[];\r\n  stockAuditListResult: any[];\r\n  billSettings: {\r\n    isGstIncluded: boolean;\r\n  };\r\n}\r\n\r\nexport const useBillItems = ({\r\n  productOptions,\r\n  branchId,\r\n  branchStockListResult,\r\n  stockAuditListResult,\r\n  billSettings,\r\n}: UseBillItemsProps) => {\r\n  // Calculate item amounts with proper price and tax\r\n  const calculateItemAmounts = useCallback(\r\n    (items: BillItem[]) => {\r\n      return items.map(item => {\r\n        // If no product selected at all, return as is\r\n        if (!item.product_id) return item;\r\n\r\n        // If product selected but no stock yet, preserve product data\r\n        if (!item.stock_id) {\r\n          return {\r\n            ...item,\r\n            // Preserve product/variant names and tax even without stock\r\n            product_name: item.product_name || '',\r\n            variant_name: item.variant_name || '',\r\n            tax_percentage: item.tax_percentage || 0,\r\n            category_name: item.category_name || '',\r\n          };\r\n        }\r\n\r\n        // First try to use saved stockData (for new bills where stock list isn't loaded)\r\n        const savedStockData = (item as any).stockData;\r\n        \r\n        // If no saved stockData, try to find from stockListData (for editing existing bills)\r\n        const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n        const stockFromList = stockListData.find((s: any) => s._id === item.stock_id);\r\n        \r\n        // Use saved stock data if available, otherwise use stock from list\r\n        const stock = savedStockData || stockFromList;\r\n\r\n        if (stock) {\r\n          const sellPrice = stock.sell_price || 0;\r\n          \r\n          // Get pack size from stock data\r\n          const packSize = stock?.ProductItem?.VariantItem?.pack_size || stock?.pack_size;\r\n          const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n          // Calculate loose item rate: sell_price / pack_size (since sell_price is per pack)\r\n          const looseRate = sellPrice / packSizeNum;\r\n\r\n          const baseAmount = (item.qty || 0) * sellPrice + (item.loose_qty || 0) * looseRate;\r\n\r\n          // Use tax_percentage from bill item (stored when product was selected)\r\n          // No need to lookup product - all data already in item\r\n          const taxPercentage = item.tax_percentage || 0;\r\n\r\n          let amount = baseAmount;\r\n          if (!billSettings.isGstIncluded) {\r\n            amount = baseAmount + (baseAmount * taxPercentage) / 100;\r\n          }\r\n\r\n          // Ensure batch_no is properly extracted from stockData\r\n          const batchNo = stock.batch_no || item.batch_no || '';\r\n\r\n          return {\r\n            ...item,\r\n            price: item.price || sellPrice,\r\n            mrp: stock.mrp || sellPrice,\r\n            amount: amount,\r\n            tax_percentage: taxPercentage,\r\n            // Keep product/variant names from item (already stored when selected)\r\n            product_name: item.product_name || '',\r\n            variant_name: item.variant_name || '',\r\n            category_name: item.category_name || '',\r\n            batch_no: batchNo,\r\n            stockData: {\r\n              ...stock,\r\n              batch_no: batchNo, // Ensure stockData also has batch_no\r\n            }, // Attach stock data for UI display\r\n          };\r\n        }\r\n\r\n        return item;\r\n      });\r\n    },\r\n    [branchId, branchStockListResult, stockAuditListResult, billSettings]\r\n  );\r\n\r\n  // Validate stock quantities\r\n  const validateStockQuantities = useCallback(\r\n    (items: BillItem[]) => {\r\n      return items.map(item => {\r\n        // Extract batch_no from item or stockData\r\n        const itemStockData = (item as any).stockData;\r\n        const batchNo = item.batch_no || itemStockData?.batch_no || '';\r\n        \r\n        const billItem: BillItem = {\r\n          product_id: item.product_id || '',\r\n          product_name: item.product_name || '',\r\n          variant_name: item.variant_name || '',\r\n          stock_id: item.stock_id || '',\r\n          batch_no: batchNo,\r\n          qty: item.qty || 0,\r\n          loose_qty: item.loose_qty || 0,\r\n          price: item.price || 0,\r\n          mrp: item.mrp || 0,\r\n          amount: item.amount || 0,\r\n          tax_percentage: item.tax_percentage || 0,\r\n          category_name: item.category_name || '',\r\n          stockData: itemStockData,\r\n        };\r\n\r\n        // Stock validation for pack and loose quantities\r\n        if (item.stock_id && (item.qty || item.loose_qty)) {\r\n          const stockListData = branchId ? branchStockListResult : stockAuditListResult;\r\n          const stock = stockListData.find((s: any) => s._id === item.stock_id);\r\n\r\n          if (stock) {\r\n            // Get pack size from stock data\r\n            const packSize = stock?.ProductItem?.VariantItem?.pack_size;\r\n            const packSizeNum = packSize ? parseInt(packSize) : 1;\r\n\r\n            // Available pack quantity and actual loose quantity\r\n            const availablePackQty = stock.available_quantity || 0;\r\n            const availableLooseQty = stock.available_loose_quantity || 0;\r\n\r\n            // Validate pack quantity (QTY field)\r\n            if (item.qty && item.qty > availablePackQty) {\r\n              message.error(\r\n                `Pack quantity (${item.qty}) exceeds available packs (${availablePackQty})`\r\n              );\r\n              billItem.qty = availablePackQty;\r\n            }\r\n\r\n            // Calculate max loose quantity based on remaining packs after QTY selection\r\n            const remainingPacks = availablePackQty - (item.qty || 0);\r\n            const maxLooseFromRemainingPacks = remainingPacks * packSizeNum;\r\n            const maxLooseQty = maxLooseFromRemainingPacks + availableLooseQty;\r\n\r\n            // Validate loose quantity (LOOSE QTY field)\r\n            if (item.loose_qty && item.loose_qty > maxLooseQty) {\r\n              message.error(\r\n                `Loose quantity (${item.loose_qty}) exceeds available loose items (${maxLooseQty} = ${remainingPacks} remaining packs  ${packSizeNum} + ${availableLooseQty} loose)`\r\n              );\r\n              billItem.loose_qty = maxLooseQty;\r\n            }\r\n          }\r\n        }\r\n\r\n        return billItem;\r\n      });\r\n    },\r\n    [branchId, branchStockListResult, stockAuditListResult]\r\n  );\r\n\r\n  const handleItemsChange = useCallback(\r\n    (items: any[]): BillItem[] => {\r\n      // First validate stock quantities\r\n      const validatedItems = validateStockQuantities(items);\r\n\r\n      // Then calculate amounts\r\n      const itemsWithAmounts = calculateItemAmounts(validatedItems);\r\n\r\n      return itemsWithAmounts;\r\n    },\r\n    [validateStockQuantities, calculateItemAmounts]\r\n  );\r\n\r\n  return {\r\n    handleItemsChange,\r\n    calculateItemAmounts,\r\n    validateStockQuantities,\r\n  };\r\n};\r\n\r\n","import { useState, useCallback } from 'react';\r\nimport { message } from 'antd';\r\nimport dayjs from 'dayjs';\r\nimport { useDispatch } from 'react-redux';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\ninterface BillActionsConfig {\r\n  billFormData: any;\r\n  billSettings: any;\r\n  billCalculations: any;\r\n  documentType: 'bill' | 'invoice';\r\n  branchId?: string;\r\n  createSalesRecord: any;\r\n  updateSalesRecord: any;\r\n  createInvoiceNumber: any;\r\n  billdata?: any;\r\n  onSuccess?: () => void;\r\n  onSaveSuccess?: (savedData: any) => void;\r\n}\r\n\r\n/**\r\n * Hook to handle all bill actions: save, print, clear\r\n * Manages save draft, complete bill, print operations\r\n */\r\nexport const useBillActions = (config: BillActionsConfig) => {\r\n  const dispatch = useDispatch();\r\n  const [savedBillData, setSavedBillData] = useState<any>(null);\r\n  const [createResponse, setCreateResponse] = useState<any>(null);\r\n  const [updateResponse, setUpdateResponse] = useState<any>(null);\r\n\r\n  // Validate stock quantities\r\n  const validateStockQuantities = useCallback((items: any[]) => {\r\n    const errors: string[] = [];\r\n    // Add your validation logic here\r\n    return errors;\r\n  }, []);\r\n\r\n  // Save draft (minimal validation)\r\n  const handleSaveDraft = useCallback(async () => {\r\n    if (!config.billFormData.invoice_no) {\r\n      message.error('Please enter an invoice number');\r\n      return false;\r\n    }\r\n\r\n    if (!config.billFormData.items || config.billFormData.items.length === 0) {\r\n      message.error('Please add at least one product/item to save as draft');\r\n      return false;\r\n    }\r\n\r\n    const validItems = config.billFormData.items.filter((item: any) => item.product_id);\r\n    if (validItems.length === 0) {\r\n      message.error('Please add at least one product/item to save as draft');\r\n      return false;\r\n    }\r\n\r\n    const payload = {\r\n      invoice_no: config.billFormData.invoice_no,\r\n      date: config.billFormData.date || dayjs().format('YYYY-MM-DD'),\r\n      ...(config.documentType === 'invoice'\r\n        ? { vendor_id: config.billFormData.customer_id || null }\r\n        : { customer_id: config.billFormData.customer_id || null }),\r\n      billed_by_id: config.billFormData.billed_by_id || null,\r\n      payment_mode: config.billFormData.payment_mode || 'cash',\r\n      items: config.billFormData.items.map((item: any) => ({\r\n        product_id: item.product_id || null,\r\n        stock_id: item.stock_id || null,\r\n        ...(config.branchId && item.stock_id && { branch_stock_id: item.stock_id }),\r\n        qty: item.qty || 0,\r\n        loose_qty: item.loose_qty || 0,\r\n        price: item.price || 0,\r\n        mrp: item.mrp || 0,\r\n        amount: item.amount || 0,\r\n        tax_percentage: item.tax_percentage || 0,\r\n        _id: item._id,\r\n      })),\r\n      ...config.billCalculations,\r\n      discount: config.billSettings.discount,\r\n      discount_type: config.billSettings.discountType,\r\n      is_paid: config.billSettings.isPaid,\r\n      is_partially_paid: config.billSettings.isPartiallyPaid,\r\n      sale_type: config.billSettings.isRetail ? 'retail' : 'wholesale',\r\n      is_gst_included: config.billSettings.isGstIncluded,\r\n      paid_amount: config.billSettings.isPartiallyPaid\r\n        ? config.billSettings.paidAmount\r\n        : config.billSettings.isPaid\r\n          ? config.billCalculations.total_amount\r\n          : 0,\r\n      status: 'draft',\r\n      document_type: config.documentType,\r\n    };\r\n\r\n    try {\r\n      let response: any;\r\n      if (config.billdata) {\r\n        const result = await config.updateSalesRecord(config.billdata._id, payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setUpdateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      } else {\r\n        const result = await config.createSalesRecord(payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setCreateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      }\r\n\r\n      if (response?.statusCode === 200) {\r\n        message.success('Draft saved successfully!');\r\n        const savedData = {\r\n          ...payload,\r\n          customer_name: config.billFormData.customer_name,\r\n          total_amount: config.billCalculations.total_amount,\r\n        };\r\n        setSavedBillData(savedData);\r\n        config.onSaveSuccess?.(savedData);\r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      message.error('Failed to save draft. Please try again.');\r\n      return false;\r\n    }\r\n  }, [config, dispatch]);\r\n\r\n  // Complete bill (full validation)\r\n  const handleCompleteBill = useCallback(async () => {\r\n    if (\r\n      !config.billFormData.invoice_no ||\r\n      !config.billFormData.customer_id ||\r\n      !config.billFormData.items.length\r\n    ) {\r\n      message.error('Please fill all required fields');\r\n      return false;\r\n    }\r\n\r\n    const incompleteItems = config.billFormData.items.some(\r\n      (item: any) =>\r\n        !item.product_id || !item.stock_id || (!item.qty && !item.loose_qty) || !item.price\r\n    );\r\n\r\n    if (incompleteItems) {\r\n      message.error('Please complete all item details');\r\n      return false;\r\n    }\r\n\r\n    const stockValidationErrors = validateStockQuantities(config.billFormData.items);\r\n    if (stockValidationErrors.length > 0) {\r\n      message.error(`Stock validation errors:\\n${stockValidationErrors.join('\\n')}`);\r\n      return false;\r\n    }\r\n\r\n    const payload = {\r\n      invoice_no: config.billFormData.invoice_no,\r\n      date: config.billFormData.date,\r\n      ...(config.documentType === 'invoice'\r\n        ? { vendor_id: config.billFormData.customer_id }\r\n        : { customer_id: config.billFormData.customer_id }),\r\n      billed_by_id: config.billFormData.billed_by_id,\r\n      payment_mode: config.billFormData.payment_mode,\r\n      items: config.billFormData.items.map((item: any) => ({\r\n        product_id: item.product_id,\r\n        stock_id: item.stock_id,\r\n        ...(config.branchId && { branch_stock_id: item.stock_id }),\r\n        qty: item.qty,\r\n        loose_qty: item.loose_qty,\r\n        price: item.price,\r\n        mrp: item.mrp,\r\n        amount: item.amount,\r\n        tax_percentage: item.tax_percentage,\r\n        hsn_code: item.hsn_code || '',\r\n        hsn_sac: item.hsn_sac || '',\r\n        discount: item.discount || 0,\r\n        description: item.description || '',\r\n        product_name: item.product_name || '',\r\n        variant_name: item.variant_name || '',\r\n        _id: item._id,\r\n      })),\r\n      ...config.billCalculations,\r\n      discount: config.billSettings.discount,\r\n      discount_type: config.billSettings.discountType,\r\n      is_paid: config.billSettings.isPaid,\r\n      is_partially_paid: config.billSettings.isPartiallyPaid,\r\n      sale_type: config.billSettings.isRetail ? 'retail' : 'wholesale',\r\n      is_gst_included: config.billSettings.isGstIncluded,\r\n      paid_amount: config.billSettings.isPartiallyPaid\r\n        ? config.billSettings.paidAmount\r\n        : config.billSettings.isPaid\r\n          ? config.billCalculations.total_amount\r\n          : 0,\r\n      status: 'completed',\r\n      document_type: config.documentType,\r\n    };\r\n\r\n    try {\r\n      let response: any;\r\n      if (config.billdata) {\r\n        const result = await config.updateSalesRecord(config.billdata._id, payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setUpdateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      } else {\r\n        const result = await config.createSalesRecord(payload);\r\n        if (result.data) {\r\n          response = result.data;\r\n          setCreateResponse(response);\r\n        } else {\r\n          throw result.error;\r\n        }\r\n      }\r\n\r\n      if (response?.statusCode === 200) {\r\n        const savedData = {\r\n          ...payload,\r\n          customer_name: config.billFormData.customer_name,\r\n          total_amount: config.billCalculations.total_amount,\r\n        };\r\n        setSavedBillData(savedData);\r\n\r\n        // Invalidate stock caches\r\n        dispatch(apiSlice.util.invalidateTags(['StockAudit', 'BranchStock']));\r\n\r\n        config.onSaveSuccess?.(savedData);\r\n        \r\n        // Create new invoice number for next bill\r\n        if (!config.billdata) {\r\n          config.createInvoiceNumber({});\r\n        }\r\n        \r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      message.error('Failed to complete bill. Please try again.');\r\n      return false;\r\n    }\r\n  }, [config, validateStockQuantities, dispatch]);\r\n\r\n  return {\r\n    savedBillData,\r\n    createResponse,\r\n    updateResponse,\r\n    handleSaveDraft,\r\n    handleCompleteBill,\r\n    setSavedBillData,\r\n    setCreateResponse,\r\n    setUpdateResponse,\r\n  };\r\n};\r\n\r\n","import { useEffect } from 'react';\r\nimport { message } from 'antd';\r\n\r\ninterface KeyboardShortcutsConfig {\r\n  onF1AddItem: () => void;\r\n  onF2SaveDraft: () => void;\r\n  onF3CompleteBill: () => void;\r\n  onF4Clear: () => void;\r\n  onF5ProductSelection: () => void;\r\n  onF6BillList: () => void;\r\n  onF7StockSelection: () => void;\r\n  onF8Print: () => void;\r\n  onEndCustomer: () => void;\r\n  onCtrlU: () => void;\r\n  onCtrlS: () => void;\r\n  onCtrlN: () => void;\r\n  onCtrlP: () => void;\r\n  onCtrlR: () => void;\r\n}\r\n\r\n/**\r\n * Hook to manage keyboard shortcuts for the bill\r\n * Ultra-fast billing with keyboard-first interface\r\n */\r\nexport const useBillKeyboardShortcuts = (config: KeyboardShortcutsConfig) => {\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // Function keys\r\n      if (e.key === 'F1') {\r\n        e.preventDefault();\r\n        config.onF1AddItem();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F2') {\r\n        e.preventDefault();\r\n        config.onF2SaveDraft();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F3') {\r\n        e.preventDefault();\r\n        config.onF3CompleteBill();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F4') {\r\n        e.preventDefault();\r\n        config.onF4Clear();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F5') {\r\n        e.preventDefault();\r\n        config.onF5ProductSelection();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F6') {\r\n        e.preventDefault();\r\n        config.onF6BillList();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F7') {\r\n        e.preventDefault();\r\n        config.onF7StockSelection();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'F8') {\r\n        e.preventDefault();\r\n        config.onF8Print();\r\n        return;\r\n      }\r\n\r\n      if (e.key === 'End') {\r\n        e.preventDefault();\r\n        config.onEndCustomer();\r\n        return;\r\n      }\r\n\r\n      // Ctrl key combinations\r\n      if (e.ctrlKey) {\r\n        switch (e.key) {\r\n          case 's':\r\n            e.preventDefault();\r\n            config.onCtrlS();\r\n            break;\r\n          case 'n':\r\n            e.preventDefault();\r\n            config.onCtrlN();\r\n            break;\r\n          case 'p':\r\n            e.preventDefault();\r\n            config.onCtrlP();\r\n            break;\r\n          case 'r':\r\n            e.preventDefault();\r\n            config.onCtrlR();\r\n            break;\r\n          case 'u':\r\n            e.preventDefault();\r\n            config.onCtrlU();\r\n            break;\r\n        }\r\n      }\r\n\r\n      // Quick quantity entry (Ctrl + 0-9)\r\n      if (e.ctrlKey && /^[0-9]$/.test(e.key)) {\r\n        e.preventDefault();\r\n        const activeElement = document.activeElement as HTMLElement;\r\n        if (activeElement?.closest('td[data-column-key=\"qty\"]')) {\r\n          const input = activeElement.querySelector('input') as HTMLInputElement;\r\n          if (input) {\r\n            input.value = e.key;\r\n            input.dispatchEvent(new Event('change', { bubbles: true }));\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', handleKeyDown);\r\n    return () => document.removeEventListener('keydown', handleKeyDown);\r\n  }, [config]);\r\n\r\n  // Return keyboard shortcut info\r\n  return {\r\n    shortcuts: [\r\n      { key: 'F1', description: 'Add Item' },\r\n      { key: 'F2', description: 'Save Draft' },\r\n      { key: 'F3', description: 'Complete Bill' },\r\n      { key: 'F4', description: 'Clear Form' },\r\n      { key: 'F5', description: 'Select Product' },\r\n      { key: 'F6', description: 'Bill List' },\r\n      { key: 'F7', description: 'Select Stock' },\r\n      { key: 'F8', description: 'Print' },\r\n      { key: 'End', description: 'Select Customer' },\r\n      { key: 'Ctrl+U', description: 'Select User' },\r\n      { key: 'Ctrl+S', description: 'Save' },\r\n      { key: 'Ctrl+N', description: 'Add Item' },\r\n      { key: 'Ctrl+R', description: 'Reset' },\r\n      { key: 'Tab', description: 'Navigate' },\r\n      { key: 'Enter', description: 'Edit' },\r\n      { key: 'Esc', description: 'Cancel' },\r\n    ],\r\n  };\r\n};\r\n\r\n","import React from 'react';\r\nimport { FileTextOutlined, PrinterOutlined } from '@ant-design/icons';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\ninterface DocumentTypeToggleProps {\r\n  value: 'bill' | 'invoice';\r\n  onChange: (value: 'bill' | 'invoice') => void;\r\n}\r\n\r\n/**\r\n * Compact Document Type Toggle\r\n * Matches the style of SALE TYPE, GST, PAYMENT toggles\r\n */\r\nconst DocumentTypeToggle: React.FC<DocumentTypeToggleProps> = ({\r\n  value,\r\n  onChange,\r\n}) => {\r\n  return (\r\n    <div\r\n      style={{\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        gap: 8,\r\n        background: '#fff',\r\n        padding: '6px 12px',\r\n        borderRadius: 10,\r\n        boxShadow: '0 2px 6px rgba(0,0,0,0.08)',\r\n      }}\r\n    >\r\n      {/* Label */}\r\n      <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\r\n        <FileTextOutlined style={{ fontSize: 15, color: '#667eea' }} />\r\n        <span style={{ fontWeight: 600, fontSize: 12, color: '#333' }}>\r\n          PRINT TYPE\r\n        </span>\r\n      </div>\r\n\r\n      {/* Toggle Switch */}\r\n      <div\r\n        onClick={() => onChange(value === 'bill' ? 'invoice' : 'bill')}\r\n        style={{\r\n          position: 'relative',\r\n          width: 100,\r\n          height: 30,\r\n          borderRadius: 16,\r\n          background:\r\n            value === 'bill'\r\n              ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'\r\n              : 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',\r\n          cursor: 'pointer',\r\n          transition: 'all 0.3s ease',\r\n          boxShadow: '0 2px 6px rgba(0,0,0,0.15)',\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: value === 'bill' ? 'flex-start' : 'flex-end',\r\n          padding: '0 3px',\r\n        }}\r\n      >\r\n        {/* Toggle Circle */}\r\n        <div\r\n          style={{\r\n            width: 24,\r\n            height: 24,\r\n            borderRadius: '50%',\r\n            background: '#fff',\r\n            boxShadow: '0 2px 4px rgba(0,0,0,0.2)',\r\n            transition: 'all 0.3s ease',\r\n          }}\r\n        />\r\n\r\n        {/* Label inside toggle */}\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            left: value === 'bill' ? 32 : 'auto',\r\n            right: value === 'invoice' ? 32 : 'auto',\r\n            color: '#fff',\r\n            fontWeight: 'bold',\r\n            fontSize: 10,\r\n            letterSpacing: 0.5,\r\n            userSelect: 'none',\r\n          }}\r\n        >\r\n          {value === 'bill' ? 'BILL' : 'INVOICE'}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DocumentTypeToggle;\r\n","// extracted by mini-css-extract-plugin\nexport default {\"mainContainer\":\"BillDataGrid_mainContainer__Jnuo1\",\"gradientShift\":\"BillDataGrid_gradientShift__hhIW9\",\"backgroundCircle1\":\"BillDataGrid_backgroundCircle1__5PBPG\",\"float\":\"BillDataGrid_float__1VyT0\",\"backgroundCircle2\":\"BillDataGrid_backgroundCircle2__J+xMs\",\"backgroundCircle3\":\"BillDataGrid_backgroundCircle3__AgoEw\",\"backgroundCircle4\":\"BillDataGrid_backgroundCircle4__86Xfd\",\"backgroundCircle5\":\"BillDataGrid_backgroundCircle5__qpbiT\",\"headerContainer\":\"BillDataGrid_headerContainer__wfojf\",\"slideInDown\":\"BillDataGrid_slideInDown__l3LU5\",\"headerCircle1\":\"BillDataGrid_headerCircle1__8+aPI\",\"headerCircle2\":\"BillDataGrid_headerCircle2__Z9w17\",\"headerCircle3\":\"BillDataGrid_headerCircle3__3eMNm\",\"pulse\":\"BillDataGrid_pulse__EVfnw\",\"headerCircle4\":\"BillDataGrid_headerCircle4__fVITr\",\"headerCircle5\":\"BillDataGrid_headerCircle5__0E6vl\",\"headerContent\":\"BillDataGrid_headerContent__6Rnkr\",\"titleSection\":\"BillDataGrid_titleSection__LBuxT\",\"fadeInLeft\":\"BillDataGrid_fadeInLeft__YHJna\",\"titleIcon\":\"BillDataGrid_titleIcon__qffZU\",\"bounce\":\"BillDataGrid_bounce__fYaGs\",\"titleText\":\"BillDataGrid_titleText__XlvSS\",\"slideInRight\":\"BillDataGrid_slideInRight__+-bkg\",\"subtitleText\":\"BillDataGrid_subtitleText__Hgyav\",\"fadeInUp\":\"BillDataGrid_fadeInUp__Y00FE\",\"controlsSection\":\"BillDataGrid_controlsSection__PSC3w\",\"fadeInRight\":\"BillDataGrid_fadeInRight__eA5Bm\",\"controlGroup\":\"BillDataGrid_controlGroup__AFGBT\",\"saleTypeControl\":\"BillDataGrid_saleTypeControl__hzHpa\",\"slideInUp\":\"BillDataGrid_slideInUp__ZuvW2\",\"gstControl\":\"BillDataGrid_gstControl__AiGdY\",\"paymentControl\":\"BillDataGrid_paymentControl__BD0r9\",\"partialPaymentControl\":\"BillDataGrid_partialPaymentControl__unngo\",\"controlLabel\":\"BillDataGrid_controlLabel__QP4fP\",\"badgesContainer\":\"BillDataGrid_badgesContainer__bqqSt\",\"itemsBadge\":\"BillDataGrid_itemsBadge__o0Uro\",\"amountBadge\":\"BillDataGrid_amountBadge__IPSqT\",\"badgeText\":\"BillDataGrid_badgeText__9cTal\",\"invoiceDetailsGrid\":\"BillDataGrid_invoiceDetailsGrid__QPpaj\",\"itemsSection\":\"BillDataGrid_itemsSection__vJE1b\",\"itemsCircle1\":\"BillDataGrid_itemsCircle1__PQoMB\",\"rotate\":\"BillDataGrid_rotate__l3nA9\",\"itemsCircle2\":\"BillDataGrid_itemsCircle2__0lWcR\",\"scaleIn\":\"BillDataGrid_scaleIn__xFZvA\",\"billItemsGrid\":\"BillDataGrid_billItemsGrid__jpWQo\",\"billItemsHeader\":\"BillDataGrid_billItemsHeader__hxL0O\",\"billItemsTitle\":\"BillDataGrid_billItemsTitle__MQduV\",\"billItemsBadge\":\"BillDataGrid_billItemsBadge__vdJMk\",\"billSummary\":\"BillDataGrid_billSummary__yA4j-\",\"summaryCircle1\":\"BillDataGrid_summaryCircle1__PuveY\",\"summaryCircle2\":\"BillDataGrid_summaryCircle2__fdcks\",\"summaryHeader\":\"BillDataGrid_summaryHeader__h1BtQ\",\"summaryTitle\":\"BillDataGrid_summaryTitle__dSOoP\",\"summaryRow\":\"BillDataGrid_summaryRow__yUShR\",\"summaryLabel\":\"BillDataGrid_summaryLabel__cLnHd\",\"summaryValue\":\"BillDataGrid_summaryValue__LUh-6\",\"summaryTotal\":\"BillDataGrid_summaryTotal__ujvAB\",\"summaryTable\":\"BillDataGrid_summaryTable__ZpVlt\",\"totalAmountRow\":\"BillDataGrid_totalAmountRow__JXMuL\",\"totalAmountLabel\":\"BillDataGrid_totalAmountLabel__IVRMe\",\"totalAmountValue\":\"BillDataGrid_totalAmountValue__5W5mL\",\"discountValue\":\"BillDataGrid_discountValue__QjPij\",\"partialPaymentInfo\":\"BillDataGrid_partialPaymentInfo__OpO+-\",\"partialPaymentRow\":\"BillDataGrid_partialPaymentRow__Qy-Ni\",\"partialPaymentLabel\":\"BillDataGrid_partialPaymentLabel__yEvTO\",\"partialPaymentValue\":\"BillDataGrid_partialPaymentValue__SLg8d\",\"controlsContainer\":\"BillDataGrid_controlsContainer__2jCRg\",\"discountControl\":\"BillDataGrid_discountControl__n0WOI\",\"discountControlLabel\":\"BillDataGrid_discountControlLabel__0iwJ9\",\"discountControlInputs\":\"BillDataGrid_discountControlInputs__TbgUU\",\"partialPaymentControlLabel\":\"BillDataGrid_partialPaymentControlLabel__lxP98\",\"summaryTotalLabel\":\"BillDataGrid_summaryTotalLabel__u+656\",\"summaryTotalValue\":\"BillDataGrid_summaryTotalValue__sKz9B\",\"partialPaymentBalance\":\"BillDataGrid_partialPaymentBalance__lFxZE\",\"discountLabel\":\"BillDataGrid_discountLabel__906vd\",\"discountInputs\":\"BillDataGrid_discountInputs__9BUMD\",\"actionHub\":\"BillDataGrid_actionHub__SlPSg\",\"actionButtonsContainer\":\"BillDataGrid_actionButtonsContainer__BcfKu\",\"actionHubCircle1\":\"BillDataGrid_actionHubCircle1__ggNzA\",\"actionHubCircle2\":\"BillDataGrid_actionHubCircle2__Nb-oj\",\"actionHubCircle3\":\"BillDataGrid_actionHubCircle3__D2pna\",\"actionHubCircle4\":\"BillDataGrid_actionHubCircle4__ayVXK\",\"actionButtons\":\"BillDataGrid_actionButtons__tQbXu\",\"saveButton\":\"BillDataGrid_saveButton__vWggk\",\"billListButton\":\"BillDataGrid_billListButton__ahHFc\",\"refreshButton\":\"BillDataGrid_refreshButton__XnoTE\",\"printButton\":\"BillDataGrid_printButton__nkIDd\",\"downloadButton\":\"BillDataGrid_downloadButton__Jsy5n\",\"clearButton\":\"BillDataGrid_clearButton__518xA\",\"shortcutsInfo\":\"BillDataGrid_shortcutsInfo__kN1Ka\",\"shortcutsText\":\"BillDataGrid_shortcutsText__qGuNn\",\"customerField\":\"BillDataGrid_customerField__+4wOA\",\"customerFieldEndKey\":\"BillDataGrid_customerFieldEndKey__HaMh6\",\"stockField\":\"BillDataGrid_stockField__BQirP\",\"stockFieldSelected\":\"BillDataGrid_stockFieldSelected__x7NU5\",\"stockFieldIcon\":\"BillDataGrid_stockFieldIcon__WeVkj\",\"stockFieldWarning\":\"BillDataGrid_stockFieldWarning__7Lv+C\",\"saleTypeSwitch\":\"BillDataGrid_saleTypeSwitch__Xa4gR\",\"ant-switch-checked\":\"BillDataGrid_ant-switch-checked__rQynk\",\"gstSwitch\":\"BillDataGrid_gstSwitch__ZQG0t\",\"paymentSwitch\":\"BillDataGrid_paymentSwitch__KxB-J\",\"partialPaymentSwitch\":\"BillDataGrid_partialPaymentSwitch__5nNFs\",\"keyboardShortcuts\":\"BillDataGrid_keyboardShortcuts__2e-4z\",\"keyboardShortcutsContent\":\"BillDataGrid_keyboardShortcutsContent__5FpEl\",\"keyboardShortcutsText\":\"BillDataGrid_keyboardShortcutsText__A58I9\",\"slideInLeft\":\"BillDataGrid_slideInLeft__TTFPm\"};","import React from 'react';\r\nimport { Typography, Switch, Badge } from 'antd';\r\nimport { FileTextOutlined } from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport DocumentTypeToggle from './DocumentTypeToggle';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillTopBarProps {\r\n  billdata?: any;\r\n  documentType: 'bill' | 'invoice';\r\n  billSettings: {\r\n    isRetail: boolean;\r\n    isGstIncluded: boolean;\r\n    isPaid: boolean;\r\n    isPartiallyPaid: boolean;\r\n  };\r\n  itemCount: number;\r\n  totalAmount: number;\r\n  onDocumentTypeChange: (type: 'bill' | 'invoice') => void;\r\n  onSettingsChange: (settings: Partial<any>) => void;\r\n}\r\n\r\nconst BillTopBar: React.FC<BillTopBarProps> = ({\r\n  billdata,\r\n  documentType,\r\n  billSettings,\r\n  itemCount,\r\n  totalAmount,\r\n  onDocumentTypeChange,\r\n  onSettingsChange,\r\n}) => {\r\n  return (\r\n    <div className={styles.headerContainer}>\r\n      {/* Animated decorative background elements */}\r\n      <div className={styles.headerCircle1} />\r\n      <div className={styles.headerCircle2} />\r\n      <div className={styles.headerCircle3} />\r\n      <div className={styles.headerCircle4} />\r\n      <div className={styles.headerCircle5} />\r\n\r\n      <div className={styles.headerContent}>\r\n        {/* Title Section */}\r\n        <div className={styles.titleSection}>\r\n          <div className={styles.titleIcon}>\r\n            <FileTextOutlined style={{ fontSize: '24px', color: 'white' }} />\r\n          </div>\r\n          <div>\r\n            <Title level={4} className={styles.titleText}>\r\n              {billdata ? ' EDIT INVOICE' : ' NEW INVOICE'}\r\n            </Title>\r\n            <Text className={styles.subtitleText}>\r\n              Lightning Fast  {dayjs().format('DD MMM YYYY, dddd')}\r\n            </Text>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Controls Section */}\r\n        <div className={styles.controlsSection}>\r\n          {/* Document Type Toggle */}\r\n          <div style={{ marginRight: '12px' }}>\r\n            <DocumentTypeToggle value={documentType} onChange={onDocumentTypeChange} />\r\n          </div>\r\n\r\n          {/* Sale Type */}\r\n          <div className={`${styles.controlGroup} ${styles.saleTypeControl}`}>\r\n            <Text className={styles.controlLabel}> SALE TYPE</Text>\r\n            <Switch\r\n              checkedChildren=\"RETAIL\"\r\n              unCheckedChildren=\"WHOLESALE\"\r\n              checked={billSettings.isRetail}\r\n              onChange={checked => onSettingsChange({ isRetail: checked })}\r\n              className={styles.saleTypeSwitch}\r\n              size=\"small\"\r\n            />\r\n          </div>\r\n\r\n          {/* GST Toggle */}\r\n          <div className={`${styles.controlGroup} ${styles.gstControl}`}>\r\n            <Text className={styles.controlLabel}> GST</Text>\r\n            <Switch\r\n              checkedChildren=\"INCL\"\r\n              unCheckedChildren=\"EXCL\"\r\n              checked={billSettings.isGstIncluded}\r\n              onChange={checked => onSettingsChange({ isGstIncluded: checked })}\r\n              className={styles.gstSwitch}\r\n              size=\"small\"\r\n            />\r\n          </div>\r\n\r\n          {/* Payment Status */}\r\n          <div className={`${styles.controlGroup} ${styles.paymentControl}`}>\r\n            <Text className={styles.controlLabel}> PAYMENT</Text>\r\n            <Switch\r\n              checkedChildren=\"PAID\"\r\n              unCheckedChildren=\"UNPAID\"\r\n              checked={billSettings.isPaid}\r\n              onChange={checked =>\r\n                onSettingsChange({\r\n                  isPaid: checked,\r\n                  isPartiallyPaid: checked ? false : billSettings.isPartiallyPaid,\r\n                })\r\n              }\r\n              className={styles.paymentSwitch}\r\n              size=\"small\"\r\n            />\r\n          </div>\r\n\r\n          {/* Partial Payment */}\r\n          {!billSettings.isPaid && (\r\n            <div className={`${styles.controlGroup} ${styles.partialPaymentControl}`}>\r\n              <Text className={styles.controlLabel}> PARTIAL</Text>\r\n              <Switch\r\n                checkedChildren=\"YES\"\r\n                unCheckedChildren=\"NO\"\r\n                checked={billSettings.isPartiallyPaid}\r\n                onChange={checked => onSettingsChange({ isPartiallyPaid: checked })}\r\n                className={styles.partialPaymentSwitch}\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* Items and Amount Badges */}\r\n          <div className={styles.badgesContainer}>\r\n            <div className={styles.itemsBadge}>\r\n              <Text className={styles.badgeText}> ITEMS: {itemCount}</Text>\r\n            </div>\r\n            <div className={styles.amountBadge}>\r\n              <Text className={styles.badgeText}> {totalAmount.toFixed(2)}</Text>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillTopBar;\r\n\r\n","import React, { useMemo } from 'react';\r\nimport { Typography, Tooltip } from 'antd';\r\nimport AntdEditableTable, {\r\n  AntdEditableColumn,\r\n} from '../../../components/common/AntdEditableTable';\r\n\r\nconst { Text } = Typography;\r\n\r\ninterface BillHeaderProps {\r\n  billFormData: {\r\n    invoice_no: string;\r\n    date: string;\r\n    customer_id: string;\r\n    customer_name?: string;\r\n    billed_by_id?: string;\r\n    billed_by_name?: string;\r\n    payment_mode: string;\r\n  };\r\n  customerOrVendorOptions: Array<{ label: string; value: string }>;\r\n  userOptions: Array<{ label: string; value: string }>;\r\n  documentType: 'bill' | 'invoice';\r\n  onHeaderChange: (headerRows: any[]) => void;\r\n  onCustomerModalOpen: () => void;\r\n  onUserModalOpen: () => void;\r\n  loading: boolean;\r\n}\r\n\r\nconst BillHeader: React.FC<BillHeaderProps> = ({\r\n  billFormData,\r\n  customerOrVendorOptions,\r\n  userOptions,\r\n  documentType,\r\n  onHeaderChange,\r\n  onCustomerModalOpen,\r\n  onUserModalOpen,\r\n  loading,\r\n}) => {\r\n  const headerColumns: AntdEditableColumn[] = useMemo(\r\n    () => [\r\n      {\r\n        key: 'invoice_no',\r\n        title: ' INVOICE #',\r\n        dataIndex: 'invoice_no',\r\n        type: 'text',\r\n        required: true,\r\n        width: 180,\r\n      },\r\n      {\r\n        key: 'date',\r\n        title: ' DATE',\r\n        dataIndex: 'date',\r\n        type: 'date',\r\n        required: true,\r\n        width: 150,\r\n      },\r\n      {\r\n        key: 'customer_id',\r\n        title: documentType === 'bill' ? ' CUSTOMER' : ' VENDOR',\r\n        dataIndex: 'customer_id',\r\n        type: 'text',\r\n        editable: false,\r\n        required: true,\r\n        width: 250,\r\n        render: (value: any) => {\r\n          const selectedItem = customerOrVendorOptions.find(\r\n            (opt: any) => opt.value === value\r\n          );\r\n          const isVendor = documentType === 'invoice';\r\n          const placeholderText = isVendor ? 'Select vendor' : 'Select customer';\r\n          const displayLabel =\r\n            selectedItem?.label || billFormData.customer_name || placeholderText;\r\n          const tooltipText = isVendor\r\n            ? 'Click to open vendor selection modal (or press End key)'\r\n            : 'Click to open customer selection modal (or press End key)';\r\n\r\n          return (\r\n            <Tooltip title={tooltipText}>\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#fafafa',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={onCustomerModalOpen}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f0f0';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#fafafa';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>{displayLabel}</span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#f0f8ff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  End\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'billed_by_id',\r\n        title: ' BILLED BY',\r\n        dataIndex: 'billed_by_id',\r\n        type: 'text',\r\n        editable: false,\r\n        required: false,\r\n        width: 250,\r\n        render: (value: any) => {\r\n          const selectedUser = userOptions.find((opt: any) => opt.value === value);\r\n          const displayLabel = selectedUser?.label || billFormData.billed_by_name || 'Select user';\r\n          return (\r\n            <Tooltip title=\"Click to open user selection modal (or press Ctrl+U key)\">\r\n              <div\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  cursor: 'pointer',\r\n                  padding: '4px 8px',\r\n                  borderRadius: '4px',\r\n                  border: '1px solid #d9d9d9',\r\n                  backgroundColor: '#f0f8ff',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onClick={onUserModalOpen}\r\n                onMouseEnter={e => {\r\n                  e.currentTarget.style.backgroundColor = '#e6f7ff';\r\n                  e.currentTarget.style.borderColor = '#1890ff';\r\n                }}\r\n                onMouseLeave={e => {\r\n                  e.currentTarget.style.backgroundColor = '#f0f8ff';\r\n                  e.currentTarget.style.borderColor = '#d9d9d9';\r\n                }}\r\n              >\r\n                <span>{displayLabel}</span>\r\n                <span\r\n                  style={{\r\n                    fontSize: '10px',\r\n                    color: '#1890ff',\r\n                    backgroundColor: '#ffffff',\r\n                    padding: '2px 6px',\r\n                    borderRadius: '4px',\r\n                    border: '1px solid #d6e4ff',\r\n                  }}\r\n                >\r\n                  Ctrl+U\r\n                </span>\r\n              </div>\r\n            </Tooltip>\r\n          );\r\n        },\r\n      },\r\n      {\r\n        key: 'payment_mode',\r\n        title: ' PAYMENT',\r\n        dataIndex: 'payment_mode',\r\n        type: 'select',\r\n        options: [\r\n          { label: ' Cash', value: 'cash' },\r\n          { label: ' UPI', value: 'upi' },\r\n          { label: ' Card', value: 'card' },\r\n        ],\r\n        required: true,\r\n        width: 150,\r\n      },\r\n    ],\r\n    [customerOrVendorOptions, userOptions, documentType, onCustomerModalOpen, onUserModalOpen]\r\n  );\r\n\r\n  const headerData = useMemo(\r\n    () => [\r\n      {\r\n        invoice_no: billFormData.invoice_no,\r\n        date: billFormData.date,\r\n        customer_id: billFormData.customer_id,\r\n        billed_by_id: billFormData.billed_by_id,\r\n        payment_mode: billFormData.payment_mode,\r\n      },\r\n    ],\r\n    [\r\n      billFormData.invoice_no,\r\n      billFormData.date,\r\n      billFormData.customer_id,\r\n      billFormData.billed_by_id,\r\n      billFormData.payment_mode,\r\n    ]\r\n  );\r\n\r\n  return (\r\n    <AntdEditableTable\r\n      columns={headerColumns}\r\n      dataSource={headerData}\r\n      onSave={onHeaderChange}\r\n      allowAdd={false}\r\n      allowDelete={false}\r\n      loading={loading}\r\n      className=\"compact-header-grid\"\r\n      size=\"small\"\r\n      rowKey=\"invoice_no\"\r\n    />\r\n  );\r\n};\r\n\r\nexport default BillHeader;\r\n\r\n","import React from 'react';\r\nimport { Typography, InputNumber, Switch } from 'antd';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\nconst { Text } = Typography;\r\n\r\ninterface BillSummaryProps {\r\n  billCalculations: {\r\n    sub_total: number;\r\n    value_of_goods: number;\r\n    total_gst: number;\r\n    cgst: number;\r\n    sgst: number;\r\n    total_amount: number;\r\n    discountValue: number;\r\n  };\r\n  billSettings: {\r\n    discount: number;\r\n    discountType: 'percentage' | 'amount';\r\n    isPaid: boolean;\r\n    isPartiallyPaid: boolean;\r\n    paidAmount: number;\r\n  };\r\n  onDiscountChange: (value: number) => void;\r\n  onDiscountTypeChange: (checked: boolean) => void;\r\n  onPaidAmountChange: (value: number) => void;\r\n}\r\n\r\nconst BillSummary: React.FC<BillSummaryProps> = ({\r\n  billCalculations,\r\n  billSettings,\r\n  onDiscountChange,\r\n  onDiscountTypeChange,\r\n  onPaidAmountChange,\r\n}) => {\r\n  return (\r\n    <div className={styles.billSummary}>\r\n      {/* Decorative half circles for summary */}\r\n      <div className={styles.summaryCircle1} />\r\n      <div className={styles.summaryCircle2} />\r\n      \r\n      {/* Header */}\r\n      <div className={styles.summaryHeader}>\r\n        <Text className={styles.summaryTitle}> BILL SUMMARY</Text>\r\n      </div>\r\n\r\n      {/* Summary Table */}\r\n      <div className={styles.summaryTable}>\r\n        <div className={styles.summaryRow}>\r\n          <Text className={styles.summaryLabel}>Sub Total:</Text>\r\n          <Text className={styles.summaryValue}>\r\n            {billCalculations.sub_total.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        <div className={styles.summaryRow}>\r\n          <Text className={styles.summaryLabel}>Value of Goods:</Text>\r\n          <Text className={styles.summaryValue}>\r\n            {billCalculations.value_of_goods.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        <div className={styles.summaryRow}>\r\n          <Text className={styles.summaryLabel}>Total GST:</Text>\r\n          <Text className={styles.summaryValue}>\r\n            {billCalculations.total_gst.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        <div className={styles.summaryRow}>\r\n          <Text className={styles.summaryLabel}>CGST:</Text>\r\n          <Text className={styles.summaryValue}>\r\n            {billCalculations.cgst.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        <div className={styles.summaryRow}>\r\n          <Text className={styles.summaryLabel}>SGST:</Text>\r\n          <Text className={styles.summaryValue}>\r\n            {billCalculations.sgst.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        {billSettings.discount > 0 && (\r\n          <div className={styles.summaryRow}>\r\n            <Text className={styles.summaryLabel}>DISCOUNT:</Text>\r\n            <Text className={styles.discountValue}>\r\n              -\r\n              {billSettings.discountType === 'percentage'\r\n                ? (\r\n                    ((billCalculations.sub_total + billCalculations.total_gst) *\r\n                      (typeof billSettings.discount === 'number' ? billSettings.discount : 0)) /\r\n                    100\r\n                  ).toFixed(2)\r\n                : (typeof billSettings.discount === 'number'\r\n                    ? billSettings.discount\r\n                    : 0\r\n                  ).toFixed(2)}\r\n            </Text>\r\n          </div>\r\n        )}\r\n\r\n        <div className={styles.totalAmountRow}>\r\n          <Text className={styles.totalAmountLabel}>NET/EXC/REPL:</Text>\r\n          <Text className={styles.totalAmountValue}>\r\n            {billCalculations.total_amount.toFixed(2)}\r\n          </Text>\r\n        </div>\r\n\r\n        {billSettings.isPartiallyPaid && (\r\n          <div className={styles.partialPaymentInfo}>\r\n            <div className={styles.partialPaymentRow}>\r\n              <Text className={styles.partialPaymentLabel}>Paid Amount:</Text>\r\n              <Text className={styles.partialPaymentValue}>\r\n                \r\n                {(typeof billSettings.paidAmount === 'number'\r\n                  ? billSettings.paidAmount\r\n                  : 0\r\n                ).toFixed(2)}\r\n              </Text>\r\n            </div>\r\n            <div className={styles.partialPaymentRow}>\r\n              <Text className={styles.partialPaymentLabel}>Balance:</Text>\r\n              <Text className={styles.partialPaymentValue}>\r\n                \r\n                {(\r\n                  billCalculations.total_amount -\r\n                  (typeof billSettings.paidAmount === 'number' ? billSettings.paidAmount : 0)\r\n                ).toFixed(2)}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Discount & Payment Controls */}\r\n      <div className={styles.controlsContainer}>\r\n        {/* Discount Controls */}\r\n        <div className={styles.discountControl}>\r\n          <Text className={styles.discountControlLabel}> DISCOUNT</Text>\r\n          <div className={styles.discountControlInputs}>\r\n            <InputNumber\r\n              min={0}\r\n              value={billSettings.discount}\r\n              onChange={value => onDiscountChange(value || 0)}\r\n              style={{ width: 70 }}\r\n              size=\"small\"\r\n            />\r\n            <Switch\r\n              checkedChildren=\"%\"\r\n              unCheckedChildren=\"\"\r\n              checked={billSettings.discountType === 'percentage'}\r\n              onChange={onDiscountTypeChange}\r\n              size=\"small\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Partial Payment Controls */}\r\n        {billSettings.isPartiallyPaid && (\r\n          <div className={styles.partialPaymentControl}>\r\n            <Text className={styles.partialPaymentControlLabel}> PARTIAL PAY</Text>\r\n            <InputNumber\r\n              min={0}\r\n              max={billCalculations.total_amount}\r\n              value={billSettings.paidAmount}\r\n              onChange={value => onPaidAmountChange(value || 0)}\r\n              style={{ width: 90 }}\r\n              size=\"small\"\r\n              formatter={value => `${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')}\r\n              parser={value => Number(value!.replace(/\\s?|(,*)/g, ''))}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillSummary;\r\n\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Button,\r\n  Typography,\r\n  message,\r\n  Form,\r\n  Select,\r\n  Space,\r\n  Divider,\r\n  Tag,\r\n  Table,\r\n  Row,\r\n  Col,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  UserAddOutlined,\r\n  UserOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n  HomeOutlined,\r\n  PlusOutlined,\r\n  SaveOutlined,\r\n  CloseOutlined,\r\n} from '@ant-design/icons';\r\nimport { useHandleApiResponse } from '../../../components/common/useHandleApiResponse';\r\nimport { useGenericCrudRTK } from '../../../hooks/useGenericCrudRTK';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Option } = Select;\r\n\r\ninterface Customer {\r\n  _id: string;\r\n  full_name: string;\r\n  email: string;\r\n  mobile: string;\r\n  address: string;\r\n  customer_type: 'regular' | 'vip' | 'wholesale';\r\n}\r\n\r\ninterface NewCustomerData {\r\n  full_name: string;\r\n  email: string;\r\n  mobile: string;\r\n  address: string;\r\n  customer_type: 'regular' | 'vip' | 'wholesale';\r\n}\r\n\r\ninterface CustomerSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (customer: Customer) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst CustomerSelectionModalComponent: React.FC<CustomerSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [debouncedSearchTerm, setDebouncedSearchTerm] = useState('');\r\n  const [page, setPage] = useState(1);\r\n  const [allCustomers, setAllCustomers] = useState<Customer[]>([]);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [showAddForm, setShowAddForm] = useState(false);\r\n  const [selectedCustomer, setSelectedCustomer] = useState<Customer | null>(\r\n    null\r\n  );\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n  const [showCreateGrid, setShowCreateGrid] = useState(false);\r\n  const [newCustomerData, setNewCustomerData] = useState<NewCustomerData>({\r\n    full_name: '',\r\n    email: '',\r\n    mobile: '',\r\n    address: '',\r\n    customer_type: 'regular',\r\n  });\r\n\r\n  const [form] = Form.useForm();\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const createGridRef = useRef<HTMLDivElement>(null);\r\n  const firstFormInputRef = useRef<any>(null);\r\n  const isLoadingMoreRef = useRef(false);\r\n\r\n  // RTK Query hooks for Customer - with pagination\r\n  const { data: customerData, isLoading: customerLoading, refetch: refetchCustomerList } = \r\n    apiSlice.useGetCustomerQuery(\r\n      { \r\n        searchString: debouncedSearchTerm,\r\n        page: page,\r\n        limit: 10\r\n      },\r\n      { \r\n        skip: !visible, // Only fetch when modal is open\r\n        refetchOnMountOrArgChange: true,\r\n      }\r\n    );\r\n  \r\n  const customerRTK = useGenericCrudRTK('Customer');\r\n  const { create: createCustomer, ...createResult } = customerRTK.useCreate();\r\n  const createLoading = createResult.isLoading;\r\n\r\n  // Accumulate customers for infinite scroll\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n    \r\n    if (customerData) {\r\n      const newItems = (customerData as any)?.result || [];\r\n      const totalCount = (customerData as any).pagination?.totalCount || (customerData as any).pagination?.total || 0;\r\n      \r\n      if (page === 1) {\r\n        // First page - replace all items\r\n        setAllCustomers(newItems);\r\n        setHasMore(newItems.length < totalCount && newItems.length > 0);\r\n        if (newItems.length > 0) {\r\n          setShowCreateGrid(false);\r\n          setShowAddForm(false);\r\n        }\r\n      } else {\r\n        // Subsequent pages - append items\r\n        setAllCustomers(prev => {\r\n          const existingIds = new Set(prev.map((item: any) => item._id));\r\n          const uniqueNewItems = newItems.filter((item: any) => !existingIds.has(item._id));\r\n          const updated = [...prev, ...uniqueNewItems];\r\n          setHasMore(updated.length < totalCount && uniqueNewItems.length > 0);\r\n          return updated;\r\n        });\r\n        if (newItems.length > 0) {\r\n          setShowCreateGrid(false);\r\n          setShowAddForm(false);\r\n        }\r\n      }\r\n      \r\n      isLoadingMoreRef.current = false;\r\n    }\r\n  }, [customerData, page, visible]);\r\n\r\n  const filteredCustomers = allCustomers;\r\n\r\n  // Check if search has no results and should show create grid\r\n  const shouldShowCreateGrid = useMemo(() => {\r\n    return (\r\n      searchTerm.trim() && !customerLoading && filteredCustomers.length === 0\r\n    );\r\n  }, [searchTerm, customerLoading, filteredCustomers.length]);\r\n\r\n  // Memoized customer type color function\r\n  const getCustomerTypeColor = useCallback((type: string) => {\r\n    const colorMap: Record<string, string> = {\r\n      vip: 'gold',\r\n      wholesale: 'blue',\r\n      regular: 'green',\r\n    };\r\n    return colorMap[type] || 'green';\r\n  }, []);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToCustomer = useCallback(\r\n    (direction: 'up' | 'down' | 'home' | 'end') => {\r\n      if (filteredCustomers.length === 0) return;\r\n\r\n      let newIndex: number;\r\n      switch (direction) {\r\n        case 'up':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? filteredCustomers.length - 1\r\n              : Math.max(selectedRowIndex - 1, 0);\r\n          break;\r\n        case 'down':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? 0\r\n              : Math.min(selectedRowIndex + 1, filteredCustomers.length - 1);\r\n          break;\r\n        case 'home':\r\n          newIndex = 0;\r\n          break;\r\n        case 'end':\r\n          newIndex = filteredCustomers.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedCustomer(filteredCustomers[newIndex]);\r\n\r\n      // Scroll to the selected row\r\n      setTimeout(() => {\r\n        const rowElement = document.querySelector(\r\n          `[data-row-key=\"${filteredCustomers[newIndex]._id}\"]`\r\n        ) as HTMLElement;\r\n        if (rowElement) {\r\n          const scrollBehavior =\r\n            direction === 'home'\r\n              ? 'start'\r\n              : direction === 'end'\r\n                ? 'end'\r\n                : 'nearest';\r\n          rowElement.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: scrollBehavior,\r\n          });\r\n        }\r\n      }, 100);\r\n    },\r\n    [filteredCustomers, selectedRowIndex]\r\n  );\r\n\r\n  // Debounced search function with pagination reset\r\n  const handleSearch = useCallback(\r\n    (value: string) => {\r\n      setSearchTerm(value);\r\n\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n\r\n      searchTimeoutRef.current = setTimeout(() => {\r\n        setDebouncedSearchTerm(value.trim());\r\n        // Reset to page 1 when search changes\r\n        setPage(1);\r\n        setHasMore(true);\r\n        isLoadingMoreRef.current = false;\r\n      }, 300);\r\n    },\r\n    []\r\n  );\r\n\r\n  // Handle customer selection\r\n  const handleCustomerSelect = useCallback(\r\n    (customer: Customer) => {\r\n      setSelectedCustomer(customer);\r\n      onSelect(customer);\r\n      setTimeout(() => onCancel(), 100);\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Function to clear form data\r\n  const clearFormData = useCallback(() => {\r\n    setNewCustomerData({\r\n      full_name: '',\r\n      email: '',\r\n      mobile: '',\r\n      address: '',\r\n      customer_type: 'regular',\r\n    });\r\n    form.resetFields();\r\n  }, [form]);\r\n\r\n  // Handle new customer creation from unified form\r\n  const handleCreateCustomerFromForm = useCallback(async () => {\r\n    try {\r\n      // Validate required fields - only Full Name and Mobile are mandatory\r\n      if (!newCustomerData.full_name.trim()) {\r\n        message.error('Full name is required');\r\n        return;\r\n      }\r\n      if (!newCustomerData.mobile.trim()) {\r\n        message.error('Mobile number is required');\r\n        return;\r\n      }\r\n\r\n      // Call RTK mutation - the response will be handled by useHandleApiResponse\r\n      const result = await createCustomer(newCustomerData);\r\n      if (!result.error && result.data) {\r\n        // Customer created successfully, get the new customer data\r\n        const newCustomer = result.data?.data || result.data?.result || result.data;\r\n        if (newCustomer) {\r\n          // Clear form and hide form UI\r\n          clearFormData();\r\n          setShowAddForm(false);\r\n          setShowCreateGrid(false);\r\n          \r\n          // Refresh customer list\r\n          refetchCustomerList();\r\n          \r\n          // Select the newly created customer\r\n          setTimeout(() => {\r\n            handleCustomerSelect(newCustomer);\r\n          }, 100);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      message.error('Failed to create customer');\r\n      // Clear form data on error\r\n      clearFormData();\r\n    }\r\n  }, [newCustomerData, createCustomer, handleCustomerSelect, clearFormData, refetchCustomerList]);\r\n\r\n  // Handle form field changes\r\n  const handleFormFieldChange = useCallback(\r\n    (field: keyof NewCustomerData, value: string) => {\r\n      setNewCustomerData(prev => ({\r\n        ...prev,\r\n        [field]: value,\r\n      }));\r\n    },\r\n    []\r\n  );\r\n\r\n  // Remove the navigateToNextField function as it's no longer needed\r\n\r\n  // Handle keyboard events (excluding Enter key which is handled by input field)\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onCancel();\r\n      } else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToCustomer(directionMap[e.key]);\r\n      }\r\n    },\r\n    [navigateToCustomer, onCancel]\r\n  );\r\n\r\n  // Global keyboard event handler\r\n  const handleGlobalKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (!visible) return;\r\n\r\n      // Don't interfere if user is typing in form inputs\r\n      const target = e.target as HTMLElement;\r\n      if (\r\n        target.tagName === 'INPUT' ||\r\n        target.tagName === 'TEXTAREA' ||\r\n        target.classList.contains('ant-select-selector') ||\r\n        target.closest('.ant-select-dropdown')\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === 'f') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Handle Ctrl+N for new customer creation\r\n      if (e.ctrlKey && e.key === 'n') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (shouldShowCreateGrid) {\r\n          setShowCreateGrid(true);\r\n          setTimeout(() => {\r\n            if (createGridRef.current) {\r\n              const firstInput = createGridRef.current.querySelector(\r\n                'input'\r\n              ) as HTMLInputElement;\r\n              if (firstInput) {\r\n                firstInput.focus();\r\n                firstInput.select();\r\n              }\r\n            }\r\n          }, 100);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Only handle navigation keys globally when not in form inputs\r\n      if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToCustomer(directionMap[e.key]);\r\n      }\r\n    },\r\n    [visible, navigateToCustomer, shouldShowCreateGrid]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: Customer) => (\r\n          <div\r\n            style={{\r\n              cursor: 'pointer',\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n            }}\r\n            onClick={() => {\r\n              setSelectedCustomer(record);\r\n              const index = filteredCustomers.findIndex(\r\n                (c: Customer) => c._id === record._id\r\n              );\r\n              setSelectedRowIndex(index);\r\n              // Don't auto-select here, let user click the row or press Enter\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                borderRadius: '50%',\r\n                border:\r\n                  selectedCustomer?._id === record._id\r\n                    ? '2px solid #1890ff'\r\n                    : '2px solid #d9d9d9',\r\n                backgroundColor:\r\n                  selectedCustomer?._id === record._id ? '#1890ff' : 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedCustomer?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Customer Name',\r\n        dataIndex: 'full_name',\r\n        key: 'full_name',\r\n        render: (text: string, record: Customer) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <Text strong>{text}</Text>\r\n            <Tag color={getCustomerTypeColor(record.customer_type)}>\r\n              {record.customer_type.toUpperCase()}\r\n            </Tag>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Mobile',\r\n        dataIndex: 'mobile',\r\n        key: 'mobile',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Address',\r\n        dataIndex: 'address',\r\n        key: 'address',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'flex-start', gap: 8 }}>\r\n            <HomeOutlined style={{ color: '#666', marginTop: '2px' }} />\r\n            <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n              {text || '-'}\r\n            </Text>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedCustomer, filteredCustomers, getCustomerTypeColor]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: Customer, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedCustomer(record);\r\n        setSelectedRowIndex(index ?? 0);\r\n        // Don't auto-select on row click, let user press Enter to confirm\r\n      },\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedCustomer?._id === record._id ? '#f0f8ff' : 'white',\r\n        border:\r\n          selectedCustomer?._id === record._id\r\n            ? '2px solid #1890ff'\r\n            : '1px solid #f0f0f0',\r\n        borderRadius: '4px',\r\n        transition: 'all 0.2s ease',\r\n      },\r\n      onMouseEnter: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedCustomer?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = '#f5f5f5';\r\n        }\r\n      },\r\n      onMouseLeave: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedCustomer?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = 'white';\r\n        }\r\n      },\r\n    }),\r\n    [selectedCustomer]\r\n  );\r\n\r\n  // Handle modal close (RTK Query automatically loads customers)\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setSelectedCustomer(null);\r\n      setSelectedRowIndex(-1);\r\n      setShowCreateGrid(false);\r\n      // Reset pagination when modal opens\r\n      setPage(1);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    } else {\r\n      setSearchTerm('');\r\n      setDebouncedSearchTerm('');\r\n      setSelectedCustomer(null);\r\n      setSelectedRowIndex(-1);\r\n      setShowCreateGrid(false);\r\n      setShowAddForm(false);\r\n      clearFormData();\r\n      // Reset pagination when modal closes\r\n      setPage(1);\r\n      setAllCustomers([]);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = null;\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [visible, clearFormData]);\r\n\r\n  // Auto-show create form when search has no results\r\n  useEffect(() => {\r\n    if (shouldShowCreateGrid && !showCreateGrid && !showAddForm) {\r\n      setShowCreateGrid(true);\r\n    }\r\n  }, [shouldShowCreateGrid, showCreateGrid, showAddForm]);\r\n\r\n  // Focus search input when modal becomes visible (but not when create form is shown)\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current && !showAddForm && !showCreateGrid) {\r\n      const focusSearch = () => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n      };\r\n\r\n      focusSearch();\r\n      const timer = setTimeout(focusSearch, 100);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [visible, showAddForm, showCreateGrid]);\r\n\r\n  // Focus on first form field when create form is shown\r\n  useEffect(() => {\r\n    if ((showAddForm || showCreateGrid) && visible) {\r\n      const timer = setTimeout(() => {\r\n        if (firstFormInputRef.current) {\r\n          firstFormInputRef.current.focus();\r\n          firstFormInputRef.current.select();\r\n        }\r\n      }, 100);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [showAddForm, showCreateGrid, visible]); // Depend on all three to trigger when form is shown\r\n\r\n  // Remove the useLayoutEffect that was causing focus to reset\r\n\r\n  // Global keyboard event listener\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('keydown', handleGlobalKeyDown, true);\r\n      return () =>\r\n        document.removeEventListener('keydown', handleGlobalKeyDown, true);\r\n    }\r\n  }, [visible, handleGlobalKeyDown]);\r\n\r\n  // Handle API responses using RTK mutations\r\n  useHandleApiResponse({\r\n    action: 'create',\r\n    title: 'Customer',\r\n    mutationResult: createResult,\r\n    refetch: refetchCustomerList,\r\n  });\r\n\r\n  // Watch createLoading state to show/hide loading message\r\n  useEffect(() => {\r\n    if (createLoading) {\r\n      // Show loading message when API call starts\r\n      message.loading({\r\n        content: 'Creating customer...',\r\n        key: 'customer-creation',\r\n        duration: 0,\r\n      });\r\n    } else {\r\n      // Hide loading message when API call completes\r\n      message.destroy('customer-creation');\r\n    }\r\n  }, [createLoading]);\r\n\r\n  // Note: Customer creation success is handled in handleCreateCustomerFromForm\r\n  // The useHandleApiResponse hook handles notifications automatically\r\n  // No need for additional useEffect watching createResult\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedCustomer(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n  return (\r\n    <Modal\r\n      title=\"Select Customer\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={1000}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current && !showAddForm && !showCreateGrid) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Space.Compact style={{ width: '100%' }}>\r\n          <Input\r\n            ref={searchInputRef}\r\n            placeholder=\"Search customers... (Ctrl+N: New customer, : Navigate, Enter: Select, Esc: Close)\"\r\n            value={searchTerm}\r\n            onChange={e => handleSearch(e.target.value)}\r\n            prefix={<SearchOutlined />}\r\n            style={{ flex: 1 }}\r\n            onKeyDown={e => {\r\n              // Only handle Enter key in search input, let other keys bubble up\r\n              if (e.key === 'Enter' && selectedCustomer) {\r\n                handleCustomerSelect(selectedCustomer);\r\n              }\r\n            }}\r\n            onFocus={handleSearchFocus}\r\n            autoFocus={!showAddForm && !showCreateGrid}\r\n            onBlur={\r\n              !showAddForm && !showCreateGrid\r\n                ? () => {\r\n                    // Only auto-focus back to search if no forms are shown\r\n                    if (visible && searchInputRef.current) {\r\n                      setTimeout(() => {\r\n                        if (\r\n                          visible &&\r\n                          searchInputRef.current &&\r\n                          !showAddForm &&\r\n                          !showCreateGrid\r\n                        ) {\r\n                          searchInputRef.current.focus();\r\n                        }\r\n                      }, 10);\r\n                    }\r\n                  }\r\n                : undefined\r\n            }\r\n            suffix={\r\n              searchTerm && customerLoading ? (\r\n                <div style={{ fontSize: '12px', color: '#999' }}>\r\n                  Searching...\r\n                </div>\r\n              ) : null\r\n            }\r\n          />\r\n          <Button\r\n            type={showAddForm ? 'default' : 'primary'}\r\n            icon={<UserAddOutlined />}\r\n            onClick={() => {\r\n              const newState = !showAddForm;\r\n              setShowAddForm(newState);\r\n              if (!newState) {\r\n                // Clear form data when switching back to search mode\r\n                clearFormData();\r\n              }\r\n              // Focus will be handled by the useEffect when visible changes\r\n            }}\r\n            style={{ minWidth: 120 }}\r\n          >\r\n            {showAddForm ? 'Cancel' : 'Add New'}\r\n          </Button>\r\n        </Space.Compact>\r\n      </div>\r\n\r\n      {/* Unified Create Form - Shows when search has no results or when Add New is clicked */}\r\n      {(showCreateGrid || showAddForm) && (\r\n        <div\r\n          ref={createGridRef}\r\n          style={{\r\n            marginBottom: 20,\r\n            padding: 24,\r\n            border: '2px solid #6366f1',\r\n            borderRadius: 16,\r\n            backgroundColor:\r\n              'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\r\n            background: 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)',\r\n            boxShadow:\r\n              '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',\r\n            position: 'relative',\r\n            overflow: 'hidden',\r\n          }}\r\n          tabIndex={-1}\r\n        >\r\n          {/* Decorative background elements */}\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              top: -20,\r\n              right: -20,\r\n              width: 100,\r\n              height: 100,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n              opacity: 0.1,\r\n              zIndex: 0,\r\n            }}\r\n          />\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              bottom: -30,\r\n              left: -30,\r\n              width: 80,\r\n              height: 80,\r\n              borderRadius: '50%',\r\n              background: 'linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)',\r\n              opacity: 0.1,\r\n              zIndex: 0,\r\n            }}\r\n          />\r\n\r\n          <Row\r\n            justify=\"space-between\"\r\n            align=\"middle\"\r\n            style={{ marginBottom: 24, position: 'relative', zIndex: 1 }}\r\n          >\r\n            <Col>\r\n              <Title\r\n                level={4}\r\n                style={{\r\n                  margin: 0,\r\n                  background:\r\n                    'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n                  WebkitBackgroundClip: 'text',\r\n                  WebkitTextFillColor: 'transparent',\r\n                  backgroundClip: 'text',\r\n                  fontWeight: 700,\r\n                  fontSize: '20px',\r\n                }}\r\n              >\r\n                <PlusOutlined style={{ marginRight: 8, color: '#6366f1' }} />\r\n                Create New Customer\r\n              </Title>\r\n              <Text\r\n                style={{\r\n                  fontSize: '14px',\r\n                  color: '#64748b',\r\n                  fontWeight: 500,\r\n                  display: 'block',\r\n                  marginTop: 4,\r\n                }}\r\n              >\r\n                 Fill in the details below to create a new customer\r\n              </Text>\r\n            </Col>\r\n            <Col>\r\n              <Space size=\"middle\">\r\n                <Button\r\n                  size=\"middle\"\r\n                  icon={<CloseOutlined />}\r\n                  onClick={() => {\r\n                    setShowCreateGrid(false);\r\n                    setShowAddForm(false);\r\n                    refetchCustomerList(); // Refresh customer list after cancel\r\n                    clearFormData();\r\n                  }}\r\n                  style={{\r\n                    border: '2px solid #e2e8f0',\r\n                    borderRadius: 8,\r\n                    fontWeight: 600,\r\n                    color: '#64748b',\r\n                    background: 'white',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    height: 40,\r\n                    padding: '0 20px',\r\n                  }}\r\n                >\r\n                  Cancel\r\n                </Button>\r\n                <Button\r\n                  type=\"primary\"\r\n                  size=\"middle\"\r\n                  icon={<SaveOutlined />}\r\n                  onClick={handleCreateCustomerFromForm}\r\n                  loading={createLoading}\r\n                  style={{\r\n                    background:\r\n                      'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)',\r\n                    border: 'none',\r\n                    borderRadius: 8,\r\n                    fontWeight: 600,\r\n                    height: 40,\r\n                    padding: '0 24px',\r\n                    boxShadow: '0 4px 12px rgba(99, 102, 241, 0.3)',\r\n                    transition: 'all 0.3s ease',\r\n                  }}\r\n                >\r\n                  Create & Select\r\n                </Button>\r\n              </Space>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form\r\n            form={form}\r\n            layout=\"vertical\"\r\n            size=\"middle\"\r\n            style={{ position: 'relative', zIndex: 1 }}\r\n          >\r\n            <div\r\n              style={{\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 1fr',\r\n                gap: 20,\r\n                marginBottom: 20,\r\n              }}\r\n            >\r\n              <Form.Item\r\n                name=\"full_name\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <UserOutlined style={{ color: '#6366f1' }} />\r\n                    Full Name\r\n                  </span>\r\n                }\r\n                rules={[{ required: true, message: 'Please enter full name' }]}\r\n              >\r\n                <Input\r\n                  ref={firstFormInputRef}\r\n                  name=\"full_name\"\r\n                  placeholder=\"Enter full name\"\r\n                  prefix={<UserOutlined style={{ color: '#9ca3af' }} />}\r\n                  autoFocus={showAddForm || showCreateGrid}\r\n                  value={newCustomerData.full_name}\r\n                  onChange={e =>\r\n                    handleFormFieldChange('full_name', e.target.value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"mobile\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <PhoneOutlined style={{ color: '#10b981' }} />\r\n                    Mobile Number\r\n                  </span>\r\n                }\r\n                rules={[\r\n                  { required: true, message: 'Please enter mobile number' },\r\n                  {\r\n                    pattern: /^[0-9]{10}$/,\r\n                    message: 'Mobile must be 10 digits',\r\n                  },\r\n                ]}\r\n              >\r\n                <Input\r\n                  name=\"mobile\"\r\n                  placeholder=\"Enter mobile number\"\r\n                  prefix={<PhoneOutlined style={{ color: '#9ca3af' }} />}\r\n                  value={newCustomerData.mobile}\r\n                  onChange={e =>\r\n                    handleFormFieldChange('mobile', e.target.value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"email\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <MailOutlined style={{ color: '#f59e0b' }} />\r\n                    Email\r\n                  </span>\r\n                }\r\n                rules={[{ type: 'email', message: 'Please enter valid email' }]}\r\n              >\r\n                <Input\r\n                  name=\"email\"\r\n                  placeholder=\"Enter email\"\r\n                  prefix={<MailOutlined style={{ color: '#9ca3af' }} />}\r\n                  value={newCustomerData.email}\r\n                  onChange={e => handleFormFieldChange('email', e.target.value)}\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    padding: '12px 16px',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                />\r\n              </Form.Item>\r\n\r\n              {/* <Form.Item\r\n                name=\"customer_type\"\r\n                label={\r\n                  <span\r\n                    style={{\r\n                      fontWeight: 600,\r\n                      color: '#374151',\r\n                      fontSize: '14px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: 6,\r\n                    }}\r\n                  >\r\n                    <Tag\r\n                      style={{\r\n                        background:\r\n                          'linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%)',\r\n                        color: 'white',\r\n                        border: 'none',\r\n                        borderRadius: 6,\r\n                        padding: '2px 8px',\r\n                        fontSize: '10px',\r\n                        fontWeight: 600,\r\n                      }}\r\n                    >\r\n                      TYPE\r\n                    </Tag>\r\n                    Customer Type\r\n                  </span>\r\n                }\r\n                initialValue=\"regular\"\r\n              >\r\n                <Select\r\n                  value={newCustomerData.customer_type}\r\n                  onChange={value =>\r\n                    handleFormFieldChange('customer_type', value)\r\n                  }\r\n                  onKeyDown={e => {\r\n                    if (e.key === 'Enter') {\r\n                      e.preventDefault();\r\n                      handleCreateCustomerFromForm();\r\n                    }\r\n                  }}\r\n                  style={{\r\n                    borderRadius: 10,\r\n                    border: '2px solid #e5e7eb',\r\n                    fontSize: '14px',\r\n                    transition: 'all 0.3s ease',\r\n                    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                    background: 'white',\r\n                  }}\r\n                >\r\n                  <Option value=\"regular\">Regular</Option>\r\n                  <Option value=\"vip\">VIP</Option>\r\n                  <Option value=\"wholesale\">Wholesale</Option>\r\n                </Select>\r\n              </Form.Item> */}\r\n            </div>\r\n\r\n            <Form.Item\r\n              name=\"address\"\r\n              label={\r\n                <span\r\n                  style={{\r\n                    fontWeight: 600,\r\n                    color: '#374151',\r\n                    fontSize: '14px',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: 6,\r\n                  }}\r\n                >\r\n                  <HomeOutlined style={{ color: '#ef4444' }} />\r\n                  Address\r\n                </span>\r\n              }\r\n            >\r\n              <Input.TextArea\r\n                name=\"address\"\r\n                placeholder=\"Enter address\"\r\n                rows={3}\r\n                value={newCustomerData.address}\r\n                onChange={e => handleFormFieldChange('address', e.target.value)}\r\n                onKeyDown={e => {\r\n                  if (e.key === 'Enter') {\r\n                    e.preventDefault();\r\n                    // If it's the last field, create the customer\r\n                    handleCreateCustomerFromForm();\r\n                  }\r\n                }}\r\n                style={{\r\n                  borderRadius: 10,\r\n                  border: '2px solid #e5e7eb',\r\n                  padding: '12px 16px',\r\n                  fontSize: '14px',\r\n                  transition: 'all 0.3s ease',\r\n                  boxShadow: '0 2px 4px rgba(0, 0, 0, 0.05)',\r\n                  background: 'white',\r\n                  resize: 'none',\r\n                }}\r\n              />\r\n            </Form.Item>\r\n          </Form>\r\n        </div>\r\n      )}\r\n\r\n      <Divider style={{ margin: '16px 0' }} />\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {customerLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading customers...</Text>\r\n          </div>\r\n        ) : filteredCustomers.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No customers found matching your search.'\r\n                : 'No customers available.'}\r\n            </Text>\r\n            {searchTerm && (\r\n              <div style={{ marginTop: 16 }}>\r\n                <Text type=\"secondary\">\r\n                  Press Ctrl+N to create a new customer instantly\r\n                </Text>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div\r\n            onScroll={(e: any) => {\r\n              const target = e.currentTarget;\r\n              const scrollTop = target.scrollTop;\r\n              const scrollHeight = target.scrollHeight;\r\n              const clientHeight = target.clientHeight;\r\n              const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\r\n              \r\n              if (scrollPercentage > 0.7 && hasMore && !customerLoading && !isLoadingMoreRef.current) {\r\n                isLoadingMoreRef.current = true;\r\n                setPage(prev => prev + 1);\r\n              }\r\n            }}\r\n            style={{ maxHeight: 360, overflowY: 'auto' }}\r\n          >\r\n            <Table\r\n              columns={columns}\r\n              dataSource={filteredCustomers}\r\n              rowKey=\"_id\"\r\n              pagination={false}\r\n              size=\"small\"\r\n              scroll={{ y: undefined }}\r\n              onRow={getRowProps}\r\n            />\r\n            {hasMore && filteredCustomers.length > 0 && (\r\n              <div style={{ textAlign: 'center', padding: '8px', color: '#999', borderTop: '1px solid #f0f0f0' }}>\r\n                {customerLoading ? 'Loading more...' : 'Scroll for more customers'}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\n// Memoize the component to prevent unnecessary re-renders\r\nconst CustomerSelectionModal = React.memo(CustomerSelectionModalComponent);\r\nexport default CustomerSelectionModal;\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Typography,\r\n  Tag,\r\n  Table,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n  HomeOutlined,\r\n  ShopOutlined,\r\n} from '@ant-design/icons';\r\nimport { useGenericCrudRTK } from '../../../hooks/useGenericCrudRTK';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Text } = Typography;\r\n\r\ninterface Vendor {\r\n  _id: string;\r\n  vendor_name: string;\r\n  email: string;\r\n  contact_number: string;\r\n  address: string;\r\n  vendor_type?: string;\r\n}\r\n\r\ninterface VendorSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (vendor: Vendor) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst VendorSelectionModalComponent: React.FC<VendorSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [debouncedSearchTerm, setDebouncedSearchTerm] = useState('');\r\n  const [page, setPage] = useState(1);\r\n  const [allVendors, setAllVendors] = useState<Vendor[]>([]);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [selectedVendor, setSelectedVendor] = useState<Vendor | null>(null);\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isLoadingMoreRef = useRef(false);\r\n\r\n  // RTK Query hooks for Vendor with pagination\r\n  const { data: vendorData, isLoading: vendorLoading } = \r\n    apiSlice.useGetVendorQuery(\r\n      { \r\n        searchString: debouncedSearchTerm,\r\n        page: page,\r\n        limit: 10\r\n      },\r\n      { \r\n        skip: !visible,\r\n        refetchOnMountOrArgChange: true,\r\n      }\r\n    );\r\n\r\n  // Accumulate vendors for infinite scroll\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n    \r\n    if (vendorData) {\r\n      const newItems = (vendorData as any)?.result || [];\r\n      const totalCount = (vendorData as any).pagination?.totalCount || (vendorData as any).pagination?.total || 0;\r\n      \r\n      if (page === 1) {\r\n        setAllVendors(newItems);\r\n        setHasMore(newItems.length < totalCount && newItems.length > 0);\r\n      } else {\r\n        setAllVendors(prev => {\r\n          const existingIds = new Set(prev.map((item: any) => item._id));\r\n          const uniqueNewItems = newItems.filter((item: any) => !existingIds.has(item._id));\r\n          const updated = [...prev, ...uniqueNewItems];\r\n          setHasMore(updated.length < totalCount && uniqueNewItems.length > 0);\r\n          return updated;\r\n        });\r\n      }\r\n      \r\n      isLoadingMoreRef.current = false;\r\n    }\r\n  }, [vendorData, page, visible]);\r\n\r\n  const filteredVendors = allVendors;\r\n\r\n  // Memoized vendor type color function\r\n  const getVendorTypeColor = useCallback((type?: string) => {\r\n    const colorMap: Record<string, string> = {\r\n      premium: 'gold',\r\n      wholesale: 'blue',\r\n      regular: 'green',\r\n    };\r\n    return colorMap[type || 'regular'] || 'green';\r\n  }, []);\r\n\r\n  // Debounce search term for API calls with pagination reset\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n\r\n    if (searchTerm === debouncedSearchTerm) return;\r\n\r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n\r\n    searchTimeoutRef.current = setTimeout(() => {\r\n      setDebouncedSearchTerm(searchTerm);\r\n      setPage(1);\r\n      setAllVendors([]);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    }, 300);\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [searchTerm, debouncedSearchTerm, visible]);\r\n\r\n  // Reset state when modal opens/closes\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setPage(1);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    } else {\r\n      setSearchTerm('');\r\n      setDebouncedSearchTerm('');\r\n      setPage(1);\r\n      setAllVendors([]);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    }\r\n  }, [visible]);\r\n\r\n  // Handle search input change\r\n  const handleSearch = useCallback((value: string) => {\r\n    setSearchTerm(value);\r\n    setSelectedVendor(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n\r\n  // Focus search input when modal opens\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current) {\r\n      setTimeout(() => {\r\n        searchInputRef.current?.focus();\r\n        searchInputRef.current?.select();\r\n      }, 100);\r\n    }\r\n  }, [visible]);\r\n\r\n  // Reset state when modal closes\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      setSearchTerm('');\r\n      setDebouncedSearchTerm('');\r\n      setSelectedVendor(null);\r\n      setSelectedRowIndex(-1);\r\n    }\r\n  }, [visible]);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToVendor = useCallback(\r\n    (direction: 'up' | 'down' | 'first' | 'last') => {\r\n      if (filteredVendors.length === 0) return;\r\n\r\n      let newIndex = selectedRowIndex;\r\n      if (direction === 'up') {\r\n        newIndex = selectedRowIndex <= 0 ? filteredVendors.length - 1 : selectedRowIndex - 1;\r\n      } else if (direction === 'down') {\r\n        newIndex = selectedRowIndex >= filteredVendors.length - 1 ? 0 : selectedRowIndex + 1;\r\n      } else if (direction === 'first') {\r\n        newIndex = 0;\r\n      } else if (direction === 'last') {\r\n        newIndex = filteredVendors.length - 1;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedVendor(filteredVendors[newIndex]);\r\n\r\n      // Scroll selected row into view\r\n      setTimeout(() => {\r\n        const selectedRow = document.querySelector(\r\n          '.vendor-selection-table .ant-table-row-selected'\r\n        );\r\n        if (selectedRow) {\r\n          selectedRow.scrollIntoView({ block: 'nearest', behavior: 'smooth' });\r\n        }\r\n      }, 0);\r\n    },\r\n    [filteredVendors, selectedRowIndex]\r\n  );\r\n\r\n  // Handle vendor selection\r\n  const handleVendorSelect = useCallback(\r\n    (vendor: Vendor) => {\r\n      onSelect(vendor);\r\n      onCancel();\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Keyboard shortcuts\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'ArrowDown') {\r\n        e.preventDefault();\r\n        navigateToVendor('down');\r\n      } else if (e.key === 'ArrowUp') {\r\n        e.preventDefault();\r\n        navigateToVendor('up');\r\n      } else if (e.key === 'Home') {\r\n        e.preventDefault();\r\n        navigateToVendor('first');\r\n      } else if (e.key === 'End') {\r\n        e.preventDefault();\r\n        navigateToVendor('last');\r\n      } else if (e.key === 'Enter' && selectedVendor) {\r\n        e.preventDefault();\r\n        handleVendorSelect(selectedVendor);\r\n      } else if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        onCancel();\r\n      }\r\n    },\r\n    [navigateToVendor, selectedVendor, handleVendorSelect, onCancel]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: Vendor) => (\r\n          <div\r\n            style={{\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              width: '100%',\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '24px',\r\n                height: '24px',\r\n                borderRadius: '50%',\r\n                border: '2px solid #6366f1',\r\n                backgroundColor:\r\n                  selectedVendor?._id === record._id ? '#6366f1' : 'transparent',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedVendor?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Vendor Name',\r\n        dataIndex: 'vendor_name',\r\n        key: 'vendor_name',\r\n        render: (text: string, record: Vendor) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <ShopOutlined style={{ color: '#6366f1' }} />\r\n            <Text strong>{text}</Text>\r\n            {record.vendor_type && (\r\n              <Tag color={getVendorTypeColor(record.vendor_type)}>\r\n                {record.vendor_type.toUpperCase()}\r\n              </Tag>\r\n            )}\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Contact Number',\r\n        dataIndex: 'contact_number',\r\n        key: 'contact_number',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Address',\r\n        dataIndex: 'address',\r\n        key: 'address',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'flex-start', gap: 8 }}>\r\n            <HomeOutlined style={{ color: '#666', marginTop: '2px' }} />\r\n            <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n              {text || '-'}\r\n            </Text>\r\n          </div>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedVendor, getVendorTypeColor]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: Vendor, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedVendor(record);\r\n        setSelectedRowIndex(index ?? -1);\r\n      },\r\n      onDoubleClick: () => handleVendorSelect(record),\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedVendor?._id === record._id ? '#f0f5ff' : 'transparent',\r\n      },\r\n      className:\r\n        selectedVendor?._id === record._id ? 'ant-table-row-selected' : '',\r\n    }),\r\n    [selectedVendor, handleVendorSelect]\r\n  );\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedVendor(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n          <ShopOutlined style={{ color: '#6366f1', fontSize: 18 }} />\r\n          <span>Select Vendor</span>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={1000}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Input\r\n          ref={searchInputRef}\r\n          placeholder=\"Search vendors... (Click to highlight, Double-click or Enter to select)\"\r\n          value={searchTerm}\r\n          onChange={e => handleSearch(e.target.value)}\r\n          prefix={<SearchOutlined />}\r\n          style={{ width: '100%' }}\r\n          onFocus={handleSearchFocus}\r\n          autoFocus\r\n          suffix={\r\n            searchTerm && vendorLoading ? (\r\n              <div style={{ fontSize: '12px', color: '#999' }}>\r\n                Searching...\r\n              </div>\r\n            ) : null\r\n          }\r\n        />\r\n      </div>\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {vendorLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading vendors...</Text>\r\n          </div>\r\n        ) : filteredVendors.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No vendors found matching your search.'\r\n                : 'No vendors available.'}\r\n            </Text>\r\n          </div>\r\n        ) : (\r\n          <div\r\n            onScroll={(e: any) => {\r\n              const target = e.currentTarget;\r\n              const scrollTop = target.scrollTop;\r\n              const scrollHeight = target.scrollHeight;\r\n              const clientHeight = target.clientHeight;\r\n              const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\r\n              \r\n              if (scrollPercentage > 0.7 && hasMore && !vendorLoading && !isLoadingMoreRef.current) {\r\n                isLoadingMoreRef.current = true;\r\n                setPage(prev => prev + 1);\r\n              }\r\n            }}\r\n            style={{ maxHeight: 360, overflowY: 'auto' }}\r\n          >\r\n            <Table\r\n              columns={columns}\r\n              dataSource={filteredVendors}\r\n              rowKey=\"_id\"\r\n              pagination={false}\r\n              size=\"small\"\r\n              scroll={{ y: undefined }}\r\n              onRow={getRowProps}\r\n              className=\"vendor-selection-table\"\r\n            />\r\n            {hasMore && filteredVendors.length > 0 && (\r\n              <div style={{ textAlign: 'center', padding: '8px', color: '#999', borderTop: '1px solid #f0f0f0' }}>\r\n                {vendorLoading ? 'Loading more...' : 'Scroll for more vendors'}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div\r\n        style={{\r\n          marginTop: 16,\r\n          padding: 12,\r\n          backgroundColor: '#f0f5ff',\r\n          borderRadius: 8,\r\n          fontSize: '12px',\r\n        }}\r\n      >\r\n        <Text type=\"secondary\">\r\n          <strong>Shortcuts:</strong> Click to highlight  Double-click or Enter to select   Navigate  Esc Close  Home/End First/Last\r\n        </Text>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\n// Memoize the component to prevent unnecessary re-renders\r\nconst VendorSelectionModal = React.memo(VendorSelectionModalComponent);\r\n\r\nexport default VendorSelectionModal;\r\n\r\n","import React, {\r\n  useState,\r\n  useEffect,\r\n  useRef,\r\n  useCallback,\r\n  useMemo,\r\n} from 'react';\r\nimport { getCurrentUser } from '../../../helpers/auth';\r\nimport {\r\n  Modal,\r\n  Input,\r\n  Typography,\r\n  Table,\r\n  Tag,\r\n} from 'antd';\r\nimport {\r\n  SearchOutlined,\r\n  UserOutlined,\r\n  PhoneOutlined,\r\n  MailOutlined,\r\n} from '@ant-design/icons';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface User {\r\n  _id: string;\r\n  name: string;\r\n  email: string;\r\n  mobile: string;\r\n  user_name: string;\r\n  roleItems?: {\r\n    name: string;\r\n  };\r\n  branchItems?: {\r\n    branch_name: string;\r\n  };\r\n  organisationItems?: {\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface UserSelectionModalProps {\r\n  visible: boolean;\r\n  onSelect: (user: User) => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst UserSelectionModal: React.FC<UserSelectionModalProps> = ({\r\n  visible,\r\n  onSelect,\r\n  onCancel,\r\n}) => {\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [debouncedSearch, setDebouncedSearch] = useState('');\r\n  const [page, setPage] = useState(1);\r\n  const [allUsers, setAllUsers] = useState<User[]>([]);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [selectedUser, setSelectedUser] = useState<User | null>(null);\r\n  const [selectedRowIndex, setSelectedRowIndex] = useState<number>(-1);\r\n  \r\n  // Get current user from session storage\r\n  const currentUser = useMemo(() => {\r\n    return getCurrentUser();\r\n  }, []);\r\n\r\n  const searchInputRef = useRef<any>(null);\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n  const isLoadingMoreRef = useRef(false);\r\n\r\n  // Use RTK Query for billing users with pagination\r\n  const { data: userData, isLoading: userLoading } = apiSlice.useGetBillingUsersQuery({\r\n    searchString: debouncedSearch,\r\n    page: page,\r\n    limit: 10,\r\n  }, {\r\n    skip: !visible,\r\n    refetchOnMountOrArgChange: true,\r\n  });\r\n\r\n  // Accumulate users for infinite scroll\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n    \r\n    if (userData) {\r\n      const newItems = (userData as any)?.result || [];\r\n      const totalCount = (userData as any).pagination?.totalCount || (userData as any).pagination?.total || 0;\r\n      \r\n      if (page === 1) {\r\n        setAllUsers(newItems);\r\n        setHasMore(newItems.length < totalCount && newItems.length > 0);\r\n      } else {\r\n        setAllUsers(prev => {\r\n          const existingIds = new Set(prev.map((item: any) => item._id));\r\n          const uniqueNewItems = newItems.filter((item: any) => !existingIds.has(item._id));\r\n          const updated = [...prev, ...uniqueNewItems];\r\n          setHasMore(updated.length < totalCount && uniqueNewItems.length > 0);\r\n          return updated;\r\n        });\r\n      }\r\n      \r\n      isLoadingMoreRef.current = false;\r\n    }\r\n  }, [userData, page, visible]);\r\n\r\n  const filteredUsers = allUsers;\r\n\r\n  // Debounce search\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n\r\n    if (searchTerm === debouncedSearch) return;\r\n\r\n    if (searchTimeoutRef.current) {\r\n      clearTimeout(searchTimeoutRef.current);\r\n    }\r\n    \r\n    searchTimeoutRef.current = setTimeout(() => {\r\n      setDebouncedSearch(searchTerm);\r\n      setPage(1);\r\n      setAllUsers([]);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    }, 300);\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [searchTerm, debouncedSearch, visible]);\r\n\r\n  // Reset state when modal opens/closes\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setPage(1);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    } else {\r\n      setSearchTerm('');\r\n      setDebouncedSearch('');\r\n      setPage(1);\r\n      setAllUsers([]);\r\n      setHasMore(true);\r\n      isLoadingMoreRef.current = false;\r\n    }\r\n  }, [visible]);\r\n\r\n  // Consolidated keyboard navigation function\r\n  const navigateToUser = useCallback(\r\n    (direction: 'up' | 'down' | 'home' | 'end') => {\r\n      if (filteredUsers.length === 0) return;\r\n\r\n      let newIndex: number;\r\n      switch (direction) {\r\n        case 'up':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? filteredUsers.length - 1\r\n              : Math.max(selectedRowIndex - 1, 0);\r\n          break;\r\n        case 'down':\r\n          newIndex =\r\n            selectedRowIndex === -1\r\n              ? 0\r\n              : Math.min(selectedRowIndex + 1, filteredUsers.length - 1);\r\n          break;\r\n        case 'home':\r\n          newIndex = 0;\r\n          break;\r\n        case 'end':\r\n          newIndex = filteredUsers.length - 1;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      setSelectedRowIndex(newIndex);\r\n      setSelectedUser(filteredUsers[newIndex]);\r\n\r\n      // Scroll to the selected row\r\n      setTimeout(() => {\r\n        const rowElement = document.querySelector(\r\n          `[data-row-key=\"${filteredUsers[newIndex]._id}\"]`\r\n        ) as HTMLElement;\r\n        if (rowElement) {\r\n          const scrollBehavior =\r\n            direction === 'home'\r\n              ? 'start'\r\n              : direction === 'end'\r\n                ? 'end'\r\n                : 'nearest';\r\n          rowElement.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: scrollBehavior,\r\n          });\r\n        }\r\n      }, 100);\r\n    },\r\n    [filteredUsers, selectedRowIndex]\r\n  );\r\n\r\n  // Debounced search function\r\n  const handleSearch = useCallback(\r\n    (value: string) => {\r\n      setSearchTerm(value);\r\n\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n\r\n      // Search will be handled client-side from cached RTK Query data\r\n      // For server-side search, use refetch with query parameters\r\n      // TODO: Implement server-side search with RTK Query if needed\r\n    },\r\n    []\r\n  );\r\n\r\n  // Handle user selection\r\n  const handleUserSelect = useCallback(\r\n    (user: User) => {\r\n      setSelectedUser(user);\r\n      onSelect(user);\r\n      setTimeout(() => onCancel(), 100);\r\n    },\r\n    [onSelect, onCancel]\r\n  );\r\n\r\n  // Handle keyboard events\r\n  const handleKeyDown = useCallback(\r\n    (e: React.KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onCancel();\r\n      } else if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToUser(directionMap[e.key]);\r\n      }\r\n    },\r\n    [navigateToUser, onCancel]\r\n  );\r\n\r\n  // Global keyboard event handler\r\n  const handleGlobalKeyDown = useCallback(\r\n    (e: KeyboardEvent) => {\r\n      if (!visible) return;\r\n\r\n      // Don't interfere if user is typing in form inputs\r\n      const target = e.target as HTMLElement;\r\n      if (\r\n        target.tagName === 'INPUT' ||\r\n        target.tagName === 'TEXTAREA' ||\r\n        target.classList.contains('ant-select-selector') ||\r\n        target.closest('.ant-select-dropdown')\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (e.ctrlKey && e.key === 'f') {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Only handle navigation keys globally when not in form inputs\r\n      if (['ArrowDown', 'ArrowUp', 'Home', 'End'].includes(e.key)) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const directionMap: Record<string, 'up' | 'down' | 'home' | 'end'> = {\r\n          ArrowDown: 'down',\r\n          ArrowUp: 'up',\r\n          Home: 'home',\r\n          End: 'end',\r\n        };\r\n\r\n        navigateToUser(directionMap[e.key]);\r\n      }\r\n    },\r\n    [visible, navigateToUser]\r\n  );\r\n\r\n  // Memoized table columns\r\n  const columns = useMemo(\r\n    () => [\r\n      {\r\n        title: '',\r\n        key: 'select',\r\n        width: 60,\r\n        render: (text: string, record: User) => (\r\n          <div\r\n            style={{\r\n              cursor: 'pointer',\r\n              display: 'flex',\r\n              justifyContent: 'center',\r\n              alignItems: 'center',\r\n            }}\r\n            onClick={() => {\r\n              setSelectedUser(record);\r\n              const index = filteredUsers.findIndex(\r\n                (u: User) => u._id === record._id\r\n              );\r\n              setSelectedRowIndex(index);\r\n            }}\r\n          >\r\n            <div\r\n              style={{\r\n                width: '18px',\r\n                height: '18px',\r\n                borderRadius: '50%',\r\n                border:\r\n                  selectedUser?._id === record._id\r\n                    ? '2px solid #1890ff'\r\n                    : '2px solid #d9d9d9',\r\n                backgroundColor:\r\n                  selectedUser?._id === record._id ? '#1890ff' : 'white',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                transition: 'all 0.2s ease',\r\n              }}\r\n            >\r\n              {selectedUser?._id === record._id && (\r\n                <div\r\n                  style={{\r\n                    width: '8px',\r\n                    height: '8px',\r\n                    borderRadius: '50%',\r\n                    backgroundColor: 'white',\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Name',\r\n        dataIndex: 'name',\r\n        key: 'name',\r\n        render: (text: string, record: User) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <UserOutlined style={{ color: '#1890ff' }} />\r\n            <div>\r\n              <Text strong>{text}</Text>\r\n              <br />\r\n              <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n                @{record.user_name}\r\n              </Text>\r\n            </div>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Role',\r\n        key: 'role',\r\n        render: (text: string, record: User) => (\r\n          <Tag color=\"blue\">\r\n            {record.roleItems?.name || 'No Role'}\r\n          </Tag>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Mobile',\r\n        dataIndex: 'mobile',\r\n        key: 'mobile',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <PhoneOutlined style={{ color: '#666' }} />\r\n            <Text>{text}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Email',\r\n        dataIndex: 'email',\r\n        key: 'email',\r\n        render: (text: string) => (\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <MailOutlined style={{ color: '#666' }} />\r\n            <Text>{text || '-'}</Text>\r\n          </div>\r\n        ),\r\n      },\r\n      {\r\n        title: 'Branch',\r\n        key: 'branch',\r\n        render: (text: string, record: User) => (\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            {record.branchItems?.branch_name || '-'}\r\n          </Text>\r\n        ),\r\n      },\r\n    ],\r\n    [selectedUser, filteredUsers]\r\n  );\r\n\r\n  // Memoized table row props\r\n  const getRowProps = useCallback(\r\n    (record: User, index?: number) => ({\r\n      onClick: () => {\r\n        setSelectedUser(record);\r\n        setSelectedRowIndex(index ?? 0);\r\n      },\r\n      style: {\r\n        cursor: 'pointer',\r\n        backgroundColor:\r\n          selectedUser?._id === record._id ? '#f0f8ff' : 'white',\r\n        border:\r\n          selectedUser?._id === record._id\r\n            ? '2px solid #1890ff'\r\n            : '1px solid #f0f0f0',\r\n        borderRadius: '4px',\r\n        transition: 'all 0.2s ease',\r\n      },\r\n      onMouseEnter: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedUser?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = '#f5f5f5';\r\n        }\r\n      },\r\n      onMouseLeave: (e: React.MouseEvent<HTMLElement>) => {\r\n        if (selectedUser?._id !== record._id) {\r\n          e.currentTarget.style.backgroundColor = 'white';\r\n        }\r\n      },\r\n    }),\r\n    [selectedUser]\r\n  );\r\n\r\n  // Handle modal close (RTK Query automatically loads on mount)\r\n  useEffect(() => {\r\n    if (visible) {\r\n      setSelectedUser(null);\r\n      setSelectedRowIndex(-1);\r\n    } else {\r\n      setSearchTerm('');\r\n      setSelectedUser(null);\r\n      setSelectedRowIndex(-1);\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n        searchTimeoutRef.current = null;\r\n      }\r\n    }\r\n\r\n    return () => {\r\n      if (searchTimeoutRef.current) {\r\n        clearTimeout(searchTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [visible]);\r\n\r\n  // Auto-select current user when users are loaded\r\n  useEffect(() => {\r\n    if (visible && filteredUsers.length > 0 && currentUser?._id && !selectedUser) {\r\n      const currentUserInList = filteredUsers.find((user: User) => user._id === currentUser._id);\r\n      if (currentUserInList) {\r\n        setSelectedUser(currentUserInList);\r\n        const index = filteredUsers.findIndex((user: User) => user._id === currentUser._id);\r\n        setSelectedRowIndex(index);\r\n        \r\n        // Scroll to the selected user after a short delay\r\n        setTimeout(() => {\r\n          const rowElement = document.querySelector(\r\n            `[data-row-key=\"${currentUserInList._id}\"]`\r\n          ) as HTMLElement;\r\n          if (rowElement) {\r\n            rowElement.scrollIntoView({\r\n              behavior: 'smooth',\r\n              block: 'center',\r\n            });\r\n          }\r\n        }, 200);\r\n      }\r\n    }\r\n  }, [visible, filteredUsers, currentUser?._id, selectedUser]);\r\n\r\n  // Focus search input when modal becomes visible\r\n  useEffect(() => {\r\n    if (visible && searchInputRef.current) {\r\n      const focusSearch = () => {\r\n        if (searchInputRef.current) {\r\n          searchInputRef.current.focus();\r\n          searchInputRef.current.select();\r\n        }\r\n      };\r\n\r\n      focusSearch();\r\n      const timer = setTimeout(focusSearch, 100);\r\n\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [visible]);\r\n\r\n  // Global keyboard event listener\r\n  useEffect(() => {\r\n    if (visible) {\r\n      document.addEventListener('keydown', handleGlobalKeyDown, true);\r\n      return () =>\r\n        document.removeEventListener('keydown', handleGlobalKeyDown, true);\r\n    }\r\n  }, [visible, handleGlobalKeyDown]);\r\n\r\n  // Handle search input focus\r\n  const handleSearchFocus = useCallback(() => {\r\n    setSelectedUser(null);\r\n    setSelectedRowIndex(-1);\r\n  }, []);\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Select User (Billed By)\"\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={900}\r\n      style={{ top: 20 }}\r\n      afterOpenChange={open => {\r\n        if (open && searchInputRef.current) {\r\n          setTimeout(() => {\r\n            searchInputRef.current?.focus();\r\n            searchInputRef.current?.select();\r\n          }, 100);\r\n        }\r\n      }}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        style={{ marginBottom: 16 }}\r\n        onKeyDown={handleKeyDown}\r\n        tabIndex={0}\r\n      >\r\n        <Input\r\n          ref={searchInputRef}\r\n          placeholder=\"Search users... (: Navigate, Enter: Select, Esc: Close)\"\r\n          value={searchTerm}\r\n          onChange={e => handleSearch(e.target.value)}\r\n          prefix={<SearchOutlined />}\r\n          style={{ width: '100%' }}\r\n          onKeyDown={e => {\r\n            // Only handle Enter key in search input, let other keys bubble up\r\n            if (e.key === 'Enter' && selectedUser) {\r\n              handleUserSelect(selectedUser);\r\n            }\r\n          }}\r\n          onFocus={handleSearchFocus}\r\n          autoFocus\r\n          onBlur={() => {\r\n            // Auto-focus back to search if modal is still visible\r\n            if (visible && searchInputRef.current) {\r\n              setTimeout(() => {\r\n                if (visible && searchInputRef.current) {\r\n                  searchInputRef.current.focus();\r\n                }\r\n              }, 10);\r\n            }\r\n          }}\r\n          suffix={\r\n            searchTerm && userLoading ? (\r\n              <div style={{ fontSize: '12px', color: '#999' }}>\r\n                Searching...\r\n              </div>\r\n            ) : null\r\n          }\r\n        />\r\n      </div>\r\n\r\n      <div style={{ maxHeight: 400, overflow: 'auto' }}>\r\n        {userLoading ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text>Loading users...</Text>\r\n          </div>\r\n        ) : filteredUsers.length === 0 ? (\r\n          <div style={{ textAlign: 'center', padding: 40 }}>\r\n            <Text type=\"secondary\">\r\n              {searchTerm\r\n                ? 'No users found matching your search.'\r\n                : 'No users available.'}\r\n            </Text>\r\n          </div>\r\n        ) : (\r\n          <div\r\n            onScroll={(e: any) => {\r\n              const target = e.currentTarget;\r\n              const scrollTop = target.scrollTop;\r\n              const scrollHeight = target.scrollHeight;\r\n              const clientHeight = target.clientHeight;\r\n              const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\r\n              \r\n              if (scrollPercentage > 0.7 && hasMore && !userLoading && !isLoadingMoreRef.current) {\r\n                isLoadingMoreRef.current = true;\r\n                setPage(prev => prev + 1);\r\n              }\r\n            }}\r\n            style={{ maxHeight: 360, overflowY: 'auto' }}\r\n          >\r\n            <Table\r\n              columns={columns}\r\n              dataSource={filteredUsers}\r\n              rowKey=\"_id\"\r\n              pagination={false}\r\n              size=\"small\"\r\n              scroll={{ y: undefined }}\r\n              onRow={getRowProps}\r\n            />\r\n            {hasMore && filteredUsers.length > 0 && (\r\n              <div style={{ textAlign: 'center', padding: '8px', color: '#999', borderTop: '1px solid #f0f0f0' }}>\r\n                {userLoading ? 'Loading more...' : 'Scroll for more users'}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default UserSelectionModal;\r\n","import React, { useEffect, useRef, useCallback } from 'react';\r\nimport { Modal, Button, Typography, Space, Divider, Badge } from 'antd';\r\nimport { \r\n  FileTextOutlined, \r\n  PlusOutlined, \r\n  CheckCircleOutlined,\r\n  DollarOutlined,\r\n  UserOutlined,\r\n  CalendarOutlined,\r\n  EnterOutlined,\r\n  CloseOutlined\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface BillSaveConfirmationModalProps {\r\n  visible: boolean;\r\n  onNewBill: () => void;\r\n  onContinueBill: () => void;\r\n  onCancel: () => void;\r\n  savedBillData?: any;\r\n  onOpenProductModal?: () => void; // Callback to open product selection\r\n}\r\n\r\nconst BillSaveConfirmationModal: React.FC<BillSaveConfirmationModalProps> = ({\r\n  visible,\r\n  onNewBill,\r\n  onContinueBill,\r\n  onCancel,\r\n  savedBillData,\r\n  onOpenProductModal\r\n}) => {\r\n  const newBillButtonRef = useRef<HTMLButtonElement>(null);\r\n\r\n  // Handle new bill with auto-open product modal\r\n  const handleNewBill = useCallback(() => {\r\n    onNewBill();\r\n    // Open product selection modal after a short delay to allow form reset\r\n    if (onOpenProductModal) {\r\n      setTimeout(() => {\r\n        onOpenProductModal();\r\n      }, 100);\r\n    }\r\n  }, [onNewBill, onOpenProductModal]);\r\n\r\n  // Keyboard shortcuts\r\n  useEffect(() => {\r\n    if (!visible) return;\r\n\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // Enter = New Bill (primary action)\r\n      if (e.key === 'Enter' && !e.ctrlKey) {\r\n        e.preventDefault();\r\n        handleNewBill();\r\n      }\r\n      // Ctrl+Enter = Continue Bill\r\n      else if (e.key === 'Enter' && e.ctrlKey) {\r\n        e.preventDefault();\r\n        onContinueBill();\r\n      }\r\n      // Escape = Close\r\n      else if (e.key === 'Escape') {\r\n        e.preventDefault();\r\n        onCancel();\r\n      }\r\n    };\r\n\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    \r\n    // Auto-focus on the primary button\r\n    if (newBillButtonRef.current) {\r\n      newBillButtonRef.current.focus();\r\n    }\r\n\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [visible, handleNewBill, onContinueBill, onCancel]);\r\n\r\n  return (\r\n    <Modal\r\n      title={null}\r\n      open={visible}\r\n      onCancel={onCancel}\r\n      footer={null}\r\n      width={540}\r\n      centered\r\n      maskClosable={false}\r\n      closable={false}\r\n      bodyStyle={{ padding: '24px 20px' }}\r\n    >\r\n      {/* Success Header with Animation */}\r\n      <div style={{ textAlign: 'center', marginBottom: '20px' }}>\r\n        <div \r\n          style={{ \r\n            display: 'inline-block',\r\n            animation: 'successPulse 0.6s ease-out',\r\n            marginBottom: '12px'\r\n          }}\r\n        >\r\n          <CheckCircleOutlined \r\n            style={{ \r\n              color: '#10b981', \r\n              fontSize: '48px',\r\n              filter: 'drop-shadow(0 4px 12px rgba(16, 185, 129, 0.3))'\r\n            }} \r\n          />\r\n        </div>\r\n        <Title level={4} style={{ margin: '6px 0', color: '#10b981', fontWeight: 700 }}>\r\n          Bill Saved Successfully!\r\n        </Title>\r\n        <Text type=\"secondary\" style={{ fontSize: '13px' }}>\r\n          Choose your next action using keyboard shortcuts\r\n        </Text>\r\n      </div>\r\n\r\n      {/* Bill Summary Card */}\r\n      {savedBillData && (\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)',\r\n            border: '2px solid #10b981',\r\n            borderRadius: '10px',\r\n            padding: '14px',\r\n            marginBottom: '20px',\r\n            boxShadow: '0 4px 16px rgba(16, 185, 129, 0.1)',\r\n          }}\r\n        >\r\n          <div style={{ display: 'flex', alignItems: 'center', marginBottom: '12px' }}>\r\n            <FileTextOutlined style={{ fontSize: '16px', color: '#059669', marginRight: '6px' }} />\r\n            <Title level={5} style={{ margin: 0, color: '#059669', fontSize: '14px' }}>\r\n              Bill Summary\r\n            </Title>\r\n          </div>\r\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px' }}>\r\n            <div style={{ \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              gap: '8px',\r\n              padding: '6px 10px',\r\n              background: 'rgba(255, 255, 255, 0.7)',\r\n              borderRadius: '6px'\r\n            }}>\r\n              <FileTextOutlined style={{ color: '#10b981', fontSize: '14px' }} />\r\n              <div>\r\n                <Text type=\"secondary\" style={{ fontSize: '10px', display: 'block' }}>Invoice</Text>\r\n                <Text strong style={{ fontSize: '12px' }}>{savedBillData.invoice_no}</Text>\r\n              </div>\r\n            </div>\r\n            <div style={{ \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              gap: '8px',\r\n              padding: '6px 10px',\r\n              background: 'rgba(255, 255, 255, 0.7)',\r\n              borderRadius: '6px'\r\n            }}>\r\n              <UserOutlined style={{ color: '#10b981', fontSize: '14px' }} />\r\n              <div>\r\n                <Text type=\"secondary\" style={{ fontSize: '10px', display: 'block' }}>Customer</Text>\r\n                <Text strong style={{ fontSize: '12px' }}>{savedBillData.customer_name || 'N/A'}</Text>\r\n              </div>\r\n            </div>\r\n            <div style={{ \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              gap: '8px',\r\n              padding: '6px 10px',\r\n              background: 'rgba(255, 255, 255, 0.7)',\r\n              borderRadius: '6px'\r\n            }}>\r\n              <CalendarOutlined style={{ color: '#10b981', fontSize: '14px' }} />\r\n              <div>\r\n                <Text type=\"secondary\" style={{ fontSize: '10px', display: 'block' }}>Date</Text>\r\n                <Text strong style={{ fontSize: '12px' }}>{dayjs(savedBillData.date).format('DD/MM/YYYY')}</Text>\r\n              </div>\r\n            </div>\r\n            <div style={{ \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              gap: '8px',\r\n              padding: '6px 10px',\r\n              background: 'rgba(255, 255, 255, 0.7)',\r\n              borderRadius: '6px'\r\n            }}>\r\n              <DollarOutlined style={{ color: '#10b981', fontSize: '14px' }} />\r\n              <div>\r\n                <Text type=\"secondary\" style={{ fontSize: '10px', display: 'block' }}>Amount</Text>\r\n                <Text strong style={{ fontSize: '12px', color: '#059669' }}>\r\n                  {(typeof savedBillData.total_amount === 'number' ? savedBillData.total_amount : parseFloat(savedBillData.total_amount) || 0).toFixed(2)}\r\n                </Text>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <Divider style={{ margin: '18px 0', borderColor: '#e5e7eb' }} />\r\n\r\n      {/* Action Buttons with Keyboard Hints */}\r\n      <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n        <Button\r\n          ref={newBillButtonRef}\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          icon={<PlusOutlined />}\r\n          onClick={handleNewBill}\r\n          style={{\r\n            width: '100%',\r\n            height: '48px',\r\n            background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n            border: 'none',\r\n            fontWeight: 600,\r\n            fontSize: '15px',\r\n            borderRadius: '8px',\r\n            boxShadow: '0 4px 16px rgba(16, 185, 129, 0.3)',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            position: 'relative',\r\n            transition: 'all 0.3s ease'\r\n          }}\r\n          onMouseEnter={(e) => {\r\n            e.currentTarget.style.transform = 'translateY(-2px)';\r\n            e.currentTarget.style.boxShadow = '0 6px 20px rgba(16, 185, 129, 0.4)';\r\n          }}\r\n          onMouseLeave={(e) => {\r\n            e.currentTarget.style.transform = 'translateY(0)';\r\n            e.currentTarget.style.boxShadow = '0 4px 16px rgba(16, 185, 129, 0.3)';\r\n          }}\r\n        >\r\n          <span style={{ flex: 1, textAlign: 'left', marginLeft: '8px' }}>\r\n             Create New Bill\r\n          </span>\r\n          <Badge \r\n            count={<span style={{ \r\n              background: 'rgba(255, 255, 255, 0.3)',\r\n              padding: '3px 8px',\r\n              borderRadius: '5px',\r\n              fontSize: '11px',\r\n              fontWeight: 600,\r\n              color: 'white',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '3px'\r\n            }}>\r\n              <EnterOutlined /> Enter\r\n            </span>} \r\n            style={{ marginRight: '6px' }}\r\n          />\r\n        </Button>\r\n        \r\n        <Button\r\n          size=\"large\"\r\n          icon={<FileTextOutlined />}\r\n          onClick={onContinueBill}\r\n          style={{\r\n            width: '100%',\r\n            height: '48px',\r\n            background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\r\n            color: 'white',\r\n            border: 'none',\r\n            fontWeight: 600,\r\n            fontSize: '15px',\r\n            borderRadius: '8px',\r\n            boxShadow: '0 4px 16px rgba(59, 130, 246, 0.3)',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            position: 'relative',\r\n            transition: 'all 0.3s ease'\r\n          }}\r\n          onMouseEnter={(e) => {\r\n            e.currentTarget.style.transform = 'translateY(-2px)';\r\n            e.currentTarget.style.boxShadow = '0 6px 20px rgba(59, 130, 246, 0.4)';\r\n          }}\r\n          onMouseLeave={(e) => {\r\n            e.currentTarget.style.transform = 'translateY(0)';\r\n            e.currentTarget.style.boxShadow = '0 4px 16px rgba(59, 130, 246, 0.3)';\r\n          }}\r\n        >\r\n          <span style={{ flex: 1, textAlign: 'left', marginLeft: '8px' }}>\r\n             Continue with Current Bill\r\n          </span>\r\n          <Badge \r\n            count={<span style={{ \r\n              background: 'rgba(255, 255, 255, 0.3)',\r\n              padding: '3px 8px',\r\n              borderRadius: '5px',\r\n              fontSize: '11px',\r\n              fontWeight: 600,\r\n              color: 'white',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '3px'\r\n            }}>\r\n              Ctrl+<EnterOutlined />\r\n            </span>} \r\n            style={{ marginRight: '6px' }}\r\n          />\r\n        </Button>\r\n\r\n        {/* Close Button */}\r\n        <Button\r\n          size=\"middle\"\r\n          icon={<CloseOutlined />}\r\n          onClick={onCancel}\r\n          type=\"text\"\r\n          style={{\r\n            width: '100%',\r\n            height: '36px',\r\n            fontWeight: 500,\r\n            fontSize: '13px',\r\n            color: '#6b7280',\r\n            transition: 'all 0.3s ease'\r\n          }}\r\n          onMouseEnter={(e) => {\r\n            e.currentTarget.style.color = '#374151';\r\n            e.currentTarget.style.background = '#f3f4f6';\r\n          }}\r\n          onMouseLeave={(e) => {\r\n            e.currentTarget.style.color = '#6b7280';\r\n            e.currentTarget.style.background = 'transparent';\r\n          }}\r\n        >\r\n          Close (ESC)\r\n        </Button>\r\n      </Space>\r\n\r\n      {/* Keyboard Shortcuts Info */}\r\n      <div style={{ \r\n        marginTop: '16px',\r\n        padding: '10px 12px',\r\n        background: 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)',\r\n        borderRadius: '6px',\r\n        border: '1px solid #fbbf24'\r\n      }}>\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n          <span style={{ fontSize: '14px' }}></span>\r\n          <div style={{ flex: 1 }}>\r\n            <Text style={{ fontSize: '11px', color: '#78350f', lineHeight: '1.5' }}>\r\n              <strong>Enter</strong> = New Bill  <strong>Ctrl+Enter</strong> = Continue  <strong>ESC</strong> = Close\r\n            </Text>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* CSS Animation */}\r\n      <style>{`\r\n        @keyframes successPulse {\r\n          0% {\r\n            transform: scale(0);\r\n            opacity: 0;\r\n          }\r\n          50% {\r\n            transform: scale(1.1);\r\n          }\r\n          100% {\r\n            transform: scale(1);\r\n            opacity: 1;\r\n          }\r\n        }\r\n      `}</style>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default BillSaveConfirmationModal;\r\n","import React, { useState, useEffect, useMemo } from 'react';\r\nimport { \r\n  Drawer, \r\n  List, \r\n  Typography, \r\n  Button, \r\n  Input, \r\n  Space, \r\n  Tag, \r\n  Avatar, \r\n  Badge,\r\n  Tooltip,\r\n  Divider,\r\n  Empty,\r\n  Spin,\r\n  Tabs\r\n} from 'antd';\r\nimport { \r\n  SearchOutlined, \r\n  FileTextOutlined, \r\n  UserOutlined, \r\n  CalendarOutlined,\r\n  DollarOutlined,\r\n  EyeOutlined,\r\n  PrinterOutlined,\r\n  PlusOutlined,\r\n  CloseOutlined\r\n} from '@ant-design/icons';\r\nimport dayjs from 'dayjs';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Search } = Input;\r\n\r\ninterface BillListDrawerProps {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onViewBill: (bill: any) => void;\r\n  onNewBill: () => void;\r\n}\r\n\r\nconst BillListDrawer: React.FC<BillListDrawerProps> = ({\r\n  visible,\r\n  onClose,\r\n  onViewBill,\r\n  onNewBill\r\n}) => {\r\n  // Use RTK Query for sales records - Only fetch when drawer is open\r\n  const { data: billListData, isLoading: loading } = apiSlice.useGetSalesRecordQuery(\r\n    {},\r\n    { skip: !visible } //  Only fetch when drawer is visible\r\n  );\r\n  \r\n  // Memoize billList to prevent infinite re-renders\r\n  const billList = useMemo(() => {\r\n    return (billListData as any)?.result || [];\r\n  }, [billListData]);\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [activeTab, setActiveTab] = useState<string>('drafts');\r\n\r\n  // Filter bills based on status and search term\r\n  const filteredBills = useMemo(() => {\r\n    if (!billList || !Array.isArray(billList)) return [];\r\n    \r\n    // First filter by status\r\n    let statusFiltered = billList;\r\n    if (activeTab === 'drafts') {\r\n      statusFiltered = billList.filter((bill: any) => bill.status === 'draft');\r\n    } else {\r\n      statusFiltered = billList.filter((bill: any) => \r\n        !bill.status || bill.status === 'completed'\r\n      );\r\n    }\r\n    \r\n    // Then filter by search term\r\n    if (!searchTerm) return statusFiltered;\r\n    \r\n    const searchLower = searchTerm.toLowerCase();\r\n    return statusFiltered.filter((bill: any) => {\r\n      const invoiceNo = bill.invoice_no || '';\r\n      const customerName = bill.customerDetails?.full_name || '';\r\n      const date = bill.date || '';\r\n      const totalAmount = typeof bill.total_amount === 'number' ? bill.total_amount.toString() : String(bill.total_amount || '');\r\n      \r\n      return (\r\n        invoiceNo.toLowerCase().includes(searchLower) ||\r\n        customerName.toLowerCase().includes(searchLower) ||\r\n        date.includes(searchTerm) ||\r\n        totalAmount.includes(searchTerm)\r\n      );\r\n    });\r\n  }, [billList, searchTerm, activeTab]);\r\n\r\n  const getPaymentStatusColor = (isPaid: boolean, isPartiallyPaid: boolean) => {\r\n    if (isPaid && !isPartiallyPaid) return 'success';\r\n    if (isPartiallyPaid) return 'warning';\r\n    return 'error';\r\n  };\r\n\r\n  const getPaymentStatusText = (isPaid: boolean, isPartiallyPaid: boolean) => {\r\n    if (isPaid && !isPartiallyPaid) return 'Paid';\r\n    if (isPartiallyPaid) return 'Partial';\r\n    return 'Unpaid';\r\n  };\r\n\r\n  const handleViewBill = (bill: any) => {\r\n\r\n    onViewBill(bill);\r\n    onClose();\r\n  };\r\n\r\n  const handleNewBill = () => {\r\n    onNewBill();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Drawer\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n          <Title level={4} style={{ margin: 0, color: '#1f2937' }}>\r\n             Bill List\r\n          </Title>\r\n          <Button\r\n            type=\"text\"\r\n            icon={<CloseOutlined />}\r\n            onClick={onClose}\r\n            size=\"small\"\r\n          />\r\n        </div>\r\n      }\r\n      placement=\"left\"\r\n      open={visible}\r\n      onClose={onClose}\r\n      width={400}\r\n      bodyStyle={{ padding: '16px' }}\r\n      headerStyle={{ \r\n        borderBottom: '1px solid #e5e7eb',\r\n        padding: '16px 16px 12px 16px'\r\n      }}\r\n    >\r\n      {/* Search and New Bill Section */}\r\n      <div style={{ marginBottom: '16px' }}>\r\n        <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n          <Search\r\n            placeholder=\"Search bills by invoice, customer, date...\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n            prefix={<SearchOutlined />}\r\n            allowClear\r\n            size=\"large\"\r\n          />\r\n          \r\n          <Button\r\n            type=\"primary\"\r\n            icon={<PlusOutlined />}\r\n            onClick={handleNewBill}\r\n            style={{\r\n              width: '100%',\r\n              height: '40px',\r\n              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\r\n              border: 'none',\r\n              fontWeight: 600,\r\n              borderRadius: '8px',\r\n            }}\r\n          >\r\n             Create New Bill\r\n          </Button>\r\n        </Space>\r\n      </div>\r\n\r\n      <Divider style={{ margin: '16px 0' }} />\r\n\r\n      {/* Tabs for Drafts and Completed */}\r\n      <Tabs\r\n        activeKey={activeTab}\r\n        onChange={setActiveTab}\r\n        items={[\r\n          {\r\n            key: 'drafts',\r\n            label: (\r\n              <span>\r\n                 Drafts ({billList?.filter((b: any) => b.status === 'draft').length || 0})\r\n              </span>\r\n            ),\r\n          },\r\n          {\r\n            key: 'completed',\r\n            label: (\r\n              <span>\r\n                 Completed ({billList?.filter((b: any) => !b.status || b.status === 'completed').length || 0})\r\n              </span>\r\n            ),\r\n          },\r\n        ]}\r\n        style={{ marginBottom: 16 }}\r\n      />\r\n\r\n      {/* Bill List */}\r\n      <div style={{ height: 'calc(100vh - 250px)', overflow: 'auto' }}>\r\n        {loading ? (\r\n          <div style={{ textAlign: 'center', padding: '40px' }}>\r\n            <Spin size=\"large\" />\r\n            <div style={{ marginTop: '16px' }}>\r\n              <Text type=\"secondary\">Loading bills...</Text>\r\n            </div>\r\n          </div>\r\n        ) : filteredBills.length === 0 ? (\r\n          <Empty\r\n            description={\r\n              <div>\r\n                <Text type=\"secondary\">\r\n                  {searchTerm ? 'No bills found matching your search.' : 'No bills available.'}\r\n                </Text>\r\n                {!searchTerm && (\r\n                  <div style={{ marginTop: '8px' }}>\r\n                    <Button type=\"link\" onClick={handleNewBill}>\r\n                      Create your first bill\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            }\r\n            style={{ marginTop: '40px' }}\r\n          />\r\n        ) : (\r\n          <List\r\n            dataSource={filteredBills}\r\n            renderItem={(bill) => (\r\n              <List.Item\r\n                style={{\r\n                  padding: '16px',\r\n                  border: '1px solid #e5e7eb',\r\n                  borderRadius: '8px',\r\n                  marginBottom: '12px',\r\n                  background: 'white',\r\n                  cursor: 'pointer',\r\n                  transition: 'all 0.2s ease',\r\n                }}\r\n                onMouseEnter={(e) => {\r\n                  e.currentTarget.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';\r\n                  e.currentTarget.style.transform = 'translateY(-2px)';\r\n                }}\r\n                onMouseLeave={(e) => {\r\n                  e.currentTarget.style.boxShadow = 'none';\r\n                  e.currentTarget.style.transform = 'translateY(0)';\r\n                }}\r\n                onClick={() => handleViewBill(bill)}\r\n              >\r\n                <div style={{ width: '100%' }}>\r\n                  {/* Header with Invoice and Status */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center',\r\n                    marginBottom: '8px'\r\n                  }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <Avatar \r\n                        icon={<FileTextOutlined />} \r\n                        style={{ \r\n                          background: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',\r\n                          color: 'white'\r\n                        }} \r\n                      />\r\n                      <Text strong style={{ fontSize: '14px' }}>\r\n                        {bill.invoice_no}\r\n                      </Text>\r\n                    </div>\r\n                    <Space>\r\n                      {bill.status === 'draft' ? (\r\n                        <Tag color=\"orange\">DRAFT</Tag>\r\n                      ) : (\r\n                        <Tag color=\"green\">COMPLETED</Tag>\r\n                      )}\r\n                      <Tag color={getPaymentStatusColor(bill.is_paid, bill.is_partially_paid)}>\r\n                        {getPaymentStatusText(bill.is_paid, bill.is_partially_paid)}\r\n                      </Tag>\r\n                    </Space>\r\n                  </div>\r\n\r\n                  {/* Customer Info */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    alignItems: 'center', \r\n                    gap: '8px',\r\n                    marginBottom: '6px'\r\n                  }}>\r\n                    <UserOutlined style={{ color: '#6b7280', fontSize: '12px' }} />\r\n                    <Text style={{ fontSize: '12px', color: '#374151' }}>\r\n                      {bill.customerDetails?.full_name || bill.customer_name || 'N/A'}\r\n                    </Text>\r\n                  </div>\r\n\r\n                  {/* Date and Amount */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center'\r\n                  }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <CalendarOutlined style={{ color: '#6b7280', fontSize: '12px' }} />\r\n                      <Text style={{ fontSize: '12px', color: '#6b7280' }}>\r\n                        {bill.date ? dayjs(bill.date).format('DD/MM/YYYY') : 'N/A'}\r\n                      </Text>\r\n                    </div>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <DollarOutlined style={{ color: '#10b981', fontSize: '12px' }} />\r\n                      <Text strong style={{ fontSize: '14px', color: '#10b981' }}>\r\n                        {(typeof bill.total_amount === 'number' ? bill.total_amount : parseFloat(bill.total_amount) || 0).toFixed(2)}\r\n                      </Text>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Action Buttons */}\r\n                  <div style={{ \r\n                    display: 'flex', \r\n                    gap: '8px', \r\n                    marginTop: '12px',\r\n                    justifyContent: 'flex-end'\r\n                  }}>\r\n                    <Tooltip title=\"View Bill\">\r\n                      <Button\r\n                        type=\"text\"\r\n                        icon={<EyeOutlined />}\r\n                        size=\"small\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          handleViewBill(bill);\r\n                        }}\r\n                        style={{ color: '#3b82f6' }}\r\n                      />\r\n                    </Tooltip>\r\n                    {bill.status !== 'draft' && (\r\n                      <Tooltip title=\"Print Bill\">\r\n                        <Button\r\n                          type=\"text\"\r\n                          icon={<PrinterOutlined />}\r\n                          size=\"small\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            // Handle print functionality\r\n                          }}\r\n                          style={{ color: '#10b981' }}\r\n                        />\r\n                      </Tooltip>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </List.Item>\r\n            )}\r\n            pagination={false}\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      {/* Footer Stats */}\r\n      <div style={{ \r\n        position: 'absolute', \r\n        bottom: 0, \r\n        left: 0, \r\n        right: 0, \r\n        padding: '16px',\r\n        background: 'white',\r\n        borderTop: '1px solid #e5e7eb'\r\n      }}>\r\n        <div style={{ \r\n          display: 'flex', \r\n          justifyContent: 'space-between', \r\n          alignItems: 'center'\r\n        }}>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            Total Bills: {filteredBills.length}\r\n          </Text>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n             Click on any bill to view details\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Drawer>\r\n  );\r\n};\r\n\r\nexport default BillListDrawer;\r\n","import React, { FC, useEffect, useState } from 'react';\r\nimport { Modal, Descriptions, Typography, Tag, Divider } from 'antd';\r\nimport { apiSlice } from '../../../services/redux/api/apiSlice';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface ProductDetailsModalProps {\r\n  visible: boolean;\r\n  onCancel: () => void;\r\n  productId: string;\r\n}\r\n\r\ninterface ProductDetails {\r\n  _id: string;\r\n  name: string;\r\n  sku: string;\r\n  description?: string;\r\n  selling_price: number;\r\n  mrp: number;\r\n  VariantItem?: {\r\n    variant_name: string;\r\n    variant_code?: string;\r\n  };\r\n  CategoryItem?: {\r\n    name: string;\r\n    tax_percentage: number;\r\n  };\r\n  brand?: string;\r\n  unit?: string;\r\n  min_stock?: number;\r\n  max_stock?: number;\r\n}\r\n\r\nconst ProductDetailsModal: FC<ProductDetailsModalProps> = ({\r\n  visible,\r\n  onCancel,\r\n  productId,\r\n}) => {\r\n  const [productDetails, setProductDetails] = useState<ProductDetails | null>(null);\r\n\r\n  // Load product when modal opens\r\n  const { data: productData, isLoading: loading } = apiSlice.useGetProductQuery({\r\n    _id: productId,\r\n  }, { skip: !visible || !productId });\r\n\r\n  useEffect(() => {\r\n    if (visible && productId && productData) {\r\n      const products = (productData as any)?.result || [];\r\n      const product = Array.isArray(products) ? products.find((p: any) => p._id === productId) : null;\r\n      if (product) {\r\n        setProductDetails(product);\r\n      }\r\n    }\r\n  }, [visible, productId, productData]);\r\n\r\n  const handleCancel = () => {\r\n    setProductDetails(null);\r\n    onCancel();\r\n  };\r\n\r\n  if (!productDetails) {\r\n    return (\r\n      <Modal\r\n        title=\"Product Details\"\r\n        open={visible}\r\n        onCancel={handleCancel}\r\n        footer={null}\r\n        width={600}\r\n        destroyOnClose\r\n      >\r\n        <div style={{ textAlign: 'center', padding: '40px 20px' }}>\r\n          {loading ? (\r\n            <Text>Loading product details...</Text>\r\n          ) : (\r\n            <Text type=\"secondary\">Product not found</Text>\r\n          )}\r\n        </div>\r\n      </Modal>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Modal\r\n      title={\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n          <span> Product Details</span>\r\n          <Tag color=\"blue\" style={{ margin: 0 }}>\r\n            {productDetails.sku}\r\n          </Tag>\r\n        </div>\r\n      }\r\n      open={visible}\r\n      onCancel={handleCancel}\r\n      footer={null}\r\n      width={700}\r\n      destroyOnClose\r\n    >\r\n      <div style={{ padding: '16px 0' }}>\r\n        {/* Product Name and Variant */}\r\n        <div style={{ marginBottom: '24px' }}>\r\n          <Title level={4} style={{ margin: '0 0 8px 0', color: '#1890ff' }}>\r\n            {productDetails.name}\r\n          </Title>\r\n          {productDetails.VariantItem?.variant_name && (\r\n            <Tag color=\"green\" style={{ fontSize: '12px' }}>\r\n              Variant: {productDetails.VariantItem.variant_name}\r\n            </Tag>\r\n          )}\r\n        </div>\r\n\r\n        <Divider style={{ margin: '16px 0' }} />\r\n\r\n        {/* Product Information */}\r\n        <Descriptions\r\n          title=\"Product Information\"\r\n          column={2}\r\n          size=\"small\"\r\n          bordered\r\n          style={{ marginBottom: '24px' }}\r\n        >\r\n          <Descriptions.Item label=\"Product Name\" span={2}>\r\n            <Text strong>{productDetails.name}</Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.VariantItem?.variant_name && (\r\n            <Descriptions.Item label=\"Variant Name\">\r\n              <Text>{productDetails.VariantItem.variant_name}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.VariantItem?.variant_code && (\r\n            <Descriptions.Item label=\"Variant Code\">\r\n              <Text code>{productDetails.VariantItem.variant_code}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          <Descriptions.Item label=\"SKU\">\r\n            <Text code>{productDetails.sku}</Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.brand && (\r\n            <Descriptions.Item label=\"Brand\">\r\n              <Text>{productDetails.brand}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.unit && (\r\n            <Descriptions.Item label=\"Unit\">\r\n              <Text>{productDetails.unit}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.description && (\r\n            <Descriptions.Item label=\"Description\" span={2}>\r\n              <Text>{productDetails.description}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n        </Descriptions>\r\n\r\n        {/* Pricing Information */}\r\n        <Descriptions\r\n          title=\"Pricing & Tax\"\r\n          column={2}\r\n          size=\"small\"\r\n          bordered\r\n          style={{ marginBottom: '24px' }}\r\n        >\r\n          <Descriptions.Item label=\"Selling Price\">\r\n            <Text strong style={{ color: '#52c41a', fontSize: '16px' }}>\r\n              {productDetails.selling_price?.toFixed(2) || '0.00'}\r\n            </Text>\r\n          </Descriptions.Item>\r\n          \r\n          <Descriptions.Item label=\"MRP\">\r\n            <Text style={{ color: '#fa8c16' }}>\r\n              {productDetails.mrp?.toFixed(2) || '0.00'}\r\n            </Text>\r\n          </Descriptions.Item>\r\n          \r\n          {productDetails.CategoryItem?.name && (\r\n            <Descriptions.Item label=\"Category\">\r\n              <Text>{productDetails.CategoryItem.name}</Text>\r\n            </Descriptions.Item>\r\n          )}\r\n          \r\n          {productDetails.CategoryItem?.tax_percentage !== undefined && (\r\n            <Descriptions.Item label=\"Tax Rate\">\r\n              <Tag color=\"orange\">\r\n                {productDetails.CategoryItem.tax_percentage}%\r\n              </Tag>\r\n            </Descriptions.Item>\r\n          )}\r\n        </Descriptions>\r\n\r\n        {/* Stock Information */}\r\n        {(productDetails.min_stock !== undefined || productDetails.max_stock !== undefined) && (\r\n          <Descriptions\r\n            title=\"Stock Information\"\r\n            column={2}\r\n            size=\"small\"\r\n            bordered\r\n          >\r\n            {productDetails.min_stock !== undefined && (\r\n              <Descriptions.Item label=\"Minimum Stock\">\r\n                <Text>{productDetails.min_stock}</Text>\r\n              </Descriptions.Item>\r\n            )}\r\n            \r\n            {productDetails.max_stock !== undefined && (\r\n              <Descriptions.Item label=\"Maximum Stock\">\r\n                <Text>{productDetails.max_stock}</Text>\r\n              </Descriptions.Item>\r\n            )}\r\n          </Descriptions>\r\n        )}\r\n\r\n        {/* Footer Information */}\r\n        <div style={{ \r\n          marginTop: '24px', \r\n          padding: '16px', \r\n          backgroundColor: '#f6f8fa', \r\n          borderRadius: '8px',\r\n          textAlign: 'center'\r\n        }}>\r\n          <Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n            Right-click on product field to view details  Press ESC to close\r\n          </Text>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ProductDetailsModal;\r\n","import React from 'react';\r\nimport { Typography, Button, message } from 'antd';\r\nimport {\r\n  SaveOutlined,\r\n  PrinterOutlined,\r\n  FileTextOutlined,\r\n  ClearOutlined,\r\n  DownloadOutlined,\r\n} from '@ant-design/icons';\r\nimport AntdEditableTable from '../../../components/common/AntdEditableTable';\r\nimport { useAdvancedBilling } from '../hooks/useAdvancedBilling';\r\nimport BillTopBar from './BillTopBar';\r\nimport BillHeader from './BillHeader';\r\nimport BillSummary from './BillSummary';\r\nimport StockSelectionModal from './StockSelectionModal';\r\nimport CustomerSelectionModal from './CustomerSelectionModal';\r\nimport VendorSelectionModal from './VendorSelectionModal';\r\nimport UserSelectionModal from './UserSelectionModal';\r\nimport BillSaveConfirmationModal from './BillSaveConfirmationModal';\r\nimport BillListDrawer from './BillListDrawer';\r\nimport ProductDetailsModal from './ProductDetailsModal';\r\nimport ProductSelectionModal from './ProductSelectionModal';\r\nimport styles from './BillDataGrid.module.css';\r\n\r\nconst { Text } = Typography;\r\n\r\ninterface BillDataGridProps {\r\n  billdata?: any;\r\n  onSuccess?: (formattedBill?: any) => void;\r\n}\r\n\r\n/**\r\n *  REFACTORED BillDataGrid Component\r\n * \r\n * Before: 3,493 lines of code\r\n * After: ~497 lines (86% reduction!)\r\n * \r\n * All logic moved to hooks:\r\n * - useAdvancedBilling: Master orchestration\r\n * - Data, form, modals, calculations, actions\r\n */\r\nconst BillDataGrid: React.FC<BillDataGridProps> = ({ billdata, onSuccess }) => {\r\n  //  ONE HOOK TO RULE THEM ALL\r\n  const billing = useAdvancedBilling({ billdata, onSuccess });\r\n\r\n  // Destructure for easier access\r\n  const {\r\n    billData,\r\n    form,\r\n    modals,\r\n    actions,\r\n    billCalculations,\r\n    handleQuantityChange,\r\n    handleProductSelect,\r\n    handleStockSelect,\r\n    handlePrint,\r\n    handleDownload,\r\n    productOptions,\r\n    customerOptions,\r\n    vendorOptions,\r\n    userOptions,\r\n  } = billing;\r\n\r\n  return (\r\n    <div className={styles.mainContainer}>\r\n      {/* Background Half Circles */}\r\n      <div className={styles.backgroundCircle1} />\r\n      <div className={styles.backgroundCircle2} />\r\n      <div className={styles.backgroundCircle3} />\r\n      <div className={styles.backgroundCircle4} />\r\n      <div className={styles.backgroundCircle5} />\r\n\r\n      {/* Top Bar with Controls */}\r\n      <BillTopBar\r\n        billdata={billdata}\r\n        documentType={form.documentType}\r\n        billSettings={form.billSettings}\r\n        itemCount={form.billFormData.items.length}\r\n        totalAmount={billCalculations.total_amount}\r\n        onDocumentTypeChange={form.setDocumentType}\r\n        onSettingsChange={form.updateSettings}\r\n      />\r\n\r\n      {/* Invoice Header */}\r\n      <div className={styles.invoiceDetailsGrid}>\r\n        <BillHeader\r\n          billFormData={form.billFormData}\r\n          customerOrVendorOptions={\r\n            form.documentType === 'bill' ? customerOptions : vendorOptions\r\n          }\r\n          userOptions={userOptions}\r\n          documentType={form.documentType}\r\n          onHeaderChange={rows => {\r\n            if (rows[0]) {\r\n              const customer =\r\n                form.documentType === 'bill'\r\n                  ? billData.customerListResult.find(\r\n                      (c: any) => c._id === rows[0].customer_id\r\n                    )\r\n                  : billData.vendorListResult.find(\r\n                      (v: any) => v._id === rows[0].customer_id\r\n                    );\r\n              const user = billData.userListResult.find(\r\n                (u: any) => u._id === rows[0].billed_by_id\r\n              );\r\n              form.updateHeader({\r\n                invoice_no: rows[0].invoice_no || '',\r\n                date: rows[0].date,\r\n                customer_id: rows[0].customer_id || '',\r\n                customer_name: customer?.full_name || customer?.vendor_name || '',\r\n                billed_by_id: rows[0].billed_by_id || '',\r\n                billed_by_name: user?.name || '',\r\n                payment_mode: rows[0].payment_mode || 'cash',\r\n              });\r\n            }\r\n          }}\r\n          onCustomerModalOpen={modals.openCustomerModal}\r\n          onUserModalOpen={modals.openUserModal}\r\n          loading={billData.customerLoading || billData.vendorLoading}\r\n        />\r\n      </div>\r\n\r\n      {/* Items Section with Summary */}\r\n      <div className={styles.itemsSection}>\r\n        {/* Decorative circles */}\r\n        <div className={styles.itemsCircle1} />\r\n        <div className={styles.itemsCircle2} />\r\n\r\n        {/* Bill Items Grid */}\r\n        <div className={styles.billItemsGrid}>\r\n          <div className={styles.billItemsHeader}>\r\n            <Text className={styles.billItemsTitle}> BILL ITEMS</Text>\r\n          </div>\r\n\r\n          <AntdEditableTable\r\n            columns={[\r\n              {\r\n                key: 'product_id',\r\n                title: ' PRODUCT',\r\n                dataIndex: 'product_id',\r\n                type: 'product',\r\n                required: true,\r\n                width: 280,\r\n                render: (value: any, record: any, index?: number) => {\r\n                  // Use product data stored in bill item (not from options)\r\n                  const displayName = value\r\n                    ? (record.product_name\r\n                        ? `${record.product_name}${record.variant_name ? ` ${record.variant_name}` : ''}`.trim()\r\n                        : 'Unknown Product')\r\n                    : 'Select product';\r\n                  return (\r\n                    <div\r\n                      style={{\r\n                        cursor: 'pointer',\r\n                        padding: '4px 8px',\r\n                        borderRadius: '4px',\r\n                        border: value ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                        backgroundColor: value ? '#f6ffed' : '#fafafa',\r\n                      }}\r\n                      onClick={() => {\r\n                        if (typeof index === 'number') {\r\n                          modals.openProductSelectionModal(index);\r\n                        }\r\n                      }}\r\n                    >\r\n                      <span style={{ color: value ? '#52c41a' : '#1890ff' }}>\r\n                        {displayName}\r\n                      </span>\r\n                    </div>\r\n                  );\r\n                },\r\n              },\r\n              {\r\n                key: 'stock_id',\r\n                title: ' STOCK',\r\n                dataIndex: 'batch_no',\r\n                type: 'stock',\r\n                required: true,\r\n                width: 200,\r\n                render: (value: any, record: any, index?: number) => {\r\n                  const stockData = (record as any).stockData;\r\n                  const availableQty = stockData?.available_quantity || 0;\r\n                  const hasStock = record.stock_id || stockData;\r\n                  \r\n                  // Determine display text\r\n                  let displayText = 'Select Stock';\r\n                  if (hasStock) {\r\n                    // If we have batch_no, show it with quantity\r\n                    if (value) {\r\n                      displayText = `${value} (Qty: ${availableQty})`;\r\n                    } else {\r\n                      // If stock is selected but no batch_no, show stock ID\r\n                      displayText = `${record.stock_id?.slice(-8) || 'Stock'} (Qty: ${availableQty})`;\r\n                    }\r\n                  }\r\n                  \r\n                  return (\r\n                    <div\r\n                      style={{\r\n                        cursor: 'pointer',\r\n                        padding: '4px 8px',\r\n                        borderRadius: '4px',\r\n                        border: hasStock ? '1px solid #52c41a' : '1px solid #d9d9d9',\r\n                      }}\r\n                      onClick={() => {\r\n                        if (record.product_id && typeof index === 'number') {\r\n                          modals.openStockModal(index);\r\n                        } else if (!record.product_id) {\r\n                          message.warning('Please select a product first');\r\n                        }\r\n                      }}\r\n                    >\r\n                      <span>{displayText}</span>\r\n                    </div>\r\n                  );\r\n                },\r\n              },\r\n              {\r\n                key: 'qty',\r\n                title: ' QTY',\r\n                dataIndex: 'qty',\r\n                type: 'number',\r\n                width: 90,\r\n                editable: true,\r\n              },\r\n              {\r\n                key: 'loose_qty',\r\n                title: ' LOOSE',\r\n                dataIndex: 'loose_qty',\r\n                type: 'number',\r\n                width: 90,\r\n                editable: true,\r\n              },\r\n              {\r\n                key: 'price',\r\n                title: ' RATE',\r\n                dataIndex: 'price',\r\n                type: 'number',\r\n                width: 120,\r\n                editable: false,\r\n              },\r\n              {\r\n                key: 'amount',\r\n                title: ' AMOUNT',\r\n                dataIndex: 'amount',\r\n                type: 'number',\r\n                width: 130,\r\n                editable: false,\r\n              },\r\n            ]}\r\n            dataSource={form.billFormData.items.map((item, index) => ({\r\n              ...item,\r\n              key: index.toString(),\r\n            }))}\r\n            onSave={items => {\r\n              // Handle quantity changes\r\n              const updatedItems = items.map((item, idx) => {\r\n                const currentItem = form.billFormData.items[idx];\r\n                if (\r\n                  item.qty !== currentItem?.qty ||\r\n                  item.loose_qty !== currentItem?.loose_qty\r\n                ) {\r\n                  // Quantity changed, recalculate\r\n                  return item;\r\n                }\r\n                return item;\r\n              });\r\n              billing.handleItemsChange(updatedItems);\r\n            }}\r\n            onAdd={form.addItem}\r\n            onDelete={form.deleteItems}\r\n            onProductSelect={handleProductSelect}\r\n            loading={\r\n              billData.productLoading ||\r\n              billData.stockLoading ||\r\n              billData.branchStockLoading\r\n            }\r\n            className=\"modern-bill-grid\"\r\n            size=\"small\"\r\n            rowKey=\"key\"\r\n            externalEditingCell={modals.externalEditingCell}\r\n          />\r\n        </div>\r\n\r\n        {/* Bill Summary - Right Side */}\r\n        <BillSummary\r\n          billCalculations={billCalculations}\r\n          billSettings={form.billSettings}\r\n          onDiscountChange={value => form.updateSettings({ discount: value })}\r\n          onDiscountTypeChange={checked =>\r\n            form.updateSettings({\r\n              discountType: checked ? 'percentage' : 'amount',\r\n            })\r\n          }\r\n          onPaidAmountChange={value => form.updateSettings({ paidAmount: value })}\r\n        />\r\n      </div>\r\n\r\n      {/* Action Hub */}\r\n      <div className={styles.actionHub}>\r\n        {/* Background decoration */}\r\n        <div className={styles.actionHubCircle1} />\r\n        <div className={styles.actionHubCircle2} />\r\n        <div className={styles.actionHubCircle3} />\r\n        <div className={styles.actionHubCircle4} />\r\n\r\n        <div className={styles.actionButtonsContainer}>\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            icon={<SaveOutlined />}\r\n            onClick={actions.handleSaveDraft}\r\n            loading={billData.saleCreateLoading}\r\n            className={styles.saveButton}\r\n          >\r\n             SAVE DRAFT (F2)\r\n          </Button>\r\n\r\n          <Button\r\n            type=\"primary\"\r\n            size=\"large\"\r\n            icon={<SaveOutlined />}\r\n            onClick={actions.handleCompleteBill}\r\n            loading={billData.saleCreateLoading || billData.saleUpdateLoading}\r\n            className={styles.saveButton}\r\n          >\r\n             {billdata ? 'UPDATE' : 'COMPLETE BILL'} (F3)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<FileTextOutlined />}\r\n            onClick={modals.openBillListDrawer}\r\n            className={styles.billListButton}\r\n          >\r\n             BILL LIST (F6)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<ClearOutlined />}\r\n            onClick={() => {\r\n              form.resetForm();\r\n              message.success('Bill form cleared successfully!');\r\n            }}\r\n            className={styles.clearButton}\r\n          >\r\n             CLEAR (F4 / Ctrl+R)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<PrinterOutlined />}\r\n            className={styles.printButton}\r\n            onClick={handlePrint}\r\n          >\r\n             PRINT {form.documentType === 'bill' ? 'BILL' : 'INVOICE'} (F8)\r\n          </Button>\r\n\r\n          <Button\r\n            size=\"large\"\r\n            icon={<DownloadOutlined />}\r\n            className={styles.downloadButton}\r\n            onClick={handleDownload}\r\n          >\r\n             DOWNLOAD PDF\r\n          </Button>\r\n        </div>\r\n\r\n        <div\r\n          style={{\r\n            background: 'linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)',\r\n            padding: '14px 18px',\r\n            borderRadius: '10px',\r\n            border: '1px solid #cbd5e1',\r\n            position: 'relative',\r\n            zIndex: 1,\r\n            boxShadow: '0 4px 12px rgba(0, 0, 0, 0.05)',\r\n          }}\r\n        >\r\n          <div style={{ textAlign: 'right' }}>\r\n            <Text\r\n              style={{\r\n                color: '#475569',\r\n                fontSize: '12px',\r\n                display: 'block',\r\n                fontWeight: 600,\r\n                lineHeight: '18px',\r\n              }}\r\n            >\r\n               <strong>Keyboard Shortcuts:</strong> Ctrl+S (Save)  Ctrl+N (Add)  F4/Ctrl+R\r\n              (Clear)  Tab/Shift+Tab (Navigate)  Enter (Edit)  Esc (Cancel)  End (Customer) \r\n              Ctrl+U (User)  F5 (Product)  F6 (Bill List)  F7 (Stock)\r\n            </Text>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modals */}\r\n      {modals.stockModalRowIndex !== null && (\r\n        <StockSelectionModal\r\n          visible={true}\r\n          onSelect={handleStockSelect}\r\n          onCancel={modals.closeStockModal}\r\n          productId={form.billFormData.items[modals.stockModalRowIndex]?.product_id || ''}\r\n        />\r\n      )}\r\n\r\n      {form.documentType === 'bill' && (\r\n        <CustomerSelectionModal\r\n          visible={modals.customerModalVisible}\r\n          onSelect={customer => {\r\n            if (form.billFormData.customer_id === customer._id) return;\r\n            form.updateHeader({\r\n              customer_id: customer._id,\r\n              customer_name: customer.full_name,\r\n            });\r\n            modals.closeCustomerModal();\r\n            setTimeout(() => modals.openUserModal(), 100);\r\n            message.success(`Customer \"${customer.full_name}\" selected successfully!`);\r\n          }}\r\n          onCancel={modals.closeCustomerModal}\r\n        />\r\n      )}\r\n\r\n      {form.documentType === 'invoice' && (\r\n        <VendorSelectionModal\r\n          visible={modals.customerModalVisible}\r\n          onSelect={vendor => {\r\n            if (form.billFormData.customer_id === vendor._id) return;\r\n            form.updateHeader({\r\n              customer_id: vendor._id,\r\n              customer_name: vendor.vendor_name,\r\n            });\r\n            modals.closeCustomerModal();\r\n            setTimeout(() => modals.openUserModal(), 100);\r\n            message.success(`Vendor \"${vendor.vendor_name}\" selected successfully!`);\r\n          }}\r\n          onCancel={modals.closeCustomerModal}\r\n        />\r\n      )}\r\n\r\n      <UserSelectionModal\r\n        visible={modals.userModalVisible}\r\n        onSelect={user => {\r\n          if (form.billFormData.billed_by_id === user._id) return;\r\n          form.updateHeader({\r\n            billed_by_id: user._id,\r\n            billed_by_name: user.name,\r\n          });\r\n          modals.closeUserModal();\r\n          message.success(`User \"${user.name}\" selected as billed by successfully!`);\r\n        }}\r\n        onCancel={modals.closeUserModal}\r\n      />\r\n\r\n      <BillSaveConfirmationModal\r\n        visible={modals.saveConfirmationVisible}\r\n        onNewBill={() => {\r\n          form.resetForm();\r\n          modals.closeSaveConfirmation();\r\n          actions.setSavedBillData(null);\r\n          message.success('New bill form cleared successfully!');\r\n        }}\r\n        onContinueBill={() => {\r\n          modals.closeSaveConfirmation();\r\n          actions.setSavedBillData(null);\r\n        }}\r\n        onCancel={modals.closeSaveConfirmation}\r\n        savedBillData={actions.savedBillData}\r\n        onOpenProductModal={() => {\r\n          // Open product selection modal for the first row (index 0)\r\n          modals.openProductSelectionModal(0);\r\n        }}\r\n      />\r\n\r\n      <ProductDetailsModal\r\n        visible={modals.productDetailsModalVisible}\r\n        onCancel={modals.closeProductDetailsModal}\r\n        productId={modals.selectedProductId}\r\n      />\r\n\r\n      <ProductSelectionModal\r\n        visible={modals.productSelectionModalVisible}\r\n        onSelect={product => {\r\n          if (modals.productSelectionRowIndex === null) return;\r\n          \r\n          const newItems = [...form.billFormData.items];\r\n          // Store ALL product data (including tax %, HSN code) for calculations\r\n          newItems[modals.productSelectionRowIndex].product_id = product._id || '';\r\n          newItems[modals.productSelectionRowIndex].product_name = product.name || '';\r\n          newItems[modals.productSelectionRowIndex].variant_name =\r\n            product.VariantItem?.variant_name || '';\r\n          newItems[modals.productSelectionRowIndex].price = product.selling_price || 0;\r\n          newItems[modals.productSelectionRowIndex].tax_percentage = product.CategoryItem?.tax_percentage || 0;\r\n          newItems[modals.productSelectionRowIndex].category_name = product.CategoryItem?.category_name || '';\r\n          newItems[modals.productSelectionRowIndex].hsn_code = product.hsn_code || product.VariantItem?.hsn_code || '';\r\n          newItems[modals.productSelectionRowIndex].hsn_sac = product.hsn_sac || '';\r\n          \r\n          billing.handleItemsChange(newItems);\r\n          modals.closeProductSelectionModal();\r\n          modals.openStockModal(modals.productSelectionRowIndex);\r\n          message.success(`Product \"${product.name}\" selected successfully!`);\r\n        }}\r\n        onCancel={modals.closeProductSelectionModal}\r\n      />\r\n\r\n      <BillListDrawer\r\n        visible={modals.billListDrawerVisible}\r\n        onClose={modals.closeBillListDrawer}\r\n        onViewBill={bill => {\r\n          // Load bill for editing\r\n          form.loadBillData(bill, () => {\r\n            // Recalculate items after loading to populate stock data\r\n            if (form.billFormData.items.length > 0) {\r\n              billing.handleItemsChange(form.billFormData.items);\r\n            }\r\n          });\r\n          billData.refetchAllData();\r\n          modals.closeBillListDrawer();\r\n          message.success(`Bill \"${bill.invoice_no}\" loaded successfully!`);\r\n        }}\r\n        onNewBill={() => {\r\n          form.resetForm();\r\n          modals.closeBillListDrawer();\r\n          message.success('New bill form cleared successfully!');\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BillDataGrid;\r\n\r\n","import { useCallback, useMemo } from 'react';\r\nimport { getEntityHooks } from '../services/redux/api/apiSlice';\r\nimport { API_ROUTES } from '../services/api/utils';\r\n// Define EntityName type locally\r\ntype EntityName = string;\r\n\r\n// Type for RTK query parameters\r\nexport interface RTKQueryParams {\r\n  page?: number;\r\n  limit?: number;\r\n  [key: string]: any;\r\n}\r\n\r\n// Type for RTK mutation result\r\nexport interface RTKMutationResult<T = any> {\r\n  data?: T;\r\n  error?: any;\r\n  isLoading: boolean;\r\n  isSuccess: boolean;\r\n  isError: boolean;\r\n}\r\n\r\n// Type for RTK query result\r\nexport interface RTKQueryResult<T = any> {\r\n  data?: T;\r\n  error?: any;\r\n  isLoading: boolean;\r\n  isSuccess: boolean;\r\n  isError: boolean;\r\n  refetch: () => void;\r\n}\r\n\r\n/**\r\n * Custom hook that provides RTK Query functionality for any entity\r\n * Works with the existing createCrudRoutes system\r\n */\r\nexport const useGenericCrudRTK = <T extends EntityName>(entityName: T) => {\r\n  \r\n  // Get the RTK hooks for this entity\r\n  const entityHooks = useMemo(() => getEntityHooks(entityName), [entityName]);\r\n  \r\n  // Check if entity exists in API_ROUTES\r\n  const entityRoutes = useMemo(() => {\r\n    const routes = API_ROUTES[entityName as keyof typeof API_ROUTES];\r\n    if (!routes || typeof routes !== 'object' || !('GetAll' in routes)) {\r\n      throw new Error(`Entity ${entityName} not found in API_ROUTES or doesn't follow CRUD pattern`);\r\n    }\r\n    return routes as any;\r\n  }, [entityName]);\r\n\r\n  // Get all records with pagination and filters\r\n  const useGetAll = (params: RTKQueryParams = {}) => {\r\n    const query = entityHooks.useGetQuery(params);\r\n    return {\r\n      ...query,\r\n      refetch: query.refetch,\r\n    } as RTKQueryResult;\r\n  };\r\n\r\n  // Get single record by ID\r\n  const useGetById = (id: string, params: RTKQueryParams = {}) => {\r\n    const query = entityHooks.useGetByIdQuery({ id, ...params });\r\n    return {\r\n      ...query,\r\n      refetch: query.refetch,\r\n    } as RTKQueryResult;\r\n  };\r\n\r\n  // Create new record\r\n  const useCreate = () => {\r\n    const [createMutation, result] = entityHooks.useCreateMutation();\r\n    \r\n    const create = useCallback(async (data: any) => {\r\n      try {\r\n        const response = await createMutation(data).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [createMutation]);\r\n\r\n    return {\r\n      create,\r\n      ...result,\r\n    } as RTKMutationResult & { create: (data: any) => Promise<{ data: any; error: any }> };\r\n  };\r\n\r\n  // Update existing record\r\n  const useUpdate = () => {\r\n    const [updateMutation, result] = entityHooks.useUpdateMutation();\r\n    \r\n    const update = useCallback(async (id: string, data: any) => {\r\n      try {\r\n        const response = await updateMutation({ id, data }).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [updateMutation]);\r\n\r\n    return {\r\n      update,\r\n      ...result,\r\n    } as RTKMutationResult & { update: (id: string, data: any) => Promise<{ data: any; error: any }> };\r\n  };\r\n\r\n  // Delete record\r\n  const useDelete = () => {\r\n    const [deleteMutation, result] = entityHooks.useDeleteMutation();\r\n    \r\n    const remove = useCallback(async (id: string) => {\r\n      try {\r\n        const response = await deleteMutation(id).unwrap();\r\n        return { data: response, error: null };\r\n      } catch (error) {\r\n        return { data: null, error };\r\n      }\r\n    }, [deleteMutation]);\r\n\r\n    return {\r\n      delete: remove,\r\n      remove, // Alias for delete\r\n      ...result,\r\n    } as RTKMutationResult & { \r\n      delete: (id: string) => Promise<{ data: any; error: any }>;\r\n      remove: (id: string) => Promise<{ data: any; error: any }>;\r\n    };\r\n  };\r\n\r\n  // Get entity routes for manual API calls\r\n  const getRoutes = useCallback(() => {\r\n    return {\r\n      getAll: entityRoutes.GetAll,\r\n      get: entityRoutes.Get,\r\n      create: entityRoutes.Create,\r\n      update: entityRoutes.Update,\r\n      delete: entityRoutes.Delete,\r\n    };\r\n  }, [entityRoutes]);\r\n\r\n  return {\r\n    // Query hooks\r\n    useGetAll,\r\n    useGetById,\r\n    \r\n    // Mutation hooks\r\n    useCreate,\r\n    useUpdate,\r\n    useDelete,\r\n    \r\n    // Utility functions\r\n    getRoutes,\r\n    \r\n    // Entity info\r\n    entityName,\r\n    entityRoutes,\r\n  };\r\n};\r\n\r\n// Export individual hooks for convenience\r\nexport const useEntityQuery = <T extends EntityName>(entityName: T, params: RTKQueryParams = {}) => {\r\n  const { useGetAll } = useGenericCrudRTK(entityName);\r\n  return useGetAll(params);\r\n};\r\n\r\nexport const useEntityMutation = <T extends EntityName>(entityName: T) => {\r\n  const { useCreate, useUpdate, useDelete } = useGenericCrudRTK(entityName);\r\n  return {\r\n    useCreate,\r\n    useUpdate,\r\n    useDelete,\r\n  };\r\n};\r\n\r\n// Export for backward compatibility\r\nexport default useGenericCrudRTK;","import { handleApiResponse } from './handleApiResponse';\r\nimport { useEffect, useRef } from 'react';\r\n\r\n// RTK Query mutation result type\r\ninterface RTKMutationResult {\r\n  isLoading?: boolean;\r\n  isSuccess?: boolean;\r\n  isError?: boolean;\r\n  data?: any;\r\n  error?: any;\r\n  reset?: () => void;\r\n}\r\n\r\nexport const useHandleApiResponse = ({\r\n  action,\r\n  title,\r\n  mutationResult,\r\n  refetch,\r\n}: {\r\n  action: 'create' | 'update' | 'delete';\r\n  title: string;\r\n  mutationResult: RTKMutationResult;\r\n  refetch?: () => void;\r\n}) => {\r\n  const {\r\n    isLoading,\r\n    isSuccess,\r\n    isError,\r\n    data,\r\n    error,\r\n    reset,\r\n  } = mutationResult;\r\n\r\n  // Track previous loading state to detect transitions\r\n  const prevLoadingRef = useRef<boolean>(false);\r\n  // Track if we've already handled this result to prevent duplicate notifications\r\n  const handledRef = useRef<string>('');\r\n\r\n  useEffect(() => {\r\n    // Track transition from loading to not-loading\r\n    const wasLoading = prevLoadingRef.current;\r\n    prevLoadingRef.current = isLoading || false;\r\n\r\n    // Skip if still loading\r\n    if (isLoading) {\r\n      return;\r\n    }\r\n\r\n    // Only process if we just transitioned from loading to not-loading\r\n    if (!wasLoading) {\r\n      return;\r\n    }\r\n\r\n    // Create a unique key for this result to prevent duplicate handling\r\n    const resultKey = `${isSuccess}-${isError}-${data?.statusCode || ''}-${error?.status || ''}`;\r\n    \r\n    // Skip if we've already handled this exact result\r\n    // Since we're tracking loading transitions, this should only trigger once per mutation\r\n    if (handledRef.current === resultKey) {\r\n      return;\r\n    }\r\n\r\n    // Handle success case\r\n    if (isSuccess && data) {\r\n      const success = data?.statusCode === 200 || data?.status === 'success' || isSuccess;\r\n\r\n      // Prepare refetch function for handleApiResponse\r\n      // RTK Query provides refetch function, entityApi parameter is deprecated\r\n      const refetchFn = refetch;\r\n\r\n      handleApiResponse({\r\n        action,\r\n        title,\r\n        success: true,\r\n        getAllItems: refetchFn,\r\n      });\r\n\r\n      handledRef.current = resultKey;\r\n\r\n      // Reset mutation state if reset function is available\r\n      if (reset) {\r\n        // Delay reset slightly to ensure state updates are processed\r\n        setTimeout(() => {\r\n          reset();\r\n          // Clear handled ref to allow handling new mutations\r\n          handledRef.current = '';\r\n        }, 100);\r\n      }\r\n    }\r\n\r\n    // Handle error case\r\n    if (isError && error) {\r\n      const errorMessage = \r\n        error?.data?.message || \r\n        error?.message || \r\n        error?.error || \r\n        `Failed to ${action} ${title}`;\r\n\r\n      handleApiResponse({\r\n        action,\r\n        title,\r\n        success: false,\r\n        errorMessage,\r\n      });\r\n\r\n      handledRef.current = resultKey;\r\n\r\n      // Reset mutation state if reset function is available\r\n      if (reset) {\r\n        // Delay reset slightly to ensure state updates are processed\r\n        setTimeout(() => {\r\n          reset();\r\n          // Clear handled ref to allow handling new mutations\r\n          handledRef.current = '';\r\n        }, 100);\r\n      }\r\n    }\r\n  }, [\r\n    isLoading,\r\n    isSuccess,\r\n    isError,\r\n    data,\r\n    error,\r\n    action,\r\n    title,\r\n    refetch,\r\n    reset,\r\n  ]);\r\n};\r\n","import { message } from \"antd\";\r\nimport { API_ROUTES } from \"../services/api/utils\";\r\n\r\nexport const showToast = (type: \"success\" | \"error\", content: string) => {\r\n  if (type === \"success\") {\r\n    message.success(content);\r\n  } else if (type === \"error\") {\r\n    message.error(content);\r\n  }\r\n};\r\n\r\n// Generic function to generate API route getters for any entity\r\nexport const createApiRouteGetter = <T extends keyof typeof API_ROUTES>(entityName: T) => {\r\n  return (action: keyof typeof API_ROUTES[T]) => {\r\n    const route = API_ROUTES?.[entityName]?.[action];\r\n    if (!route) {\r\n\r\n      throw new Error(`API route for ${String(entityName)}.${String(action)} is not defined.`);\r\n    }\r\n    return route;\r\n  };\r\n};\r\n\r\n// Generic CRUD factory that creates all CRUD operations for an entity\r\nexport const createCrudOperations = <T extends keyof typeof API_ROUTES>(entityName: T) => {\r\n  const getRoute = createApiRouteGetter(entityName);\r\n  \r\n  return {\r\n    getAll: () => getRoute(\"GetAll\" as keyof typeof API_ROUTES[T]),\r\n    create: () => getRoute(\"Create\" as keyof typeof API_ROUTES[T]),\r\n    update: () => getRoute(\"Update\" as keyof typeof API_ROUTES[T]),\r\n    delete: () => getRoute(\"Delete\" as keyof typeof API_ROUTES[T]),\r\n    get: () => getRoute(\"Get\" as keyof typeof API_ROUTES[T]),\r\n  };\r\n};\r\n\r\n// Auto-generated CRUD operations for all entities (minimal - only for fallback)\r\nexport const CrudOperations = {\r\n  Unit: createCrudOperations(\"Unit\"),\r\n  // Note: All API calls are now handled by RTK Query via apiSlice\r\n  // because they don't follow the standard CRUD pattern\r\n} as const;"],"names":["handleApiResponse","_ref","action","success","title","getAllItems","resetForm","errorMessage","showToast","concat","useTemplateSettings","_userItem$organisatio","userItem","useMemo","getCurrentUser","organisationId","organisation_id","organisationItems","_id","data","settingsData","isLoading","apiSlice","useGetSettingsQuery","page","limit","skip","refetchOnMountOrArgChange","settings","settingsResult","result","Array","isArray","billTemplateKey","bill_template","invoiceTemplateKey","invoice_template","BillTemplateComponent","getBillTemplate","InvoiceTemplateComponent","getInvoiceTemplate","Search","Input","visible","products","providedProducts","onSelect","onCancel","searchTerm","setSearchTerm","useState","debouncedSearch","setDebouncedSearch","setPage","allProducts","setAllProducts","hasMore","setHasMore","selectedRowKey","setSelectedRowKey","highlightedIndex","setHighlightedIndex","scannerVisible","setScannerVisible","searchInputRef","useRef","searchTimeoutRef","isLoadingMoreRef","shouldLoadFromAPI","length","productsData","loading","useGetProductQuery","searchString","useEffect","_pagination","_pagination2","newItems","totalCount","pagination","total","prev","existingIds","Set","map","item","uniqueNewItems","filter","has","updated","current","sourceProducts","filteredProducts","p","_p$name","_p$sku","_p$VariantItem","_p$VariantItem$varian","_p$VariantItem2","_p$VariantItem2$varia","_p$selling_price","searchLower","toLowerCase","name","includes","sku","VariantItem","variant_name","variant_code","selling_price","toString","sort","a","b","_a$name","_a$VariantItem","_a$VariantItem$varian","_a$sku","_b$name","_b$VariantItem","_b$VariantItem$varian","_b$sku","_a$name2","_a$VariantItem2","_a$VariantItem2$varia","_a$sku2","_b$name2","_b$VariantItem2","_b$VariantItem2$varia","_b$sku2","aExactMatch","bExactMatch","aStartsWith","startsWith","bStartsWith","clearTimeout","setTimeout","_searchInputRef$curre","focus","columns","dataIndex","key","width","render","record","_record$VariantItem","_record$VariantItem2","_jsxs","children","_jsx","style","fontWeight","color","fontSize","marginTop","marginLeft","variant","fontStyle","price","toFixed","handleSelectRow","product","Modal","open","footer","destroyOnClose","onClick","handleModalClick","_searchInputRef$curre4","Space","Compact","marginBottom","ref","placeholder","onChange","e","target","value","flex","autoFocus","onKeyDown","_searchInputRef$curre2","preventDefault","next","Math","min","_searchInputRef$curre3","prevIndex","max","selectedProduct","onBlur","_searchInputRef$curre5","Button","type","icon","ScanOutlined","minWidth","onScroll","currentTarget","scrollTop","scrollHeight","clientHeight","maxHeight","overflowY","Table","dataSource","rowKey","size","onRow","idx","_searchInputRef$curre6","onDoubleClick","className","backgroundColor","undefined","border","rowSelection","selectedRowKeys","keys","findIndex","scroll","y","textAlign","padding","borderTop","_searchInputRef$curre7","BarcodeScanner","onClose","onScan","barcode","foundProduct","find","_p$sku2","_p$name2","_p$VariantItem3","_p$VariantItem3$varia","message","warning","description","productId","scopeData","SessionStorageEncryption","getItem","userRole","userType","user_type","usertype","user_role","isOrganisationUser","isBranchUser","shouldFetch","orgStocksData","loadingOrg","useGetStockAuditQuery","product_id","refetchOnFocus","refetchOnReconnect","branchStocksData","loadingBranch","useGetBranchStockQuery","stocks","setErrorMessage","tableBodyRef","isStockExpired","stock","expiry_date","dayjs","isBefore","isStockOutOfStock","available_quantity","showExpiredStockError","expiryDate","format","errorMsg","error","showOutOfStockError","allStocks","s","_s$batch_no","_s$ProductItem","_s$ProductItem$name","_s$ProductItem2","_s$ProductItem2$Varia","_s$ProductItem2$Varia2","_s$available_quantity","_s$sell_price","batch_no","ProductItem","sell_price","firstValidIndex","_allStocks$highlighte","row","querySelector","scrollIntoView","block","_ProductItem$VariantI","isOutOfStock","ExclamationCircleOutlined","today","isExpired","daysUntilExpiry","diff","CheckCircleOutlined","status","Tooltip","Tag","_stock$ProductItem","id","code","available_loose_quantity","finalNext","finalPrev","selectedStock","_searchInputRef$curre8","borderRadius","display","alignItems","gap","i","shiftKey","tabIndex","outline","justifyContent","margin","_searchInputRef$curre9","opacity","cursor","getCheckboxProps","disabled","Text","Typography","onSave","onAdd","onDelete","allowAdd","allowDelete","compact","enableKeyboardNav","onProductSelect","externalEditingCell","setData","selectedRows","setSelectedRows","editingCell","setEditingCell","firstLoadRef","firstProductColIndex","col","String","handleAddRow","firstEditableCol","editable","saveCell","column","required","validation","newData","handleKeyDown","ctrlKey","document","addEventListener","removeEventListener","getNextEditableCol","startCol","direction","EditableCell","_ref2","_data$row","_data$row2","_data$row3","_data$row4","cellValue","setCellValue","inputRef","isProductModalVisible","setIsProductModalVisible","isStockModalVisible","setIsStockModalVisible","_inputRef$current","handleChange","val","stopPropagation","nextCol","nextRow","colIndex","handleProductSelect","handleStockSelect","stock_id","productName","product_name","trim","_Fragment","readOnly","ProductSelectionModal","StockSelectionModal","InputNumber","controls","Select","options","_inputRef$current2","DatePicker","date","mergedColumns","_objectSpread","onCell","_record","rowIndex","onContextMenu","option","opt","label","PlusOutlined","danger","DeleteOutlined","handleDeleteRow","confirm","onOk","slice","SaveOutlined","bordered","useBillCalculations","items","billSettings","billCalculations","productList","isGstIncluded","discount","discountType","itemsWithTax","_product$CategoryItem","_product$VariantItem","taxPercentage","tax_percentage","CategoryItem","baseAmount","Number","qty","loose_qty","pack_size","amount","sub_total","reduce","sum","base_sub_total","discountValue","total_gst","value_of_goods","total_amount","forEach","discountedBase","gstAmount","cgst","sgst","calculateBillTotals","useAdvancedBilling","billdata","onSuccess","billData","_user$organisationIte","user","branchId","branch_id","SalesRecord","useGenericCrudRTK","InvoiceNumberApi","productListData","productLoading","refetch","refetchProducts","customerListData","customerLoading","refetchCustomers","useGetCustomerQuery","vendorListData","vendorLoading","refetchVendors","useGetVendorQuery","userListData","userLoading","refetchUsers","useGetBillingUsersQuery","shouldFetchStockAudit","stockAuditListData","stockLoading","refetchStockAudit","branchStockListData","branchStockLoading","refetchBranchStock","invoiceNoData","refetchInvoiceNo","useGetAll","organisationsData","useGetOrganisationsQuery","productListResult","customerListResult","vendorListResult","userListResult","stockAuditListResult","branchStockListResult","organisationDetails","branchDetails","branchItems","create","createSalesRecord","saleCreateLoading","useCreate","update","updateSalesRecord","saleUpdateLoading","useUpdate","createInvoiceNumber","invoice_no_create_loading","refetchAllData","useBillData","form","useBillForm","billFormData","setBillFormData","invoice_no","customer_id","customer_name","billed_by_id","billed_by_name","payment_mode","setBillSettings","isPaid","isPartiallyPaid","isRetail","paidAmount","documentType","setDocumentType","updateHeader","useCallback","updates","updateItems","addItem","newItem","mrp","deleteItems","indices","_","index","updateSettings","loadBillData","onLoadComplete","_billdata$billedByDet","_billdata$Items","_billdata$is_paid","_billdata$is_partiall","_billdata$is_gst_incl","_billdata$discount","_billdata$discount_ty","_billdata$paid_amount","isInvoice","document_type","partyDetails","vendorDetails","customerDetails","partyId","vendor_id","partyName","vendor_name","full_name","billedByDetails","Items","_item$productItems","_item$productItems2","_item$productItems2$V","_item$productItems3","_item$productItems3$C","_item$productItems4","_item$productItems5","_item$productItems6","_item$productItems6$V","_item$productItems7","_item$productItems8","_item$productItems8$C","productItems","branch_stock_id","hsn_code","hsn_sac","category_name","is_paid","is_partially_paid","sale_type","is_gst_included","discount_type","paid_amount","modals","useBillModals","stockModalRowIndex","setStockModalRowIndex","customerModalVisible","setCustomerModalVisible","userModalVisible","setUserModalVisible","saveConfirmationVisible","setSaveConfirmationVisible","billListDrawerVisible","setBillListDrawerVisible","productDetailsModalVisible","setProductDetailsModalVisible","productSelectionModalVisible","setProductSelectionModalVisible","productSelectionRowIndex","setProductSelectionRowIndex","selectedProductId","setSelectedProductId","lastInteractedRowIndex","setLastInteractedRowIndex","setExternalEditingCell","openStockModal","closeStockModal","openCustomerModal","closeCustomerModal","openUserModal","closeUserModal","openProductSelectionModal","closeProductSelectionModal","openBillListDrawer","closeBillListDrawer","openSaveConfirmation","closeSaveConfirmation","openProductDetailsModal","closeProductDetailsModal","closeAllModals","productOptions","calculateItemAmounts","savedStockData","stockData","stockFromList","_stock$ProductItem$Va","sellPrice","packSize","looseRate","parseInt","batchNo","validateStockQuantities","itemStockData","billItem","_stock$ProductItem2","_stock$ProductItem2$V","packSizeNum","availablePackQty","availableLooseQty","remainingPacks","maxLooseQty","handleItemsChange","validatedItems","useBillItems","actions","config","dispatch","useDispatch","savedBillData","setSavedBillData","createResponse","setCreateResponse","updateResponse","setUpdateResponse","handleSaveDraft","async","payload","_response","response","statusCode","_config$onSaveSuccess","savedData","onSaveSuccess","call","handleCompleteBill","some","stockValidationErrors","join","_response2","_config$onSaveSuccess2","util","invalidateTags","useBillActions","calculatedItems","handleQuantityChange","field","rowOrIndex","_product$CategoryItem2","console","currentItem","productFromStock","_productFromStock$Var","_productFromStock$Cat","_productFromStock$Cat2","handlePrint","selectedParty","billDataForPDF","customerName","customerAddress","address","address1","customerCity","city","customerState","state","customerPincode","pincode","customerPhone","phone","mobile","customerEmail","email","customer_gstin","gst_no","customer_pan","pan_no","qrCodeDataUrl","enable_payment_qr","upi_id","generateUPIQRCode","formatBillToUPIParams","upiParams","qr_size","enhancedSettings","TemplateComponent","element","React","templateHtml","ReactDOMServer","printAsPDF","fileName","handleDownload","downloadAsPDF","shortcuts","onF1AddItem","onF2SaveDraft","onF3CompleteBill","onF4Clear","onF5ProductSelection","onF6BillList","onF7StockSelection","onF8Print","onEndCustomer","onCtrlU","onCtrlS","onCtrlN","onCtrlP","onCtrlR","test","activeElement","closest","input","dispatchEvent","Event","bubbles","_billData$invoiceNoDa","_billData$invoiceNoDa2","_billData$user","currentUser","u","_billData$user2","_billData$settings","default_document_type","customerOptions","customer","push","vendorOptions","vendor","contact_number","userOptions","_user$roleItems","roleItems","background","boxShadow","FileTextOutlined","position","height","transition","left","right","letterSpacing","userSelect","Title","itemCount","totalAmount","onDocumentTypeChange","onSettingsChange","styles","level","marginRight","DocumentTypeToggle","Switch","checkedChildren","unCheckedChildren","checked","customerOrVendorOptions","onHeaderChange","onCustomerModalOpen","onUserModalOpen","headerColumns","selectedItem","isVendor","placeholderText","displayLabel","tooltipText","onMouseEnter","borderColor","onMouseLeave","selectedUser","headerData","AntdEditableTable","onDiscountChange","onDiscountTypeChange","onPaidAmountChange","formatter","replace","parser","Option","CustomerSelectionModalComponent","debouncedSearchTerm","setDebouncedSearchTerm","allCustomers","setAllCustomers","showAddForm","setShowAddForm","selectedCustomer","setSelectedCustomer","selectedRowIndex","setSelectedRowIndex","showCreateGrid","setShowCreateGrid","newCustomerData","setNewCustomerData","customer_type","Form","useForm","modalRef","createGridRef","firstFormInputRef","customerData","refetchCustomerList","_customerRTK$useCreat","createCustomer","createResult","_objectWithoutProperties","_excluded","createLoading","filteredCustomers","shouldShowCreateGrid","getCustomerTypeColor","vip","wholesale","regular","navigateToCustomer","newIndex","rowElement","scrollBehavior","behavior","handleSearch","handleCustomerSelect","clearFormData","resetFields","handleCreateCustomerFromForm","_result$data","_result$data2","newCustomer","handleFormFieldChange","ArrowDown","ArrowUp","Home","End","handleGlobalKeyDown","tagName","classList","contains","select","firstInput","text","c","strong","toUpperCase","PhoneOutlined","MailOutlined","HomeOutlined","getRowProps","focusSearch","timer","useHandleApiResponse","mutationResult","content","duration","destroy","handleSearchFocus","top","afterOpenChange","prefix","SearchOutlined","onFocus","suffix","UserAddOutlined","newState","overflow","zIndex","bottom","Row","justify","align","Col","WebkitBackgroundClip","WebkitTextFillColor","backgroundClip","CloseOutlined","layout","gridTemplateColumns","Item","UserOutlined","rules","pattern","TextArea","rows","resize","Divider","VendorSelectionModalComponent","allVendors","setAllVendors","selectedVendor","setSelectedVendor","vendorData","filteredVendors","getVendorTypeColor","premium","navigateToVendor","selectedRow","handleVendorSelect","ShopOutlined","vendor_type","allUsers","setAllUsers","setSelectedUser","userData","filteredUsers","navigateToUser","handleUserSelect","user_name","_record$roleItems","_record$branchItems","branch_name","currentUserInList","onNewBill","onContinueBill","onOpenProductModal","newBillButtonRef","handleNewBill","window","centered","maskClosable","closable","bodyStyle","animation","CalendarOutlined","DollarOutlined","parseFloat","transform","Badge","count","EnterOutlined","lineHeight","onViewBill","billListData","useGetSalesRecordQuery","billList","activeTab","setActiveTab","filteredBills","statusFiltered","bill","_bill$customerDetails","invoiceNo","getPaymentStatusText","handleViewBill","Drawer","placement","headerStyle","borderBottom","allowClear","Tabs","activeKey","Spin","Empty","List","renderItem","_bill$customerDetails2","Avatar","EyeOutlined","PrinterOutlined","_productDetails$Varia","_productDetails$Varia2","_productDetails$Varia3","_productDetails$selli","_productDetails$mrp","_productDetails$Categ","_productDetails$Categ2","productDetails","setProductDetails","productData","handleCancel","Descriptions","span","brand","unit","min_stock","max_stock","_form$billFormData$it","billing","BillTopBar","BillHeader","v","displayName","availableQty","hasStock","displayText","_record$stock_id","updatedItems","BillSummary","ClearOutlined","DownloadOutlined","CustomerSelectionModal","VendorSelectionModal","UserSelectionModal","BillSaveConfirmationModal","ProductDetailsModal","_product$VariantItem2","BillListDrawer","entityName","entityHooks","getEntityHooks","entityRoutes","routes","API_ROUTES","Error","params","arguments","query","useGetQuery","useGetById","useGetByIdQuery","createMutation","useCreateMutation","unwrap","updateMutation","useUpdateMutation","useDelete","deleteMutation","useDeleteMutation","remove","delete","getRoutes","getAll","GetAll","get","Get","Create","Update","Delete","isSuccess","isError","reset","prevLoadingRef","handledRef","wasLoading","resultKey","refetchFn","_error$data","getRoute","_API_ROUTES$entityNam","route","createApiRouteGetter","createCrudOperations"],"sourceRoot":""}