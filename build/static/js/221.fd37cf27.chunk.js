/*! For license information please see 221.fd37cf27.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[221],{33359:(e,l,t)=>{t.d(l,{A:()=>o});var a=t(65043),i=t(71360),n=t(66381);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var l=1;l<arguments.length;l++){var t=arguments[l];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},s.apply(this,arguments)}const r=(e,l)=>a.createElement(n.A,s({},e,{ref:l,icon:i.A}));const o=a.forwardRef(r)},37221:(e,l,t)=>{t.r(l),t.d(l,{default:()=>f});var a=t(65043),i=t(82863),n=t(74198),s=t(76399),r=t(70579);const o=[{title:"Name",dataIndex:"name",key:"name",render:e=>(0,r.jsx)("strong",{children:e})},{title:"Username",dataIndex:"user_name",key:"user_name",render:e=>(0,r.jsx)("span",{style:{color:"#1890ff"},children:e})},{title:"Email",dataIndex:"email",key:"email"},{title:"Mobile",dataIndex:"mobile",key:"mobile"},{title:"Role",dataIndex:"roleItems",key:"role_id",render:e=>(0,r.jsx)(s.A,{color:"geekblue",children:null===e||void 0===e?void 0:e.name})},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,r.jsx)(s.A,{color:e?"green":"volcano",children:e?"Active":"Inactive"})}];var d=t(36621),c=t(26553),u=t(12624);const m=function(){let{roles:e=[],organisation:l=[],branches:t=[],selectedOrganisationId:a=null,userItemRole:i=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{label:"Full Name",name:"name",rules:[{required:!0,message:"Please enter full name"}],component:(0,r.jsx)(d.A,{placeholder:"Enter full name"})},{label:"Email",name:"email",rules:[{required:!0,message:"Please enter email"},{type:"email",message:"Enter a valid email"}],component:(0,r.jsx)(d.A,{placeholder:"Enter email"})},{label:"Username",name:"user_name",rules:[{required:!0,message:"Please enter username"}],component:(0,r.jsx)(d.A,{placeholder:"Enter username"})},{label:"Mobile Number",name:"mobile",rules:[{required:!0,message:"Please enter mobile number"},{pattern:/^[0-9]{10}$/,message:"Enter valid 10-digit mobile number"}],component:(0,r.jsx)(d.A,{placeholder:"Enter mobile number",maxLength:10})},{label:"Password",name:"password",rules:[{required:!0,message:"Please enter password"}],component:(0,r.jsx)(d.A.Password,{placeholder:"Enter password"})},{label:"Role",name:"role_id",rules:[{required:!0,message:"Please select a role"}],component:(0,r.jsx)(c.A,{placeholder:"Select role",allowClear:!0,showSearch:!0,children:e.map((e=>(0,r.jsx)(c.A.Option,{value:e.value,children:e.label},e.value)))})},..."OrganisationAdmin"!==i&&"BranchAdmin"!==i?[{label:"Organisation",name:"organisation_id",rules:[{required:!0,message:"Please select a organisation"}],component:(0,r.jsx)(c.A,{placeholder:"Select organisation",allowClear:!0,showSearch:!0,children:l.map((e=>(0,r.jsx)(c.A.Option,{value:e.value,children:e.label},e.value)))})}]:[],..."BranchAdmin"!==i?[{label:"Branch",name:"branch_id",rules:[{required:!1,message:"Please select a branch"}],component:(0,r.jsx)(c.A,{placeholder:"Select branch",allowClear:!0,showSearch:!0,disabled:"BranchAdmin"===i&&!a,children:("BranchAdmin"!==i?t:t.filter((e=>("string"===typeof a||"number"===typeof a)&&e.organisation_id===a))).map((e=>(0,r.jsx)(c.A.Option,{value:e.value,children:e.label},e.value)))})}]:[],{label:"Active Status",name:"status",valuePropName:"checked",component:(0,r.jsx)(u.A,{checkedChildren:"Active",unCheckedChildren:"Inactive"})}]};var p=t(4825),h=t(95005),g=t(62305);const v=()=>{var e,l,t,s;const{getEntityApi:d}=(0,p.p)(),c=["Roles","Organisations","Braches"].map(d),[u,v,f]=c,{items:A}=(0,h.S)(u.getIdentifier("GetAll")),{items:b}=(0,h.S)(v.getIdentifier("GetAll")),{items:x}=(0,h.S)(f.getIdentifier("GetAll")),j=(0,a.useMemo)((()=>{const e=sessionStorage.getItem("user");return e?JSON.parse(e):null}),[]),y=(null===j||void 0===j||null===(e=j.roleItems)||void 0===e?void 0:e.name)||(null===j||void 0===j?void 0:j.usertype)||(null===j||void 0===j?void 0:j.user_role)||"";(0,a.useEffect)((()=>{[u,v].forEach((e=>e("GetAll"))),"tenant"===y&&"superadmin"===y||f("GetAll")}),[u,v]);const C=(null===A||void 0===A||null===(l=A.result)||void 0===l?void 0:l.map((e=>({label:e.name,value:e._id}))))||[],k=(null===b||void 0===b||null===(t=b.result)||void 0===t?void 0:t.map((e=>({label:e.org_name||e.name,value:e._id}))))||[],w=(null===x||void 0===x||null===(s=x.result)||void 0===s?void 0:s.map((e=>({label:e.branch_name||e.name,value:e._id,organisation_id:e.organisation_id||e.org_id}))))||[],[R]=g.A.useForm(),[S,I]=(0,a.useState)(null);return(0,r.jsx)(i.r,{config:{title:"Users",columns:o,formItems:m({roles:C,organisation:k,branches:w,selectedOrganisationId:S,userItemRole:y}),apiRoutes:(0,n._V)("BillingUsers"),formColumns:2},onValuesChange:(e,l)=>{var t;void 0!==e.organisation_id&&(t=e.organisation_id,f("GetAll",{organisation_id:t}),I(void 0===t||""===t?null:t),R.setFieldsValue({branch_id:void 0}))}})},f=(0,a.memo)(v)},74198:(e,l,t)=>{t.d(l,{_V:()=>i});t(65043);var a=t(91449);t(27038);const i=e=>{const l=a.LE[e]||(0,a.lX)(e);return{get:l.getAll(),create:l.create(),update:l.update(),delete:l.delete()}}},82863:(e,l,t)=>{t.d(l,{r:()=>E});var a=t(89379),i=t(65043),n=t(96651),s=t(47419),r=t(11645),o=t(36621),d=t(26553),c=t(93504),u=t(95206),m=t(33359),p=t(9316),h=t(83003),g=t(62305),v=t(97031),f=t(91449),A=t(60446),b=t.n(A);var x=t(22671),j=t(53986),y=t(83833),C=t(88655),k=t(73847),w=t(70579);const R=["key","name","fieldKey"],S=e=>{const{FormValue:l,onSubmit:t,onCancel:n,formItems:o,onChildCancel:d,formColumns:c,splitLabelAndField:m,nested:p,nestedInputs:h,wrapperCol:v,labelCol:f,initialValues:A,loading:b,form:x,onValuesChange:S}=e,I=c||1;return(0,i.useEffect)((()=>{A&&(null===x||void 0===x||x.setFieldsValue(A))}),[A,x]),(0,w.jsxs)("div",{style:{position:"relative",height:"100%"},children:[(0,w.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"600px 600px",opacity:.1,zIndex:0}}),(0,w.jsxs)(g.A,{form:x,onFinish:e=>{t?t(e):l&&l(e),null===x||void 0===x||x.resetFields()},layout:"vertical",onValuesChange:S,children:[(0,w.jsxs)(s.A,{gutter:[16,16],children:[null===o||void 0===o?void 0:o.map(((e,l)=>{var t;return(0,w.jsx)(r.A,{span:24/I,children:m?(0,w.jsxs)("div",{children:[(0,w.jsxs)(y.A.Text,{strong:!0,children:[e.label," ",(null===(t=e.rules)||void 0===t?void 0:t.some((e=>e.required)))&&(0,w.jsx)(y.A.Text,{type:"danger",children:"*"})]}),(0,w.jsx)(g.A.Item,{name:e.name,rules:e.rules,style:{marginTop:"8px"},children:e.component})]}):(0,w.jsx)(g.A.Item,{label:(0,w.jsx)(y.A.Text,{strong:!0,children:e.label}),name:e.name,rules:e.rules,labelCol:{span:f},wrapperCol:{span:v},children:e.component})},l)})),p&&(0,w.jsx)(g.A.List,{name:"nestedItems",children:(e,l)=>{let{add:t,remove:i}=l;return(0,w.jsxs)(w.Fragment,{children:[e.map((e=>{let{key:l,name:t,fieldKey:n}=e,o=(0,j.A)(e,R);return(0,w.jsxs)(s.A,{gutter:[16,16],align:"middle",children:[h.map(((e,l)=>(0,w.jsx)(r.A,{children:(0,w.jsx)(g.A.Item,(0,a.A)((0,a.A)({},o),{},{name:[t,e.name],fieldKey:[n,e.name],rules:[{required:!0,message:"Missing ".concat(e.label)}],label:e.label,children:e.component}))},l))),(0,w.jsx)(r.A,{children:(0,w.jsx)(C.A,{onClick:()=>i(t)})})]},l)})),(0,w.jsx)(s.A,{justify:"center",children:(0,w.jsx)(r.A,{children:(0,w.jsx)(u.Ay,{type:"primary",onClick:()=>t(),icon:(0,w.jsx)(k.A,{}),children:"Add More Field"})})})]})}})]}),(0,w.jsxs)(s.A,{justify:"end",gutter:[16,16],style:{padding:"16px"},children:[(0,w.jsx)(r.A,{children:(0,w.jsx)(u.Ay,{onClick:()=>{n?n():d&&d(!1),null===x||void 0===x||x.resetFields()},children:"Cancel"})}),(0,w.jsx)(r.A,{children:(0,w.jsx)(u.Ay,{type:"primary",htmlType:"submit",loading:b,children:"Submit"})})]})]})]})};var I=t(4413);function _(e,l,t){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{title:"Actions",key:"actions",render:(i,s)=>(0,w.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,w.jsx)(n.A,{title:"Edit ".concat(e),children:(0,w.jsx)(m.A,{style:{cursor:"pointer",color:"#1890ff"},onClick:()=>l(s)})}),(0,w.jsx)(n.A,{title:"Delete ".concat(e),children:(0,w.jsx)(p.A,{style:{cursor:a?"not-allowed":"pointer",color:a?"#d9d9d9":"#ff4d4f",opacity:a?.5:1},onClick:()=>!a&&t(s)})})]})}}const E=e=>{let{config:l,filters:t=[],onFilterChange:n,customButtons:m=[],onValuesChange:p}=e;const{loading:A,createLoading:j,updateLoading:y,deleteLoading:C,items:k,pagination:R,drawerVisible:E,initialValues:V,form:F,handleEdit:P,handleDelete:L,handleDrawerOpen:O,resetForm:B,handleSubmit:q,handlePaginationChange:G,columns:N,formItems:K,formColumns:M=2,drawerWidth:T,filterValues:U,setFilterValues:z}=(e=>{const l=(0,h.wA)(),[t]=g.A.useForm(),[n,s]=(0,i.useState)(!1),[r,o]=(0,i.useState)({}),[d,c]=(0,i.useState)({}),[u,m]=(0,i.useState)({current:1,pageSize:10}),{loading:p,items:A}=(0,v.Sm)(e.apiRoutes.get.identifier),{loading:x,items:j,error:y}=(0,v.Sm)(e.apiRoutes.create.identifier),{loading:C,items:k,error:w}=(0,v.Sm)(e.apiRoutes.update.identifier),{loading:R,items:S,error:I}=(0,v.Sm)(e.apiRoutes.delete.identifier),_=(0,i.useCallback)(((e,t,a,i)=>{l((0,v.s7)({method:e,endpoint:t,data:a},i))}),[l]),E=(0,i.useCallback)((()=>{const l=(0,a.A)((0,a.A)({},d),{},{pageNumber:u.current,pageLimit:u.pageSize});_(e.apiRoutes.get.method,e.apiRoutes.get.endpoint,l,e.apiRoutes.get.identifier)}),[_,e.apiRoutes.get,d,u]),V=(0,i.useCallback)((l=>{_(e.apiRoutes.create.method,e.apiRoutes.create.endpoint,l,e.apiRoutes.create.identifier)}),[_,e.apiRoutes.create]),F=(0,i.useCallback)(((l,t)=>{_(e.apiRoutes.update.method,"".concat(e.apiRoutes.update.endpoint,"/").concat(l),t,e.apiRoutes.update.identifier)}),[_,e.apiRoutes.update]),P=(0,i.useCallback)((l=>{_(e.apiRoutes.delete.method,"".concat(e.apiRoutes.delete.endpoint,"/").concat(l),{_id:l},e.apiRoutes.delete.identifier)}),[_,e.apiRoutes.delete]),L=(0,i.useCallback)(((e,l)=>{m({current:e,pageSize:l})}),[]);function O(e){return/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})?)?$/.test(e)}const B=(0,i.useCallback)((e=>{const l={};for(const t in e){const a=e[t];"string"===typeof a&&O(a)&&b()(a,void 0,!0).isValid()?l[t]=b()(a):l[t]=a}o(l),s(!0)}),[]),q=(0,i.useCallback)((e=>{P(e._id)}),[P]),G=(0,i.useCallback)((()=>{s(!0)}),[]),N=(0,i.useCallback)((()=>{s(!1),o({}),t.resetFields()}),[t]),K=(0,i.useCallback)((e=>{r._id?F(r._id,e):V(e)}),[r._id,V,F]);return(0,i.useEffect)((()=>{if(200===(null===j||void 0===j?void 0:j.statusCode))(0,f.P0)("success","".concat(e.title," created successfully")),E(),N(),l((0,v.Ki)(e.apiRoutes.create.identifier));else if(y){const l=y.message||"Failed to create ".concat(e.title);(0,f.P0)("error",l)}}),[j,y,e.title,E,N,l,e.apiRoutes.create.identifier]),(0,i.useEffect)((()=>{if(200===(null===k||void 0===k?void 0:k.statusCode))(0,f.P0)("success","".concat(e.title," updated successfully")),E(),N(),l((0,v.Ki)(e.apiRoutes.update.identifier));else if(w){const l=w.message||"Failed to update ".concat(e.title);(0,f.P0)("error",l)}}),[k,w,e.title,E,N,l,e.apiRoutes.update.identifier]),(0,i.useEffect)((()=>{if(200===(null===S||void 0===S?void 0:S.statusCode))(0,f.P0)("success","".concat(e.title," deleted successfully")),E(),l((0,v.Ki)(e.apiRoutes.delete.identifier));else if(I){const l=I.message||"Failed to delete ".concat(e.title);(0,f.P0)("error",l)}}),[S,I,e.title,E,l,e.apiRoutes.delete.identifier]),(0,i.useEffect)((()=>{E()}),[E]),(0,a.A)({loading:p,createLoading:x,updateLoading:C,deleteLoading:R,items:null===A||void 0===A?void 0:A.result,pagination:null===A||void 0===A?void 0:A.pagination,drawerVisible:n,initialValues:r,form:t,filterValues:d,setFilterValues:c,handleEdit:B,handleDelete:q,handleDrawerOpen:G,resetForm:N,handleSubmit:K,handlePaginationChange:L},e)})(l),D=(0,i.useCallback)(((e,l)=>{const t=(0,a.A)((0,a.A)({},U),{},{[e]:l});z(t),n&&n(t)}),[U,z,n]),$=(0,i.useMemo)((()=>[...N,_(l.title,P,L,C)]),[N,l.title,P,L,C]);return(0,w.jsxs)("div",{children:[(0,w.jsxs)(s.A,{justify:"space-between",align:"bottom",gutter:[16,16],style:{marginBottom:16},children:[(0,w.jsx)(r.A,{flex:"auto",children:(0,w.jsx)("h1",{style:{margin:0},children:l.title})}),(0,w.jsx)(r.A,{children:(0,w.jsxs)(s.A,{gutter:[12,12],align:"bottom",justify:"end",wrap:!0,children:[t.map((e=>{var l;return(0,w.jsxs)(r.A,{children:["input"===e.type&&(0,w.jsx)(o.A,{placeholder:e.placeholder||e.label,value:U[e.key]||"",onChange:l=>D(e.key,l.target.value),style:{width:e.width||200},disabled:j||y||C}),"select"===e.type&&(0,w.jsx)(d.A,{placeholder:e.placeholder||e.label,value:U[e.key],onChange:l=>{D(e.key,l),e.onChange&&e.onChange(l)},allowClear:!0,style:{width:e.width||200},disabled:e.disabled||j||y||C,children:null===(l=e.options)||void 0===l?void 0:l.map((e=>(0,w.jsx)(d.A.Option,{value:e.value,children:e.label},e.value)))}),"date"===e.type&&(0,w.jsx)(c.A,{placeholder:e.placeholder||e.label,value:U[e.key],onChange:l=>D(e.key,l),style:{width:e.width||200},disabled:j||y||C})]},e.key)})),(0,w.jsx)(r.A,{children:(0,w.jsx)(o.A,{placeholder:"Search ".concat(l.title),value:U.searchString||"",onChange:e=>D("searchString",e.target.value),style:{width:200},disabled:j||y||C})}),m.map((e=>(0,w.jsx)(r.A,{children:(0,w.jsx)(u.Ay,{type:e.type||"default",onClick:e.onClick,icon:e.icon,disabled:j||y||C,children:e.label})},e.key))),(0,w.jsx)(r.A,{children:(0,w.jsxs)(u.Ay,{type:"primary",onClick:O,loading:j,disabled:j,children:["Add ",l.title]})})]})})]}),(0,w.jsx)(I.A,{columns:$,data:k,loading:A||C,rowKeyField:"_id",totalCount:(null===R||void 0===R?void 0:R.totalCount)||0,pageLimit:(null===R||void 0===R?void 0:R.pageLimit)||10,onPaginationChange:G}),(0,w.jsx)(x.A,{title:"".concat(V._id?"Edit":"Add"," ").concat(l.title),open:E,onClose:j||y?()=>{}:B,width:T,children:(0,w.jsx)(S,{form:F,formItems:K,formColumns:M,initialValues:V,onSubmit:q,onCancel:B,onValuesChange:p,loading:j||y})})]})}}}]);
//# sourceMappingURL=221.fd37cf27.chunk.js.map