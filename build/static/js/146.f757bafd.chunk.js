"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[146],{26016:(e,l,a)=>{a.d(l,{y:()=>i});var t=a(91449);const i=e=>{let{action:l,success:a,title:i,getAllItems:n,resetForm:s,errorMessage:r}=e;a?((0,t.P0)("success","".concat(i," ").concat(l,"d successfully")),null===n||void 0===n||n(),null===s||void 0===s||s()):(0,t.P0)("error",r||"Failed to ".concat(l," ").concat(i))}},54505:(e,l,a)=>{a.d(l,{B:()=>r});var t=a(65043),i=a(98350),n=a(89472),s=a(66507);const r=()=>{const[e,l]=(0,t.useState)("all"),[a,r]=(0,t.useState)("all"),[o,d]=(0,t.useState)("all"),c=(0,t.useMemo)((()=>(0,n.HW)()),[]),u=(0,t.useMemo)((()=>s.A.getItem("scope")),[]),m=(0,t.useMemo)((()=>(null===u||void 0===u?void 0:u.userType)||(null===c||void 0===c?void 0:c.user_type)||(null===c||void 0===c?void 0:c.usertype)||(null===c||void 0===c?void 0:c.user_role)||""),[u,c]),h=(0,t.useMemo)((()=>"superadmin"===m.toLowerCase()),[m]),p=(0,t.useMemo)((()=>"tenant"===m.toLowerCase()),[m]),g=(0,t.useMemo)((()=>"organisationuser"===m.toLowerCase()),[m]),v=(0,t.useMemo)((()=>"branchuser"===m.toLowerCase()),[m]),{data:y,isLoading:x,refetch:A}=i.lh.useGetTenantAccountsQuery({},{skip:!h}),b=(0,t.useMemo)((()=>{if(h)return"all"!==e?e:void 0}),[h,e]),{data:f,isLoading:j,refetch:_}=i.lh.useGetOrganisationsQuery(b?{tenant_id:b}:{},{skip:!p&&!h||h&&!b}),w=(0,t.useMemo)((()=>{var e;return g?(null===c||void 0===c?void 0:c.organisation_id)||(null===c||void 0===c||null===(e=c.organisationItems)||void 0===e?void 0:e._id):"all"!==a?a:void 0}),[a,g,c]),{data:C,isLoading:k,refetch:F}=i.lh.useGetBranchesQuery(w?{organisation_id:w,org_id:w}:{},{skip:!h&&!p&&!g||!w}),S=(null===y||void 0===y?void 0:y.result)||[],M=(null===f||void 0===f?void 0:f.result)||[],L=(null===C||void 0===C?void 0:C.result)||[],I=(0,t.useMemo)((()=>(null===S||void 0===S?void 0:S.map((e=>({label:e.organization_name||e.contact_name||e.username,value:e._id}))))||[]),[S]),O=(0,t.useMemo)((()=>{let l=M||[];return h&&"all"!==e&&(l=l.filter((l=>l.tenant_id===e))),l.map((e=>({label:e.org_name||e.name,value:e._id})))}),[M,e,h]),T=(0,t.useMemo)((()=>{let e=L||[];return"all"!==a&&(e=e.filter((e=>e.organisation_id===a||e.org_id===a))),e.map((e=>({label:e.branch_name||e.name,value:e._id})))}),[L,a]),N=(0,t.useCallback)((e=>{l(e),r("all"),d("all")}),[]),P=(0,t.useCallback)((e=>{r(e),d("all")}),[]),D=(0,t.useCallback)((e=>{d(e)}),[]),E=(0,t.useCallback)((()=>{const l={};return h&&e&&"all"!==e&&(l.tenant_id=e),(h||p)&&a&&"all"!==a&&(l.organisation_id=a,l.org_id=a),(h||p||g)&&o&&"all"!==o&&(l.branch_id=o),l}),[h,p,g,e,a,o]);return{isSuperAdmin:h,isTenant:p,isOrganisationUser:g,isBranchUser:v,selectedTenant:e,selectedOrganisation:a,selectedBranch:o,tenantOptions:I,organisationOptions:O,branchOptions:T,handleTenantChange:N,handleOrganisationChange:P,handleBranchChange:D,tenantsLoading:x,organisationsLoading:j,branchesLoading:k,getApiFilters:E}}},73146:(e,l,a)=>{a.d(l,{r:()=>le});var t=a(89379),i=a(65043),n=a(96651),s=a(60647),r=a(47419),o=a(11645),d=a(26553),c=a(36621),u=a(93504),m=a(95206),h=a(33359),p=a(9316),g=a(62305),v=a(98350),y=a(26016),x=a(60446),A=a.n(x);var b=a(22671),f=a(53986),j=a(71782),_=a(88655),w=a(73847),C=a(70579);const k=["key","name","fieldKey"],F=e=>{const{FormValue:l,onSubmit:a,onCancel:n,formItems:s,onChildCancel:d,formColumns:c,splitLabelAndField:u,nested:h,nestedInputs:p,wrapperCol:v,labelCol:y,initialValues:x,loading:A,form:b,onValuesChange:F}=e,S=c||1;return(0,i.useEffect)((()=>{x&&(null===b||void 0===b||b.setFieldsValue(x))}),[x,b]),(0,C.jsxs)("div",{style:{position:"relative",height:"100%"},children:[(0,C.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"600px 600px",opacity:.1,zIndex:0}}),(0,C.jsxs)(g.A,{form:b,onFinish:e=>{a?a(e):l&&l(e),null===b||void 0===b||b.resetFields()},layout:"vertical",onValuesChange:F,children:[(0,C.jsxs)(r.A,{gutter:[16,16],children:[null===s||void 0===s?void 0:s.map(((e,l)=>{var a;return(0,C.jsx)(o.A,{span:24/S,children:u?(0,C.jsxs)("div",{children:[(0,C.jsxs)(j.A.Text,{strong:!0,children:[e.label," ",(null===(a=e.rules)||void 0===a?void 0:a.some((e=>e.required)))&&(0,C.jsx)(j.A.Text,{type:"danger",children:"*"})]}),(0,C.jsx)(g.A.Item,{name:e.name,rules:e.rules,style:{marginTop:"8px"},children:e.component})]}):(0,C.jsx)(g.A.Item,{label:(0,C.jsx)(j.A.Text,{strong:!0,children:e.label}),name:e.name,rules:e.rules,labelCol:{span:y},wrapperCol:{span:v},children:e.component})},l)})),h&&(0,C.jsx)(g.A.List,{name:"nestedItems",children:(e,l)=>{let{add:a,remove:i}=l;return(0,C.jsxs)(C.Fragment,{children:[e.map((e=>{let{key:l,name:a,fieldKey:n}=e,s=(0,f.A)(e,k);return(0,C.jsxs)(r.A,{gutter:[16,16],align:"middle",children:[p.map(((e,l)=>(0,C.jsx)(o.A,{children:(0,C.jsx)(g.A.Item,(0,t.A)((0,t.A)({},s),{},{name:[a,e.name],fieldKey:[n,e.name],rules:[{required:!0,message:"Missing ".concat(e.label)}],label:e.label,children:e.component}))},l))),(0,C.jsx)(o.A,{children:(0,C.jsx)(_.A,{onClick:()=>i(a)})})]},l)})),(0,C.jsx)(r.A,{justify:"center",children:(0,C.jsx)(o.A,{children:(0,C.jsx)(m.Ay,{type:"primary",onClick:()=>a(),icon:(0,C.jsx)(w.A,{}),children:"Add More Field"})})})]})}})]}),(0,C.jsxs)(r.A,{justify:"end",gutter:[16,16],style:{padding:"16px"},children:[(0,C.jsx)(o.A,{children:(0,C.jsx)(m.Ay,{onClick:()=>{n?n():d&&d(!1),null===b||void 0===b||b.resetFields()},children:"Cancel"})}),(0,C.jsx)(o.A,{children:(0,C.jsx)(m.Ay,{type:"primary",htmlType:"submit",loading:A,children:"Submit"})})]})]})]})};var S=a(4413),M=a(54505),L=a(7866),I=a(12624),O=a(32513),T=a(96603);const{TextArea:N}=c.A,P=[{label:"Text",value:"text",category:"text"},{label:"Text Area",value:"textarea",category:"text"},{label:"Email",value:"email",category:"text"},{label:"Phone",value:"phone",category:"text"},{label:"URL",value:"url",category:"text"},{label:"Password",value:"password",category:"text"},{label:"Number (Integer)",value:"number",category:"number"},{label:"Decimal",value:"decimal",category:"number"},{label:"Boolean (Yes/No)",value:"boolean",category:"choice"},{label:"Checkbox",value:"checkbox",category:"choice"},{label:"Select (Dropdown)",value:"select",category:"choice"},{label:"Multi-Select",value:"multiselect",category:"choice"},{label:"Radio Buttons",value:"radio",category:"choice"},{label:"Date",value:"date",category:"date"},{label:"DateTime",value:"datetime",category:"date"}],D=e=>{const{field_name:l,label:a}=e,t=(e=>{const{label:l,is_required:a,validation_rules:t,field_type:i}=e,n=[];return a&&n.push({required:!0,message:"Please enter ".concat(l.toLowerCase())}),("email"===i||null!==t&&void 0!==t&&t.email)&&n.push({type:"email",message:"Please enter a valid email address"}),"url"===i&&n.push({type:"url",message:"Please enter a valid URL"}),void 0!==(null===t||void 0===t?void 0:t.min)&&n.push({type:"number",min:t.min,message:"Minimum value is ".concat(t.min)}),void 0!==(null===t||void 0===t?void 0:t.max)&&n.push({type:"number",max:t.max,message:"Maximum value is ".concat(t.max)}),null!==t&&void 0!==t&&t.pattern&&n.push({pattern:new RegExp(t.pattern),message:t.patternMessage||"Invalid format"}),n})(e),{component:i,valuePropName:n}=(e=>{const{field_type:l,label:a,placeholder:t,validation_rules:i}=e,n=t||"Enter ".concat(a.toLowerCase()),s=Array.isArray(null===i||void 0===i?void 0:i.options)?i.options:[];let r,o;switch(l.toLowerCase()){case"text":case"string":default:r=(0,C.jsx)(c.A,{placeholder:n});break;case"textarea":r=(0,C.jsx)(N,{rows:4,placeholder:n});break;case"email":r=(0,C.jsx)(c.A,{type:"email",placeholder:n});break;case"phone":case"tel":r=(0,C.jsx)(c.A,{type:"tel",placeholder:n});break;case"url":r=(0,C.jsx)(c.A,{type:"url",placeholder:n});break;case"password":r=(0,C.jsx)(c.A.Password,{placeholder:n});break;case"number":case"integer":r=(0,C.jsx)(L.A,{placeholder:n,style:{width:"100%"},min:null===i||void 0===i?void 0:i.min,max:null===i||void 0===i?void 0:i.max});break;case"decimal":case"float":r=(0,C.jsx)(L.A,{placeholder:n,style:{width:"100%"},min:null===i||void 0===i?void 0:i.min,max:null===i||void 0===i?void 0:i.max,step:.01,precision:2});break;case"boolean":case"switch":r=(0,C.jsx)(I.A,{checkedChildren:"Yes",unCheckedChildren:"No",defaultChecked:!1}),o="checked";break;case"checkbox":r=(0,C.jsx)(O.A,{children:a}),o="checked";break;case"select":case"dropdown":r=(0,C.jsx)(d.A,{placeholder:n,allowClear:!0,showSearch:!0,optionFilterProp:"children",options:s.map((e=>({label:e,value:e})))});break;case"multiselect":r=(0,C.jsx)(d.A,{mode:"multiple",placeholder:n,allowClear:!0,showSearch:!0,optionFilterProp:"children",options:s.map((e=>({label:e,value:e})))});break;case"radio":r=(0,C.jsx)(T.Ay.Group,{children:s.map((e=>(0,C.jsx)(T.Ay,{value:e,children:e},e)))});break;case"date":r=(0,C.jsx)(u.A,{style:{width:"100%"},format:"YYYY-MM-DD",placeholder:n});break;case"datetime":r=(0,C.jsx)(u.A,{showTime:!0,style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss",placeholder:n})}return{component:r,valuePropName:o}})(e),s={label:a,name:l,rules:t,component:i};return n&&(s.valuePropName=n),s};var E=a(62751),Y=a(6051),V=a(42261),q=a(14524),B=a(8354);const{TextArea:z}=c.A,U=i.memo((e=>{let{form:l,editingField:a,optionsText:t,onOptionsChange:n}=e;const s=g.A.useWatch("field_type",l),u=(0,i.useMemo)((()=>["select","multiselect","radio"].includes(s)),[s]),m=(0,i.useMemo)((()=>["number","integer","decimal"].includes(s)),[s]);return(0,C.jsxs)(g.A,{form:l,layout:"vertical",initialValues:{is_required:!1,is_active:!0,is_global:!1,display_order:0},children:[(0,C.jsxs)(r.A,{gutter:16,children:[(0,C.jsx)(o.A,{span:12,children:(0,C.jsx)(g.A.Item,{label:"Entity Name",name:"entity_name",rules:[{required:!0,message:"Please enter entity name"}],children:(0,C.jsx)(c.A,{disabled:!!a,placeholder:"e.g., products, customers"})})}),(0,C.jsx)(o.A,{span:12,children:(0,C.jsx)(g.A.Item,{label:"Field Name",name:"field_name",rules:[{required:!0,message:"Please enter field name"},{pattern:/^[a-z_][a-z0-9_]*$/i,message:"Must start with a letter, only letters, numbers, underscores"}],extra:"Use lowercase with underscores (e.g., custom_field_1)",children:(0,C.jsx)(c.A,{placeholder:"e.g., custom_field_1",disabled:!!a})})})]}),(0,C.jsxs)(r.A,{gutter:16,children:[(0,C.jsx)(o.A,{span:12,children:(0,C.jsx)(g.A.Item,{label:"Field Type",name:"field_type",rules:[{required:!0,message:"Please select field type"}],children:(0,C.jsx)(d.A,{placeholder:"Select field type",options:P})})}),(0,C.jsx)(o.A,{span:12,children:(0,C.jsx)(g.A.Item,{label:"Label",name:"label",rules:[{required:!0,message:"Please enter label"}],children:(0,C.jsx)(c.A,{placeholder:"Field label shown to users"})})})]}),(0,C.jsx)(g.A.Item,{label:"Placeholder",name:"placeholder",children:(0,C.jsx)(c.A,{placeholder:"Placeholder text (optional)"})}),u&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(B.A,{children:"Options Configuration"}),(0,C.jsx)(g.A.Item,{label:"Options (one per line)",extra:"Enter each option on a new line",required:!0,children:(0,C.jsx)(z,{rows:4,value:t,onChange:e=>n(e.target.value),placeholder:"Option 1\nOption 2\nOption 3"})})]}),m&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(B.A,{children:"Number Validation"}),(0,C.jsxs)(r.A,{gutter:16,children:[(0,C.jsx)(o.A,{span:12,children:(0,C.jsx)(g.A.Item,{label:"Min Value",name:"min",children:(0,C.jsx)(L.A,{placeholder:"Min",style:{width:"100%"}})})}),(0,C.jsx)(o.A,{span:12,children:(0,C.jsx)(g.A.Item,{label:"Max Value",name:"max",children:(0,C.jsx)(L.A,{placeholder:"Max",style:{width:"100%"}})})})]})]}),(0,C.jsx)(B.A,{children:"Display Settings"}),(0,C.jsxs)(r.A,{gutter:16,children:[(0,C.jsx)(o.A,{span:12,children:(0,C.jsx)(g.A.Item,{label:"Display Order",name:"display_order",extra:"Lower numbers appear first",children:(0,C.jsx)(L.A,{min:0,style:{width:"100%"}})})}),(0,C.jsx)(o.A,{span:12,children:(0,C.jsx)(g.A.Item,{label:"Business Type",name:"business_type",children:(0,C.jsx)(c.A,{placeholder:"Business type (optional)"})})})]}),(0,C.jsxs)(r.A,{gutter:16,children:[(0,C.jsx)(o.A,{span:8,children:(0,C.jsx)(g.A.Item,{label:"Required Field",name:"is_required",valuePropName:"checked",children:(0,C.jsx)(I.A,{})})}),(0,C.jsx)(o.A,{span:8,children:(0,C.jsx)(g.A.Item,{label:"Active",name:"is_active",valuePropName:"checked",children:(0,C.jsx)(I.A,{defaultChecked:!0})})}),(0,C.jsx)(o.A,{span:8,children:(0,C.jsx)(g.A.Item,{label:"Global Field",name:"is_global",valuePropName:"checked",children:(0,C.jsx)(I.A,{})})})]})]})}));U.displayName="FieldForm";const R=U;var Q=a(76399),G=a(39249);const K=e=>{let{data:l,loading:a,deleteLoading:t,onEdit:n,onDelete:r}=e;const o=(0,i.useMemo)((()=>[{title:"Label",dataIndex:"label",key:"label",sorter:(e,l)=>e.label.localeCompare(l.label)},{title:"Field Name",dataIndex:"field_name",key:"field_name",render:e=>(0,C.jsx)(Q.A,{color:"blue",children:e})},{title:"Type",dataIndex:"field_type",key:"field_type",render:e=>(0,C.jsx)(Q.A,{color:"cyan",children:e}),filters:P.map((e=>({text:e.label,value:e.value}))),onFilter:(e,l)=>l.field_type===e},{title:"Required",dataIndex:"is_required",key:"is_required",render:e=>(0,C.jsx)(Q.A,{color:e?"red":"default",children:e?"Yes":"No"}),filters:[{text:"Required",value:!0},{text:"Optional",value:!1}],onFilter:(e,l)=>l.is_required===e},{title:"Active",dataIndex:"is_active",key:"is_active",render:e=>(0,C.jsx)(Q.A,{color:e?"green":"default",children:e?"Yes":"No"}),filters:[{text:"Active",value:!0},{text:"Inactive",value:!1}],onFilter:(e,l)=>l.is_active===e},{title:"Order",dataIndex:"display_order",key:"display_order",sorter:(e,l)=>e.display_order-l.display_order,width:80},{title:"Actions",key:"actions",width:120,fixed:"right",render:(e,l)=>(0,C.jsxs)(Y.A,{children:[(0,C.jsx)(m.Ay,{type:"link",size:"small",icon:(0,C.jsx)(h.A,{}),onClick:()=>n(l)}),(0,C.jsx)(s.A,{title:"Delete this field?",description:"This action cannot be undone.",onConfirm:()=>r(l._id),okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},children:(0,C.jsx)(m.Ay,{type:"link",size:"small",danger:!0,icon:(0,C.jsx)(p.A,{}),loading:t})})]})}]),[n,r,t]);return(0,C.jsx)(G.A,{dataSource:l,columns:o,loading:a,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0},size:"middle",scroll:{x:900}})},W=i.memo(K);var $=a(91449);const H=e=>{let{entityName:l,businessType:a,tenantId:n,organisationId:s,onFieldsUpdated:r,enabled:o=!0}=e;const d=(0,i.useMemo)((()=>({entity_name:l})),[l]),{data:c,isLoading:u,refetch:m}=v.lh.useGetFieldMetadataQuery(d,{skip:!o}),[h,{isLoading:p}]=v.lh.useCreateFieldMetadataMutation(),[g,{isLoading:y}]=v.lh.useUpdateFieldMetadataMutation(),[x,{isLoading:A}]=v.lh.useDeleteFieldMetadataMutation(),b=(0,i.useCallback)((()=>{m()}),[m]),f=(0,i.useCallback)((async(e,l,i)=>{const o={},d=e.field_type;if(["select","multiselect","radio"].includes(d)){const e=l.split("\n").map((e=>e.trim())).filter((e=>e.length>0));if(0===e.length)return void(0,$.P0)("error","Please provide at least one option");o.options=e}void 0!==e.min&&null!==e.min&&(o.min=e.min),void 0!==e.max&&null!==e.max&&(o.max=e.max);const c={entity_name:e.entity_name,field_name:e.field_name,business_type:e.business_type||a,field_type:e.field_type,label:e.label,placeholder:e.placeholder,is_required:e.is_required||!1,validation_rules:o,display_order:e.display_order||0,is_active:!1!==e.is_active,is_global:e.is_global||!1};n&&(c.tenant_id=n),s&&(c.organisation_id=s);const u=(e=>{var l,a,t,i;const n=[];if(null!==(l=e.entity_name)&&void 0!==l&&l.trim()||n.push("Entity name is required"),null!==(a=e.field_name)&&void 0!==a&&a.trim()?/^[a-z_][a-z0-9_]*$/i.test(e.field_name)||n.push("Field name must start with a letter and contain only letters, numbers, and underscores"):n.push("Field name is required"),null!==(t=e.field_type)&&void 0!==t&&t.trim()||n.push("Field type is required"),null!==(i=e.label)&&void 0!==i&&i.trim()||n.push("Label is required"),["select","multiselect","radio"].includes(e.field_type||"")){var s;const l=null===(s=e.validation_rules)||void 0===s?void 0:s.options;l&&Array.isArray(l)&&0!==l.length||n.push("".concat(e.field_type," fields must have at least one option"))}if(["number","integer","decimal","float"].includes(e.field_type||"")&&e.validation_rules){const{min:l,max:a}=e.validation_rules;void 0!==l&&void 0!==a&&l>a&&n.push("Minimum value cannot be greater than maximum value")}return n})(c);if(u.length>0)(0,$.P0)("error",u[0]);else try{i?(await g((0,t.A)({id:i._id},c)).unwrap(),(0,$.P0)("success","Field updated successfully")):(await h(c).unwrap(),(0,$.P0)("success","Field created successfully")),m(),r&&r()}catch(v){var p;(0,$.P0)("error",(null===v||void 0===v||null===(p=v.data)||void 0===p?void 0:p.message)||"Failed to ".concat(i?"update":"create"," field"))}}),[a,n,s,h,g,m,r]),j=(0,i.useCallback)((async e=>{try{await x(e).unwrap(),(0,$.P0)("success","Field deleted successfully"),m(),r&&r()}catch(a){var l;(0,$.P0)("error",(null===a||void 0===a||null===(l=a.data)||void 0===l?void 0:l.message)||"Failed to delete field")}}),[x,m,r]);return{fieldsData:(0,i.useMemo)((()=>{const e=(null===c||void 0===c?void 0:c.result)||c||[];return Array.isArray(e)?e:[]}),[c]),fieldsLoading:u,createLoading:p,updateLoading:y,deleteLoading:A,fetchFields:b,handleSubmitField:f,handleDeleteField:j}},Z=e=>{let{entityName:l,businessType:a="",tenantId:n,organisationId:s,onFieldsUpdated:r}=e;const[o]=g.A.useForm(),[d,c]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!1),[p,v]=(0,i.useState)(null),[y,x]=(0,i.useState)(""),[A,b]=(0,i.useState)(!1),{fieldsData:f,fieldsLoading:j,createLoading:_,updateLoading:k,deleteLoading:F,fetchFields:S,handleSubmitField:M,handleDeleteField:L}=H({entityName:l,businessType:a,tenantId:n,organisationId:s,onFieldsUpdated:r,enabled:d}),I=(0,i.useCallback)((e=>{if(e){var i,n,s;v(e);const l=(null===(i=e.validation_rules)||void 0===i?void 0:i.options)||[];x(l.join("\n")),o.setFieldsValue((0,t.A)((0,t.A)({},e),{},{min:null===(n=e.validation_rules)||void 0===n?void 0:n.min,max:null===(s=e.validation_rules)||void 0===s?void 0:s.max}))}else v(null),x(""),o.resetFields(),o.setFieldsValue({entity_name:l,business_type:a,is_required:!1,is_active:!0,is_global:!1,display_order:(f.length||0)+1});h(!0)}),[o,l,a,f.length]),O=(0,i.useCallback)((async()=>{try{const e=await o.validateFields();await M(e,y,p),b(!0),h(!1),v(null),o.resetFields(),x("")}catch(e){console.error("Form validation failed:",e)}}),[o,y,p,M]),T=_||k,N=(0,i.useCallback)((()=>{c(!1),A&&r&&(r(),b(!1))}),[A,r]),P=(0,i.useCallback)((e=>{L(e),b(!0)}),[L]);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(m.Ay,{icon:(0,C.jsx)(q.A,{}),onClick:()=>c(!0),type:"default",children:"Manage Fields"}),(0,C.jsx)(E.A,{title:"Manage Fields - ".concat(l),open:d,onCancel:N,width:1e3,footer:[(0,C.jsx)(m.Ay,{onClick:N,children:"Close"},"close")],destroyOnClose:!0,children:(0,C.jsxs)(Y.A,{direction:"vertical",style:{width:"100%"},size:"large",children:[(0,C.jsx)(V.A,{message:"Dynamic Fields",description:"Add custom fields to this entity. These fields will be automatically added to the form.",type:"info",showIcon:!0}),(0,C.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,C.jsx)(m.Ay,{type:"primary",icon:(0,C.jsx)(w.A,{}),onClick:()=>I(),children:"Add New Field"})}),(0,C.jsx)(W,{data:f,loading:j,deleteLoading:F,onEdit:I,onDelete:P})]})}),(0,C.jsx)(E.A,{title:p?"Edit Field":"Add New Field",open:u,onOk:O,onCancel:()=>{h(!1),v(null),o.resetFields(),x("")},width:700,confirmLoading:T,destroyOnClose:!0,children:(0,C.jsx)(R,{form:o,editingField:p,optionsText:y,onOptionsChange:x})})]})},J=i.memo(Z);function X(e,l,a){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;return{title:"Actions",key:"actions",render:(o,d)=>{const c=!i||i(d),u=!r||r(d);return(0,C.jsxs)("div",{style:{display:"flex",gap:"16px",justifyContent:"center",alignItems:"center"},children:[(0,C.jsx)(n.A,{title:c?"Edit ".concat(e):"No permission to edit",children:(0,C.jsx)(h.A,{style:{cursor:c?"pointer":"not-allowed",color:c?"#1890ff":"#d9d9d9",opacity:c?1:.5,fontSize:"16px",padding:"4px"},onClick:()=>c&&l(d)})}),(0,C.jsx)(n.A,{title:u?"Delete ".concat(e):"No permission to delete",children:(0,C.jsx)(s.A,{title:"Delete ".concat(e),description:"Are you sure you want to delete this item?",onConfirm:()=>a(d),okText:"Yes",cancelText:"No",disabled:t||!u,children:(0,C.jsx)(p.A,{style:{cursor:t||!u?"not-allowed":"pointer",color:t||!u?"#d9d9d9":"#ff4d4f",opacity:t||!u?.5:1,fontSize:"16px",padding:"4px"}})})})]})}}}const ee=e=>{let{config:l,filters:s=[],onFilterChange:h,customButtons:p=[],onValuesChange:x,enableSuperAdminFilters:f=!0,enableDynamicFields:j=!1,showDynamicColumnsInTable:_=!1,entityName:w}=e;const k=(0,M.B)(),L=(0,i.useRef)(!0),I=(0,i.useRef)({}),{formItems:O,refresh:T,dynamicFields:N}=(e=>{let{entityName:l,staticFormItems:a,enabled:t=!0,businessType:n}=e;const s=(0,i.useMemo)((()=>{const e={entity_name:l,is_active:!0};return n&&(e.business_type=n),e}),[l,n]),{data:r,isLoading:o,refetch:d}=v.lh.useGetFieldMetadataQuery(s,{skip:!t}),c=(0,i.useMemo)((()=>{const e=(null===r||void 0===r?void 0:r.result)||r||[];return(Array.isArray(e)?e:[]).filter((e=>e.is_active)).sort(((e,l)=>e.display_order-l.display_order))}),[r]),u=(0,i.useMemo)((()=>c.map((e=>D(e)))),[c]);return{formItems:(0,i.useMemo)((()=>0===u.length?a:[...a,...u]),[a,u]),loading:o,refresh:d,dynamicFields:c,dynamicFormItems:u,staticFormItems:a}})({entityName:w||l.title.toLowerCase(),staticFormItems:l.formItems,enabled:j}),P=(0,i.useMemo)((()=>j&&N?N.map((e=>e.field_name)):[]),[N,j]),E=(0,i.useMemo)((()=>(0,t.A)((0,t.A)({},l),{},{dynamicFieldNames:P.length>0?P:void 0})),[l,P]),{loading:Y,createLoading:V,updateLoading:q,deleteLoading:B,items:z,pagination:U,drawerVisible:R,initialValues:Q,form:G,handleEdit:K,handleDelete:W,handleDrawerOpen:$,resetForm:H,handleSubmit:Z,handlePaginationChange:ee,columns:le,formItems:ae,formColumns:te=2,drawerWidth:ie,filterValues:ne,setFilterValues:se}=(e=>{const[l]=g.A.useForm(),[a,n]=(0,i.useState)(!1),[s,r]=(0,i.useState)({}),[o,d]=(0,i.useState)({}),[c,u]=(0,i.useState)({}),m=(0,i.useRef)(null),h=(0,i.useCallback)((e=>{m.current&&clearTimeout(m.current),m.current=setTimeout((()=>{u(e)}),300),d(e)}),[]);(0,i.useEffect)((()=>()=>{m.current&&clearTimeout(m.current)}),[]);const[p,x]=(0,i.useState)({current:1,pageSize:10});(0,i.useEffect)((()=>{x((e=>(0,t.A)((0,t.A)({},e),{},{current:1})))}),[c]);const b=(0,v.yo)(e.entityName),f=(0,i.useMemo)((()=>(0,t.A)({page:p.current,limit:p.pageSize},c)),[p,c]),{data:j,isLoading:_}=b.useGetQuery(f),[w,{isLoading:C}]=b.useCreateMutation(),[k,{isLoading:F}]=b.useUpdateMutation(),[S,{isLoading:M}]=b.useDeleteMutation(),L=(0,i.useMemo)((()=>(null===j||void 0===j?void 0:j.result)||[]),[null===j||void 0===j?void 0:j.result]),I=(0,i.useMemo)((()=>null===j||void 0===j?void 0:j.pagination),[null===j||void 0===j?void 0:j.pagination]),O=(0,i.useCallback)((async l=>{try{const a=await w(l).unwrap();if(null!==a&&void 0!==a&&a.statusCode&&200!==a.statusCode&&201!==a.statusCode){const l=(null===a||void 0===a?void 0:a.message)||"";(0,y.y)({action:"create",title:e.title,success:!1,errorMessage:l||"Something went wrong. Please try again."});const t=new Error(l||"Something went wrong");throw t.alreadyShown=!0,t}return(0,y.y)({action:"create",title:e.title,success:!0}),a}catch(t){if(null===t||void 0===t||!t.alreadyShown){var a;const l=(null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||(null===t||void 0===t?void 0:t.message)||"";(0,y.y)({action:"create",title:e.title,success:!1,errorMessage:l||"Something went wrong. Please try again."})}throw t}}),[w,e.title]),T=(0,i.useCallback)((async(l,a)=>{try{const t=await k({id:l,data:a}).unwrap();if(null!==t&&void 0!==t&&t.statusCode&&200!==t.statusCode){const l=(null===t||void 0===t?void 0:t.message)||"";(0,y.y)({action:"update",title:e.title,success:!1,errorMessage:l||"Something went wrong. Please try again."});const a=new Error(l||"Something went wrong");throw a.alreadyShown=!0,a}return(0,y.y)({action:"update",title:e.title,success:!0}),t}catch(i){if(null===i||void 0===i||!i.alreadyShown){var t;const l=(null===i||void 0===i||null===(t=i.data)||void 0===t?void 0:t.message)||(null===i||void 0===i?void 0:i.message)||"";(0,y.y)({action:"update",title:e.title,success:!1,errorMessage:l||"Something went wrong. Please try again."})}throw i}}),[k,e.title]),N=(0,i.useCallback)((async l=>{try{const a=await S(l).unwrap();if(null!==a&&void 0!==a&&a.statusCode&&200!==a.statusCode){const l=(null===a||void 0===a?void 0:a.message)||"";(0,y.y)({action:"delete",title:e.title,success:!1,errorMessage:l||"Something went wrong. Please try again."});const t=new Error(l||"Something went wrong");throw t.alreadyShown=!0,t}return(0,y.y)({action:"delete",title:e.title,success:!0}),a}catch(t){if(null===t||void 0===t||!t.alreadyShown){var a;const l=(null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||(null===t||void 0===t?void 0:t.message)||"";(0,y.y)({action:"delete",title:e.title,success:!1,errorMessage:l||"Something went wrong. Please try again."})}throw t}}),[S,e.title]),P=(0,i.useCallback)(((e,l)=>{x({current:e,pageSize:l})}),[]),D=(0,i.useMemo)((()=>/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})?)?$/),[]),E=(0,i.useCallback)((e=>D.test(e)),[D]),Y=(0,i.useCallback)((e=>{if("string"===typeof e&&E(e)){const l=A()(e,void 0,!0);return l.isValid()?l:e}return e}),[E]),V=(0,i.useCallback)((l=>{const a={},t=e.metadataFieldName||"meta_data_values";Object.entries(l).forEach((e=>{let[l,i]=e;l!==t&&"meta_data_values"!==l&&"custom_data"!==l&&(a[l]=Y(i))}));const i=l[t];i&&"object"===typeof i&&null!==i&&Object.entries(i).forEach((e=>{let[l,t]=e;null!==t&&void 0!==t&&(a[l]=Y(t))})),r(a),n(!0)}),[e.metadataFieldName,Y]),q=(0,i.useCallback)((e=>{N(e._id)}),[N]),B=(0,i.useCallback)((()=>{n(!0)}),[]),z=(0,i.useCallback)((()=>{n(!1),r({}),l.resetFields()}),[l]),U=(0,i.useCallback)((l=>{if(!e.dynamicFieldNames||0===e.dynamicFieldNames.length){const e={};return Object.entries(l).forEach((l=>{var a,t;let[i,n]=l;const s=null===(a=(t=A()).isDayjs)||void 0===a?void 0:a.call(t,n);e[i]=s?n.format("YYYY-MM-DD"):n})),e}const a={},i={},n=e.metadataFieldName||"meta_data_values";return Object.entries(l).forEach((l=>{var t;let[n,s]=l;if(null!==(t=e.dynamicFieldNames)&&void 0!==t&&t.includes(n)){if(void 0!==s){var r,o;const e=null===(r=(o=A()).isDayjs)||void 0===r?void 0:r.call(o,s);i[n]=e?s.format("YYYY-MM-DD"):s}}else{var d,c;const e=null===(d=(c=A()).isDayjs)||void 0===d?void 0:d.call(c,s);a[n]=e?s.format("YYYY-MM-DD"):s}})),Object.keys(i).length>0?(0,t.A)((0,t.A)({},a),{},{[n]:i}):a}),[e.dynamicFieldNames,e.metadataFieldName]),R=(0,i.useCallback)((async e=>{const l=U(e);try{s._id?await T(s._id,l):await O(l),z()}catch(a){console.error("Submit error:",a)}}),[s._id,O,T,z,U]);return(0,t.A)({loading:_,createLoading:C,updateLoading:F,deleteLoading:M,items:L,pagination:I,drawerVisible:a,initialValues:s,form:l,filterValues:o,setFilterValues:h,handleEdit:V,handleDelete:q,handleDrawerOpen:B,resetForm:z,handleSubmit:R,handlePaginationChange:P},e)})(E),re=j?O:ae,oe=(0,i.useMemo)((()=>{if(!_||!j||!N||0===N.length)return le;const{generateColumnsFromMetadata:e}=a(88725),l=le.length<=3&&le.every((e=>["_id","createdAt","updatedAt"].includes(e.key)));if(l){const l=N.map((e=>e.field_name));return e(N,l)}{const l=N.map((e=>e.field_name)),a=e(N,l),t=le.map((e=>e.key)),i=a.filter((e=>!t.includes(e.key)));return[...le,...i]}}),[le,_,j,N]),de=(0,i.useMemo)((()=>f?k.getApiFilters():{}),[f,k.isSuperAdmin,k.isTenant,k.isOrganisationUser,k.selectedTenant,k.selectedOrganisation,k.selectedBranch]),ce=(0,i.useCallback)(((e,l)=>{const a=(0,t.A)((0,t.A)({},ne),{},{[e]:l}),i=f?(0,t.A)((0,t.A)({},a),de):a;se(i),h&&h(i)}),[ne,se,h,f,de]);(0,i.useEffect)((()=>{if(L.current)return L.current=!1,void(I.current=de);if(!f)return;const e=(0,t.A)({},ne);let l=!1;Object.keys(I.current).forEach((a=>{!(a in de)&&a in e&&(delete e[a],l=!0)})),Object.entries(de).forEach((a=>{let[t,i]=a;e[t]!==i&&(e[t]=i,l=!0)})),I.current=de,l&&!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=Object.keys(e),t=Object.keys(l);if(a.length!==t.length)return!1;for(const i of a)if(e[i]!==l[i])return!1;return!0}(ne,e)&&se(e)}),[de,ne,se,f]);const ue=(0,i.useMemo)((()=>[...oe,X(l.title,K,W,B,l.canEdit,l.canDelete)]),[oe,l.title,K,W,B,l.canEdit,l.canDelete]);return(0,C.jsxs)("div",{children:[(0,C.jsxs)(r.A,{justify:"end",align:"bottom",gutter:[16,16],style:{marginBottom:16},children:[(0,C.jsx)(o.A,{flex:"auto",children:(0,C.jsx)("h1",{style:{margin:0},children:l.title})}),(0,C.jsx)(o.A,{children:(0,C.jsxs)(r.A,{gutter:[12,12],align:"bottom",justify:"end",wrap:!0,children:[f&&k.isSuperAdmin&&(0,C.jsx)(o.A,{children:(0,C.jsxs)(d.A,{placeholder:"Select Tenant",value:k.selectedTenant,onChange:e=>{k.handleTenantChange(e),ce("tenant_id","all"===e?void 0:e)},allowClear:!0,style:{width:200},loading:k.tenantsLoading,disabled:V||q||B,children:[(0,C.jsx)(d.A.Option,{value:"all",children:"All Tenants"}),k.tenantOptions.map((e=>(0,C.jsx)(d.A.Option,{value:e.value,children:e.label},e.value)))]})}),f&&(k.isSuperAdmin||k.isTenant)&&!k.isOrganisationUser&&!k.isBranchUser&&(0,C.jsx)(o.A,{children:(0,C.jsxs)(d.A,{placeholder:k.isSuperAdmin&&"all"===k.selectedTenant?"Select tenant first":"Select Organisation",value:k.selectedOrganisation,onChange:e=>{k.handleOrganisationChange(e),ce("organisation_id","all"===e?void 0:e)},allowClear:!0,style:{width:200},loading:k.organisationsLoading,disabled:k.isSuperAdmin&&"all"===k.selectedTenant||V||q||B,children:[(0,C.jsx)(d.A.Option,{value:"all",children:"All Organisations"}),k.organisationOptions.map((e=>(0,C.jsx)(d.A.Option,{value:e.value,children:e.label},e.value)))]})}),f&&(k.isSuperAdmin||k.isTenant||k.isOrganisationUser)&&!k.isBranchUser&&(0,C.jsx)(o.A,{children:(0,C.jsxs)(d.A,{placeholder:(k.isSuperAdmin||k.isTenant)&&"all"===k.selectedOrganisation?"Select organisation first":"Select Branch",value:k.selectedBranch,onChange:e=>{k.handleBranchChange(e),ce("branch_id","all"===e?void 0:e)},allowClear:!0,style:{width:200},loading:k.branchesLoading,disabled:(k.isSuperAdmin||k.isTenant)&&"all"===k.selectedOrganisation||V||q||B,children:[(0,C.jsx)(d.A.Option,{value:"all",children:"All Branches"}),k.branchOptions.map((e=>(0,C.jsx)(d.A.Option,{value:e.value,children:e.label},e.value)))]})}),s.map((e=>{var l;return(0,C.jsxs)(o.A,{children:["input"===e.type&&(0,C.jsx)(c.A,{placeholder:e.placeholder||e.label,value:ne[e.key]||"",onChange:l=>ce(e.key,l.target.value),style:{width:e.width||200},disabled:V||q||B}),"select"===e.type&&(0,C.jsx)(d.A,{placeholder:e.placeholder||e.label,value:ne[e.key],onChange:l=>{ce(e.key,l),e.onChange&&e.onChange(l)},allowClear:!0,style:{width:e.width||200},disabled:e.disabled||V||q||B,children:null===(l=e.options)||void 0===l?void 0:l.map((e=>(0,C.jsx)(d.A.Option,{value:e.value,children:e.label},e.value)))}),"date"===e.type&&(0,C.jsx)(u.A,{placeholder:e.placeholder||e.label,value:ne[e.key],onChange:l=>ce(e.key,l),style:{width:e.width||200},disabled:V||q||B})]},e.key)})),(0,C.jsx)(o.A,{children:(0,C.jsx)(c.A,{placeholder:"Search ".concat(l.title),value:ne.searchString||"",onChange:e=>ce("searchString",e.target.value),style:{width:200},disabled:V||q||B})}),p.map((e=>(0,C.jsx)(o.A,{children:(0,C.jsx)(m.Ay,{type:e.type||"default",onClick:e.onClick,icon:e.icon,disabled:V||q||B,children:e.label})},e.key))),j&&(0,C.jsx)(o.A,{children:(0,C.jsx)(J,{entityName:w||l.title.toLowerCase(),onFieldsUpdated:T})}),(()=>{const e=!l.canCreate||l.canCreate();return e?(0,C.jsx)(o.A,{children:(0,C.jsx)(n.A,{title:e?"":"No permission to create",children:(0,C.jsxs)(m.Ay,{type:"primary",onClick:$,loading:V,disabled:V||!e,children:["Add ",l.title]})})}):null})()]})})]}),(0,C.jsx)(S.A,{columns:ue,data:z,loading:Y||B,rowKeyField:"_id",totalCount:(null===U||void 0===U?void 0:U.totalCount)||(null===U||void 0===U?void 0:U.total)||0,pageLimit:(null===U||void 0===U?void 0:U.pageSize)||10,onPaginationChange:ee}),(0,C.jsx)(b.A,{title:"".concat(Q._id?"Edit":"Add"," ").concat(l.title),open:R,onClose:V||q?()=>{}:H,width:ie,children:(0,C.jsx)(F,{form:G,formItems:re,formColumns:te,initialValues:Q,onSubmit:Z,onCancel:H,onValuesChange:(e,l)=>{x&&x(e,l,G)},loading:V||q})})]})},le=i.memo(ee)},88725:(e,l,a)=>{a.r(l),a.d(l,{generateColumnsFromMetadata:()=>n,getAvailableColumns:()=>s,getDefaultVisibleColumns:()=>r});a(65043);var t=a(76399),i=a(70579);const n=function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e&&0!==e.length?e.filter((e=>l.includes(e.field_name))).map((e=>({title:e.label,dataIndex:["custom_data",e.field_name],key:e.field_name,render:(l,a)=>{var n;const s=null===a||void 0===a||null===(n=a.custom_data)||void 0===n?void 0:n[e.field_name];if(null===s||void 0===s||""===s)return(0,i.jsx)("span",{style:{color:"#999"},children:"-"});switch(e.field_type){case"select":case"radio":return(0,i.jsx)(t.A,{color:"blue",children:String(s)});case"checkbox":return(0,i.jsx)(t.A,{color:s?"green":"red",children:s?"Yes":"No"});case"date":try{const e=new Date(s);return(0,i.jsx)("span",{style:{fontSize:"13px",color:"#666"},children:e.toLocaleDateString()})}catch(r){return(0,i.jsx)("span",{children:String(s)})}case"number":case"currency":return(0,i.jsx)("span",{style:{fontFamily:"monospace",fontWeight:500,color:"currency"===e.field_type?"#52c41a":"#1890ff"},children:"currency"===e.field_type?"$".concat(Number(s).toFixed(2)):Number(s).toLocaleString()});default:const l=String(s);return l.length>50?(0,i.jsxs)("span",{title:l,children:[l.substring(0,50),"..."]}):(0,i.jsx)("span",{children:l})}}}))):[]},s=e=>e.map((e=>({key:e.field_name,label:e.label,fieldType:e.field_type}))),r=e=>e.slice(0,5).map((e=>e.field_name))},91449:(e,l,a)=>{a.d(l,{P0:()=>n});var t=a(16569),i=a(94265);const n=(e,l)=>{"success"===e?t.Ay.success(l):"error"===e&&t.Ay.error(l)};(e=>{const l=(e=>l=>{var a;const t=null===i.QQ||void 0===i.QQ||null===(a=i.QQ[e])||void 0===a?void 0:a[l];if(!t)throw new Error("API route for ".concat(String(e),".").concat(String(l)," is not defined."));return t})(e)})("Unit")}}]);
//# sourceMappingURL=146.f757bafd.chunk.js.map