"use strict";(self.webpackChunkSUBRIVA_BILLING=self.webpackChunkSUBRIVA_BILLING||[]).push([[12],{26016:(e,t,l)=>{l.d(t,{y:()=>n});var i=l(91449);const n=e=>{let{action:t,success:l,title:n,getAllItems:o,resetForm:a,errorMessage:r}=e;l?((0,i.P0)("success","".concat(n," ").concat(t,"d successfully")),null===o||void 0===o||o(),null===a||void 0===a||a()):(0,i.P0)("error",r||"Failed to ".concat(t," ").concat(n))}},39177:(e,t,l)=>{l.d(t,{V:()=>r});var i=l(65043),n=l(98350),o=l(89472),a=l(12279);const r=()=>{var e;const t=(0,i.useMemo)((()=>(0,o.HW)()),[]),l=(null===t||void 0===t?void 0:t.organisation_id)||(null===t||void 0===t||null===(e=t.organisationItems)||void 0===e?void 0:e._id),{data:r,isLoading:s}=n.lh.useGetSettingsQuery({organisation_id:l,page:1,limit:1},{skip:!l,refetchOnMountOrArgChange:!1}),d=(0,i.useMemo)((()=>{const e=(null===r||void 0===r?void 0:r.result)||r||{};return Array.isArray(e)?e[0]:e}),[r]),c=(null===d||void 0===d?void 0:d.bill_template)||"classic",u=(null===d||void 0===d?void 0:d.invoice_template)||"classic";return{BillTemplateComponent:(0,a.G6)(c),InvoiceTemplateComponent:(0,a.Qv)(u),billTemplateKey:c,invoiceTemplateKey:u,isLoading:s,settings:d}}},45007:(e,t,l)=>{l.r(t),l.d(t,{default:()=>vl});var i=l(89379),n=l(65043),o=l(71782),a=l(16569),r=l(95206),s=l(88143),d=l(36091),c=l(93310),u=l(94834),m=l(92003),p=l(62751),v=l(36621),x=l(7866),y=l(26553),g=l(93504),h=l(6051),f=l(39249),_=l(73847),b=l(9316),j=l(60446),C=l.n(j),k=l(47615),S=l(98350),A=l(35708),w=l(70579);const{Search:D}=v.A,I=e=>{let{visible:t,products:l,onSelect:i,onCancel:o}=e;const[s,d]=(0,n.useState)(""),[c,u]=(0,n.useState)(""),[m,v]=(0,n.useState)(1),[x,y]=(0,n.useState)([]),[g,_]=(0,n.useState)(!0),[b,j]=(0,n.useState)(null),[C,I]=(0,n.useState)(0),[T,P]=(0,n.useState)(!1),N=(0,n.useRef)(null),B=(0,n.useRef)(null),R=(0,n.useRef)(!1),E=!l||0===l.length,{data:F,isLoading:L}=S.lh.useGetProductQuery({searchString:c,page:m,limit:10},{skip:!t||!E,refetchOnMountOrArgChange:!0});(0,n.useEffect)((()=>{if(t&&E&&F){var e,l;const t=(null===F||void 0===F?void 0:F.result)||[],i=(null===(e=F.pagination)||void 0===e?void 0:e.totalCount)||(null===(l=F.pagination)||void 0===l?void 0:l.total)||0;1===m?(y(t),_(t.length<i&&t.length>0)):y((e=>{const l=new Set(e.map((e=>e._id))),n=t.filter((e=>!l.has(e._id))),o=[...e,...n];return _(o.length<i&&n.length>0),o})),R.current=!1}}),[F,m,E,t]);const M=l||x,z=(null===M||void 0===M?void 0:M.filter((e=>{var t,l,i,n,o,a,r;if(!s)return!0;const d=s.toLowerCase();return((null===(t=e.name)||void 0===t?void 0:t.toLowerCase())||"").includes(d)||((null===(l=e.sku)||void 0===l?void 0:l.toLowerCase())||"").includes(d)||(null===(i=e.VariantItem)||void 0===i||null===(n=i.variant_name)||void 0===n?void 0:n.toLowerCase().includes(d))||(null===(o=e.VariantItem)||void 0===o||null===(a=o.variant_code)||void 0===a?void 0:a.toLowerCase().includes(d))||((null===(r=e.selling_price)||void 0===r?void 0:r.toString())||"").includes(d)})).sort(((e,t)=>{var l,i,n,o,a,r,d,c,u,m,p,v,x,y,g,h;const f=s.toLowerCase(),_=((null===(l=e.name)||void 0===l?void 0:l.toLowerCase())||"")===f||(null===(i=e.VariantItem)||void 0===i||null===(n=i.variant_name)||void 0===n?void 0:n.toLowerCase())===f||((null===(o=e.sku)||void 0===o?void 0:o.toLowerCase())||"")===f,b=((null===(a=t.name)||void 0===a?void 0:a.toLowerCase())||"")===f||(null===(r=t.VariantItem)||void 0===r||null===(d=r.variant_name)||void 0===d?void 0:d.toLowerCase())===f||((null===(c=t.sku)||void 0===c?void 0:c.toLowerCase())||"")===f;if(_&&!b)return-1;if(!_&&b)return 1;const j=((null===(u=e.name)||void 0===u?void 0:u.toLowerCase())||"").startsWith(f)||(null===(m=e.VariantItem)||void 0===m||null===(p=m.variant_name)||void 0===p?void 0:p.toLowerCase().startsWith(f))||((null===(v=e.sku)||void 0===v?void 0:v.toLowerCase())||"").startsWith(f),C=((null===(x=t.name)||void 0===x?void 0:x.toLowerCase())||"").startsWith(f)||(null===(y=t.VariantItem)||void 0===y||null===(g=y.variant_name)||void 0===g?void 0:g.toLowerCase().startsWith(f))||((null===(h=t.sku)||void 0===h?void 0:h.toLowerCase())||"").startsWith(f);return j&&!C?-1:!j&&C?1:0})))||[];(0,n.useEffect)((()=>{if(E&&t&&s!==c)return B.current&&clearTimeout(B.current),B.current=setTimeout((()=>{u(s),v(1),y([]),_(!0),R.current=!1}),300),()=>{B.current&&clearTimeout(B.current)}}),[s,c,E,t]),(0,n.useEffect)((()=>{I(0),z.length>0?j(z[0]._id):j(null)}),[s,z.length]),(0,n.useEffect)((()=>{t?(setTimeout((()=>{var e;null===(e=N.current)||void 0===e||e.focus()}),100),E&&(v(1),_(!0),R.current=!1)):(d(""),E&&(u(""),v(1),y([]),_(!0),R.current=!1))}),[t]);const G=[{title:"Product & Variant",dataIndex:"name",key:"name",width:250,render:(e,t)=>{var l,i;return(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{style:{fontWeight:600,color:"#1890ff"},children:e}),(null===(l=t.VariantItem)||void 0===l?void 0:l.variant_name)&&(0,w.jsxs)("div",{style:{fontSize:"12px",color:"#52c41a",marginTop:"2px"},children:["Variant: ",t.VariantItem.variant_name,(null===(i=t.VariantItem)||void 0===i?void 0:i.variant_code)&&(0,w.jsxs)("span",{style:{marginLeft:"8px",color:"#fa8c16",fontSize:"11px"},children:["(",t.VariantItem.variant_code,")"]})]})]})}},{title:"Variant",dataIndex:"VariantItem",key:"variant",width:120,render:e=>null!==e&&void 0!==e&&e.variant_name?(0,w.jsx)("span",{style:{color:"#52c41a",fontWeight:500},children:e.variant_name}):(0,w.jsx)("span",{style:{color:"#bfbfbf",fontStyle:"italic"},children:"No variant"})},{title:"SKU",dataIndex:"sku",key:"sku",width:120},{title:"Price",dataIndex:"selling_price",key:"selling_price",width:100,render:e=>(0,w.jsxs)("span",{style:{color:"#52c41a",fontWeight:600,fontSize:"14px"},children:["\u20b9",(null===e||void 0===e?void 0:e.toFixed(2))||"0.00"]})}],q=e=>{i(e)};return(0,w.jsxs)(p.A,{title:"Select Product & Variant (F5 to reopen anytime)",open:t,onCancel:o,width:900,footer:null,destroyOnClose:!0,children:[(0,w.jsxs)("div",{onClick:()=>{var e;null===(e=N.current)||void 0===e||e.focus()},children:[(0,w.jsxs)(h.A.Compact,{style:{marginBottom:16,width:"100%"},children:[(0,w.jsx)(D,{ref:N,placeholder:"Search by product name, variant, SKU, or price (use \u2191\u2193 arrows to navigate, Enter to select)",onChange:e=>d(e.target.value),style:{flex:1},autoFocus:!0,onKeyDown:e=>{var t;if(z.length)if("ArrowDown"===e.key)e.preventDefault(),I((e=>{const t=Math.min(e+1,z.length-1);return j(z[t]._id),t})),null===(t=N.current)||void 0===t||t.focus();else if("ArrowUp"===e.key){var l;e.preventDefault(),I((e=>{const t=Math.max(e-1,0);return j(z[t]._id),t})),null===(l=N.current)||void 0===l||l.focus()}else if("Enter"===e.key){e.preventDefault();const t=z[C];t&&q(t)}else"Escape"===e.key&&(e.preventDefault(),o())},onBlur:()=>{setTimeout((()=>{var e;t&&(null===(e=N.current)||void 0===e||e.focus())}),10)},value:s}),(0,w.jsx)(r.Ay,{type:"primary",icon:(0,w.jsx)(k.A,{}),onClick:()=>P(!0),style:{minWidth:100},children:"Scan"})]}),E?(0,w.jsxs)("div",{onScroll:e=>{const t=e.currentTarget,l=t.scrollTop,i=t.scrollHeight;(l+t.clientHeight)/i>.7&&g&&!L&&!R.current&&(R.current=!0,v((e=>e+1)))},style:{maxHeight:360,overflowY:"auto"},children:[(0,w.jsx)(f.A,{dataSource:z,columns:G,loading:L&&0===z.length,rowKey:"_id",size:"small",pagination:!1,onRow:(e,t)=>({onClick:()=>{q(e),setTimeout((()=>{var e;null===(e=N.current)||void 0===e||e.focus()}),10)},onDoubleClick:()=>q(e),className:t===C?"ant-table-row ant-table-row-selected":"ant-table-row",style:{backgroundColor:t===C?"#e6f7ff":void 0,border:t===C?"2px solid #1890ff":void 0}}),rowSelection:{type:"radio",selectedRowKeys:b?[b]:[],onChange:e=>{j(e[0]);const t=z.findIndex((t=>t._id===e[0]));-1!==t&&I(t)}},scroll:{y:void 0}}),g&&z.length>0&&(0,w.jsx)("div",{style:{textAlign:"center",padding:"8px",color:"#999",borderTop:"1px solid #f0f0f0"},children:L?"Loading more...":"Scroll for more products"})]}):(0,w.jsx)(f.A,{dataSource:z,columns:G,loading:!1,rowKey:"_id",size:"small",pagination:!1,onRow:(e,t)=>({onClick:()=>{q(e),setTimeout((()=>{var e;null===(e=N.current)||void 0===e||e.focus()}),10)},onDoubleClick:()=>q(e),className:t===C?"ant-table-row ant-table-row-selected":"ant-table-row",style:{backgroundColor:t===C?"#e6f7ff":void 0,border:t===C?"2px solid #1890ff":void 0}}),rowSelection:{type:"radio",selectedRowKeys:b?[b]:[],onChange:e=>{j(e[0]);const t=z.findIndex((t=>t._id===e[0]));-1!==t&&I(t)}},scroll:{y:300}}),(0,w.jsxs)("div",{style:{marginTop:16,fontSize:"12px",color:"#666"},children:[(0,w.jsx)("strong",{children:"Keyboard Shortcuts:"})," \u2191\u2193 Navigate products | Enter Select | Escape Cancel",(0,w.jsx)("br",{}),(0,w.jsx)("strong",{children:"Search:"})," Product name, variant name, SKU, or price",(0,w.jsx)("br",{}),(0,w.jsx)("strong",{children:"Barcode Scanner:"}),' Click "Scan" button or use USB barcode scanner',(0,w.jsx)("br",{}),(0,w.jsx)("strong",{children:"Tip:"})," Press F5 anytime to reopen this modal for product changes"]})]}),(0,w.jsx)(A.A,{visible:T,onClose:()=>P(!1),onScan:e=>{d(e),P(!1);const t=null===M||void 0===M?void 0:M.find((t=>{var l,i,n,o;const a=e.toLowerCase();return((null===(l=t.sku)||void 0===l?void 0:l.toLowerCase())||"").includes(a)||((null===(i=t.name)||void 0===i?void 0:i.toLowerCase())||"").includes(a)||(null===(n=t.VariantItem)||void 0===n||null===(o=n.variant_code)||void 0===o?void 0:o.toLowerCase().includes(a))}));t?(setTimeout((()=>{i(t)}),500),a.Ay.success("Product found: ".concat(t.name))):a.Ay.warning("No product found with barcode: ".concat(e))},title:"Scan Product Barcode",description:"Scan barcode to find product automatically"})]})};var T=l(96651),P=l(76399),N=l(89472),B=l(66507),R=l(39470),E=l(46237);const{Search:F}=v.A,L=e=>{let{visible:t,onSelect:l,onCancel:i,productId:o}=e;const r=(0,N.HW)(),s=B.A.getItem("scope"),d=((null===s||void 0===s?void 0:s.userType)||(null===r||void 0===r?void 0:r.user_type)||(null===r||void 0===r?void 0:r.usertype)||(null===r||void 0===r?void 0:r.user_role)||"").toLowerCase(),c="organisationuser"===d,u="branchuser"===d,m=!!o&&!!t,{data:v,isLoading:x}=S.lh.useGetStockAuditQuery({product_id:o},{skip:!m||!c,refetchOnMountOrArgChange:!0,refetchOnFocus:!0,refetchOnReconnect:!0}),{data:y,isLoading:g}=S.lh.useGetBranchStockQuery({product_id:o},{skip:!m||!u,refetchOnMountOrArgChange:!0,refetchOnFocus:!0,refetchOnReconnect:!0}),h=(c?null===v||void 0===v?void 0:v.result:u?null===y||void 0===y?void 0:y.result:[])||[],_=x||g,[b,j]=(0,n.useState)(""),[k,A]=(0,n.useState)(null),[D,I]=(0,n.useState)(0),[L,M]=(0,n.useState)(""),z=(0,n.useRef)(null),G=(0,n.useRef)(null),q=e=>!(!e.expiry_date||!C()(e.expiry_date).isBefore(C()())),V=e=>e.available_quantity<=0,O=e=>{const t=C()(e.expiry_date).format("DD/MM/YYYY"),l="Cannot select expired stock! This item expired on ".concat(t,". Please select a valid stock item.");M(l),a.Ay.error(l),setTimeout((()=>{M("")}),5e3)},U=e=>{const t="Cannot select out of stock item! This item has 0 available quantity. Please select a stock item with available quantity.";M(t),a.Ay.error(t),setTimeout((()=>{M("")}),5e3)},Y=(Array.isArray(h)?h:[]).filter((e=>{var t,l,i,n,o,a,r,s;const d=b.toLowerCase();return(null===(t=e.batch_no)||void 0===t?void 0:t.toLowerCase().includes(d))||(null===(l=e.ProductItem)||void 0===l||null===(i=l.name)||void 0===i?void 0:i.toLowerCase().includes(d))||(null===(n=e.ProductItem)||void 0===n||null===(o=n.VariantItem)||void 0===o||null===(a=o.variant_name)||void 0===a?void 0:a.toLowerCase().includes(d))||(null===(r=e.available_quantity)||void 0===r?void 0:r.toString().includes(d))||(null===(s=e.sell_price)||void 0===s?void 0:s.toString().includes(d))}));(0,n.useEffect)((()=>{if(I(0),M(""),Y.length>0){let e=0;for(;e<Y.length&&(Y[e].expiry_date&&C()(Y[e].expiry_date).isBefore(C()())||Y[e].available_quantity<=0);)e++;e<Y.length?(A(Y[e]._id),I(e)):A(null)}else A(null)}),[b,t,h]),(0,n.useEffect)((()=>{t&&(M(""),setTimeout((()=>{var e;null===(e=G.current)||void 0===e||e.focus()}),0))}),[t]),(0,n.useEffect)((()=>{if(z.current){var e;const t=z.current.querySelector(".ant-table-row[data-row-key='".concat(null===(e=Y[D])||void 0===e?void 0:e._id,"']"));null===t||void 0===t||t.scrollIntoView({block:"nearest"})}}),[D,Y]);const K=[{title:"Product",dataIndex:"ProductItem",key:"product",render:e=>(null===e||void 0===e?void 0:e.name)||"N/A"},{title:"Variant",dataIndex:"ProductItem",key:"variant",render:e=>{var t;return(null===e||void 0===e||null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)||"N/A"}},{title:"Batch No",dataIndex:"batch_no",key:"batch_no"},{title:"Available",dataIndex:"available_quantity",key:"available_quantity",render:(e,t)=>{const l=e<=0;return(0,w.jsxs)("span",{style:{color:l?"#ff4d4f":"#52c41a",fontWeight:l?"bold":"normal"},children:[e,l&&(0,w.jsx)(R.A,{style:{marginLeft:4,color:"#ff4d4f"}})]})}},{title:"Price",dataIndex:"sell_price",key:"sell_price"},{title:"Expiry Date",dataIndex:"expiry_date",key:"expiry_date",render:(e,t)=>{if(!e)return(0,w.jsx)("span",{style:{color:"#999"},children:"No Expiry"});const l=C()(e),i=C()(),n=l.isBefore(i),o=l.diff(i,"days");let a="green",r=(0,w.jsx)(E.A,{}),s="Valid";return n?(a="red",r=(0,w.jsx)(R.A,{}),s="Expired"):o<=30&&(a="orange",r=(0,w.jsx)(R.A,{}),s="Expires in ".concat(o," days")),(0,w.jsx)(T.A,{title:s,children:(0,w.jsx)(P.A,{color:a,icon:r,children:l.format("DD/MM/YYYY")})})}}],H=e=>{var t;q(e)?O(e):V(e)?U():(M(""),l({id:e._id,_id:e._id,batch_no:e.batch_no,name:(null===(t=e.ProductItem)||void 0===t?void 0:t.name)||e.name||"",code:e.code,available_quantity:e.available_quantity,available_loose_quantity:e.available_loose_quantity,sell_price:e.sell_price,ProductItem:e.ProductItem}))};return(0,w.jsx)(p.A,{title:"Select Stock (F7 to reopen anytime)",open:t,onCancel:i,width:800,footer:null,destroyOnClose:!0,children:(0,w.jsxs)("div",{onClick:()=>{var e;null===(e=G.current)||void 0===e||e.focus()},children:[(0,w.jsx)(F,{ref:G,placeholder:"Search stocks (use \u2191\u2193 arrows to navigate, Enter to select)",onChange:e=>j(e.target.value),style:{marginBottom:16},autoFocus:!0,onKeyDown:e=>{var t;if(Y.length)if("ArrowDown"===e.key)e.preventDefault(),I((e=>{let t=e+1;for(;t<Y.length&&(Y[t].expiry_date&&C()(Y[t].expiry_date).isBefore(C()())||Y[t].available_quantity<=0);)t++;const l=Math.min(t,Y.length-1);return A(Y[l]._id),l})),null===(t=G.current)||void 0===t||t.focus();else if("ArrowUp"===e.key){var l;e.preventDefault(),I((e=>{let t=e-1;for(;t>=0&&(Y[t].expiry_date&&C()(Y[t].expiry_date).isBefore(C()())||Y[t].available_quantity<=0);)t--;const l=Math.max(t,0);return A(Y[l]._id),l})),null===(l=G.current)||void 0===l||l.focus()}else if("Enter"===e.key){e.preventDefault();const t=Y[D];t&&(H(t),q(t)||V(t)||i())}},onBlur:()=>{setTimeout((()=>{var e;t&&(null===(e=G.current)||void 0===e||e.focus())}),10)}}),L&&(0,w.jsxs)("div",{style:{marginBottom:16,padding:"12px 16px",backgroundColor:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#cf1322",fontSize:"14px",display:"flex",alignItems:"center",gap:"8px"},children:[(0,w.jsx)(R.A,{style:{color:"#cf1322"}}),L]}),(0,w.jsxs)("div",{onKeyDown:e=>{var t;if(Y.length)if("ArrowDown"===e.key)e.preventDefault(),I((e=>{let t=e+1;for(;t<Y.length&&(Y[t].expiry_date&&C()(Y[t].expiry_date).isBefore(C()())||Y[t].available_quantity<=0);)t++;const l=Math.min(t,Y.length-1);return A(Y[l]._id),l})),null===(t=G.current)||void 0===t||t.focus();else if("ArrowUp"===e.key)e.preventDefault(),I((e=>{let t=e-1;for(;t>=0&&(Y[t].expiry_date&&C()(Y[t].expiry_date).isBefore(C()())||Y[t].available_quantity<=0);)t--;const l=Math.max(t,0);return A(Y[l]._id),l}));else if("Enter"===e.key){e.preventDefault();const t=Y[D];t&&(H(t),q(t)||V(t)||i())}else if("Escape"===e.key){var l;e.preventDefault(),null===(l=G.current)||void 0===l||l.focus()}else if("Tab"===e.key&&e.shiftKey){var n;e.preventDefault(),null===(n=G.current)||void 0===n||n.focus()}},tabIndex:0,ref:z,style:{outline:"none"},children:[(0,w.jsx)(f.A,{dataSource:Y,columns:K,loading:_,rowKey:"_id",size:"small",pagination:!1,title:()=>(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0"},children:[(0,w.jsx)("span",{children:"Stock Items"}),(0,w.jsxs)("div",{style:{fontSize:"12px",color:"#666"},children:[(0,w.jsx)("span",{style:{color:"#52c41a"},children:"\ud83d\udfe2 Valid"}),(0,w.jsx)("span",{style:{margin:"0 8px",color:"#faad14"},children:"\ud83d\udfe0 Near Expiry"}),(0,w.jsx)("span",{style:{color:"#ff4d4f"},children:"\ud83d\udd34 Expired/Out of Stock (Disabled)"})]})]}),onRow:(e,t)=>{const l=q(e),i=V(e);return{onClick:()=>{l||i?l?O(e):i&&U():(H(e),setTimeout((()=>{var e;null===(e=G.current)||void 0===e||e.focus()}),10))},onDoubleClick:()=>{l||i?l?O(e):i&&U():H(e)},className:t===D?"ant-table-row ant-table-row-selected":"ant-table-row","data-row-key":e._id,style:{opacity:l||i?.6:1,cursor:l||i?"not-allowed":"pointer",backgroundColor:l||i?"#f5f5f5":void 0}}},rowSelection:{type:"radio",selectedRowKeys:k?[k]:[],onChange:e=>{A(e[0]);const t=Y.findIndex((t=>t._id===e[0]));-1!==t&&I(t)},getCheckboxProps:e=>({disabled:q(e)||V(e)})}}),(0,w.jsxs)("div",{style:{marginTop:16,fontSize:"12px",color:"#666"},children:[(0,w.jsx)("strong",{children:"Keyboard Shortcuts:"})," \u2191\u2193 Navigate stocks | Enter Select | Escape Cancel",(0,w.jsx)("br",{}),(0,w.jsx)("strong",{children:"Tip:"})," Press F7 anytime to reopen this modal for stock changes",(0,w.jsx)("br",{}),(0,w.jsx)("strong",{children:"Note:"})," Expired items (\ud83d\udd34) and out of stock items (\ud83d\udd34) are shown but cannot be selected. Navigation automatically skips expired and out of stock items.",(0,w.jsx)("br",{}),(0,w.jsx)("strong",{children:"Error Handling:"})," Attempting to select expired or out of stock items will show an error message and prevent selection."]})]})]})})},{Text:M}=o.A,z=e=>{let{columns:t,dataSource:l,onSave:o,onAdd:d,onDelete:c,allowAdd:u=!0,allowDelete:m=!0,rowKey:j="key",loading:k=!1,compact:S=!1,enableKeyboardNav:A=!0,size:D="middle",className:T,onProductSelect:P,externalEditingCell:N}=e;const[B,R]=(0,n.useState)([]),[E,F]=(0,n.useState)([]),[z,G]=(0,n.useState)(null),q=(0,n.useRef)(!0);(0,n.useEffect)((()=>{R(l);const e=t.findIndex((e=>"product_id"===e.dataIndex));q.current&&0===l.length&&e>=0?(G({row:0,col:e}),q.current=!1):F(l.length>0?[String(l.length-1)]:[])}),[l,t]),(0,n.useEffect)((()=>{N&&G(N)}),[N]);const V=()=>{null===d||void 0===d||d();const e=t.findIndex((e=>!1!==e.editable));e>=0&&G({row:B.length,col:e})},O=(e,l,i)=>{const n=t[l];if(n.required&&(!i||""===i))return a.Ay.error("".concat(n.title," is required")),!1;if(n.validation){const e=n.validation(i);if(e)return a.Ay.error(e),!1}const r=[...B];return r[e][t[l].dataIndex]=i,R(r),o(r),!0};(0,n.useEffect)((()=>{const e=e=>{e.ctrlKey&&"s"===e.key&&(e.preventDefault(),o(B)),e.shiftKey&&"a"===e.key.toLowerCase()&&u&&(e.preventDefault(),V())};if(A)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[B,u,o,A,V]);const U={onChange:(e,t)=>{F([...e])}};function Y(e,t,l){let i=e+t;for(;i>=0&&i<l.length;){if(!1!==l[i].editable)return i;i+=t}return-1}const K=e=>{var l,i,r,s;let{row:d,col:c,value:m}=e;const[p,h]=(0,n.useState)(m),f=(0,n.useRef)(null),_=t[c],[b,j]=(0,n.useState)(!1),[k,S]=(0,n.useState)(!1);(0,n.useEffect)((()=>{h(m),setTimeout((()=>{var e;null===(e=f.current)||void 0===e||e.focus()}),50)}),[m]);const A=e=>{h(e),O(d,c,e)},D=e=>{if("product"===_.type&&"Enter"===e.key)return e.stopPropagation(),void j(!0);if("stock"===_.type&&"Enter"===e.key)return e.stopPropagation(),void S(!0);if("Tab"===e.key){if(e.preventDefault(),_.required&&(!p||""===p))return void a.Ay.error("".concat(_.title," is required"));const l=e.shiftKey?c-1:c+1,i=d+(l>=t.length?1:0),n=(l+t.length)%t.length;i<B.length?G({row:i,col:n}):u&&(V(),G({row:B.length,col:n}))}else"Escape"===e.key&&G(null)},T=e=>{P&&P(e,d),j(!1),G(null)},N=e=>{const t=[...B];t[d].stock_id=e.id||e._id||"",t[d].batch_no=e.batch_no||"",R(t),o(t),S(!1),G(null)};switch(_.type){case"product":const e=null!==(l=B[d])&&void 0!==l&&l.product_name?"".concat(B[d].product_name).concat(null!==(i=B[d])&&void 0!==i&&i.variant_name?" ".concat(B[d].variant_name):"").trim():p;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,w.jsx)(v.A,{ref:f,value:e,onKeyDown:D,placeholder:"Press Enter to select product",readOnly:!0,style:{cursor:"pointer"}})}),b&&(0,w.jsx)(I,{visible:b,onSelect:T,onCancel:()=>j(!1)})]});case"stock":return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,w.jsx)(v.A,{ref:f,value:(null===(r=B[d])||void 0===r?void 0:r.batch_no)||p,onKeyDown:D,placeholder:"Press Enter to select stock",readOnly:!0})}),k&&(0,w.jsx)(L,{visible:k,onSelect:N,onCancel:()=>S(!1),productId:(null===(s=B[d])||void 0===s?void 0:s.product_id)||""})]});case"number":return(0,w.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,w.jsx)(x.A,{ref:f,value:p,onChange:A,onBlur:()=>G(null),controls:!1,onKeyDown:e=>{if("Tab"===e.key||"Enter"===e.key){if(e.preventDefault(),_.required&&(!p||""===p))return void a.Ay.error("".concat(_.title," is required"));const l=e.shiftKey?-1:1,i=Y(c,l,t);if(-1!==i)G({row:d,col:i});else{const e=l>0?d+1:d-1;if(e>=0&&e<B.length){const l=Y(-1,1,t);-1!==l&&G({row:e,col:l})}else if(l>0&&u){V();const e=Y(-1,1,t);-1!==e&&G({row:B.length,col:e})}else G(null)}}else"Escape"===e.key&&G(null)},style:{width:"100%"}})});case"select":return(0,w.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,w.jsx)(y.A,{ref:f,value:p,options:_.options,onChange:e=>{if(O(d,c,e)){const e=c+1,l=d+(e>=t.length?1:0),i=(e+t.length)%t.length;l<B.length?G({row:l,col:i}):u&&(V(),G({row:B.length,col:i}))}else setTimeout((()=>{var e;null===(e=f.current)||void 0===e||e.focus()}),50)},style:{width:"100%"},onKeyDown:e=>{"Enter"!==e.key&&"Tab"!==e.key||e.preventDefault()}})});case"date":return(0,w.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,w.jsx)(g.A,{ref:f,value:p?C()(p):null,onChange:e=>{A(e?e.format("YYYY-MM-DD"):null),G(null)},onBlur:()=>G(null),onKeyDown:D,style:{width:"100%"}})});default:return(0,w.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,w.jsx)(v.A,{ref:f,value:p,onChange:e=>A(e.target.value),onBlur:()=>G(null),onKeyDown:D})})}},H=t.map(((e,t)=>(0,i.A)((0,i.A)({},e),{},{onCell:(e,l)=>({onClick:()=>{"number"===typeof l&&G({row:l,col:t})},onContextMenu:e=>{e.preventDefault(),"number"===typeof l&&G({row:l,col:t})}}),render:(l,i,n)=>{if(z&&z.row===n&&z.col===t)return(0,w.jsx)(K,{row:n,col:t,value:i[e.dataIndex]},"".concat(n,"-").concat(t));if("function"===typeof e.render)return e.render(l,i,n);if("batch_no"===e.dataIndex)return i.batch_no||i[e.dataIndex];if("product_id"===e.dataIndex)return i.product_name||i[e.dataIndex];if("select"===e.type&&e.options){const t=e.options.find((t=>t.value===i[e.dataIndex]));return t?t.label:i[e.dataIndex]}return i[e.dataIndex]}})));return(0,w.jsxs)("div",{className:"antd-editable-table ".concat(S?"compact":""," ").concat(T||""),children:[(0,w.jsxs)("div",{className:"table-toolbar",children:[(0,w.jsxs)(h.A,{children:[u&&(0,w.jsx)(r.Ay,{type:"primary",icon:(0,w.jsx)(_.A,{}),onClick:V,children:"Add Row (Shift+A)"}),m&&(0,w.jsx)(r.Ay,{danger:!0,icon:(0,w.jsx)(b.A,{}),onClick:()=>{0!==B.length?p.A.confirm({title:"Are you sure you want to delete the selected Bill Items?",onOk:()=>{const e=B.slice(0,-1);R(e),o(e),null===c||void 0===c||c(E)}}):a.Ay.warning("No rows to delete")},children:"Delete Row"}),(0,w.jsx)(r.Ay,{type:"primary",icon:(0,w.jsx)(s.A,{}),onClick:()=>o(B),children:"Save (Ctrl+S)"})]}),(0,w.jsx)(M,{type:"secondary",className:"table-info",children:"Use Tab / Shift+Tab to navigate cells"})]}),(0,w.jsx)(f.A,{bordered:!0,dataSource:B,columns:H,rowKey:j,loading:k,pagination:!1,size:D,scroll:{y:400},rowSelection:(0,i.A)((0,i.A)({},U),{},{type:"checkbox",selectedRowKeys:E})})]})};var G=l(66885),q=l(47246);const V=(e,t)=>{const l=(0,n.useMemo)((()=>e.length?function(e){let{items:t,productList:l,isGstIncluded:n,discount:o,discountType:a}=e;const r=t.map((e=>{var t,o;const a=null===l||void 0===l?void 0:l.find((t=>t._id===e.product_id));let r=e.tax_percentage||(null===a||void 0===a||null===(t=a.CategoryItem)||void 0===t?void 0:t.tax_percentage)||18;r&&0!==r||(r=18);const s=Number(e.qty||0)*Number(e.price||0)+Number(e.loose_qty||0)*(Number(e.price||0)/((null===a||void 0===a||null===(o=a.VariantItem)||void 0===o?void 0:o.pack_size)||1)||0);let d=s;return!n&&r>0&&(d=s+s*r/100),(0,i.A)((0,i.A)({},e),{},{tax_percentage:r,baseAmount:s,amount:d})})),s=r.reduce(((e,t)=>e+Number(t.amount)),0),d=r.reduce(((e,t)=>e+Number(t.baseAmount)),0);let c=0;o>0&&(c="percentage"===a?d*(o/100):o);let u=0,m=0,p=0;return r.forEach((e=>{let t=e.baseAmount;o>0&&(t="percentage"===a?e.baseAmount-e.baseAmount*(o/100):e.baseAmount-o/d*e.baseAmount);let l=0;n?e.tax_percentage>0?(l=t*(e.tax_percentage/(100+e.tax_percentage)),m+=t-l,u+=l,p+=t):(m+=t,p+=t):e.tax_percentage>0?(l=t*(e.tax_percentage/100),m+=t,u+=l,p+=t+l):(m+=t,p+=t)})),{sub_total:s,value_of_goods:m,total_gst:u,cgst:u/2,sgst:u/2,total_amount:p,discountValue:c}}({items:e,productList:[],isGstIncluded:t.isGstIncluded,discount:t.discount,discountType:t.discountType}):{sub_total:0,value_of_goods:0,total_gst:0,cgst:0,sgst:0,total_amount:0,discountValue:0}),[e,t]);return l};var O=l(83003);var U=l(39177);const Y=e=>{let{billdata:t,onSuccess:o}=e;const r=(e=>{var t;const l=(0,N.HW)(),i=null===l||void 0===l?void 0:l.branch_id,o=(null===l||void 0===l?void 0:l.organisation_id)||(null===l||void 0===l||null===(t=l.organisationItems)||void 0===t?void 0:t._id),a=(0,q.Ib)("SalesRecord"),r=(0,q.Ib)("InvoiceNumber"),{data:s,isLoading:d,refetch:c}=S.lh.useGetProductQuery({},{skip:!0}),{data:u,isLoading:m,refetch:p}=S.lh.useGetCustomerQuery({},{skip:!0}),{data:v,isLoading:x,refetch:y}=S.lh.useGetVendorQuery({},{skip:!0}),{data:g,isLoading:h,refetch:f}=S.lh.useGetBillingUsersQuery({},{skip:!0}),_=!i&&!!e,{data:b,isLoading:j,refetch:C}=S.lh.useGetStockAuditQuery({},{skip:!_}),{data:k,isLoading:A,refetch:w}=S.lh.useGetBranchStockQuery({},{skip:!i}),{data:D,refetch:I}=r.useGetAll(),{data:T}=S.lh.useGetOrganisationsQuery({organisation_id:o},{skip:!o}),{data:P}=S.lh.useGetSettingsQuery({organisation_id:o,page:1,limit:1},{skip:!o,refetchOnMountOrArgChange:!1}),B=(0,n.useMemo)((()=>Array.isArray(null===s||void 0===s?void 0:s.result)?s.result:[]),[s]),R=(0,n.useMemo)((()=>Array.isArray(null===u||void 0===u?void 0:u.result)?u.result:[]),[u]),E=(0,n.useMemo)((()=>Array.isArray(null===v||void 0===v?void 0:v.result)?v.result:[]),[v]),F=(0,n.useMemo)((()=>Array.isArray(null===g||void 0===g?void 0:g.result)?g.result:[]),[g]),L=(0,n.useMemo)((()=>Array.isArray(null===b||void 0===b?void 0:b.result)?b.result:[]),[b]),M=(0,n.useMemo)((()=>Array.isArray(null===k||void 0===k?void 0:k.result)?k.result:[]),[k]),z=(0,n.useMemo)((()=>{const e=null===T||void 0===T?void 0:T.result;return Array.isArray(e)?e[0]:e||(null===l||void 0===l?void 0:l.organisationItems)||{}}),[T,l]),G=(0,n.useMemo)((()=>(null===l||void 0===l?void 0:l.branchItems)||{}),[l]),V=(0,n.useMemo)((()=>{const e=(null===P||void 0===P?void 0:P.result)||P||{};return Array.isArray(e)?e[0]:e}),[P]),{create:O,isLoading:U}=a.useCreate(),{update:Y,isLoading:K}=a.useUpdate(),{create:H,isLoading:Q}=r.useCreate();return{user:l,branchId:i,organisationId:o,organisationDetails:z,branchDetails:G,settings:V,productListResult:B,customerListResult:R,vendorListResult:E,userListResult:F,stockAuditListResult:L,branchStockListResult:M,productLoading:d,customerLoading:m,vendorLoading:x,userLoading:h,stockLoading:j,branchStockLoading:A,saleCreateLoading:U,saleUpdateLoading:K,invoice_no_create_loading:Q,createSalesRecord:O,updateSalesRecord:Y,createInvoiceNumber:H,refetchProducts:c,refetchCustomers:p,refetchVendors:y,refetchUsers:f,refetchStockAudit:C,refetchBranchStock:w,refetchInvoiceNo:I,refetchAllData:()=>{c(),p(),y(),f(),i?w():_&&C()},invoiceNoData:D}})(t),{BillTemplateComponent:s,InvoiceTemplateComponent:d,settings:c}=(0,U.V)(),u=(()=>{const[e,t]=(0,n.useState)({invoice_no:"",date:C()().format("YYYY-MM-DD"),customer_id:"",customer_name:"",billed_by_id:"",billed_by_name:"",payment_mode:"cash",items:[]}),[l,o]=(0,n.useState)({isPaid:!0,isPartiallyPaid:!1,isRetail:!0,isGstIncluded:!0,discount:0,discountType:"percentage",paidAmount:0}),[a,r]=(0,n.useState)("bill"),s=(0,n.useCallback)((e=>{t((t=>(0,i.A)((0,i.A)({},t),e)))}),[]),d=(0,n.useCallback)((e=>{t((t=>(0,i.A)((0,i.A)({},t),{},{items:e})))}),[]),c=(0,n.useCallback)((()=>{const e={product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0};t((t=>(0,i.A)((0,i.A)({},t),{},{items:[...t.items,e]})))}),[]),u=(0,n.useCallback)((e=>{t((t=>(0,i.A)((0,i.A)({},t),{},{items:t.items.filter(((t,l)=>!e.includes(l)))})))}),[]),m=(0,n.useCallback)((e=>{o((t=>(0,i.A)((0,i.A)({},t),e)))}),[]),p=(0,n.useCallback)((()=>{t({invoice_no:"",date:C()().format("YYYY-MM-DD"),customer_id:"",customer_name:"",billed_by_id:"",billed_by_name:"",payment_mode:"cash",items:[{product_id:"",product_name:"",variant_name:"",stock_id:"",batch_no:"",qty:0,loose_qty:0,price:0,mrp:0,amount:0,tax_percentage:0}]}),o({isPaid:!0,isPartiallyPaid:!1,isRetail:!0,isGstIncluded:!0,discount:0,discountType:"percentage",paidAmount:0}),r("bill")}),[]),v=(0,n.useCallback)(((e,l)=>{var i,n,a,s,d,c,u,m;const p="invoice"===e.document_type,v=p?e.vendorDetails:e.customerDetails,x=p?e.vendor_id:e.customer_id,y=(null===v||void 0===v?void 0:v.vendor_name)||(null===v||void 0===v?void 0:v.full_name)||(null===v||void 0===v?void 0:v.name)||"";t({invoice_no:e.invoice_no,date:C()(e.date).format("YYYY-MM-DD"),customer_id:x,customer_name:y,billed_by_id:e.billed_by_id||"",billed_by_name:(null===(i=e.billedByDetails)||void 0===i?void 0:i.name)||"",payment_mode:e.payment_mode,items:(null===(n=e.Items)||void 0===n?void 0:n.map((e=>{var t,l,i,n,o,a,r,s,d,c,u,m;return{_id:e._id,product_id:e.product_id,product_name:(null===(t=e.productItems)||void 0===t?void 0:t.name)||e.product_name||"",variant_name:(null===(l=e.productItems)||void 0===l||null===(i=l.VariantItem)||void 0===i?void 0:i.variant_name)||"",stock_id:e.stock_id||e.branch_stock_id,batch_no:e.batch_no||"",qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price,mrp:e.mrp||e.price,amount:e.amount,tax_percentage:e.tax_percentage||(null===(n=e.productItems)||void 0===n||null===(o=n.CategoryItem)||void 0===o?void 0:o.tax_percentage)||(null===(a=e.productItems)||void 0===a?void 0:a.tax_percentage)||0,hsn_code:e.hsn_code||(null===(r=e.productItems)||void 0===r?void 0:r.hsn_code)||(null===(s=e.productItems)||void 0===s||null===(d=s.VariantItem)||void 0===d?void 0:d.hsn_code)||"",hsn_sac:e.hsn_sac||(null===(c=e.productItems)||void 0===c?void 0:c.hsn_sac)||"",discount:e.discount||0,description:e.description||"",category_name:(null===(u=e.productItems)||void 0===u||null===(m=u.CategoryItem)||void 0===m?void 0:m.category_name)||""}})))||[]}),o({isPaid:null===(a=e.is_paid)||void 0===a||a,isPartiallyPaid:null!==(s=e.is_partially_paid)&&void 0!==s&&s,isRetail:"retail"===e.sale_type,isGstIncluded:null===(d=e.is_gst_included)||void 0===d||d,discount:null!==(c=e.discount)&&void 0!==c?c:0,discountType:null!==(u=e.discount_type)&&void 0!==u?u:"percentage",paidAmount:null!==(m=e.paid_amount)&&void 0!==m?m:0}),r(e.document_type||"bill"),l&&setTimeout((()=>l()),0)}),[]);return{billFormData:e,billSettings:l,documentType:a,setBillFormData:t,setBillSettings:o,setDocumentType:r,updateHeader:s,updateItems:d,addItem:c,deleteItems:u,updateSettings:m,resetForm:p,loadBillData:v}})(),m=(()=>{const[e,t]=(0,n.useState)(null),[l,i]=(0,n.useState)(!1),[o,a]=(0,n.useState)(!1),[r,s]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[p,v]=(0,n.useState)(!1),[x,y]=(0,n.useState)(null),[g,h]=(0,n.useState)(""),[f,_]=(0,n.useState)(0),[b,j]=(0,n.useState)(null),C=(0,n.useCallback)((e=>{t(e)}),[]),k=(0,n.useCallback)((()=>{t(null)}),[]),S=(0,n.useCallback)((()=>{i(!0)}),[]),A=(0,n.useCallback)((()=>{i(!1)}),[]),w=(0,n.useCallback)((()=>{a(!0)}),[]),D=(0,n.useCallback)((()=>{a(!1)}),[]),I=(0,n.useCallback)((e=>{y(e),v(!0),_(e)}),[]),T=(0,n.useCallback)((()=>{v(!1),y(null)}),[]),P=(0,n.useCallback)((()=>{c(!0)}),[]),N=(0,n.useCallback)((()=>{c(!1)}),[]),B=(0,n.useCallback)((()=>{s(!0)}),[]),R=(0,n.useCallback)((()=>{s(!1)}),[]),E=(0,n.useCallback)((e=>{h(e),m(!0)}),[]),F=(0,n.useCallback)((()=>{m(!1),h("")}),[]),L=(0,n.useCallback)((()=>{t(null),i(!1),a(!1),s(!1),c(!1),m(!1),v(!1),y(null),h(""),j(null)}),[]);return{stockModalRowIndex:e,customerModalVisible:l,userModalVisible:o,saveConfirmationVisible:r,billListDrawerVisible:d,productDetailsModalVisible:u,productSelectionModalVisible:p,productSelectionRowIndex:x,selectedProductId:g,lastInteractedRowIndex:f,externalEditingCell:b,setStockModalRowIndex:t,setCustomerModalVisible:i,setUserModalVisible:a,setSaveConfirmationVisible:s,setBillListDrawerVisible:c,setProductDetailsModalVisible:m,setProductSelectionModalVisible:v,setProductSelectionRowIndex:y,setSelectedProductId:h,setLastInteractedRowIndex:_,setExternalEditingCell:j,openStockModal:C,closeStockModal:k,openCustomerModal:S,closeCustomerModal:A,openUserModal:w,closeUserModal:D,openProductSelectionModal:I,closeProductSelectionModal:T,openBillListDrawer:P,closeBillListDrawer:N,openSaveConfirmation:B,closeSaveConfirmation:R,openProductDetailsModal:E,closeProductDetailsModal:F,closeAllModals:L}})(),p=(e=>{let{productOptions:t,branchId:l,branchStockListResult:o,stockAuditListResult:r,billSettings:s}=e;const d=(0,n.useCallback)((e=>e.map((e=>{if(!e.product_id)return e;if(!e.stock_id)return(0,i.A)((0,i.A)({},e),{},{product_name:e.product_name||"",variant_name:e.variant_name||"",tax_percentage:e.tax_percentage||0,category_name:e.category_name||""});const t=e.stockData,n=(l?o:r).find((t=>t._id===e.stock_id)),a=t||n;if(a){var d,c;const t=a.sell_price||0,l=(null===a||void 0===a||null===(d=a.ProductItem)||void 0===d||null===(c=d.VariantItem)||void 0===c?void 0:c.pack_size)||(null===a||void 0===a?void 0:a.pack_size),n=t/(l?parseInt(l):1),o=(e.qty||0)*t+(e.loose_qty||0)*n,r=e.tax_percentage||0;let u=o;return s.isGstIncluded||(u=o+o*r/100),(0,i.A)((0,i.A)({},e),{},{price:e.price||t,mrp:a.mrp||t,amount:u,tax_percentage:r,product_name:e.product_name||"",variant_name:e.variant_name||"",category_name:e.category_name||"",batch_no:a.batch_no||e.batch_no||"",stockData:a})}return e}))),[l,o,r,s]),c=(0,n.useCallback)((e=>e.map((e=>{const t={product_id:e.product_id||"",product_name:e.product_name||"",variant_name:e.variant_name||"",stock_id:e.stock_id||"",batch_no:e.batch_no||"",qty:e.qty||0,loose_qty:e.loose_qty||0,price:e.price||0,mrp:e.mrp||0,amount:e.amount||0,tax_percentage:e.tax_percentage||0,category_name:e.category_name||"",stockData:e.stockData};if(e.stock_id&&(e.qty||e.loose_qty)){const s=(l?o:r).find((t=>t._id===e.stock_id));if(s){var i,n;const l=null===s||void 0===s||null===(i=s.ProductItem)||void 0===i||null===(n=i.VariantItem)||void 0===n?void 0:n.pack_size,o=l?parseInt(l):1,r=s.available_quantity||0,d=s.available_loose_quantity||0;e.qty&&e.qty>r&&(a.Ay.error("Pack quantity (".concat(e.qty,") exceeds available packs (").concat(r,")")),t.qty=r);const c=r-(e.qty||0),u=c*o+d;e.loose_qty&&e.loose_qty>u&&(a.Ay.error("Loose quantity (".concat(e.loose_qty,") exceeds available loose items (").concat(u," = ").concat(c," remaining packs \xd7 ").concat(o," + ").concat(d," loose)")),t.loose_qty=u)}}return t}))),[l,o,r]);return{handleItemsChange:(0,n.useCallback)((e=>{const t=c(e);return d(t)}),[c,d]),calculateItemAmounts:d,validateStockQuantities:c}})({productOptions:[],branchId:r.branchId,branchStockListResult:r.branchStockListResult,stockAuditListResult:r.stockAuditListResult,billSettings:u.billSettings}),v=V(u.billFormData.items,u.billSettings),x=(e=>{const t=(0,O.wA)(),[l,o]=(0,n.useState)(null),[r,s]=(0,n.useState)(null),[d,c]=(0,n.useState)(null),u=(0,n.useCallback)((e=>[]),[]);return{savedBillData:l,createResponse:r,updateResponse:d,handleSaveDraft:(0,n.useCallback)((async()=>{if(!e.billFormData.invoice_no)return a.Ay.error("Please enter an invoice number"),!1;if(!e.billFormData.items||0===e.billFormData.items.length)return a.Ay.error("Please add at least one product/item to save as draft"),!1;if(0===e.billFormData.items.filter((e=>e.product_id)).length)return a.Ay.error("Please add at least one product/item to save as draft"),!1;const t=(0,i.A)((0,i.A)((0,i.A)({invoice_no:e.billFormData.invoice_no,date:e.billFormData.date||C()().format("YYYY-MM-DD")},"invoice"===e.documentType?{vendor_id:e.billFormData.customer_id||null}:{customer_id:e.billFormData.customer_id||null}),{},{billed_by_id:e.billFormData.billed_by_id||null,payment_mode:e.billFormData.payment_mode||"cash",items:e.billFormData.items.map((t=>(0,i.A)((0,i.A)({product_id:t.product_id||null,stock_id:t.stock_id||null},e.branchId&&t.stock_id&&{branch_stock_id:t.stock_id}),{},{qty:t.qty||0,loose_qty:t.loose_qty||0,price:t.price||0,mrp:t.mrp||0,amount:t.amount||0,tax_percentage:t.tax_percentage||0,_id:t._id})))},e.billCalculations),{},{discount:e.billSettings.discount,discount_type:e.billSettings.discountType,is_paid:e.billSettings.isPaid,is_partially_paid:e.billSettings.isPartiallyPaid,sale_type:e.billSettings.isRetail?"retail":"wholesale",is_gst_included:e.billSettings.isGstIncluded,paid_amount:e.billSettings.isPartiallyPaid?e.billSettings.paidAmount:e.billSettings.isPaid?e.billCalculations.total_amount:0,status:"draft",document_type:e.documentType});try{var l;let r;if(e.billdata){const l=await e.updateSalesRecord(e.billdata._id,t);if(!l.data)throw l.error;r=l.data,c(r)}else{const l=await e.createSalesRecord(t);if(!l.data)throw l.error;r=l.data,s(r)}if(200===(null===(l=r)||void 0===l?void 0:l.statusCode)){var n;a.Ay.success("Draft saved successfully!");const l=(0,i.A)((0,i.A)({},t),{},{customer_name:e.billFormData.customer_name,total_amount:e.billCalculations.total_amount});return o(l),null===(n=e.onSaveSuccess)||void 0===n||n.call(e,l),!0}return!1}catch(r){return a.Ay.error("Failed to save draft. Please try again."),!1}}),[e,t]),handleCompleteBill:(0,n.useCallback)((async()=>{if(!e.billFormData.invoice_no||!e.billFormData.customer_id||!e.billFormData.items.length)return a.Ay.error("Please fill all required fields"),!1;if(e.billFormData.items.some((e=>!e.product_id||!e.stock_id||!e.qty&&!e.loose_qty||!e.price)))return a.Ay.error("Please complete all item details"),!1;const l=u(e.billFormData.items);if(l.length>0)return a.Ay.error("Stock validation errors:\n".concat(l.join("\n"))),!1;const n=(0,i.A)((0,i.A)((0,i.A)({invoice_no:e.billFormData.invoice_no,date:e.billFormData.date},"invoice"===e.documentType?{vendor_id:e.billFormData.customer_id}:{customer_id:e.billFormData.customer_id}),{},{billed_by_id:e.billFormData.billed_by_id,payment_mode:e.billFormData.payment_mode,items:e.billFormData.items.map((t=>(0,i.A)((0,i.A)({product_id:t.product_id,stock_id:t.stock_id},e.branchId&&{branch_stock_id:t.stock_id}),{},{qty:t.qty,loose_qty:t.loose_qty,price:t.price,mrp:t.mrp,amount:t.amount,tax_percentage:t.tax_percentage,hsn_code:t.hsn_code||"",hsn_sac:t.hsn_sac||"",discount:t.discount||0,description:t.description||"",product_name:t.product_name||"",variant_name:t.variant_name||"",_id:t._id})))},e.billCalculations),{},{discount:e.billSettings.discount,discount_type:e.billSettings.discountType,is_paid:e.billSettings.isPaid,is_partially_paid:e.billSettings.isPartiallyPaid,sale_type:e.billSettings.isRetail?"retail":"wholesale",is_gst_included:e.billSettings.isGstIncluded,paid_amount:e.billSettings.isPartiallyPaid?e.billSettings.paidAmount:e.billSettings.isPaid?e.billCalculations.total_amount:0,status:"completed",document_type:e.documentType});try{var r;let l;if(e.billdata){const t=await e.updateSalesRecord(e.billdata._id,n);if(!t.data)throw t.error;l=t.data,c(l)}else{const t=await e.createSalesRecord(n);if(!t.data)throw t.error;l=t.data,s(l)}if(200===(null===(r=l)||void 0===r?void 0:r.statusCode)){var d;const l=(0,i.A)((0,i.A)({},n),{},{customer_name:e.billFormData.customer_name,total_amount:e.billCalculations.total_amount});return o(l),t(S.lh.util.invalidateTags(["StockAudit","BranchStock"])),null===(d=e.onSaveSuccess)||void 0===d||d.call(e,l),e.billdata||e.createInvoiceNumber({}),!0}return!1}catch(m){return a.Ay.error("Failed to complete bill. Please try again."),!1}}),[e,u,t]),setSavedBillData:o,setCreateResponse:s,setUpdateResponse:c}})({billFormData:u.billFormData,billSettings:u.billSettings,billCalculations:v,documentType:u.documentType,branchId:r.branchId,createSalesRecord:r.createSalesRecord,updateSalesRecord:r.updateSalesRecord,createInvoiceNumber:r.createInvoiceNumber,billdata:t,onSuccess:o,onSaveSuccess:e=>{m.openSaveConfirmation()}}),y=(0,n.useCallback)((e=>{const t=p.handleItemsChange(e);u.updateItems(t)}),[p,u]),g=(0,n.useCallback)(((e,t,l)=>{const n=[...u.billFormData.items],o=n[e];n[e]=(0,i.A)((0,i.A)({},o),{},{[t]:l}),y(n)}),[u.billFormData.items,y]),h=(0,n.useCallback)(((e,t)=>{var l,i,n;const o=[...u.billFormData.items];let a;a="number"===typeof t?t:o.findIndex((e=>e.key===t.key)),-1!==a?(o[a].product_id=e.id||e._id||"",o[a].product_name=e.name||"",o[a].variant_name=(null===(l=e.VariantItem)||void 0===l?void 0:l.variant_name)||"",o[a].price=e.selling_price||0,o[a].tax_percentage=(null===(i=e.CategoryItem)||void 0===i?void 0:i.tax_percentage)||0,o[a].category_name=(null===(n=e.CategoryItem)||void 0===n?void 0:n.category_name)||"",y(o),m.openStockModal(a)):console.error("\u274c Could not find row index for product selection!")}),[u.billFormData.items,y,m]),f=(0,n.useCallback)((e=>{var t,l;if(null===m.stockModalRowIndex)return;const n=[...u.billFormData.items],o=m.stockModalRowIndex,a=(0,i.A)({},n[o]);a.stock_id=e.id||e._id||"",a.batch_no=e.batch_no||"";const r=e.ProductItem;var s,d,c;r&&(a.product_id=a.product_id||r._id||"",a.product_name=r.name||a.product_name||"",a.variant_name=a.variant_name||(null===(s=r.VariantItem)||void 0===s?void 0:s.variant_name)||"",a.tax_percentage="number"===typeof a.tax_percentage&&void 0!==a.tax_percentage?a.tax_percentage:(null===(d=r.CategoryItem)||void 0===d?void 0:d.tax_percentage)||0,a.category_name=a.category_name||(null===(c=r.CategoryItem)||void 0===c?void 0:c.category_name)||"");a.stockData={_id:e.id||e._id,available_quantity:e.available_quantity||0,available_loose_quantity:e.available_loose_quantity||0,batch_no:e.batch_no||"",pack_size:(null===(t=e.ProductItem)||void 0===t||null===(l=t.VariantItem)||void 0===l?void 0:l.pack_size)||1,sell_price:e.sell_price||0,mrp:e.mrp||e.sell_price||0,ProductItem:e.ProductItem},n[o]=a,y(n),m.closeStockModal();m.setExternalEditingCell({row:m.stockModalRowIndex,col:2})}),[m,u.billFormData.items,y]),_=(0,n.useCallback)((async()=>{if(!u.billFormData.items||0===u.billFormData.items.length)return void a.Ay.warning("Please add items before printing");const e=("invoice"===u.documentType?r.vendorListResult:r.customerListResult).find((e=>e._id===u.billFormData.customer_id)),t={invoice_no:u.billFormData.invoice_no,date:u.billFormData.date,customerName:(null===e||void 0===e?void 0:e.vendor_name)||(null===e||void 0===e?void 0:e.full_name)||"",customerAddress:(null===e||void 0===e?void 0:e.address)||(null===e||void 0===e?void 0:e.address1)||"",customerCity:(null===e||void 0===e?void 0:e.city)||"",customerState:(null===e||void 0===e?void 0:e.state)||"",customerPincode:(null===e||void 0===e?void 0:e.pincode)||"",customerPhone:(null===e||void 0===e?void 0:e.phone)||(null===e||void 0===e?void 0:e.mobile)||"",customerEmail:(null===e||void 0===e?void 0:e.email)||"",customer_gstin:(null===e||void 0===e?void 0:e.gst_no)||"",customer_pan:(null===e||void 0===e?void 0:e.pan_no)||"",items:u.billFormData.items,total:v.total_amount,total_amount:v.total_amount,value_of_goods:v.value_of_goods,sub_total:v.sub_total,total_gst:v.total_gst,cgst:v.cgst,sgst:v.sgst,discountValue:v.discountValue,discount:u.billSettings.discount,discount_type:u.billSettings.discountType,is_gst_included:u.billSettings.isGstIncluded,payment_mode:u.billFormData.payment_mode,is_paid:u.billSettings.isPaid,is_partially_paid:u.billSettings.isPartiallyPaid,paid_amount:u.billSettings.isPartiallyPaid?u.billSettings.paidAmount:u.billSettings.isPaid?v.total_amount:0,organisationItems:r.organisationDetails,branchItems:r.branchDetails};let o="";if(null!==c&&void 0!==c&&c.enable_payment_qr&&null!==c&&void 0!==c&&c.upi_id)try{const{generateUPIQRCode:e,formatBillToUPIParams:i}=await Promise.resolve().then(l.bind(l,356)),n=i(t,c);n&&(o=await e(n,{width:(null===c||void 0===c?void 0:c.qr_size)||150}))}catch(f){console.error("Error generating QR code for print:",f)}const m=(0,i.A)((0,i.A)({},c),{},{qrCodeDataUrl:o}),p="bill"===u.documentType?s:d,x=n.createElement(p,{billData:t,settings:m}),y=G.renderToString(x),{printAsPDF:g}=await Promise.all([l.e(828),l.e(90)]).then(l.bind(l,48090)),h="".concat(u.documentType,"_").concat(t.invoice_no,"_").concat(C()().format("YYYYMMDD"));await g(y,h,u.documentType)}),[u,v,r,s,d,c]),b=(0,n.useCallback)((async()=>{if(!u.billFormData.items||0===u.billFormData.items.length)return void a.Ay.warning("Please add items before downloading");const e=("invoice"===u.documentType?r.vendorListResult:r.customerListResult).find((e=>e._id===u.billFormData.customer_id)),t={invoice_no:u.billFormData.invoice_no,date:u.billFormData.date,customerName:(null===e||void 0===e?void 0:e.vendor_name)||(null===e||void 0===e?void 0:e.full_name)||"",customerAddress:(null===e||void 0===e?void 0:e.address)||(null===e||void 0===e?void 0:e.address1)||"",customerCity:(null===e||void 0===e?void 0:e.city)||"",customerState:(null===e||void 0===e?void 0:e.state)||"",customerPincode:(null===e||void 0===e?void 0:e.pincode)||"",customerPhone:(null===e||void 0===e?void 0:e.phone)||(null===e||void 0===e?void 0:e.mobile)||"",customerEmail:(null===e||void 0===e?void 0:e.email)||"",customer_gstin:(null===e||void 0===e?void 0:e.gst_no)||"",customer_pan:(null===e||void 0===e?void 0:e.pan_no)||"",items:u.billFormData.items,total:v.total_amount,total_amount:v.total_amount,value_of_goods:v.value_of_goods,sub_total:v.sub_total,total_gst:v.total_gst,cgst:v.cgst,sgst:v.sgst,discountValue:v.discountValue,discount:u.billSettings.discount,discount_type:u.billSettings.discountType,is_gst_included:u.billSettings.isGstIncluded,payment_mode:u.billFormData.payment_mode,is_paid:u.billSettings.isPaid,is_partially_paid:u.billSettings.isPartiallyPaid,paid_amount:u.billSettings.isPartiallyPaid?u.billSettings.paidAmount:u.billSettings.isPaid?v.total_amount:0,organisationItems:r.organisationDetails,branchItems:r.branchDetails};let o="";if(null!==c&&void 0!==c&&c.enable_payment_qr&&null!==c&&void 0!==c&&c.upi_id)try{const{generateUPIQRCode:e,formatBillToUPIParams:i}=await Promise.resolve().then(l.bind(l,356)),n=i(t,c);n&&(o=await e(n,{width:(null===c||void 0===c?void 0:c.qr_size)||150}))}catch(f){console.error("Error generating QR code for download:",f)}const m=(0,i.A)((0,i.A)({},c),{},{qrCodeDataUrl:o}),p="bill"===u.documentType?s:d,x=n.createElement(p,{billData:t,settings:m}),y=G.renderToString(x),{downloadAsPDF:g}=await Promise.all([l.e(828),l.e(90)]).then(l.bind(l,48090)),h="".concat(u.documentType,"_").concat(t.invoice_no,"_").concat(C()().format("YYYYMMDD"));await g(y,h,u.documentType)}),[u,v,r,s,d,c]),j=(k={onF1AddItem:u.addItem,onF2SaveDraft:x.handleSaveDraft,onF3CompleteBill:x.handleCompleteBill,onF4Clear:()=>{u.resetForm(),a.Ay.success("Bill form cleared successfully!")},onF5ProductSelection:()=>{m.openProductSelectionModal(m.lastInteractedRowIndex)},onF6BillList:m.openBillListDrawer,onF7StockSelection:()=>{const e=u.billFormData.items.findIndex((e=>e.product_id&&!e.stock_id));-1!==e?m.openStockModal(e):a.Ay.warning("Please select a product first")},onF8Print:_,onEndCustomer:m.openCustomerModal,onCtrlU:m.openUserModal,onCtrlS:x.handleSaveDraft,onCtrlN:u.addItem,onCtrlP:_,onCtrlR:()=>{u.resetForm(),a.Ay.success("Ready for next bill!",2)}},(0,n.useEffect)((()=>{const e=e=>{if("F1"===e.key)return e.preventDefault(),void k.onF1AddItem();if("F2"===e.key)return e.preventDefault(),void k.onF2SaveDraft();if("F3"===e.key)return e.preventDefault(),void k.onF3CompleteBill();if("F4"===e.key)return e.preventDefault(),void k.onF4Clear();if("F5"===e.key)return e.preventDefault(),void k.onF5ProductSelection();if("F6"===e.key)return e.preventDefault(),void k.onF6BillList();if("F7"===e.key)return e.preventDefault(),void k.onF7StockSelection();if("F8"===e.key)return e.preventDefault(),void k.onF8Print();if("End"===e.key)return e.preventDefault(),void k.onEndCustomer();if(e.ctrlKey)switch(e.key){case"s":e.preventDefault(),k.onCtrlS();break;case"n":e.preventDefault(),k.onCtrlN();break;case"p":e.preventDefault(),k.onCtrlP();break;case"r":e.preventDefault(),k.onCtrlR();break;case"u":e.preventDefault(),k.onCtrlU()}if(e.ctrlKey&&/^[0-9]$/.test(e.key)){e.preventDefault();const t=document.activeElement;if(null!==t&&void 0!==t&&t.closest('td[data-column-key="qty"]')){const l=t.querySelector("input");l&&(l.value=e.key,l.dispatchEvent(new Event("change",{bubbles:!0})))}}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[k]),{shortcuts:[{key:"F1",description:"Add Item"},{key:"F2",description:"Save Draft"},{key:"F3",description:"Complete Bill"},{key:"F4",description:"Clear Form"},{key:"F5",description:"Select Product"},{key:"F6",description:"Bill List"},{key:"F7",description:"Select Stock"},{key:"F8",description:"Print"},{key:"End",description:"Select Customer"},{key:"Ctrl+U",description:"Select User"},{key:"Ctrl+S",description:"Save"},{key:"Ctrl+N",description:"Add Item"},{key:"Ctrl+R",description:"Reset"},{key:"Tab",description:"Navigate"},{key:"Enter",description:"Edit"},{key:"Esc",description:"Cancel"}]});var k;return(0,n.useEffect)((()=>{t||r.invoice_no_create_loading||u.billFormData.invoice_no||r.refetchInvoiceNo(),t&&u.loadBillData(t,(()=>{if(u.billFormData.items.length>0){const e=p.calculateItemAmounts(u.billFormData.items);u.updateItems(e)}}))}),[null===t||void 0===t?void 0:t._id]),(0,n.useEffect)((()=>{var e,l;null!==(e=r.invoiceNoData)&&void 0!==e&&null!==(l=e.result)&&void 0!==l&&l.invoice_no&&!t&&u.updateHeader({invoice_no:r.invoiceNoData.result.invoice_no})}),[r.invoiceNoData,t]),(0,n.useEffect)((()=>{t||0!==u.billFormData.items.length||u.addItem()}),[t,u.billFormData.items.length]),(0,n.useEffect)((()=>{var e;if(!t&&r.userListResult.length&&null!==(e=r.user)&&void 0!==e&&e._id&&!u.billFormData.billed_by_id){const e=r.userListResult.find((e=>{var t;return e._id===(null===(t=r.user)||void 0===t?void 0:t._id)}));e&&r.user&&u.updateHeader({billed_by_id:r.user._id,billed_by_name:e.name||r.user.name||""})}}),[r.userListResult,r.user,t,u.billFormData.billed_by_id]),(0,n.useEffect)((()=>{var e;!t&&null!==(e=r.settings)&&void 0!==e&&e.default_document_type&&u.setDocumentType(r.settings.default_document_type)}),[r.settings,t]),(0,n.useEffect)((()=>{if(t&&u.billFormData.items.length>0&&(r.branchStockListResult.length>0||r.stockAuditListResult.length>0)){if(u.billFormData.items.some((e=>e.stock_id&&!e.stockData))){const e=p.calculateItemAmounts(u.billFormData.items);u.updateItems(e)}}}),[null===t||void 0===t?void 0:t._id,u.billFormData.items.length,r.branchStockListResult.length,r.stockAuditListResult.length]),{billData:r,form:u,billFormData:u.billFormData,billSettings:u.billSettings,documentType:u.documentType,billCalculations:v,modals:m,actions:x,handleItemsChange:y,handleQuantityChange:g,handleProductSelect:h,handleStockSelect:f,handlePrint:_,handleDownload:b,shortcuts:j,productOptions:[],customerOptions:(0,n.useMemo)((()=>{const e=r.customerListResult.map((e=>({label:"".concat(e.full_name," - ").concat(e.mobile),value:e._id})));if(u.billFormData.customer_id&&u.billFormData.customer_name){e.some((e=>e.value===u.billFormData.customer_id))||e.push({value:u.billFormData.customer_id,label:u.billFormData.customer_name})}return e}),[r.customerListResult,u.billFormData.customer_id,u.billFormData.customer_name]),vendorOptions:(0,n.useMemo)((()=>{const e=r.vendorListResult.map((e=>({label:"".concat(e.vendor_name," - ").concat(e.contact_number||"N/A"),value:e._id})));if(u.billFormData.customer_id&&u.billFormData.customer_name){e.some((e=>e.value===u.billFormData.customer_id))||e.push({value:u.billFormData.customer_id,label:u.billFormData.customer_name})}return e}),[r.vendorListResult,u.billFormData.customer_id,u.billFormData.customer_name]),userOptions:(0,n.useMemo)((()=>{const e=r.userListResult.map((e=>{var t;return{label:"".concat(e.name," (").concat((null===(t=e.roleItems)||void 0===t?void 0:t.name)||"No Role",")"),value:e._id}}));if(u.billFormData.billed_by_id&&u.billFormData.billed_by_name){e.some((e=>e.value===u.billFormData.billed_by_id))||e.push({value:u.billFormData.billed_by_id,label:u.billFormData.billed_by_name})}return e}),[r.userListResult,u.billFormData.billed_by_id,u.billFormData.billed_by_name])}};var K=l(12624);const H=e=>{let{value:t,onChange:l}=e;return(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,background:"#fff",padding:"6px 12px",borderRadius:10,boxShadow:"0 2px 6px rgba(0,0,0,0.08)"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,w.jsx)(d.A,{style:{fontSize:15,color:"#667eea"}}),(0,w.jsx)("span",{style:{fontWeight:600,fontSize:12,color:"#333"},children:"PRINT TYPE"})]}),(0,w.jsxs)("div",{onClick:()=>l("bill"===t?"invoice":"bill"),style:{position:"relative",width:100,height:30,borderRadius:16,background:"bill"===t?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 2px 6px rgba(0,0,0,0.15)",display:"flex",alignItems:"center",justifyContent:"bill"===t?"flex-start":"flex-end",padding:"0 3px"},children:[(0,w.jsx)("div",{style:{width:24,height:24,borderRadius:"50%",background:"#fff",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",transition:"all 0.3s ease"}}),(0,w.jsx)("div",{style:{position:"absolute",left:"bill"===t?32:"auto",right:"invoice"===t?32:"auto",color:"#fff",fontWeight:"bold",fontSize:10,letterSpacing:.5,userSelect:"none"},children:"bill"===t?"BILL":"INVOICE"})]})]})},Q="BillDataGrid_mainContainer__Jnuo1",W="BillDataGrid_backgroundCircle1__5PBPG",X="BillDataGrid_backgroundCircle2__J+xMs",J="BillDataGrid_backgroundCircle3__AgoEw",Z="BillDataGrid_backgroundCircle4__86Xfd",$="BillDataGrid_backgroundCircle5__qpbiT",ee="BillDataGrid_headerContainer__wfojf",te="BillDataGrid_headerCircle1__8+aPI",le="BillDataGrid_headerCircle2__Z9w17",ie="BillDataGrid_headerCircle3__3eMNm",ne="BillDataGrid_headerCircle4__fVITr",oe="BillDataGrid_headerCircle5__0E6vl",ae="BillDataGrid_headerContent__6Rnkr",re="BillDataGrid_titleSection__LBuxT",se="BillDataGrid_titleIcon__qffZU",de="BillDataGrid_titleText__XlvSS",ce="BillDataGrid_subtitleText__Hgyav",ue="BillDataGrid_controlsSection__PSC3w",me="BillDataGrid_controlGroup__AFGBT",pe="BillDataGrid_saleTypeControl__hzHpa",ve="BillDataGrid_gstControl__AiGdY",xe="BillDataGrid_paymentControl__BD0r9",ye="BillDataGrid_partialPaymentControl__unngo",ge="BillDataGrid_controlLabel__QP4fP",he="BillDataGrid_badgesContainer__bqqSt",fe="BillDataGrid_itemsBadge__o0Uro",_e="BillDataGrid_amountBadge__IPSqT",be="BillDataGrid_badgeText__9cTal",je="BillDataGrid_invoiceDetailsGrid__QPpaj",Ce="BillDataGrid_itemsSection__vJE1b",ke="BillDataGrid_itemsCircle1__PQoMB",Se="BillDataGrid_itemsCircle2__0lWcR",Ae="BillDataGrid_billItemsGrid__jpWQo",we="BillDataGrid_billItemsHeader__hxL0O",De="BillDataGrid_billItemsTitle__MQduV",Ie="BillDataGrid_billSummary__yA4j-",Te="BillDataGrid_summaryCircle1__PuveY",Pe="BillDataGrid_summaryCircle2__fdcks",Ne="BillDataGrid_summaryHeader__h1BtQ",Be="BillDataGrid_summaryTitle__dSOoP",Re="BillDataGrid_summaryRow__yUShR",Ee="BillDataGrid_summaryLabel__cLnHd",Fe="BillDataGrid_summaryValue__LUh-6",Le="BillDataGrid_summaryTable__ZpVlt",Me="BillDataGrid_totalAmountRow__JXMuL",ze="BillDataGrid_totalAmountLabel__IVRMe",Ge="BillDataGrid_totalAmountValue__5W5mL",qe="BillDataGrid_discountValue__QjPij",Ve="BillDataGrid_partialPaymentInfo__OpO+-",Oe="BillDataGrid_partialPaymentRow__Qy-Ni",Ue="BillDataGrid_partialPaymentLabel__yEvTO",Ye="BillDataGrid_partialPaymentValue__SLg8d",Ke="BillDataGrid_controlsContainer__2jCRg",He="BillDataGrid_discountControl__n0WOI",Qe="BillDataGrid_discountControlLabel__0iwJ9",We="BillDataGrid_discountControlInputs__TbgUU",Xe="BillDataGrid_partialPaymentControlLabel__lxP98",Je="BillDataGrid_actionHub__SlPSg",Ze="BillDataGrid_actionButtonsContainer__BcfKu",$e="BillDataGrid_actionHubCircle1__ggNzA",et="BillDataGrid_actionHubCircle2__Nb-oj",tt="BillDataGrid_actionHubCircle3__D2pna",lt="BillDataGrid_actionHubCircle4__ayVXK",it="BillDataGrid_saveButton__vWggk",nt="BillDataGrid_billListButton__ahHFc",ot="BillDataGrid_printButton__nkIDd",at="BillDataGrid_downloadButton__Jsy5n",rt="BillDataGrid_clearButton__518xA",st="BillDataGrid_saleTypeSwitch__Xa4gR",dt="BillDataGrid_gstSwitch__ZQG0t",ct="BillDataGrid_paymentSwitch__KxB-J",ut="BillDataGrid_partialPaymentSwitch__5nNFs",{Title:mt,Text:pt}=o.A,vt=e=>{let{billdata:t,documentType:l,billSettings:i,itemCount:n,totalAmount:o,onDocumentTypeChange:a,onSettingsChange:r}=e;return(0,w.jsxs)("div",{className:ee,children:[(0,w.jsx)("div",{className:te}),(0,w.jsx)("div",{className:le}),(0,w.jsx)("div",{className:ie}),(0,w.jsx)("div",{className:ne}),(0,w.jsx)("div",{className:oe}),(0,w.jsxs)("div",{className:ae,children:[(0,w.jsxs)("div",{className:re,children:[(0,w.jsx)("div",{className:se,children:(0,w.jsx)(d.A,{style:{fontSize:"24px",color:"white"}})}),(0,w.jsxs)("div",{children:[(0,w.jsx)(mt,{level:4,className:de,children:t?"\u26a1 EDIT INVOICE":"\ud83d\ude80 NEW INVOICE"}),(0,w.jsxs)(pt,{className:ce,children:["\u26a1Lightning Fast \u2022 ",C()().format("DD MMM YYYY, dddd")]})]})]}),(0,w.jsxs)("div",{className:ue,children:[(0,w.jsx)("div",{style:{marginRight:"12px"},children:(0,w.jsx)(H,{value:l,onChange:a})}),(0,w.jsxs)("div",{className:"".concat(me," ").concat(pe),children:[(0,w.jsx)(pt,{className:ge,children:"\ud83c\udfea SALE TYPE"}),(0,w.jsx)(K.A,{checkedChildren:"RETAIL",unCheckedChildren:"WHOLESALE",checked:i.isRetail,onChange:e=>r({isRetail:e}),className:st,size:"small"})]}),(0,w.jsxs)("div",{className:"".concat(me," ").concat(ve),children:[(0,w.jsx)(pt,{className:ge,children:"\ud83d\udcca GST"}),(0,w.jsx)(K.A,{checkedChildren:"INCL",unCheckedChildren:"EXCL",checked:i.isGstIncluded,onChange:e=>r({isGstIncluded:e}),className:dt,size:"small"})]}),(0,w.jsxs)("div",{className:"".concat(me," ").concat(xe),children:[(0,w.jsx)(pt,{className:ge,children:"\ud83d\udcb3 PAYMENT"}),(0,w.jsx)(K.A,{checkedChildren:"PAID",unCheckedChildren:"UNPAID",checked:i.isPaid,onChange:e=>r({isPaid:e,isPartiallyPaid:!e&&i.isPartiallyPaid}),className:ct,size:"small"})]}),!i.isPaid&&(0,w.jsxs)("div",{className:"".concat(me," ").concat(ye),children:[(0,w.jsx)(pt,{className:ge,children:"\ud83d\udcb0 PARTIAL"}),(0,w.jsx)(K.A,{checkedChildren:"YES",unCheckedChildren:"NO",checked:i.isPartiallyPaid,onChange:e=>r({isPartiallyPaid:e}),className:ut,size:"small"})]}),(0,w.jsxs)("div",{className:he,children:[(0,w.jsx)("div",{className:fe,children:(0,w.jsxs)(pt,{className:be,children:["\ud83c\udfaf ITEMS: ",n]})}),(0,w.jsx)("div",{className:_e,children:(0,w.jsxs)(pt,{className:be,children:["\ud83d\udcb0 \u20b9",o.toFixed(2)]})})]})]})]})]})},{Text:xt}=o.A,yt=e=>{let{billFormData:t,customerOrVendorOptions:l,userOptions:i,documentType:o,onHeaderChange:a,onCustomerModalOpen:r,onUserModalOpen:s,loading:d}=e;const c=(0,n.useMemo)((()=>[{key:"invoice_no",title:"\ud83d\udcc4 INVOICE #",dataIndex:"invoice_no",type:"text",required:!0,width:180},{key:"date",title:"\ud83d\udcc5 DATE",dataIndex:"date",type:"date",required:!0,width:150},{key:"customer_id",title:"bill"===o?"\ud83d\udc64 CUSTOMER":"\ud83c\udfe2 VENDOR",dataIndex:"customer_id",type:"text",editable:!1,required:!0,width:250,render:e=>{const i=l.find((t=>t.value===e)),n="invoice"===o,a=n?"Select vendor":"Select customer",s=(null===i||void 0===i?void 0:i.label)||t.customer_name||a,d=n?"Click to open vendor selection modal (or press End key)":"Click to open customer selection modal (or press End key)";return(0,w.jsx)(T.A,{title:d,children:(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:"1px solid #d9d9d9",backgroundColor:"#fafafa",transition:"all 0.2s ease"},onClick:r,onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#fafafa",e.currentTarget.style.borderColor="#d9d9d9"},children:[(0,w.jsx)("span",{children:s}),(0,w.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#f0f8ff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d6e4ff"},children:"End"})]})})}},{key:"billed_by_id",title:"\ud83d\udc68\u200d\ud83d\udcbc BILLED BY",dataIndex:"billed_by_id",type:"text",editable:!1,required:!1,width:250,render:e=>{const l=i.find((t=>t.value===e)),n=(null===l||void 0===l?void 0:l.label)||t.billed_by_name||"Select user";return(0,w.jsx)(T.A,{title:"Click to open user selection modal (or press Ctrl+U key)",children:(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:"1px solid #d9d9d9",backgroundColor:"#f0f8ff",transition:"all 0.2s ease"},onClick:s,onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#e6f7ff",e.currentTarget.style.borderColor="#1890ff"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#f0f8ff",e.currentTarget.style.borderColor="#d9d9d9"},children:[(0,w.jsx)("span",{children:n}),(0,w.jsx)("span",{style:{fontSize:"10px",color:"#1890ff",backgroundColor:"#ffffff",padding:"2px 6px",borderRadius:"4px",border:"1px solid #d6e4ff"},children:"Ctrl+U"})]})})}},{key:"payment_mode",title:"\ud83d\udcb3 PAYMENT",dataIndex:"payment_mode",type:"select",options:[{label:"\ud83d\udcb5 Cash",value:"cash"},{label:"\ud83d\udcf1 UPI",value:"upi"},{label:"\ud83d\udcb3 Card",value:"card"}],required:!0,width:150}]),[l,i,o,r,s]),u=(0,n.useMemo)((()=>[{invoice_no:t.invoice_no,date:t.date,customer_id:t.customer_id,billed_by_id:t.billed_by_id,payment_mode:t.payment_mode}]),[t.invoice_no,t.date,t.customer_id,t.billed_by_id,t.payment_mode]);return(0,w.jsx)(z,{columns:c,dataSource:u,onSave:a,allowAdd:!1,allowDelete:!1,loading:d,className:"compact-header-grid",size:"small",rowKey:"invoice_no"})},{Text:gt}=o.A,ht=e=>{let{billCalculations:t,billSettings:l,onDiscountChange:i,onDiscountTypeChange:n,onPaidAmountChange:o}=e;return(0,w.jsxs)("div",{className:Ie,children:[(0,w.jsx)("div",{className:Te}),(0,w.jsx)("div",{className:Pe}),(0,w.jsx)("div",{className:Ne,children:(0,w.jsx)(gt,{className:Be,children:"\ud83d\udcb0 BILL SUMMARY"})}),(0,w.jsxs)("div",{className:Le,children:[(0,w.jsxs)("div",{className:Re,children:[(0,w.jsx)(gt,{className:Ee,children:"Sub Total:"}),(0,w.jsxs)(gt,{className:Fe,children:["\u20b9",t.sub_total.toFixed(2)]})]}),(0,w.jsxs)("div",{className:Re,children:[(0,w.jsx)(gt,{className:Ee,children:"Value of Goods:"}),(0,w.jsxs)(gt,{className:Fe,children:["\u20b9",t.value_of_goods.toFixed(2)]})]}),(0,w.jsxs)("div",{className:Re,children:[(0,w.jsx)(gt,{className:Ee,children:"Total GST:"}),(0,w.jsxs)(gt,{className:Fe,children:["\u20b9",t.total_gst.toFixed(2)]})]}),(0,w.jsxs)("div",{className:Re,children:[(0,w.jsx)(gt,{className:Ee,children:"CGST:"}),(0,w.jsxs)(gt,{className:Fe,children:["\u20b9",t.cgst.toFixed(2)]})]}),(0,w.jsxs)("div",{className:Re,children:[(0,w.jsx)(gt,{className:Ee,children:"SGST:"}),(0,w.jsxs)(gt,{className:Fe,children:["\u20b9",t.sgst.toFixed(2)]})]}),l.discount>0&&(0,w.jsxs)("div",{className:Re,children:[(0,w.jsx)(gt,{className:Ee,children:"DISCOUNT:"}),(0,w.jsxs)(gt,{className:qe,children:["-\u20b9","percentage"===l.discountType?((t.sub_total+t.total_gst)*("number"===typeof l.discount?l.discount:0)/100).toFixed(2):("number"===typeof l.discount?l.discount:0).toFixed(2)]})]}),(0,w.jsxs)("div",{className:Me,children:[(0,w.jsx)(gt,{className:ze,children:"NET/EXC/REPL:"}),(0,w.jsxs)(gt,{className:Ge,children:["\u20b9",t.total_amount.toFixed(2)]})]}),l.isPartiallyPaid&&(0,w.jsxs)("div",{className:Ve,children:[(0,w.jsxs)("div",{className:Oe,children:[(0,w.jsx)(gt,{className:Ue,children:"Paid Amount:"}),(0,w.jsxs)(gt,{className:Ye,children:["\u20b9",("number"===typeof l.paidAmount?l.paidAmount:0).toFixed(2)]})]}),(0,w.jsxs)("div",{className:Oe,children:[(0,w.jsx)(gt,{className:Ue,children:"Balance:"}),(0,w.jsxs)(gt,{className:Ye,children:["\u20b9",(t.total_amount-("number"===typeof l.paidAmount?l.paidAmount:0)).toFixed(2)]})]})]})]}),(0,w.jsxs)("div",{className:Ke,children:[(0,w.jsxs)("div",{className:He,children:[(0,w.jsx)(gt,{className:Qe,children:"\ud83d\udcb8 DISCOUNT"}),(0,w.jsxs)("div",{className:We,children:[(0,w.jsx)(x.A,{min:0,value:l.discount,onChange:e=>i(e||0),style:{width:70},size:"small"}),(0,w.jsx)(K.A,{checkedChildren:"%",unCheckedChildren:"\u20b9",checked:"percentage"===l.discountType,onChange:n,size:"small"})]})]}),l.isPartiallyPaid&&(0,w.jsxs)("div",{className:ye,children:[(0,w.jsx)(gt,{className:Xe,children:"\ud83d\udcb0 PARTIAL PAY"}),(0,w.jsx)(x.A,{min:0,max:t.total_amount,value:l.paidAmount,onChange:e=>o(e||0),style:{width:90},size:"small",formatter:e=>"\u20b9".concat(e).replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>Number(e.replace(/\u20b9\s?|(,*)/g,""))})]})]})]})};var ft=l(53986),_t=l(62305),bt=l(47419),jt=l(11645),Ct=l(8354),kt=l(87534),St=l(75388),At=l(46011),wt=l(72411),Dt=l(67177),It=l(15615),Tt=l(53722),Pt=l(71281);const Nt=["create"],{Title:Bt,Text:Rt}=o.A,{Option:Et}=y.A,Ft=e=>{let{visible:t,onSelect:l,onCancel:o}=e;const[d,c]=(0,n.useState)(""),[u,m]=(0,n.useState)(""),[x,y]=(0,n.useState)(1),[g,b]=(0,n.useState)([]),[j,C]=(0,n.useState)(!0),[k,A]=(0,n.useState)(!1),[D,I]=(0,n.useState)(null),[T,N]=(0,n.useState)(-1),[B,R]=(0,n.useState)(!1),[E,F]=(0,n.useState)({full_name:"",email:"",mobile:"",address:"",customer_type:"regular"}),[L]=_t.A.useForm(),M=(0,n.useRef)(null),z=(0,n.useRef)(null),G=(0,n.useRef)(null),V=(0,n.useRef)(null),O=(0,n.useRef)(null),U=(0,n.useRef)(!1),{data:Y,isLoading:K,refetch:H}=S.lh.useGetCustomerQuery({searchString:u,page:x,limit:10},{skip:!t,refetchOnMountOrArgChange:!0}),Q=(0,q.Ib)("Customer").useCreate(),{create:W}=Q,X=(0,ft.A)(Q,Nt),J=X.isLoading;(0,n.useEffect)((()=>{if(t&&Y){var e,l;const t=(null===Y||void 0===Y?void 0:Y.result)||[],i=(null===(e=Y.pagination)||void 0===e?void 0:e.totalCount)||(null===(l=Y.pagination)||void 0===l?void 0:l.total)||0;1===x?(b(t),C(t.length<i&&t.length>0),t.length>0&&(R(!1),A(!1))):(b((e=>{const l=new Set(e.map((e=>e._id))),n=t.filter((e=>!l.has(e._id))),o=[...e,...n];return C(o.length<i&&n.length>0),o})),t.length>0&&(R(!1),A(!1))),U.current=!1}}),[Y,x,t]);const Z=g,$=(0,n.useMemo)((()=>d.trim()&&!K&&0===Z.length),[d,K,Z.length]),ee=(0,n.useCallback)((e=>({vip:"gold",wholesale:"blue",regular:"green"}[e]||"green")),[]),te=(0,n.useCallback)((e=>{if(0===Z.length)return;let t;switch(e){case"up":t=-1===T?Z.length-1:Math.max(T-1,0);break;case"down":t=-1===T?0:Math.min(T+1,Z.length-1);break;case"home":t=0;break;case"end":t=Z.length-1;break;default:return}N(t),I(Z[t]),setTimeout((()=>{const l=document.querySelector('[data-row-key="'.concat(Z[t]._id,'"]'));if(l){const t="home"===e?"start":"end"===e?"end":"nearest";l.scrollIntoView({behavior:"smooth",block:t})}}),100)}),[Z,T]),le=(0,n.useCallback)((e=>{c(e),G.current&&clearTimeout(G.current),G.current=setTimeout((()=>{m(e.trim()),y(1),C(!0),U.current=!1}),300)}),[]),ie=(0,n.useCallback)((e=>{I(e),l(e),setTimeout((()=>o()),100)}),[l,o]),ne=(0,n.useCallback)((()=>{F({full_name:"",email:"",mobile:"",address:"",customer_type:"regular"}),L.resetFields()}),[L]),oe=(0,n.useCallback)((async()=>{try{if(!E.full_name.trim())return void a.Ay.error("Full name is required");if(!E.mobile.trim())return void a.Ay.error("Mobile number is required");const l=await W(E);if(!l.error&&l.data){var e,t;const i=(null===(e=l.data)||void 0===e?void 0:e.data)||(null===(t=l.data)||void 0===t?void 0:t.result)||l.data;i&&(ne(),A(!1),R(!1),H(),setTimeout((()=>{ie(i)}),100))}}catch(l){a.Ay.error("Failed to create customer"),ne()}}),[E,W,ie,ne,H]),ae=(0,n.useCallback)(((e,t)=>{F((l=>(0,i.A)((0,i.A)({},l),{},{[e]:t})))}),[]),re=(0,n.useCallback)((e=>{if("Escape"===e.key)o();else if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();te({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}),[te,o]),se=(0,n.useCallback)((e=>{if(!t)return;const l=e.target;if("INPUT"!==l.tagName&&"TEXTAREA"!==l.tagName&&!l.classList.contains("ant-select-selector")&&!l.closest(".ant-select-dropdown")){if(e.ctrlKey&&"f"===e.key)return e.preventDefault(),e.stopPropagation(),void(M.current&&(M.current.focus(),M.current.select()));if(e.ctrlKey&&"n"===e.key)return e.preventDefault(),e.stopPropagation(),void($&&(R(!0),setTimeout((()=>{if(V.current){const e=V.current.querySelector("input");e&&(e.focus(),e.select())}}),100)));if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();te({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}}),[t,te,$]),de=(0,n.useMemo)((()=>[{title:"",key:"select",width:60,render:(e,t)=>(0,w.jsx)("div",{style:{cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>{I(t);const e=Z.findIndex((e=>e._id===t._id));N(e)},children:(0,w.jsx)("div",{style:{width:"18px",height:"18px",borderRadius:"50%",border:(null===D||void 0===D?void 0:D._id)===t._id?"2px solid #1890ff":"2px solid #d9d9d9",backgroundColor:(null===D||void 0===D?void 0:D._id)===t._id?"#1890ff":"white",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:(null===D||void 0===D?void 0:D._id)===t._id&&(0,w.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"white"}})})})},{title:"Customer Name",dataIndex:"full_name",key:"full_name",render:(e,t)=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,w.jsx)(Rt,{strong:!0,children:e}),(0,w.jsx)(P.A,{color:ee(t.customer_type),children:t.customer_type.toUpperCase()})]})},{title:"Mobile",dataIndex:"mobile",key:"mobile",render:e=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,w.jsx)(kt.A,{style:{color:"#666"}}),(0,w.jsx)(Rt,{children:e})]})},{title:"Email",dataIndex:"email",key:"email",render:e=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,w.jsx)(St.A,{style:{color:"#666"}}),(0,w.jsx)(Rt,{children:e||"-"})]})},{title:"Address",dataIndex:"address",key:"address",render:e=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[(0,w.jsx)(At.A,{style:{color:"#666",marginTop:"2px"}}),(0,w.jsx)(Rt,{type:"secondary",style:{fontSize:"12px"},children:e||"-"})]})}]),[D,Z,ee]),ce=(0,n.useCallback)(((e,t)=>({onClick:()=>{I(e),N(null!==t&&void 0!==t?t:0)},style:{cursor:"pointer",backgroundColor:(null===D||void 0===D?void 0:D._id)===e._id?"#f0f8ff":"white",border:(null===D||void 0===D?void 0:D._id)===e._id?"2px solid #1890ff":"1px solid #f0f0f0",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:t=>{(null===D||void 0===D?void 0:D._id)!==e._id&&(t.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:t=>{(null===D||void 0===D?void 0:D._id)!==e._id&&(t.currentTarget.style.backgroundColor="white")}})),[D]);(0,n.useEffect)((()=>(t?(I(null),N(-1),R(!1),y(1),C(!0),U.current=!1):(c(""),m(""),I(null),N(-1),R(!1),A(!1),ne(),y(1),b([]),C(!0),U.current=!1,G.current&&(clearTimeout(G.current),G.current=null)),()=>{G.current&&clearTimeout(G.current)})),[t,ne]),(0,n.useEffect)((()=>{!$||B||k||R(!0)}),[$,B,k]),(0,n.useEffect)((()=>{if(t&&M.current&&!k&&!B){const e=()=>{M.current&&(M.current.focus(),M.current.select())};e();const t=setTimeout(e,100);return()=>clearTimeout(t)}}),[t,k,B]),(0,n.useEffect)((()=>{if((k||B)&&t){const e=setTimeout((()=>{O.current&&(O.current.focus(),O.current.select())}),100);return()=>clearTimeout(e)}}),[k,B,t]),(0,n.useEffect)((()=>{if(t)return document.addEventListener("keydown",se,!0),()=>document.removeEventListener("keydown",se,!0)}),[t,se]),(0,Pt.z)({action:"create",title:"Customer",mutationResult:X,refetch:H}),(0,n.useEffect)((()=>{J?a.Ay.loading({content:"Creating customer...",key:"customer-creation",duration:0}):a.Ay.destroy("customer-creation")}),[J]);const ue=(0,n.useCallback)((()=>{I(null),N(-1)}),[]);return(0,w.jsxs)(p.A,{title:"Select Customer",open:t,onCancel:o,footer:null,width:1e3,style:{top:20},afterOpenChange:e=>{e&&M.current&&!k&&!B&&setTimeout((()=>{var e,t;null===(e=M.current)||void 0===e||e.focus(),null===(t=M.current)||void 0===t||t.select()}),100)},children:[(0,w.jsx)("div",{ref:z,style:{marginBottom:16},onKeyDown:re,tabIndex:0,children:(0,w.jsxs)(h.A.Compact,{style:{width:"100%"},children:[(0,w.jsx)(v.A,{ref:M,placeholder:"Search customers... (Ctrl+N: New customer, \u2191\u2193: Navigate, Enter: Select, Esc: Close)",value:d,onChange:e=>le(e.target.value),prefix:(0,w.jsx)(wt.A,{}),style:{flex:1},onKeyDown:e=>{"Enter"===e.key&&D&&ie(D)},onFocus:ue,autoFocus:!k&&!B,onBlur:k||B?void 0:()=>{t&&M.current&&setTimeout((()=>{t&&M.current&&!k&&!B&&M.current.focus()}),10)},suffix:d&&K?(0,w.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:"Searching..."}):null}),(0,w.jsx)(r.Ay,{type:k?"default":"primary",icon:(0,w.jsx)(Dt.A,{}),onClick:()=>{const e=!k;A(e),e||ne()},style:{minWidth:120},children:k?"Cancel":"Add New"})]})}),(B||k)&&(0,w.jsxs)("div",{ref:V,style:{marginBottom:20,padding:24,border:"2px solid #6366f1",borderRadius:16,backgroundColor:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",position:"relative",overflow:"hidden"},tabIndex:-1,children:[(0,w.jsx)("div",{style:{position:"absolute",top:-20,right:-20,width:100,height:100,borderRadius:"50%",background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",opacity:.1,zIndex:0}}),(0,w.jsx)("div",{style:{position:"absolute",bottom:-30,left:-30,width:80,height:80,borderRadius:"50%",background:"linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%)",opacity:.1,zIndex:0}}),(0,w.jsxs)(bt.A,{justify:"space-between",align:"middle",style:{marginBottom:24,position:"relative",zIndex:1},children:[(0,w.jsxs)(jt.A,{children:[(0,w.jsxs)(Bt,{level:4,style:{margin:0,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",fontWeight:700,fontSize:"20px"},children:[(0,w.jsx)(_.A,{style:{marginRight:8,color:"#6366f1"}}),"Create New Customer"]}),(0,w.jsx)(Rt,{style:{fontSize:"14px",color:"#64748b",fontWeight:500,display:"block",marginTop:4},children:"\u2728 Fill in the details below to create a new customer"})]}),(0,w.jsx)(jt.A,{children:(0,w.jsxs)(h.A,{size:"middle",children:[(0,w.jsx)(r.Ay,{size:"middle",icon:(0,w.jsx)(It.A,{}),onClick:()=>{R(!1),A(!1),H(),ne()},style:{border:"2px solid #e2e8f0",borderRadius:8,fontWeight:600,color:"#64748b",background:"white",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",height:40,padding:"0 20px"},children:"Cancel"}),(0,w.jsx)(r.Ay,{type:"primary",size:"middle",icon:(0,w.jsx)(s.A,{}),onClick:oe,loading:J,style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",border:"none",borderRadius:8,fontWeight:600,height:40,padding:"0 24px",boxShadow:"0 4px 12px rgba(99, 102, 241, 0.3)",transition:"all 0.3s ease"},children:"Create & Select"})]})})]}),(0,w.jsxs)(_t.A,{form:L,layout:"vertical",size:"middle",style:{position:"relative",zIndex:1},children:[(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20,marginBottom:20},children:[(0,w.jsx)(_t.A.Item,{name:"full_name",label:(0,w.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,w.jsx)(Tt.A,{style:{color:"#6366f1"}}),"Full Name"]}),rules:[{required:!0,message:"Please enter full name"}],children:(0,w.jsx)(v.A,{ref:O,name:"full_name",placeholder:"Enter full name",prefix:(0,w.jsx)(Tt.A,{style:{color:"#9ca3af"}}),autoFocus:k||B,value:E.full_name,onChange:e=>ae("full_name",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),oe())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white"}})}),(0,w.jsx)(_t.A.Item,{name:"mobile",label:(0,w.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,w.jsx)(kt.A,{style:{color:"#10b981"}}),"Mobile Number"]}),rules:[{required:!0,message:"Please enter mobile number"},{pattern:/^[0-9]{10}$/,message:"Mobile must be 10 digits"}],children:(0,w.jsx)(v.A,{name:"mobile",placeholder:"Enter mobile number",prefix:(0,w.jsx)(kt.A,{style:{color:"#9ca3af"}}),value:E.mobile,onChange:e=>ae("mobile",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),oe())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white"}})}),(0,w.jsx)(_t.A.Item,{name:"email",label:(0,w.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,w.jsx)(St.A,{style:{color:"#f59e0b"}}),"Email"]}),rules:[{type:"email",message:"Please enter valid email"}],children:(0,w.jsx)(v.A,{name:"email",placeholder:"Enter email",prefix:(0,w.jsx)(St.A,{style:{color:"#9ca3af"}}),value:E.email,onChange:e=>ae("email",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),oe())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white"}})})]}),(0,w.jsx)(_t.A.Item,{name:"address",label:(0,w.jsxs)("span",{style:{fontWeight:600,color:"#374151",fontSize:"14px",display:"flex",alignItems:"center",gap:6},children:[(0,w.jsx)(At.A,{style:{color:"#ef4444"}}),"Address"]}),children:(0,w.jsx)(v.A.TextArea,{name:"address",placeholder:"Enter address",rows:3,value:E.address,onChange:e=>ae("address",e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),oe())},style:{borderRadius:10,border:"2px solid #e5e7eb",padding:"12px 16px",fontSize:"14px",transition:"all 0.3s ease",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)",background:"white",resize:"none"}})})]})]}),(0,w.jsx)(Ct.A,{style:{margin:"16px 0"}}),(0,w.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:K?(0,w.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,w.jsx)(Rt,{children:"Loading customers..."})}):0===Z.length?(0,w.jsxs)("div",{style:{textAlign:"center",padding:40},children:[(0,w.jsx)(Rt,{type:"secondary",children:d?"No customers found matching your search.":"No customers available."}),d&&(0,w.jsx)("div",{style:{marginTop:16},children:(0,w.jsx)(Rt,{type:"secondary",children:"Press Ctrl+N to create a new customer instantly"})})]}):(0,w.jsxs)("div",{onScroll:e=>{const t=e.currentTarget,l=t.scrollTop,i=t.scrollHeight;(l+t.clientHeight)/i>.7&&j&&!K&&!U.current&&(U.current=!0,y((e=>e+1)))},style:{maxHeight:360,overflowY:"auto"},children:[(0,w.jsx)(f.A,{columns:de,dataSource:Z,rowKey:"_id",pagination:!1,size:"small",scroll:{y:void 0},onRow:ce}),j&&Z.length>0&&(0,w.jsx)("div",{style:{textAlign:"center",padding:"8px",color:"#999",borderTop:"1px solid #f0f0f0"},children:K?"Loading more...":"Scroll for more customers"})]})})]})},Lt=n.memo(Ft);var Mt=l(85192);const{Text:zt}=o.A,Gt=e=>{let{visible:t,onSelect:l,onCancel:i}=e;const[o,a]=(0,n.useState)(""),[r,s]=(0,n.useState)(""),[d,c]=(0,n.useState)(1),[u,m]=(0,n.useState)([]),[x,y]=(0,n.useState)(!0),[g,h]=(0,n.useState)(null),[_,b]=(0,n.useState)(-1),j=(0,n.useRef)(null),C=(0,n.useRef)(null),k=(0,n.useRef)(null),A=(0,n.useRef)(!1),{data:D,isLoading:I}=S.lh.useGetVendorQuery({searchString:r,page:d,limit:10},{skip:!t,refetchOnMountOrArgChange:!0});(0,n.useEffect)((()=>{if(t&&D){var e,l;const t=(null===D||void 0===D?void 0:D.result)||[],i=(null===(e=D.pagination)||void 0===e?void 0:e.totalCount)||(null===(l=D.pagination)||void 0===l?void 0:l.total)||0;1===d?(m(t),y(t.length<i&&t.length>0)):m((e=>{const l=new Set(e.map((e=>e._id))),n=t.filter((e=>!l.has(e._id))),o=[...e,...n];return y(o.length<i&&n.length>0),o})),A.current=!1}}),[D,d,t]);const T=u,N=(0,n.useCallback)((e=>({premium:"gold",wholesale:"blue",regular:"green"}[e||"regular"]||"green")),[]);(0,n.useEffect)((()=>{if(t&&o!==r)return k.current&&clearTimeout(k.current),k.current=setTimeout((()=>{s(o),c(1),m([]),y(!0),A.current=!1}),300),()=>{k.current&&clearTimeout(k.current)}}),[o,r,t]),(0,n.useEffect)((()=>{t?(c(1),y(!0),A.current=!1):(a(""),s(""),c(1),m([]),y(!0),A.current=!1)}),[t]);const B=(0,n.useCallback)((e=>{a(e),h(null),b(-1)}),[]);(0,n.useEffect)((()=>{t&&j.current&&setTimeout((()=>{var e,t;null===(e=j.current)||void 0===e||e.focus(),null===(t=j.current)||void 0===t||t.select()}),100)}),[t]),(0,n.useEffect)((()=>{t||(a(""),s(""),h(null),b(-1))}),[t]);const R=(0,n.useCallback)((e=>{if(0===T.length)return;let t=_;"up"===e?t=_<=0?T.length-1:_-1:"down"===e?t=_>=T.length-1?0:_+1:"first"===e?t=0:"last"===e&&(t=T.length-1),b(t),h(T[t]),setTimeout((()=>{const e=document.querySelector(".vendor-selection-table .ant-table-row-selected");e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}),0)}),[T,_]),E=(0,n.useCallback)((e=>{l(e),i()}),[l,i]),F=(0,n.useCallback)((e=>{"ArrowDown"===e.key?(e.preventDefault(),R("down")):"ArrowUp"===e.key?(e.preventDefault(),R("up")):"Home"===e.key?(e.preventDefault(),R("first")):"End"===e.key?(e.preventDefault(),R("last")):"Enter"===e.key&&g?(e.preventDefault(),E(g)):"Escape"===e.key&&(e.preventDefault(),i())}),[R,g,E,i]),L=(0,n.useMemo)((()=>[{title:"",key:"select",width:60,render:(e,t)=>(0,w.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"},children:(0,w.jsx)("div",{style:{width:"24px",height:"24px",borderRadius:"50%",border:"2px solid #6366f1",backgroundColor:(null===g||void 0===g?void 0:g._id)===t._id?"#6366f1":"transparent",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:(null===g||void 0===g?void 0:g._id)===t._id&&(0,w.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"white"}})})})},{title:"Vendor Name",dataIndex:"vendor_name",key:"vendor_name",render:(e,t)=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,w.jsx)(Mt.A,{style:{color:"#6366f1"}}),(0,w.jsx)(zt,{strong:!0,children:e}),t.vendor_type&&(0,w.jsx)(P.A,{color:N(t.vendor_type),children:t.vendor_type.toUpperCase()})]})},{title:"Contact Number",dataIndex:"contact_number",key:"contact_number",render:e=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,w.jsx)(kt.A,{style:{color:"#666"}}),(0,w.jsx)(zt,{children:e||"-"})]})},{title:"Email",dataIndex:"email",key:"email",render:e=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,w.jsx)(St.A,{style:{color:"#666"}}),(0,w.jsx)(zt,{children:e||"-"})]})},{title:"Address",dataIndex:"address",key:"address",render:e=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:[(0,w.jsx)(At.A,{style:{color:"#666",marginTop:"2px"}}),(0,w.jsx)(zt,{type:"secondary",style:{fontSize:"12px"},children:e||"-"})]})}]),[g,N]),M=(0,n.useCallback)(((e,t)=>({onClick:()=>{h(e),b(null!==t&&void 0!==t?t:-1)},onDoubleClick:()=>E(e),style:{cursor:"pointer",backgroundColor:(null===g||void 0===g?void 0:g._id)===e._id?"#f0f5ff":"transparent"},className:(null===g||void 0===g?void 0:g._id)===e._id?"ant-table-row-selected":""})),[g,E]),z=(0,n.useCallback)((()=>{h(null),b(-1)}),[]);return(0,w.jsxs)(p.A,{title:(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,w.jsx)(Mt.A,{style:{color:"#6366f1",fontSize:18}}),(0,w.jsx)("span",{children:"Select Vendor"})]}),open:t,onCancel:i,footer:null,width:1e3,style:{top:20},afterOpenChange:e=>{e&&j.current&&setTimeout((()=>{var e,t;null===(e=j.current)||void 0===e||e.focus(),null===(t=j.current)||void 0===t||t.select()}),100)},children:[(0,w.jsx)("div",{ref:C,style:{marginBottom:16},onKeyDown:F,tabIndex:0,children:(0,w.jsx)(v.A,{ref:j,placeholder:"Search vendors... (Click to highlight, Double-click or Enter to select)",value:o,onChange:e=>B(e.target.value),prefix:(0,w.jsx)(wt.A,{}),style:{width:"100%"},onFocus:z,autoFocus:!0,suffix:o&&I?(0,w.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:"Searching..."}):null})}),(0,w.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:I?(0,w.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,w.jsx)(zt,{children:"Loading vendors..."})}):0===T.length?(0,w.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,w.jsx)(zt,{type:"secondary",children:o?"No vendors found matching your search.":"No vendors available."})}):(0,w.jsxs)("div",{onScroll:e=>{const t=e.currentTarget,l=t.scrollTop,i=t.scrollHeight;(l+t.clientHeight)/i>.7&&x&&!I&&!A.current&&(A.current=!0,c((e=>e+1)))},style:{maxHeight:360,overflowY:"auto"},children:[(0,w.jsx)(f.A,{columns:L,dataSource:T,rowKey:"_id",pagination:!1,size:"small",scroll:{y:void 0},onRow:M,className:"vendor-selection-table"}),x&&T.length>0&&(0,w.jsx)("div",{style:{textAlign:"center",padding:"8px",color:"#999",borderTop:"1px solid #f0f0f0"},children:I?"Loading more...":"Scroll for more vendors"})]})}),(0,w.jsx)("div",{style:{marginTop:16,padding:12,backgroundColor:"#f0f5ff",borderRadius:8,fontSize:"12px"},children:(0,w.jsxs)(zt,{type:"secondary",children:[(0,w.jsx)("strong",{children:"Shortcuts:"})," Click to highlight \u2022 Double-click or Enter to select \u2022 \u2191\u2193 Navigate \u2022 Esc Close \u2022 Home/End First/Last"]})})]})},qt=n.memo(Gt),{Title:Vt,Text:Ot}=o.A,Ut=e=>{let{visible:t,onSelect:l,onCancel:i}=e;const[o,a]=(0,n.useState)(""),[r,s]=(0,n.useState)(""),[d,c]=(0,n.useState)(1),[u,m]=(0,n.useState)([]),[x,y]=(0,n.useState)(!0),[g,h]=(0,n.useState)(null),[_,b]=(0,n.useState)(-1),j=(0,n.useMemo)((()=>(0,N.HW)()),[]),C=(0,n.useRef)(null),k=(0,n.useRef)(null),A=(0,n.useRef)(null),D=(0,n.useRef)(!1),{data:I,isLoading:T}=S.lh.useGetBillingUsersQuery({searchString:r,page:d,limit:10},{skip:!t,refetchOnMountOrArgChange:!0});(0,n.useEffect)((()=>{if(t&&I){var e,l;const t=(null===I||void 0===I?void 0:I.result)||[],i=(null===(e=I.pagination)||void 0===e?void 0:e.totalCount)||(null===(l=I.pagination)||void 0===l?void 0:l.total)||0;1===d?(m(t),y(t.length<i&&t.length>0)):m((e=>{const l=new Set(e.map((e=>e._id))),n=t.filter((e=>!l.has(e._id))),o=[...e,...n];return y(o.length<i&&n.length>0),o})),D.current=!1}}),[I,d,t]);const B=u;(0,n.useEffect)((()=>{if(t&&o!==r)return A.current&&clearTimeout(A.current),A.current=setTimeout((()=>{s(o),c(1),m([]),y(!0),D.current=!1}),300),()=>{A.current&&clearTimeout(A.current)}}),[o,r,t]),(0,n.useEffect)((()=>{t?(c(1),y(!0),D.current=!1):(a(""),s(""),c(1),m([]),y(!0),D.current=!1)}),[t]);const R=(0,n.useCallback)((e=>{if(0===B.length)return;let t;switch(e){case"up":t=-1===_?B.length-1:Math.max(_-1,0);break;case"down":t=-1===_?0:Math.min(_+1,B.length-1);break;case"home":t=0;break;case"end":t=B.length-1;break;default:return}b(t),h(B[t]),setTimeout((()=>{const l=document.querySelector('[data-row-key="'.concat(B[t]._id,'"]'));if(l){const t="home"===e?"start":"end"===e?"end":"nearest";l.scrollIntoView({behavior:"smooth",block:t})}}),100)}),[B,_]),E=(0,n.useCallback)((e=>{a(e),A.current&&clearTimeout(A.current)}),[]),F=(0,n.useCallback)((e=>{h(e),l(e),setTimeout((()=>i()),100)}),[l,i]),L=(0,n.useCallback)((e=>{if("Escape"===e.key)i();else if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();R({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}),[R,i]),M=(0,n.useCallback)((e=>{if(!t)return;const l=e.target;if("INPUT"!==l.tagName&&"TEXTAREA"!==l.tagName&&!l.classList.contains("ant-select-selector")&&!l.closest(".ant-select-dropdown")){if(e.ctrlKey&&"f"===e.key)return e.preventDefault(),e.stopPropagation(),void(C.current&&(C.current.focus(),C.current.select()));if(["ArrowDown","ArrowUp","Home","End"].includes(e.key)){e.preventDefault(),e.stopPropagation();R({ArrowDown:"down",ArrowUp:"up",Home:"home",End:"end"}[e.key])}}}),[t,R]),z=(0,n.useMemo)((()=>[{title:"",key:"select",width:60,render:(e,t)=>(0,w.jsx)("div",{style:{cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>{h(t);const e=B.findIndex((e=>e._id===t._id));b(e)},children:(0,w.jsx)("div",{style:{width:"18px",height:"18px",borderRadius:"50%",border:(null===g||void 0===g?void 0:g._id)===t._id?"2px solid #1890ff":"2px solid #d9d9d9",backgroundColor:(null===g||void 0===g?void 0:g._id)===t._id?"#1890ff":"white",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:(null===g||void 0===g?void 0:g._id)===t._id&&(0,w.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"white"}})})})},{title:"Name",dataIndex:"name",key:"name",render:(e,t)=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,w.jsx)(Tt.A,{style:{color:"#1890ff"}}),(0,w.jsxs)("div",{children:[(0,w.jsx)(Ot,{strong:!0,children:e}),(0,w.jsx)("br",{}),(0,w.jsxs)(Ot,{type:"secondary",style:{fontSize:"12px"},children:["@",t.user_name]})]})]})},{title:"Role",key:"role",render:(e,t)=>{var l;return(0,w.jsx)(P.A,{color:"blue",children:(null===(l=t.roleItems)||void 0===l?void 0:l.name)||"No Role"})}},{title:"Mobile",dataIndex:"mobile",key:"mobile",render:e=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,w.jsx)(kt.A,{style:{color:"#666"}}),(0,w.jsx)(Ot,{children:e})]})},{title:"Email",dataIndex:"email",key:"email",render:e=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,w.jsx)(St.A,{style:{color:"#666"}}),(0,w.jsx)(Ot,{children:e||"-"})]})},{title:"Branch",key:"branch",render:(e,t)=>{var l;return(0,w.jsx)(Ot,{type:"secondary",style:{fontSize:"12px"},children:(null===(l=t.branchItems)||void 0===l?void 0:l.branch_name)||"-"})}}]),[g,B]),G=(0,n.useCallback)(((e,t)=>({onClick:()=>{h(e),b(null!==t&&void 0!==t?t:0)},style:{cursor:"pointer",backgroundColor:(null===g||void 0===g?void 0:g._id)===e._id?"#f0f8ff":"white",border:(null===g||void 0===g?void 0:g._id)===e._id?"2px solid #1890ff":"1px solid #f0f0f0",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:t=>{(null===g||void 0===g?void 0:g._id)!==e._id&&(t.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:t=>{(null===g||void 0===g?void 0:g._id)!==e._id&&(t.currentTarget.style.backgroundColor="white")}})),[g]);(0,n.useEffect)((()=>(t?(h(null),b(-1)):(a(""),h(null),b(-1),A.current&&(clearTimeout(A.current),A.current=null)),()=>{A.current&&clearTimeout(A.current)})),[t]),(0,n.useEffect)((()=>{if(t&&B.length>0&&null!==j&&void 0!==j&&j._id&&!g){const e=B.find((e=>e._id===j._id));if(e){h(e);const t=B.findIndex((e=>e._id===j._id));b(t),setTimeout((()=>{const t=document.querySelector('[data-row-key="'.concat(e._id,'"]'));t&&t.scrollIntoView({behavior:"smooth",block:"center"})}),200)}}}),[t,B,null===j||void 0===j?void 0:j._id,g]),(0,n.useEffect)((()=>{if(t&&C.current){const e=()=>{C.current&&(C.current.focus(),C.current.select())};e();const t=setTimeout(e,100);return()=>clearTimeout(t)}}),[t]),(0,n.useEffect)((()=>{if(t)return document.addEventListener("keydown",M,!0),()=>document.removeEventListener("keydown",M,!0)}),[t,M]);const q=(0,n.useCallback)((()=>{h(null),b(-1)}),[]);return(0,w.jsxs)(p.A,{title:"Select User (Billed By)",open:t,onCancel:i,footer:null,width:900,style:{top:20},afterOpenChange:e=>{e&&C.current&&setTimeout((()=>{var e,t;null===(e=C.current)||void 0===e||e.focus(),null===(t=C.current)||void 0===t||t.select()}),100)},children:[(0,w.jsx)("div",{ref:k,style:{marginBottom:16},onKeyDown:L,tabIndex:0,children:(0,w.jsx)(v.A,{ref:C,placeholder:"Search users... (\u2191\u2193: Navigate, Enter: Select, Esc: Close)",value:o,onChange:e=>E(e.target.value),prefix:(0,w.jsx)(wt.A,{}),style:{width:"100%"},onKeyDown:e=>{"Enter"===e.key&&g&&F(g)},onFocus:q,autoFocus:!0,onBlur:()=>{t&&C.current&&setTimeout((()=>{t&&C.current&&C.current.focus()}),10)},suffix:o&&T?(0,w.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:"Searching..."}):null})}),(0,w.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:T?(0,w.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,w.jsx)(Ot,{children:"Loading users..."})}):0===B.length?(0,w.jsx)("div",{style:{textAlign:"center",padding:40},children:(0,w.jsx)(Ot,{type:"secondary",children:o?"No users found matching your search.":"No users available."})}):(0,w.jsxs)("div",{onScroll:e=>{const t=e.currentTarget,l=t.scrollTop,i=t.scrollHeight;(l+t.clientHeight)/i>.7&&x&&!T&&!D.current&&(D.current=!0,c((e=>e+1)))},style:{maxHeight:360,overflowY:"auto"},children:[(0,w.jsx)(f.A,{columns:z,dataSource:B,rowKey:"_id",pagination:!1,size:"small",scroll:{y:void 0},onRow:G}),x&&B.length>0&&(0,w.jsx)("div",{style:{textAlign:"center",padding:"8px",color:"#999",borderTop:"1px solid #f0f0f0"},children:T?"Loading more...":"Scroll for more users"})]})})]})};var Yt=l(37490),Kt=l(6881),Ht=l(76401),Qt=l(34193);const{Title:Wt,Text:Xt}=o.A,Jt=e=>{let{visible:t,onNewBill:l,onContinueBill:i,onCancel:o,savedBillData:a,onOpenProductModal:s}=e;const c=(0,n.useRef)(null),u=(0,n.useCallback)((()=>{l(),s&&setTimeout((()=>{s()}),100)}),[l,s]);return(0,n.useEffect)((()=>{if(!t)return;const e=e=>{"Enter"!==e.key||e.ctrlKey?"Enter"===e.key&&e.ctrlKey?(e.preventDefault(),i()):"Escape"===e.key&&(e.preventDefault(),o()):(e.preventDefault(),u())};return window.addEventListener("keydown",e),c.current&&c.current.focus(),()=>window.removeEventListener("keydown",e)}),[t,u,i,o]),(0,w.jsxs)(p.A,{title:null,open:t,onCancel:o,footer:null,width:540,centered:!0,maskClosable:!1,closable:!1,bodyStyle:{padding:"24px 20px"},children:[(0,w.jsxs)("div",{style:{textAlign:"center",marginBottom:"20px"},children:[(0,w.jsx)("div",{style:{display:"inline-block",animation:"successPulse 0.6s ease-out",marginBottom:"12px"},children:(0,w.jsx)(E.A,{style:{color:"#10b981",fontSize:"48px",filter:"drop-shadow(0 4px 12px rgba(16, 185, 129, 0.3))"}})}),(0,w.jsx)(Wt,{level:4,style:{margin:"6px 0",color:"#10b981",fontWeight:700},children:"Bill Saved Successfully!"}),(0,w.jsx)(Xt,{type:"secondary",style:{fontSize:"13px"},children:"Choose your next action using keyboard shortcuts"})]}),a&&(0,w.jsxs)("div",{style:{background:"linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)",border:"2px solid #10b981",borderRadius:"10px",padding:"14px",marginBottom:"20px",boxShadow:"0 4px 16px rgba(16, 185, 129, 0.1)"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"12px"},children:[(0,w.jsx)(d.A,{style:{fontSize:"16px",color:"#059669",marginRight:"6px"}}),(0,w.jsx)(Wt,{level:5,style:{margin:0,color:"#059669",fontSize:"14px"},children:"Bill Summary"})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 10px",background:"rgba(255, 255, 255, 0.7)",borderRadius:"6px"},children:[(0,w.jsx)(d.A,{style:{color:"#10b981",fontSize:"14px"}}),(0,w.jsxs)("div",{children:[(0,w.jsx)(Xt,{type:"secondary",style:{fontSize:"10px",display:"block"},children:"Invoice"}),(0,w.jsx)(Xt,{strong:!0,style:{fontSize:"12px"},children:a.invoice_no})]})]}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 10px",background:"rgba(255, 255, 255, 0.7)",borderRadius:"6px"},children:[(0,w.jsx)(Tt.A,{style:{color:"#10b981",fontSize:"14px"}}),(0,w.jsxs)("div",{children:[(0,w.jsx)(Xt,{type:"secondary",style:{fontSize:"10px",display:"block"},children:"Customer"}),(0,w.jsx)(Xt,{strong:!0,style:{fontSize:"12px"},children:a.customer_name||"N/A"})]})]}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 10px",background:"rgba(255, 255, 255, 0.7)",borderRadius:"6px"},children:[(0,w.jsx)(Kt.A,{style:{color:"#10b981",fontSize:"14px"}}),(0,w.jsxs)("div",{children:[(0,w.jsx)(Xt,{type:"secondary",style:{fontSize:"10px",display:"block"},children:"Date"}),(0,w.jsx)(Xt,{strong:!0,style:{fontSize:"12px"},children:C()(a.date).format("DD/MM/YYYY")})]})]}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 10px",background:"rgba(255, 255, 255, 0.7)",borderRadius:"6px"},children:[(0,w.jsx)(Ht.A,{style:{color:"#10b981",fontSize:"14px"}}),(0,w.jsxs)("div",{children:[(0,w.jsx)(Xt,{type:"secondary",style:{fontSize:"10px",display:"block"},children:"Amount"}),(0,w.jsxs)(Xt,{strong:!0,style:{fontSize:"12px",color:"#059669"},children:["\u20b9",("number"===typeof a.total_amount?a.total_amount:parseFloat(a.total_amount)||0).toFixed(2)]})]})]})]})]}),(0,w.jsx)(Ct.A,{style:{margin:"18px 0",borderColor:"#e5e7eb"}}),(0,w.jsxs)(h.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,w.jsxs)(r.Ay,{ref:c,type:"primary",size:"large",icon:(0,w.jsx)(_.A,{}),onClick:u,style:{width:"100%",height:"48px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",fontWeight:600,fontSize:"15px",borderRadius:"8px",boxShadow:"0 4px 16px rgba(16, 185, 129, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",transition:"all 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(16, 185, 129, 0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 4px 16px rgba(16, 185, 129, 0.3)"},children:[(0,w.jsx)("span",{style:{flex:1,textAlign:"left",marginLeft:"8px"},children:"\ud83c\udd95 Create New Bill"}),(0,w.jsx)(Yt.A,{count:(0,w.jsxs)("span",{style:{background:"rgba(255, 255, 255, 0.3)",padding:"3px 8px",borderRadius:"5px",fontSize:"11px",fontWeight:600,color:"white",display:"flex",alignItems:"center",gap:"3px"},children:[(0,w.jsx)(Qt.A,{})," Enter"]}),style:{marginRight:"6px"}})]}),(0,w.jsxs)(r.Ay,{size:"large",icon:(0,w.jsx)(d.A,{}),onClick:i,style:{width:"100%",height:"48px",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",color:"white",border:"none",fontWeight:600,fontSize:"15px",borderRadius:"8px",boxShadow:"0 4px 16px rgba(59, 130, 246, 0.3)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",transition:"all 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 6px 20px rgba(59, 130, 246, 0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 4px 16px rgba(59, 130, 246, 0.3)"},children:[(0,w.jsx)("span",{style:{flex:1,textAlign:"left",marginLeft:"8px"},children:"\ud83d\udcdd Continue with Current Bill"}),(0,w.jsx)(Yt.A,{count:(0,w.jsxs)("span",{style:{background:"rgba(255, 255, 255, 0.3)",padding:"3px 8px",borderRadius:"5px",fontSize:"11px",fontWeight:600,color:"white",display:"flex",alignItems:"center",gap:"3px"},children:["Ctrl+",(0,w.jsx)(Qt.A,{})]}),style:{marginRight:"6px"}})]}),(0,w.jsx)(r.Ay,{size:"middle",icon:(0,w.jsx)(It.A,{}),onClick:o,type:"text",style:{width:"100%",height:"36px",fontWeight:500,fontSize:"13px",color:"#6b7280",transition:"all 0.3s ease"},onMouseEnter:e=>{e.currentTarget.style.color="#374151",e.currentTarget.style.background="#f3f4f6"},onMouseLeave:e=>{e.currentTarget.style.color="#6b7280",e.currentTarget.style.background="transparent"},children:"Close (ESC)"})]}),(0,w.jsx)("div",{style:{marginTop:"16px",padding:"10px 12px",background:"linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)",borderRadius:"6px",border:"1px solid #fbbf24"},children:(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,w.jsx)("span",{style:{fontSize:"14px"},children:"\u2328\ufe0f"}),(0,w.jsx)("div",{style:{flex:1},children:(0,w.jsxs)(Xt,{style:{fontSize:"11px",color:"#78350f",lineHeight:"1.5"},children:[(0,w.jsx)("strong",{children:"Enter"})," = New Bill \u2022 ",(0,w.jsx)("strong",{children:"Ctrl+Enter"})," = Continue \u2022 ",(0,w.jsx)("strong",{children:"ESC"})," = Close"]})})]})}),(0,w.jsx)("style",{children:"\n        @keyframes successPulse {\n          0% {\n            transform: scale(0);\n            opacity: 0;\n          }\n          50% {\n            transform: scale(1.1);\n          }\n          100% {\n            transform: scale(1);\n            opacity: 1;\n          }\n        }\n      "})]})};var Zt=l(48677),$t=l(98105),el=l(91686),tl=l(99472),ll=l(54522),il=l(45964),nl=l(61118);const{Title:ol,Text:al}=o.A,{Search:rl}=v.A,sl=e=>{let{visible:t,onClose:l,onViewBill:i,onNewBill:o}=e;const{data:a,isLoading:s}=S.lh.useGetSalesRecordQuery({},{skip:!t}),c=(0,n.useMemo)((()=>(null===a||void 0===a?void 0:a.result)||[]),[a]),[m,p]=(0,n.useState)(""),[v,x]=(0,n.useState)("drafts"),y=(0,n.useMemo)((()=>{if(!c||!Array.isArray(c))return[];let e=c;if(e="drafts"===v?c.filter((e=>"draft"===e.status)):c.filter((e=>!e.status||"completed"===e.status)),!m)return e;const t=m.toLowerCase();return e.filter((e=>{var l;const i=e.invoice_no||"",n=(null===(l=e.customerDetails)||void 0===l?void 0:l.full_name)||"",o=e.date||"",a="number"===typeof e.total_amount?e.total_amount.toString():String(e.total_amount||"");return i.toLowerCase().includes(t)||n.toLowerCase().includes(t)||o.includes(m)||a.includes(m)}))}),[c,m,v]),g=(e,t)=>e&&!t?"Paid":t?"Partial":"Unpaid",f=e=>{i(e),l()},b=()=>{o(),l()};return(0,w.jsxs)(Zt.A,{title:(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,w.jsx)(ol,{level:4,style:{margin:0,color:"#1f2937"},children:"\ud83d\udccb Bill List"}),(0,w.jsx)(r.Ay,{type:"text",icon:(0,w.jsx)(It.A,{}),onClick:l,size:"small"})]}),placement:"left",open:t,onClose:l,width:400,bodyStyle:{padding:"16px"},headerStyle:{borderBottom:"1px solid #e5e7eb",padding:"16px 16px 12px 16px"},children:[(0,w.jsx)("div",{style:{marginBottom:"16px"},children:(0,w.jsxs)(h.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,w.jsx)(rl,{placeholder:"Search bills by invoice, customer, date...",value:m,onChange:e=>p(e.target.value),prefix:(0,w.jsx)(wt.A,{}),allowClear:!0,size:"large"}),(0,w.jsx)(r.Ay,{type:"primary",icon:(0,w.jsx)(_.A,{}),onClick:b,style:{width:"100%",height:"40px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",fontWeight:600,borderRadius:"8px"},children:"\ud83c\udd95 Create New Bill"})]})}),(0,w.jsx)(Ct.A,{style:{margin:"16px 0"}}),(0,w.jsx)($t.A,{activeKey:v,onChange:x,items:[{key:"drafts",label:(0,w.jsxs)("span",{children:["\ud83d\udcdd Drafts (",(null===c||void 0===c?void 0:c.filter((e=>"draft"===e.status)).length)||0,")"]})},{key:"completed",label:(0,w.jsxs)("span",{children:["\u2705 Completed (",(null===c||void 0===c?void 0:c.filter((e=>!e.status||"completed"===e.status)).length)||0,")"]})}],style:{marginBottom:16}}),(0,w.jsx)("div",{style:{height:"calc(100vh - 250px)",overflow:"auto"},children:s?(0,w.jsxs)("div",{style:{textAlign:"center",padding:"40px"},children:[(0,w.jsx)(el.A,{size:"large"}),(0,w.jsx)("div",{style:{marginTop:"16px"},children:(0,w.jsx)(al,{type:"secondary",children:"Loading bills..."})})]}):0===y.length?(0,w.jsx)(tl.A,{description:(0,w.jsxs)("div",{children:[(0,w.jsx)(al,{type:"secondary",children:m?"No bills found matching your search.":"No bills available."}),!m&&(0,w.jsx)("div",{style:{marginTop:"8px"},children:(0,w.jsx)(r.Ay,{type:"link",onClick:b,children:"Create your first bill"})})]}),style:{marginTop:"40px"}}):(0,w.jsx)(ll.A,{dataSource:y,renderItem:e=>{var t,l,i;return(0,w.jsx)(ll.A.Item,{style:{padding:"16px",border:"1px solid #e5e7eb",borderRadius:"8px",marginBottom:"12px",background:"white",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)",e.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="none",e.currentTarget.style.transform="translateY(0)"},onClick:()=>f(e),children:(0,w.jsxs)("div",{style:{width:"100%"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,w.jsx)(il.A,{icon:(0,w.jsx)(d.A,{}),style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white"}}),(0,w.jsx)(al,{strong:!0,style:{fontSize:"14px"},children:e.invoice_no})]}),(0,w.jsxs)(h.A,{children:["draft"===e.status?(0,w.jsx)(P.A,{color:"orange",children:"DRAFT"}):(0,w.jsx)(P.A,{color:"green",children:"COMPLETED"}),(0,w.jsx)(P.A,{color:(l=e.is_paid,i=e.is_partially_paid,l&&!i?"success":i?"warning":"error"),children:g(e.is_paid,e.is_partially_paid)})]})]}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px"},children:[(0,w.jsx)(Tt.A,{style:{color:"#6b7280",fontSize:"12px"}}),(0,w.jsx)(al,{style:{fontSize:"12px",color:"#374151"},children:(null===(t=e.customerDetails)||void 0===t?void 0:t.full_name)||e.customer_name||"N/A"})]}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,w.jsx)(Kt.A,{style:{color:"#6b7280",fontSize:"12px"}}),(0,w.jsx)(al,{style:{fontSize:"12px",color:"#6b7280"},children:e.date?C()(e.date).format("DD/MM/YYYY"):"N/A"})]}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,w.jsx)(Ht.A,{style:{color:"#10b981",fontSize:"12px"}}),(0,w.jsxs)(al,{strong:!0,style:{fontSize:"14px",color:"#10b981"},children:["\u20b9",("number"===typeof e.total_amount?e.total_amount:parseFloat(e.total_amount)||0).toFixed(2)]})]})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"12px",justifyContent:"flex-end"},children:[(0,w.jsx)(T.A,{title:"View Bill",children:(0,w.jsx)(r.Ay,{type:"text",icon:(0,w.jsx)(nl.A,{}),size:"small",onClick:t=>{t.stopPropagation(),f(e)},style:{color:"#3b82f6"}})}),"draft"!==e.status&&(0,w.jsx)(T.A,{title:"Print Bill",children:(0,w.jsx)(r.Ay,{type:"text",icon:(0,w.jsx)(u.A,{}),size:"small",onClick:e=>{e.stopPropagation()},style:{color:"#10b981"}})})]})]})})},pagination:!1})}),(0,w.jsx)("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:"16px",background:"white",borderTop:"1px solid #e5e7eb"},children:(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)(al,{type:"secondary",style:{fontSize:"12px"},children:["Total Bills: ",y.length]}),(0,w.jsx)(al,{type:"secondary",style:{fontSize:"12px"},children:"\ud83d\udca1 Click on any bill to view details"})]})})]})};var dl=l(20691);const{Title:cl,Text:ul}=o.A,ml=e=>{var t,l,i,o,a,r,s;let{visible:d,onCancel:c,productId:u}=e;const[m,v]=(0,n.useState)(null),{data:x,isLoading:y}=S.lh.useGetProductQuery({_id:u},{skip:!d||!u});(0,n.useEffect)((()=>{if(d&&u&&x){const e=(null===x||void 0===x?void 0:x.result)||[],t=Array.isArray(e)?e.find((e=>e._id===u)):null;t&&v(t)}}),[d,u,x]);const g=()=>{v(null),c()};return m?(0,w.jsx)(p.A,{title:(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,w.jsx)("span",{children:"\ud83d\udce6 Product Details"}),(0,w.jsx)(P.A,{color:"blue",style:{margin:0},children:m.sku})]}),open:d,onCancel:g,footer:null,width:700,destroyOnClose:!0,children:(0,w.jsxs)("div",{style:{padding:"16px 0"},children:[(0,w.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,w.jsx)(cl,{level:4,style:{margin:"0 0 8px 0",color:"#1890ff"},children:m.name}),(null===(t=m.VariantItem)||void 0===t?void 0:t.variant_name)&&(0,w.jsxs)(P.A,{color:"green",style:{fontSize:"12px"},children:["Variant: ",m.VariantItem.variant_name]})]}),(0,w.jsx)(Ct.A,{style:{margin:"16px 0"}}),(0,w.jsxs)(dl.A,{title:"Product Information",column:2,size:"small",bordered:!0,style:{marginBottom:"24px"},children:[(0,w.jsx)(dl.A.Item,{label:"Product Name",span:2,children:(0,w.jsx)(ul,{strong:!0,children:m.name})}),(null===(l=m.VariantItem)||void 0===l?void 0:l.variant_name)&&(0,w.jsx)(dl.A.Item,{label:"Variant Name",children:(0,w.jsx)(ul,{children:m.VariantItem.variant_name})}),(null===(i=m.VariantItem)||void 0===i?void 0:i.variant_code)&&(0,w.jsx)(dl.A.Item,{label:"Variant Code",children:(0,w.jsx)(ul,{code:!0,children:m.VariantItem.variant_code})}),(0,w.jsx)(dl.A.Item,{label:"SKU",children:(0,w.jsx)(ul,{code:!0,children:m.sku})}),m.brand&&(0,w.jsx)(dl.A.Item,{label:"Brand",children:(0,w.jsx)(ul,{children:m.brand})}),m.unit&&(0,w.jsx)(dl.A.Item,{label:"Unit",children:(0,w.jsx)(ul,{children:m.unit})}),m.description&&(0,w.jsx)(dl.A.Item,{label:"Description",span:2,children:(0,w.jsx)(ul,{children:m.description})})]}),(0,w.jsxs)(dl.A,{title:"Pricing & Tax",column:2,size:"small",bordered:!0,style:{marginBottom:"24px"},children:[(0,w.jsx)(dl.A.Item,{label:"Selling Price",children:(0,w.jsxs)(ul,{strong:!0,style:{color:"#52c41a",fontSize:"16px"},children:["\u20b9",(null===(o=m.selling_price)||void 0===o?void 0:o.toFixed(2))||"0.00"]})}),(0,w.jsx)(dl.A.Item,{label:"MRP",children:(0,w.jsxs)(ul,{style:{color:"#fa8c16"},children:["\u20b9",(null===(a=m.mrp)||void 0===a?void 0:a.toFixed(2))||"0.00"]})}),(null===(r=m.CategoryItem)||void 0===r?void 0:r.name)&&(0,w.jsx)(dl.A.Item,{label:"Category",children:(0,w.jsx)(ul,{children:m.CategoryItem.name})}),void 0!==(null===(s=m.CategoryItem)||void 0===s?void 0:s.tax_percentage)&&(0,w.jsx)(dl.A.Item,{label:"Tax Rate",children:(0,w.jsxs)(P.A,{color:"orange",children:[m.CategoryItem.tax_percentage,"%"]})})]}),(void 0!==m.min_stock||void 0!==m.max_stock)&&(0,w.jsxs)(dl.A,{title:"Stock Information",column:2,size:"small",bordered:!0,children:[void 0!==m.min_stock&&(0,w.jsx)(dl.A.Item,{label:"Minimum Stock",children:(0,w.jsx)(ul,{children:m.min_stock})}),void 0!==m.max_stock&&(0,w.jsx)(dl.A.Item,{label:"Maximum Stock",children:(0,w.jsx)(ul,{children:m.max_stock})})]}),(0,w.jsx)("div",{style:{marginTop:"24px",padding:"16px",backgroundColor:"#f6f8fa",borderRadius:"8px",textAlign:"center"},children:(0,w.jsx)(ul,{type:"secondary",style:{fontSize:"12px"},children:"Right-click on product field to view details \u2022 Press ESC to close"})})]})}):(0,w.jsx)(p.A,{title:"Product Details",open:d,onCancel:g,footer:null,width:600,destroyOnClose:!0,children:(0,w.jsx)("div",{style:{textAlign:"center",padding:"40px 20px"},children:y?(0,w.jsx)(ul,{children:"Loading product details..."}):(0,w.jsx)(ul,{type:"secondary",children:"Product not found"})})})},{Text:pl}=o.A,vl=e=>{var t;let{billdata:l,onSuccess:n}=e;const o=Y({billdata:l,onSuccess:n}),{billData:p,form:v,modals:x,actions:y,billCalculations:g,handleQuantityChange:h,handleProductSelect:f,handleStockSelect:_,handlePrint:b,handleDownload:j,productOptions:C,customerOptions:k,vendorOptions:S,userOptions:A}=o;return(0,w.jsxs)("div",{className:Q,children:[(0,w.jsx)("div",{className:W}),(0,w.jsx)("div",{className:X}),(0,w.jsx)("div",{className:J}),(0,w.jsx)("div",{className:Z}),(0,w.jsx)("div",{className:$}),(0,w.jsx)(vt,{billdata:l,documentType:v.documentType,billSettings:v.billSettings,itemCount:v.billFormData.items.length,totalAmount:g.total_amount,onDocumentTypeChange:v.setDocumentType,onSettingsChange:v.updateSettings}),(0,w.jsx)("div",{className:je,children:(0,w.jsx)(yt,{billFormData:v.billFormData,customerOrVendorOptions:"bill"===v.documentType?k:S,userOptions:A,documentType:v.documentType,onHeaderChange:e=>{if(e[0]){const t="bill"===v.documentType?p.customerListResult.find((t=>t._id===e[0].customer_id)):p.vendorListResult.find((t=>t._id===e[0].customer_id)),l=p.userListResult.find((t=>t._id===e[0].billed_by_id));v.updateHeader({invoice_no:e[0].invoice_no||"",date:e[0].date,customer_id:e[0].customer_id||"",customer_name:(null===t||void 0===t?void 0:t.full_name)||(null===t||void 0===t?void 0:t.vendor_name)||"",billed_by_id:e[0].billed_by_id||"",billed_by_name:(null===l||void 0===l?void 0:l.name)||"",payment_mode:e[0].payment_mode||"cash"})}},onCustomerModalOpen:x.openCustomerModal,onUserModalOpen:x.openUserModal,loading:p.customerLoading||p.vendorLoading})}),(0,w.jsxs)("div",{className:Ce,children:[(0,w.jsx)("div",{className:ke}),(0,w.jsx)("div",{className:Se}),(0,w.jsxs)("div",{className:Ae,children:[(0,w.jsx)("div",{className:we,children:(0,w.jsx)(pl,{className:De,children:"\ud83d\uded2 BILL ITEMS"})}),(0,w.jsx)(z,{columns:[{key:"product_id",title:"\ud83d\uded2 PRODUCT",dataIndex:"product_id",type:"product",required:!0,width:280,render:(e,t,l)=>{const i=e?t.product_name?"".concat(t.product_name).concat(t.variant_name?" ".concat(t.variant_name):"").trim():"Unknown Product":"Select product";return(0,w.jsx)("div",{style:{cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:e?"1px solid #52c41a":"1px solid #d9d9d9",backgroundColor:e?"#f6ffed":"#fafafa"},onClick:()=>{"number"===typeof l&&x.openProductSelectionModal(l)},children:(0,w.jsx)("span",{style:{color:e?"#52c41a":"#1890ff"},children:i})})}},{key:"stock_id",title:"\ud83d\udce6 STOCK",dataIndex:"batch_no",type:"stock",required:!0,width:200,render:(e,t,l)=>{const i=t.stockData,n=(null===i||void 0===i?void 0:i.available_quantity)||0;return(0,w.jsx)("div",{style:{cursor:"pointer",padding:"4px 8px",borderRadius:"4px",border:e?"1px solid #52c41a":"1px solid #d9d9d9"},onClick:()=>{t.product_id&&"number"===typeof l?x.openStockModal(l):t.product_id||a.Ay.warning("Please select a product first")},children:(0,w.jsx)("span",{children:e?"".concat(e," (Qty: ").concat(n,")"):"Select Stock"})})}},{key:"qty",title:"\ud83d\udcca QTY",dataIndex:"qty",type:"number",width:90,editable:!0},{key:"loose_qty",title:"\ud83d\udccb LOOSE",dataIndex:"loose_qty",type:"number",width:90,editable:!0},{key:"price",title:"\ud83d\udcb0 RATE",dataIndex:"price",type:"number",width:120,editable:!1},{key:"amount",title:"\ud83d\udcb5 AMOUNT",dataIndex:"amount",type:"number",width:130,editable:!1}],dataSource:v.billFormData.items.map(((e,t)=>(0,i.A)((0,i.A)({},e),{},{key:t.toString()}))),onSave:e=>{const t=e.map(((e,t)=>{const l=v.billFormData.items[t];return e.qty!==(null===l||void 0===l?void 0:l.qty)||(e.loose_qty,null===l||void 0===l||l.loose_qty),e}));o.handleItemsChange(t)},onAdd:v.addItem,onDelete:v.deleteItems,onProductSelect:f,loading:p.productLoading||p.stockLoading||p.branchStockLoading,className:"modern-bill-grid",size:"small",rowKey:"key",externalEditingCell:x.externalEditingCell})]}),(0,w.jsx)(ht,{billCalculations:g,billSettings:v.billSettings,onDiscountChange:e=>v.updateSettings({discount:e}),onDiscountTypeChange:e=>v.updateSettings({discountType:e?"percentage":"amount"}),onPaidAmountChange:e=>v.updateSettings({paidAmount:e})})]}),(0,w.jsxs)("div",{className:Je,children:[(0,w.jsx)("div",{className:$e}),(0,w.jsx)("div",{className:et}),(0,w.jsx)("div",{className:tt}),(0,w.jsx)("div",{className:lt}),(0,w.jsxs)("div",{className:Ze,children:[(0,w.jsx)(r.Ay,{type:"primary",size:"large",icon:(0,w.jsx)(s.A,{}),onClick:y.handleSaveDraft,loading:p.saleCreateLoading,className:it,children:"\ud83d\udcbe SAVE DRAFT (F2)"}),(0,w.jsxs)(r.Ay,{type:"primary",size:"large",icon:(0,w.jsx)(s.A,{}),onClick:y.handleCompleteBill,loading:p.saleCreateLoading||p.saleUpdateLoading,className:it,children:["\ud83d\ude80 ",l?"UPDATE":"COMPLETE BILL"," (F3)"]}),(0,w.jsx)(r.Ay,{size:"large",icon:(0,w.jsx)(d.A,{}),onClick:x.openBillListDrawer,className:nt,children:"\ud83d\udccb BILL LIST (F6)"}),(0,w.jsx)(r.Ay,{size:"large",icon:(0,w.jsx)(c.A,{}),onClick:()=>{v.resetForm(),a.Ay.success("Bill form cleared successfully!")},className:rt,children:"\ud83e\uddf9 CLEAR (F4 / Ctrl+R)"}),(0,w.jsxs)(r.Ay,{size:"large",icon:(0,w.jsx)(u.A,{}),className:ot,onClick:b,children:["\ud83d\udda8\ufe0f PRINT ","bill"===v.documentType?"BILL":"INVOICE"," (F8)"]}),(0,w.jsx)(r.Ay,{size:"large",icon:(0,w.jsx)(m.A,{}),className:at,onClick:j,children:"\ud83d\udce5 DOWNLOAD PDF"})]}),(0,w.jsx)("div",{style:{background:"linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%)",padding:"14px 18px",borderRadius:"10px",border:"1px solid #cbd5e1",position:"relative",zIndex:1,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.05)"},children:(0,w.jsx)("div",{style:{textAlign:"right"},children:(0,w.jsxs)(pl,{style:{color:"#475569",fontSize:"12px",display:"block",fontWeight:600,lineHeight:"18px"},children:["\u26a1 ",(0,w.jsx)("strong",{children:"Keyboard Shortcuts:"})," Ctrl+S (Save) \u2022 Ctrl+N (Add) \u2022 F4/Ctrl+R (Clear) \u2022 Tab/Shift+Tab (Navigate) \u2022 Enter (Edit) \u2022 Esc (Cancel) \u2022 End (Customer) \u2022 Ctrl+U (User) \u2022 F5 (Product) \u2022 F6 (Bill List) \u2022 F7 (Stock)"]})})})]}),null!==x.stockModalRowIndex&&(0,w.jsx)(L,{visible:!0,onSelect:_,onCancel:x.closeStockModal,productId:(null===(t=v.billFormData.items[x.stockModalRowIndex])||void 0===t?void 0:t.product_id)||""}),"bill"===v.documentType&&(0,w.jsx)(Lt,{visible:x.customerModalVisible,onSelect:e=>{v.billFormData.customer_id!==e._id&&(v.updateHeader({customer_id:e._id,customer_name:e.full_name}),x.closeCustomerModal(),setTimeout((()=>x.openUserModal()),100),a.Ay.success('Customer "'.concat(e.full_name,'" selected successfully!')))},onCancel:x.closeCustomerModal}),"invoice"===v.documentType&&(0,w.jsx)(qt,{visible:x.customerModalVisible,onSelect:e=>{v.billFormData.customer_id!==e._id&&(v.updateHeader({customer_id:e._id,customer_name:e.vendor_name}),x.closeCustomerModal(),setTimeout((()=>x.openUserModal()),100),a.Ay.success('Vendor "'.concat(e.vendor_name,'" selected successfully!')))},onCancel:x.closeCustomerModal}),(0,w.jsx)(Ut,{visible:x.userModalVisible,onSelect:e=>{v.billFormData.billed_by_id!==e._id&&(v.updateHeader({billed_by_id:e._id,billed_by_name:e.name}),x.closeUserModal(),a.Ay.success('User "'.concat(e.name,'" selected as billed by successfully!')))},onCancel:x.closeUserModal}),(0,w.jsx)(Jt,{visible:x.saveConfirmationVisible,onNewBill:()=>{v.resetForm(),x.closeSaveConfirmation(),y.setSavedBillData(null),a.Ay.success("New bill form cleared successfully!")},onContinueBill:()=>{x.closeSaveConfirmation(),y.setSavedBillData(null)},onCancel:x.closeSaveConfirmation,savedBillData:y.savedBillData,onOpenProductModal:()=>{x.openProductSelectionModal(0)}}),(0,w.jsx)(ml,{visible:x.productDetailsModalVisible,onCancel:x.closeProductDetailsModal,productId:x.selectedProductId}),(0,w.jsx)(I,{visible:x.productSelectionModalVisible,onSelect:e=>{var t,l,i,n;if(null===x.productSelectionRowIndex)return;const r=[...v.billFormData.items];r[x.productSelectionRowIndex].product_id=e._id||"",r[x.productSelectionRowIndex].product_name=e.name||"",r[x.productSelectionRowIndex].variant_name=(null===(t=e.VariantItem)||void 0===t?void 0:t.variant_name)||"",r[x.productSelectionRowIndex].price=e.selling_price||0,r[x.productSelectionRowIndex].tax_percentage=(null===(l=e.CategoryItem)||void 0===l?void 0:l.tax_percentage)||0,r[x.productSelectionRowIndex].category_name=(null===(i=e.CategoryItem)||void 0===i?void 0:i.category_name)||"",r[x.productSelectionRowIndex].hsn_code=e.hsn_code||(null===(n=e.VariantItem)||void 0===n?void 0:n.hsn_code)||"",r[x.productSelectionRowIndex].hsn_sac=e.hsn_sac||"",o.handleItemsChange(r),x.closeProductSelectionModal(),x.openStockModal(x.productSelectionRowIndex),a.Ay.success('Product "'.concat(e.name,'" selected successfully!'))},onCancel:x.closeProductSelectionModal}),(0,w.jsx)(sl,{visible:x.billListDrawerVisible,onClose:x.closeBillListDrawer,onViewBill:e=>{v.loadBillData(e,(()=>{v.billFormData.items.length>0&&o.handleItemsChange(v.billFormData.items)})),p.refetchAllData(),x.closeBillListDrawer(),a.Ay.success('Bill "'.concat(e.invoice_no,'" loaded successfully!'))},onNewBill:()=>{v.resetForm(),x.closeBillListDrawer(),a.Ay.success("New bill form cleared successfully!")}})]})}},47246:(e,t,l)=>{l.d(t,{Ib:()=>r});var i=l(89379),n=l(65043),o=l(98350),a=l(94265);const r=e=>{const t=(0,n.useMemo)((()=>(0,o.yo)(e)),[e]),l=(0,n.useMemo)((()=>{const t=a.QQ[e];if(!t||"object"!==typeof t||!("GetAll"in t))throw new Error("Entity ".concat(e," not found in API_ROUTES or doesn't follow CRUD pattern"));return t}),[e]);return{useGetAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const l=t.useGetQuery(e);return(0,i.A)((0,i.A)({},l),{},{refetch:l.refetch})},useGetById:function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=t.useGetByIdQuery((0,i.A)({id:e},l));return(0,i.A)((0,i.A)({},n),{},{refetch:n.refetch})},useCreate:()=>{const[e,l]=t.useCreateMutation(),o=(0,n.useCallback)((async t=>{try{return{data:await e(t).unwrap(),error:null}}catch(l){return{data:null,error:l}}}),[e]);return(0,i.A)({create:o},l)},useUpdate:()=>{const[e,l]=t.useUpdateMutation(),o=(0,n.useCallback)((async(t,l)=>{try{return{data:await e({id:t,data:l}).unwrap(),error:null}}catch(i){return{data:null,error:i}}}),[e]);return(0,i.A)({update:o},l)},useDelete:()=>{const[e,l]=t.useDeleteMutation(),o=(0,n.useCallback)((async t=>{try{return{data:await e(t).unwrap(),error:null}}catch(l){return{data:null,error:l}}}),[e]);return(0,i.A)({delete:o,remove:o},l)},getRoutes:(0,n.useCallback)((()=>({getAll:l.GetAll,get:l.Get,create:l.Create,update:l.Update,delete:l.Delete})),[l]),entityName:e,entityRoutes:l}}},71281:(e,t,l)=>{l.d(t,{z:()=>o});var i=l(26016),n=l(65043);const o=e=>{let{action:t,title:l,mutationResult:o,refetch:a}=e;const{isLoading:r,isSuccess:s,isError:d,data:c,error:u,reset:m}=o,p=(0,n.useRef)(!1),v=(0,n.useRef)("");(0,n.useEffect)((()=>{const e=p.current;if(p.current=r||!1,r)return;if(!e)return;const n="".concat(s,"-").concat(d,"-").concat((null===c||void 0===c?void 0:c.statusCode)||"","-").concat((null===u||void 0===u?void 0:u.status)||"");if(v.current!==n){if(s&&c){200===(null===c||void 0===c?void 0:c.statusCode)||(null===c||void 0===c||c.status);const e=a;(0,i.y)({action:t,title:l,success:!0,getAllItems:e}),v.current=n,m&&setTimeout((()=>{m(),v.current=""}),100)}if(d&&u){var o;const e=(null===u||void 0===u||null===(o=u.data)||void 0===o?void 0:o.message)||(null===u||void 0===u?void 0:u.message)||(null===u||void 0===u?void 0:u.error)||"Failed to ".concat(t," ").concat(l);(0,i.y)({action:t,title:l,success:!1,errorMessage:e}),v.current=n,m&&setTimeout((()=>{m(),v.current=""}),100)}}}),[r,s,d,c,u,t,l,a,m])}},91449:(e,t,l)=>{l.d(t,{P0:()=>o});var i=l(16569),n=l(94265);const o=(e,t)=>{"success"===e?i.Ay.success(t):"error"===e&&i.Ay.error(t)};(e=>{const t=(e=>t=>{var l;const i=null===n.QQ||void 0===n.QQ||null===(l=n.QQ[e])||void 0===l?void 0:l[t];if(!i)throw new Error("API route for ".concat(String(e),".").concat(String(t)," is not defined."));return i})(e)})("Unit")}}]);
//# sourceMappingURL=12.6ddd48a0.chunk.js.map